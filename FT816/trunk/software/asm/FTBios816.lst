Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FTBios816.asm

                                        ; ============================================================================
                                        ; FTBios816.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014-2017  Robert Finch, Waterloo
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
     25 = 000000000000000D                            CR			EQU		13
     26 = 000000000000000A                            LF			EQU		10
     27 = 000000000000001B                            ESC			EQU		$1B
     28 = 0000000000000008                            BS			EQU		8
     29 = 0000000000000003                            CTRLC		EQU		3
                                        
     31 = 0000000000000012                            SC_LSHIFT	EQU		$12
     32 = 0000000000000059                            SC_RSHIFT	EQU		$59
     33 = 00000000000000F0                            SC_KEYUP	EQU		$F0
     34 = 00000000000000E0                            SC_EXTEND	EQU		$E0
     35 = 0000000000000014                            SC_CTRL		EQU		$14
     36 = 0000000000000011                            SC_ALT		EQU		$11
     37 = 0000000000000071                            SC_DEL		EQU		$71		; extend
     38 = 0000000000000058                            SC_LCTRL	EQU		$58
     39 = 0000000000000077                            SC_NUMLOCK	EQU		$77
     40 = 000000000000007E                            SC_SCROLLLOCK	EQU	$7E
     41 = 0000000000000058                            SC_CAPSLOCK	EQU		$58
                                        
     43 = 000000000000001F                            TEXTROWS	EQU		31
     44 = 0000000000000054                            TEXTCOLS	EQU		84
                                        
     46 = 0000000000000004                            TickCount	EQU		$4
     47 = 0000000000000008                            KeyState1	EQU		$8
     48 = 0000000000000009                            KeyState2	EQU		$9
     49 = 000000000000000A                            KeybdLEDs	EQU		$A
     50 = 000000000000000B                            KeybdWaitFlag	EQU	$B
     51 = 000000000000000C                            NumWorkArea	EQU		$C
                                        
                                        ; Range $10 to $1F reserved for hardware counters
     54 = 0000000000000010                            CNT0L		EQU		$10
     55 = 0000000000000011                            CNT0M		EQU		$11
     56 = 0000000000000012                            CNT0H		EQU		$12
     57 = 0000000000000020                            RangeStart	EQU		$20
     58 = 0000000000000024                            RangeEnd	EQU		$24
     59 = 0000000000000030                            CursorX		EQU		$30
     60 = 0000000000000032                            CursorY		EQU		$32
     61 = 0000000000000034                            VideoPos	EQU		$34
     62 = 0000000000000036                            NormAttr	EQU		$36
     63 = 0000000000000038                            StringPos	EQU		$38
     64 = 000000000000003C                            EscState	EQU		$3C
     65 = 0000000000000040                            Vidptr		EQU		$40
     66 = 0000000000000046                            Vidregs		EQU		$46
     67 = 000000000000004C                            Textcols	EQU		$4C
     68 = 000000000000004E                            Textrows	EQU		$4E
                                        
     70 = 0000000000000080                            reg_cs		EQU		$80
     71 = 00000084                      reg_ds		EQU		reg_cs + 4	; Yes, these values need 4 bytes as that is
     72 = 00000088                      reg_ss		EQU		reg_ds + 4	; the format read from the INF instruction.
     73 = 0000008C                      reg_pc		EQU		reg_ss + 4
     74 = 00000090                      reg_a		EQU		reg_pc + 4
     75 = 00000094                      reg_x		EQU		reg_a + 4
     76 = 00000098                      reg_y		EQU		reg_x + 4
     77 = 0000009C                      reg_sp		EQU		reg_y + 4
     78 = 000000A0                      reg_sr		EQU		reg_sp + 4
     79 = 000000A4                      reg_db		EQU		reg_sr + 4
     80 = 000000A8                      reg_dp		EQU		reg_db + 4
     81 = 000000AC                      reg_bl		EQU		reg_dp + 4
     82 = 000000B0                      reg_mp		EQU		reg_bl + 4
                                        
     84 = 0000000000000080                            cs_save		EQU		$80
     85 = 0000000000000084                            ds_save		EQU		$84
     86 = 0000000000000088                            pc_save		EQU		$88
     87 = 000000000000008C                            pb_save		EQU		$8C
     88 = 0000000000000090                            acc_save	EQU		$90
     89 = 0000000000000094                            x_save		EQU		$94
     90 = 0000000000000098                            y_save		EQU		$98
     91 = 000000000000009C                            sp_save		EQU		$9C
     92 = 00000000000000A0                            sr_save		EQU		$A0
     93 = 00000000000000A4                            srx_save	EQU		$A4
     94 = 00000000000000A8                            db_save		EQU		$A8
     95 = 00000000000000AC                            dpr_save	EQU		$AC
                                        
     97 = 00000000000000B8                            running_task	EQU		$B8
                                        
     99 = 00000000000000BA                            keybd_char	EQU		$BA
    100 = 00000000000000BA                            rw_flag		EQU		$BA
    101 = 00000000000000BC                            keybd_cmd	EQU		$BC
    102 = 00000000000000BE                            WorkTR		EQU		$BE
    103 = 00000000000000C0                            ExitCode	EQU		$C0
    104 = 00000000000000C4                            secnum		EQU		$C4
    105 = 00000000000000C8                            bufptr		EQU		$C8
    106 = 00000000000000CC                            qcnt		EQU		$CC
    107 = 00000000000000CE                            IOFocusTask	EQU		$CE
    108 = 00000000000000D0                            TaskSwitchEn	EQU	$D0
    109 = 00000000000000D2                            numsec		EQU		$D2
    110 = 00000000000000D4                            TimeoutList	EQU		$D4
    111 = 0000000000000100                            ldtrec		EQU		$100
    112 = 0000000000000104                            timeout1	EQU		$104
                                        
    114 = 0000000000000300                            RTCBuf		EQU		$300
    115 = 0000000000000380                            FilenameBuf	EQU		$380
    116 = 00000000000003F0                            OutputVec	EQU		$03F0
    117 = 00000000000003F4                            spi_rw_vect	EQU		$03F4
                                        
    119 = 000000000000B000                            PCS0		EQU		$B000
    120 = 0000B002                      PCS1		EQU		PCS0 + 2
    121 = 0000B004                      PCS2		EQU		PCS1 + 2
    122 = 0000B006                      PCS3		EQU		PCS2 + 2
    123 = 0000B008                      PCS4	    EQU		PCS3 + 2
    124 = 0000B00A                      PCS5		EQU		PCS4 + 2
    125 = 0000B010                      CTR0_LMT	EQU		PCS0 + 16
    126 = 0000B013                      CTR0_CTRL	EQU		CTR0_LMT + 3
    127 = 0000B014                      CTR1_LMT	EQU		CTR0_CTRL + 1
    128 = 0000B017                      CTR1_CTRL	EQU		CTR1_LMT + 3
    129 = 000000000000B01F                            MPU_IRQ_STATUS	EQU		$B01F
                                        
    131 = 00000000000D0000                            VIDBUF		EQU		$D0000		; FD0000
    132 = 00000000000EA000                            VIDREGS		EQU		$EA000
    133 = 00000000000EA100                            PRNG		EQU		$EA100
    134 = 00000000000EA110                            KEYBD		EQU		$EA110
    135 = 00000000000EA200                            FAC1		EQU		$EA200
                                        
    137 = 0000000000FEC000                            SPIMASTER	EQU		$00FEC000
    138 = 00FEC000                      SPI_MASTER_VERSION_REG	EQU	SPIMASTER+$00
    139 = 00FEC001                      SPI_MASTER_CONTROL_REG	EQU	SPIMASTER+$01
    140 = 00FEC002                      SPI_TRANS_TYPE_REG	EQU		SPIMASTER+$02
    141 = 00FEC003                      SPI_TRANS_CTRL_REG	EQU		SPIMASTER+$03
    142 = 00FEC004                      SPI_TRANS_STATUS_REG	EQU	SPIMASTER+$04
    143 = 00FEC005                      SPI_TRANS_ERROR_REG		EQU	SPIMASTER+$05
    144 = 00FEC006                      SPI_DIRECT_ACCESS_DATA_REG		EQU	SPIMASTER+$06
    145 = 00FEC007                      SPI_SD_SECT_7_0_REG		EQU	SPIMASTER+$07
    146 = 00FEC008                      SPI_SD_SECT_15_8_REG	EQU	SPIMASTER+$08
    147 = 00FEC009                      SPI_SD_SECT_23_16_REG	EQU	SPIMASTER+$09
    148 = 00FEC00A                      SPI_SD_SECT_31_24_REG	EQU	SPIMASTER+$0A
    149 = 00FEC010                      SPI_RX_FIFO_DATA_REG	EQU	SPIMASTER+$10
    150 = 00FEC011                      SPI_RX_FIFO_DATA_COUNT_MSB	EQU	SPIMASTER+$11
    151 = 00FEC012                      SPI_RX_FIFO_DATA_COUNT_LSB  EQU SPIMASTER+$12
    152 = 00FEC014                      SPI_RX_FIFO_CTRL_REG		EQU	SPIMASTER+$14
    153 = 00FEC020                      SPI_TX_FIFO_DATA_REG	EQU	SPIMASTER+$20
    154 = 00FEC024                      SPI_TX_FIFO_CTRL_REG	EQU	SPIMASTER+$24
    155 = 00FEC030                      SPI_RESP_BYTE1			EQU	SPIMASTER+$30
    156 = 00FEC031                      SPI_RESP_BYTE2			EQU	SPIMASTER+$31
    157 = 00FEC032                      SPI_RESP_BYTE3			EQU	SPIMASTER+$32
    158 = 00FEC033                      SPI_RESP_BYTE4			EQU	SPIMASTER+$33
                                        
    160 = 0000000000000001                            SPI_INIT_SD			EQU		$01
    161 = 0000000000000001                            SPI_TRANS_START		EQU		$01
    162 = 0000000000000001                            SPI_TRANS_BUSY		EQU		$01
    163 = 0000000000000000                            SPI_INIT_NO_ERROR	EQU		$00
    164 = 0000000000000000                            SPI_READ_NO_ERROR	EQU		$00
    165 = 0000000000000000                            SPI_WRITE_NO_ERROR	EQU		$00
    166 = 0000000000000002                            SPI_RW_READ_SD_BLOCK	EQU		$02
    167 = 0000000000000003                            SPI_RW_WRITE_SD_BLOCK	EQU		$03
                                        
    169 = 0000000000FEC100                            I2C_MASTER		EQU		$00FEC100
    170 = 00FEC100                      I2C_PRESCALE_LO	EQU		I2C_MASTER+$00
    171 = 00FEC101                      I2C_PRESCALE_HI	EQU		I2C_MASTER+$01
    172 = 00FEC102                      I2C_CONTROL		EQU		I2C_MASTER+$02
    173 = 00FEC103                      I2C_TX			EQU		I2C_MASTER+$03
    174 = 00FEC103                      I2C_RX			EQU		I2C_MASTER+$03
    175 = 00FEC104                      I2C_CMD			EQU		I2C_MASTER+$04
    176 = 00FEC104                      I2C_STAT		EQU		I2C_MASTER+$04
                                        
    178 = 0000000000FEC200                            READY_FIFO		EQU		$00FEC200
    179 = 0000000000FEC210                            READY_FIFO_CNT	EQU		$00FEC210
    180 = 0000000000FEC300                            TIMEOUT_LIST	EQU		$00FEC300
                                        
    182 = 00000000000000FC                            BIOSctx			EQU		$FC
    183 = 00000000000000FD                            OSctx			EQU		$FD
    184 = 0000000000000010                            MAX_IRQ_HOOKS	EQU		16
                                        
                                        ; Timeout list commands
    187 = 0000000000000000                            TOL_NOP			EQU		0
    188 = 0000000000000001                            TOL_DEC			EQU		1
    189 = 0000000000000002                            TOL_INS			EQU		2
    190 = 0000000000000003                            TOL_RMV			EQU		3
                                        
    192 = 00000000000EB000                            SID			EQU		$EB000		; FEB000
    193 = 0000000000000000                            SID_FREQ0		EQU		$00
    194 = 0000000000000004                            SID_PW0			EQU		$04
    195 = 0000000000000008                            SID_CTRL0		EQU		$08
    196 = 000000000000000C                            SID_ATTACK0		EQU		$0C
    197 = 0000000000000010                            SID_DECAY0		EQU		$10
    198 = 0000000000000014                            SID_SUSTAIN0	EQU		$14
    199 = 0000000000000018                            SID_RELEASE0	EQU		$18
    200 = 000000000000001C                            SID_WADR0		EQU		$1C
    201 = 00000000000000B0                            SID_VOLUME		EQU		$B0
                                        
    203 = 0000000000007868                            do_invaders			EQU		$7868
                                        
    205 = 0000000000000040                            NR_JCB			EQU		64
    206 = 0000000000000200                            NR_TCB			EQU		512
    207 = 0000000000000400                            NR_MBX			EQU		1024
    208 = 0000000000001000                            NR_MSG			EQU		4096
    209 = 0000000000000020                            NR_MBXperJCB	EQU		32
                                        
    211 = 0000000000000001                            TS_READY		EQU		1
    212 = 0000000000000002                            TS_PREEMPT		EQU		2
    213 = 0000000000000004                            TS_WAITMSG		EQU		4
    214 = 0000000000000008                            TS_TIMEOUT		EQU		8
    215 = 0000000000000000                            MQS_NEWEST		EQU		0		; message queue strategy
    216 = 0000000000000000                            MT_NONE			EQU		0
    217 = 0000000000000001                            MT_FREE			EQU		1
    218 = 0000000000000000                            MBT_DATA		EQU		0
                                        
    220 = 0000000000000000                            E_Ok			EQU		0
    221 = FFFFFFFFFFFFFFFF                            E_NotAlloc		EQU		-1
    222 = FFFFFFFFFFFFFFFE                            E_NoMsg			EQU		-2
    223 = FFFFFFFFFFFFFFFD                            E_NoMoreMsgBlks	EQU		-3
    224 = FFFFFFFFFFFFFFFC                            E_NoMoreMbx		EQU		-4		; System has no more mailboxes available
    225 = FFFFFFFFFFFFFFFB                            E_TooManyMbx	EQU		-5		; JCB mailboxes maxed out
                                        
    227 = 0000000000000040                            TCB_SIZE		EQU		64
    228 = 0000000000020000                            tcbs			EQU		$20000
    229 = 0000000000000000                            TCB_Next		EQU		$00	; 2 byte handles
    230 = 0000000000000002                            TCB_Prev		EQU		$02	; 2 byte handles
    231 = 0000000000000004                            TCB_Timeout		EQU		$04	; 4 byte value
    232 = 0000000000000008                            TCB_mbq_next	EQU		$08	; 2 byte handles
    233 = 000000000000000A                            TCB_mbq_prev	EQU		$0A	; 2 byte handles
    234 = 000000000000000C                            TCB_msg_d1		EQU		$0C	; 4 byte value
    235 = 0000000000000010                            TCB_msg_d2		EQU		$10	; 4 byte value
    236 = 0000000000000014                            TCB_msg_d3		EQU		$14	; 4 byte value
    237 = 0000000000000018                            TCB_msg_tgtadr	EQU		$18	; 2 byte handle
    238 = 000000000000001A                            TCB_msg_retadr	EQU		$1A	; 2 byte handle
    239 = 000000000000001C                            TCB_msg_link	EQU		$1C	; 2 byte handle
    240 = 000000000000001E                            TCB_msg_type	EQU		$1E	; 2 byte value
    241 = 0000000000000020                            TCB_hWaitMbx	EQU		$20	; 2 byte handle
    242 = 0000000000000022                            TCB_number		EQU		$22	; 2 byte value
    243 = 0000000000000024                            TCB_priority	EQU		$24	; 1 byte value
    244 = 0000000000000025                            TCB_status		EQU		$25	; 1 byte value
    245 = 0000000000000026                            TCB_affinity	EQU		$26	; 1 byte value
    246 = 0000000000000027                            TCB_hJcb		EQU		$27	; 1 byte handle
    247 = 0000000000000028                            TCB_start_tick	EQU		$28	; 4 byte value
    248 = 000000000000002C                            TCB_end_tick	EQU		$2C	; 4 byte value
    249 = 0000000000000030                            TCB_ticks		EQU		$30	; 4 byte value
    250 = 0000000000000034                            TCB_exception	EQU		$34	; 4 byte value
                                        
    252 = 0000000000000400                            JCB_SIZE		EQU		1024
    253 = 00028000                      jcbs			EQU		tcbs + TCB_SIZE * NR_TCB
    254 = 0000000000000000                            JCB_iof_next	EQU		$000	; 1 byte value
    255 = 0000000000000001                            JCB_iof_prev	EQU		$001	; 1 byte value
    256 = 0000000000000002                            JCB_user_name	EQU		$002	; 32 byte value
    257 = 0000000000000022                            JCB_path		EQU		$022	; 256 byte value
    258 = 0000000000000122                            JCB_exit_runfile	EQU	$122	; 256 byte value
    259 = 0000000000000222                            JCB_command_line	EQU	$222	; 256 byte value
    260 = 0000000000000322                            JCB_pVidMem		EQU		$322	; 6 byte value
    261 = 0000000000000328                            JCB_pVirtVidMem	EQU		$328	; 6 byte value
    262 = 000000000000032E                            JCB_VideoCols	EQU		$32E	; 1 byte value
    263 = 000000000000032F                            JCB_VideoRows	EQU		$32F	; 1 byte value
    264 = 0000000000000330                            JCB_CursorRow	EQU		$330	; 1 byte value
    265 = 0000000000000331                            JCB_CursorCol	EQU		$331	; 1 byte value
    266 = 0000000000000332                            JCB_NormAttr	EQU		$332	; 2 byte value
    267 = 0000000000000334                            JCB_KeyState1	EQU		$334	; 2 byte value
    268 = 0000000000000336                            JCB_KeyState2	EQU		$336	; 2 byte value
    269 = 0000000000000338                            JCB_KeybdWaitFlag	EQU	$338	; 1 byte value
    270 = 0000000000000339                            JCB_KeybdHead	EQU		$339
    271 = 000000000000033A                            JCB_KeybdTail	EQU		$33A
    272 = 000000000000033B                            JCB_KeybdBuffer	EQU		$33B	; 32 byte value
    273 = 000000000000035B                            JCB_number		EQU		$35B	; 1 byte value
    274 = 000000000000035C                            JCB_tasks		EQU		$35C	; 2 byte value * 8
    275 = 000000000000035E                            JCB_next		EQU		$35E	; 1 byte value
    276 = 0000000000000360                            JCB_hMbxs		EQU		$360	; 2 byte value
                                        
                                        ; 1024 mailboxes
    279 = 00038000                      mailboxes		EQU		jcbs + JCB_SIZE * NR_JCB
    280 = 0000000000000018                            MBX_SIZE		EQU		24
    281 = 0000000000000000                            MBX_link		EQU		$00	; 1 byte value
    282 = 0000000000000001                            MBX_owner		EQU		$01	; 1 byte value
    283 = 0000000000000002                            MBX_tq_head		EQU		$02	; 2 byte value
    284 = 0000000000000004                            MBX_tq_tail		EQU		$04	; 2 byte value
    285 = 0000000000000006                            MBX_mq_head		EQU		$06	; 2 byte value
    286 = 0000000000000008                            MBX_mq_tail		EQU		$08	; 2 byte value
    287 = 000000000000000C                            MBX_tq_count	EQU		$0C	; 2 byte value
    288 = 000000000000000E                            MBX_mq_count	EQU		$0E	; 2 byte value
    289 = 0000000000000010                            MBX_mq_size		EQU		$10	; 2 byte value
    290 = 0000000000000012                            MBX_mq_missed	EQU		$12	; 2 byte value
    291 = 0000000000000014                            MBX_mq_strategy	EQU		$14	; 1 byte value
    292 = 0000000000000016                            MBX_number		EQU		$16	; 2 byte value
                                        
    294 = 0003E000                      messages	EQU		mailboxes + MBX_SIZE * NR_MBX
    295 = 0000000000000000                            MSG_d1		EQU		$00	; 4 byte value	( 4096 messages )
    296 = 0000000000000004                            MSG_d2		EQU		$04	; 4 byte value
    297 = 0000000000000008                            MSG_d3		EQU		$08	; 4 byte value
    298 = 000000000000000C                            MSG_tgtadr	EQU		$0C	; 2 byte handle
    299 = 000000000000000E                            MSG_retadr	EQU		$0E	; 2 byte handle
    300 = 0000000000000010                            MSG_link	EQU		$10	; 2 byte handle
    301 = 0000000000000012                            MSG_type	EQU		$12	; 2 byte value
    302 = 00000014                      MSG_SIZE	EQU		MSG_type + 2
                                        
    304 = 00052000                      running_task	EQU		messages + MSG_SIZE * NR_MSG
    305 = 00052002                      hTcbTmp		EQU		running_task + 2
    306 = 00052004                      hMbxTmp		EQU		hTcbTmp + 2
    307 = 00052006                      hMsgTmp		EQU		hMbxTmp + 2
    308 = 00052008                      freeMBX		EQU		hMsgTmp + 2
    309 = 0005200A                      freeMSG		EQU		freeMBX + 2
    310 = 0005200C                      freeJCB		EQU		freeMSG + 2
    311 = 0005200E                      nMsgBlk		EQU		freeJCB + 2
    312 = 00052010                      nMailbox	EQU		nMsgBlk + 2
    313 = 00052012                      IRQ1Hook	EQU		nMailbox + 2
    314 = 00052052                      IRQ1HookEnd	EQU		IRQ1Hook + MAX_IRQ_HOOKS * 4
    315 = 00052052                      IOFocusBmp	EQU		IRQ1HookEnd
                                        
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
supermon832.asm

                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;	.opt proc65c02,caseinsensitive
                                        	cpu	W65C02
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;*                                                                                 *
                                        ;*      SUPERMON 816 MACHINE LANGUAGE MONITOR FOR THE W65C816S MICROPROCESSOR      *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;*      Copyright ©1991-2014 by BCS Technology Limited.  All rights reserved.      *
                                        ;*                                                                                 *
                                        ;* Permission is hereby granted to use, copy, modify and distribute this software, *
                                        ;* provided this copyright notice remains in the source code and  proper  attribu- *
                                        ;* tion is given.  Redistribution, regardless of form, must be at no charge to the *
                                        ;* end  user.  This code or any part thereof, including any derivation, MAY NOT be *
                                        ;* incorporated into any package intended for sale,  unless written permission has * 
                                        ;* been given by the copyright holder.                                             *
                                        ;*                                                                                 *
                                        ;* THERE IS NO WARRANTY OF ANY KIND WITH THIS SOFTWARE.  The user assumes all risk *
                                        ;* in connection with the incorporation of this software into any system.          *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a salute to Jim Butterfield, who passed away on June 29, 2007.  *
                                        ;*                                                                                 *
                                        ;* Jim, who was the unofficial  spokesman for  Commodore  International during the *  
                                        ;* heyday of the company's 8 bit supremacy, scratch-developed the Supermon machine *
                                        ;* language monitor for the PET & CBM computers.   When the best-selling Commodore *
                                        ;* 64 was introduced, Jim adapted his software to the new machine & gave the adap- *
                                        ;* tation the name Supermon 64.   Commodore  subsequently  integrated a customized *
                                        ;* version of Supermon 64 into the C-128 to act as the resident M/L monitor.       *
                                        ;*                                                                                 *
                                        ;* Although Supermon 816 is not an adaptation of Supermon 64,  it was  decided  to *
                                        ;* keep the Supermon name alive, since Supermon 816's general operation & user in- *
                                        ;* terface is similar to that of Supermon 64.   Supermon 816 is 100 percent native *
                                        ;* mode 65C816 code & was developed from a blank canvas.                           *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* This version customized for the RTF65002 test system                            *
                                        ;* Finitron.ca                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a full featured monitor and supports the following operations:  *
                                        ;*                                                                                 *
                                        ;*     A — Assemble code                                                           *
                                        ;*     C — Compare memory regions                                                  *
                                        ;*     D — Disassemble code                                                        *
                                        ;*     F — Fill memory region (cannot span banks)                                  *
                                        ;*     G — Execute code (stops at BRK)                                             *
                                        ;*     H — Search (hunt) memory region                                             *
                                        ;*     J — Execute code as a subroutine (stops at BRK or RTS)                      *
                                        ;*     M — Dump & display memory range                                             *
                                        ;*     R — Dump & display 65C816 registers                                         *
                                        ;*     T — Copy (transfer) memory region                                           *
                                        ;*     X — Exit Supermon 816 & return to operating environment                     *
                                        ;*     > — Modify up to 32 bytes of memory                                         *
                                        ;*     ; — Modify 65C816 registers                                                 *
                                        ;*                                                                                 *
                                        ;* Supermon 816 accepts binary (%), octal (@), decimal (+) and hexadecimal ($) as  *
                                        ;* input for numeric parameters.  Additionally, the H and > operations accept an   *
                                        ;* ASCII string in place of numeric values by preceding the string with ', e.g.:   *
                                        ;*                                                                                 *
                                        ;*     h 042000 042FFF 'BCS Technology Limited                                     *
                                        ;*                                                                                 *
                                        ;* If no radix symbol is entered hex is assumed.                                   *
                                        ;*                                                                                 *
                                        ;* Numeric conversion is also available.  For example, typing:                     *
                                        ;*                                                                                 *
                                        ;*     +1234567 <CR>                                                               *
                                        ;*                                                                                 *
                                        ;* will display:                                                                   *
                                        ;*                                                                                 *
                                        ;*         $12D687                                                                 *
                                        ;*         +1234567                                                                *
                                        ;*         @04553207                                                               *
                                        ;*         %100101101011010000111                                                  *
                                        ;*                                                                                 *
                                        ;* In the above example, <CR> means the console keyboard's return or enter key.    *
                                        ;*                                                                                 *
                                        ;* All numeric values are internally processed as 32 bit unsigned integers.  Addr- *
                                        ;* esses may be entered as 8, 16 or 24 bit values.  During instruction assembly,   *
                                        ;* immediate mode operands may be forced to 16 bits by preceding the operand with  *
                                        ;* an exclamation point if the instruction can accept a 16 bit operand, e.g.:      *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 lda !#4                                                            *
                                        ;*                                                                                 *
                                        ;* The above will assemble as:                                                     *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A9 04 00     LDA #$0004                                           *
                                        ;*                                                                                 *
                                        ;* Entering:                                                                       *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 ldx !#+157                                                         *
                                        ;*                                                                                 *
                                        ;* will assemble as:                                                               *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D 00     LDX #$009D                                           *
                                        ;*                                                                                 *
                                        ;* Absent the ! in the operand field, the above would have been assembled as:      *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D        LDX #$9D                                             *
                                        ;*                                                                                 *
                                        ;* If an immediate mode operand is greater than $FF assembly of a 16 bit operand   *
                                        ;* is implied.                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* A Note on the PEA & PEI Instructions                                            *
                                        ;* ————————————————————————————————————                                            *
                                        ;*                                                                                 *
                                        ;* The Eyes and Lichty programming manual uses the following syntax for the PEA    *
                                        ;* and PEI instructions:                                                           *
                                        ;*                                                                                 *
                                        ;*     PEA <operand>                                                               *
                                        ;*     PEI (<operand>)                                                             *
                                        ;*                                                                                 *
                                        ;* The WDC data sheet that was published at the time of the 65C816's release in    *
                                        ;* 1984 does not indicate a recommended or preferred syntax for any of the above   *
                                        ;* instructions.  PEA pushes its operand to the stack and hence operates like any  *
                                        ;* other immediate mode instruction, in that the operand is the data (however, PEA *
                                        ;* doesn't affect the status register).  Similarly, PEI pushes the 16 bit value    *
                                        ;* stored at <operand> and <operand>+1, and hence operates like any other direct   *
                                        ;* (zero) page instruction, again without affecting the status register.           *
                                        ;*                                                                                 *
                                        ;* BCS Technology Limited is of the opinion that the developer of the ORCA/M as-   *
                                        ;* sembler, which is the assembler referred to in the Eyes and Lichty manual, mis- *
                                        ;* understood how PEA and PEI behave during runtime, and hence chose an incorrect  *
                                        ;* syntax for these two instructions.  This error was subsequently carried forward *
                                        ;* by Eyes and Lichty.                                                             *
                                        ;*                                                                                 *
                                        ;* Supermon 816's assembler uses the following syntax for PEA and PEI:             *
                                        ;*                                                                                 *
                                        ;*     PEA #<operand>                                                              *
                                        ;*     PEI <operand>                                                               *
                                        ;*                                                                                 *
                                        ;* The operand for PEA is treated as a 16 bit value, even if entered as an 8 bit   *
                                        ;* value.  The operand for PEI must be 8 bits.                                     *
                                        ;*                                                                                 *
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;	* * * * * * * * * * * *
                                        ;	* VERSION INFORMATION *
                                        ;	* * * * * * * * * * * *
                                        ;
                                        softvers .macro                ;software version — change with each revision...
                                                 .byte "1"             ;major
                                                 .byte "."
                                                 .byte "0"             ;minor
                                                 .byte "."
                                                 .byte "0"             ;revision
                                                 .endm
                                        ;
                                        ;REVISION TABLE
                                        ;
                                        ;Ver  Rev Date    Description
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;1.0  2013/11/01  A) Original derived from the POC V1.1 single-board computer
                                        ;                    firmware.
                                        ;     2013/11/04  A) Fixed a problem where the B-accumulator wasn't always being
                                        ;                    be copied to shadow storage after return from execution of
                                        ;                    a J command.
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	        COMMENT ABBREVIATIONS
                                        ;	————————————————————————————————————————————————————
                                        ;	  BCD   binary-coded decimal
                                        ;	   DP   direct page or page zero
                                        ;	  EOF   end-of-field
                                        ;	  EOI   end-of-input
                                        ;	  LSB   least significant byte/bit
                                        ;	  LSD   least significant digit
                                        ;	  LSN   least significant nybble
                                        ;	  LSW   least significant word
                                        ;	  MPU   microprocessor
                                        ;	  MSB   most significant byte/bit
                                        ;	  MSD   most significant digit
                                        ;	  MSN   most significant nybble
                                        ;	  MSW   most-significant word
                                        ;	  RAM   random access memory
                                        ;	   WS   whitespace, i.e., blanks & horizontal tabs
                                        ;	————————————————————————————————————————————————————
                                        ;	A word is defined as 16 bits.
                                        ;
                                        ;	   MPU REGISTER SYMBOLS
                                        ;	——————————————————————————
                                        ;	   .A   accumulator LSB
                                        ;	   .B   accumulator MSB
                                        ;	   .C   16 bit accumulator
                                        ;	   .X   X-index
                                        ;	   .Y   Y-index
                                        ;      DS   data segment
                                        ;	   DB   data bank
                                        ;	   DP   direct page
                                        ;      CS   code segment
                                        ;	   PB   program bank
                                        ;	   PC   program counter
                                        ;	   SP   stack pointer
                                        ;	   SR   MPU status
                                        ;      SRX  status extension
                                        ;	————————————————————————————
                                        ;
                                        ;	  MPU STATUS REGISTER SYMBOLS
                                        ;	———————————————————————————————
                                        ;	    C   carry
                                        ;	    D   decimal mode
                                        ;	    I   maskable interrupts
                                        ;	    m   accumulator/memory size
                                        ;	    N   result negative
                                        ;	    V   sign overflow
                                        ;	    x   index registers size
                                        ;	    Z   result zero
                                        ;
                                        ;      16   16 bit emulation flag
                                        ;      32   32 bit emulation flag
                                        ;	———————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SYSTEM INTERFACE DEFINITIONS
                                        ;
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;	This section defines the interface between Supermon 816 & the host
                                        ;	system.   Change these definitions to suit your system, but do not
                                        ;	change any label names.  All definitions must have valid values in
                                        ;	order to assemble Supermon 816.
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————
    538 = 0000000000008000                            _origin_ =$008000              ;assembly address...
                                        ;
                                        ;	Set _ORIGIN_ to Supermon 816's desired assembly address.
                                        ;	————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    544 = 000000000000FE03                            vecexit  =$00FE03              ;exit to environment address...
                                        ;
                                        ;	Set VECEXIT to where Supermon 816 should go when it exits.  Supermon 816
                                        ;	will do a JML (long jump) to this address, which means VECEXIT must be a
                                        ;	24 bit address.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    552 = 0000000000000102                            vecbrki  =$0102                ;BRK handler indirect vector...
    553 = 0000000000000105                            vecbrkia =$0105                ;system indirect BRK vector
                                        ;
                                        ;	Supermon 816 will modify this vector so that execution of a BRK instruc-
                                        ;	tion is intercepted & the registers  are  captured.   Your BRK front end
                                        ;	should jump through this vector after pushing the registers as follows:
                                        ;
                                        ;	         phb                   ;save DB
                                        ;	         phd                   ;save DP
                                        ;	         rep #%00110000        ;16 bit registers
                                        ;	         pha
                                        ;	         phx
                                        ;	         phy
                                        ;	         jmp (vecbrki)         ;indirect vector
                                        ;
                                        ;	When a G or J command is issued, the above sequence will be reversed be-
                                        ;	fore a jump is made to the code to be executed.  Upon exit from Supermon
                                        ;	816, the original address at VECBRKI will be restored.
                                        ;
                                        ;	If your BRK front end doesn't conform to the above you will have to mod-
                                        ;	ify Supermon 816 to accommodate the differences.  The most likely needed
                                        ;	changes will be in the order in which registers are pushed to the stack.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    577 = 0000000000003FFF                            hwstack  =$3fff                ;top of hardware stack...
                                        ;
                                        ;	Supermon 816 initializes the stack pointer to this address when the cold
                                        ;	start at MONCOLD is called to enter the monitor.  The stack pointer will
                                        ;	be undisturbed when entry into Supermon 816 is through JMONBRK (see jump
                                        ;	table definitions).
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    586 = 0000000000000080                            zeropage =$80                  ;Supermon 816's direct page...
                                        ;
                                        ;	Supermon 816 uses direct page starting at this address.  Be sure that no
                                        ;	conflict occurs with other software.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    592 = 00000000000000FC                            biosctx	 =$FC
                                        ;	————————————————————————————————————————————————————————————————————————
    594 = 000000000000FE00                            getcha   =$FE00                ;get keystroke from console...
                                        ;
                                        ;	GETCHA refers to an operating system API call that returns a keystroke
                                        ;	in the 8 bit accumulator.  Supermon 816  assumes that GETCHA is a non-
                                        ;	blocking subroutine & returns with carry clear to indicate that a key-
                                        ;	stroke is in .A, or with carry set to indicate that no keystroke was
                                        ;	available.  GETCHA will be called with a JSR instruction.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from GETCHA.
                                        ;	You may have to modify Supermon 816 at all calls to GETCHA if your "get
                                        ;	keystroke" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    608 = 000000000000FE06                            putcha   =$FE06                ;print character on console...
                                        ;
                                        ;	PUTCHA refers to an operating system API call that prints a character to
                                        ;	the console screen.  The character to be printed will be in .A, which
                                        ;	will be set to 8-bit width.  Supermon 816 assumes that PUTCHA will block
                                        ;	until the character can be processed.  PUTCHA will be called with a JSR
                                        ;	instructions.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from PUTCHA.
                                        ;	You may have to modify Supermon 816 at all calls to PUTCHA if your "put
                                        ;	character" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    622 = 0000000000000003                            stopkey  =$03                  ;display abort key...
                                        ;
                                        ;	Supermon 816 will poll for a "stop key" during display operations, such
                                        ;	as code disassembly & memory dumps, so as to abort further processing &
                                        ;	return to the command prompt.  STOPKEY must be defined with the ASCII
                                        ;	value that the "stop key" will emit when typed.  The polling is via a
                                        ;	call to GETCHA (described above).  The default STOPKEY definition of $03
                                        ;	is for ASCII <ETX> or [Ctrl-C].
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    632 = 0000000000000200                            ibuffer  =$000200               ;input buffer &...
    633 = 00000251                      auxbuf   =ibuffer+s_ibuf+1 ;auxiliary buffer...
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	Supermon 816 will use the above definitions for input buffers.  These
                                        ;	buffers may be located anywhere in RAM that is convenient.  The buffers
                                        ;	are stateless, which means that unless Supermon 816 has control of your
                                        ;	system, they may be overwritten without consequence.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S INSTRUCTION SYNTHESIS MACROS —— !!!!! DO NOT EDIT !!!!!
                                        ;
                                        _asm24_  .macro .ad
                                                 .byte <.ad,>.ad,.ad >> 16
                                                 .endm
                                        ;
                                        brl      .macro .ad
                                        .ba      =*+3
                                                 .byte $82
                                                 .word .ad-.ba
                                                 .endm
                                        ;
                                        ; jml is supported for the RTF65002 in 65c02 mode. And the opcode is supported
                                        ; by the assembler.
                                        ;jml      .macro .ad
                                        ; ;        .byte $5c
                                        ;         _asm24_ .ad
                                        ;         .endm
                                        ;
                                        mvn      .macro .s,.d
                                                 .byte $54,.d,.s
                                                 .endm
                                        ;
                                        mvp      .macro .s,.d
                                                 .byte $44,.d,.s
                                                 .endm
                                        ;
                                        pea      .macro .op
                                                 .byte $f4
                                                 .word .op
                                                 .endm
                                        ;
                                        phb      .macro
                                                 .byte $8b
                                                 .endm
                                        ;
                                        phk      .macro
                                                 .byte $4b
                                                 .endm
                                        ;
                                        plb      .macro
                                                 .byte $ab
                                                 .endm
                                        ;
                                        rep      .macro .op
                                                 .byte $c2,.op
                                                 .endm
                                        ;
                                        sep      .macro .op
                                                 .byte $e2,.op
                                                 .endm
                                        ;
                                        tcd      .macro
                                                 .byte $5b
                                                 .endm
                                        ;
                                        tcs      .macro
                                                 .byte $1b
                                                 .endm
                                        ;
                                        tdc      .macro
                                                 .byte $7b
                                                 .endm
                                        ;
                                        tsc      .macro
                                                 .byte $3b
                                                 .endm
                                        ;
                                        txy      .macro
                                                 .byte $9b
                                                 .endm
                                        ;
                                        tyx      .macro
                                                 .byte $bb
                                                 .endm
                                        ;
                                        wai      .macro
                                                 .byte $cb
                                                 .endm
                                        ;
                                        xba      .macro
                                                 .byte $eb
                                                 .endm
                                        ;
                                        adcw     .macro .op
                                                 adc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        andw     .macro .op
                                                 and #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        bitw     .macro .op
                                                 bit #<.op
                                                 .byte >.op
                                                 .endm
                                        ;         
                                        cmpw     .macro .op
                                                 cmp #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpxw     .macro .op
                                                 cpx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpyw     .macro .op
                                                 cpy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        eorw     .macro .op
                                                 eor #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldaw     .macro .op
                                                 lda #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldxw     .macro .op
                                                 ldx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldyw     .macro .op
                                                 ldy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        oraw     .macro .op
                                                 ora #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        sbcw     .macro .op
                                                 sbc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldalx    .macro .ad
                                                 .byte $+         .byte a_esc,"("
                                     +            .byte a_esc,"G4"
                                        
                                     +            .byte <.ad,>.ad,.ad >> 16
                                        
                                                 .endm
                                        ;
                                        adcil    .macro .ad
                                                 .byte $67,.ad
                                                 .endm
                                        ;
                                        adcily   .macro .ad
                                                 .byte $77,.ad
                                                 .endm
                                        ;
                                        andil    .macro .ad
                                                 .byte $27,.ad
                                                 .endm
                                        ;
                                        andily   .macro .ad
                                                 .byte $37,.ad
                                                 .endm
                                        ;
                                        cmpil    .macro .ad
                                                 .byte $c7,.ad
                                                 .endm
                                        ;
                                        cmpily   .macro .ad
                                                 .byte $d7,.ad
                                                 .endm
                                        ;
                                        eoril    .macro .ad
                                                 .byte $47,.ad
                                                 .endm
                                        ;
                                        eorily   .macro .ad
                                                 .byte $57,.ad
                                                 .endm
                                        ;
                                        ldail    .macro .ad
                                                 .byte $a7,.ad
                                                 .endm
                                        ;
                                        ldaily   .macro .ad
                                                 .byte $b7,.ad
                                                 .endm
                                        ;
                                        orail    .macro .ad
                                                 .byte $07,.ad
                                                 .endm
                                        ;
                                        oraily   .macro .ad
                                                 .byte $17,.ad
                                                 .endm
                                        ;
                                        sbcil    .macro .ad
                                                 .byte $e7,.ad
                                                 .endm
                                        ;
                                        sbcily   .macro .ad
                                                 .byte $f7,.ad
                                                 .endm
                                        ;
                                        stail    .macro .ad
                                                 .byte $87,.ad
                                                 .endm
                                        ;
                                        staily   .macro .ad
                                                 .byte $97,.ad
                                                 .endm
                                        ;
                                        adcs     .macro .of
                                                 .byte $63,.of
                                                 .endm
                                        ;
                                        adcsi    .macro .of
                                                 .byte $73,.of
                                                 .endm
                                        ;
                                        ands     .macro .of
                                                 .byte $23,.of
                                                 .endm
                                        ;
                                        andsi    .macro .of
                                                 .byte $33,.of
                                                 .endm
                                        ;
                                        cmps     .macro .of
                                                 .byte $c3,.of
                                                 .endm
                                        ;
                                        cmpsi    .macro .of
                                                 .byte $d3,.of
                                                 .endm
                                        ;
                                        eors     .macro .of
                                                 .byte $43,.of
                                                 .endm
                                        ;
                                        eorsi    .macro .of
                                                 .byte $53,.of
                                                 .endm
                                        ;
                                        ldas     .macro .of
                                                 .byte $a3,.of
                                                 .endm
                                        ;
                                        ldasi    .macro .of
                                                 .byte $b3,.of
                                                 .endm
                                        ;
                                        oras     .macro .of
                                                 .byte $03,.of
                                                 .endm
                                        ;
                                        orasi    .macro .of
                                                 .byte $13,.of
                                                 .endm
                                        ;
                                        sbcs     .macro .of
                                                 .byte $e3,.of
                                                 .endm
                                        ;
                                        sbcsi    .macro .of
                                                 .byte $f3,.of
                                                 .endm
                                        ;
                                        stas     .macro .of
                                                 .byte $83,.of
                                                 .endm
                                        ;
                                        stasi    .macro .of
                                                 .byte $93,.of
                                                 .endm
                                        ;
                                        longa    .macro
                                                 .byte $c2,$20
                                                 .endm
                                        ;
                                        longr    .macro
                                                 .byte $c2,$30
                                                 .endm
                                        ;
                                        longx    .macro
                                                 .byte $c2,$10
                                                 .endm
                                        ;
                                        shorta   .macro
                                                 .byte $e2,$20
                                                 .endm
                                        ;
                                        shorti   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        shortr   .macro
                                                 .byte $e2,$30
                                                 .endm
                                        ;
                                        shortx   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL MACROS
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The following macros execute terminal  control procedures  that  perform
                                        ;	such tasks as clearing the screen,  switching  between  normal & reverse
                                        ;	video, etc.  These macros are for WYSE 60 & compatible displays, such as
                                        ;	the WYSE 150, WYSE 160, WYSE 325 & WYSE GPT.   Only the functions needed
                                        ;	by Supermon 816 are included.
                                        ;
                                        ;	If your console is not WYSE 60 compatible, you will need to  edit  these
                                        ;	macros as required to control your particular console or terminal.  Note
                                        ;	that in some cases one macro may call another.  Exercise caution in your
                                        ;	edits to avoid introducing display bugs.
                                        ;
                                        ;	If your console display cannot execute one of these procedures,  such as
                                        ;	'CL' (clear to end of line), you will have to develop an alternative.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	clearing data...
                                        ;
                                        bs       .macro                ;destructive backspace
                                                 .byte a_bs
                                     +            .byte a_esc,"W"
                                        
                                                 .endm
                                        ;
                                        cl       .macro                ;clear to end of line 
                                                 .byte a_esc,"T"
                                                 .endm
                                        ;
                                        ;
                                        ;	cursor control...
                                        ;
                                        cn       .macro                ;cursor on
                                                 .byte a_esc,"`1"
                                                 .endm
                                        ;
                                        co       .macro                ;cursor off
                                                 .byte a_esc,"`0"
                                                 .endm
                                        ;
                                        cr       .macro                ;carriage return
                                                 .byte a_cr
                                                 .endm
                                        ;
                                        lf       .macro                ;carriage return/line feed
                                     +            .byte a_cr
                                        
                                                 .byte a_lf
                                                 .endm
                                        ;
                                        ;
                                        ;	display attributes...
                                        ;
                                        bf       .macro                ;reverse foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G4"
                                                 .endm
                                        ;
                                        er       .macro                ;enable normal foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        sf       .macro                ;set foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        ;
                                        ;	display editing...
                                        ;
                                        dcuc     .macro                ;delete char under cursor
                                                 .byte a_esc,"W"
                                                 .endm
                                        ;
                                        ;
                                        ;	miscellaneous control...
                                        ;
                                        rb       .macro                ;ring "bell"
                                                 .byte a_bel
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASCII CONTROL DEFINITIONS (menmonic order)
                                        ;
   1042 = 0000000000000007                            a_bel    =$07                  ;<BEL> alert/ring bell
   1043 = 0000000000000008                            a_bs     =$08                  ;<BS>  backspace
   1044 = 000000000000000D                            a_cr     =$0d                  ;<CR>  carriage return
   1045 = 000000000000007F                            a_del    =$7f                  ;<DEL> delete
   1046 = 000000000000001B                            a_esc    =$1b                  ;<ESC> escape
   1047 = 0000000000000009                            a_ht     =$09                  ;<HT>  horizontal tabulation
   1048 = 000000000000000A                            a_lf     =$0a                  ;<LF>  linefeed
                                        ;
                                        ;
                                        ;	miscellaneous (description order)...
                                        ;
   1053 = 20                            a_blank  =' '                  ;blank (whitespace)
   1054 = 7A                            a_asclch ='z'                  ;end of lowercase ASCII
   1055 = 000000000000005F                            a_lctouc =$5f                  ;LC to UC conversion mask
   1056 = 61                            a_asclcl ='a'                  ;start of lowercase ASCII
   1057 = 3A                            a_colon  =':'
                                        ;
                                        ;================================================================================
                                        ;
                                        ;GLOBAL ATOMIC CONSTANTS
                                        ;
                                        ;
                                        ;	data type sizes...
                                        ;
   1066 = 0000000000000001                            s_byte   =1                    ;byte
   1067 = 0000000000000002                            s_word   =2                    ;word (16 bits)
   1068 = 0000000000000003                            s_xword  =3                    ;extended word (24 bits)
   1069 = 0000000000000004                            s_dword  =4                    ;double word (32 bits)
   1070 = 0000000000000100                            s_rampag =$0100                ;65xx RAM page
                                        ;
                                        ;
                                        ;	data type sizes in bits...
                                        ;
   1075 = 0000000000000008                            s_bibyte =8                    ;byte
   1076 = 0000000000000004                            s_bnybbl =4                    ;nybble
                                        ;
                                        ;
                                        ;	miscellaneous...
                                        ;
   1081 = 000000000000002C                            bitabs   =$2c                  ;absolute BIT opcode
   1082 = 0000000000000024                            bitzp    =$24                  ;zero page BIT opcode
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S NATIVE MODE STATUS REGISTER DEFINITIONS
                                        ;
   1088 = 00000001                      s_mpudbx =s_byte               ;data bank size
   1089 = 00000002                      s_mpudpx =s_word               ;direct page size
   1090 = 00000001                      s_mpupbx =s_byte               ;program bank size
   1091 = 00000002                      s_mpupcx =s_word               ;program counter size
   1092 = 00000002                      s_mpuspx =s_word               ;stack pointer size
   1093 = 00000001                      s_mpusrx =s_byte               ;status size
                                        ;
                                        ;
                                        ;	status register flags...
                                        ;
   1098 = 0000000000000001                            sr_car   =%00000001            ;C
   1099 = 00000002                      sr_zer   =sr_car << 1          ;Z
   1100 = 00000004                      sr_irq   =sr_zer << 1          ;I
   1101 = 00000008                      sr_bdm   =sr_irq << 1          ;D
   1102 = 00000010                      sr_ixw   =sr_bdm << 1          ;x
   1103 = 00000020                      sr_amw   =sr_ixw << 1          ;m
   1104 = 00000040                      sr_ovl   =sr_amw << 1          ;V
   1105 = 00000080                      sr_neg   =sr_ovl << 1          ;N
   1106 = 00000100                      sr_16	 =sr_neg << 1
   1107 = 00000200                      sr_32    =sr_16 << 1
                                        ;
                                        ;	NVmxDIZC
                                        ;	xxxxxxxx
                                        ;	||||||||
                                        ;	|||||||+———> 1 = carry set/generated
                                        ;	||||||+————> 1 = result = zero
                                        ;	|||||+—————> 1 = IRQs ignored
                                        ;	||||+——————> 0 = binary arithmetic mode
                                        ;	||||         1 = decimal arithmetic mode
                                        ;	|||+———————> 0 = 16 bit index
                                        ;	|||          1 = 8 bit index
                                        ;	||+————————> 0 = 16 bit .A & memory
                                        ;	||           1 = 8 bit .A & memory
                                        ;	|+—————————> 1 = sign overflow
                                        ;	+——————————> 1 = result = negative
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"SIZE-OF" CONSTANTS
                                        ;
   1128 = 00000003                      s_addr   =s_xword              ;24 bit address
   1129 = 0000000000000020                            s_auxbuf =32                   ;auxiliary buffer
   1130 = 0000000000000050                            s_ibuf   =80                   ;input buffer
   1131 = 0000000000000003                            s_mnemon =3                    ;MPU ASCII mnemonic
   1132 = 0000000000000002                            s_mnepck =2                    ;MPU encoded mnemonic
   1133 = 0000000000000003                            s_mvinst =3                    ;MVN/MVP instruction
   1134 = 00000001                      s_opcode =s_byte               ;MPU opcode
   1135 = 00000003                      s_oper   =s_xword              ;operand
   1136 = 00000004                      s_pfac   =s_dword              ;primary math accumulator
   1137 = 00000006                      s_sfac   =s_dword+s_word       ;secondary math accumulators
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"NUMBER-OF" CONSTANTS
                                        ;
   1143 = 0000000000000015                            n_dbytes =21                   ;default disassembly bytes
   1144 = 0000000000000008                            n_dump   =8                    ;bytes per memory dump line
   1145 = 000000FF                      n_mbytes =s_rampag-1           ;default memory dump bytes
   1146 = 0000000000000008                            n_hccols =8                    ;compare/hunt display columns
   1147 = 00000009                      n_opcols =3*s_oper             ;disassembly operand columns
   1148 = 0000000000000004                            n_opslsr =4                    ;LSRs to extract instruction size
   1149 = 0000000000000005                            n_shfenc =5                    ;shifts to encode/decode mnemonic
                                        ;
                                        ;================================================================================
                                        ;
                                        ;NUMERIC CONVERSION CONSTANTS
                                        ;
   1155 = 0000000000000006                            a_hexdec ='A'-'9'-2            ;hex to decimal difference
   1156 = 25                            c_bin    ='%'                  ;binary prefix
   1157 = 2B                            c_dec    ='+'                  ;decimal prefix
   1158 = 24                            c_hex    ='$'                  ;hexadecimal prefix
   1159 = 40                            c_oct    ='@'                  ;octal prefix
   1160 = 66                            k_hex    ='f'                  ;hex ASCII conversion
   1161 = 00000020                      m_bits   =s_pfac*s_bibyte      ;operand bit size
   1162 = 00000030                      m_cbits  =s_sfac*s_bibyte      ;workspace bit size
   1163 = 000000000000000F                            bcdumask =%00001111            ;isolate BCD units mask
   1164 = 0000000000000030                            btoamask =%00110000            ;binary to ASCII mask
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER CONSTANTS
                                        ;
   1170 = 3F                            a_mnecvt ='?'                  ;encoded mnemonic conversion base
   1171 = 000000000000001F                            aimmaska =%00011111            ;.A immediate opcode test #1
   1172 = 0000000000000009                            aimmaskb =%00001001            ;.A immediate opcode test #2
   1173 = 41                            asmprfx  ='A'                  ;assemble code prefix
   1174 = 0000000000000009                            ascprmct =9                    ;assembler prompt "size-of"
   1175 = 2E                            disprfx  ='.'                  ;disassemble code prefix
   1176 = 00000000000000C0                            flimmask =%11000000            ;force long immediate flag
   1177 = 0000000000000054                            opc_mvn  =$54                  ;MVN opcode
   1178 = 0000000000000044                            opc_mvp  =$44                  ;MVP opcode
   1179 = 00000000000000C2                            opc_rep  =$c2                  ;REP opcode
   1180 = 00000000000000E2                            opc_sep  =$e2                  ;SEP opcode
   1181 = 00000030                      pfmxmask =sr_amw | sr_ixw      ;MPU m & x flag bits mask
                                        ;
                                        ;
                                        ;	assembler prompt buffer offsets...
                                        ;
   1186 = 00000002                      apadrbkh =s_word               ;instruction address bank MSN
   1187 = 00000003                      apadrbkl =apadrbkh+s_byte      ;instruction address bank LSN
   1188 = 00000004                      apadrmbh =apadrbkl+s_byte      ;instruction address MSB MSN
   1189 = 00000005                      apadrmbl =apadrmbh+s_byte      ;instruction address MSB LSN
   1190 = 00000006                      apadrlbh =apadrmbl+s_byte      ;instruction address LSB MSN
   1191 = 00000007                      apadrlbl =apadrlbh+s_byte      ;instruction address LSB LSN
                                        ;
                                        ;
                                        ;	addressing mode preamble symbols...
                                        ;
   1196 = 21                            amp_flim ='!'                  ;force long immediate
   1197 = 23                            amp_imm  ='#'                  ;immediate
   1198 = 28                            amp_ind  ='('                  ;indirect
   1199 = 5B                            amp_indl ='['                  ;indirect long
   1200 = 7B                            amp_indxl = '{'				   ;indirect extra long
                                        ;
                                        ;
                                        ;	addressing mode symbolic translation indices...
                                        ;
   1205 = 0000000000000000                            am_nam   =%0000                ;(0)  no symbol
   1206 = 0000000000000001                            am_imm   =%0001                ;(1)  #
   1207 = 0000000000000002                            am_adrx  =%0010                ;(2)  dp,X or addr,X
   1208 = 0000000000000003                            am_adry  =%0011                ;(3)  dp,Y or addr,Y
   1209 = 0000000000000004                            am_ind   =%0100                ;(4)  (dp) or (addr)
   1210 = 0000000000000005                            am_indl  =%0101                ;(5)  [dp] or [addr]
   1211 = 0000000000000006                            am_indly =%0110                ;(6)  [dp],Y
   1212 = 0000000000000007                            am_indx  =%0111                ;(7)  (dp,X) or (addr,X)
   1213 = 0000000000000008                            am_indy  =%1000                ;(8)  (dp),Y
   1214 = 0000000000000009                            am_stk   =%1001                ;(9)  offset,S
   1215 = 000000000000000A                            am_stky  =%1010                ;(10) (offset,S),Y
   1216 = 000000000000000B                            am_move  =%1011                ;(11) MVN/MVP sbnk,dbnk
   1217 = 000000000000000C                            am_indxly=%1100				   ;(12) {dp},Y
                                        ;
                                        ;
                                        ;	operand size translation indices...
                                        ;
   1222 = 0000000000000000                            ops0     =%0000 << 4           ;no operand
   1223 = 0000000000000010                            ops1     =%0001 << 4           ;8 bit operand
   1224 = 0000000000000020                            ops2     =%0010 << 4           ;16 bit operand
   1225 = 0000000000000030                            ops3     =%0011 << 4           ;24 bit operand
   1226 = 0000000000000050                            bop1     =%0101 << 4           ;8 bit relative branch
   1227 = 0000000000000060                            bop2     =%0110 << 4           ;16 bit relative branch
   1228 = 0000000000000090                            vops     =%1001 << 4           ;8, 16, or 32 bit operand
   1229 = 0000000000010100                            ops5	 =$1010 << 4		   ;32 bit operand
                                        ;
                                        ;
                                        ;	operand size & addressing mode extraction masks...
                                        ;
   1234 = 000000000000000F                            amodmask =%00001111            ;addressing mode index
   1235 = 0000000000000030                            opsmask  =%00110000            ;operand size
   1236 = 00000000000000C0                            vopsmask =%11000000            ;BOPx & VOPS flag bits
                                        ;
                                        ;
                                        ;	instruction mnemonic encoding...
                                        ;
   1241 = 0000000000002144                            mne_adc  =$2144                ;ADC
   1242 = 0000000000002BC4                            mne_and  =$2bc4                ;AND
   1243 = 0000000000006D04                            mne_asl  =$6d04                ;ASL
   1244 = 0000000000002106                            mne_bcc  =$2106                ;BCC
   1245 = 000000000000A106                            mne_bcs  =$a106                ;BCS
   1246 = 0000000000009186                            mne_beq  =$9186                ;BEQ
   1247 = 000000000000AA86                            mne_bit  =$aa86                ;BIT
   1248 = 0000000000005386                            mne_bmi  =$5386                ;BMI
   1249 = 00000000000033C6                            mne_bne  =$33c6                ;BNE
   1250 = 0000000000006C46                            mne_bpl  =$6c46                ;BPL
   1251 = 00000000000014C6                            mne_bra  =$14c6                ;BRA
   1252 = 00000000000064C6                            mne_brk  =$64c6                ;BRK
   1253 = 0000000000006CC6                            mne_brl  =$6cc6                ;BRL
   1254 = 00000000000025C6                            mne_bvc  =$25c6                ;BVC
   1255 = 000000000000A5C6                            mne_bvs  =$a5c6                ;BVS
   1256 = 0000000000002348                            mne_clc  =$2348                ;CLC
   1257 = 0000000000002B48                            mne_cld  =$2b48                ;CLD
   1258 = 0000000000005348                            mne_cli  =$5348                ;CLI
   1259 = 000000000000BB48                            mne_clv  =$bb48                ;CLV
   1260 = 0000000000008B88                            mne_cmp  =$8b88                ;CMP
   1261 = 0000000000008C08                            mne_cop  =$8c08                ;COP
   1262 = 000000000000CC48                            mne_cpx  =$cc48                ;CPX
   1263 = 000000000000D448                            mne_cpy  =$d448                ;CPY
   1264 = 000000000000218A                            mne_dec  =$218a                ;DEC
   1265 = 000000000000C98A                            mne_dex  =$c98a                ;DEX
   1266 = 000000000000D18A                            mne_dey  =$d18a                ;DEY
   1267 = 0000000000009C0C                            mne_eor  =$9c0c                ;EOR
   1268 = 00000000000023D4                            mne_inc  =$23d4                ;INC
   1269 = 000000000000CBD4                            mne_inx  =$cbd4                ;INX
   1270 = 000000000000D3D4                            mne_iny  =$d3d4                ;INY
   1271 = 0000000000006B96                            mne_jml  =$6b96                ;JML
   1272 = 0000000000008B96                            mne_jmp  =$8b96                ;JMP
   1273 = 0000000000006D16                            mne_jsl  =$6d16                ;JSL
   1274 = 0000000000009D16                            mne_jsr  =$9d16                ;JSR
   1275 = 000000000000115A                            mne_lda  =$115a                ;LDA
   1276 = 000000000000C95A                            mne_ldx  =$c95a                ;LDX
   1277 = 000000000000D15A                            mne_ldy  =$d15a                ;LDY
   1278 = 0000000000009D1A                            mne_lsr  =$9d1a                ;LSR
   1279 = 0000000000007DDC                            mne_mvn  =$7ddc                ;MVN
   1280 = 0000000000008DDC                            mne_mvp  =$8ddc                ;MVP
   1281 = 0000000000008C1E                            mne_nop  =$8c1e                ;NOP
   1282 = 00000000000014E0                            mne_ora  =$14e0                ;ORA
   1283 = 00000000000011A2                            mne_pea  =$11a2                ;PEA
   1284 = 00000000000051A2                            mne_pei  =$51a2                ;PEI
   1285 = 00000000000099A2                            mne_per  =$99a2                ;PER
   1286 = 0000000000001262                            mne_pha  =$1262                ;PHA
   1287 = 0000000000001A62                            mne_phb  =$1a62                ;PHB
   1288 = 0000000000002A62                            mne_phd  =$2a62                ;PHD
   1289 = 0000000000006262                            mne_phk  =$6262                ;PHK
   1290 = 0000000000008A62                            mne_php  =$8a62                ;PHP
   1291 = 000000000000CA62                            mne_phx  =$ca62                ;PHX
   1292 = 000000000000D262                            mne_phy  =$d262                ;PHY
   1293 = 0000000000001362                            mne_pla  =$1362                ;PLA
   1294 = 0000000000001B62                            mne_plb  =$1b62                ;PLB
   1295 = 0000000000002B62                            mne_pld  =$2b62                ;PLD
   1296 = 0000000000008B62                            mne_plp  =$8b62                ;PLP
   1297 = 000000000000CB62                            mne_plx  =$cb62                ;PLX
   1298 = 000000000000D362                            mne_ply  =$d362                ;PLY
   1299 = 00000000000089A6                            mne_rep  =$89a6                ;REP
   1300 = 0000000000006C26                            mne_rol  =$6c26                ;ROL
   1301 = 0000000000009C26                            mne_ror  =$9c26                ;ROR
   1302 = 0000000000005566                            mne_rti  =$5566                ;RTI
   1303 = 0000000000006D66                            mne_rtl  =$6d66                ;RTL
   1304 = 000000000000A566                            mne_rts  =$a566                ;RTS
   1305 = 00000000000020E8                            mne_sbc  =$20e8                ;SBC
   1306 = 00000000000021A8                            mne_sec  =$21a8                ;SEC
   1307 = 00000000000029A8                            mne_sed  =$29a8                ;SED
   1308 = 00000000000051A8                            mne_sei  =$51a8                ;SEI
   1309 = 00000000000089A8                            mne_sep  =$89a8                ;SEP
   1310 = 0000000000001568                            mne_sta  =$1568                ;STA
   1311 = 0000000000008D68                            mne_stp  =$8d68                ;STP
   1312 = 000000000000CD68                            mne_stx  =$cd68                ;STX
   1313 = 000000000000D568                            mne_sty  =$d568                ;STY
   1314 = 000000000000DD68                            mne_stz  =$dd68                ;STZ
   1315 = 000000000000C8AA                            mne_tax  =$c8aa                ;TAX
   1316 = 000000000000D0AA                            mne_tay  =$d0aa                ;TAY
   1317 = 000000000000292A                            mne_tcd  =$292a                ;TCD
   1318 = 000000000000A12A                            mne_tcs  =$a12a                ;TCS
   1319 = 000000000000216A                            mne_tdc  =$216a                ;TDC
   1320 = 0000000000001CEA                            mne_trb  =$1cea                ;TRB
   1321 = 0000000000001D2A                            mne_tsb  =$1d2a                ;TSB
   1322 = 000000000000252A                            mne_tsc  =$252a                ;TSC
   1323 = 000000000000CD2A                            mne_tsx  =$cd2a                ;TSX
   1324 = 000000000000166A                            mne_txa  =$166a                ;TXA
   1325 = 000000000000A66A                            mne_txs  =$a66a                ;TXS
   1326 = 000000000000D66A                            mne_txy  =$d66a                ;TXY
   1327 = 00000000000016AA                            mne_tya  =$16aa                ;TYA
   1328 = 000000000000CEAA                            mne_tyx  =$ceaa                ;TYX
   1329 = 00000000000050B0                            mne_wai  =$50b0                ;WAI
   1330 = 0000000000007170                            mne_wdm  =$7170                ;WDM
   1331 = 00000000000010F2                            mne_xba  =$10f2                ;XBA
   1332 = 0000000000003132                            mne_xce  =$3132                ;XCE
                                        ;
                                        ;
                                        ;	encoded instruction mnemonic indices...
                                        ;
   1337 = 0000000000000010                            mne_adcx =16                   ;ADC
   1338 = 000000000000001D                            mne_andx =29                   ;AND
   1339 = 000000000000002C                            mne_aslx =44                   ;ASL
   1340 = 000000000000000F                            mne_bccx =15                   ;BCC
   1341 = 0000000000000041                            mne_bcsx =65                   ;BCS
   1342 = 000000000000003B                            mne_beqx =59                   ;BEQ
   1343 = 0000000000000046                            mne_bitx =70                   ;BIT
   1344 = 0000000000000024                            mne_bmix =36                   ;BMI
   1345 = 000000000000001F                            mne_bnex =31                   ;BNE
   1346 = 000000000000002A                            mne_bplx =42                   ;BPL
   1347 = 0000000000000005                            mne_brax =5                    ;BRA
   1348 = 0000000000000027                            mne_brkx =39                   ;BRK
   1349 = 000000000000002B                            mne_brlx =43                   ;BRL
   1350 = 0000000000000017                            mne_bvcx =23                   ;BVC
   1351 = 0000000000000044                            mne_bvsx =68                   ;BVS
   1352 = 0000000000000014                            mne_clcx =20                   ;CLC
   1353 = 000000000000001B                            mne_cldx =27                   ;CLD
   1354 = 0000000000000023                            mne_clix =35                   ;CLI
   1355 = 0000000000000047                            mne_clvx =71                   ;CLV
   1356 = 0000000000000035                            mne_cmpx =53                   ;CMP
   1357 = 0000000000000037                            mne_copx =55                   ;COP
   1358 = 000000000000004E                            mne_cpxx =78                   ;CPX
   1359 = 0000000000000058                            mne_cpyx =88                   ;CPY
   1360 = 0000000000000012                            mne_decx =18                   ;DEC
   1361 = 000000000000004A                            mne_dexx =74                   ;DEX
   1362 = 0000000000000054                            mne_deyx =84                   ;DEY
   1363 = 000000000000003D                            mne_eorx =61                   ;EOR
   1364 = 0000000000000015                            mne_incx =21                   ;INC
   1365 = 000000000000004D                            mne_inxx =77                   ;INX
   1366 = 0000000000000057                            mne_inyx =87                   ;INY
   1367 = 0000000000000028                            mne_jmlx =40                   ;JML
   1368 = 0000000000000036                            mne_jmpx =54                   ;JMP
   1369 = 000000000000002D                            mne_jslx =45                   ;JSL
   1370 = 000000000000003F                            mne_jsrx =63                   ;JSR
   1371 = 0000000000000001                            mne_ldax =1                    ;LDA
   1372 = 0000000000000049                            mne_ldxx =73                   ;LDX
   1373 = 0000000000000053                            mne_ldyx =83                   ;LDY
   1374 = 0000000000000040                            mne_lsrx =64                   ;LSR
   1375 = 0000000000000030                            mne_mvnx =48                   ;MVN
   1376 = 000000000000003A                            mne_mvpx =58                   ;MVP
   1377 = 0000000000000038                            mne_nopx =56                   ;NOP
   1378 = 0000000000000006                            mne_orax =6                    ;ORA
   1379 = 0000000000000002                            mne_peax =2                    ;PEA
   1380 = 0000000000000021                            mne_peix =33                   ;PEI
   1381 = 000000000000003C                            mne_perx =60                   ;PER
   1382 = 0000000000000003                            mne_phax =3                    ;PHA
   1383 = 000000000000000A                            mne_phbx =10                   ;PHB
   1384 = 000000000000001A                            mne_phdx =26                   ;PHD
   1385 = 0000000000000026                            mne_phkx =38                   ;PHK
   1386 = 0000000000000033                            mne_phpx =51                   ;PHP
   1387 = 000000000000004B                            mne_phxx =75                   ;PHX
   1388 = 0000000000000055                            mne_phyx =85                   ;PHY
   1389 = 0000000000000004                            mne_plax =4                    ;PLA
   1390 = 000000000000000B                            mne_plbx =11                   ;PLB
   1391 = 000000000000001C                            mne_pldx =28                   ;PLD
   1392 = 0000000000000034                            mne_plpx =52                   ;PLP
   1393 = 000000000000004C                            mne_plxx =76                   ;PLX
   1394 = 0000000000000056                            mne_plyx =86                   ;PLY
   1395 = 0000000000000031                            mne_repx =49                   ;REP
   1396 = 0000000000000029                            mne_rolx =41                   ;ROL
   1397 = 000000000000003E                            mne_rorx =62                   ;ROR
   1398 = 0000000000000025                            mne_rtix =37                   ;RTI
   1399 = 000000000000002E                            mne_rtlx =46                   ;RTL
   1400 = 0000000000000043                            mne_rtsx =67                   ;RTS
   1401 = 000000000000000E                            mne_sbcx =14                   ;SBC
   1402 = 0000000000000013                            mne_secx =19                   ;SEC
   1403 = 0000000000000019                            mne_sedx =25                   ;SED
   1404 = 0000000000000022                            mne_seix =34                   ;SEI
   1405 = 0000000000000032                            mne_sepx =50                   ;SEP
   1406 = 0000000000000007                            mne_stax =7                    ;STA
   1407 = 0000000000000039                            mne_stpx =57                   ;STP
   1408 = 0000000000000050                            mne_stxx =80                   ;STX
   1409 = 0000000000000059                            mne_styx =89                   ;STY
   1410 = 000000000000005B                            mne_stzx =91                   ;STZ
   1411 = 0000000000000048                            mne_taxx =72                   ;TAX
   1412 = 0000000000000052                            mne_tayx =82                   ;TAY
   1413 = 0000000000000018                            mne_tcdx =24                   ;TCD
   1414 = 0000000000000042                            mne_tcsx =66                   ;TCS
   1415 = 0000000000000011                            mne_tdcx =17                   ;TDC
   1416 = 000000000000000C                            mne_trbx =12                   ;TRB
   1417 = 000000000000000D                            mne_tsbx =13                   ;TSB
   1418 = 0000000000000016                            mne_tscx =22                   ;TSC
   1419 = 000000000000004F                            mne_tsxx =79                   ;TSX
   1420 = 0000000000000008                            mne_txax =8                    ;TXA
   1421 = 0000000000000045                            mne_txsx =69                   ;TXS
   1422 = 000000000000005A                            mne_txyx =90                   ;TXY
   1423 = 0000000000000009                            mne_tyax =9                    ;TYA
   1424 = 0000000000000051                            mne_tyxx =81                   ;TYX
   1425 = 0000000000000020                            mne_waix =32                   ;WAI
   1426 = 000000000000002F                            mne_wdmx =47                   ;WDM
   1427 = 0000000000000000                            mne_xbax =0                    ;XBA
   1428 = 000000000000001E                            mne_xcex =30                   ;XCE
                                        ;
                                        ;================================================================================
                                        ;
                                        ;MISCELLANEOUS CONSTANTS
                                        ;
   1434 = 0000000000000004                            halftab  =4                    ;1/2 tabulation spacing
   1435 = 3E                            memprfx  ='>'                  ;memory dump prefix
   1436 = 3A                            memsepch =':'                  ;memory dump separator
   1437 = 2E                            memsubch ='.'                  ;memory dump non-print char
   1438 = 0000000000000030                            srinit   =%00110000            ;SR initialization value
                                        ;
                                        ;================================================================================
                                        ;
                                        ;DIRECT PAGE STORAGE
                                        ;
   1444 = 00000080                      reg_csx  =zeropage			;CS
   1445 = 00000082                      reg_dsx  =reg_csx + 2		;DS
   1446 = 00000084                      reg_ssx  =reg_dsx + 2		;SS
   1447 = 00000086                      reg_pcx  =reg_ssx + 2	    ;PC
   1448 = 00000088                      reg_pbx  =reg_pcx + 2       ;PB
   1449 = 00000089                      reg_ax   =reg_pbx + 1       ;.C
   1450 = 0000008D                      reg_xx   =reg_ax + 4        ;.X
   1451 = 00000091                      reg_yx   =reg_xx + 4        ;.Y
   1452 = 00000095                      reg_spx  =reg_yx + 4        ;SP
   1453 = 00000099                      reg_srx  =reg_spx + 4       ;SR
   1454 = 0000009A                      reg_srxx =reg_srx + 1       ;SRX
   1455 = 0000009B                      reg_dbx  =reg_srxx + 1      ;DB
   1456 = 0000009C                      reg_dpx  =reg_dbx + 1       ;DP
                                        ;
                                        ;
                                        ;	general workspace...
                                        ;
   1461 = 000000A0                      addra    =reg_dpx+4            ;address #1
   1462 = 000000A4                      addrb    =addra+4              ;address #2
   1463 = 000000A7                      faca     =addrb+s_addr         ;primary accumulator
   1464 = 000000AB                      facax    =faca+s_pfac          ;extended primary accumulator
   1465 = 000000AF                      facb     =facax+s_pfac         ;secondary accumulator
   1466 = 000000B5                      facc     =facb+s_sfac          ;tertiary accumulator
   1467 = 000000BB                      operand  =facc+s_sfac          ;instruction operand
   1468 = 000000BE                      auxbufix =operand+s_oper       ;auxiliary buffer index
   1469 = 000000BF                      ibufidx  =auxbufix+s_byte      ;input buffer index
   1470 = 000000C0                      bitsdig  =ibufidx+s_byte       ;bits per numeral
   1471 = 000000C1                      numeral  =bitsdig+s_byte       ;numeral buffer
   1472 = 000000C2                      radix    =numeral+s_byte       ;radix index
   1473 = 000000C3                      admodidx =radix+s_byte         ;addressing mode index
   1474 = 000000C4                      charcnt  =admodidx+s_byte      ;character counter
   1475 = 000000C6                      instsize =charcnt+s_word       ;instruction size
   1476 = 000000C8                      mnepck   =instsize+s_word      ;encoded mnemonic
   1477 = 000000CA                      opcode   =mnepck+s_mnepck      ;current opcode
   1478 = 000000CB                      status   =opcode+s_byte        ;I/O status flag
   1479 = 000000CC                      xrtemp   =status+s_byte        ;temp .X storage
   1480 = 000000CD                      eopsize  =xrtemp+s_byte        ;entered operand size
   1481 = 000000CE                      flimflag =eopsize+s_byte       ;forced long immediate...
                                        ;
                                        ;	xx000000
                                        ;	||
                                        ;	|+—————————> 0: .X/.Y = 8 bits
                                        ;	|            1: .X/.Y = 16 bits
                                        ;	+——————————> 0: .A = 8 bits
                                        ;	             1: .A = 16 bits
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	During assembly, FLIMFLAG indicates the operand size used with an immed-
                                        ;	iate mode instruction, thus causing the following disassembly to display
                                        ;	the assembled  operand size.   During disassembly,  FLIMFLAG will mirror
                                        ;	the effect of the most recent REP or SEP instruction.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1497 = 000000CF                      iopsize  =flimflag+s_byte      ;operand size
   1498 = 000000D0                      range    =iopsize+s_byte       ;allowable radix range
   1499 = 000000D1                      vopsflag =range+s_byte         ;VOPS & ROPS mode bits
                                        ;
                                        ;
                                        ;	copy/fill workspace (overlaps some of the above)...
                                        ;
   1504 = 000000D2                      mcftwork =vopsflag+s_byte	;faca                 ;start of copy/fill code
   1505 = 000000D3                      mcftopc  =mcftwork+s_byte      ;instruction opcode
   1506 = 000000D4                      mcftbnk  =mcftopc+s_byte       ;banks
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SUPERMON 816 JUMP TABLE
                                        ;
                                                 org	_origin_
                                        ;
   1515 8000                            		 MEM	8
   1516 8000                            		 NDX	8
                                        		 CPU	W65C02
   1518 8000 80 02                      JMON     bra mon               ;cold start entry
   1519 8002 80 3E                      JMONBRK  bra monbrk            ;software interrupt intercept
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mon: SUPERMON 816 COLD START
                                        ;
   1525 8004 C2 20                      mon +         .byte $c2,$20
                                        
   1526 8006 AD 02 01                             lda vecbrki           ;BRK vector
   1527 8009 C9 42                    +            cmp #<monbrk
   1527 800B 80                       +            .byte >monbrk
                                        ;pointing at monitor?
   1528 800C D0 03                                bne .2            ;yes, ignore cold start
   1529 800E 4C 7F 80                             jmp	monreg			; got a branch out of range here when debugging code
                                        								; was included
   1531 8011                            .2
                                        ;
   1533 8011 8D 05 01                             sta vecbrkia          ;save vector for exit
   1534 8014 A9 42                    +            lda #<monbrk
   1534 8016 80                       +            .byte >monbrk
                                        ;Supermon 816 intercepts...
   1535 8017 8D 02 01                             sta vecbrki           ;BRK handler
   1536 801A E2 30                    +            .byte $e2,$30
                                                        ;8 bit registers
   1537 801C A2 49                                ldx #vopsflag-reg_pbx
                                        ;
   1539 801E 74 88                      .0000010 stz reg_pbx,x         ;clear DP storage
   1540 8020 CA                                   dex
   1541 8021 10 FB                                bpl .0000010
                                        ;
   1543 8023 A9 30                                lda #srinit
   1544 8025 85 99                                sta reg_srx           ;status register
   1545 8027 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   1546 8029 A9 FF                    +            lda #<hwstack
   1546 802B 3F                       +            .byte >hwstack
                                        ;top of hardware stack
   1547 802C 1B                       +            .byte $1b
                                                           ;set SP
   1548 802D 7B                       +            .byte $7b
                                                           ;get & save...
   1549 802E 85 9C                                sta reg_dpx           ;DP register
   1550 8030 A9 00                    +            lda #<0
   1550 8032 00                       +            .byte >0
                                        
   1551 8033 E2 20                    +            .byte $e2,$20
                                        
   1552 8035 4B                       +            .byte $4b
                                        
   1553 8036 68                                   pla                   ;capture PB &...
   1554 8037 85 88                                sta reg_pbx           ;set
   1555 8039 8B                       +            .byte $8b
                                        
   1556 803A 68                                   pla                   ;capture DB &...
   1557 803B 85 9B                                sta reg_dbx           ;set
   1558 803D F4                       +            .byte $f4
   1558 803E 34 90                    +            .word mm_entry
                                        ;"...ready..."
   1559 8040 80 30                                bra moncom
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monbrk: SOFTWARE INTERRUPT INTERCEPT
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This is the entry point taken when a BRK instruction is executed.  It is
                                        ;	assumed that the BRK  handler has pushed the registers to the stack that
                                        ;	are not automatically pushed by the MPU in response to BRK.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1571 8042 58                         monbrk   cli                   ;reenable IRQs
   1572 8043                            		 phds
   1573 8043 68                          		 pla
   1574 8044 85 82                       		 sta reg_dsx
                                           		 CPU	FT832
   1576 008046 42 7A                        		 tssa
   1577 008048 85 84                        		 sta	reg_ssx
                                        		 CPU	W65C02
   1579 804A 7A                                   ply                   ;recover registers
   1580 804B FA                                   plx
   1581 804C 68                                   pla
   1582 804D C2 30                    +            .byte $c2,$30
                                                         ;store 16 bit registers
   1583 804F 85 89                                sta reg_ax            ;.A
   1584 8051 86 8D                                stx reg_xx            ;.X
   1585 8053 84 91                                sty reg_yx            ;.Y
   1586 8055 E2 10                    +            .byte $e2,$10
                                                        ;8 bit index registers
   1587 8057 68                                   pla                   ;get DP &...
   1588 8058 85 9C                                sta reg_dpx           ;store
   1589 805A FA                                   plx                   ;get DB &...
   1590 805B 86 9B                                stx reg_dbx           ;store
   1591 805D FA                                   plx                   ;get SR &...
   1592 805E 86 99                                stx reg_srx           ;store
   1593 8060 68                                   pla                   ;get PC &...
   1594 8061 85 86                                sta reg_pcx           ;store
   1595 8063 E2 20                    +            .byte $e2,$20
                                        
   1596 8065 68                                   pla                   ;get PB &...
   1597 8066 85 88                                sta reg_pbx           ;store
   1598 8068 C2 20                    +            .byte $c2,$20
                                        
   1599 806A 68                          		 pla				   ; get CS &...
   1600 806B 85 80                       		 sta	reg_csx		   ; store
   1601 806D E2 20                    +            .byte $e2,$20
                                        
   1602 806F F4                       +            .byte $f4
   1602 8070 29 90                    +            .word mm_brk
                                        ;"*BRK"
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncom: COMMON ENTRY POINT
                                        ;
                                        ;	——————————————————————————————————————
                                        ;	DO NOT directly call this entry point!
                                        ;	——————————————————————————————————————
                                        ;
   1612 8072                            moncom   
   1613 8072 20 1D 88                    		 jsr sprint            ;print heading
   1614 8075 C2 20                    +            .byte $c2,$20
                                        
   1615 8077 3B                       +            .byte $3b
                                                           ;get SP &...
   1616 8078 85 95                                sta reg_spx           ;store
   1617 807A C2 FF                    +            .byte $c2,%11111111
                                        ;clear SR &...
   1618 807C E2 30                    +            .byte $e2,srinit
                                        ;set default state
   1619 807E 38                                   sec                   ;see next
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monreg: DISPLAY MPU REGISTERS
                                        ;
                                        ;	—————————
                                        ;	syntax: R
                                        ;	—————————
                                        ;
   1629 807F B0 03                      monreg   bcs .0000010          ;okay to proceed
                                        ;
   1631 8081 4C 65 81                             jmp monerr            ;error if called with a parm
                                        ;
   1633 8084 F4                         .0000010 +         .byte $f4
   1633 8085 5F 90                    +            .word mm_regs
                                        
   1634 8087 20 1D 88                             jsr sprint            ;display heading
                                        ;
                                        ;
                                        ;	display code selector & program bank & counter...
                                        ;
   1639 808A C2 20                    +            .byte $c2,$20
                                        
   1640 808C A5 80                       		 lda	reg_csx
   1641 808E E2 20                    +            .byte $e2,$20
                                        
   1642 8090 20 D7 87                    		 jsr    dpyhexw
   1643 8093 E2 20                    +            .byte $e2,$20
                                        
   1644 8095 A9 3A                       		 lda #a_colon
   1645 8097 20 17 88                             jsr printcmn          ;':'
   1646 809A A5 88                                lda reg_pbx           ;PB
   1647 809C 20 E7 87                             jsr dpyhex            ;display as hex ASCII
   1648 809F 20 15 88                             jsr printspc          ;inter-field space
   1649 80A2 C2 20                    +            .byte $c2,$20
                                        
   1650 80A4 A5 86                                lda reg_pcx
   1651 80A6 E2 20                    +            .byte $e2,$20
                                        
   1652 80A8 20 D7 87                             jsr dpyhexw           ;display PC
   1653 80AB A2 02                                ldx #2
   1654 80AD 20 F6 87                             jsr multspc           ;inter-field spacing
                                        ;
                                        ;
                                        ;	display SR in bitwise fashion...
                                        ;
   1659 80B0 A5 9A                       		 lda reg_srxx
   1660 80B2 4A                          		 lsr
   1661 80B3 4A                          		 lsr
   1662 80B4 69 30                       		 adc #'0'
                                           		 cpu FT832
   1664 0080B6 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1666 80BB A5 9A                       		 lda reg_srxx
   1667 80BD 4A                          		 lsr
   1668 80BE 69 30                       		 adc #'0'
                                           		 cpu FT832
   1670 0080C0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        
   1673 80C5 A6 99                                ldx reg_srx           ;SR
   1674 80C7 A0 08                                ldy #s_bibyte         ;bits in a byte
                                        ;
   1676 80C9 8A                         .0000020 txa                   ;remaining SR bits
   1677 80CA 0A                                   asl                   ;grab one of them
   1678 80CB AA                                   tax                   ;save remainder
   1679 80CC A9 30                                lda #'0'              ;a clear bit but...
   1680 80CE 69 00                                adc #0                ;adjust if set &...
                                           		 cpu FT832
   1682 0080D0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1684 80D5 88                                   dey                   ;bit processed
   1685 80D6 D0 F1                                bne .0000020          ;do another
                                        ;
                                        ;
                                        ;	display .C, .X, .Y, SP & DP...
                                        ;
   1690 80D8 20 15 88                   .0000030 jsr printspc          ;spacing
   1691 80DB C2 20                    +            .byte $c2,$20
                                        
   1692 80DD B9 8B 00                             lda reg_ax+2,y        ;get register value
   1693 80E0 E2 20                    +            .byte $e2,$20
                                        
   1694 80E2 20 D7 87                             jsr dpyhexw           ;convert & display
   1695 80E5 C2 20                    +            .byte $c2,$20
                                        
   1696 80E7 B9 89 00                             lda reg_ax,y          ;get register value
   1697 80EA E2 20                    +            .byte $e2,$20
                                        
   1698 80EC 20 D7 87                             jsr dpyhexw           ;convert & display
                                        ;         .rept s_word
   1700 80EF C8                                     iny
   1701 80F0 C8                                     iny
                                        ;         .endr
                                        ;         .rept s_word
   1704 80F1 C8                                     iny
   1705 80F2 C8                                     iny
                                        ;         .endr
   1707 80F3 C0 0F                                cpy #reg_spx-reg_ax+3
   1708 80F5 90 E1                                bcc .0000030          ;next
                                        ;
                                        ;
                                        ;	display DS SS DB...
                                        ;
   1713 80F7 F4                       +            .byte $f4
   1713 80F8 BB 90                    +            .word mm_regs2
                                        
   1714 80FA 20 1D 88                    		 jsr sprint
   1715 80FD C2 20                    +            .byte $c2,$20
                                        
   1716 80FF A5 82                                lda reg_dsx          ;get DS &...
   1717 8101 E2 20                    +            .byte $e2,$20
                                        
   1718 8103 20 D7 87                             jsr dpyhexw           ;convert & display
   1719 8106 20 15 88                             jsr printspc          ;more spacing
   1720 8109 C2 20                    +            .byte $c2,$20
                                        
   1721 810B A5 84                                lda reg_ssx           ;get SS &...
   1722 810D E2 20                    +            .byte $e2,$20
                                        
   1723 810F 20 D7 87                             jsr dpyhexw           ;convert & display
   1724 8112 20 15 88                             jsr printspc          ;more spacing
   1725 8115 A5 9B                                lda reg_dbx           ;get DB &...
   1726 8117 20 E7 87                             jsr dpyhex            ;display it
   1727 811A 20 15 88                             jsr printspc          ;more spacing
   1728 811D C2 20                    +            .byte $c2,$20
                                        
   1729 811F A5 9C                                lda reg_dpx           ;get DPR &...
   1730 8121 E2 20                    +            .byte $e2,$20
                                        
   1731 8123 20 D7 87                             jsr dpyhexw           ;convert & display
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monce: COMMAND EXECUTIVE
                                        ;	
   1737 8126 E2 20                      monce +         .byte $e2,$20
                                        
   1738 8128 A9 00                                lda #0                ;default buffer index
                                        ;
   1740 812A E2 30                      moncea +         .byte $e2,$30
                                                        ;alternate entry point
   1741 812C 85 BF                                sta ibufidx           ;(re)set buffer index
   1742 812E F4                       +            .byte $f4
   1742 812F 56 90                    +            .word mm_prmpt
                                        
   1743 8131 20 1D 88                             jsr sprint            ;display input prompt
   1744 8134 20 3F 8C                             jsr input             ;await some input
                                        ;
   1746 8137                            .0000010:
   1747 8137 20 A1 8C                    		jsr getcharc          ;read from buffer
   1748 813A F0 EA                                beq monce             ;terminator, just loop
                                        ;
   1750 813C C9 20                                cmp #a_blank
   1751 813E F0 F7                                beq .0000010          ;strip leading blanks
                                        ;
   1753 8140 A2 0C                                ldx #n_mpctab-1       ;number of primary commands
                                        ;
   1755 8142 DD BB 8C                   .0000020 cmp mpctab,x          ;search primary command list
   1756 8145 D0 0E                                bne .0000030
                                        ;
   1758 8147 8A                                   txa                   ;get index
   1759 8148 0A                                   asl                   ;double for offset
   1760 8149 AA                                   tax
   1761 814A C2 20                    +            .byte $c2,$20
                                        
   1762 814C BD C8 8C                             lda mpcextab,x        ;command address -1
   1763 814F 48                                   pha                   ;prime the stack
   1764 8150 E2 20                    +            .byte $e2,$20
                                        
   1765 8152 4C E3 8A                             jmp getparm           ;evaluate parm & execute command
                                        ;
   1767 8155 CA                         .0000030 dex
   1768 8156 10 EA                                bpl .0000020          ;continue searching primary commands
                                        ;
   1770 8158 A2 03                                ldx #n_radix-1        ;number of radices
                                        ;
   1772 815A DD F6 8C                   .0000040 cmp radxtab,x         ;search conversion command list
   1773 815D D0 03                                bne .0000050
                                        ;
   1775 815F 4C AF 85                             jmp monenv            ;convert & display parameter
                                        ;
   1777 8162 CA                         .0000050 dex
   1778 8163 10 F5                                bpl .0000040
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monerr: COMMON ERROR HANDLER
                                        ;
   1784 8165 E2 30                      monerr +         .byte $e2,$30
                                                        ;8 bit registers
                                        ;
   1786 8167 20 BE 87                   monerraa jsr dpyerr            ;indicate an error &...
   1787 816A 80 BA                                bra monce             ;return to input loop
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monasc: ASSEMBLE CODE
                                        ;
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;	syntax: A <addr> <mnemonic> [<argument>]
                                        ;
                                        ;	After a line of code has been successfully assembled it will be disass-
                                        ;	embled & displayed,  & the monitor will prompt with the next address to
                                        ;	which code may be assembled.
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;
   1801 816C 90 03                      monasc   bcc .0000020          ;assembly address entered
                                        ;
   1803 816E 4C 65 81                   .0000010 jmp monerr            ;terminate w/error
                                        ;
                                        ;
                                        ;	evaluate assembly address...
                                        ;
   1808 8171 20 CF 8A                   .0000020 jsr facasize          ;check address...
   1809 8174 C9 04                                cmp #s_dword          ;range
   1810 8176 B0 F6                                bcs .0000010          ;out of range — error
                                        ;
   1812 8178 20 B1 8A                             jsr facaddra          ;store assembly address
                                        ;
                                        ;
                                        ;	initialize workspace...
                                        ;
   1817 817B A2 1F                                ldx #s_auxbuf-s_byte
                                        ;
   1819 817D 9E 51 02                   .0000030 stz auxbuf,x          ;clear addressing mode buffer
   1820 8180 CA                                   dex
   1821 8181 D0 FA                                bne .0000030
                                        ;
   1823 8183 A9 20                                lda #a_blank
   1824 8185 8D 51 02                             sta auxbuf            ;preamble placeholder
   1825 8188 20 1E 8A                             jsr clroper           ;clear operand
   1826 818B 64 BE                                stz auxbufix          ;reset addressing mode index
   1827 818D 64 CE                                stz flimflag          ;clear forced long immediate
   1828 818F 64 C8                                stz mnepck            ;clear encoded...
   1829 8191 64 C9                                stz mnepck+s_byte     ;mnemonic workspace
   1830 8193 64 D1                                stz vopsflag          ;clear 8/16 or relative flag
                                        ;
                                        ;
                                        ;	encode mnemonic...
                                        ;
   1835 8195 A0 03                                ldy #s_mnemon         ;expected mnemonic size
                                        ;
   1837 8197 20 30 8C                   .0000040 jsr getcharw          ;get from buffer wo/whitespace
   1838 819A D0 0A                                bne .0000060          ;gotten
                                        ;
   1840 819C C0 03                                cpy #s_mnemon         ;any input at all?
   1841 819E 90 03                                bcc .0000050          ;yes
                                        ;
   1843 81A0 4C 26 81                             jmp monce             ;no, abort further assembly
                                        ;
   1845 81A3 4C 45 83                   .0000050 jmp monasc10          ;incomplete mnemonic — error
                                        ;
   1847 81A6 38                         .0000060 sec
   1848 81A7 E9 3F                                sbc #a_mnecvt         ;ASCII to binary factor
   1849 81A9 A2 05                                ldx #n_shfenc         ;shifts required to encode
                                        ;
   1851 81AB 4A                         .0000070 lsr                   ;shift out a bit...
   1852 81AC 66 C9                                ror mnepck+s_byte     ;into...
   1853 81AE 66 C8                                ror mnepck            ;encoded mnemonic
   1854 81B0 CA                                   dex
   1855 81B1 D0 F8                                bne .0000070          ;next bit
                                        ;
   1857 81B3 88                                   dey
   1858 81B4 D0 E1                                bne .0000040          ;get next char
                                        ;
                                        ;
                                        ;	test for copy instruction...
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The MVN & MVP instructions accept two operands & hence have an irregular
                                        ;	syntax.  Therefore, special handling is necessary to assemble either of
                                        ;	these instructions.
                                        ;
                                        ;	The official WDC syntax has the programmer entering a pair of 24 bit ad-
                                        ;	dresses as operands, with the assembler isolating bits 16-23 to	use as
                                        ;	operands.  This formality has been dispensed with in this monitor & the
                                        ;	operands are expected to be 8 bit bank values.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1873 81B6 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   1874 81B8 A5 C8                                lda mnepck            ;packed menmonic
   1875 81BA A2 54                                ldx #opc_mvn          ;MVN opcode
   1876 81BC C9 DC                    +            cmp #<mne_mvn
   1876 81BE 7D                       +            .byte >mne_mvn
                                        ;is it MVN?
   1877 81BF F0 07                                beq monasc01          ;yes
                                        ;
   1879 81C1 A2 44                                ldx #opc_mvp          ;MVP opcode
   1880 81C3 C9 DC                    +            cmp #<mne_mvp
   1880 81C5 8D                       +            .byte >mne_mvp
                                        ;is it MVP?
   1881 81C6 D0 30                                bne monasc02          ;no
                                        ;
                                        ;
                                        ;	assemble copy instruction...
                                        ;
   1886 81C8 86 CA                      monasc01 stx opcode            ;store relevant opcode
   1887 81CA E2 20                    +            .byte $e2,$20
                                        
   1888 81CC 20 3F 8B                             jsr instdata          ;get instruction data
   1889 81CF 86 CD                                stx eopsize           ;effective operand size
   1890 81D1 E8                                   inx
   1891 81D2 86 C6                                stx instsize          ;instruction size
   1892 81D4 A2 01                                ldx #s_oper-s_word    ;operand index
   1893 81D6 86 CC                                stx xrtemp            ;set it
                                        ;
   1895 81D8 20 38 88                   .0000010 jsr ascbin            ;evaluate bank number
   1896 81DB B0 50                                bcs monasc04          ;conversion error
                                        ;
   1898 81DD F0 4E                                beq monasc04          ;nothing returned — error
                                        ;
   1900 81DF 20 CF 8A                             jsr facasize          ;bank must be...
   1901 81E2 C9 02                                cmp #s_word           ;8 bits
   1902 81E4 B0 47                                bcs monasc04          ;it isn't — error
                                        ;
   1904 81E6 A5 A7                                lda faca              ;bank
   1905 81E8 A6 CC                                ldx xrtemp            ;operand index
   1906 81EA 95 BB                                sta operand,x         ;store
   1907 81EC C6 CC                                dec xrtemp            ;index=index-1
   1908 81EE 10 E8                                bpl .0000010          ;get destination bank
                                        ;
   1910 81F0 20 D0 8B                             jsr getcharr          ;should be no more input
   1911 81F3 D0 38                                bne monasc04          ;there is — error
                                        ;
   1913 81F5 4C F3 82                             jmp monasc08          ;finish MVN/MVP assembly 
                                        ;
                                        ;
                                        ;	continue with normal assembly...
                                        ;
   1918 81F8 E2 20                      monasc02 +         .byte $e2,$20
                                                        ;back to 8 bits
                                        ;
   1920 81FA 20 30 8C                   monasc03 jsr getcharw          ;get next char
   1921 81FD F0 3D                                beq monasc06          ;EOI, no argument
                                        ;
   1923 81FF C9 21                                cmp #amp_flim
   1924 8201 D0 0A                                bne .0000010          ;no forced long immediate
                                        ;
   1926 8203 A5 CE                                lda flimflag          ;FLIM already set?
   1927 8205 D0 26                                bne monasc04          ;yes — error
                                        ;
   1929 8207 A9 C0                                lda #flimmask
   1930 8209 85 CE                                sta flimflag          ;set flag &...
   1931 820B 80 ED                                bra monasc03          ;get next char
                                        ;
   1933 820D C9 23                      .0000010 cmp #amp_imm          ;immediate mode?
   1934 820F F0 08                                beq .0000020          ;yes
                                        ;
   1936 8211 C9 28                                cmp #amp_ind          ;indirect mode?
   1937 8213 F0 04                                beq .0000020          ;yes
                                        ;
   1939 8215 C9 5B                                cmp #amp_indl         ;indirect long mode?
   1940 8217 D0 07                                bne .0000030          ;no
                                        ;
   1942 8219 8D 51 02                   .0000020 sta auxbuf            ;set addressing mode preamble
   1943 821C E6 BE                                inc auxbufix          ;bump aux buffer index &...
   1944 821E 80 02                                bra .0000040          ;evaluate operand
                                        ;
   1946 8220 C6 BF                      .0000030 dec ibufidx           ;position back to char
                                        ;
   1948 8222 20 38 88                   .0000040 jsr ascbin            ;evaluate operand
   1949 8225 D0 09                                bne monasc05          ;evaluated
                                        ;
   1951 8227 B0 04                                bcs monasc04          ;conversion error
                                        ;
   1953 8229 A5 BE                                lda auxbufix          ;no operand...any preamble?
   1954 822B F0 0F                                beq monasc06          ;no, syntax is okay so far
                                        ;
   1956 822D 4C 45 83                   monasc04 jmp monasc10          ;abort w/error
                                        ;
   1958 8230 20 CF 8A                   monasc05 jsr facasize          ;size operand
   1959 8233 C9 04                                cmp #s_dword          ;max is 24 bits
   1960 8235 B0 F6                                bcs monasc04          ;too big
                                        ;
   1962 8237 85 CD                                sta eopsize           ;save operand size
   1963 8239 20 C5 8A                             jsr facaoper          ;store operand
                                        ;
   1965 823C C6 BF                      monasc06 dec ibufidx           ;back to last char
   1966 823E A6 BE                                ldx auxbufix          ;mode buffer index
   1967 8240 D0 01                                bne .0000010          ;preamble in buffer
                                        ;
   1969 8242 E8                                   inx                   ;step past preamble position
                                        ;
   1971 8243 20 A1 8C                   .0000010 jsr getcharc          ;get a char w/forced UC
   1972 8246 F0 0A                                beq .0000030          ;EOI
                                        ;
   1974 8248 E0 20                                cpx #s_auxbuf         ;mode buffer full?
   1975 824A B0 E1                                bcs monasc04          ;yes, too much input
                                        ;
   1977 824C 9D 51 02                   .0000020 sta auxbuf,x          ;store for comparison
   1978 824F E8                                   inx
   1979 8250 D0 F1                                bne .0000010
                                        ;
                                        ;
                                        ;	evaluate mnemonic...
                                        ;
   1984 8252 A2 5B                      .0000030 ldx #n_mnemon-1       ;starting mnemonic index
                                        ;
   1986 8254 8A                         monasc07 txa                   ;convert index...
   1987 8255 0A                                   asl                   ;to offset
   1988 8256 A8                                   tay                   ;now mnemonic table index
   1989 8257 C2 20                    +            .byte $c2,$20
                                                         ;16 bit compare
   1990 8259 B9 03 8D                             lda mnetab,y          ;get mnemonic from table
   1991 825C C5 C8                                cmp mnepck            ;compare to entered mnemonic
   1992 825E E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   1993 8260 F0 05                                beq .0000020          ;match
                                        ;
   1995 8262 CA                         .0000010 dex                   ;try next mnemonic
   1996 8263 30 C8                                bmi monasc04          ;unknown mnemonic — error
                                        ;
   1998 8265 80 ED                                bra monasc07          ;keep going
                                        ;
   2000 8267 86 C8                      .0000020 stx mnepck            ;save mnemonic index
   2001 8269 8A                                   txa
   2002 826A A2 00                                ldx #0                ;trial opcode
                                        ;
   2004 826C DD BB 8D                   .0000030 cmp mnetabix,x        ;search index table...
   2005 826F F0 05                                beq .0000050          ;for a match
                                        ;
   2007 8271 E8                         .0000040 inx                   ;keep going until we...
   2008 8272 D0 F8                                bne .0000030          ;search entire table
                                        ;
   2010 8274 80 B7                                bra monasc04          ;this shouldn't happen!
                                        ;
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;	If the mnemonic index table search fails then there is a coding error
                                        ;	somewhere, as every entry in the mnemonic table is supposed to have a
                                        ;	matching cardinal index.
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	evaluate addressing mode...
                                        ;
   2021 8276 86 CA                      .0000050 stx opcode            ;save trial opcode
   2022 8278 20 3F 8B                             jsr instdata          ;get related instruction data
   2023 827B 85 D1                                sta vopsflag          ;save 8/16 or relative flag
   2024 827D 86 CF                                stx iopsize           ;operand size
   2025 827F E8                                   inx
   2026 8280 86 C6                                stx instsize          ;instruction size
   2027 8282 A6 CA                                ldx opcode            ;recover trial opcode
   2028 8284 98                                   tya                   ;addressing mode
   2029 8285 0A                                   asl                   ;create table index
   2030 8286 A8                                   tay
   2031 8287 C2 20                    +            .byte $c2,$20
                                        
   2032 8289 B9 BF 8F                             lda ms_lutab,y        ;mode lookup table
   2033 828C 85 A4                                sta addrb             ;set pointer
   2034 828E E2 20                    +            .byte $e2,$20
                                        
   2035 8290 A0 00                                ldy #0
                                        ;
   2037 8292 B1 A4                      .0000060 lda (addrb),y         ;table addressing mode
   2038 8294 D9 51 02                             cmp auxbuf,y          ;entered addressing mode
   2039 8297 F0 04                                beq .0000080          ;okay so far
                                        ;
   2041 8299 A5 C8                      .0000070 lda mnepck            ;reload mnemonic index        
   2042 829B 80 D4                                bra .0000040          ;wrong opcode for addresing mode
                                        ;
   2044 829D 09 00                      .0000080 ora #0                ;last char the terminator?
   2045 829F F0 03                                beq .0000090          ;yes, evaluate operand
                                        ;
   2047 82A1 C8                                   iny
   2048 82A2 80 EE                                bra .0000060          ;keep testing
                                        ;
                                        ;
                                        ;	evaluate operand...
                                        ;
   2053 82A4 A5 CD                      .0000090 lda eopsize           ;entered operand size
   2054 82A6 D0 06                                bne .0000100          ;non-zero
                                        ;
   2056 82A8 05 CF                                ora iopsize           ;instruction operand size
   2057 82AA D0 ED                                bne .0000070          ;wrong opcode — keep trying
                                        ;
   2059 82AC 80 45                                bra monasc08          ;assemble instruction
                                        ;
   2061 82AE 24 D1                      .0000100 bit vopsflag          ;is this a branch?
   2062 82B0 70 3A                                bvs .0000160          ;yes, evaluate
                                        ;
   2064 82B2 A5 CF                                lda iopsize           ;instruction operand size
   2065 82B4 24 D1                                bit vopsflag          ;variable size operand allowed?
   2066 82B6 30 15                                bmi .0000130          ;yes
                                        ;
   2068 82B8 24 CE                                bit flimflag          ;was forced immediate set?
   2069 82BA 10 03                                bpl .0000110          ;no
                                        ;         
   2071 82BC 4C 45 83                             jmp monasc10          ;yes — error
                                        ;
   2073 82BF C5 CD                      .0000110 cmp eopsize           ;entered operand size
   2074 82C1 90 D6                                bcc .0000070          ;operand too big
                                        ;
   2076 82C3 85 CD                                sta eopsize           ;new operand size
   2077 82C5 80 2C                                bra monasc08          ;assemble, otherwise...
                                        ;
   2079 82C7 C5 CD                      .0000120 cmp eopsize           ;exact size match required
   2080 82C9 D0 CE                                bne .0000070          ;mismatch — wrong opcode
                                        ;
   2082 82CB 80 26                                bra monasc08          ;assemble
                                        ;
                                        ;
                                        ;	process variable size immediate mode operand...
                                        ;
   2087 82CD A6 CD                      .0000130 ldx eopsize           ;entered operand size
   2088 82CF E0 03                                cpx #s_xword          ;check size
   2089 82D1 B0 72                                bcs monasc10          ;too big — error
                                        ;
   2091 82D3 24 CE                                bit flimflag          ;forced long immediate?
   2092 82D5 10 06                                bpl .0000140          ;no
                                        ;
   2094 82D7 A2 02                                ldx #s_word           ;promote operand size to...
   2095 82D9 86 CD                                stx eopsize           ;16 bits
   2096 82DB 80 08                                bra .0000150
                                        ;
   2098 82DD E0 02                      .0000140 cpx #s_word           ;16 bits?
   2099 82DF D0 04                                bne .0000150          ;no
                                        ;
   2101 82E1 A0 C0                                ldy #flimmask         ;yes so force long...
   2102 82E3 84 CE                                sty flimflag          ;immediate disassembly
                                        ;
   2104 82E5 1A                         .0000150 ina                   ;new instruction operand size
   2105 82E6 C5 CD                                cmp eopsize           ;compare against operand size
   2106 82E8 90 AF                                bcc .0000070          ;mismatch — can't assemble
                                        ;
   2108 82EA 80 07                                bra monasc08          ;okay, assemble
                                        ;
                                        ;
                                        ;	process relative branch...
                                        ;
   2113 82EC 20 8B 8B                   .0000160 jsr targoff           ;compute branch offset
   2114 82EF B0 54                                bcs monasc10          ;branch out of range
                                        ;
   2116 82F1 85 CD                                sta eopsize           ;effective operand size
                                        ;
                                        ;
                                        ;	assemble instruction...
                                        ;
   2121 82F3 A5 CA                      monasc08 lda opcode            ;opcode
   2122 82F5 87 A0                    +            .byte $87,addra
                                        ;store at assembly address
   2123 82F7 A6 CD                                ldx eopsize           ;any operand to process?
   2124 82F9 F0 09                                beq .0000020          ;no
                                        ;
   2126 82FB 9B                       +            .byte $9b
                                                           ;also storage offset
                                        ;
   2128 82FC CA                         .0000010 dex
   2129 82FD B5 BB                                lda operand,x         ;get operand byte &...
   2130 82FF 97 A0                    +            .byte $97,addra
                                        ;poke into memory
   2131 8301 88                                   dey
   2132 8302 D0 F8                                bne .0000010          ;next
                                        ;
   2134 8304 A9 0D                      .0000020 lda #a_cr
                                           		 cpu FT832
   2136 008306 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2138 830B A9 41                                lda #asmprfx          ;assembly prefix
   2139 830D 20 5B 86                             jsr dpycodaa          ;disassemble & display
                                        ;
                                        ;
                                        ;	prompt for next instruction...
                                        ;
   2144 8310 A9 20                      monasc09 lda #a_blank
   2145 8312 A2 08                                ldx #ascprmct-1
                                        ;
   2147 8314 9D 00 02                   .0000010 sta ibuffer,x         ;prepare buffer for...
   2148 8317 CA                                   dex                   ;next instruction
   2149 8318 10 FA                                bpl .0000010
                                        ;
   2151 831A A9 41                                lda #asmprfx          ;assemble code...
   2152 831C 8D 00 02                             sta ibuffer           ;prompt prefix
   2153 831F A5 A2                                lda addra+s_word      ;next instruction address bank
   2154 8321 20 8A 89                             jsr binhex            ;convert to ASCII
   2155 8324 8D 02 02                             sta ibuffer+apadrbkh  ;store MSN in buffer
   2156 8327 8E 03 02                             stx ibuffer+apadrbkl  ;store LSN in buffer
   2157 832A A5 A1                                lda addra+s_byte      ;next instruction address MSB
   2158 832C 20 8A 89                             jsr binhex
   2159 832F 8D 04 02                             sta ibuffer+apadrmbh
   2160 8332 8E 05 02                             stx ibuffer+apadrmbl
   2161 8335 A5 A0                                lda addra             ;next instruction address LSB
   2162 8337 20 8A 89                             jsr binhex
   2163 833A 8D 06 02                             sta ibuffer+apadrlbh
   2164 833D 8E 07 02                             stx ibuffer+apadrlbl
   2165 8340 A9 09                                lda #ascprmct         ;effective input count
   2166 8342 4C 2A 81                             jmp moncea            ;reenter input loop
                                        ;
                                        ;
                                        ;	process assembly error...
                                        ;
   2171 8345 20 BE 87                   monasc10 jsr dpyerr            ;indicate error &...
   2172 8348 80 C6                                bra monasc09          ;prompt w/same assembly address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondsc: DISASSEMBLE CODE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: D [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2182 834A B0 11                      mondsc   bcs .0000010          ;no parameters
                                        ;
   2184 834C 64 CE                                stz flimflag          ;reset to 8 bit mode
   2185 834E 20 CF 8A                             jsr facasize          ;check starting...
   2186 8351 C9 04                                cmp #s_dword          ;address
   2187 8353 B0 46                                bcs .0000050          ;out of range — error
                                        ;
   2189 8355 20 B1 8A                             jsr facaddra          ;copy starting address
   2190 8358 20 E3 8A                             jsr getparm           ;get ending address
   2191 835B 90 17                                bcc .0000020          ;gotten
                                        ;
   2193 835D 20 9D 89                   .0000010 jsr clrfaca           ;clear accumulator
   2194 8360 C2 20                    +            .byte $c2,$20
                                        
   2195 8362 18                                   clc
   2196 8363 A5 A0                                lda addra             ;starting address
   2197 8365 69 15                    +            adc #<n_dbytes
   2197 8367 00                       +            .byte >n_dbytes
                                        ;default bytes
   2198 8368 85 A7                                sta faca              ;effective ending address
   2199 836A E2 20                    +            .byte $e2,$20
                                        
   2200 836C A5 A2                                lda addra+s_word      ;starting bank
   2201 836E 69 00                                adc #0
   2202 8370 85 A9                                sta faca+s_word       ;effective ending bank
   2203 8372 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2205 8374 20 CF 8A                   .0000020 jsr facasize          ;check ending...
   2206 8377 C9 04                                cmp #s_dword          ;address
   2207 8379 B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2209 837B 20 BB 8A                             jsr facaddrb          ;set ending address
   2210 837E 20 E3 8A                             jsr getparm           ;check for excess input
   2211 8381 90 18                                bcc .0000050          ;present — error
                                        ;
   2213 8383 20 09 8A                             jsr calccnt           ;calculate bytes
   2214 8386 90 13                                bcc .0000050          ;end < start
                                        ;
   2216 8388 20 B3 8C                   .0000030 jsr teststop          ;test for display stop
   2217 838B B0 0B                                bcs .0000040          ;stopped
                                        ;
   2219 838D 20 05 88                             jsr newline           ;next line
   2220 8390 20 59 86                             jsr dpycod            ;disassemble & display
   2221 8393 20 67 8A                             jsr decdcnt           ;decrement byte count
   2222 8396 90 F0                                bcc .0000030          ;not done
                                        ;
   2224 8398 4C 26 81                   .0000040 jmp monce             ;back to main loop
                                        ;
   2226 839B 4C 65 81                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjmp: EXECUTE CODE
                                        ;
                                        ;	—————————————————————————————————————————————————————————————
                                        ;	syntax: G [<addr>]
                                        ;
                                        ;	If no address is specified, the current values in the PB & PC
                                        ;	shadow registers are used.
                                        ;	—————————————————————————————————————————————————————————————
                                        ;
   2239 839E 20 74 8B                   monjmp   jsr setxaddr          ;set execution address
   2240 83A1 B0 29                                bcs monjmpab          ;out of range — error
                                        ;
   2242 83A3 20 E3 8A                             jsr getparm           ;check for excess input
   2243 83A6 90 24                                bcc monjmpab          ;too much input — error
                                        ;
   2245 83A8 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   2246 83AA A5 95                                lda reg_spx
   2247 83AC 1B                       +            .byte $1b
                                                           ;restore SP
                                        ;
   2249 83AD E2 20                      monjmpaa +         .byte $e2,$20
                                        
   2250 83AF A5 88                                lda reg_pbx
   2251 83B1 48                                   pha                   ;restore PB
   2252 83B2 C2 20                    +            .byte $c2,$20
                                        
   2253 83B4 A5 86                                lda reg_pcx
   2254 83B6 48                                   pha                   ;restore PC
   2255 83B7 E2 20                    +            .byte $e2,$20
                                        
   2256 83B9 A5 99                                lda reg_srx
   2257 83BB 48                                   pha                   ;restore SR
   2258 83BC A5 9B                                lda reg_dbx
   2259 83BE 48                                   pha
   2260 83BF AB                       +            .byte $ab
                                                           ;restore DB
   2261 83C0 C2 30                    +            .byte $c2,$30
                                        
   2262 83C2 A5 9C                                lda reg_dpx
   2263 83C4 5B                       +            .byte $5b
                                                           ;restore DP
   2264 83C5 A5 89                                lda reg_ax            ;restore .C
   2265 83C7 A6 8D                                ldx reg_xx            ;restore .X
   2266 83C9 A4 91                                ldy reg_yx            ;restore .Y
   2267 83CB 40                                   rti                   ;execute code
                                        ;
   2269 83CC 4C 65 81                   monjmpab jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjsr: EXECUTE CODE AS SUBROUTINE
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	syntax: J [<addr>]
                                        ;
                                        ;	If no address is specified the current values in the PB & PC
                                        ;	shadow registers are used.   An RTS at the end of the called
                                        ;	subroutine will return control to the monitor  provided  the
                                        ;	stack remains in balance.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2284 83CF 20 74 8B                   monjsr   jsr setxaddr          ;set execution address
   2285 83D2 B0 F8                                bcs monjmpab          ;out of range — error
                                        ;
   2287 83D4 20 E3 8A                             jsr getparm           ;check for excess input
   2288 83D7 90 F3                                bcc monjmpab          ;too much input — error
                                        ;
   2290 83D9 C2 20                    +            .byte $c2,$20
                                        
   2291 83DB A5 95                                lda reg_spx
   2292 83DD 1B                       +            .byte $1b
                                                           ;restore SP &...
   2293 83DE 20 AD 83                             jsr monjmpaa          ;call subroutine
   2294 83E1 08                                   php                   ;push SR
   2295 83E2 C2 30                    +            .byte $c2,$30
                                        
   2296 83E4 85 89                                sta reg_ax            ;save...
   2297 83E6 86 8D                                stx reg_xx            ;register...
   2298 83E8 84 91                                sty reg_yx            ;returns
   2299 83EA E2 10                    +            .byte $e2,$10
                                                        ;8 bit .X & .Y
   2300 83EC FA                                   plx                   ;get & save...
   2301 83ED 86 99                                stx reg_srx           ;return SR
   2302 83EF 3B                       +            .byte $3b
                                                           ;get & save...
   2303 83F0 85 95                                sta reg_spx           ;return SP
   2304 83F2 7B                       +            .byte $7b
                                                           ;get & save...
   2305 83F3 85 9C                                sta reg_dpx           ;DP pointer
   2306 83F5 E2 20                    +            .byte $e2,$20
                                                        ;8 bit .A
   2307 83F7 4B                       +            .byte $4b
                                                           ;get &...
   2308 83F8 68                                   pla                   ;save...
   2309 83F9 85 88                                sta reg_pbx           ;return PB
   2310 83FB 8B                       +            .byte $8b
                                                           ;get &...
   2311 83FC 68                                   pla                   ;save...
   2312 83FD 85 9B                                sta reg_dbx           ;return DB
   2313 83FF F4                       +            .byte $f4
   2313 8400 D4 90                    +            .word mm_rts
                                        ;"*RET"
   2314 8402 4C 72 80                             jmp moncom            ;return to monitor
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchm: CHANGE and/or DUMP MEMORY
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	syntax: > [<addr> <operand> [<operand>]...]
                                        ;
                                        ;	> <addr> without operands will dump 16 bytes
                                        ;	of memory, starting at <addr>.
                                        ;	————————————————————————————————————————————
                                        ;
   2327 8405 B0 23                      monchm   bcs .0000030          ;no address given — quit
                                        ;
   2329 8407 20 CF 8A                             jsr facasize          ;size address
   2330 840A C9 04                                cmp #s_dword
   2331 840C B0 1F                                bcs .0000040          ;address out of range — error
                                        ;
   2333 840E 20 B1 8A                             jsr facaddra          ;set starting address
   2334 8411 20 E4 8B                             jsr getpat            ;evaluate change pattern
   2335 8414 90 04                                bcc .0000010          ;entered
                                        ;
   2337 8416 10 0C                                bpl .0000020          ;not entered
                                        ;
   2339 8418 80 13                                bra .0000040          ;evaluation error
                                        ;
   2341 841A 88                         .0000010 dey                   ;next byte
   2342 841B 30 07                                bmi .0000020          ;done
                                        ;
   2344 841D B9 51 02                             lda auxbuf,y          ;write pattern...
   2345 8420 97 A0                    +            .byte $97,addra
                                        ;to memory
   2346 8422 80 F6                                bra .0000010          ;next
                                        ;
   2348 8424 20 05 88                   .0000020 jsr newline           ;next line
   2349 8427 20 77 87                             jsr dpymem            ;regurgitate changes
                                        ;
   2351 842A 4C 26 81                   .0000030 jmp monce             ;back to command loop
                                        ;
   2353 842D 4C 65 81                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncmp: COMPARE MEMORY
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: C <start> <end> <ref>
                                        ;	—————————————————————————————
                                        ;
   2363 8430 B0 26                      moncmp   bcs .0000030          ;start not given — quit
                                        ;
   2365 8432 20 8B 8A                             jsr enddest           ;get end & reference addresses
   2366 8435 B0 24                                bcs .0000040          ;range or other error
                                        ;
   2368 8437 64 CC                                stz xrtemp            ;column counter
                                        ;
   2370 8439 20 B3 8C                   .0000010 jsr teststop          ;check for stop
   2371 843C B0 1A                                bcs .0000030          ;abort
                                        ;
   2373 843E A7 A0                    +            .byte $a7,addra
                                        ;get from reference location
   2374 8440 C7 BB                    +            .byte $c7,operand
                                        ;test against compare location
   2375 8442 F0 03                                beq .0000020          ;match, don't display address
                                        ;
   2377 8444 20 3F 86                             jsr dpycaddr          ;display current location
                                        ;
   2379 8447 20 0B 8B                   .0000020 jsr nxtaddra          ;next reference location
   2380 844A B0 0C                                bcs .0000030          ;done
                                        ;
   2382 844C C2 20                    +            .byte $c2,$20
                                        
   2383 844E E6 BB                                inc operand           ;bump bits 0-15
   2384 8450 E2 20                    +            .byte $e2,$20
                                        
   2385 8452 D0 E5                                bne .0000010
                                        ;
   2387 8454 E6 BD                                inc operand+s_word    ;bump bits 16-23
   2388 8456 80 E1                                bra .0000010
                                        ;
   2390 8458 4C 26 81                   .0000030 jmp monce             ;return to command exec
                                        ;
   2392 845B 4C 65 81                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncpy: COPY (transfer) MEMORY
                                        ;
                                        ;	————————————————————————————————
                                        ;	syntax: T <start> <end> <target>
                                        ;	————————————————————————————————
                                        ;
   2402 845E B0 49                      moncpy   bcs .0000040          ;start not given — quit
                                        ;
   2404 8460 20 8B 8A                             jsr enddest           ;get end & target addresses
   2405 8463 B0 47                                bcs .0000050          ;range or other error
                                        ;
   2407 8465 C2 20                    +            .byte $c2,$20
                                        
   2408 8467 38                                   sec
   2409 8468 A5 A4                                lda addrb             ;ending address
   2410 846A E5 A0                                sbc addra             ;starting address
   2411 846C 90 3E                                bcc .0000050          ;start > end — error
                                        ;
   2413 846E 85 AF                                sta facb              ;bytes to copy
   2414 8470 E2 20                    +            .byte $e2,$20
                                        
   2415 8472 C2 10                    +            .byte $c2,$10
                                        
   2416 8474 A5 BD                                lda operand+s_word    ;target bank
   2417 8476 A4 BB                                ldy operand           ;target address
   2418 8478 C5 A2                                cmp addra+s_word      ;source bank
   2419 847A C2 20                    +            .byte $c2,$20
                                        
   2420 847C D0 1C                                bne .0000020          ;can use forward copy
                                        ;
   2422 847E C4 A0                                cpy addra             ;source address
   2423 8480 90 18                                bcc .0000020          ;can use forward copy
                                        ;
   2425 8482 D0 02                                bne .0000010          ;must use reverse copy
                                        ;
   2427 8484 80 26                                bra .0000050          ;copy in place — error
                                        ;
   2429 8486 A5 AF                      .0000010 lda facb              ;get bytes to copy
   2430 8488 48                                   pha                   ;protect
   2431 8489 20 99 8C                             jsr lodbnk            ;load banks
   2432 848C 20 31 8A                             jsr cprvsup           ;do reverse copy setup
   2433 848F 68                                   pla                   ;get bytes to copy
   2434 8490 AA                                   tax                   ;save a copy
   2435 8491 18                                   clc
   2436 8492 65 BB                                adc operand           ;change target to...
   2437 8494 A8                                   tay                   ;target end
   2438 8495 8A                                   txa                   ;recover bytes to copy
   2439 8496 A6 A4                                ldx addrb             ;source end
   2440 8498 80 0C                                bra .0000030
                                        ;
   2442 849A A5 AF                      .0000020 lda facb              ;get bytes to copy
   2443 849C 48                                   pha                   ;protect
   2444 849D 20 99 8C                             jsr lodbnk            ;load banks
   2445 84A0 20 2A 8A                             jsr cpfwsup           ;do forward copy setup
   2446 84A3 68                                   pla                   ;get bytes to copy
   2447 84A4 A6 A0                                ldx addra             ;source start
                                        ;
   2449 84A6 4C D2 00                   .0000030 jmp mcftwork          ;copy memory
                                        ;
   2451 84A9 4C 26 81                   .0000040 jmp monce             ;back to executive
                                        ;
   2453 84AC 4C 65 81                   .0000050 jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondmp: DISPLAY MEMORY RANGE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: M [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2463 84AF B0 0F                      mondmp   bcs .0000010          ;no parameters
                                        ;
   2465 84B1 20 CF 8A                             jsr facasize          ;check address...
   2466 84B4 C9 04                                cmp #s_dword          ;range
   2467 84B6 B0 46                                bcs .0000050          ;address out of range
                                        ;
   2469 84B8 20 B1 8A                             jsr facaddra          ;copy starting address
   2470 84BB 20 E3 8A                             jsr getparm           ;get ending address
   2471 84BE 90 17                                bcc .0000020          ;gotten
                                        ;
   2473 84C0 20 9D 89                   .0000010 jsr clrfaca           ;clear accumulator
   2474 84C3 C2 20                    +            .byte $c2,$20
                                        
   2475 84C5 18                                   clc
   2476 84C6 A5 A0                                lda addra             ;starting address
   2477 84C8 69 FF                    +            adc #<n_mbytes
   2477 84CA 00                       +            .byte >n_mbytes
                                        ;default bytes
   2478 84CB 85 A7                                sta faca              ;effective ending address
   2479 84CD E2 20                    +            .byte $e2,$20
                                        
   2480 84CF A5 A2                                lda addra+s_word      ;starting bank
   2481 84D1 69 00                                adc #0
   2482 84D3 85 A9                                sta faca+s_word       ;effective ending bank
   2483 84D5 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2485 84D7 20 CF 8A                   .0000020 jsr facasize          ;check ending address...
   2486 84DA C9 04                                cmp #s_dword          ;range
   2487 84DC B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2489 84DE 20 BB 8A                             jsr facaddrb          ;copy ending address
   2490 84E1 20 E3 8A                             jsr getparm           ;check for excess input
   2491 84E4 90 18                                bcc .0000050          ;error
                                        ;
   2493 84E6 20 09 8A                             jsr calccnt           ;calculate bytes to dump
   2494 84E9 90 13                                bcc .0000050          ;end < start
                                        ;
   2496 84EB 20 B3 8C                   .0000030 jsr teststop          ;test for display stop
   2497 84EE B0 0B                                bcs .0000040          ;stopped
                                        ;
   2499 84F0 20 05 88                             jsr newline           ;next line
   2500 84F3 20 77 87                             jsr dpymem            ;display
   2501 84F6 20 67 8A                             jsr decdcnt           ;decrement byte count
   2502 84F9 90 F0                                bcc .0000030          ;not done
                                        ;
   2504 84FB 4C 26 81                   .0000040 jmp monce             ;back to main loop
                                        ;
   2506 84FE 4C 65 81                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monfil: FILL MEMORY
                                        ;
                                        ;	—————————————————————————————————————————
                                        ;	syntax: F <start> <end> <fill>
                                        ;
                                        ;	<start> & <end> must be in the same bank.
                                        ;	—————————————————————————————————————————
                                        ;
   2518 8501 B0 5E                      monfil   bcs .0000010          ;start not given — quit
                                        ;
   2520 8503 20 CF 8A                             jsr facasize          ;check size
   2521 8506 C9 04                                cmp #s_dword
   2522 8508 B0 5A                                bcs .0000020          ;out of range — error...
                                        ;
   2524 850A 20 B1 8A                             jsr facaddra          ;store start
   2525 850D 20 E3 8A                             jsr getparm           ;evaluate end
   2526 8510 B0 52                                bcs .0000020          ;not entered — error
                                        ;
   2528 8512 20 CF 8A                             jsr facasize          ;check size
   2529 8515 C9 04                                cmp #s_dword
   2530 8517 B0 4B                                bcs .0000020          ;out of range — error
                                        ;
   2532 8519 A5 A9                                lda faca+s_word       ;end bank
   2533 851B C5 A2                                cmp addra+s_word      ;start bank
   2534 851D D0 45                                bne .0000020          ;not same — error
                                        ;
   2536 851F 20 BB 8A                             jsr facaddrb          ;store <end>
   2537 8522 C2 20                    +            .byte $c2,$20
                                        
   2538 8524 38                                   sec
   2539 8525 A5 A4                                lda addrb             ;ending address
   2540 8527 E5 A0                                sbc addra             ;starting address
   2541 8529 90 39                                bcc .0000020          ;start > end — error
                                        ;
   2543 852B 85 AF                                sta facb              ;bytes to copy
   2544 852D E2 20                    +            .byte $e2,$20
                                        
   2545 852F 20 E3 8A                             jsr getparm           ;evaluate <fill>
   2546 8532 B0 30                                bcs .0000020          ;not entered — error
                                        ;
   2548 8534 20 CF 8A                             jsr facasize          ;<fill> should be...
   2549 8537 C9 02                                cmp #s_word           ;8 bits
   2550 8539 B0 29                                bcs .0000020          ;it isn't — error
                                        ;
   2552 853B 20 C5 8A                             jsr facaoper          ;store <fill>
   2553 853E 20 E3 8A                             jsr getparm           ;should be no more parameters
   2554 8541 90 21                                bcc .0000020          ;there are — error
                                        ;
   2556 8543 A5 BB                                lda operand           ;<fill>
   2557 8545 87 A0                    +            .byte $87,addra
                                        ;fill 1st location
   2558 8547 C2 30                    +            .byte $c2,$30
                                                         ;16 bit operations
   2559 8549 A5 AF                                lda facb              ;
   2560 854B F0 14                                beq .0000010          ;only 1 location — finished
                                        ;
   2562 854D 3A                                   dea                   ;zero align &...
   2563 854E 48                                   pha                   ;protect
   2564 854F E2 20                    +            .byte $e2,$20
                                        
   2565 8551 A5 A2                                lda addra+s_word      ;start bank
   2566 8553 EB                       +            .byte $eb
                                        
   2567 8554 A5 A6                                lda addrb+s_word      ;end bank
   2568 8556 20 2A 8A                             jsr cpfwsup           ;do forward copy setup
   2569 8559 68                                   pla                   ;recover fill count
   2570 855A A6 A0                                ldx addra             ;fill-from starting location
   2571 855C 9B                       +            .byte $9b
                                        
   2572 855D C8                                   iny                   ;fill-to starting location
   2573 855E 4C D2 00                             jmp mcftwork          ;fill memory
                                        ;
   2575 8561 4C 26 81                   .0000010 jmp monce             ;goto command executive
                                        ;
   2577 8564 4C 65 81                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monhnt: SEARCH (hunt) MEMORY
                                        ;
                                        ;	———————————————————————————————————
                                        ;	syntax: H <addr1> <addr2> <pattern>
                                        ;	———————————————————————————————————
                                        ;
   2587 8567 B0 40                      monhnt   bcs .0000050          ;no start address
                                        ;
   2589 8569 20 CF 8A                             jsr facasize          ;size starting address
   2590 856C C9 04                                cmp #s_dword
   2591 856E B0 3C                                bcs .0000060          ;address out of range — error
                                        ;
   2593 8570 20 B1 8A                             jsr facaddra          ;store starting address
   2594 8573 20 E3 8A                             jsr getparm           ;evaluate ending address
   2595 8576 B0 34                                bcs .0000060          ;no address — error
                                        ;
   2597 8578 20 CF 8A                             jsr facasize          ;size ending address
   2598 857B C9 04                                cmp #s_dword
   2599 857D B0 2D                                bcs .0000060          ;address out of range — error
                                        ;
   2601 857F 20 BB 8A                             jsr facaddrb          ;store ending address
   2602 8582 20 09 8A                             jsr calccnt           ;calculate byte range
   2603 8585 90 25                                bcc .0000060          ;end < start
                                        ;
   2605 8587 20 E4 8B                             jsr getpat            ;evaluate search pattern
   2606 858A B0 20                                bcs .0000060          ;error
                                        ;
   2608 858C 64 CC                                stz xrtemp            ;clear column counter
                                        ;
   2610 858E 20 B3 8C                   .0000010 jsr teststop          ;check for stop
   2611 8591 B0 16                                bcs .0000050          ;abort
                                        ;
   2613 8593 A4 BE                                ldy auxbufix          ;pattern index
                                        ;
   2615 8595 88                         .0000020 dey
   2616 8596 30 09                                bmi .0000030          ;pattern match
                                        ;
   2618 8598 B7 A0                    +            .byte $b7,addra
                                        ;get from memory
   2619 859A D9 51 02                             cmp auxbuf,y          ;test against pattern
   2620 859D D0 05                                bne .0000040          ;mismatch, next location
                                        ;
   2622 859F F0 F4                                beq .0000020          ;match, keep testing
                                        ;
   2624 85A1 20 3F 86                   .0000030 jsr dpycaddr          ;display current location
                                        ;
   2626 85A4 20 0B 8B                   .0000040 jsr nxtaddra          ;next location
   2627 85A7 90 E5                                bcc .0000010          ;not done
                                        ;
   2629 85A9 4C 26 81                   .0000050 jmp monce             ;back to executive
                                        ;
   2631 85AC 4C 65 81                   .0000060 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monenv: CONVERT NUMERIC VALUE
                                        ;
                                        ;	——————————————————————
                                        ;	syntax: <radix><value>
                                        ;	——————————————————————
                                        ;
   2641 85AF 20 E1 8A                   monenv   jsr getparmr          ;reread & evaluate parameter
   2642 85B2 B0 26                                bcs .0000020          ;none entered
                                        ;
   2644 85B4 A2 00                                ldx #0                ;radix index
   2645 85B6 A0 04                                ldy #n_radix          ;number of radices
                                        ;
   2647 85B8 5A                         .0000010 phy                   ;save counter
   2648 85B9 DA                                   phx                   ;save radix index
   2649 85BA 20 05 88                             jsr newline           ;next line &...
   2650 85BD 20 6D 87                             jsr clearlin          ;clear it
   2651 85C0 A9 20                                lda #a_blank
   2652 85C2 A2 04                                ldx #halftab
   2653 85C4 20 F6 87                             jsr multspc           ;indent 1/2 tab
   2654 85C7 FA                                   plx                   ;get radix index but...
   2655 85C8 DA                                   phx                   ;put it back
   2656 85C9 BD F6 8C                             lda radxtab,x         ;get radix
   2657 85CC 20 F6 88                             jsr binasc            ;convert to ASCII
   2658 85CF 5A                                   phy                   ;string address MSB
   2659 85D0 DA                                   phx                   ;string address LSB
   2660 85D1 20 1D 88                             jsr sprint            ;print
   2661 85D4 FA                                   plx                   ;get index again
   2662 85D5 7A                                   ply                   ;get counter
   2663 85D6 E8                                   inx
   2664 85D7 88                                   dey
   2665 85D8 D0 DE                                bne .0000010          ;no
                                        
   2667 85DA 4C 26 81                   .0000020 jmp monce             ;back to command exec
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchr: CHANGE REGISTERS
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	syntax: ; [PB [PC [.S [.C [.X [.Y [SP [DP [DB]]]]]]]]]
                                        ;
                                        ;	; with no parameters is the same as the R command.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   2679 85DD B0 33                      monchr   bcs .0000040          ;dump registers & quit
                                        ;
   2681 85DF A0 00                                ldy #0                ;register counter
   2682 85E1 84 B5                                sty facc              ;initialize register index
                                        ;
   2684 85E3 20 CF 8A                   .0000010 jsr facasize          ;get parameter size
   2685 85E6 D9 FA 8C                             cmp rcvltab,y         ;check against size table
   2686 85E9 B0 2A                                bcs .0000050          ;out of range
                                        ;
   2688 85EB B9 FA 8C                             lda rcvltab,y         ;determine number of bytes...
   2689 85EE C9 03                                cmp #s_word+1         ;to store
   2690 85F0 66 B6                                ror facc+s_byte       ;condition flag
   2691 85F2 10 02                                bpl .0000020          ;8 bit register size
                                        ;
   2693 85F4 C2 20                    +            .byte $c2,$20
                                                         ;16 bit register size
                                        ;
   2695 85F6 A6 B5                      .0000020 ldx facc              ;get register index
   2696 85F8 A5 A7                                lda faca              ;get parm
   2697 85FA 95 88                                sta reg_pbx,x         ;put in shadow storage
   2698 85FC E2 20                    +            .byte $e2,$20
                                        
   2699 85FE 06 B6                                asl facc+s_byte       ;mode flag to carry
   2700 8600 8A                                   txa                   ;register index
   2701 8601 69 01                                adc #s_byte           ;at least 1 byte stored
   2702 8603 85 B5                                sta facc              ;save new index
   2703 8605 20 E3 8A                             jsr getparm           ;get a parameter
   2704 8608 B0 08                                bcs .0000040          ;EOI
                                        ;
   2706 860A C8                                   iny                   ;bump register count
   2707 860B C0 09                                cpy #n_regchv         ;all registers processed?
   2708 860D D0 D4                                bne .0000010          ;no, keep going
                                        ;
   2710 860F 20 11 88                   .0000030 jsr alert             ;excessive input
                                        ;
   2712 8612 4C 7F 80                   .0000040 jmp monreg            ;display changes
                                        ;
   2714 8615 4C 65 81                   .0000050 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monxit: EXIT TO OPERATING ENVIRONMENT
                                        ;
                                        ;	—————————
                                        ;	syntax: X
                                        ;	—————————
                                        ;
   2724 8618 90 22                      monxit   bcc .0000020          ;no parameters allowed
                                        ;
   2726 861A C2 20                    +            .byte $c2,$20
                                        
   2727 861C AD 02 01                             lda vecbrki           ;BRK indirect vector
   2728 861F C9 42                    +            cmp #<monbrk
   2728 8621 80                       +            .byte >monbrk
                                        ;we intercept it?
   2729 8622 D0 09                                bne .0000010          ;no, don't change it
                                        ;
   2731 8624 AD 05 01                             lda vecbrkia          ;old vector
   2732 8627 8D 02 01                             sta vecbrki           ;restore it
   2733 862A 9C 05 01                             stz vecbrkia          ;invalidate old vector
                                        ;         
   2735 862D E2 30                      .0000010 +         .byte $e2,$30
                                        
                                           		 CPU FT832
   2737 00862F 64 CE                        		 STZ	$CE
   2738 008631 64 CF                        		 STZ	$CF
   2739 008633 42 CB 42 A2 00 00            		 TSK	JMP:#0
   2740 008639 4C 00 C0                     		 JMP	$C000
                                        		 CPU	W65C02
                                        ;         jml vecexit           ;long jump to exit
                                        ;
   2744 863C 4C 65 81                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * *                                         * *
                                        ; * * S T A R T   o f   S U B R O U T I N E S * *
                                        ; * *                                         * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;dpycaddr: DISPLAY CURRENT ADDRESS IN COLUMNS
                                        ;
   2756 863F A6 CC                      dpycaddr ldx xrtemp            ;column count
   2757 8641 D0 05                                bne .0000010          ;not at right side
                                        ;
   2759 8643 20 05 88                             jsr newline           ;next row
   2760 8646 A2 08                                ldx #n_hccols         ;max columns
                                        ;
   2762 8648 E0 08                      .0000010 cpx #n_hccols         ;max columns
   2763 864A F0 07                                beq .0000020          ;at left margin
                                        ;
   2765 864C A9 09                                lda #a_ht
                                           		 cpu FT832
   2767 00864E 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2770 8653 CA                         .0000020 dex                   ;one less column
   2771 8654 86 CC                                stx xrtemp            ;save column counter
   2772 8656 4C CA 87                             jmp prntladr          ;print reference address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpycod: DISASSEMBLE & DISPLAY CODE
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This function disassembles & displays the machine code at  the  location
                                        ;	pointed to by ADDRA.  Upon return, ADDRA will point to the opcode of the
                                        ;	next instruction.   The entry point at DPYCODAA  should be called with a
                                        ;	disassembly prefix character loaded in .A.   If entered  at  DPYCOD, the
                                        ;	default character will be display at the beginning of each  disassembled
                                        ;	instruction.
                                        ;
                                        ;	The disassembly of immediate mode instructions that can take an 8 or  16
                                        ;	bit operand is affected by the bit pattern that is  stored  in  FLIMFLAG
                                        ;	upon entry to this function:
                                        ;
                                        ;	    FLIMFLAG: xx000000
                                        ;	              ||
                                        ;	              |+—————————> 0:  8 bit .X or .Y operand
                                        ;	              |            1: 16 bit .X or .Y operand
                                        ;	              +——————————> 0:  8 bit .A or BIT # operand
                                        ;	                           1: 16 bit .A or BIT # operand
                                        ;
                                        ;	FLIMFLAG is conditioned according to the operand of  the  most  recently
                                        ;	disassembled REP or SEP instruction.   Hence repetitive  calls  to  this
                                        ;	subroutine will usually result in the correct disassembly of 16 bit imm-
                                        ;	ediate mode instructions.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   2803 8659 A9 2E                       public dpycod   lda #disprfx          ;default prefix
                                        ;
                                        ;
                                        ;	alternate prefix display entry point...
                                        ;
   2808 865B                            dpycodaa 
                                           		 cpu FT832
   2810 00865B 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2812 8660 20 15 88                             jsr printspc          ;space
   2813 8663 20 CA 87                             jsr prntladr          ;print long address
   2814 8666 20 15 88                             jsr printspc          ;space to opcode field
   2815 8669 20 DD 8A                             jsr getbyte           ;get opcode
   2816 866C 85 CA                                sta opcode            ;save &...
   2817 866E 20 0A 88                             jsr printbyt          ;display as hex
                                        ;
                                        ;
                                        ;	decode menmonic & addressing info...
                                        ;
   2822 8671 A6 CA                                ldx opcode            ;current mnemonic
   2823 8673 BD BB 8D                             lda mnetabix,x        ;get mnemonic index
   2824 8676 0A                                   asl                   ;double for...
   2825 8677 A8                                   tay                   ;mnemonic table offset
   2826 8678 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   2827 867A B9 03 8D                             lda mnetab,y          ;copy encoded mnemonic to...
   2828 867D 85 C8                                sta mnepck            ;working storage
   2829 867F E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   2830 8681 20 3F 8B                             jsr instdata          ;extract mode & size data
   2831 8684 85 D1                                sta vopsflag          ;save mode flags
   2832 8686 84 C3                                sty admodidx          ;save mode index
   2833 8688 0A                                   asl                   ;variable immediate instruction?
   2834 8689 90 1F                                bcc dpycod01          ;no, effective operand size in .X
                                        ;
                                        ;
                                        ;	determine immediate mode operand size...
                                        ;
   2839 868B A5 CA                                lda opcode            ;current opcode
   2840 868D 24 CE                                bit flimflag          ;operand display mode
   2841 868F 10 08                                bpl .0000010          ;8 bit .A & BIT immediate mode
                                        ;
   2843 8691 29 1F                                and #aimmaska         ;determine if...
   2844 8693 C9 09                                cmp #aimmaskb         ;.A or BIT immediate
   2845 8695 F0 10                                beq .0000030          ;display 16 bit operand
                                        ;
   2847 8697 A5 CA                                lda opcode            ;not .A or BIT immediate
                                        ;
   2849 8699 50 0F                      .0000010 bvc dpycod01          ;8 bit .X/.Y immediate mode
                                        ;
   2851 869B A0 03                                ldy #n_vopidx-1       ;opcodes to test
                                        ;
   2853 869D D9 BB 8F                   .0000020 cmp vopidx,y          ;looking for LDX #, CPY #, etc.
   2854 86A0 F0 07                                beq .0000040          ;disassemble a 16 bit operand
                                        ;
   2856 86A2 88                                   dey
   2857 86A3 10 F8                                bpl .0000020          ;keep trying
                                        ;
   2859 86A5 80 03                                bra dpycod01          ;not .X or .Y immediate
                                        ;
   2861 86A7 A5 CA                      .0000030 lda opcode            ;reload
                                        ;
   2863 86A9 E8                         .0000040 inx                   ;16 bit operand
                                        ;
                                        ;
                                        ;	get & display operand bytes...
                                        ;
   2868 86AA 86 CF                      dpycod01 stx iopsize           ;operand size...
   2869 86AC E8                                   inx                   ;plus opcode becomes...
   2870 86AD 86 C6                                stx instsize          ;instruction size
   2871 86AF 86 C4                                stx charcnt           ;total bytes to process
   2872 86B1 A9 0B                                lda #n_opcols+2       ;total operand columns plus WS
   2873 86B3 85 CC                                sta xrtemp            ;initialize counter
   2874 86B5 20 1E 8A                             jsr clroper           ;clear operand
   2875 86B8 A4 CF                                ldy iopsize           ;operand size
   2876 86BA F0 16                                beq .0000020          ;no operand
                                        ;
   2878 86BC A2 00                                ldx #0                ;operand index
                                        ;
   2880 86BE 20 DD 8A                   .0000010 jsr getbyte           ;get operand byte
   2881 86C1 95 BB                                sta operand,x         ;save
   2882 86C3 DA                                   phx                   ;protect operand index
   2883 86C4 20 0A 88                             jsr printbyt          ;print operand byte
   2884 86C7 C6 CC                                dec xrtemp            ;3 columns used, 2 for...
   2885 86C9 C6 CC                                dec xrtemp            ;operand nybbles &...
   2886 86CB C6 CC                                dec xrtemp            ;1 for whitespace
   2887 86CD FA                                   plx                   ;get operand index
   2888 86CE E8                                   inx                   ;bump it
   2889 86CF 88                                   dey
   2890 86D0 D0 EC                                bne .0000010          ;next
                                        ;
   2892 86D2 A6 CC                      .0000020 ldx xrtemp            ;operand columns remaining
   2893 86D4 20 F6 87                             jsr multspc           ;space to mnemonic field
                                        ;
                                        ;
                                        ;	display mnemonic...
                                        ;
   2898 86D7 A0 03                                ldy #s_mnemon         ;size of ASCII mnemonic
                                        ;
   2900 86D9 A9 00                      .0000030 lda #0                ;initialize char
   2901 86DB A2 05                                ldx #n_shfenc         ;shifts to execute
                                        ;
   2903 86DD 06 C8                      .0000040 asl mnepck            ;shift encoded mnemonic
   2904 86DF 26 C9                                rol mnepck+s_byte
   2905 86E1 2A                                   rol
   2906 86E2 CA                                   dex
   2907 86E3 D0 F8                                bne .0000040
                                        ;
   2909 86E5 69 3F                                adc #a_mnecvt         ;convert to ASCII &...
   2910 86E7 48                                   pha                   ;stash
   2911 86E8 88                                   dey
   2912 86E9 D0 EE                                bne .0000030          ;continue with mnemonic
                                        ;
   2914 86EB A0 03                                ldy #s_mnemon
                                        ;
   2916 86ED 68                         .0000050 pla                   ;get mnenmonic byte
                                           		 cpu FT832
   2918 0086EE 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2920 86F3 88                                   dey
   2921 86F4 D0 F7                                bne .0000050
                                        ;
                                        ;
                                        ;	display operand...
                                        ;
   2926 86F6 A5 CF                                lda iopsize           ;operand size
   2927 86F8 F0 73                                beq clearlin          ;zero, disassembly finished
                                        ;
   2929 86FA 20 15 88                             jsr printspc          ;space to operand field
   2930 86FD 24 D1                                bit vopsflag          ;check mode flags
   2931 86FF 50 08                                bvc dpycod02          ;not a branch
                                        ;
   2933 8701 20 55 8B                             jsr offtarg           ;compute branch target
   2934 8704 A6 C6                                ldx instsize          ;effective instruction size
   2935 8706 CA                                   dex
   2936 8707 86 CF                                stx iopsize           ;effective operand size
                                        ;
   2938 8709 64 D1                      dpycod02 stz vopsflag          ;clear
   2939 870B A5 C3                                lda admodidx          ;instruction addressing mode
   2940 870D C9 0B                                cmp #am_move          ;block move instruction?
   2941 870F D0 02                                bne .0000010          ;no
                                        ;
   2943 8711 66 D1                                ror vopsflag          ;yes
                                        ;
   2945 8713 0A                         .0000010 asl                   ;convert addressing mode to...
   2946 8714 AA                                   tax                   ;symbology table index
   2947 8715 C2 20                    +            .byte $c2,$20
                                                         ;do a 16 bit load
   2948 8717 BD BF 8F                             lda ms_lutab,x        ;addressing symbol pointer
   2949 871A 48                                   pha
   2950 871B E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bit loads
   2951 871D A0 00                                ldy #0
   2952 871F B3 01                    +            .byte $b3,1
                                        ;get 1st char
   2953 8721 C9 20                                cmp #a_blank
   2954 8723 F0 05                                beq .0000020          ;no addresing mode preamble
                                        ;
                                           		 cpu FT832
   2957 008725 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2960 872A A9 24                      .0000020 lda #c_hex
                                           		 cpu FT832
   2962 00872C 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2964 8731 A4 CF                                ldy iopsize           ;operand size = index
                                        ;
   2966 8733 88                         .0000030 dey
   2967 8734 30 16                                bmi .0000040          ;done with operand
                                        ;
   2969 8736 B9 BB 00                             lda operand,y         ;get operand byte
   2970 8739 20 E7 87                             jsr dpyhex            ;print operand byte
   2971 873C 24 D1                                bit vopsflag          ;block move?
   2972 873E 10 F3                                bpl .0000030          ;no
                                        ;
   2974 8740 64 D1                                stz vopsflag          ;reset
   2975 8742 5A                                   phy                   ;protect operand index
   2976 8743 F4                       +            .byte $f4
   2976 8744 F8 8F                    +            .word ms_move
                                        
   2977 8746 20 1D 88                             jsr sprint            ;display MVN/MVP operand separator
   2978 8749 7A                                   ply                   ;recover operand index again
   2979 874A 80 E7                                bra .0000030          ;continue
                                        ;
   2981 874C FA                         .0000040 plx                   ;symbology LSB
   2982 874D 7A                                   ply                   ;symbology MSB
   2983 874E E8                                   inx                   ;move past preamble
   2984 874F D0 01                                bne .0000050
                                        ;
   2986 8751 C8                                   iny
                                        ;
   2988 8752 5A                         .0000050 phy
   2989 8753 DA                                   phx
   2990 8754 20 1D 88                             jsr sprint            ;print postamble, if any
                                        ;
                                        ;
                                        ;	condition immediate mode display format...
                                        ;
   2995 8757 A5 BB                      dpycod03 lda operand           ;operand LSB
   2996 8759 29 30                                and #pfmxmask         ;isolate M & X bits
   2997 875B 0A                                   asl                   ;shift to match...
   2998 875C 0A                                   asl                   ;FLIMFLAG alignment
   2999 875D A6 CA                                ldx opcode            ;current instruction
   3000 875F E0 C2                                cpx #opc_rep          ;was it REP?
   3001 8761 D0 04                                bne .0000010          ;no
                                        ;
   3003 8763 04 CE                                tsb flimflag          ;set flag bits as required
   3004 8765 80 06                                bra clearlin
                                        ;
   3006 8767 E0 E2                      .0000010 cpx #opc_sep          ;was it SEP?
   3007 8769 D0 02                                bne clearlin          ;no, just exit
                                        ;
   3009 876B 14 CE                                trb flimflag          ;clear flag bits as required
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clearlin: CLEAR DISPLAY LINE
                                        ;
   3015 876D F4                         clearlin +         .byte $f4
   3015 876E 15 90                    +            .word dc_cl
                                        
   3016 8770 80 4F                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyibuf: DISPLAY MONITOR INPUT BUFFER CONTENTS
                                        ;
   3022 8772 F4                         dpyibuf +         .byte $f4
   3022 8773 00 02                    +            .word ibuffer
                                        
   3023 8775 80 4A                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpymem: DISPLAY MEMORY
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	This function displays 16 bytes of memory as hex values & as
                                        ;	ASCII equivalents.  The starting address for the display is
                                        ;	in ADDRA & is expected to be a 24 bit address.  Upon return,
                                        ;	ADDRA will point to the start of the next 16 bytes.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   3036 8777 E2 30                      dpymem +         .byte $e2,$30
                                        
   3037 8779 64 C4                                stz charcnt           ;reset
   3038 877B A9 3E                                lda #memprfx
                                           		 cpu FT832
   3040 00877D 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3042 8782 20 CA 87                             jsr prntladr          ;print 24 bit address
   3043 8785 A2 00                                ldx #0                ;string buffer index
   3044 8787 A0 08                                ldy #n_dump           ;bytes per line
                                        ;
   3046 8789 20 DD 8A                   .0000010 jsr getbyte           ;get from RAM, also...
   3047 878C 48                                   pha                   ;save for decoding
   3048 878D DA                                   phx                   ;save string index
   3049 878E 20 0A 88                             jsr printbyt          ;display as hex ASCII
   3050 8791 E6 C4                                inc charcnt           ;bytes displayed +1
   3051 8793 FA                                   plx                   ;recover string index &...
   3052 8794 68                                   pla                   ;byte
   3053 8795 C9 20                                cmp #a_blank          ;printable?
   3054 8797 90 04                                bcc .0000020          ;no
                                        ;
   3056 8799 C9 7F                                cmp #a_del
   3057 879B 90 02                                bcc .0000030          ;is printable
                                        ;
   3059 879D A9 2E                      .0000020 lda #memsubch         ;substitute character
                                        ;
   3061 879F 9D 00 02                   .0000030 sta ibuffer,x         ;save char
   3062 87A2 E8                                   inx                   ;bump index
   3063 87A3 88                                   dey                   ;byte count -= 1
   3064 87A4 D0 E3                                bne .0000010          ;not done
                                        ;
   3066 87A6 9E 00 02                             stz ibuffer,x         ;terminate ASCII string
   3067 87A9 A9 3A                                lda #memsepch
                                           		 cpu FT832
   3069 0087AB 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3071 87B0 F4                       +            .byte $f4
   3071 87B1 0B 90                    +            .word dc_bf
                                        
   3072 87B3 20 1D 88                             jsr sprint            ;select reverse video
   3073 87B6 20 72 87                             jsr dpyibuf           ;display ASCII equivalents
   3074 87B9 F4                       +            .byte $f4
   3074 87BA 20 90                    +            .word dc_er
                                        ;normal video
   3075 87BC 80 03                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyerr: DISPLAY ERROR SIGNAL
                                        ;
   3081 87BE F4                         dpyerr +         .byte $f4
   3081 87BF 4D 90                    +            .word mm_err
                                        ;"*ERR"
                                        ;
   3083 87C1 20 1D 88                   dpyerraa jsr sprint
   3084 87C4 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;gendbs: GENERATE DESTRUCTIVE BACKSPACE
                                        ;
   3090 87C5 F4                         gendbs +         .byte $f4
   3090 87C6 11 90                    +            .word dc_bs
                                        ;destructive backspace
   3091 87C8 80 F7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;prntladr: PRINT 24 BIT CURRENT ADDRESS
                                        ;
   3097 87CA 08                         prntladr php                   ;protect register sizes
   3098 87CB E2 20                    +            .byte $e2,$20
                                        
   3099 87CD A5 A2                                lda addra+s_word      ;get bank byte &...
   3100 87CF 20 E7 87                             jsr dpyhex            ;display it
   3101 87D2 C2 20                    +            .byte $c2,$20
                                        
   3102 87D4 A5 A0                                lda addra             ;get 16 bit address
   3103 87D6 28                                   plp                   ;restore register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhexw: DISPLAY BINARY WORD AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .C: word to display
                                        ;
                                        ;	Returned Values: .C: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3117 87D7 08                         dpyhexw  php                   ;save register sizes
   3118 87D8 C2 20                    +            .byte $c2,$20
                                        
   3119 87DA 48                                   pha                   ;protect value
   3120 87DB E2 20                    +            .byte $e2,$20
                                        
   3121 87DD EB                       +            .byte $eb
                                                           ;get MSB &...
   3122 87DE 20 E7 87                             jsr dpyhex            ;display
   3123 87E1 C2 20                    +            .byte $c2,$20
                                        
   3124 87E3 68                                   pla                   ;recover value
   3125 87E4 E2 20                    +            .byte $e2,$20
                                                        ;only LSB visible
   3126 87E6 28                                   plp                   ;reset register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhex: DISPLAY BINARY BYTE AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to display
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3140 87E7 20 8A 89                   dpyhex   jsr binhex            ;convert to hex ASCII
                                           		 cpu FT832
   3142 0087EA 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3144 87EF 8A                                   txa
                                           		 cpu FT832
   3146 0087F0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3148 87F5 60                          		 rts
                                                 ;jmp putcha            ;print LSN
                                        ;
                                        ;================================================================================
                                        ;
                                        ;multspc: PRINT MULTIPLE BLANKS
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .X: number of blanks to print
                                        ;
                                        ;	Register Returns: none
                                        ;
                                        ;	Calling Example : ldx #3
                                        ;	                  jsr multspc    ;print 3 spaces
                                        ;
                                        ;	Notes: This sub will print 1 blank if .X=0.
                                        ;	————————————————————————————————————————————————
                                        ;
   3166 87F6 8A                         multspc  txa
   3167 87F7 D0 01                                bne .0000010          ;blank count specified
                                        ;
   3169 87F9 E8                                   inx                   ;default to 1 blank
                                        ;
   3171 87FA A9 20                      .0000010 lda #a_blank
                                        ;
   3173 87FC                            .0000020 
                                           		 cpu FT832
   3175 0087FC 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3177 8801 CA                                   dex
   3178 8802 D0 F8                                bne .0000020
                                        ;
   3180 8804 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;newline: PRINT NEWLINE (CRLF)
                                        ;
   3186 8805 F4                         newline +         .byte $f4
   3186 8806 26 90                    +            .word dc_lf
                                        
   3187 8808 80 B7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printbyt: PRINT A BYTE WITH LEADING SPACE
                                        ;
   3193 880A 48                         printbyt pha                   ;protect byte
   3194 880B 20 15 88                             jsr printspc          ;print leading space
   3195 880E 68                                   pla                   ;restore &...
   3196 880F 80 D6                                bra dpyhex            ;print byte
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;alert: ALERT USER w/TERMINAL BELL
                                        ;
   3202 8811 A9 07                      alert    lda #a_bel
   3203 8813 80 02                                bra printcmn
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printspc: PRINT A SPACE
                                        ;
   3209 8815 A9 20                      printspc lda #a_blank
                                        ;
   3211 8817                            printcmn 
                                           		 cpu FT832
   3213 008817 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3215 881C 60                          		 rts
                                        ;jmp putcha
                                        ;
                                        ;================================================================================
                                        ;
                                        ;sprint: PRINT NULL-TERMINATED CHARACTER STRING
                                        ;
                                        ;	—————————————————————————————————————————————————————————
                                        ;	Preparatory Ops : SP+1: string address LSB
                                        ;	                  SP+2: string address MSB
                                        ;
                                        ;	Register Returns: .A: used
                                        ;	                  .B: entry value
                                        ;	                  .X: used
                                        ;	                  .Y: used
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: okay
                                        ;	           |||||||      1: string too long (1)
                                        ;	           ||||+++————> not defined
                                        ;	           |||+———————> 1
                                        ;	           ||+————————> 1
                                        ;	           ++—————————> not defined
                                        ;
                                        ;	Example: PER STRING
                                        ;	         JSR SPRINT
                                        ;	         BCS TOOLONG
                                        ;
                                        ;	Notes: 1) Maximum permissible string length including the
                                        ;	          terminator is 32,767 bytes.
                                        ;	       2) All registers are forced to 8 bits.
                                        ;	       3) DO NOT JUMP OR BRANCH INTO THIS FUNCTION!
                                        ;	—————————————————————————————————————————————————————————
                                        ;
   3250 881D E2 20                      sprint +         .byte $e2,$20
                                                        ;8 bit accumulator
   3251 881F C2 10                    +            .byte $c2,$10
                                                         ;16 bit index
                                        ;
                                        ;—————————————————————————————————————————————————————————
   3403 = 0000000000000001                            .reetaddr =1                    ;return address
                                        
   3405 = 00000003                      .src     =.reetaddr+s_word      ;string address stack offset
                                        
                                        ;—————————————————————————————————————————————————————————
                                        ;
   3260 8821 A0 00                    +            ldy #<0
   3260 8823 00                       +            .byte >0
                                        
   3261 8824 18                                   clc                   ;no initial error
                                        ;
   3263 8825 B3 03                      .0000010 +         .byte $b3,.src
                                        ;get a byte
   3264 8827 F0 09                                beq .0000020          ;done
                                        ;
                                           		 cpu FT832
   3267 008829 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3269 882E C8                                   iny
   3270 882F 10 F4                                bpl .0000010          ;next
                                        ;
   3272 8831 38                                   sec                   ;string too long
                                        ;
   3274 8832 FA                         .0000020 plx                   ;pull RTS address
   3275 8833 7A                                   ply                   ;clear string pointer
   3276 8834 DA                                   phx                   ;replace RTS
   3277 8835 E2 10                    +            .byte $e2,$10
                                        
   3278 8837 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ascbin: CONVERT NULL-TERMINATED ASCII NUMBER STRING TO BINARY
                                        ;
                                        ;	———————————————————————————————————————————————————
                                        ;	Preparatory Ops: ASCII number string in IBUFFER
                                        ;
                                        ;	Returned Values: FACA: converted parameter
                                        ;	                   .A: used
                                        ;	                   .X: used
                                        ;	                   .Y: used
                                        ;	                   .C: 1 = conversion error
                                        ;	                   .Z: 1 = nothing to convert
                                        ;
                                        ;	Notes: 1) Conversion stops when a non-numeric char-
                                        ;	          acter is encountered.
                                        ;	       2) Radix symbols are as follows:
                                        ;
                                        ;	          % binary
                                        ;	          @ octal
                                        ;	          + decimal
                                        ;	          $ hexadecimal
                                        ;
                                        ;	          Hex is the default if no radix is speci-
                                        ;	          fied in the 1st character of the string.
                                        ;	———————————————————————————————————————————————————
                                        ;
   3307 8838 E2 30                      ascbin +         .byte $e2,$30
                                        
   3308 883A 20 9D 89                             jsr clrfaca           ;clear accumulator
   3309 883D 64 C4                                stz charcnt           ;zero char count
   3310 883F 64 C2                                stz radix             ;initialize
                                        ;
                                        ;
                                        ;	process radix if present...
                                        ;
   3315 8841 20 30 8C                             jsr getcharw          ;get next non-WS char
   3316 8844 D0 02                                bne .0000010          ;got something
                                        ;
   3318 8846 18                                   clc                   ;no more input
   3319 8847 60                                   rts
                                        ;
   3321 8848 A2 03                      .0000010 ldx #n_radix-1        ;number of radices
                                        ;
   3323 884A DD F6 8C                   .0000020 cmp radxtab,x         ;recognized radix?
   3324 884D F0 06                                beq .0000030          ;yes
                                        ;
   3326 884F CA                                   dex
   3327 8850 10 F8                                bpl .0000020          ;try next
                                        ;
   3329 8852 C6 BF                                dec ibufidx           ;reposition to previous char
   3330 8854 E8                                   inx                   ;not recognized, assume hex
                                        ;
   3332 8855 C9 2B                      .0000030 cmp #c_dec            ;decimal radix?
   3333 8857 D0 02                                bne .0000040          ;not decimal
                                        ;
   3335 8859 66 C2                                ror radix             ;flag decimal conversion
                                        ;
   3337 885B BD E2 8C                   .0000040 lda basetab,x         ;number bases table
   3338 885E 85 D0                                sta range             ;set valid numeral range
   3339 8860 BD E6 8C                             lda bitsdtab,x        ;get bits per digit
   3340 8863 85 C0                                sta bitsdig           ;store
                                        ;
                                        ;
                                        ;	process numerals...
                                        ;
   3345 8865 20 D2 8B                   ascbin01 jsr getchar           ;get next char
   3346 8868 F0 70                                beq ascbin03          ;EOI
                                        ;
   3348 886A C9 20                                cmp #' '
   3349 886C F0 6C                                beq ascbin03          ;blank — EOF
                                        ;
   3351 886E C9 2C                                cmp #','
   3352 8870 F0 68                                beq ascbin03          ;comma — EOF
                                        ;
   3354 8872 C9 09                                cmp #a_ht
   3355 8874 F0 64                                beq ascbin03          ;tab — EOF
                                        ;
   3357 8876 20 F7 89                             jsr nybtobin          ;change to binary
   3358 8879 B0 60                                bcs ascbin04          ;not a recognized numeral
                                        ;
   3360 887B C5 D0                                cmp range             ;check range
   3361 887D B0 5C                                bcs ascbin04          ;not valid for base
                                        ;
   3363 887F 85 C1                                sta numeral           ;save processed numeral
   3364 8881 E6 C4                                inc charcnt           ;bump numeral count
   3365 8883 24 C2                                bit radix             ;working in base 10?
   3366 8885 10 15                                bpl .0000030          ;no
                                        ;
                                        ;
                                        ;	compute N*2 for decimal conversion...
                                        ;
   3371 8887 A2 00                                ldx #0                ;accumulator index
   3372 8889 A0 02                                ldy #s_pfac/2         ;iterations
   3373 888B C2 20                    +            .byte $c2,$20
                                        
   3374 888D 18                                   clc
                                        ;
   3376 888E B5 A7                      .0000020 lda faca,x            ;N
   3377 8890 2A                                   rol                   ;N=N*2
   3378 8891 95 AF                                sta facb,x
   3379 8893 E8                                   inx
   3380 8894 E8                                   inx
   3381 8895 88                                   dey
   3382 8896 D0 F6                                bne .0000020
                                        ;
   3384 8898 B0 41                                bcs ascbin04          ;overflow — error
                                        ;
   3386 889A E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	compute N*base for binary, octal or hex...
                                        ;	or N*8 for decimal...
                                        ;
   3392 889C A6 C0                      .0000030 ldx bitsdig           ;bits per digit
   3393 889E C2 20                    +            .byte $c2,$20
                                                         ;16 bit shifts
                                        ;
   3395 88A0 06 A7                      .0000040 asl faca
   3396 88A2 26 A9                                rol faca+s_word
   3397 88A4 B0 35                                bcs ascbin04          ;overflow — error
                                        ;
   3399 88A6 CA                                   dex
   3400 88A7 D0 F7                                bne .0000040          ;next shift
                                        ;
   3402 88A9 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   3403 88AB 24 C2                                bit radix             ;check base
   3404 88AD 10 13                                bpl ascbin02          ;not decimal
                                        ;
                                        ;
                                        ;	compute N*10 for decimal (N*8 + N*2)...
                                        ;
   3409 88AF A0 04                                ldy #s_pfac
   3410 88B1 C2 20                    +            .byte $c2,$20
                                        
                                        ;
   3412 88B3 B5 A7                      .0000050 lda faca,x            ;N*8
   3413 88B5 75 AF                                adc facb,x            ;N*2
   3414 88B7 95 A7                                sta faca,x            ;now N*10
   3415 88B9 E8                                   inx
   3416 88BA E8                                   inx
   3417 88BB 88                                   dey
   3418 88BC D0 F5                                bne .0000050
                                        ;
   3420 88BE B0 1B                                bcs ascbin04          ;overflow — error
                                        ;
   3422 88C0 E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	add current numeral to partial result...
                                        ;
   3427 88C2 A5 A7                      ascbin02 lda faca              ;N
   3428 88C4 65 C1                                adc numeral           ;N=N+D
   3429 88C6 85 A7                                sta faca
   3430 88C8 A2 01                                ldx #1
   3431 88CA A0 03                                ldy #s_pfac-1
                                        ;
   3433 88CC B5 A7                      .0000010 lda faca,x
   3434 88CE 69 00                                adc #0                ;account for carry
   3435 88D0 95 A7                                sta faca,x
   3436 88D2 E8                                   inx
   3437 88D3 88                                   dey
   3438 88D4 D0 F6                                bne .0000010
                                        ;
   3440 88D6 90 8D                                bcc ascbin01          ;next if no overflow
                                        ;
   3442 88D8 B0 01                                bcs ascbin04          ;overflow — error
                                        ;
                                        ;
                                        ;	finish up...
                                        ;
   3447 88DA 18                         ascbin03 clc                   ;no error
                                        ;
   3449 88DB E2 20                      ascbin04 +         .byte $e2,$20
                                                        ;reset if necessary
   3450 88DD A5 C4                                lda charcnt           ;load char count
   3451 88DF 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bcdasc: CONVERT BCD DIGIT TO ASCII
                                        ;
                                        ;	———————————————————————————————————————
                                        ;	Preparatory Ops: .A: BCD digit, $00-$99
                                        ;
                                        ;	Returned Values: .A: ASCII MSD
                                        ;	                 .X: ASCII LSD
                                        ;	                 .Y: entry value
                                        ;	———————————————————————————————————————
                                        ;
   3465 88E0 20 EC 88                   bcdasc   jsr bintonyb          ;extract nybbles
   3466 88E3 48                                   pha                   ;save tens
   3467 88E4 8A                                   txa                 
   3468 88E5 09 30                                ora #btoamask         ;change units to ASCII
   3469 88E7 AA                                   tax                   ;store
   3470 88E8 68                                   pla                   ;get tens
   3471 88E9 09 30                                ora #btoamask         ;change to ASCII
   3472 88EB 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bintonyb: EXTRACT BINARY NYBBLES
                                        ;
                                        ;	—————————————————————————————————
                                        ;	Preparatory Ops: .A: binary value
                                        ;
                                        ;	Returned Values: .A: MSN
                                        ;	                 .X: LSN
                                        ;	                 .Y: entry value
                                        ;	—————————————————————————————————
                                        ;
   3486 88EC 48                         bintonyb pha                   ;save
   3487 88ED 29 0F                                and #bcdumask         ;extract LSN
   3488 88EF AA                                   tax                   ;save it
   3489 88F0 68                                   pla
                                        ;         .rept s_bnybbl        ;extract MSN
   3491 88F1 4A                                     lsr
   3492 88F2 4A                                     lsr
   3493 88F3 4A                                     lsr
   3494 88F4 4A                                     lsr
                                        ;         .endr
   3496 88F5 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binasc: CONVERT 32-BIT BINARY TO NULL-TERMINATED ASCII NUMBER STRING
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	Preparatory Ops: FACA: 32-bit operand
                                        ;	                   .A: radix character, w/bit 7 set to
                                        ;	                       suppress radix symbol in the
                                        ;	                       conversion string
                                        ;
                                        ;	Returned Values: ibuffer: conversion string
                                        ;	                      .A: string length
                                        ;	                      .X: string address LSB
                                        ;	                      .Y: string address MSB
                                        ;
                                        ;	Execution Notes: ibufidx & instsize are overwritten.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   3516 88F6 64 BF                      binasc   stz ibufidx           ;initialize string index
   3517 88F8 64 C6                                stz instsize          ;clear format flag
                                        ;
                                        ;
                                        ;	evaluate radix...
                                        ;
   3522 88FA 0A                                   asl                   ;extract format flag &...
   3523 88FB 66 C6                                ror instsize          ;save it
   3524 88FD 4A                                   lsr                   ;extract radix character
   3525 88FE A2 03                                ldx #n_radix-1        ;total radices
                                        ;
   3527 8900 DD F6 8C                   .0000010 cmp radxtab,x         ;recognized radix?
   3528 8903 F0 04                                beq .0000020          ;yes
                                        ;
   3530 8905 CA                                   dex
   3531 8906 10 F8                                bpl .0000010          ;try next
                                        ;
   3533 8908 E8                                   inx                   ;assume hex
                                        ;
   3535 8909 86 C2                      .0000020 stx radix             ;save radix index for later
   3536 890B 24 C6                                bit instsize
   3537 890D 30 08                                bmi .0000030          ;no radix symbol wanted
                                        ;
   3539 890F BD F6 8C                             lda radxtab,x         ;radix table
   3540 8912 8D 00 02                             sta ibuffer           ;prepend to string
   3541 8915 E6 BF                                inc ibufidx           ;bump string index
                                        ;
   3543 8917 C9 2B                      .0000030 cmp #c_dec            ;converting to decimal?
   3544 8919 D0 07                                bne .0000040          ;no
                                        ;
   3546 891B 20 AF 89                             jsr facabcd           ;convert operand to BCD
   3547 891E A9 00                                lda #0
   3548 8920 80 17                                bra .0000070          ;skip binary stuff
                                        ;
                                        ;
                                        ;	prepare for binary, octal or hex conversion...
                                        ;
   3553 8922 A2 00                      .0000040 ldx #0                ;operand index
   3554 8924 A0 05                                ldy #s_sfac-1         ;workspace index
                                        ;
   3556 8926 B5 A7                      .0000050 lda faca,x            ;copy operand to...
   3557 8928 99 AF 00                             sta facb,y            ;workspace in...
   3558 892B 88                                   dey                   ;big-endian order
   3559 892C E8                                   inx
   3560 892D E0 04                                cpx #s_pfac
   3561 892F D0 F5                                bne .0000050
                                        ;
   3563 8931 A9 00                                lda #0
   3564 8933 BB                       +            .byte $bb
                                        
                                        ;
   3566 8934 95 AF                      .0000060 sta facb,x            ;pad workspace
   3567 8936 CA                                   dex
   3568 8937 10 FB                                bpl .0000060
                                        ;
                                        ;
                                        ;	set up conversion parameters...
                                        ;
   3573 8939 85 B5                      .0000070 sta facc              ;initialize byte counter
   3574 893B A4 C2                                ldy radix             ;radix index
   3575 893D B9 F2 8C                             lda numstab,y         ;numerals in string
   3576 8940 85 B6                                sta facc+s_byte       ;set remaining numeral count
   3577 8942 B9 EA 8C                             lda bitsntab,y        ;bits per numeral
   3578 8945 85 B7                                sta facc+s_word       ;set
   3579 8947 B9 EE 8C                             lda lzsttab,y         ;leading zero threshold
   3580 894A 85 B8                                sta facc+s_xword      ;set
                                        ;
                                        ;
                                        ;	generate conversion string...
                                        ;
   3585 894C A9 00                      .0000080 lda #0
   3586 894E A4 B7                                ldy facc+s_word       ;bits per numeral
                                        ;
   3588 8950 A2 05                      .0000090 ldx #s_sfac-1         ;workspace size
   3589 8952 18                                   clc                   ;avoid starting carry
                                        ;
   3591 8953 36 AF                      .0000100 rol facb,x            ;shift out a bit...
   3592 8955 CA                                   dex                   ;from the operand or...
   3593 8956 10 FB                                bpl .0000100          ;BCD conversion result
                                        ;
   3595 8958 2A                                   rol                   ;bit to .A
   3596 8959 88                                   dey
   3597 895A D0 F4                                bne .0000090          ;more bits to grab
                                        ;
   3599 895C A8                                   tay                   ;if numeral isn't zero...
   3600 895D D0 0A                                bne .0000110          ;skip leading zero tests
                                        ;
   3602 895F A6 B6                                ldx facc+s_byte       ;remaining numerals
   3603 8961 E4 B8                                cpx facc+s_xword      ;leading zero threshold
   3604 8963 90 04                                bcc .0000110          ;below it, must convert
                                        ;
   3606 8965 A6 B5                                ldx facc              ;processed byte count
   3607 8967 F0 11                                beq .0000130          ;discard leading zero
                                        ;
   3609 8969 C9 0A                      .0000110 cmp #10               ;check range
   3610 896B 90 02                                bcc .0000120          ;is 0-9
                                        ;
   3612 896D 69 06                                adc #a_hexdec         ;apply hex adjust
                                        ;
   3614 896F 69 30                      .0000120 adc #'0'              ;change to ASCII
   3615 8971 A4 BF                                ldy ibufidx           ;string index
   3616 8973 99 00 02                             sta ibuffer,y         ;save numeral in buffer
   3617 8976 E6 BF                                inc ibufidx           ;next buffer position
   3618 8978 E6 B5                                inc facc              ;bytes=bytes+1
                                        ;
   3620 897A C6 B6                      .0000130 dec facc+s_byte       ;numerals=numerals-1
   3621 897C D0 CE                                bne .0000080          ;not done
                                        ;
                                        ;
                                        ;	terminate string & exit...
                                        ;
   3626 897E A6 BF                                ldx ibufidx           ;printable string length
   3627 8980 9E 00 02                             stz ibuffer,x         ;terminate string
   3628 8983 8A                                   txa
   3629 8984 A2 00                                ldx #<ibuffer         ;converted string
   3630 8986 A0 02                                ldy #>ibuffer
   3631 8988 18                                   clc                   ;all okay
   3632 8989 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binhex: CONVERT BINARY BYTE TO HEX ASCII CHARS
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to convert
                                        ;
                                        ;	Returned Values: .A: MSN ASCII char
                                        ;	                 .X: LSN ASCII char
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————————————
                                        ;
   3646 898A 20 EC 88                   binhex   jsr bintonyb          ;generate binary values
   3647 898D 48                                   pha                   ;save MSN
   3648 898E 8A                                   txa
   3649 898F 20 94 89                             jsr .0000010          ;generate ASCII LSN
   3650 8992 AA                                   tax                   ;save
   3651 8993 68                                   pla                   ;get input
                                        ;
                                        ;
                                        ;	convert nybble to hex ASCII equivalent...
                                        ;
   3656 8994 C9 0A                      .0000010 cmp #10
   3657 8996 90 02                                bcc .0000020          ;in decimal range
                                        ;
   3659 8998 69 66                                adc #k_hex            ;hex compensate
                                        ;         
   3661 899A 49 30                      .0000020 eor #'0'              ;finalize nybble
   3662 899C 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfaca: CLEAR FLOATING ACCUMULATOR A
                                        ;
   3668 899D 08                         clrfaca  php
   3669 899E C2 20                    +            .byte $c2,$20
                                        
   3670 89A0 64 A7                                stz faca
   3671 89A2 64 A9                                stz faca+s_word
   3672 89A4 28                                   plp
   3673 89A5 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfacb: CLEAR FLOATING ACCUMULATOR B
                                        ;
   3679 89A6 08                         clrfacb  php
   3680 89A7 C2 20                    +            .byte $c2,$20
                                        
   3681 89A9 64 AF                                stz facb
   3682 89AB 64 B1                                stz facb+s_word
   3683 89AD 28                                   plp
   3684 89AE 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facabcd: CONVERT FACA INTO BCD
                                        ;
   3690 89AF A2 03                      facabcd  ldx #s_pfac-1         ;primary accumulator size -1
                                        ;
   3692 89B1 B5 A7                      .0000010 lda faca,x            ;value to be converted
   3693 89B3 48                                   pha                   ;preserve
   3694 89B4 CA                                   dex
   3695 89B5 10 FA                                bpl .0000010          ;next
                                        ;
   3697 89B7 A2 05                                ldx #s_sfac-1         ;workspace size
                                        ;
   3699 89B9 74 AF                      .0000020 stz facb,x            ;clear final result
   3700 89BB 74 B5                                stz facc,x            ;clear scratchpad
   3701 89BD CA                                   dex
   3702 89BE 10 F9                                bpl .0000020
                                        ;
   3704 89C0 E6 BA                                inc facc+s_sfac-s_byte
   3705 89C2 F8                                   sed                   ;select decimal mode
   3706 89C3 A0 1F                                ldy #m_bits-1         ;bits to convert -1
                                        ;
   3708 89C5 A2 03                      .0000030 ldx #s_pfac-1         ;operand size
   3709 89C7 18                                   clc                   ;no carry at start
                                        ;
   3711 89C8 76 A7                      .0000040 ror faca,x            ;grab LS bit in operand
   3712 89CA CA                                   dex
   3713 89CB 10 FB                                bpl .0000040
                                        ;
   3715 89CD 90 0D                                bcc .0000060          ;LS bit clear
                                        ;
   3717 89CF 18                                   clc
   3718 89D0 A2 05                                ldx #s_sfac-1
                                        ;
   3720 89D2 B5 AF                      .0000050 lda facb,x            ;partial result
   3721 89D4 75 B5                                adc facc,x            ;scratchpad
   3722 89D6 95 AF                                sta facb,x            ;new partial result
   3723 89D8 CA                                   dex
   3724 89D9 10 F7                                bpl .0000050
                                        ;
   3726 89DB 18                                   clc
                                        ;
   3728 89DC A2 05                      .0000060 ldx #s_sfac-1
                                        ;
   3730 89DE B5 B5                      .0000070 lda facc,x            ;scratchpad
   3731 89E0 75 B5                                adc facc,x            ;double &...
   3732 89E2 95 B5                                sta facc,x            ;save
   3733 89E4 CA                                   dex
   3734 89E5 10 F7                                bpl .0000070
                                        ;
   3736 89E7 88                                   dey
   3737 89E8 10 DB                                bpl .0000030          ;next operand bit
                                        ;
   3739 89EA D8                                   cld
   3740 89EB A2 00                                ldx #0
   3741 89ED A0 04                                ldy #s_pfac
                                        ;
   3743 89EF 68                         .0000080 pla                   ;operand
   3744 89F0 95 A7                                sta faca,x            ;restore
   3745 89F2 E8                                   inx
   3746 89F3 88                                   dey
   3747 89F4 D0 F9                                bne .0000080          ;next
                                        ;
   3749 89F6 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nybtobin: CONVERT ASCII NYBBLE TO BINARY
                                        ;
   3755 89F7 20 A6 8C                   nybtobin jsr toupper           ;convert case if necessary
   3756 89FA 38                                   sec
   3757 89FB E9 30                                sbc #'0'              ;change to binary
   3758 89FD 90 08                                bcc .0000020          ;not a numeral — error
                                        ;
   3760 89FF C9 0A                                cmp #10
   3761 8A01 90 03                                bcc .0000010          ;numeral is 0-9
                                        ;
   3763 8A03 E9 07                                sbc #a_hexdec+1       ;10-15 ——> A-F
   3764 8A05 18                                   clc                   ;no conversion error
                                        ;
   3766 8A06 60                         .0000010 rts
                                        ;
   3768 8A07 38                         .0000020 sec                   ;conversion error
   3769 8A08 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;calccnt: COMPUTE BYTE COUNT FROM ADDRESS RANGE
                                        ;
   3775 8A09 20 A6 89                   calccnt  jsr clrfacb           ;clear accumulator
   3776 8A0C C2 20                    +            .byte $c2,$20
                                        
   3777 8A0E 38                                   sec
   3778 8A0F A5 A4                                lda addrb             ;ending address
   3779 8A11 E5 A0                                sbc addra             ;starting address
   3780 8A13 85 AF                                sta facb              ;byte count
   3781 8A15 E2 20                    +            .byte $e2,$20
                                        
   3782 8A17 A5 A6                                lda addrb+s_word      ;handle banks
   3783 8A19 E5 A2                                sbc addra+s_word
   3784 8A1B 85 B1                                sta facb+s_word
   3785 8A1D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clroper: CLEAR OPERAND
                                        ;
   3791 8A1E DA                         clroper  phx
   3792 8A1F A2 02                                ldx #s_oper-1
                                        ;
   3794 8A21 74 BB                      .0000010 stz operand,x
   3795 8A23 CA                                   dex
   3796 8A24 10 FB                                bpl .0000010
                                        ;
   3798 8A26 64 CD                                stz eopsize
   3799 8A28 FA                                   plx
   3800 8A29 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpfwsup: FOWARD COPY MEMORY SETUP
                                        ;
   3806 8A2A C2 30                      cpfwsup +         .byte $c2,$30
                                        
   3807 8A2C A2 54                    +            ldx #<opc_mvn
   3807 8A2E 00                       +            .byte >opc_mvn
                                        ;"move next" opcode
   3808 8A2F 80 05                                bra cpsup
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cprvsup: REVERSE COPY MEMORY SETUP
                                        ;
   3814 8A31 C2 30                      cprvsup +         .byte $c2,$30
                                        
   3815 8A33 A2 44                    +            ldx #<opc_mvp
   3815 8A35 00                       +            .byte >opc_mvp
                                        ;"move previous" opcode
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cpsup: COPY MEMORY SETUP
                                        ;
   3821 8A36 48                         cpsup    pha                   ;save banks
   3822 8A37 8A                                   txa                   ;protect...
   3823 8A38 EB                       +            .byte $eb
                                                           ;opcode
   3824 8A39 E2 20                    +            .byte $e2,$20
                                        
   3825 8A3B A2 08                    +            ldx #<(cpcodeee-cpcode-1)
   3825 8A3D 00                       +            .byte >(cpcodeee-cpcode-1)
                                        
                                        ;
   3827 8A3E BF                         .0000010 +         .byte $bf
   3827 8A3F 5E 8A 00                 +   +         .byte <cpcode,>cpcode,cpcode >> 16
                                     +   
                                        ;transfer copy code to...
   3828 8A42 95 D2                                sta mcftwork,x        ;to workspace
   3829 8A44 CA                                   dex
   3830 8A45 10 F7                                bpl .0000010
                                        ;
   3832 8A47 EB                       +            .byte $eb
                                                           ;recover opcode &...
   3833 8A48 85 D3                                sta mcftopc           ;set it
   3834 8A4A C2 20                    +            .byte $c2,$20
                                        
   3835 8A4C 68                                   pla                   ;get banks &...
   3836 8A4D 85 D4                                sta mcftbnk           ;set them
                                         
                                        ; We just dynamically created a routine, so the cache (if one is present) has
                                        ; to be invalidated. Otherwise the processor could execute dead code from the
                                        ; cache. Two lines are invalidated in case the code crosses a line boundary.
                                        ;
                                        ;	acc = 16 bit address to invalidate
                                        ;
                                        ; If there is no cache in the processor then these lines can be deleted.
                                        ;-------------------------------------------------------------------------------
                                           		 CPU	FT832
                                           		 MEM	16
   3848 008A4F 48                                    pha
   3849 008A50 A9 D2 00                              lda	#mcftwork
   3850 008A53 42 E0 01                     		 cache	#1				; 1= invalidate line identified by address in acc
   3851 008A56 A9 E2 00                              lda	#mcftwork+16
   3852 008A59 42 E0 01                     		 cache	#1
   3853 008A5C 68                                    pla
                                        		 CPU	W65C02
   3855 8A5D                            		 MEM	8
                                        ;---------------------------------------------
   3857 8A5D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpcode: COPY MEMORY CODE
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	This code is transfered to workspace when a
                                        ;	copy or fill operation is to be performed.
                                        ;	———————————————————————————————————————————
                                        ;
   3868 8A5E 8B                         cpcode +         .byte $8b
                                                           ;must preserve data bank
                                        ;         .rept s_mvinst
   3870 8A5F EA                                     nop                 ;placeholder
   3871 8A60 EA                                     nop
   3872 8A61 EA                                     nop
                                        ;         .endr
   3874 8A62 AB                       +            .byte $ab
                                                           ;restore data bank
   3875 8A63 5C 26 81 00                          jml monce             ;return to command executive
   4059 = 00008A67                      cpcodeee =*                    ;placeholder — do not delete
                                        ;
                                        ;================================================================================
                                        ;
                                        ;decdcnt: DECREMENT DUMP COUNT
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	Preparatory Ops: bytes to process in FACB
                                        ;	                 bytes processed in CHARCNT
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = count = zero
                                        ;	———————————————————————————————————————————
                                        ;
   3892 8A67 E2 20                      decdcnt +         .byte $e2,$20
                                        
   3893 8A69 A9 00                                lda #0
   3894 8A6B EB                       +            .byte $eb
                                                           ;clear .B
   3895 8A6C A5 B1                                lda facb+s_word       ;count MSW
   3896 8A6E C2 20                    +            .byte $c2,$20
                                        
   3897 8A70 38                                   sec
   3898 8A71 05 AF                                ora facb              ;count LSW
   3899 8A73 F0 13                                beq .0000020          ;zero, just exit
                                        ;
   3901 8A75 A5 AF                                lda facb
   3902 8A77 E5 C4                                sbc charcnt           ;bytes processed
   3903 8A79 85 AF                                sta facb
   3904 8A7B E2 20                    +            .byte $e2,$20
                                        
   3905 8A7D A5 B1                                lda facb+s_word
   3906 8A7F E9 00                                sbc #0                ;handle borrow
   3907 8A81 90 04                                bcc .0000010          ;underflow
                                        ;
   3909 8A83 85 B1                                sta facb+s_word
   3910 8A85 18                                   clc                   ;count > 0
   3911 8A86 60                                   rts
                                        ;
   3913 8A87 38                         .0000010 sec
                                        ;
   3915 8A88 E2 20                      .0000020 +         .byte $e2,$20
                                        
   3916 8A8A 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;enddest: GET 2ND & 3RD ADDRESSES FOR COMPARE & TRANSFER
                                        ;
   3922 8A8B 20 CF 8A                   enddest  jsr facasize          ;check start...
   3923 8A8E C9 04                                cmp #s_dword          ;for range
   3924 8A90 B0 1E                                bcs .0000010          ;out of range — error
                                        ;
   3926 8A92 20 B1 8A                             jsr facaddra          ;store start
   3927 8A95 20 E3 8A                             jsr getparm           ;get end
   3928 8A98 B0 16                                bcs .0000010          ;not entered — error
                                        ;
   3930 8A9A 20 CF 8A                             jsr facasize          ;check end...
   3931 8A9D C9 04                                cmp #s_dword          ;for range
   3932 8A9F B0 0F                                bcs .0000010          ;out of range — error
                                        ;
   3934 8AA1 20 BB 8A                             jsr facaddrb          ;store end
   3935 8AA4 20 E3 8A                             jsr getparm           ;get destination
   3936 8AA7 B0 07                                bcs .0000010          ;not entered — error
                                        ;
   3938 8AA9 20 CF 8A                             jsr facasize          ;check destination...
   3939 8AAC C9 04                                cmp #s_dword          ;for range
   3940 8AAE 90 15                                bcc facaoper          ;store dest address
                                        ;
   3942 8AB0 60                         .0000010 rts                   ;exit w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddra: COPY FACA TO ADDRA
                                        ;
   3948 8AB1 A2 02                      facaddra ldx #s_xword-1
                                        ;
   3950 8AB3 B5 A7                      .0000010 lda faca,x
   3951 8AB5 95 A0                                sta addra,x
   3952 8AB7 CA                                   dex
   3953 8AB8 10 F9                                bpl .0000010
                                        ;
   3955 8ABA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddrb: COPY FACA TO ADDRB
                                        ;
   3961 8ABB A2 02                      facaddrb ldx #s_xword-1
                                        ;
   3963 8ABD B5 A7                      .0000010 lda faca,x
   3964 8ABF 95 A4                                sta addrb,x
   3965 8AC1 CA                                   dex
   3966 8AC2 10 F9                                bpl .0000010
                                        ;
   3968 8AC4 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaoper: COPY FACA TO OPERAND
                                        ;
   3974 8AC5 A2 02                      facaoper ldx #s_oper-1
                                        ;
   3976 8AC7 B5 A7                      .0000010 lda faca,x
   3977 8AC9 95 BB                                sta operand,x
   3978 8ACB CA                                   dex
   3979 8ACC 10 F9                                bpl .0000010
                                        ;
   3981 8ACE 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facasize: REPORT OPERAND SIZE IN FACA
                                        ;
                                        ;	——————————————————————————————————————————
                                        ;	Preparatory Ops: operand in FACA
                                        ;
                                        ;	Returned Values: .A: s_byte  (1)
                                        ;	                     s_word  (2)
                                        ;	                     s_xword (3)
                                        ;	                     s_dword (4)
                                        ;
                                        ;	Notes: 1) This function will always report
                                        ;	          a non-zero result.
                                        ;	——————————————————————————————————————————
                                        ;
   3999 8ACF E2 30                      facasize +         .byte $e2,$30
                                        
   4000 8AD1 A2 03                                ldx #s_dword-1
                                        ;
   4002 8AD3 B5 A7                      .0000010 lda faca,x            ;get byte
   4003 8AD5 D0 03                                bne .0000020          ;done
                                        ;
   4005 8AD7 CA                                   dex
   4006 8AD8 D0 F9                                bne .0000010          ;next byte
                                        ;
   4008 8ADA E8                         .0000020 inx                   ;count=index+1
   4009 8ADB 8A                                   txa
   4010 8ADC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getbyte: GET A BYTE FROM MEMORY
                                        ;
   4016 8ADD A7 A0                      getbyte +         .byte $a7,addra
                                        ;get a byte
   4017 8ADF 80 3F                                bra incaddra          ;bump address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getparm: GET A PARAMETER
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops: null-terminated input in IBUFFER
                                        ;
                                        ;	Returned Values: .A: chars in converted parameter
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = no parameter entered
                                        ;	—————————————————————————————————————————————————
                                        ;
   4032 8AE1 C6 BF                      getparmr dec ibufidx           ;reread previous char
                                        ;
   4034 8AE3 5A                         getparm  phy                   ;preserve
   4035 8AE4 20 38 88                             jsr ascbin            ;convert parameter to binary
   4036 8AE7 B0 1C                                bcs .0000040          ;conversion error
                                        ;
   4038 8AE9 20 D0 8B                             jsr getcharr          ;reread last char
   4039 8AEC D0 08                                bne .0000010          ;not end-of-input
                                        ;
   4041 8AEE C6 BF                                dec ibufidx           ;reindex to terminator
   4042 8AF0 A5 C4                                lda charcnt           ;get chars processed so far
   4043 8AF2 F0 0C                                beq .0000030          ;none
                                        ;
   4045 8AF4 D0 08                                bne .0000020          ;some
                                        ;
   4047 8AF6 C9 20                      .0000010 cmp #a_blank          ;recognized delimiter
   4048 8AF8 F0 04                                beq .0000020          ;end of parameter
                                        ;
   4050 8AFA C9 2C                                cmp #','              ;recognized delimiter
   4051 8AFC D0 07                                bne .0000040          ;unknown delimter
                                        ;
   4053 8AFE 18                         .0000020 clc
   4054 8AFF 24                                   .byte bitzp           ;skip SEC below
                                        ;
   4056 8B00 38                         .0000030 sec
   4057 8B01 7A                                   ply                   ;restore
   4058 8B02 A5 C4                                lda charcnt           ;get count
   4059 8B04 60                                   rts                   ;done
                                        ;
   4061 8B05                            .0000040 
                                        ;.rept 3               ;clean up stack
   4063 8B05 68                          			pla
   4064 8B06 68                          			pla
   4065 8B07 68                                     pla
                                        ;        .endr
   4067 8B08 4C 65 81                             jmp monerr            ;abort w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nxtaddra: TEST & INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR NXTADDRA
                                        ;
                                        ;	Exit registers: .A: used
                                        ;	                .B: used
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    |||||||+———> 0: ADDRA < ADDRB
                                        ;	                    |||||||      1: ADDRA >= ADDRB
                                        ;	                    ||||||+————> undefined
                                        ;	                    |||+++—————> entry value
                                        ;	                    ||+————————> 1
                                        ;	                    ++—————————> undefined
                                        ;	——————————————————————————————————————————————————
                                        ;
   4093 8B0B E2 20                      nxtaddra +         .byte $e2,$20
                                        
   4094 8B0D A5 A2                                lda addra+s_word      ;bits 16-23
   4095 8B0F C5 A6                                cmp addrb+s_word
   4096 8B11 90 0D                                bcc incaddra          ;increment
                                        ;
   4098 8B13 D0 0A                                bne .0000010          ;don't increment
                                        ;
   4100 8B15 C2 20                    +            .byte $c2,$20
                                        
   4101 8B17 A5 A0                                lda addra             ;bits 0-15
   4102 8B19 C5 A4                                cmp addrb             ;condition flags
   4103 8B1B E2 20                    +            .byte $e2,$20
                                        
   4104 8B1D 90 01                                bcc incaddra          ;increment
                                        ;
   4106 8B1F 60                         .0000010 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incaddra: INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR INCADDRA
                                        ;
                                        ;	Exit registers: .A: entry value
                                        ;	                .B: entry value
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    ++++++++———> entry value
                                        ;	——————————————————————————————————————————————————
                                        ;
   4127 8B20 08                         incaddra php
   4128 8B21 C2 20                    +            .byte $c2,$20
                                        
   4129 8B23 E6 A0                                inc addra             ;bump bits 0-15
   4130 8B25 D0 04                                bne .0000010
                                        ;
   4132 8B27 E2 20                    +            .byte $e2,$20
                                        
   4133 8B29 E6 A2                                inc addra+s_word      ;bump bits 16-23
                                        ;
   4135 8B2B 28                         .0000010 plp
   4136 8B2C 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incoper: INCREMENT OPERAND ADDRESS
                                        ;
   4142 8B2D 18                         incoper  clc
   4143 8B2E 08                                   php
   4144 8B2F C2 30                    +            .byte $c2,$30
                                        
   4145 8B31 48                                   pha
   4146 8B32 E6 BB                                inc operand           ;handle base address
   4147 8B34 D0 06                                bne .0000010
                                        ;              
   4149 8B36 E2 20                    +            .byte $e2,$20
                                        
   4150 8B38 E6 BD                                inc operand+s_word    ;handle bank
   4151 8B3A C2 20                    +            .byte $c2,$20
                                        
                                        ;
   4153 8B3C 68                         .0000010 pla
   4154 8B3D 28                                   plp
   4155 8B3E 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;instdata: GET INSTRUCTION SIZE & ADDRESSING MODE DATA
                                        ;
                                        ;	——————————————————————————————————
                                        ;	Preparatory Ops: .X: 65C816 opcode
                                        ;
                                        ;	Returned Values: .A: mode flags
                                        ;	                 .X: operand size
                                        ;	                 .Y: mode index
                                        ;	——————————————————————————————————
                                        ;
   4169 8B3F E2 30                      instdata +         .byte $e2,$30
                                        
   4170 8B41 BD BB 8E                             lda mnetabam,x        ;addressing mode data
   4171 8B44 48                                   pha                   ;save mode flag bits
   4172 8B45 48                                   pha                   ;save size data
   4173 8B46 29 0F                                and #amodmask         ;extract mode index &...
   4174 8B48 A8                                   tay                   ;save
   4175 8B49 68                                   pla                   ;recover data
   4176 8B4A 29 30                                and #opsmask          ;mask mode fields &...
                                        ;         .rept n_opslsr        ;extract operand size
   4178 8B4C 4A                                     lsr
   4179 8B4D 4A                                     lsr
   4180 8B4E 4A                                     lsr
   4181 8B4F 4A                                     lsr
                                        ;         .endr
   4183 8B50 AA                                   tax                   ;operand size
   4184 8B51 68                                   pla                   ;recover mode flags
   4185 8B52 29 C0                                and #vopsmask         ;discard mode & size fields
   4186 8B54 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;offtarg: CONVERT BRANCH OFFSET TO TARGET ADDRESS
                                        ;
                                        ;	———————————————————————————————————————————————
                                        ;	Preparatory Ops:    ADDRA: base address
                                        ;	                 INSTSIZE: instruction size
                                        ;	                  OPERAND: offset
                                        ;
                                        ;	Returned Values:  OPERAND: target address (L/H)
                                        ;	                       .A: used
                                        ;	                       .X: entry value
                                        ;                              .Y: entry value
                                        ;	———————————————————————————————————————————————
                                        ;
   4203 8B55 C2 20                      offtarg +         .byte $c2,$20
                                        
   4204 8B57 A5 A0                                lda addra             ;base address
   4205 8B59 E2 20                    +            .byte $e2,$20
                                        
   4206 8B5B 46 C6                                lsr instsize          ;bit 0 will be set if...
   4207 8B5D B0 07                                bcs .0000010          ;a long branch
                                        ;
   4209 8B5F 24 BB                                bit operand           ;short forward or backward?
   4210 8B61 10 03                                bpl .0000010          ;forward
                                        ;
   4212 8B63 EB                       +            .byte $eb
                                                           ;expose address MSB
   4213 8B64 3A                                   dea                   ;back a page
   4214 8B65 EB                       +            .byte $eb
                                                           ;expose address LSB
                                        ;
   4216 8B66 C2 20                      .0000010 +         .byte $c2,$20
                                        
   4217 8B68 18                                   clc
   4218 8B69 65 BB                                adc operand           ;calculate target address
   4219 8B6B 85 BB                                sta operand           ;new operand
   4220 8B6D E2 20                    +            .byte $e2,$20
                                        
   4221 8B6F A9 03                                lda #s_xword
   4222 8B71 85 C6                                sta instsize          ;effective instruction size
   4223 8B73 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;setxaddr: SET EXECUTION ADDRESS
                                        ;
   4229 8B74 B0 13                      setxaddr bcs .0000010          ;no address given
                                        ;
   4231 8B76 20 CF 8A                             jsr facasize          ;check address...
   4232 8B79 C9 04                                cmp #s_dword          ;range
   4233 8B7B B0 0D                                bcs .0000020          ;out of range
                                        ;
   4235 8B7D C2 20                    +            .byte $c2,$20
                                        
   4236 8B7F A5 A7                                lda faca              ;execution address
   4237 8B81 85 86                                sta reg_pcx           ;set new PC value
   4238 8B83 E2 20                    +            .byte $e2,$20
                                        
   4239 8B85 A5 A9                                lda faca+s_word
   4240 8B87 85 88                                sta reg_pbx           ;set new PB value
                                        ;
   4242 8B89 18                         .0000010 clc                   ;no error
                                        ;
   4244 8B8A 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;targoff: CONVERT BRANCH TARGET ADDRESS TO BRANCH OFFSET                   
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops:   ADDRA: instruction address
                                        ;	                 OPERAND: target address
                                        ;
                                        ;	Returned Values: OPERAND: computed offset
                                        ;	                      .A: effective operand size
                                        ;	                      .X: entry value
                                        ;                             .Y: entry value
                                        ;	                      .C: 1 = branch out of range
                                        ;
                                        ;	Execution notes: ADDRB is set to the branch base
                                        ;	                 address.
                                        ;	—————————————————————————————————————————————————
                                        ;
   4264 8B8B 64 C7                      targoff  stz instsize+s_byte   ;always zero
   4265 8B8D A5 C6                                lda instsize          ;instruction size will tell...
   4266 8B8F 4A                                   lsr                   ;if long or short branch
                                        ;
                                        ;—————————————————————————————————————————————————
   4476 = 000000BA                      .btype   =facc+5               ;branch type flag
                                        ;—————————————————————————————————————————————————
                                        ;
   4272 8B90 66 BA                                ror .btype            ;set branch type...
                                        ;
                                        ;	x0000000
                                        ;	|
                                        ;	+——————————> 0: short
                                        ;	             1: long
                                        ;
   4279 8B92 C2 20                    +            .byte $c2,$20
                                        
   4280 8B94 18                                   clc
   4281 8B95 A5 A0                                lda addra             ;instruction address
   4282 8B97 65 C6                                adc instsize          ;instruction size
   4283 8B99 85 A4                                sta addrb             ;base address
   4284 8B9B 38                                   sec
   4285 8B9C A5 BB                                lda operand           ;target address
   4286 8B9E E5 A4                                sbc addrb             ;base address
   4287 8BA0 85 BB                                sta operand           ;offset
   4288 8BA2 E2 20                    +            .byte $e2,$20
                                        
   4289 8BA4 90 15                                bcc .0000040          ;backward branch
                                        ;
   4291 8BA6 24 BA                                bit .btype            ;check branch range
   4292 8BA8 30 0A                                bmi .0000020          ;long
                                        ;
                                        ;
                                        ;	process short forward branch...
                                        ;
   4297 8BAA EB                       +            .byte $eb
                                                           ;offset MSB should be zero
   4298 8BAB D0 21                                bne .0000060          ;it isn't — out of range
                                        ;
   4300 8BAD EB                       +            .byte $eb
                                                           ;offset LSB should be $00-$7F
   4301 8BAE 30 1E                                bmi .0000060          ;it isn't — out of range
                                        ;
   4303 8BB0 A9 01                      .0000010 lda #s_byte           ;final instruction size
   4304 8BB2 18                                   clc                   ;branch in range
   4305 8BB3 60                                   rts
                                        ;
                                        ;
                                        ;	process long forward branch...
                                        ;
   4310 8BB4 EB                         .0000020 +         .byte $eb
                                                           ;offset MSB should be positive
   4311 8BB5 30 17                                bmi .0000060          ;it isn't — branch out of range
                                        ;
   4313 8BB7 A9 02                      .0000030 lda #s_word
   4314 8BB9 18                                   clc
   4315 8BBA 60                                   rts
                                        ;
                                        ;
                                        ;	process backward branch...
                                        ;
   4320 8BBB 24 BA                      .0000040 bit .btype            ;long or short?
   4321 8BBD 30 0C                                bmi .0000050          ;long
                                        ;
                                        ;
                                        ;	process short backward branch...
                                        ;
   4326 8BBF EB                       +            .byte $eb
                                                           ;offset MSB should be negative
   4327 8BC0 10 0C                                bpl .0000060          ;it isn't — out of range
                                        ;
   4329 8BC2 49 FF                                eor #%11111111        ;complement offset MSB 2s 
   4330 8BC4 D0 08                                bne .0000060          ;out of range
                                        ;
   4332 8BC6 EB                       +            .byte $eb
                                                           ;offset LSB should be $80-$FF
   4333 8BC7 30 E7                                bmi .0000010          ;it is — branch in range
                                        ;
   4335 8BC9 80 03                                bra .0000060          ;branch out of range
                                        ;
                                        ;
                                        ;	process long backward branch...
                                        ;
   4340 8BCB EB                         .0000050 +         .byte $eb
                                                           ;offset MSB should be negative
   4341 8BCC 30 E9                                bmi .0000030          ;it is — branch in range
                                        ;
   4343 8BCE 38                         .0000060 sec                   ;range error
   4344 8BCF 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharr: GET PREVIOUS INPUT BUFFER CHARACTER
                                        ;
   4350 8BD0 C6 BF                      getcharr dec ibufidx           ;move back a char
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getchar: GET A CHARACTER FROM INPUT BUFFER
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops : none
                                        ;
                                        ;	Register Returns: .A: character or <NUL>
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> entry value
                                        ;	           ||||||+————> 1: <NUL> gotten
                                        ;	           |||||+—————> entry value
                                        ;	           ||||+——————> entry value
                                        ;	           |||+———————> entry value
                                        ;	           ||+————————> entry value
                                        ;	           |+—————————> not defined
                                        ;	           +——————————> not defined
                                        ;	——————————————————————————————————————————————
                                        ;
   4376 8BD2 DA                         getchar  phx
   4377 8BD3 5A                                   phy
   4378 8BD4 08                                   php                   ;save register sizes
   4379 8BD5 E2 30                    +            .byte $e2,$30
                                                        ;force 8 bits
   4380 8BD7 A6 BF                                ldx ibufidx           ;buffer index
   4381 8BD9 BD 00 02                             lda ibuffer,x         ;get char
   4382 8BDC E6 BF                                inc ibufidx           ;bump index
   4383 8BDE 28                                   plp                   ;restore register widths
   4384 8BDF 7A                                   ply
   4385 8BE0 FA                                   plx
                                        ; Changed the following to XBA instruction which seems to work as well.
                                        ; XBA doesn't access the stack memory saving a data memory access,
                                        ; and hence is faster.
   4389 8BE1 EB                       +            .byte $eb
                                        		;	pha                   ;condition...
   4390 8BE2 EB                       +            .byte $eb
                                        		;   pla                   ;.Z
   4391 8BE3 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getpat: GET PATTERN FOR MEMORY CHANGE or SEARCH
                                        ;
                                        ;	—————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated pattern in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: pattern length if entered
                                        ;	                 .C: 0 = pattern valid
                                        ;	                     1 = exception:
                                        ;	                 .N  0 = no pattern entered
                                        ;	                     1 = evaluation error
                                        ;
                                        ;	Notes: 1) If pattern is preceded by "'" the following
                                        ;	          characters are interpreted as ASCII.
                                        ;	       2) A maximum of 32 bytes or characters is
                                        ;	          accepted.  Excess input will be discarded.
                                        ;	—————————————————————————————————————————————————————
                                        ;
   4414 8BE4 64 CB                      getpat   stz status            ;clear pattern type indicator
   4415 8BE6 A0 00                                ldy #0                ;pattern index
   4416 8BE8 20 D0 8B                             jsr getcharr          ;get last char
   4417 8BEB F0 3C                                beq .0000070          ;EOS
                                        ;
   4419 8BED A6 BF                                ldx ibufidx           ;current buffer index
   4420 8BEF 20 30 8C                             jsr getcharw          ;get next
   4421 8BF2 F0 35                                beq .0000070          ;EOS
                                        ;
   4423 8BF4 C9 27                                cmp #''''			; *** watch syntax here, the following line of code was omitted when only ''' was present
   4424 8BF6 D0 04                                bne .0000010          ;not ASCII input
                                        ;
   4426 8BF8 66 CB                                ror status            ;condition flag
   4427 8BFA 80 12                                bra .0000030          ;balance of input is ASCII
                                        ;
   4429 8BFC 86 BF                      .0000010 stx ibufidx           ;restore buffer index
                                        ;
   4431 8BFE 20 E3 8A                   .0000020 jsr getparm           ;evaluate numeric pattern
   4432 8C01 B0 21                                bcs .0000060          ;done w/pattern
                                        ;
   4434 8C03 20 CF 8A                             jsr facasize          ;size
   4435 8C06 C9 02                                cmp #s_word
   4436 8C08 B0 1F                                bcs .0000070          ;not a byte — error
                                        ;
   4438 8C0A A5 A7                                lda faca              ;get byte &...
   4439 8C0C 80 05                                bra .0000040          ;store
                                        ;
   4441 8C0E 20 D2 8B                   .0000030 jsr getchar           ;get ASCII char
   4442 8C11 F0 11                                beq .0000060          ;done w/pattern
                                        ;
   4444 8C13 C0 20                      .0000040 cpy #s_auxbuf         ;pattern buffer full?
   4445 8C15 F0 0A                                beq .0000050          ;yes
                                        ;
   4447 8C17 99 51 02                             sta auxbuf,y          ;store pattern
   4448 8C1A C8                                   iny
   4449 8C1B 24 CB                                bit status
   4450 8C1D 10 DF                                bpl .0000020          ;get next numeric value
                                        ;
   4452 8C1F 80 ED                                bra .0000030          ;get next ASCII char
                                        ;
   4454 8C21 20 11 88                   .0000050 jsr alert             ;excess input
                                        ;
   4456 8C24 84 BE                      .0000060 sty auxbufix          ;save pattern size
   4457 8C26 98                                   tya                   ;condition .Z
   4458 8C27 18                                   clc                   ;pattern valid
   4459 8C28 60                                   rts
                                        ;
                                        ;
                                        ;	no pattern entered...
                                        ;
   4464 8C29 C2 80                      .0000070 +         .byte $c2,%10000000
                                        
   4465 8C2B 38                                   sec
   4466 8C2C 60                                   rts
                                        ;
                                        ;
                                        ;	evaluation error...
                                        ;
   4471 8C2D E2 81                      .0000080 +         .byte $e2,%10000001
                                        
   4472 8C2F 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharw: GET FROM INPUT BUFFER, DISCARDING WHITESPACE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;
                                        ;	Notes: Whitespace is defined as a blank ($20) or a
                                        ;	       horizontal tab ($09).
                                        ;	——————————————————————————————————————————————————
                                        ;
   4490 8C30 20 D2 8B                   getcharw jsr getchar           ;get from buffer
   4491 8C33 F0 08                                beq .0000010          ;EOI
                                        ;
   4493 8C35 C9 20                                cmp #' '
   4494 8C37 F0 F7                                beq getcharw          ;discard whitespace
                                        ;
   4496 8C39 C9 09                                cmp #a_ht             ;also whitespace
   4497 8C3B F0 F3                                beq getcharw
                                        ;
   4499 8C3D 18                         .0000010 clc
   4500 8C3E 60                                   rts  
                                        ;
                                        ;================================================================================
                                        ;
                                        ;input: INTERACTIVE INPUT FROM CONSOLE CHANNEL
                                        ;
                                        ;	———————————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Zero IBUFIDX or load IBUFFER with default
                                        ;	                 input & set IBUFIDX to the number of chars
                                        ;	                 loaded into the buffer.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: characters entered
                                        ;	                 .Y: used
                                        ;
                                        ;	Example: STZ IBUFIDX
                                        ;	         JSR INPUT
                                        ;
                                        ;	Notes: Input is collected in IBUFFER & is null-terminated.
                                        ;	       IBUFIDX is reset to zero upon exit.
                                        ;	———————————————————————————————————————————————————————————
                                        ;
   4522 8C3F                            input:
   4523 8C3F A6 BF                       	    ldx ibufidx
   4524 8C41 9E 00 02                             stz ibuffer,x         ;be sure buffer is terminated
   4525 8C44 20 72 87                             jsr dpyibuf           ;print default input if any
   4526 8C47 F4                       +            .byte $f4
   4526 8C48 18 90                    +            .word dc_cn
                                        
   4527 8C4A 20 1D 88                             jsr sprint            ;enable cursor
   4528 8C4D A6 BF                                ldx ibufidx           ;starting buffer index
                                        ;
                                        ;
                                        ;	main input loop...
                                        ;
   4533 8C4F                               .0000010 CPU FT832
   4534 008C4F 42 20 00 FE FC               		 jcr getcha,biosctx            ;poll for input
                                        		 CPU	W65C02
   4536 8C54 90 02                                bcc .0000020          ;got something
                                        ;
                                        ;         jsr	$F409          ;wait 'til any IRQ &... (Reschedule tasks)
   4539 8C56 80 F7                                bra .0000010          ;try again
                                        ;
   4541 8C58                            .0000020
   4542 8C58 C9 7F                       		cmp #a_del            ;above ASCII range?
   4543 8C5A B0 F3                                bcs .0000010          ;yes, ignore
                                        ;
   4545 8C5C C9 09                                cmp #a_ht             ;horizontal tab?
   4546 8C5E D0 02                                bne .0000030          ;no
                                        ;
   4548 8C60 A9 20                                lda #a_blank          ;replace <HT> w/blank
                                        ;
   4550 8C62 C9 20                      .0000030 cmp #a_blank          ;control char?
   4551 8C64 90 12                                bcc .0000050          ;yes
                                        ;
                                        ;
                                        ;	process QWERTY character...
                                        ;
   4556 8C66 E0 50                                cpx #s_ibuf           ;room in buffer?
   4557 8C68 B0 05                                bcs .0000040          ;no
                                        ;
   4559 8C6A 9D 00 02                             sta ibuffer,x         ;store char
   4560 8C6D E8                                   inx                   ;bump index
   4561 8C6E 2C                                   .byte bitabs          ;echo char
                                        ;
   4563 8C6F A9 07                      .0000040 lda #a_bel            ;alert user
                                           		 cpu FT832
   4565 008C71 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   4567 8C76 80 D7                                bra .0000010          ;get some more
                                        ;
                                        ;
                                        ;	process carriage return...
                                        ;
   4572 8C78 C9 0D                      .0000050 cmp #a_cr             ;carriage return?
   4573 8C7A D0 0E                                bne .0000060          ;no
                                        ;
   4575 8C7C DA                                   phx                   ;protect input count
   4576 8C7D F4                       +            .byte $f4
   4576 8C7E 1C 90                    +            .word dc_co
                                        
   4577 8C80 20 1D 88                             jsr sprint            ;cursor off
   4578 8C83 FA                                   plx                   ;recover input count
   4579 8C84 9E 00 02                             stz ibuffer,x         ;terminate input &...
   4580 8C87 64 BF                                stz ibufidx           ;reset buffer index
   4581 8C89 60                                   rts                   ;done
                                        ;
                                        ;
                                        ;	process backspace...
                                        ;
   4586 8C8A C9 08                      .0000060 cmp #a_bs             ;backspace?
   4587 8C8C D0 C1                                bne .0000010          ;no
                                        ;
   4589 8C8E 8A                                   txa
   4590 8C8F F0 BE                                beq .0000010          ;no input, ignore <BS>
                                        ;
   4592 8C91 CA                                   dex                   ;1 less char
   4593 8C92 DA                                   phx                   ;preserve count
   4594 8C93 20 C5 87                             jsr gendbs            ;destructive backspace
   4595 8C96 FA                                   plx                   ;restore count
   4596 8C97 80 B6                                bra .0000010          ;get more input
                                        ;
                                        ;================================================================================
                                        ;
                                        ;lodbnk: LOAD SOURCE & DESTINATION BANKS
                                        ;
   4602 8C99 E2 20                      lodbnk +         .byte $e2,$20
                                        
   4603 8C9B A5 BD                                lda operand+s_word    ;destination bank
   4604 8C9D EB                       +            .byte $eb
                                                           ;make it MSB
   4605 8C9E A5 A2                                lda addra+s_word      ;source bank is LSB
   4606 8CA0 60                                   rts
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;getcharc: GET A CHARACTER FROM INPUT BUFFER & CONVERT CASE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;	——————————————————————————————————————————————————
                                        ;
   4621 8CA1 20 D2 8B                   getcharc jsr getchar           ;get from buffer
   4622 8CA4 F0 0C                                beq touppera          ;just return
                                        ;
                                        ;================================================================================
                                        ;
                                        ;toupper: FORCE CHARACTER TO UPPER CASE
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .A: character to convert
                                        ;
                                        ;	Register Returns: .A: converted character
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: no change
                                        ;
                                        ;	Notes: 1) This subroutine has no effect on char-
                                        ;	          acters that are not alpha.
                                        ;	————————————————————————————————————————————————
                                        ;
   4642 8CA6 08                         toupper  php                   ;protect flags
   4643 8CA7 C9 61                                cmp #a_asclcl         ;check char range
   4644 8CA9 90 06                                bcc .0000010          ;not LC alpha
                                        ;
   4646 8CAB C9 7B                                cmp #a_asclch+s_byte
   4647 8CAD B0 02                                bcs .0000010          ;not LC alpha
                                        ;
   4649 8CAF 29 5F                                and #a_lctouc         ;force to UC
                                        ;
   4651 8CB1 28                         .0000010 plp                   ;restore flags
                                        ;
   4653 8CB2 60                         touppera rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;teststop: TEST FOR STOP KEY
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops: none
                                        ;
                                        ;	Returned Values: .A: detected keypress, if any
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: normal key detected
                                        ;	           |||||||      1: <STOP> detected
                                        ;	           +++++++————> not defined
                                        ;
                                        ;	Example: jsr teststop
                                        ;	         bcs stopped
                                        ;
                                        ;	Notes: The symbol STOPKEY defines the ASCII
                                        ;	       value of the "stop key."
                                        ;	——————————————————————————————————————————————
                                        ;
   4679 8CB3                            teststop 
                                            		CPU	TF832
   4681 000008CB3                           		jcr getcha,biosctx            ;poll console
                                        		CPU	W65C02
   4683 8CB3 B0 04                                bcs .0000010          ;no input
                                        ;
   4685 8CB5 C9 03                                cmp #stopkey          ;stop key pressed?
   4686 8CB7 F0 01                                beq .0000020          ;yes
                                        ;
   4688 8CB9 18                         .0000010 clc
                                        ;
   4690 8CBA 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;COMMAND PROCESSING DATA TABLES
                                        ;
                                        ;
                                        ;	monitor commands...
                                        ;
   4699 8CBB 41                         mpctab   .byte "A"             ;assemble code
   4700 8CBC 43                                   .byte "C"             ;compare memory ranges
   4701 8CBD 44                                   .byte "D"             ;disassemble code
   4702 8CBE 46                                   .byte "F"             ;fill memory
   4703 8CBF 47                                   .byte "G"             ;execute code
   4704 8CC0 48                                   .byte "H"             ;search memory
   4705 8CC1 4A                                   .byte "J"             ;execute code as subroutine
   4706 8CC2 4D                                   .byte "M"             ;dump memory range
   4707 8CC3 52                                   .byte "R"             ;dump registers
   4708 8CC4 54                                   .byte "T"             ;copy memory range
   4709 8CC5 58                                   .byte "X"             ;exit from monitor
   4710 8CC6 3E                                   .byte ">"             ;change memory
   4711 8CC7 3B                                   .byte ";"             ;change registers
   4938 = 0000000D                      n_mpctab =*-mpctab             ;entries in above table
                                        ;
                                        ;
                                        ;	monitor command jump table...
                                        ;
   4717 8CC8 6B 81                      mpcextab .word monasc-s_byte   ; A  assemble code
   4718 8CCA 2F 84                                .word moncmp-s_byte   ; C  compare memory ranges
   4719 8CCC 49 83                                .word mondsc-s_byte   ; D  disassemble code
   4720 8CCE 00 85                                .word monfil-s_byte   ; F  fill memory
   4721 8CD0 9D 83                                .word monjmp-s_byte   ; G  execute code
   4722 8CD2 66 85                                .word monhnt-s_byte   ; H  search memory
   4723 8CD4 CE 83                                .word monjsr-s_byte   ; J  execute code as subroutine
   4724 8CD6 AE 84                                .word mondmp-s_byte   ; M  dump memory range
   4725 8CD8 7E 80                                .word monreg-s_byte   ; R  dump registers
   4726 8CDA 5D 84                                .word moncpy-s_byte   ; T  copy memory range
   4727 8CDC 17 86                                .word monxit-s_byte   ; X  exit from monitor
   4728 8CDE 04 84                                .word monchm-s_byte   ; >  change memory
   4729 8CE0 DC 85                                .word monchr-s_byte   ; ;  change registers
                                        ;
                                        ;
                                        ;	number conversion...
                                        ;        
   4734 8CE2 10 0A 08 02                basetab  .byte 16,10,8,2       ;supported number bases
   4735 8CE6 04 03 03 01                bitsdtab .byte 4,3,3,1         ;bits per binary digit
   4736 8CEA 04 04 03 01                bitsntab .byte 4,4,3,1         ;bits per ASCII character
   4737 8CEE 03 02 09 02                lzsttab  .byte 3,2,9,2         ;leading zero suppression thresholds
   4738 8CF2 0C 0C 10 30                numstab  .byte 12,12,16,48     ;bin to ASCII conversion numerals
   4739 8CF6 24                         radxtab  .byte c_hex           ;hexadecimal radix
   4740 8CF7 2B                                   .byte c_dec           ;decimal radix
   4741 8CF8 40                                   .byte c_oct           ;octal radix
   4742 8CF9 25                                   .byte c_bin           ;binary radix
   4969 = 00000004                      n_radix  =*-radxtab            ;number of recognized radices
                                        ;
                                        ;
                                        ;	shadow MPU register sizes...
                                        ;
   4748 8CFA 02                         rcvltab  .byte s_mpupbx+s_byte ; PB
   4749 8CFB 03                                   .byte s_mpupcx+s_byte ; PC
   4750 8CFC 02                                   .byte s_mpusrx+s_byte ; SR
   4751 8CFD 03                                   .byte s_word+s_byte   ; .C
   4752 8CFE 03                                   .byte s_word+s_byte   ; .X
   4753 8CFF 03                                   .byte s_word+s_byte   ; .Y
   4754 8D00 03                                   .byte s_mpuspx+s_byte ; SP
   4755 8D01 03                                   .byte s_mpudpx+s_byte ; DP
   4756 8D02 02                                   .byte s_mpudbx+s_byte ; DB
   4983 = 00000009                      n_regchv =*-rcvltab            ;total shadow registers
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER DATA TABLES
                                        ;
                                        ;
                                        ;	numerically sorted & encoded W65C816S mnemonics...
                                        ;
   4766 8D03 F2 10                      mnetab   .word mne_xba         ;  0 — XBA
   4767 8D05 5A 11                                .word mne_lda         ;  1 — LDA
   4768 8D07 A2 11                                .word mne_pea         ;  2 — PEA
   4769 8D09 62 12                                .word mne_pha         ;  3 — PHA
   4770 8D0B 62 13                                .word mne_pla         ;  4 — PLA
   4771 8D0D C6 14                                .word mne_bra         ;  5 — BRA
   4772 8D0F E0 14                                .word mne_ora         ;  6 — ORA
   4773 8D11 68 15                                .word mne_sta         ;  7 — STA
   4774 8D13 6A 16                                .word mne_txa         ;  8 — TXA
   4775 8D15 AA 16                                .word mne_tya         ;  9 — TYA
   4776 8D17 62 1A                                .word mne_phb         ; 10 — PHB
   4777 8D19 62 1B                                .word mne_plb         ; 11 — PLB
   4778 8D1B EA 1C                                .word mne_trb         ; 12 — TRB
   4779 8D1D 2A 1D                                .word mne_tsb         ; 13 — TSB
   4780 8D1F E8 20                                .word mne_sbc         ; 14 — SBC
   4781 8D21 06 21                                .word mne_bcc         ; 15 — BCC
   4782 8D23 44 21                                .word mne_adc         ; 16 — ADC
   4783 8D25 6A 21                                .word mne_tdc         ; 17 — TDC
   4784 8D27 8A 21                                .word mne_dec         ; 18 — DEC
   4785 8D29 A8 21                                .word mne_sec         ; 19 — SEC
   4786 8D2B 48 23                                .word mne_clc         ; 20 — CLC
   4787 8D2D D4 23                                .word mne_inc         ; 21 — INC
   4788 8D2F 2A 25                                .word mne_tsc         ; 22 — TSC
   4789 8D31 C6 25                                .word mne_bvc         ; 23 — BVC
   4790 8D33 2A 29                                .word mne_tcd         ; 24 — TCD
   4791 8D35 A8 29                                .word mne_sed         ; 25 — SED
   4792 8D37 62 2A                                .word mne_phd         ; 26 — PHD
   4793 8D39 48 2B                                .word mne_cld         ; 27 — CLD
   4794 8D3B 62 2B                                .word mne_pld         ; 28 — PLD
   4795 8D3D C4 2B                                .word mne_and         ; 29 — AND
   4796 8D3F 32 31                                .word mne_xce         ; 30 — XCE
   4797 8D41 C6 33                                .word mne_bne         ; 31 — BNE
   4798 8D43 B0 50                                .word mne_wai         ; 32 — WAI
   4799 8D45 A2 51                                .word mne_pei         ; 33 — PEI
   4800 8D47 A8 51                                .word mne_sei         ; 34 — SEI
   4801 8D49 48 53                                .word mne_cli         ; 35 — CLI
   4802 8D4B 86 53                                .word mne_bmi         ; 36 — BMI
   4803 8D4D 66 55                                .word mne_rti         ; 37 — RTI
   4804 8D4F 62 62                                .word mne_phk         ; 38 — PHK
   4805 8D51 C6 64                                .word mne_brk         ; 39 — BRK
   4806 8D53 96 6B                                .word mne_jml         ; 40 — JML
   4807 8D55 26 6C                                .word mne_rol         ; 41 — ROL
   4808 8D57 46 6C                                .word mne_bpl         ; 42 — BPL
   4809 8D59 C6 6C                                .word mne_brl         ; 43 — BRL
   4810 8D5B 04 6D                                .word mne_asl         ; 44 — ASL
   4811 8D5D 16 6D                                .word mne_jsl         ; 45 — JSL
   4812 8D5F 66 6D                                .word mne_rtl         ; 46 — RTL
   4813 8D61 70 71                                .word mne_wdm         ; 47 — WDM
   4814 8D63 DC 7D                                .word mne_mvn         ; 48 — MVN
   4815 8D65 A6 89                                .word mne_rep         ; 49 — REP
   4816 8D67 A8 89                                .word mne_sep         ; 50 — SEP
   4817 8D69 62 8A                                .word mne_php         ; 51 — PHP
   4818 8D6B 62 8B                                .word mne_plp         ; 52 — PLP
   4819 8D6D 88 8B                                .word mne_cmp         ; 53 — CMP
   4820 8D6F 96 8B                                .word mne_jmp         ; 54 — JMP
   4821 8D71 08 8C                                .word mne_cop         ; 55 — COP
   4822 8D73 1E 8C                                .word mne_nop         ; 56 — NOP
   4823 8D75 68 8D                                .word mne_stp         ; 57 — STP
   4824 8D77 DC 8D                                .word mne_mvp         ; 58 — MVP
   4825 8D79 86 91                                .word mne_beq         ; 59 — BEQ
   4826 8D7B A2 99                                .word mne_per         ; 60 — PER
   4827 8D7D 0C 9C                                .word mne_eor         ; 61 — EOR
   4828 8D7F 26 9C                                .word mne_ror         ; 62 — ROR
   4829 8D81 16 9D                                .word mne_jsr         ; 63 — JSR
   4830 8D83 1A 9D                                .word mne_lsr         ; 64 — LSR
   4831 8D85 06 A1                                .word mne_bcs         ; 65 — BCS
   4832 8D87 2A A1                                .word mne_tcs         ; 66 — TCS
   4833 8D89 66 A5                                .word mne_rts         ; 67 — RTS
   4834 8D8B C6 A5                                .word mne_bvs         ; 68 — BVS
   4835 8D8D 6A A6                                .word mne_txs         ; 69 — TXS
   4836 8D8F 86 AA                                .word mne_bit         ; 70 — BIT
   4837 8D91 48 BB                                .word mne_clv         ; 71 — CLV
   4838 8D93 AA C8                                .word mne_tax         ; 72 — TAX
   4839 8D95 5A C9                                .word mne_ldx         ; 73 — LDX
   4840 8D97 8A C9                                .word mne_dex         ; 74 — DEX
   4841 8D99 62 CA                                .word mne_phx         ; 75 — PHX
   4842 8D9B 62 CB                                .word mne_plx         ; 76 — PLX
   4843 8D9D D4 CB                                .word mne_inx         ; 77 — INX
   4844 8D9F 48 CC                                .word mne_cpx         ; 78 — CPX
   4845 8DA1 2A CD                                .word mne_tsx         ; 79 — TSX
   4846 8DA3 68 CD                                .word mne_stx         ; 80 — STX
   4847 8DA5 AA CE                                .word mne_tyx         ; 81 — TYX
   4848 8DA7 AA D0                                .word mne_tay         ; 82 — TAY
   4849 8DA9 5A D1                                .word mne_ldy         ; 83 — LDY
   4850 8DAB 8A D1                                .word mne_dey         ; 84 — DEY
   4851 8DAD 62 D2                                .word mne_phy         ; 85 — PHY
   4852 8DAF 62 D3                                .word mne_ply         ; 86 — PLY
   4853 8DB1 D4 D3                                .word mne_iny         ; 87 — INY
   4854 8DB3 48 D4                                .word mne_cpy         ; 88 — CPY
   4855 8DB5 68 D5                                .word mne_sty         ; 89 — STY
   4856 8DB7 6A D6                                .word mne_txy         ; 90 — TXY
   4857 8DB9 68 DD                                .word mne_stz         ; 91 — STZ
                                        ;
   5085 = 000000B8                      s_mnetab =*-mnetab             ;mnemonic table size
   5086 = 0000005C                      n_mnemon =s_mnetab/s_word      ;total mnemonics
                                        ;
                                        ;
                                        ;	mnemonic lookup indices in opcode order...
                                        ;
   4865 8DBB 27                         mnetabix .byte mne_brkx        ; $00  BRK
   4866 8DBC 06                                   .byte mne_orax        ; $01  ORA (dp,X)
   4867 8DBD 37                                   .byte mne_copx        ; $02  COP
   4868 8DBE 06                                   .byte mne_orax        ; $03  ORA offset,S
   4869 8DBF 0D                                   .byte mne_tsbx        ; $04  TSB dp
   4870 8DC0 06                                   .byte mne_orax        ; $05  ORA dp
   4871 8DC1 2C                                   .byte mne_aslx        ; $06  ASL dp
   4872 8DC2 06                                   .byte mne_orax        ; $07  ORA [dp]
   4873 8DC3 33                                   .byte mne_phpx        ; $08  PHP
   4874 8DC4 06                                   .byte mne_orax        ; $09  ORA #
   4875 8DC5 2C                                   .byte mne_aslx        ; $0A  ASL A
   4876 8DC6 1A                                   .byte mne_phdx        ; $0B  PHD
   4877 8DC7 0D                                   .byte mne_tsbx        ; $0C  TSB abs
   4878 8DC8 06                                   .byte mne_orax        ; $0D  ORA abs
   4879 8DC9 2C                                   .byte mne_aslx        ; $0E  ASL abs
   4880 8DCA 06                                   .byte mne_orax        ; $0F  ORA absl
                                        ;
   4882 8DCB 2A                                   .byte mne_bplx        ; $10  BPL abs
   4883 8DCC 06                                   .byte mne_orax        ; $11  ORA (dp),Y
   4884 8DCD 06                                   .byte mne_orax        ; $12  ORA (dp)
   4885 8DCE 06                                   .byte mne_orax        ; $13  ORA (offset,S),Y
   4886 8DCF 0C                                   .byte mne_trbx        ; $14  TRB dp
   4887 8DD0 06                                   .byte mne_orax        ; $15  ORA dp,X
   4888 8DD1 2C                                   .byte mne_aslx        ; $16  ASL dp,X
   4889 8DD2 06                                   .byte mne_orax        ; $17  ORA [dp],Y
   4890 8DD3 14                                   .byte mne_clcx        ; $18  CLC
   4891 8DD4 06                                   .byte mne_orax        ; $19  ORA abs
   4892 8DD5 15                                   .byte mne_incx        ; $1A  INC A
   4893 8DD6 42                                   .byte mne_tcsx        ; $1B  TCS
   4894 8DD7 0C                                   .byte mne_trbx        ; $1C  TRB abs
   4895 8DD8 06                                   .byte mne_orax        ; $1D  ORA abs,X
   4896 8DD9 2C                                   .byte mne_aslx        ; $1E  ASL abs,X
   4897 8DDA 06                                   .byte mne_orax        ; $1F  ORA absl,X
                                        ;
   4899 8DDB 3F                                   .byte mne_jsrx        ; $20  JSR abs
   4900 8DDC 1D                                   .byte mne_andx        ; $21  AND (dp,X)
   4901 8DDD 2D                                   .byte mne_jslx        ; $22  JSL absl
   4902 8DDE 1D                                   .byte mne_andx        ; $23  AND offset,S
   4903 8DDF 46                                   .byte mne_bitx        ; $24  BIT dp
   4904 8DE0 1D                                   .byte mne_andx        ; $25  AND dp
   4905 8DE1 29                                   .byte mne_rolx        ; $26  ROL dp
   4906 8DE2 1D                                   .byte mne_andx        ; $27  AND [dp]
   4907 8DE3 34                                   .byte mne_plpx        ; $28  PLP
   4908 8DE4 1D                                   .byte mne_andx        ; $29  AND #
   4909 8DE5 29                                   .byte mne_rolx        ; $2A  ROL A
   4910 8DE6 1C                                   .byte mne_pldx        ; $2B  PLD
   4911 8DE7 46                                   .byte mne_bitx        ; $2C  BIT abs
   4912 8DE8 1D                                   .byte mne_andx        ; $2D  AND abs
   4913 8DE9 29                                   .byte mne_rolx        ; $2E  ROL abs
   4914 8DEA 1D                                   .byte mne_andx        ; $2F  AND absl
                                        ;
   4916 8DEB 24                                   .byte mne_bmix        ; $30  BMI abs
   4917 8DEC 1D                                   .byte mne_andx        ; $31  AND (dp),Y
   4918 8DED 1D                                   .byte mne_andx        ; $32  AND (dp)
   4919 8DEE 1D                                   .byte mne_andx        ; $33  AND (offset,S),Y
   4920 8DEF 46                                   .byte mne_bitx        ; $34  BIT dp,X
   4921 8DF0 1D                                   .byte mne_andx        ; $35  AND dp,X
   4922 8DF1 29                                   .byte mne_rolx        ; $36  ROL dp,X
   4923 8DF2 1D                                   .byte mne_andx        ; $37  AND [dp],Y
   4924 8DF3 13                                   .byte mne_secx        ; $38  SEC
   4925 8DF4 1D                                   .byte mne_andx        ; $39  AND abs,Y
   4926 8DF5 12                                   .byte mne_decx        ; $3A  DEC A
   4927 8DF6 16                                   .byte mne_tscx        ; $3B  TSC
   4928 8DF7 46                                   .byte mne_bitx        ; $3C  BIT abs,X
   4929 8DF8 1D                                   .byte mne_andx        ; $3D  AND abs,X
   4930 8DF9 29                                   .byte mne_rolx        ; $3E  ROL abs,X
   4931 8DFA 1D                                   .byte mne_andx        ; $3F  AND absl,X
                                        ;
   4933 8DFB 25                                   .byte mne_rtix        ; $40  RTI
   4934 8DFC 3D                                   .byte mne_eorx        ; $41  EOR (dp,X)
   4935 8DFD 2F                                   .byte mne_wdmx        ; $42  WDM
   4936 8DFE 3D                                   .byte mne_eorx        ; $43  EOR offset,S
   4937 8DFF 3A                                   .byte mne_mvpx        ; $44  MVP sb,db
   4938 8E00 3D                                   .byte mne_eorx        ; $45  EOR dp
   4939 8E01 40                                   .byte mne_lsrx        ; $46  LSR dp
   4940 8E02 3D                                   .byte mne_eorx        ; $47  EOR [dp]
   4941 8E03 03                                   .byte mne_phax        ; $48  PHA
   4942 8E04 3D                                   .byte mne_eorx        ; $49  EOR #
   4943 8E05 40                                   .byte mne_lsrx        ; $4A  LSR A
   4944 8E06 26                                   .byte mne_phkx        ; $4B  PHK
   4945 8E07 36                                   .byte mne_jmpx        ; $4C  JMP abs
   4946 8E08 3D                                   .byte mne_eorx        ; $4D  EOR abs
   4947 8E09 40                                   .byte mne_lsrx        ; $4E  LSR abs
   4948 8E0A 3D                                   .byte mne_eorx        ; $4F  EOR absl
                                        ;
   4950 8E0B 17                                   .byte mne_bvcx        ; $50  BVC abs
   4951 8E0C 3D                                   .byte mne_eorx        ; $51  EOR (dp),Y
   4952 8E0D 3D                                   .byte mne_eorx        ; $52  EOR (dp)
   4953 8E0E 3D                                   .byte mne_eorx        ; $53  EOR (offset,S),Y
   4954 8E0F 30                                   .byte mne_mvnx        ; $54  MVN sb,db
   4955 8E10 3D                                   .byte mne_eorx        ; $55  EOR dp,X
   4956 8E11 40                                   .byte mne_lsrx        ; $56  LSR dp,X
   4957 8E12 3D                                   .byte mne_eorx        ; $57  EOR [dp],Y
   4958 8E13 23                                   .byte mne_clix        ; $58  CLI
   4959 8E14 3D                                   .byte mne_eorx        ; $59  EOR abs,Y
   4960 8E15 55                                   .byte mne_phyx        ; $5A  PHY
   4961 8E16 18                                   .byte mne_tcdx        ; $5B  TCD
   4962 8E17 28                                   .byte mne_jmlx        ; $5C  JML absl
   4963 8E18 3D                                   .byte mne_eorx        ; $5D  EOR abs,X
   4964 8E19 40                                   .byte mne_lsrx        ; $5E  LSR abs,X
   4965 8E1A 3D                                   .byte mne_eorx        ; $5F  EOR absl,X
                                        ;
   4967 8E1B 43                                   .byte mne_rtsx        ; $60  RTS
   4968 8E1C 10                                   .byte mne_adcx        ; $61  ADC (dp,X)
   4969 8E1D 3C                                   .byte mne_perx        ; $62  PER
   4970 8E1E 10                                   .byte mne_adcx        ; $63  ADC offset,S
   4971 8E1F 5B                                   .byte mne_stzx        ; $64  STZ dp
   4972 8E20 10                                   .byte mne_adcx        ; $65  ADC dp
   4973 8E21 3E                                   .byte mne_rorx        ; $66  ROR dp
   4974 8E22 10                                   .byte mne_adcx        ; $67  ADC [dp]
   4975 8E23 04                                   .byte mne_plax        ; $68  PLA
   4976 8E24 10                                   .byte mne_adcx        ; $69  ADC #
   4977 8E25 3E                                   .byte mne_rorx        ; $6A  ROR A
   4978 8E26 2E                                   .byte mne_rtlx        ; $6B  RTL
   4979 8E27 36                                   .byte mne_jmpx        ; $6C  JMP (abs)
   4980 8E28 10                                   .byte mne_adcx        ; $6D  ADC abs
   4981 8E29 3E                                   .byte mne_rorx        ; $6E  ROR abs
   4982 8E2A 10                                   .byte mne_adcx        ; $6F  ADC absl
                                        ;
   4984 8E2B 44                                   .byte mne_bvsx        ; $70  BVS abs
   4985 8E2C 10                                   .byte mne_adcx        ; $71  ADC (dp),Y
   4986 8E2D 10                                   .byte mne_adcx        ; $72  ADC (dp)
   4987 8E2E 10                                   .byte mne_adcx        ; $73  ADC (offset,S),Y
   4988 8E2F 5B                                   .byte mne_stzx        ; $74  STZ dp,X
   4989 8E30 10                                   .byte mne_adcx        ; $75  ADC dp,X
   4990 8E31 3E                                   .byte mne_rorx        ; $76  ROR dp,X
   4991 8E32 10                                   .byte mne_adcx        ; $77  ADC [dp],Y
   4992 8E33 22                                   .byte mne_seix        ; $78  SEI
   4993 8E34 10                                   .byte mne_adcx        ; $79  ADC abs,Y
   4994 8E35 56                                   .byte mne_plyx        ; $7A  PLY
   4995 8E36 11                                   .byte mne_tdcx        ; $7B  TDC
   4996 8E37 36                                   .byte mne_jmpx        ; $7C  JMP (abs,X)
   4997 8E38 10                                   .byte mne_adcx        ; $7D  ADC abs,X
   4998 8E39 3E                                   .byte mne_rorx        ; $7E  ROR abs,X
   4999 8E3A 10                                   .byte mne_adcx        ; $7F  ADC absl,X
                                        ;
   5001 8E3B 05                                   .byte mne_brax        ; $80  BRA abs
   5002 8E3C 07                                   .byte mne_stax        ; $81  STA (dp,X)
   5003 8E3D 2B                                   .byte mne_brlx        ; $82  BRL abs
   5004 8E3E 07                                   .byte mne_stax        ; $83  STA offset,S
   5005 8E3F 59                                   .byte mne_styx        ; $84  STY dp
   5006 8E40 07                                   .byte mne_stax        ; $85  STA dp
   5007 8E41 50                                   .byte mne_stxx        ; $86  STX dp
   5008 8E42 07                                   .byte mne_stax        ; $87  STA [dp]
   5009 8E43 54                                   .byte mne_deyx        ; $88  DEY
   5010 8E44 46                                   .byte mne_bitx        ; $89  BIT #
   5011 8E45 08                                   .byte mne_txax        ; $8A  TXA
   5012 8E46 0A                                   .byte mne_phbx        ; $8B  PHB
   5013 8E47 59                                   .byte mne_styx        ; $8C  STY abs
   5014 8E48 07                                   .byte mne_stax        ; $8D  STA abs
   5015 8E49 50                                   .byte mne_stxx        ; $8E  STX abs
   5016 8E4A 07                                   .byte mne_stax        ; $8F  STA absl
                                        ;
   5018 8E4B 0F                                   .byte mne_bccx        ; $90  BCC abs
   5019 8E4C 07                                   .byte mne_stax        ; $91  STA (dp),Y
   5020 8E4D 07                                   .byte mne_stax        ; $92  STA (dp)
   5021 8E4E 07                                   .byte mne_stax        ; $93  STA (offset,S),Y
   5022 8E4F 59                                   .byte mne_styx        ; $94  STY dp,X
   5023 8E50 07                                   .byte mne_stax        ; $95  STA dp,X
   5024 8E51 50                                   .byte mne_stxx        ; $96  STX dp,Y
   5025 8E52 07                                   .byte mne_stax        ; $97  STA [dp],Y
   5026 8E53 09                                   .byte mne_tyax        ; $98  TYA
   5027 8E54 07                                   .byte mne_stax        ; $99  STA abs,Y
   5028 8E55 45                                   .byte mne_txsx        ; $9A  TXS
   5029 8E56 5A                                   .byte mne_txyx        ; $9B  TXY
   5030 8E57 5B                                   .byte mne_stzx        ; $9C  STZ abs
   5031 8E58 07                                   .byte mne_stax        ; $9D  STA abs,X
   5032 8E59 5B                                   .byte mne_stzx        ; $9E  STZ abs,X
   5033 8E5A 07                                   .byte mne_stax        ; $9F  STA absl,X
                                        ;
   5035 8E5B 53                                   .byte mne_ldyx        ; $A0  LDY #
   5036 8E5C 01                                   .byte mne_ldax        ; $A1  LDA (dp,X)
   5037 8E5D 49                                   .byte mne_ldxx        ; $A2  LDX #
   5038 8E5E 01                                   .byte mne_ldax        ; $A3  LDA offset,S
   5039 8E5F 53                                   .byte mne_ldyx        ; $A4  LDY dp
   5040 8E60 01                                   .byte mne_ldax        ; $A5  LDA dp
   5041 8E61 49                                   .byte mne_ldxx        ; $A6  LDX dp
   5042 8E62 01                                   .byte mne_ldax        ; $A7  LDA [dp]
   5043 8E63 52                                   .byte mne_tayx        ; $A8  TAY
   5044 8E64 01                                   .byte mne_ldax        ; $A9  LDA #
   5045 8E65 48                                   .byte mne_taxx        ; $AA  TAX
   5046 8E66 0B                                   .byte mne_plbx        ; $AB  PLB
   5047 8E67 53                                   .byte mne_ldyx        ; $AC  LDY abs
   5048 8E68 01                                   .byte mne_ldax        ; $AD  LDA abs
   5049 8E69 49                                   .byte mne_ldxx        ; $AE  LDX abs
   5050 8E6A 01                                   .byte mne_ldax        ; $AF  LDA absl
                                        ;
   5052 8E6B 41                                   .byte mne_bcsx        ; $B0  BCS abs
   5053 8E6C 01                                   .byte mne_ldax        ; $B1  LDA (dp),Y
   5054 8E6D 01                                   .byte mne_ldax        ; $B2  LDA (dp)
   5055 8E6E 01                                   .byte mne_ldax        ; $B3  LDA (offset,S),Y
   5056 8E6F 53                                   .byte mne_ldyx        ; $B4  LDY dp,X
   5057 8E70 01                                   .byte mne_ldax        ; $B5  LDA dp,X
   5058 8E71 49                                   .byte mne_ldxx        ; $B6  LDX dp,Y
   5059 8E72 01                                   .byte mne_ldax        ; $B7  LDA [dp],Y
   5060 8E73 47                                   .byte mne_clvx        ; $B8  CLV
   5061 8E74 01                                   .byte mne_ldax        ; $B9  LDA abs,Y
   5062 8E75 4F                                   .byte mne_tsxx        ; $BA  TSX
   5063 8E76 51                                   .byte mne_tyxx        ; $BB  TYX
   5064 8E77 53                                   .byte mne_ldyx        ; $BC  LDY abs,X
   5065 8E78 01                                   .byte mne_ldax        ; $BD  LDA abs,X
   5066 8E79 49                                   .byte mne_ldxx        ; $BE  LDX abs,Y
   5067 8E7A 01                                   .byte mne_ldax        ; $BF  LDA absl,X
                                        ;
   5069 8E7B 58                                   .byte mne_cpyx        ; $C0  CPY #
   5070 8E7C 35                                   .byte mne_cmpx        ; $C1  CMP (dp,X)
   5071 8E7D 31                                   .byte mne_repx        ; $C2  REP #
   5072 8E7E 35                                   .byte mne_cmpx        ; $C3  CMP offset,S
   5073 8E7F 58                                   .byte mne_cpyx        ; $C4  CPY dp
   5074 8E80 35                                   .byte mne_cmpx        ; $C5  CMP dp
   5075 8E81 12                                   .byte mne_decx        ; $C6  DEC dp
   5076 8E82 35                                   .byte mne_cmpx        ; $C7  CMP [dp]
   5077 8E83 57                                   .byte mne_inyx        ; $C8  INY
   5078 8E84 35                                   .byte mne_cmpx        ; $C9  CMP #
   5079 8E85 4A                                   .byte mne_dexx        ; $CA  DEX
   5080 8E86 20                                   .byte mne_waix        ; $CB  WAI
   5081 8E87 58                                   .byte mne_cpyx        ; $CC  CPY abs
   5082 8E88 35                                   .byte mne_cmpx        ; $CD  CMP abs
   5083 8E89 12                                   .byte mne_decx        ; $CE  DEC abs
   5084 8E8A 35                                   .byte mne_cmpx        ; $CF  CMP absl
                                        ;
   5086 8E8B 1F                                   .byte mne_bnex        ; $D0  BNE abs
   5087 8E8C 35                                   .byte mne_cmpx        ; $D1  CMP (dp),Y
   5088 8E8D 35                                   .byte mne_cmpx        ; $D2  CMP (dp)
   5089 8E8E 35                                   .byte mne_cmpx        ; $D3  CMP (offset,S),Y
   5090 8E8F 21                                   .byte mne_peix        ; $D4  PEI dp
   5091 8E90 35                                   .byte mne_cmpx        ; $D5  CMP dp,X
   5092 8E91 12                                   .byte mne_decx        ; $D6  DEC dp,X
   5093 8E92 35                                   .byte mne_cmpx        ; $D7  CMP [dp],Y
   5094 8E93 1B                                   .byte mne_cldx        ; $D8  CLD
   5095 8E94 35                                   .byte mne_cmpx        ; $D9  CMP abs,Y
   5096 8E95 4B                                   .byte mne_phxx        ; $DA  PHX
   5097 8E96 39                                   .byte mne_stpx        ; $DB  STP
   5098 8E97 36                                   .byte mne_jmpx        ; $DC  JMP [abs]
   5099 8E98 35                                   .byte mne_cmpx        ; $DD  CMP abs,X
   5100 8E99 12                                   .byte mne_decx        ; $DE  DEC abs,X
   5101 8E9A 35                                   .byte mne_cmpx        ; $DF  CMP absl,X
                                        ;
   5103 8E9B 4E                                   .byte mne_cpxx        ; $E0  CPX #
   5104 8E9C 0E                                   .byte mne_sbcx        ; $E1  SBC (dp,X)
   5105 8E9D 32                                   .byte mne_sepx        ; $E2  SEP #
   5106 8E9E 0E                                   .byte mne_sbcx        ; $E3  SBC offset,S
   5107 8E9F 4E                                   .byte mne_cpxx        ; $E4  CPX dp
   5108 8EA0 0E                                   .byte mne_sbcx        ; $E5  SBC dp
   5109 8EA1 15                                   .byte mne_incx        ; $E6  INC dp
   5110 8EA2 0E                                   .byte mne_sbcx        ; $E7  SBC [dp]
   5111 8EA3 4D                                   .byte mne_inxx        ; $E8  INX
   5112 8EA4 0E                                   .byte mne_sbcx        ; $E9  SBC #
   5113 8EA5 38                                   .byte mne_nopx        ; $EA  NOP
   5114 8EA6 00                                   .byte mne_xbax        ; $EB  XBA
   5115 8EA7 4E                                   .byte mne_cpxx        ; $EC  CPX abs
   5116 8EA8 0E                                   .byte mne_sbcx        ; $ED  SBC abs
   5117 8EA9 15                                   .byte mne_incx        ; $EE  INC abs
   5118 8EAA 0E                                   .byte mne_sbcx        ; $EF  SBC absl
                                        ;
   5120 8EAB 3B                                   .byte mne_beqx        ; $F0  BEQ abs
   5121 8EAC 0E                                   .byte mne_sbcx        ; $F1  SBC (dp),Y
   5122 8EAD 0E                                   .byte mne_sbcx        ; $F2  SBC (dp)
   5123 8EAE 0E                                   .byte mne_sbcx        ; $F3  SBC (offset,S),Y
   5124 8EAF 02                                   .byte mne_peax        ; $F4  PEA #
   5125 8EB0 0E                                   .byte mne_sbcx        ; $F5  SBC dp,X
   5126 8EB1 15                                   .byte mne_incx        ; $F6  INC dp,X
   5127 8EB2 0E                                   .byte mne_sbcx        ; $F7  SBC [dp],Y
   5128 8EB3 19                                   .byte mne_sedx        ; $F8  SED
   5129 8EB4 0E                                   .byte mne_sbcx        ; $F9  SBC abs,Y
   5130 8EB5 4C                                   .byte mne_plxx        ; $FA  PLX
   5131 8EB6 1E                                   .byte mne_xcex        ; $FB  XCE
   5132 8EB7 3F                                   .byte mne_jsrx        ; $FC  JSR (abs,X)
   5133 8EB8 0E                                   .byte mne_sbcx        ; $FD  SBC abs,X
   5134 8EB9 15                                   .byte mne_incx        ; $FE  INC abs,X
   5135 8EBA 0E                                   .byte mne_sbcx        ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	instruction addressing modes & sizes in opcode order...
                                        ;
                                        ;	    xxxxxxxx
                                        ;	    ||||||||
                                        ;	    ||||++++———> Addressing Mode
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||          0000  dp, abs, absl, implied or A
                                        ;	    ||||          0001  #
                                        ;	    ||||          0010  dp,X, abs,X or absl,X
                                        ;	    ||||          0011  dp,Y or abs,Y
                                        ;	    ||||          0100  (dp) or (abs)
                                        ;	    ||||          0101  [dp] or [abs]
                                        ;	    ||||          0110  [dp],Y
                                        ;	    ||||          0111  (dp,X) or (abs,X)
                                        ;	    ||||          1000  (dp),Y
                                        ;	    ||||          1001  offset,S
                                        ;	    ||||          1010  (offset,S),Y
                                        ;	    ||||          1011  sbnk,dbnk (MVN or MVP)
                                        ;	    ||||          —-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—
                                        ;	    ||||           #    = immediate
                                        ;	    ||||           A    = accumulator
                                        ;	    ||||           abs  = absolute
                                        ;	    ||||           absl = absolute long
                                        ;	    ||||           dbnk = destination bank
                                        ;	    ||||           dp   = direct (zero) page
                                        ;	    ||||           S    = stack relative
                                        ;	    ||||           sbnk = source bank
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||
                                        ;	    ||++———————> binary-encoded operand size
                                        ;	    |+—————————> 1: relative branch instruction
                                        ;	    +——————————> 1: variable operand size...
                                        ;
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;	    Variable operand size refers to an immediate mode instruction
                                        ;	    that can accept either an 8 or 16 bit operand.  During instr-
                                        ;	    uction assembly, an 8 bit operand can be forced to 16 bits by
                                        ;	    preceding the operand field with !,  e.g.,  LDA !#$01,  which
                                        ;	    will assemble as $A9 $01 $00.
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;
   5179 8EBB 00                         mnetabam .byte ops0 | am_nam   ; $00  BRK
   5180 8EBC 17                                   .byte ops1 | am_indx  ; $01  ORA (dp,X)
   5181 8EBD 10                                   .byte ops1 | am_nam   ; $02  COP
   5182 8EBE 19                                   .byte ops1 | am_stk   ; $03  ORA offset,S
   5183 8EBF 10                                   .byte ops1 | am_nam   ; $04  TSB dp
   5184 8EC0 10                                   .byte ops1 | am_nam   ; $05  ORA dp
   5185 8EC1 10                                   .byte ops1 | am_nam   ; $06  ASL dp
   5186 8EC2 15                                   .byte ops1 | am_indl  ; $07  ORA [dp]
   5187 8EC3 00                                   .byte ops0 | am_nam   ; $08  PHP
   5188 8EC4 91                                   .byte vops | am_imm   ; $09  ORA #
   5189 8EC5 00                                   .byte ops0 | am_nam   ; $0A  ASL A
   5190 8EC6 00                                   .byte ops0 | am_nam   ; $0B  PHD
   5191 8EC7 20                                   .byte ops2 | am_nam   ; $0C  TSB abs
   5192 8EC8 20                                   .byte ops2 | am_nam   ; $0D  ORA abs
   5193 8EC9 20                                   .byte ops2 | am_nam   ; $0E  ASL abs
   5194 8ECA 30                                   .byte ops3 | am_nam   ; $0F  ORA absl
                                        ;
   5196 8ECB 50                                   .byte bop1 | am_nam   ; $10  BPL abs
   5197 8ECC 18                                   .byte ops1 | am_indy  ; $11  ORA (dp),Y
   5198 8ECD 14                                   .byte ops1 | am_ind   ; $12  ORA (dp)
   5199 8ECE 1A                                   .byte ops1 | am_stky  ; $13  ORA (offset,S),Y
   5200 8ECF 10                                   .byte ops1 | am_nam   ; $14  TRB dp
   5201 8ED0 12                                   .byte ops1 | am_adrx  ; $15  ORA dp,X
   5202 8ED1 12                                   .byte ops1 | am_adrx  ; $16  ASL dp,X
   5203 8ED2 16                                   .byte ops1 | am_indly ; $17  ORA [dp],Y
   5204 8ED3 00                                   .byte ops0 | am_nam   ; $18  CLC
   5205 8ED4 20                                   .byte ops2 | am_nam   ; $19  ORA abs
   5206 8ED5 00                                   .byte ops0 | am_nam   ; $1A  INC A
   5207 8ED6 00                                   .byte ops0 | am_nam   ; $1B  TCS
   5208 8ED7 20                                   .byte ops2 | am_nam   ; $1C  TRB abs
   5209 8ED8 22                                   .byte ops2 | am_adrx  ; $1D  ORA abs,X
   5210 8ED9 22                                   .byte ops2 | am_adrx  ; $1E  ASL abs,X
   5211 8EDA 32                                   .byte ops3 | am_adrx  ; $1F  ORA absl,X
                                        ;
   5213 8EDB 20                                   .byte ops2 | am_nam   ; $20  JSR abs
   5214 8EDC 17                                   .byte ops1 | am_indx  ; $21  AND (dp,X)
   5215 8EDD 30                                   .byte ops3 | am_nam   ; $22  JSL absl
   5216 8EDE 19                                   .byte ops1 | am_stk   ; $23  AND offset,S
   5217 8EDF 10                                   .byte ops1 | am_nam   ; $24  BIT dp
   5218 8EE0 10                                   .byte ops1 | am_nam   ; $25  AND dp
   5219 8EE1 10                                   .byte ops1 | am_nam   ; $26  ROL dp
   5220 8EE2 15                                   .byte ops1 | am_indl  ; $27  AND [dp]
   5221 8EE3 00                                   .byte ops0 | am_nam   ; $28  PLP
   5222 8EE4 91                                   .byte vops | am_imm   ; $29  AND #
   5223 8EE5 00                                   .byte ops0 | am_nam   ; $2A  ROL A
   5224 8EE6 00                                   .byte ops0 | am_nam   ; $2B  PLD
   5225 8EE7 20                                   .byte ops2 | am_nam   ; $2C  BIT abs
   5226 8EE8 20                                   .byte ops2 | am_nam   ; $2D  AND abs
   5227 8EE9 20                                   .byte ops2 | am_nam   ; $2E  ROL abs
   5228 8EEA 30                                   .byte ops3 | am_nam   ; $2F  AND absl
                                        ;
   5230 8EEB 50                                   .byte bop1 | am_nam   ; $30  BMI abs
   5231 8EEC 18                                   .byte ops1 | am_indy  ; $31  AND (dp),Y
   5232 8EED 14                                   .byte ops1 | am_ind   ; $32  AND (dp)
   5233 8EEE 1A                                   .byte ops1 | am_stky  ; $33  AND (offset,S),Y
   5234 8EEF 12                                   .byte ops1 | am_adrx  ; $34  BIT dp,X
   5235 8EF0 12                                   .byte ops1 | am_adrx  ; $35  AND dp,X
   5236 8EF1 12                                   .byte ops1 | am_adrx  ; $36  ROL dp,X
   5237 8EF2 16                                   .byte ops1 | am_indly ; $37  AND [dp],Y
   5238 8EF3 00                                   .byte ops0 | am_nam   ; $38  SEC
   5239 8EF4 23                                   .byte ops2 | am_adry  ; $39  AND abs,Y
   5240 8EF5 00                                   .byte ops0 | am_nam   ; $3A  DEC A
   5241 8EF6 00                                   .byte ops0 | am_nam   ; $3B  TSC
   5242 8EF7 22                                   .byte ops2 | am_adrx  ; $3C  BIT abs,X
   5243 8EF8 22                                   .byte ops2 | am_adrx  ; $3D  AND abs,X
   5244 8EF9 22                                   .byte ops2 | am_adrx  ; $3E  ROL abs,X
   5245 8EFA 32                                   .byte ops3 | am_adrx  ; $3F  AND absl,X
                                        ;
   5247 8EFB 00                                   .byte ops0 | am_nam   ; $40  RTI
   5248 8EFC 17                                   .byte ops1 | am_indx  ; $41  EOR (dp,X)
   5249 8EFD 00                                   .byte ops0 | am_nam   ; $42  WDM
   5250 8EFE 19                                   .byte ops1 | am_stk   ; $43  EOR offset,S
   5251 8EFF 2B                                   .byte ops2 | am_move  ; $44  MVP sb,db
   5252 8F00 10                                   .byte ops1 | am_nam   ; $45  EOR dp
   5253 8F01 10                                   .byte ops1 | am_nam   ; $46  LSR dp
   5254 8F02 15                                   .byte ops1 | am_indl  ; $47  EOR [dp]
   5255 8F03 00                                   .byte ops0 | am_nam   ; $48  PHA
   5256 8F04 91                                   .byte vops | am_imm   ; $49  EOR #
   5257 8F05 00                                   .byte ops0 | am_nam   ; $4A  LSR A
   5258 8F06 00                                   .byte ops0 | am_nam   ; $4B  PHK
   5259 8F07 20                                   .byte ops2 | am_nam   ; $4C  JMP abs
   5260 8F08 20                                   .byte ops2 | am_nam   ; $4D  EOR abs
   5261 8F09 20                                   .byte ops2 | am_nam   ; $4E  LSR abs
   5262 8F0A 30                                   .byte ops3 | am_nam   ; $4F  EOR absl
                                        ;
   5264 8F0B 50                                   .byte bop1 | am_nam   ; $50  BVC abs
   5265 8F0C 18                                   .byte ops1 | am_indy  ; $51  EOR (dp),Y
   5266 8F0D 14                                   .byte ops1 | am_ind   ; $52  EOR (dp)
   5267 8F0E 1A                                   .byte ops1 | am_stky  ; $53  EOR (offset,S),Y
   5268 8F0F 2B                                   .byte ops2 | am_move  ; $54  MVN sb,db
   5269 8F10 12                                   .byte ops1 | am_adrx  ; $55  EOR dp,X
   5270 8F11 12                                   .byte ops1 | am_adrx  ; $56  LSR dp,X
   5271 8F12 16                                   .byte ops1 | am_indly ; $57  EOR [dp],Y
   5272 8F13 00                                   .byte ops0 | am_nam   ; $58  CLI
   5273 8F14 23                                   .byte ops2 | am_adry  ; $59  EOR abs,Y
   5274 8F15 00                                   .byte ops0 | am_nam   ; $5A  PHY
   5275 8F16 00                                   .byte ops0 | am_nam   ; $5B  TCD
   5276 8F17 30                                   .byte ops3 | am_nam   ; $5C  JML absl
   5277 8F18 22                                   .byte ops2 | am_adrx  ; $5D  EOR abs,X
   5278 8F19 22                                   .byte ops2 | am_adrx  ; $5E  LSR abs,X
   5279 8F1A 32                                   .byte ops3 | am_adrx  ; $5F  EOR absl,X
                                        ;
   5281 8F1B 00                                   .byte ops0 | am_nam   ; $60  RTS
   5282 8F1C 17                                   .byte ops1 | am_indx  ; $61  ADC (dp,X)
   5283 8F1D 60                                   .byte bop2 | am_nam   ; $62  PER
   5284 8F1E 19                                   .byte ops1 | am_stk   ; $63  ADC offset,S
   5285 8F1F 10                                   .byte ops1 | am_nam   ; $64  STZ dp
   5286 8F20 10                                   .byte ops1 | am_nam   ; $65  ADC dp
   5287 8F21 10                                   .byte ops1 | am_nam   ; $66  ROR dp
   5288 8F22 15                                   .byte ops1 | am_indl  ; $67  ADC [dp]
   5289 8F23 00                                   .byte ops0 | am_nam   ; $68  PLA
   5290 8F24 91                                   .byte vops | am_imm   ; $69  ADC #
   5291 8F25 00                                   .byte ops0 | am_nam   ; $6A  ROR A
   5292 8F26 00                                   .byte ops0 | am_nam   ; $6B  RTL
   5293 8F27 24                                   .byte ops2 | am_ind   ; $6C  JMP (abs)
   5294 8F28 20                                   .byte ops2 | am_nam   ; $6D  ADC abs
   5295 8F29 20                                   .byte ops2 | am_nam   ; $6E  ROR abs
   5296 8F2A 30                                   .byte ops3 | am_nam   ; $6F  ADC absl
                                        ;
   5298 8F2B 50                                   .byte bop1 | am_nam   ; $70  BVS abs
   5299 8F2C 18                                   .byte ops1 | am_indy  ; $71  ADC (dp),Y
   5300 8F2D 14                                   .byte ops1 | am_ind   ; $72  ADC (dp)
   5301 8F2E 1A                                   .byte ops1 | am_stky  ; $73  ADC (offset,S),Y
   5302 8F2F 12                                   .byte ops1 | am_adrx  ; $74  STZ dp,X
   5303 8F30 12                                   .byte ops1 | am_adrx  ; $75  ADC dp,X
   5304 8F31 12                                   .byte ops1 | am_adrx  ; $76  ROR dp,X
   5305 8F32 16                                   .byte ops1 | am_indly ; $77  ADC [dp],Y
   5306 8F33 00                                   .byte ops0 | am_nam   ; $78  SEI
   5307 8F34 23                                   .byte ops2 | am_adry  ; $79  ADC abs,Y
   5308 8F35 00                                   .byte ops0 | am_nam   ; $7A  PLY
   5309 8F36 00                                   .byte ops0 | am_nam   ; $7B  TDC
   5310 8F37 27                                   .byte ops2 | am_indx  ; $7C  JMP (abs,X)
   5311 8F38 22                                   .byte ops2 | am_adrx  ; $7D  ADC abs,X
   5312 8F39 22                                   .byte ops2 | am_adrx  ; $7E  ROR abs,X
   5313 8F3A 32                                   .byte ops3 | am_adrx  ; $7F  ADC absl,X
                                        ;
   5315 8F3B 50                                   .byte bop1 | am_nam   ; $80  BRA abs
   5316 8F3C 17                                   .byte ops1 | am_indx  ; $81  STA (dp,X)
   5317 8F3D 60                                   .byte bop2 | am_nam   ; $82  BRL abs
   5318 8F3E 19                                   .byte ops1 | am_stk   ; $83  STA offset,S
   5319 8F3F 10                                   .byte ops1 | am_nam   ; $84  STY dp
   5320 8F40 10                                   .byte ops1 | am_nam   ; $85  STA dp
   5321 8F41 10                                   .byte ops1 | am_nam   ; $86  STX dp
   5322 8F42 15                                   .byte ops1 | am_indl  ; $87  STA [dp]
   5323 8F43 00                                   .byte ops0 | am_nam   ; $88  DEY
   5324 8F44 91                                   .byte vops | am_imm   ; $89  BIT #
   5325 8F45 00                                   .byte ops0 | am_nam   ; $8A  TXA
   5326 8F46 00                                   .byte ops0 | am_nam   ; $8B  PHB
   5327 8F47 20                                   .byte ops2 | am_nam   ; $8C  STY abs
   5328 8F48 20                                   .byte ops2 | am_nam   ; $8D  STA abs
   5329 8F49 20                                   .byte ops2 | am_nam   ; $8E  STX abs
   5330 8F4A 30                                   .byte ops3 | am_nam   ; $8F  STA absl
                                        ;
   5332 8F4B 50                                   .byte bop1 | am_nam   ; $90  BCC abs
   5333 8F4C 18                                   .byte ops1 | am_indy  ; $91  STA (dp),Y
   5334 8F4D 14                                   .byte ops1 | am_ind   ; $92  STA (dp)
   5335 8F4E 1A                                   .byte ops1 | am_stky  ; $93  STA (offset,S),Y
   5336 8F4F 12                                   .byte ops1 | am_adrx  ; $94  STY dp,X
   5337 8F50 12                                   .byte ops1 | am_adrx  ; $95  STA dp,X
   5338 8F51 13                                   .byte ops1 | am_adry  ; $96  STX dp,Y
   5339 8F52 16                                   .byte ops1 | am_indly ; $97  STA [dp],Y
   5340 8F53 00                                   .byte ops0 | am_nam   ; $98  TYA
   5341 8F54 23                                   .byte ops2 | am_adry  ; $99  STA abs,Y
   5342 8F55 00                                   .byte ops0 | am_nam   ; $9A  TXS
   5343 8F56 00                                   .byte ops0 | am_nam   ; $9B  TXY
   5344 8F57 20                                   .byte ops2 | am_nam   ; $9C  STZ abs
   5345 8F58 22                                   .byte ops2 | am_adrx  ; $9D  STA abs,X
   5346 8F59 22                                   .byte ops2 | am_adrx  ; $9E  STZ abs,X
   5347 8F5A 32                                   .byte ops3 | am_adrx  ; $9F  STA absl,X
                                        ;
   5349 8F5B 91                                   .byte vops | am_imm   ; $A0  LDY #
   5350 8F5C 17                                   .byte ops1 | am_indx  ; $A1  LDA (dp,X)
   5351 8F5D 91                                   .byte vops | am_imm   ; $A2  LDX #
   5352 8F5E 19                                   .byte ops1 | am_stk   ; $A3  LDA offset,S
   5353 8F5F 10                                   .byte ops1 | am_nam   ; $A4  LDY dp
   5354 8F60 10                                   .byte ops1 | am_nam   ; $A5  LDA dp
   5355 8F61 10                                   .byte ops1 | am_nam   ; $A6  LDX dp
   5356 8F62 15                                   .byte ops1 | am_indl  ; $A7  LDA [dp]
   5357 8F63 00                                   .byte ops0 | am_nam   ; $A8  TAY
   5358 8F64 91                                   .byte vops | am_imm   ; $A9  LDA #
   5359 8F65 00                                   .byte ops0 | am_nam   ; $AA  TAX
   5360 8F66 00                                   .byte ops0 | am_nam   ; $AB  PLB
   5361 8F67 20                                   .byte ops2 | am_nam   ; $AC  LDY abs
   5362 8F68 20                                   .byte ops2 | am_nam   ; $AD  LDA abs
   5363 8F69 20                                   .byte ops2 | am_nam   ; $AE  LDX abs
   5364 8F6A 30                                   .byte ops3 | am_nam   ; $AF  LDA absl
                                        ;
   5366 8F6B 50                                   .byte bop1 | am_nam   ; $B0  BCS abs
   5367 8F6C 18                                   .byte ops1 | am_indy  ; $B1  LDA (dp),Y
   5368 8F6D 14                                   .byte ops1 | am_ind   ; $B2  LDA (dp)
   5369 8F6E 1A                                   .byte ops1 | am_stky  ; $B3  LDA (offset,S),Y
   5370 8F6F 12                                   .byte ops1 | am_adrx  ; $B4  LDY dp,X
   5371 8F70 12                                   .byte ops1 | am_adrx  ; $B5  LDA dp,X
   5372 8F71 13                                   .byte ops1 | am_adry  ; $B6  LDX dp,Y
   5373 8F72 16                                   .byte ops1 | am_indly ; $B7  LDA [dp],Y
   5374 8F73 00                                   .byte ops0 | am_nam   ; $B8  CLV
   5375 8F74 23                                   .byte ops2 | am_adry  ; $B9  LDA abs,Y
   5376 8F75 00                                   .byte ops0 | am_nam   ; $BA  TSX
   5377 8F76 00                                   .byte ops0 | am_nam   ; $BB  TYX
   5378 8F77 22                                   .byte ops2 | am_adrx  ; $BC  LDY abs,X
   5379 8F78 22                                   .byte ops2 | am_adrx  ; $BD  LDA abs,X
   5380 8F79 23                                   .byte ops2 | am_adry  ; $BE  LDX abs,Y
   5381 8F7A 32                                   .byte ops3 | am_adrx  ; $BF  LDA absl,X
                                        ;
   5383 8F7B 91                                   .byte vops | am_imm   ; $C0  CPY #
   5384 8F7C 17                                   .byte ops1 | am_indx  ; $C1  CMP (dp,X)
   5385 8F7D 11                                   .byte ops1 | am_imm   ; $C2  REP #
   5386 8F7E 19                                   .byte ops1 | am_stk   ; $C3  CMP offset,S
   5387 8F7F 10                                   .byte ops1 | am_nam   ; $C4  CPY dp
   5388 8F80 10                                   .byte ops1 | am_nam   ; $C5  CMP dp
   5389 8F81 10                                   .byte ops1 | am_nam   ; $C6  DEC dp
   5390 8F82 15                                   .byte ops1 | am_indl  ; $C7  CMP [dp]
   5391 8F83 00                                   .byte ops0 | am_nam   ; $C8  INY
   5392 8F84 91                                   .byte vops | am_imm   ; $C9  CMP #
   5393 8F85 00                                   .byte ops0 | am_nam   ; $CA  DEX
   5394 8F86 00                                   .byte ops0 | am_nam   ; $CB  WAI
   5395 8F87 20                                   .byte ops2 | am_nam   ; $CC  CPY abs
   5396 8F88 20                                   .byte ops2 | am_nam   ; $CD  CMP abs
   5397 8F89 20                                   .byte ops2 | am_nam   ; $CE  DEC abs
   5398 8F8A 30                                   .byte ops3 | am_nam   ; $CF  CMP absl
                                        ;
   5400 8F8B 50                                   .byte bop1 | am_nam   ; $D0  BNE abs
   5401 8F8C 18                                   .byte ops1 | am_indy  ; $D1  CMP (dp),Y
   5402 8F8D 14                                   .byte ops1 | am_ind   ; $D2  CMP (dp)
   5403 8F8E 1A                                   .byte ops1 | am_stky  ; $D3  CMP (offset,S),Y
   5404 8F8F 10                                   .byte ops1 | am_nam   ; $D4  PEI dp
   5405 8F90 12                                   .byte ops1 | am_adrx  ; $D5  CMP dp,X
   5406 8F91 12                                   .byte ops1 | am_adrx  ; $D6  DEC dp,X
   5407 8F92 16                                   .byte ops1 | am_indly ; $D7  CMP [dp],Y
   5408 8F93 00                                   .byte ops0 | am_nam   ; $D8  CLD
   5409 8F94 23                                   .byte ops2 | am_adry  ; $D9  CMP abs,Y
   5410 8F95 00                                   .byte ops0 | am_nam   ; $DA  PHX
   5411 8F96 00                                   .byte ops0 | am_nam   ; $DB  STP
   5412 8F97 25                                   .byte ops2 | am_indl  ; $DC  JMP [abs]
   5413 8F98 22                                   .byte ops2 | am_adrx  ; $DD  CMP abs,X
   5414 8F99 22                                   .byte ops2 | am_adrx  ; $DE  DEC abs,X
   5415 8F9A 32                                   .byte ops3 | am_adrx  ; $DF  CMP absl,X
                                        ;
   5417 8F9B 91                                   .byte vops | am_imm   ; $E0  CPX #
   5418 8F9C 17                                   .byte ops1 | am_indx  ; $E1  SBC (dp,X)
   5419 8F9D 11                                   .byte ops1 | am_imm   ; $E2  SEP #
   5420 8F9E 19                                   .byte ops1 | am_stk   ; $E3  SBC offset,S
   5421 8F9F 10                                   .byte ops1 | am_nam   ; $E4  CPX dp
   5422 8FA0 10                                   .byte ops1 | am_nam   ; $E5  SBC dp
   5423 8FA1 10                                   .byte ops1 | am_nam   ; $E6  INC dp
   5424 8FA2 15                                   .byte ops1 | am_indl  ; $E7  SBC [dp]
   5425 8FA3 00                                   .byte ops0 | am_nam   ; $E8  INX
   5426 8FA4 91                                   .byte vops | am_imm   ; $E9  SBC #
   5427 8FA5 00                                   .byte ops0 | am_nam   ; $EA  NOP
   5428 8FA6 00                                   .byte ops0 | am_nam   ; $EB  XBA
   5429 8FA7 20                                   .byte ops2 | am_nam   ; $EC  CPX abs
   5430 8FA8 20                                   .byte ops2 | am_nam   ; $ED  SBC abs
   5431 8FA9 20                                   .byte ops2 | am_nam   ; $EE  INC abs
   5432 8FAA 30                                   .byte ops3 | am_nam   ; $EF  SBC absl
                                        ;
   5434 8FAB 50                                   .byte bop1 | am_nam   ; $F0  BEQ abs
   5435 8FAC 18                                   .byte ops1 | am_indy  ; $F1  SBC (dp),Y
   5436 8FAD 14                                   .byte ops1 | am_ind   ; $F2  SBC (dp)
   5437 8FAE 1A                                   .byte ops1 | am_stky  ; $F3  SBC (offset,S),Y
   5438 8FAF 21                                   .byte ops2 | am_imm   ; $F4  PEA #
   5439 8FB0 12                                   .byte ops1 | am_adrx  ; $F5  SBC dp,X
   5440 8FB1 12                                   .byte ops1 | am_adrx  ; $F6  INC dp,X
   5441 8FB2 16                                   .byte ops1 | am_indly ; $F7  SBC [dp],Y
   5442 8FB3 00                                   .byte ops0 | am_nam   ; $F8  SED
   5443 8FB4 23                                   .byte ops2 | am_adry  ; $F9  SBC abs,Y
   5444 8FB5 00                                   .byte ops0 | am_nam   ; $FA  PLX
   5445 8FB6 00                                   .byte ops0 | am_nam   ; $FB  XCE
   5446 8FB7 27                                   .byte ops2 | am_indx  ; $FC  JSR (abs,X)
   5447 8FB8 22                                   .byte ops2 | am_adrx  ; $FD  SBC abs,X
   5448 8FB9 22                                   .byte ops2 | am_adrx  ; $FE  INC abs,X
   5449 8FBA 32                                   .byte ops3 | am_adrx  ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	.X & .Y immediate mode opcodes...
                                        ;
   5454 8FBB A0                         vopidx   .byte $a0             ;LDY #
   5455 8FBC A2                                   .byte $a2             ;LDX #
   5456 8FBD C0                                   .byte $c0             ;CPY #
   5457 8FBE E0                                   .byte $e0             ;CPX #
   5684 = 00000004                      n_vopidx =*-vopidx             ;number of opcodes
                                        ;
                                        ;
                                        ;	addressing mode symbology lookup...
                                        ;
   5463 8FBF D7 8F                      ms_lutab .word ms_nam          ;(0000)  no symbol
   5464 8FC1 E1 8F                                .word ms_imm          ;(0001)  #
   5465 8FC3 D9 8F                                .word ms_addrx        ;(0010)  dp,X or abs,X
   5466 8FC5 DD 8F                                .word ms_addry        ;(0011)  dp,Y or abs,Y
   5467 8FC7 E3 8F                                .word ms_ind          ;(0100)  (dp) or (abs)
   5468 8FC9 E6 8F                                .word ms_indl         ;(0101)  [dp] or [abs]
   5469 8FCB E9 8F                                .word ms_indly        ;(0110)  [dp],Y
   5470 8FCD EE 8F                                .word ms_indx         ;(0111)  (dp,X) or (abs,X)
   5471 8FCF F3 8F                                .word ms_indy         ;(1000)  (dp),Y
   5472 8FD1 FB 8F                                .word ms_stk          ;(1001)  offset,S
   5473 8FD3 FF 8F                                .word ms_stky         ;(1010) (offset,S),Y
   5474 8FD5 D7 8F                                .word ms_nam          ;(1011) sbnk,dbnk
                                        ;
                                        ;
                                        ;	addressing mode symbology strings...
                                        ;
   5479 8FD7 20 00                      ms_nam   .byte " ",0           ;no symbol
   5480 8FD9 20 2C 58 00                ms_addrx .byte " ,X",0         ;dp,X or addr,X
   5481 8FDD 20 2C 59 00                ms_addry .byte " ,Y",0         ;dp,Y or addr,Y
   5482 8FE1 23 00                      ms_imm   .byte "#",0           ;immediate
   5483 8FE3 28 29 00                   ms_ind   .byte "()",0          ;(dp) or (abs)
   5484 8FE6 5B 5D 00                   ms_indl  .byte "[]",0          ;[dp] or [abs]
   5485 8FE9 5B 5D 2C 59 00             ms_indly .byte "[],Y",0        ;[dp],Y
   5486 8FEE 28 2C 58 29 00             ms_indx  .byte "(,X)",0        ;(dp,X) or (abs,X)
   5487 8FF3 28 29 2C 59 00             ms_indy  .byte "(),Y",0        ;(dp),Y
   5488 8FF8 2C 24 00                   ms_move  .byte ",$",0          ;MVN/MVP sbnk,dbnk
   5489 8FFB 20 2C 53 00                ms_stk   .byte " ,S",0         ;offset,S
   5490 8FFF 28 2C 53 29 2C 59 00       ms_stky  .byte "(,S),Y",0      ;(offset,S),Y
   5491 9006 7B 7D 2C 59 00             ms_indxly	.byte "{},Y",0     ;{dp},Y
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL STRINGS
                                        ;
   5497 900B 1B 28                      dc_bf +         .byte a_esc,"("
   5497 900D 1B 47 34                 +            .byte a_esc,"G4"
                                                            ;enable reverse foreground
   5498 9010 00                                   .byte 0
                                        ;
   5500 9011 08                         dc_bs +         .byte a_bs
   5500 9012 1B 57                    +   +         .byte a_esc,"W"
                                        
                                                            ;destructive backspace
   5502 9014 00                                   .byte 0
                                        ;
   5504 9015 1B 54                      dc_cl +         .byte a_esc,"T"
                                                            ;clear to end of line 
   5505 9017 00                                   .byte 0
                                        ;
   5507 9018 1B 60 31                   dc_cn +         .byte a_esc,"`1"
                                                            ;cursor on
   5508 901B 00                                   .byte 0
                                        ;
   5510 901C 1B 60 30                   dc_co +         .byte a_esc,"`0"
                                                            ;cursor off
   5511 901F 00                                   .byte 0
                                        ;
   5513 9020 1B 28                      dc_er +         .byte a_esc,"("
   5513 9022 1B 47 30                 +            .byte a_esc,"G0"
                                                            ;enable normal foreground
   5514 9025 00                                   .byte 0
                                        ;
   5516 9026 0D                         dc_lf ++         .byte a_cr
                                     +   
   5516 9027 0A                       +            .byte a_lf
                                                            ;newline
   5517 9028 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;TEXT STRINGS
                                        ;
   5523 9029 07                         mm_brk +         .byte a_bel
                                        
   5524 902A 0D                       +   +         .byte a_cr
                                     +   
   5524 902B 0A                       +            .byte a_lf
                                        
   5525 902C 2A 2A 42 52 4B                       .byte "**BRK"
   5526 9031 0D                       +   +         .byte a_cr
                                     +   
   5526 9032 0A                       +            .byte a_lf
                                        
   5527 9033 00                                   .byte 0
                                        ;
   5529 9034 0D                         mm_entry ++         .byte a_cr
                                     +   
   5529 9035 0A                       +            .byte a_lf
                                        
   5530 9036 0A 53 75 70 65 72 6D 6F              .byte a_lf,"Supermon 832 "
   5530 903E 6E 20 38 33 32 20         
   5531 9044 31                       +            .byte "1"
   5531 9045 2E                       +            .byte "."
   5531 9046 30                       +            .byte "0"
   5531 9047 2E                       +            .byte "."
   5531 9048 30                       +            .byte "0"
                                        
   5532 9049 20                                   .byte " "
   5533 904A 0D                       +   +         .byte a_cr
                                     +   
   5533 904B 0A                       +            .byte a_lf
                                        
   5534 904C 00                                   .byte 0
                                        ;
   5536 904D 20 2A 2A 45 52 52 20 20    mm_err   .byte " **ERR  ",0
   5536 9055 00                        
                                        ;
   5538 9056 0D                         mm_prmpt ++         .byte a_cr
                                     +   
   5538 9057 0A                       +            .byte a_lf
                                        
   5539 9058 1B 28                    +            .byte a_esc,"("
   5539 905A 1B 47 30                 +            .byte a_esc,"G0"
                                        
   5540 905D 2E 00                                .byte ".",0
                                        ;
   5542 905F 0D                         mm_regs ++         .byte a_cr
                                     +   
   5542 9060 0A                       +            .byte a_lf
                                        
   5543 9061 20 20 20 20 20 20 20 20              .byte "                    31"
   5543 9069 20 20 20 20 20 20 20 20   
   5543 9071 20 20 20 20 33 31         
   5544 9077 0D                       +   +         .byte a_cr
                                     +   
   5544 9078 0A                       +            .byte a_lf
                                        
   5545 9079 20 20 20 43 53 20 20 50              .byte "   CS  PB  PC   26NVmxDIZC    .A       .X       .Y       SP  "
   5545 9081 42 20 20 50 43 20 20 20   
   5545 9089 32 36 4E 56 6D 78 44 49   
   5545 9091 5A 43 20 20 20 20 2E 41   
   5545 9099 20 20 20 20 20 20 20 2E   
   5545 90A1 58 20 20 20 20 20 20 20   
   5545 90A9 2E 59 20 20 20 20 20 20   
   5545 90B1 20 53 50 20 20            
   5546 90B6 0D                       +   +         .byte a_cr
                                     +   
   5546 90B7 0A                       +            .byte a_lf
                                        
   5547 90B8 3B 20 00                             .byte "; ",0
   5548 90BB 0D                         mm_regs2 ++         .byte a_cr
                                     +   
   5548 90BC 0A                       +            .byte a_lf
                                        
   5549 90BD 20 20 20 44 53 20 20 20              .byte "   DS   SS  DP  DB"
   5549 90C5 53 53 20 20 44 50 20 20   
   5549 90CD 44 42                     
   5550 90CF 0D                       +   +         .byte a_cr
                                     +   
   5550 90D0 0A                       +            .byte a_lf
                                        
   5551 90D1 3B 20 00                             .byte "; ",0
                                        ;
   5553 90D4 07                         mm_rts +         .byte a_bel
                                        
   5554 90D5 0D                       +   +         .byte a_cr
                                     +   
   5554 90D6 0A                       +            .byte a_lf
                                        
   5555 90D7 2A 2A 52 54 53                       .byte "**RTS"
   5556 90DC 0D                       +   +         .byte a_cr
                                     +   
   5556 90DD 0A                       +            .byte a_lf
                                        
   5557 90DE 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;VECTOR STORAGE
                                        ;
                                        ;
   5860 = 000090DF                      _txtend_ =*                     ;end of program text
                                        ;
                                        ;================================================================================
                                        	;.end
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FTBios816.asm


                                        .include "supermon832.asm"
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FAC1ToString.asm

                                        ; ============================================================================
                                        ; FAC1ToString.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014  Robert Finch, Stratford
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
                                        ; This code is a heavily modified version of the floating point to string
                                        ; conversion routine which is a part of Lee Davison's EhBASIC.
                                        ;
   5892 = 00000000000000C6                            Cvaral		= $C6		; current var address low byte
   5893 = 000000C7                      Cvarah		= Cvaral+1	; current var address high byte
   5894 = 00000000000000C0                            numexp		= $C0		; string to float number exponent count
   5895 = 00000000000000C2                            expcnt		= $C2		; string to float exponent count
   5896 = 00000000000000C4                            Sendl			= $C4	; BASIC pointer temp low byte
   5897 = 00000000000000C5                            Sendh			= $C5	; BASIC pointer temp low byte
                                        
   5899 = 00000000000003A0                            Decss		= $3A0		; number to decimal string start
   5900 = 000003A1                      Decssp1		= Decss+1	; number to decimal string start
   5901 = 0000000000000001                            FP_ADD		EQU		1
   5902 = 0000000000000002                            FP_SUB		EQU		2
   5903 = 0000000000000003                            FP_MUL		EQU		3
   5904 = 0000000000000004                            FP_DIV		EQU		4
   5905 = 0000000000000005                            FP_FIX2FLT	EQU		5
   5906 = 0000000000000006                            FP_FLT2FIX	EQU		6
   5907 = 0000000000000007                            FP_ABS		EQU		7
   5908 = 0000000000000010                            FP_NEG		EQU		16
   5909 = 0000000000000011                            FP_SWAP		EQU		17
   5910 = 0000000000000083                            FIXED_MUL	EQU		$83
   5911 = 0000000000000081                            FIXED_ADD	EQU		$81
   5912 = 0000000000000082                            FIXED_SUB	EQU		$82
                                        ;parameter FIXED_DIV = 8'h84;
                                        ;parameter FIXED_ABS = 8'h87;
                                        ;parameter FIXED_NEG = 8'h90;
   5916 = 0000000000FEA20E                            FP_CMDREG	EQU		$FEA20E
   5917 = 0000000000FEA20E                            FP_STATREG	EQU		$FEA20E
   5918 = 0000000000FEA200                            FAC1		EQU		$FEA200
   5919 = 0000000000FEA200                            FAC1_5		EQU		$FEA200
   5920 = 0000000000FEA202                            FAC1_4		EQU		$FEA202
   5921 = 0000000000FEA204                            FAC1_3		EQU		$FEA204
   5922 = 0000000000FEA206                            FAC1_2		EQU		$FEA206
   5923 = 0000000000FEA208                            FAC1_1		EQU		$FEA208
   5924 = 0000000000FEA208                            FAC1_msw	EQU		$FEA208
   5925 = 0000000000FEA20A                            FAC1_e		EQU		$FEA20A
   5926 = 0000000000FEA210                            FAC2		EQU		$FEA210
                                        
                                           	CPU		W65C816S
                                           	NDX		16
                                           	MEM		16
                                           	
                                           public FAC1ToString:
                                           
                                           ; The first chunk of code determines if the number is positive or negative
                                           ; and spits out the appropriate sign. Next it takes the absolute value of
                                           ; the accumulator so following code only has to deal with positive numbers.
                                           
   5642 0090DF A0 00 00                     	LDY	#$00			; set index = 1
   5643 0090E2 AF 08 A2 FE                  	LDA	FAC1_msw		; test FAC1 sign (b15) (Can't use BIT)
   5644 0090E6 10 0E                        	BPL	.0002		; branch if +ve
   5645 0090E8 A9 2D 00                     	LDA	#'-'			; else character = "-"
   5646 0090EB 99 A0 03                     	STA	Decss,Y		; save leading character (" " or "-")
   5647 0090EE A9 10 00                     	LDA	#FP_NEG		; make the FAC positive
   5648 0090F1 20 18 93                     	JSR	FPCommandWait
   5649 0090F4 80 06                        	BRA	.0001
   5650 0090F6                             .0002:
   5651 0090F6 A9 20 00                     	LDA	#$20			; character = " " (assume +ve)
   5652 0090F9 99 A0 03                     	STA	Decss,Y
   5653 0090FC                             .0001:
   5654 0090FC 84 C4                        	STY	Sendl			; save index
                                           
                                           ; This little bit of code check for a zero exponent which indicates a
                                           ; value of zero.
                                           
   5659 0090FE AF 0A A2 FE                  	LDA	FAC1_e		; get FAC1 exponent
   5660 009102 AA                           	TAX
   5661 009103 D0 06                        	BNE	LAB_2989		; branch if FAC1<>0
                                           					; exponent was $00 so FAC1 is 0
   5663 009105 A9 30 00                     	LDA	#'0'			; set character = "0"
   5664 009108 82 93 01                     	BRL	LAB_2A89		; save last character, [EOT] and exit
                                           
                                           ; This loop attempts to make small values more significant, so that there are
                                           ; fewer leading zeros in the value. (The exponent is decremented so that it
                                           ; corresponds). Because of the potential for extremely small values looping is
                                           ; limited. The problem is the 16 bit exponent can allow for much smaller
                                           ; values than an 8 bit exponent would and we don't want to loop for thousands
                                           ; of iterations in order to display a value that's almost zero.
                                           
                                           					; FAC1 is some non zero value
   5674 00910B                             LAB_2989
   5675 00910B 84 C4                        	STY	Sendl			; save off .Y
   5676 00910D A0 67 06                     	LDY #1639			; max number of retries
   5677 009110 A9 00 00                     	LDA	#$00			; clear (number exponent count)
   5678 009113 85 C0                        	STA numexp
   5679 009115                             LOOP_MBMILLION:
   5680 009115 E0 00 80                     	CPX	#$8000			; compare FAC1 exponent with $8000 (>1.00000)
   5681 009118 B0 1A                        	BCS	LAB_299A		; branch if FAC1=>1
                                           					; FAC1<1
   5683 00911A F4 67 93                     	PEA	A_MILLION		; multiply FAC * 1,000,000
   5684 00911D 20 CD 92                     	JSR	LOAD_FAC2		; 
   5685 009120 68                           	PLA					; get rid of parameter
   5686 009121 20 C7 92                     	JSR	FMUL
   5687 009124 A5 C0                        	LDA numexp
   5688 009126 38                           	SEC
   5689 009127 E9 06 00                     	SBC	#6				; set number exponent count (-6)
   5690 00912A 85 C0                        	STA numexp
   5691 00912C AF 0A A2 FE                  	LDA FAC1_e
   5692 009130 AA                           	TAX
   5693 009131 88                           	DEY
   5694 009132 10 E1                        	BPL	LOOP_MBMILLION
                                           
   5696 009134                             LAB_299A
   5697 009134 A4 C4                        	LDY	Sendl		; get back .Y
                                           
                                           ; These two loops coerce the value of the FAC to be between 100,000 and
                                           ; 1,000,000. This gives a maximum of six digits before the decimal point
                                           ; in scientific notation.
                                           
                                           ; This loop divides by 10 until the value in the FAC is less than 1,000,000
                                           ;
   5705 009136                             LOOP_DB10:
   5706 009136 F4 7F 93                     	PEA	MAX_BEFORE_SCI	; set pointer low byte to 999999.4375 (max before sci note)
   5707 009139 20 CD 92                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5708 00913C 68                           	PLA					; get rid of parameter
   5709 00913D AF 0E A2 FE                  	LDA FP_CMDREG
   5710 009141 89 08 00                     	BIT	#$08			; test equals bit
   5711 009144 D0 28                        	BNE	LAB_29C3		; exit if FAC1 = (AY)
   5712 009146 89 04 00                     	BIT	#$04			; test greater than bit
   5713 009149 F0 07                        	BEQ	LOOP_MB10		; go do *10 if FAC1 < (AY)
                                           
   5715 00914B                             LAB_29B9
   5716 00914B 20 05 93                     	JSR	DivideByTen		; divide by 10
   5717 00914E E6 C0                        	INC	numexp			; increment number exponent count
   5718 009150 80 E4                        	BRA	LOOP_DB10		; go test again (branch always)
                                           
                                           ; This loop multiplies the value by 10 until it's greater than
                                           ; 100,000.
                                           					; FAC1 < (AY)
   5723 009152                             LOOP_MB10
   5724 009152 F4 97 93                     	PEA CONST_9375		; set pointer to 99999.9375
   5725 009155 20 CD 92                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5726 009158 68                           	PLA					; get rid of parameter
   5727 009159 AF 0E A2 FE                  	LDA FP_CMDREG
   5728 00915D 89 08 00                     	BIT #$08
   5729 009160 D0 05                        	BNE	LAB_29B2		; branch if FAC1 = (AY) (allow decimal places)
   5730 009162 89 04 00                     	BIT #$04
   5731 009165 D0 07                        	BNE	LAB_29C0		; branch if FAC1 > (AY) (no decimal places)
                                           					; FAC1 <= (AY)
   5733 009167                             LAB_29B2
   5734 009167 20 F8 92                     	JSR	MultiplyByTen	; multiply by 10
   5735 00916A C6 C0                        	DEC	numexp		; decrement number exponent count
   5736 00916C 80 E4                        	BRA	LOOP_MB10		; go test again (branch always)
                                           
                                           ; now we have just the digits to do
                                           
   5740 00916E                             LAB_29C0
                                           ;	JSR	AddPoint5		; add 0.5 to FAC1 (round FAC1)
   5742 00916E                             LAB_29C3
                                           ;	JSR	FloatToFixed	; convert FAC1 floating-to-fixed
   5744 00916E A2 01 00                     	LDX	#$01			; set default digits before dp = 1
   5745 009171 A5 C0                        	LDA	numexp		; get number exponent count
   5746 009173 18                           	CLC				; clear carry for add
   5747 009174 69 07 00                     	ADC	#$07			; up to 6 digits before point
   5748 009177 30 0A                        	BMI	LAB_29D8		; if -ve then 1 digit before dp
                                           
   5750 009179 C9 08 00                     	CMP	#$08			; A>=8 if n>=1E6
   5751 00917C B0 06                        	BCS	LAB_29D9		; branch if >= $08
                                           
                                           					; carry is clear
   5754 00917E AA                           	TAX				; copy to A
   5755 00917F CA                           	DEX				; take 1 from digit count
   5756 009180 A9 02 00                     	LDA	#$02			;.set exponent adjust
                                           
   5758 009183                             LAB_29D8
   5759 009183 38                           	SEC				; set carry for subtract
   5760 009184                             LAB_29D9
   5761 009184 E9 02 00                     	SBC	#$02			; -2
   5762 009187 85 C2                        	STA	expcnt		;.save exponent adjust
   5763 009189 86 C0                        	STX	numexp		; save digits before dp count
   5764 00918B 8A                           	TXA				; copy to A
   5765 00918C F0 02                        	BEQ	LAB_29E4		; branch if no digits before dp
                                           
   5767 00918E 10 15                        	BPL	LAB_29F7		; branch if digits before dp
                                           
   5769 009190                             LAB_29E4
   5770 009190 A4 C4                        	LDY	Sendl			; get output string index
   5771 009192 A9 2E 00                     	LDA	#'.'			; character "."
   5772 009195 C8                           	INY				; increment index
   5773 009196 99 A0 03                     	STA	Decss,Y		; save to output string
   5774 009199 8A                           	TXA				;.
   5775 00919A F0 07                        	BEQ	LAB_29F5		;.
                                           
   5777 00919C A9 30 00                     	LDA	#'0'			; character "0"
   5778 00919F C8                           	INY				; increment index
   5779 0091A0 99 A0 03                     	STA	Decss,Y		; save to output string
   5780 0091A3                             LAB_29F5
   5781 0091A3 84 C4                        	STY	Sendl			; save output string index
                                           
   5783 0091A5                             LAB_29F7
   5784 0091A5 A2 30 00                     	LDX	#'0'			; holds onto the digit value
                                           
                                           ; Now loop subtracting 100,000 as many times as we can. The value was coerced
                                           ; to be between 100,000 and 1,000,000. Count the number of times subtraction
                                           ; can be done successfully.
                                           ;
   5790 0091A8                             LAB_29FB
   5791 0091A8 F4 73 93                     	PEA CONST_100000
   5792 0091AB 20 CD 92                     	JSR LOAD_FAC2	; load FAC2 with 100,000
   5793 0091AE 68                           	PLA				; get rid of parameter
   5794 0091AF AF 0E A2 FE                  	LDA FP_STATREG
   5795 0091B3 89 04 00                     	BIT #$04		; Is FAC1 > 100,000 ?
   5796 0091B6 F0 0F                        	BEQ	.0005		; branch if not
   5797 0091B8 A9 11 00                     	LDA #FP_SWAP	; subtract is FAC2-FAC1!
   5798 0091BB 20 18 93                     	JSR FPCommandWait;
   5799 0091BE A9 02 00                     	LDA #FP_SUB		; subtract 100,000 from the mantissa.
   5800 0091C1 20 18 93                     	JSR FPCommandWait
   5801 0091C4 E8                           	INX				; increment the value of the digit
   5802 0091C5 80 E1                        	BRA	LAB_29FB	; try again
   5803 0091C7                             .0005:
   5804 0091C7 8A                           	TXA
   5805 0091C8 A4 C4                        	LDY	Sendl			; get output string index
   5806 0091CA C8                           	INY				; increment output string index
   5807 0091CB 8A                           	TXA
   5808 0091CC 99 A0 03                     	STA	Decss,Y		; save to output string
   5809 0091CF C6 C0                        	DEC	numexp		; decrement # of characters before the dp
   5810 0091D1 D0 07                        	BNE	LAB_2A3B		; branch if still characters to do
                                           				; else output the point
   5812 0091D3 A9 2E 00                     	LDA	#'.'			; character "."
   5813 0091D6 C8                           	INY				; increment output string index
   5814 0091D7 99 A0 03                     	STA	Decss,Y		; save to output string
   5815 0091DA                             LAB_2A3B
   5816 0091DA 84 C4                        	STY	Sendl		; save output string index
                                           	; We subtracted until the value was < 100,000 so multiply the
                                           	; remainder upwards to get the next digit.
   5819 0091DC 20 F8 92                     	JSR	MultiplyByTen	; If not, multiply by 10
   5820 0091DF C0 1B 00                     	CPY #27			; converted (+/- . incl)
   5821 0091E2 90 C1                        	BCC	LAB_29F7
                                           					; now remove trailing zeroes
   5823 0091E4                             .RemoveTrailingZeros
   5824 0091E4 B9 A0 03                     	LDA	Decss,Y		; get character from output string
   5825 0091E7 29 FF 00                     	AND	#$FF		; mask to a byte
   5826 0091EA 88                           	DEY				; decrement output string index
   5827 0091EB C9 30 00                     	CMP	#'0'			; compare with "0"
   5828 0091EE F0 F4                        	BEQ	.RemoveTrailingZeros	; loop until non "0" character found
                                           
   5830 0091F0 C9 2E 00                     	CMP	#'.'			; compare with "."
   5831 0091F3 F0 01                        	BEQ	LAB_2A58		; branch if was dp
                                           
                                           					; restore last character
   5834 0091F5 C8                           	INY				; increment output string index
   5835 0091F6                             LAB_2A58
   5836 0091F6 A9 2B 00                     	LDA	#'+'			; character "+"
   5837 0091F9 A6 C2                        	LDX	expcnt		; get exponent count
   5838 0091FB F0 FF A2 00                  	LBEQ	LAB_2A8C		; if zero go set null terminator and exit
                                           
                                           					; exponent isn't zero so write exponent
   5841 0091FF 10 0A                        	BPL	LAB_2A68		; branch if exponent count +ve
                                           
   5843 009201 A9 00 00                     	LDA	#$00			; clear A
   5844 009204 38                           	SEC				; set carry for subtract
   5845 009205 E5 C2                        	SBC	expcnt		; subtract exponent count adjust (convert -ve to +ve)
   5846 009207 AA                           	TAX				; copy exponent count to X
   5847 009208 A9 2D 00                     	LDA	#'-'			; character "-"
                                           
                                           ; We must keep moving forwards through the string because the acc is storing
                                           ; two bytes.
                                           
   5852 00920B                             LAB_2A68
   5853 00920B 48                           	PHA
   5854 00920C A9 45 00                     	LDA	#'E'			; character "E"
   5855 00920F 99 A1 03                     	STA	Decss+1,Y		; save exponent sign to output string
   5856 009212 68                           	PLA
   5857 009213 99 A2 03                     	STA	Decss+2,Y		; save to output string
   5858 009216 8A                           	TXA				; get exponent count back
                                           
                                           ; do highest exponent digit
   5861 009217 64 C4                        	STZ Sendl
   5862 009219 A2 2F 00                     	LDX	#'0'-1		; one less than "0" character
   5863 00921C 38                           	SEC				; set carry for subtract
   5864 00921D E8                          .0001:				
   5865 00921E E9 10 27                     	SBC	#10000
   5866 009221 B0 FA                        	BCS .0001
   5867 009223 69 10 27                     	ADC #10000
   5868 009226 E0 30 00                     	CPX #'0'
   5869 009229 F0 09                        	BEQ .0005
   5870 00922B E6 C4                        	INC Sendl
   5871 00922D 48                           	PHA
   5872 00922E 8A                           	TXA
   5873 00922F 99 A3 03                     	STA Decss+3,Y
   5874 009232 68                           	PLA
   5875 009233 C8                           	INY
                                           ; do the next exponent digit
   5877 009234                             .0005:
   5878 009234 A2 2F 00                     	LDX #'0'-1
   5879 009237 38                           	SEC
   5880 009238                             .0002:
   5881 009238 E8                           	INX
   5882 009239 E9 E8 03                     	SBC #1000
   5883 00923C B0 FA                        	BCS .0002
   5884 00923E 69 E8 03                     	ADC #1000
   5885 009241 46 C4                        	LSR Sendl
   5886 009243 B0 05                        	BCS .00010
   5887 009245 E0 30 00                     	CPX #'0'
   5888 009248 F0 09                        	BEQ .0006
   5889 00924A                             .00010:
   5890 00924A E6 C4                        	INC Sendl
   5891 00924C 48                           	PHA
   5892 00924D 8A                           	TXA
   5893 00924E 99 A3 03                     	STA Decss+3,Y
   5894 009251 68                           	PLA
   5895 009252 C8                           	INY
                                           ; and the next
   5897 009253                             .0006:
   5898 009253 A2 2F 00                     	LDX	#'0'-1
   5899 009256 38                           	SEC
   5900 009257                             .0003:
   5901 009257 E8                           	INX
   5902 009258 E9 64 00                     	SBC #100
   5903 00925B B0 FA                        	BCS .0003
   5904 00925D 69 64 00                     	ADC #100
   5905 009260 46 C4                        	LSR Sendl
   5906 009262 B0 05                        	BCS .00011
   5907 009264 E0 30 00                     	CPX #'0'
   5908 009267 F0 09                        	BEQ .0007
   5909 009269                             .00011:
   5910 009269 E6 C4                        	INC Sendl
   5911 00926B 48                           	PHA
   5912 00926C 8A                           	TXA
   5913 00926D 99 A3 03                     	STA Decss+3,Y
   5914 009270 68                           	PLA
   5915 009271 C8                           	INY
                                           
   5917 009272                             .0007:
   5918 009272 A2 2F 00                     	LDX #'0'-1
   5919 009275 38                           	SEC
   5920 009276                             .0004:
   5921 009276 E8                           	INX
   5922 009277 E9 0A 00                     	SBC #10
   5923 00927A B0 FA                        	BCS .0004
   5924 00927C 69 0A 00                     	ADC #10
   5925 00927F 46 C4                        	LSR Sendl
   5926 009281 B0 05                        	BCS .00012
   5927 009283 E0 30 00                     	CPX #'0'
   5928 009286 F0 09                        	BEQ .0008
   5929 009288                             .00012:
   5930 009288 E6 C4                        	INC Sendl
   5931 00928A 48                           	PHA
   5932 00928B 8A                           	TXA
   5933 00928C 99 A3 03                     	STA Decss+3,Y
   5934 00928F 68                           	PLA
   5935 009290 C8                           	INY
                                           
   5937 009291                             .0008:
   5938 009291 69 30 00                     	ADC #'0'
   5939 009294 99 A3 03                     	STA Decss+3,Y
   5940 009297 A9 00 00                     	LDA	#$00			; set null terminator
   5941 00929A 99 A4 03                     	STA	Decss+4,Y		; save to output string
   5942 00929D 60                           	RTS					; go set string pointer (AY) and exit (branch always)
                                           
   5944 00929E                             LAB_2A89
   5945 00929E 99 A0 03                     	STA	Decss,Y		; save last character to output string
                                           					; set null terminator and exit
   5947 0092A1                             LAB_2A8C
   5948 0092A1 A9 00 00                     	LDA	#$00			; set null terminator
   5949 0092A4 99 A1 03                     	STA	Decss+1,Y		; save after last character
                                           
   5951 0092A7                             LAB_2A91
                                           ;	LDA	#<Decssp1		; set result string low pointer
                                           ;	LDY	#>Decssp1		; set result string high pointer
   5954 0092A7 60                           	RTS
                                           
   5956 0092A8                             LAB_25FB:
   5957 0092A8 A9 11 00                     	LDA		#FP_SWAP
   5958 0092AB 20 18 93                     	JSR		FPCommandWait
   5959 0092AE A0 00 00                     	LDY		#0
   5960 0092B1 BB                           	TYX
   5961 0092B2                             .0002:
   5962 0092B2 B3 03                        	LDA		(3,S),Y
   5963 0092B4 9F 00 A2 FE                  	STA		FAC1,X
   5964 0092B8 C8                           	INY
   5965 0092B9 C8                           	INY
   5966 0092BA E8                           	INX
   5967 0092BB E8                           	INX
   5968 0092BC E0 0C 00                     	CPX		#12
   5969 0092BF D0 F1                        	BNE		.0002
   5970 0092C1 A9 05 00                     	LDA		#FP_FIX2FLT
   5971 0092C4 20 18 93                     	JSR		FPCommandWait
   5972 0092C7                             FMUL:
   5973 0092C7 A9 03 00                     	LDA		#FP_MUL
   5974 0092CA 4C 18 93                     	JMP		FPCommandWait
   5975 0092CD                             	
   5976 0092CD DA                           	PHX
   5977 0092CE 5A                           	PHY
   5978 0092CF A0 00 00                     	LDY		#0
   5979 0092D2 BB                           	TYX
   5980 0092D3                             .0002:
   5981 0092D3 B3 07                        	LDA		(7,s),Y
   5982 0092D5 9F 10 A2 FE                  	STA		FAC2,X
   5983 0092D9 C8                           	INY
   5984 0092DA C8                           	INY
   5985 0092DB E8                           	INX
   5986 0092DC E8                           	INX
   5987 0092DD E0 0C 00                     	CPX		#12
   5988 0092E0 D0 F1                        	BNE		.0002
   5989 0092E2 7A                           	PLY
   5990 0092E3 FA                           	PLX
   5991 0092E4 60                           	RTS
   5992 0092E5                             	
   5993 0092E5 A9 06 00                     	LDA		#FP_FLT2FIX
   5994 0092E8 4C 18 93                     	JMP		FPCommandWait
   5995 0092EB                             	
   5996 0092EB F4 A3 93                     	PEA		CONST_POINT5
   5997 0092EE 20 CD 92                     	JSR		LOAD_FAC2
   5998 0092F1 68                           	PLA
   5999 0092F2 A9 01 00                     	LDA		#FP_ADD
   6000 0092F5 4C 18 93                     	JMP		FPCommandWait
   6001 0092F8                             	
   6002 0092F8 F4 8B 93                     	PEA		TEN_AS_FLOAT
   6003 0092FB 20 CD 92                     	JSR		LOAD_FAC2
   6004 0092FE 68                           	PLA
   6005 0092FF A9 03 00                     	LDA		#FP_MUL
   6006 009302 4C 18 93                     	JMP		FPCommandWait
                                           	
   6008 009305 F4 8B 93                     	PEA		TEN_AS_FLOAT
   6009 009308 20 CD 92                     	JSR		LOAD_FAC2
   6010 00930B 68                           	PLA
   6011 00930C 20 15 93                     	JSR		SwapFACs
   6012 00930F A9 04 00                     	LDA		#FP_DIV
   6013 009312 4C 18 93                     	JMP		FPCommandWait
   6014 009315                             	
   6015 009315 A9 11 00                     	LDA		#FP_SWAP
                                           
                                           ; Issue a command to the FP unit and wait for it to complete
                                           ;
                                           public FPCommandWait:
   6020 009318 48                           	PHA
   6021 009319 A9 06 00                     	LDA		#6
   6022 00931C 8D 00 70                     	STA		$7000
   6023 00931F                             .0001:
   6024 00931F AF 0E A2 FE                  	LDA		FP_STATREG	; get the status register
   6025 009323 89 80 00                     	BIT		#$80		; check for busy bit
   6026 009326 D0 F7                        	BNE		.0001		; if busy go back
   6027 009328 68                           	PLA					; to pop acc
   6028 009329 8F 0E A2 FE                  	STA		FP_CMDREG	; store the command
   6029 00932D 48                           	PHA
   6030 00932E A9 07 00                     	LDA		#7
   6031 009331 8D 00 70                     	STA		$7000
   6032 009334 68                           	PLA
   6033 009335 60                           	RTS
                                           
                                           ; Display the FAC1 as a hex number
                                           ;
                                           public DispFAC1:
   6038 009336 AF 0A A2 FE                  	LDA FAC1_e
   6039 00933A 20 13 CE                     	JSR DispWord
   6040 00933D AF 08 A2 FE                  	LDA	FAC1_1
   6041 009341 20 13 CE                     	JSR	DispWord
   6042 009344 AF 06 A2 FE                  	LDA FAC1_2
   6043 009348 20 13 CE                     	JSR	DispWord
   6044 00934B AF 04 A2 FE                  	LDA FAC1_3
   6045 00934F 20 13 CE                     	JSR DispWord
   6046 009352 AF 02 A2 FE                  	LDA FAC1_4
   6047 009356 20 13 CE                     	JSR DispWord
   6048 009359 AF 00 A2 FE                  	LDA FAC1_5
   6049 00935D 20 13 CE                     	JSR DispWord
   6050 009360 A9 20 00                     	LDA #' '
   6051 009363 20 14 CD                     	JSR OutChar
   6052 009366 60                           	RTS
                                           ;
                                           ; 1,000,000 as a floating point number
                                           ;
   6056 009367                             A_MILLION:	; $F4240
   6057 009367 00 00                        	dw		$0000
   6058 009369 00 00                        	dw		$0000
   6059 00936B 00 00                        	dw		$0000
   6060 00936D 00 00                        	dW		$0000
   6061 00936F 12 7A                        	dw		$7A12
   6062 009371 13 80                        	dw		$8013
                                           
   6064 009373                             CONST_100000:
                                           	;186A0
   6066 009373 00 00                        	dw		$0000
   6067 009375 00 00                        	dw		$0000
   6068 009377 00 00                        	dw		$0000
   6069 009379 00 00                        	dw		$0000
   6070 00937B A8 61                        	dw		$61A8
   6071 00937D 10 80                        	dw		$8010
                                           ; The constant 999999.4375 as hex
                                           ; 01.11_1010_0001_0001_1111_1011_1000_00000000000000000000000000
   6074 00937F                             MAX_BEFORE_SCI:
   6075 00937F 00 00                        	dw  $0000
   6076 009381 00 00                        	dw  $0000
   6077 009383 00 00                        	dw	$0000
   6078 009385 80 FB                        	dw	$FB80
   6079 009387 11 7A                        	dw	$7A11
   6080 009389 13 80                        	dw	$8013
                                           
   6082 00938B                             TEN_AS_FLOAT:
   6083 00938B 00 00                        	dw	$0000
   6084 00938D 00 00                        	dw	$0000
   6085 00938F 00 00                        	dw	$0000
   6086 009391 00 00                        	dw	$0000
   6087 009393 00 50                        	dw	$5000
   6088 009395 03 80                        	dw	$8003
                                           
                                           ; 99999.9375
                                           ; 01.10_0001_1010_0111_1111_1100_000000000000000000000000000000
                                           ;
   6093 009397                             CONST_9375:
   6094 009397 00 00                        	dw	$0000
   6095 009399 00 00                        	dw	$0000
   6096 00939B 00 00                        	dw	$0000
   6097 00939D 00 FC                        	dw	$FC00
   6098 00939F A7 61                        	dw	$61A7
   6099 0093A1 10 80                        	dw	$8010
                                           
                                           ; 0.5
   6102 0093A3                             CONST_POINT5:
   6103 0093A3 00 00                        	dw	$0000
   6104 0093A5 00 00                        	dw	$0000
   6105 0093A7 00 00                        	dw	$0000
   6106 0093A9 00 00                        	dw	$0000
   6107 0093AB 00 40                        	dw	$4000
   6108 0093AD FF 7F                        	dw	$7FFF
                                           
                                           ; This table is used in converting numbers to ASCII.
                                           
   6112 0093AF                             LAB_2A9A
   6409 = 000093B0                         LAB_2A9B = LAB_2A9A+1
   6410 = 000093B1                         LAB_2A9C = LAB_2A9B+1
                                           ;	.word	$FFFF,$F21F,$494C,$589C,$0000
                                           ;	.word	$0000,$0163,$4578,$5D8A,$0000
                                           ;	.word	$FFFF,$FFDC,$790D,$903F,$0000
                                           ;	.word	$0000,$0003,$8D7E,$A4C6,$8000
                                           ;	.word	$FFFF,$FFFF,$A50C,$EF85,$C000
                                           ;	.word	$0000,$0000,$0918,$4E72,$A000
                                           ;	.word	$FFFF,$FFFF,$FF17,$2B5A,$F000
                                           ;	.word	$0000,$0000,$0017,$4876,$E800
                                           ;	.word	$FFFF,$FFFF,$FFFD,$ABF4,$1C00
                                           ;	.word	$0000,$0000,$0000,$3B9A,$CA00
                                           ;	.word	$FFFF,$FFFF,$FFFF,$FF67,$6980
                                           ;	.word	$0000,$0000,$0000,$05F5,$E100		; 100000000
                                           ;	.word	$0000,$0000,$0098,$9680		; 10000000
                                           ;	.word   $4240,$000F,$0000,$0000,$0000,$804E		; 1000000
   6129 0093AF A0 86 01 00 00 00 00 00      	.word	$86A0,$0001,$0000,$0000,$0000,$804E		; 100000
   6129 0093B7 00 00 4E 80                
   6130 0093BB 10 27 00 00 00 00 00 00      	.word	$2710,$0000,$0000,$0000,$0000,$804E		; 10000
   6130 0093C3 00 00 4E 80                
   6131 0093C7 E8 03 00 00 00 00 00 00      	.word	$03E8,$0000,$0000,$0000,$0000,$804E		; 1000
   6131 0093CF 00 00 4E 80                
   6132 0093D3 64 00 00 00 00 00 00 00      	.word	$0064,$0000,$0000,$0000,$0000,$804E		; 100
   6132 0093DB 00 00 4E 80                
   6133 0093DF                             FIXED10:
   6134 0093DF 0A 00 00 00 00 00 00 00      	.word	$000A,$0000,$0000,$0000,$0000,$804E		; 10
   6134 0093E7 00 00 4E 80                
   6135 0093EB 01 00 00 00 00 00 00 00      	.word	$0001,$0000,$0000,$0000,$0000,$804E		; 1
   6135 0093F3 00 00 4E 80                
                                           
                                           		 MEM	16
                                           		 NDX	16
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FTBios816.asm


                                           .include "FAC1ToString.asm"
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
invaders.asm

                                           	CPU		FT832
                                           
   6444 = 0000000000FEA100                               PRNG		EQU		$FEA100
   6445 = 0000000000FEA108                               PRNG_NUM	EQU		$FEA108
   6446 = 0000000000FEA10E                               PRNG_ADV	EQU		$FEA10E
   6447 = 0000000000000001                               MAN_EXPLODING	EQU		1
                                           
                                           ; which invaders are still active (not destroyed)
                                           ; These var addresses are segment offsets into seg $7800
   6451 = 0000000000000000                               active				EQU		$00
   6452 = 000000000000005E                               left_right			EQU		$5E
   6453 = 0000000000000060                               rightmost_column	EQU		$60
   6454 = 0000000000000062                               leftmost_column		EQU		$62
   6455 = 0000000000000064                               bottom_row			EQU		$64
   6456 = 0000000000000066                               top_row				EQU		$66
   6457 = 000000000000006A                               inv_tick			EQU		$6A
   6458 = 000000000000006C                               inv_tick2			EQU		$6C
   6459 = 000000000000006E                               manX				EQU		$6E
   6460 = 0000000000000070                               manY				EQU		$70
   6461 = 0000000000000072                               manState			EQU		$72
   6462 = 0000000000000100                               InvadersX			EQU		$100
   6463 = 0000000000000200                               InvadersY			EQU		$200
   6464 = 0000000000000300                               min_right			EQU		$300
   6465 = 0000000000000310                               max_left			EQU		$310
   6466 = 0000000000000320                               bombX				EQU		$320
   6467 = 0000000000000330                               bombY				EQU		$330
   6468 = 0000000000000400                               inv_state			EQU		$400
                                           
                                           ; This var is shared, must be referenced ZS:
   6471 = 0000000000007868                               do_invaders			EQU		$7868
                                           
                                           	; minimum right +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6173 0093F7                             st_min_right:
   6174 0093F7 01 00                        	.word	1
   6175 0093F9 05 00                        	.word	5
   6176 0093FB 09 00                        	.word	9
   6177 0093FD 0D 00                        	.word	13
   6178 0093FF 11 00                        	.word	17
   6179 009401 15 00                        	.word	21
   6180 009403 19 00                        	.word	25
   6181 009405 1D 00                        	.word	29
                                           
                                           	; maximum left +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6185 009407 34 00                        	.word	52
   6186 009409 38 00                        	.word	56
   6187 00940B 3C 00                        	.word	60
   6188 00940D 40 00                        	.word	64
   6189 00940F 44 00                        	.word	68
   6190 009411 48 00                        	.word	72
   6191 009413 4C 00                        	.word	76
   6192 009415 50 00                        	.word	80
                                           
   6194 009417 00 00                        	.word	0		; rightmost column
   6195 009419 07 00                        	.word	7		; lefmost column
   6196 00941B 01 00                        	.word	1		; dx
                                           
                                           	MEM		16
                                           	NDX		16
                                           
                                           	code
                                           
   6203 00941D                             InvBomb:
   6204 00941D A2 00 00                     	LDX		#0
   6205 009420                             .0001:
   6206 009420 B5 00                        	LDA		active,X
   6207 009422 F0 27                        	BEQ		.0002
   6208 009424 20 FC 94                     	JSR		CanDropBomb
   6209 009427 F0 22                        	BEQ		.0002
   6210 009429 42 5B AF 08 A1 FE            	LDA		ZS:PRNG_NUM
   6211 00942F 42 5B 8F 0E A1 FE            	STA		ZS:PRNG_ADV
   6212 009435 29 63 00                     	AND		#$63
   6213 009438 D0 11                        	BNE		.0002
   6214 00943A 20 53 94                     	JSR		FindEmptyBomb
   6215 00943D 30 13                        	BMI		.0003
   6216 00943F BD 00 01                     	LDA		InvadersX,X
   6217 009442 99 20 03                     	STA		bombX,Y
   6218 009445 BD 00 02                     	LDA		InvadersY,X
   6219 009448 99 30 03                     	STA		bombY,Y
   6220 00944B                             .0002:
   6221 00944B E8                           	INX
   6222 00944C E8                           	INX
   6223 00944D E0 50 00                     	CPX		#80
   6224 009450 30 CE                        	BMI		.0001
   6225 009452                             .0003:
   6226 009452 60                           	RTS
                                           
   6228 009453                             FindEmptyBomb:
   6229 009453 A0 00 00                     	LDY		#0
   6230 009456                             .0001:
   6231 009456 B9 20 03                     	LDA		bombX,Y
   6232 009459 F0 0A                        	BEQ		.0002
   6233 00945B C8                           	INY
   6234 00945C C8                           	INY
   6235 00945D C0 10 00                     	CPY		#16
   6236 009460 30 F4                        	BMI		.0001
   6237 009462 A0 FF FF                     	LDY		#-1
   6238 009465                             .0002:
   6239 009465 60                           	RTS
                                           
   6241 009466                             MoveBombs:
   6242 009466 A2 00 00                     	LDX		#0
   6243 009469                             .0002:
   6244 009469 BD 20 03                     	LDA		bombX,X
   6245 00946C F0 14                        	BEQ		.0001
   6246 00946E BD 30 03                     	LDA		bombY,X
   6247 009471 C9 1E 00                     	CMP		#30			; has the bomb fallen all the way to the ground ?
   6248 009474 10 06                        	BPL		.0003		; if yes, reset bomb
   6249 009476 1A                           	INA
   6250 009477 9D 30 03                     	STA		bombY,X
   6251 00947A 80 06                        	BRA		.0001
   6252 00947C                             .0003:
   6253 00947C 9E 20 03                     	STZ		bombX,X
   6254 00947F 9E 30 03                     	STZ		bombY,X
   6255 009482                             .0001:
   6256 009482 E8                           	INX
   6257 009483 E8                           	INX
   6258 009484 E0 10 00                     	CPX		#16
   6259 009487 30 E0                        	BMI		.0002
   6260 009489 60                           	RTS
                                           
   6262 00948A                             GetBombOffset:
   6263 00948A B9 30 03                     	LDA		bombY,Y
   6264 00948D 0A                           	ASL
   6265 00948E AA                           	TAX
   6266 00948F 42 5B BD FF E2               	LDA		ZS:LineTbl,X
   6267 009494 18                           	CLC
   6268 009495 79 20 03                     	ADC		bombX,Y
   6269 009498 79 20 03                     	ADC		bombX,Y
   6270 00949B AA                           	TAX
   6271 00949C 60                           	RTS
                                           
   6273 00949D                             RenderBombs:
   6274 00949D A0 00 00                     	LDY		#0
   6275 0094A0                             .0001:
   6276 0094A0 B9 30 03                     	LDA		bombY,Y
   6277 0094A3 F0 0C                        	BEQ		.0002
   6278 0094A5 20 8A 94                     	JSR		GetBombOffset
   6279 0094A8 A9 24 00                     	LDA		#'$'
   6280 0094AB 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6281 0094B1                             .0002:
   6282 0094B1 C8                           	INY
   6283 0094B2 C8                           	INY
   6284 0094B3 C0 10 00                     	CPY		#16
   6285 0094B6 30 E8                        	BMI		.0001
   6286 0094B8 60                           	RTS
                                           
   6288 0094B9                             TestBombsIntercept:
   6289 0094B9 A0 00 00                     	LDY		#0
   6290 0094BC                             .0001:
   6291 0094BC 20 C7 94                     	JSR		TestBombIntercept
   6292 0094BF C8                           	INY
   6293 0094C0 C8                           	INY
   6294 0094C1 C0 10 00                     	CPY		#16
   6295 0094C4 30 F6                        	BMI		.0001
   6296 0094C6 60                           	RTS
                                           
   6298 0094C7                             TestBombIntercept:
   6299 0094C7 20 8A 94                     	JSR		GetBombOffset
   6300 0094CA 42 5B BF 00 00 0D            	LDA		ZS:VIDBUF,X
   6301 0094D0 C9 20 00                     	CMP		#' '
   6302 0094D3 F0 1D                        	BEQ		.0001
   6303 0094D5 B9 30 03                     	LDA		bombY,Y
   6304 0094D8 C9 1D 00                     	CMP		#29
   6305 0094DB D0 16                        	BNE		.0002
   6306 0094DD B9 20 03                     	LDA		bombX,Y
   6307 0094E0 D9 6E 00                     	CMP		manX,Y
   6308 0094E3 D0 05                        	BNE		.0003
   6309 0094E5 A9 01 00                     	LDA		#MAN_EXPLODING
   6310 0094E8 85 72                        	STA		manState
   6311 0094EA                             .0003:
   6312 0094EA BB                           	TYX
   6313 0094EB 9E 30 03                     	STZ		bombY,X
   6314 0094EE 9E 20 03                     	STZ		bombX,X
   6315 0094F1 60                           	RTS
   6316 0094F2                             .0001:
   6317 0094F2 60                           	RTS
   6318 0094F3                             .0002:
   6319 0094F3 A9 20 00                     	LDA		#' '
   6320 0094F6 9F 00 00 0D                  	STA		VIDBUF,X
   6321 0094FA 80 EE                        	BRA		.0003
                                           
                                           ; An invader can drop a bomb only if there are no invaders underneath it.
                                           
   6325 0094FC                             CanDropBomb:
   6326 0094FC E0 0F 00                     	CPX		#15
   6327 0094FF 10 0C                        	BGE		.0001
   6328 009501 B5 10                        	LDA		active+16,X
   6329 009503 15 20                        	ORA		active+32,X
   6330 009505 15 30                        	ORA		active+48,X
   6331 009507 15 40                        	ORA		active+64,X
   6332 009509 49 01 00                     	EOR		#1
   6333 00950C 60                           	RTS
   6334 00950D                             .0001:
   6335 00950D E0 1F 00                     	CPX		#31
   6336 009510 10 0A                        	BGE		.0002
   6337 009512 B5 10                        	LDA		active+16,X
   6338 009514 15 20                        	ORA		active+32,X
   6339 009516 15 30                        	ORA		active+48,X
   6340 009518 49 01 00                     	EOR		#1
   6341 00951B 60                           	RTS
   6342 00951C                             .0002:
   6343 00951C E0 2F 00                     	CPX		#47
   6344 00951F 10 08                        	BGE		.0003
   6345 009521 B5 10                        	LDA		active+16,X
   6346 009523 15 20                        	ORA		active+32,X
   6347 009525 49 01 00                     	EOR		#1
   6348 009528 60                           	RTS
   6349 009529                             .0003:
   6350 009529 E0 3F 00                     	CPX		#63
   6351 00952C 10 06                        	BGE		.0004
   6352 00952E B5 10                        	LDA		active+16,X
   6353 009530 49 01 00                     	EOR		#1
   6354 009533 60                           	RTS
   6355 009534                             .0004:
   6356 009534 A9 01 00                     	LDA		#1
   6357 009537 60                           	RTS
                                           
                                           
                                           ; Test if it's possible to move to the left anymore.
                                           ;
   6362 009538                             CanMoveLeft:
   6363 009538 A5 62                        	LDA		leftmost_column
   6364 00953A 0A                           	ASL
   6365 00953B AA                           	TAX
   6366 00953C BD 10 03                     	LDA		max_left,X
   6367 00953F DD 00 01                     	CMP		InvadersX,X
   6368 009542 30 04                        	BMI		.0001
   6369 009544 A9 00 00                     	LDA		#0
   6370 009547 60                           	RTS
   6371 009548                             .0001:
   6372 009548 A9 01 00                     	LDA		#1
   6373 00954B 60                           	RTS
                                           
                                           ; Test if it's possible to move to the right anymore.
                                           ;
   6377 00954C                             CanMoveRight:
   6378 00954C A5 60                        	LDA		rightmost_column
   6379 00954E 0A                           	ASL
   6380 00954F AA                           	TAX
   6381 009550 BD 00 03                     	LDA		min_right,X
   6382 009553 DD 00 01                     	CMP		InvadersX,X
   6383 009556 10 04                        	BPL		.0001
   6384 009558 A9 00 00                     	LDA		#0
   6385 00955B 60                           	RTS
   6386 00955C                             .0001:
   6387 00955C A9 01 00                     	LDA		#1
   6388 00955F 60                           	RTS
                                           
                                           ; Test if it's possible to move down anymore
                                           ;
   6392 009560                             CanMoveDown:
   6393 009560 A5 64                        	LDA		bottom_row
   6394 009562 0A                           	ASL
   6395 009563 0A                           	ASL
   6396 009564 0A                           	ASL
   6397 009565 0A                           	ASL
   6398 009566 AA                           	TAX
   6399 009567 BD 00 02                     	LDA		InvadersY,X
   6400 00956A C9 1E 00                     	CMP		#30
   6401 00956D 30 04                        	BMI		.0001
   6402 00956F A9 00 00                     	LDA		#0
   6403 009572 60                           	RTS
   6404 009573                             .0001:
   6405 009573 A9 01 00                     	LDA		#1
   6406 009576 60                           	RTS
                                           
                                           ; Move all the invaders to the left
                                           ; Means incrementing the X co-ordinate
                                           ;
   6411 009577                             MoveLeft:
   6412 009577 A2 00 00                     	LDX		#00
   6413 00957A                             .0002:
   6414 00957A FE 00 01                     	INC		InvadersX,X
   6415 00957D E8                           	INX
   6416 00957E E8                           	INX
   6417 00957F E0 50 00                     	CPX		#80
   6418 009582 D0 F6                        	BNE		.0002
   6419 009584 60                           	RTS
                                           
                                           ; Move all the invaders to the right.
                                           ; means decrementing the X co-ordinate
                                           ;
   6424 009585                             MoveRight:
   6425 009585 A2 00 00                     	LDX		#0
   6426 009588                             .0002:
   6427 009588 DE 00 01                     	DEC		InvadersX,X
   6428 00958B E8                           	INX
   6429 00958C E8                           	INX
   6430 00958D E0 50 00                     	CPX		#80
   6431 009590 D0 F6                        	BNE		.0002
   6432 009592 60                           	RTS
                                           
                                           ; Move all the invaders down a row.
                                           ; Means incrementing the Y co-ordinate
                                           ;
   6437 009593                             MoveDown:
   6438 009593 A2 00 00                     	LDX		#00
   6439 009596                             .0002:
   6440 009596 FE 00 02                     	INC		InvadersY,X
   6441 009599 E8                           	INX
   6442 00959A E8                           	INX
   6443 00959B E0 50 00                     	CPX		#80
   6444 00959E D0 F6                        	BNE		.0002
   6445 0095A0 60                           	RTS
                                           
                                           ; Move the invaders
                                           ; Retuns
                                           ; .A = 1 if it was possible to do a move, 0 otherwise
                                           ;
   6451 0095A1                             Move:
   6452 0095A1 24 5E                        	BIT		left_right
   6453 0095A3 30 0A                        	BMI		.0002
   6454 0095A5 20 38 95                     	JSR		CanMoveLeft
   6455 0095A8 F0 0F                        	BEQ		.0001
   6456 0095AA 20 77 95                     	JSR		MoveLeft
   6457 0095AD 80 19                        	BRA		.0003
   6458 0095AF                             .0002:
   6459 0095AF 20 4C 95                     	JSR		CanMoveRight
   6460 0095B2 F0 05                        	BEQ		.0001
   6461 0095B4 20 85 95                     	JSR		MoveRight
   6462 0095B7 80 0F                        	BRA		.0003
   6463 0095B9                             .0001:
   6464 0095B9 20 60 95                     	JSR		CanMoveDown
   6465 0095BC F0 0E                        	BEQ		.0004
   6466 0095BE A5 5E                        	LDA		left_right
   6467 0095C0 49 FF FF                     	EOR		#$FFFF
   6468 0095C3 85 5E                        	STA		left_right
   6469 0095C5 20 93 95                     	JSR		MoveDown
   6470 0095C8                             .0003:
   6471 0095C8 A9 01 00                     	LDA		#1
   6472 0095CB 60                           	RTS
   6473 0095CC                             .0004:
   6474 0095CC A9 00 00                     	LDA		#0
   6475 0095CF 60                           	RTS
                                           
   6477 0095D0                             Initialize:
   6478 0095D0 64 60                        	STZ		rightmost_column
   6479 0095D2 A9 07 00                     	LDA		#7
   6480 0095D5 85 62                        	STA		leftmost_column
   6481 0095D7 64 66                        	STZ		top_row
   6482 0095D9 A9 04 00                     	LDA		#4
   6483 0095DC 85 64                        	STA		bottom_row
   6484 0095DE 64 5E                        	STZ		left_right
   6485 0095E0 20 28 96                     	JSR		ActivateAllInvaders
   6486 0095E3 A2 00 00                     	LDX		#0
   6487 0095E6                             .0001:
   6488 0095E6 42 1B BD 41 9A               	LDA		CS:StartX,X
   6489 0095EB 9D 00 01                     	STA		InvadersX,X
   6490 0095EE 42 1B BD F1 99               	LDA		CS:StartY,X
   6491 0095F3 9D 00 02                     	STA		InvadersY,X
   6492 0095F6 E8                           	INX
   6493 0095F7 E8                           	INX
   6494 0095F8 E0 50 00                     	CPX		#80
   6495 0095FB 30 E9                        	BMI		.0001
   6496 0095FD A2 00 00                     	LDX		#0
   6497 009600                             .0002:
   6498 009600 42 1B BD F7 93               	LDA		CS:st_min_right,X
   6499 009605 9D 00 03                     	STA		min_right,X
   6500 009608 E8                           	INX
   6501 009609 E8                           	INX
   6502 00960A E0 20 00                     	CPX		#32
   6503 00960D 30 F1                        	BMI		.0002
                                           	; Initialize Bombs
   6505 00960F A2 00 00                     	LDX		#0
   6506 009612                             .0003:
   6507 009612 9E 20 03                     	STZ		bombX,X
   6508 009615 9E 30 03                     	STZ		bombY,X
   6509 009618 E8                           	INX
   6510 009619 E8                           	INX
   6511 00961A E0 10 00                     	CPX		#16
   6512 00961D 30 F3                        	BMI		.0003
   6513 00961F A9 FE FF                     	LDA		#$FFFE
   6514 009622 42 5B 8D 68 78               	STA		ZS:do_invaders
   6515 009627 60                           	RTS
                                           
   6517 009628                             ActivateAllInvaders:
   6518 009628 A2 00 00                     	LDX		#0
   6519 00962B A9 01 00                     	LDA		#1
   6520 00962E                             .0001:
   6521 00962E 95 00                        	STA		active,X
   6522 009630 E8                           	INX
   6523 009631 E8                           	INX
   6524 009632 E0 50 00                     	CPX		#80
   6525 009635 D0 F7                        	BNE		.0001
   6526 009637 60                           	RTS
                                           
   6528 009638                             IsAllDestroyed:
   6529 009638 20 C0 96                     	JSR		IsRightmostColumnDestroyed
   6530 00963B F0 2C                        	BEQ		.0001
   6531 00963D E6 60                        	INC		rightmost_column
   6532 00963F AD 0C 03                     	LDA		min_right+12
   6533 009642 8D 0E 03                     	STA		min_right+14
   6534 009645 AD 0A 03                     	LDA		min_right+10
   6535 009648 8D 0C 03                     	STA		min_right+12
   6536 00964B AD 08 03                     	LDA		min_right+8
   6537 00964E 8D 0A 03                     	STA		min_right+10
   6538 009651 AD 06 03                     	LDA		min_right+6
   6539 009654 8D 08 03                     	STA		min_right+8
   6540 009657 AD 04 03                     	LDA		min_right+4
   6541 00965A 8D 06 03                     	STA		min_right+6
   6542 00965D AD 02 03                     	LDA		min_right+2
   6543 009660 8D 04 03                     	STA		min_right+4
   6544 009663 AD 00 03                     	LDA		min_right
   6545 009666 8D 02 03                     	STA		min_right+2
   6546 009669                             .0001:
   6547 009669 20 BC 96                     	JSR		IsLeftmostColumnDestroyed
   6548 00966C F0 2C                        	BEQ		.0002
   6549 00966E C6 62                        	DEC		leftmost_column
   6550 009670 AD 12 03                     	LDA		max_left+2
   6551 009673 8D 10 03                     	STA		max_left
   6552 009676 AD 14 03                     	LDA		max_left+4
   6553 009679 8D 12 03                     	STA		max_left+2
   6554 00967C AD 16 03                     	LDA		max_left+6
   6555 00967F 8D 14 03                     	STA		max_left+4
   6556 009682 AD 18 03                     	LDA		max_left+8
   6557 009685 8D 16 03                     	STA		max_left+6
   6558 009688 AD 1A 03                     	LDA		max_left+10
   6559 00968B 8D 18 03                     	STA		max_left+8
   6560 00968E AD 1C 03                     	LDA		max_left+12
   6561 009691 8D 1A 03                     	STA		max_left+10
   6562 009694 AD 1E 03                     	LDA		max_left+14
   6563 009697 8D 1C 03                     	STA		max_left+12
   6564 00969A                             .0002:
   6565 00969A A5 62                        	LDA		leftmost_column
   6566 00969C C5 60                        	CMP		rightmost_column
   6567 00969E 30 18                        	BMI		.allDestroyed
   6568 0096A0 20 DC 96                     	JSR		IsBottomRowDestroyed
   6569 0096A3 F0 02                        	BEQ		.0003
   6570 0096A5 C6 64                        	DEC		bottom_row
   6571 0096A7                             .0003:
   6572 0096A7 20 D8 96                     	JSR		IsTopRowDestroyed
   6573 0096AA F0 02                        	BEQ		.0004
   6574 0096AC E6 66                        	INC		top_row
   6575 0096AE                             .0004:
   6576 0096AE A5 64                        	LDA		bottom_row
   6577 0096B0 C5 66                        	CMP		top_row
   6578 0096B2 30 04                        	BMI		.allDestroyed
   6579 0096B4 A9 00 00                     	LDA		#0
   6580 0096B7 60                           	RTS
   6581 0096B8                             .allDestroyed:
   6582 0096B8 A9 01 00                     	LDA		#1
   6583 0096BB 60                           	RTS
                                           
                                           
   6586 0096BC                             IsLeftmostColumnDestroyed:
   6587 0096BC A5 62                        	LDA		leftmost_column
   6588 0096BE 80 02                        	BRA		IsColumnDestroyed
   6589 0096C0                             IsRightmostColumnDestroyed:
   6590 0096C0 A5 60                        	LDA		rightmost_column
   6591 0096C2                             IsColumnDestroyed:
   6592 0096C2 0A                           	ASL
   6593 0096C3 AA                           	TAX
   6594 0096C4 B5 00                        	LDA		active,X
   6595 0096C6 15 10                        	ORA		active+16,X
   6596 0096C8 15 20                        	ORA		active+32,X
   6597 0096CA 15 30                        	ORA		active+48,X
   6598 0096CC 15 40                        	ORA		active+64,X
   6599 0096CE 15 50                        	ORA		active+80,X
   6600 0096D0 15 60                        	ORA		active+96,X
   6601 0096D2 15 70                        	ORA		active+112,X
   6602 0096D4 49 01 00                     	EOR		#1
   6603 0096D7 60                           	RTS
                                           
   6605 0096D8                             IsTopRowDestroyed:
   6606 0096D8 A5 66                        	LDA		top_row
   6607 0096DA 80 02                        	BRA		IsRowDestroyed
   6608 0096DC                             IsBottomRowDestroyed:
   6609 0096DC A5 64                        	LDA		bottom_row
   6610 0096DE                             IsRowDestroyed:
   6611 0096DE 0A                           	ASL
   6612 0096DF 0A                           	ASL
   6613 0096E0 0A                           	ASL
   6614 0096E1 0A                           	ASL
   6615 0096E2 B5 00                        	LDA		active,X
   6616 0096E4 15 02                        	ORA		active+2,X
   6617 0096E6 15 04                        	ORA		active+4,X
   6618 0096E8 15 06                        	ORA		active+6,X
   6619 0096EA 15 08                        	ORA		active+8,X
   6620 0096EC 15 0A                        	ORA		active+10,X
   6621 0096EE 15 0C                        	ORA		active+12,X
   6622 0096F0 15 0E                        	ORA		active+14,X
   6623 0096F2 49 01 00                     	EOR		#1
   6624 0096F5 60                           	RTS
                                           
                                           ; TickCount counts 1/100 of a second. We want to animate the graphics at a much
                                           ; slower rate, so we use bit 6 of the tick count to indicate when to animate.
                                           ;
   6629 0096F6                             ShiftTick:
   6630 0096F6 42 5B A5 04                  	LDA		ZS:TickCount
   6631 0096FA 4A                           	LSR
   6632 0096FB 4A                           	LSR
   6633 0096FC 4A                           	LSR
   6634 0096FD 4A                           	LSR
   6635 0096FE 4A                           	LSR
   6636 0096FF 4A                           	LSR
   6637 009700 60                           	RTS
                                           
   6639 009701                             RenderInvaders:
                                           	; First, clear the screen
   6641 009701 A2 00 00                     	LDX		#0
   6642 009704 A9 20 00                     	LDA		#' '
   6643 009707 09 00 BF                     	ORA		#$BF00
   6644 00970A                             .0003:
   6645 00970A 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6646 009710 E8                           	INX
   6647 009711 E8                           	INX
   6648 009712 E0 58 14                     	CPX		#84*31*2
   6649 009715 30 F3                        	BMI		.0003
   6650 009717 A2 00 00                     	LDX		#0
   6651 00971A                             .0002:
   6652 00971A C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   6655 00971C B5 00                        	LDA		active,X
   6656 00971E F0 FF C3 01                  	LBEQ	.0001
   6657 009722 BD 00 04                     	LDA		inv_state,X
   6658 009725 BD 00 02                     	LDA		InvadersY,X
   6659 009728 0A                           	ASL
   6660 009729 A8                           	TAY
   6661 00972A 42 5B B9 FF E2               	LDA		ZS:LineTbl,Y
   6662 00972F 18                           	CLC
   6663 009730 7D 00 01                     	ADC		InvadersX,X
   6664 009733 18                           	CLC
   6665 009734 7D 00 01                     	ADC		InvadersX,X
   6666 009737 A8                           	TAY
   6667 009738 E2 20                        	SEP		#$20			; eight bit acc
                                           	MEM		8
   6669 00973A 42 1B BD 91 9A               	LDA		CS:InvaderType,X
   6670 00973F C9 01                        	CMP		#1
   6671 009741 D0 46                        	BNE		.0004
   6672 009743 A9 E9                        	LDA		#233
   6673 009745 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6674 00974D A9 F2                        	LDA		#242
   6675 00974F 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6676 009757 A9 DF                        	LDA		#223
   6677 009759 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6678 009761 20 F6 96                     	JSR		ShiftTick
   6679 009764 90 04                        	BCC		.0005
   6680 009766 A9 58                        	LDA		#'X'
   6681 009768 80 02                        	BRA		.0006
   6682 00976A                             .0005:
   6683 00976A A9 56                        	LDA		#'V'
   6684 00976C                             .0006:
   6685 00976C 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6686 009774 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6687 00977C A9 20                        	LDA		#' '
   6688 00977E 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6689 009786 82 EA 00                     	BRL		.0007
   6690 009789                             .0004:
   6691 009789 C9 02                        	CMP		#2
   6692 00978B D0 FF 83 00                  	LBNE	.0008
   6693 00978F 20 F6 96                     	JSR		ShiftTick
   6694 009792 90 3F                        	BCC		.0009
   6695 009794 A9 FC                        	LDA		#252
   6696 009796 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6697 00979E A9 99                        	LDA		#153
   6698 0097A0 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6699 0097A8 A9 FE                        	LDA		#254
   6700 0097AA 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6701 0097B2 A9 E2                        	LDA		#226
   6702 0097B4 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6703 0097BC A9 62                        	LDA		#98
   6704 0097BE 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6705 0097C6 A9 E2                        	LDA		#226
   6706 0097C8 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6707 0097D0 82 A0 00                     	BRL		.0007
   6708 0097D3                             .0009:
   6709 0097D3 A9 62                        	LDA		#98
   6710 0097D5 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6711 0097DD A9 99                        	LDA		#153
   6712 0097DF 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6713 0097E7 A9 62                        	LDA		#98
   6714 0097E9 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6715 0097F1 A9 EC                        	LDA		#236
   6716 0097F3 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6717 0097FB A9 62                        	LDA		#98
   6718 0097FD 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6719 009805 A9 FB                        	LDA		#251
   6720 009807 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6721 00980F 82 61 00                     	BRL		.0007
   6722 009812                             .0008:
   6723 009812 A9 FF                        	LDA		#255
   6724 009814 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6725 00981C A9 F8                        	LDA		#248
   6726 00981E 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6727 009826 A9 7F                        	LDA		#127
   6728 009828 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6729 009830 20 F6 96                     	JSR		ShiftTick
   6730 009833 90 20                        	BCC		.0010
   6731 009835 A9 FF                        	LDA		#255
   6732 009837 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6733 00983F A9 F9                        	LDA		#249
   6734 009841 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6735 009849 A9 7F                        	LDA		#127
   6736 00984B 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6737 009853 80 1E                        	BRA		.0007
   6738 009855                             .0010:
   6739 009855 A9 E1                        	LDA		#225
   6740 009857 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6741 00985F A9 F9                        	LDA		#249
   6742 009861 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6743 009869 A9 60                        	LDA		#96
   6744 00986B 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6745 009873                             .0007:
                                           	; Surround the alien with spaces
   6747 009873 A9 20                        	LDA		#' '
   6748 009875 42 5B 42 99 AA FF 0C 00      	STA		ZS:VIDBUF-86,Y
                                         
   6749 00987D 42 5B 42 99 AC FF 0C 00      	STA		ZS:VIDBUF-84,Y
                                         
   6750 009885 42 5B 42 99 AE FF 0C 00      	STA		ZS:VIDBUF-82,Y
                                         
   6751 00988D 42 5B 42 99 B0 FF 0C 00      	STA		ZS:VIDBUF-80,Y
                                         
   6752 009895 42 5B 42 99 B2 FF 0C 00      	STA		ZS:VIDBUF-78,Y
                                         
   6753 00989D 42 5B 42 99 FE FF 0C 00      	STA		ZS:VIDBUF-2,Y
                                         
   6754 0098A5 42 5B 42 99 06 00 0D 00      	STA		ZS:VIDBUF+6,Y
                                         
   6755 0098AD 42 5B 42 99 52 00 0D 00      	STA		ZS:VIDBUF+82,Y
                                         
   6756 0098B5 42 5B 42 99 5A 00 0D 00      	STA		ZS:VIDBUF+90,Y
                                         
   6757 0098BD 42 5B 42 99 A6 00 0D 00      	STA		ZS:VIDBUF+166,Y
                                         
   6758 0098C5 42 5B 42 99 A8 00 0D 00      	STA		ZS:VIDBUF+168,Y
                                         
   6759 0098CD 42 5B 42 99 AA 00 0D 00      	STA		ZS:VIDBUF+170,Y
                                         
   6760 0098D5 42 5B 42 99 AC 00 0D 00      	STA		ZS:VIDBUF+172,Y
                                         
   6761 0098DD 42 5B 42 99 AE 00 0D 00      	STA		ZS:VIDBUF+174,Y
                                         
   6762 0098E5                             .0001:
   6763 0098E5 E8                           	INX
   6764 0098E6 E8                           	INX
   6765 0098E7 E0 50 00                     	CPX		#80
   6766 0098EA D0 FF 2C FE                  	LBNE	.0002
   6767 0098EE C2 20                        	REP		#$20
                                           	MEM		16
   6769 0098F0 60                           	RTS
                                           
                                           public InvadersTask:
   6772 0098F1                             .0001:
   6773 0098F1 F4 00 00                     	PEA		0				; set data segment to $7800
   6774 0098F4 F4 00 78                     	PEA		$7800
   6775 0098F7 42 2B                        	PLDS
   6776 0098F9 A9 FF 2B                     	LDA		#$2BFF			; set stack to $2BFF
   6777 0098FC 1B                           	TAS
   6778 0098FD 20 D0 95                     	JSR		Initialize
   6779 009900 42 E2 00 10                  	SEP		#$1000			; turn on single step mode
   6780 009904 20 01 97                     	JSR		RenderInvaders
   6781 009907                             .0002:
   6782 009907 42 20 87 D0 07               	JCR 	KeybdGetCharNoWaitCtx,7	; check for char at keyboard
   6783 00990C                             .0004:
   6784 00990C A2 00 00                     	LDX		#0
   6785 00990F                             .0006:
   6786 00990F E8                           	INX
   6787 009910 E0 D0 07                     	CPX		#2000
   6788 009913 D0 FA                        	BNE		.0006
   6789 009915 42 5B A5 04                  	LDA		ZS:TickCount
   6790 009919 29 03 00                     	AND		#$3
   6791 00991C D0 E9                        	BNE		.0002
   6792 00991E 20 1D 94                     	JSR		InvBomb
   6793 009921 20 01 97                     	JSR		RenderInvaders
   6794 009924 20 9D 94                     	JSR		RenderBombs
   6795 009927 20 66 94                     	JSR		MoveBombs
   6796 00992A 42 5B A5 04                  	LDA		ZS:TickCount
   6797 00992E 29 0F 00                     	AND		#$F
   6798 009931 D0 D4                        	BNE		.0002
   6799 009933 20 38 96                     	JSR		IsAllDestroyed
   6800 009936 D0 B9                        	BNE		.0001
   6801 009938 20 A1 95                     	JSR		Move
   6802 00993B F0 B4                        	BEQ		.0001				; Can't move, re-initialize
   6803 00993D 80 C8                        	BRA		.0002
   6804 00993F                             .0005:
   6805 00993F 85 6A                        	STA		inv_tick
   6806 009941 80 C4                        	BRA		.0002
   6807 009943                             .0003:
   6808 009943 C9 03 00                     	CMP		#3
   6809 009946 D0 C4                        	BNE		.0004
   6810 009948 42 5B 9C 68 78               	STZ		ZS:do_invaders
   6811 00994D 42 60                        	RTT
   6812 00994F 80 A0                        	BRA		.0001
                                           
   6814 009951                             InvaderRow:
   6815 009951 00 00                        	.word	0
   6816 009953 00 00                        	.word	0
   6817 009955 00 00                        	.word	0
   6818 009957 00 00                        	.word	0
   6819 009959 00 00                        	.word	0
   6820 00995B 00 00                        	.word	0
   6821 00995D 00 00                        	.word	0
   6822 00995F 00 00                        	.word	0
                                           
   6824 009961 01 00                        	.word	1
   6825 009963 01 00                        	.word	1
   6826 009965 01 00                        	.word	1
   6827 009967 01 00                        	.word	1
   6828 009969 01 00                        	.word	1
   6829 00996B 01 00                        	.word	1
   6830 00996D 01 00                        	.word	1
   6831 00996F 01 00                        	.word	1
                                           
   6833 009971 02 00                        	.word	2
   6834 009973 02 00                        	.word	2
   6835 009975 02 00                        	.word	2
   6836 009977 02 00                        	.word	2
   6837 009979 02 00                        	.word	2
   6838 00997B 02 00                        	.word	2
   6839 00997D 02 00                        	.word	2
   6840 00997F 02 00                        	.word	2
                                           
   6842 009981 03 00                        	.word	3
   6843 009983 03 00                        	.word	3
   6844 009985 03 00                        	.word	3
   6845 009987 03 00                        	.word	3
   6846 009989 03 00                        	.word	3
   6847 00998B 03 00                        	.word	3
   6848 00998D 03 00                        	.word	3
   6849 00998F 03 00                        	.word	3
                                           
   6851 009991 04 00                        	.word	4
   6852 009993 04 00                        	.word	4
   6853 009995 04 00                        	.word	4
   6854 009997 04 00                        	.word	4
   6855 009999 04 00                        	.word	4
   6856 00999B 04 00                        	.word	4
   6857 00999D 04 00                        	.word	4
   6858 00999F 04 00                        	.word	4
                                           
   6860 0099A1                             InvaderCol:
   6861 0099A1 00 00                        	.word	0
   6862 0099A3 01 00                        	.word	1
   6863 0099A5 02 00                        	.word	2
   6864 0099A7 03 00                        	.word	3
   6865 0099A9 04 00                        	.word	4
   6866 0099AB 05 00                        	.word	5
   6867 0099AD 06 00                        	.word	6
   6868 0099AF 07 00                        	.word	7
                                           
   6870 0099B1 00 00                        	.word	0
   6871 0099B3 01 00                        	.word	1
   6872 0099B5 02 00                        	.word	2
   6873 0099B7 03 00                        	.word	3
   6874 0099B9 04 00                        	.word	4
   6875 0099BB 05 00                        	.word	5
   6876 0099BD 06 00                        	.word	6
   6877 0099BF 07 00                        	.word	7
                                           
   6879 0099C1 00 00                        	.word	0
   6880 0099C3 01 00                        	.word	1
   6881 0099C5 02 00                        	.word	2
   6882 0099C7 03 00                        	.word	3
   6883 0099C9 04 00                        	.word	4
   6884 0099CB 05 00                        	.word	5
   6885 0099CD 06 00                        	.word	6
   6886 0099CF 07 00                        	.word	7
                                           
   6888 0099D1 00 00                        	.word	0
   6889 0099D3 01 00                        	.word	1
   6890 0099D5 02 00                        	.word	2
   6891 0099D7 03 00                        	.word	3
   6892 0099D9 04 00                        	.word	4
   6893 0099DB 05 00                        	.word	5
   6894 0099DD 06 00                        	.word	6
   6895 0099DF 07 00                        	.word	7
                                           
   6897 0099E1 00 00                        	.word	0
   6898 0099E3 01 00                        	.word	1
   6899 0099E5 02 00                        	.word	2
   6900 0099E7 03 00                        	.word	3
   6901 0099E9 04 00                        	.word	4
   6902 0099EB 05 00                        	.word	5
   6903 0099ED 06 00                        	.word	6
   6904 0099EF 07 00                        	.word	7
                                           
                                           ; Starting Y co-ordinate for each invader
                                           
   6908 0099F1                             StartY:
   6909 0099F1 03 00                        	.word	3
   6910 0099F3 03 00                        	.word	3
   6911 0099F5 03 00                        	.word	3
   6912 0099F7 03 00                        	.word	3
   6913 0099F9 03 00                        	.word	3
   6914 0099FB 03 00                        	.word	3
   6915 0099FD 03 00                        	.word	3
   6916 0099FF 03 00                        	.word	3
                                           
   6918 009A01 06 00                        	.word	6
   6919 009A03 06 00                        	.word	6
   6920 009A05 06 00                        	.word	6
   6921 009A07 06 00                        	.word	6
   6922 009A09 06 00                        	.word	6
   6923 009A0B 06 00                        	.word	6
   6924 009A0D 06 00                        	.word	6
   6925 009A0F 06 00                        	.word	6
                                           
   6927 009A11 09 00                        	.word	9
   6928 009A13 09 00                        	.word	9
   6929 009A15 09 00                        	.word	9
   6930 009A17 09 00                        	.word	9
   6931 009A19 09 00                        	.word	9
   6932 009A1B 09 00                        	.word	9
   6933 009A1D 09 00                        	.word	9
   6934 009A1F 09 00                        	.word	9
                                           
   6936 009A21 0C 00                        	.word	12
   6937 009A23 0C 00                        	.word	12
   6938 009A25 0C 00                        	.word	12
   6939 009A27 0C 00                        	.word	12
   6940 009A29 0C 00                        	.word	12
   6941 009A2B 0C 00                        	.word	12
   6942 009A2D 0C 00                        	.word	12
   6943 009A2F 0C 00                        	.word	12
                                           
   6945 009A31 0F 00                        	.word	15
   6946 009A33 0F 00                        	.word	15
   6947 009A35 0F 00                        	.word	15
   6948 009A37 0F 00                        	.word	15
   6949 009A39 0F 00                        	.word	15
   6950 009A3B 0F 00                        	.word	15
   6951 009A3D 0F 00                        	.word	15
   6952 009A3F 0F 00                        	.word	15
                                           
                                           ; Starting X co-ordinate for each invader
                                           
   6956 009A41                             StartX:
   6957 009A41 01 00                        	.word	1
   6958 009A43 05 00                        	.word	5
   6959 009A45 09 00                        	.word	9
   6960 009A47 0D 00                        	.word	13
   6961 009A49 11 00                        	.word	17
   6962 009A4B 15 00                        	.word	21
   6963 009A4D 19 00                        	.word	25
   6964 009A4F 1D 00                        	.word	29
                                           
   6966 009A51 01 00                        	.word	1
   6967 009A53 05 00                        	.word	5
   6968 009A55 09 00                        	.word	9
   6969 009A57 0D 00                        	.word	13
   6970 009A59 11 00                        	.word	17
   6971 009A5B 15 00                        	.word	21
   6972 009A5D 19 00                        	.word	25
   6973 009A5F 1D 00                        	.word	29
                                           
   6975 009A61 01 00                        	.word	1
   6976 009A63 05 00                        	.word	5
   6977 009A65 09 00                        	.word	9
   6978 009A67 0D 00                        	.word	13
   6979 009A69 11 00                        	.word	17
   6980 009A6B 15 00                        	.word	21
   6981 009A6D 19 00                        	.word	25
   6982 009A6F 1D 00                        	.word	29
                                           
   6984 009A71 01 00                        	.word	1
   6985 009A73 05 00                        	.word	5
   6986 009A75 09 00                        	.word	9
   6987 009A77 0D 00                        	.word	13
   6988 009A79 11 00                        	.word	17
   6989 009A7B 15 00                        	.word	21
   6990 009A7D 19 00                        	.word	25
   6991 009A7F 1D 00                        	.word	29
                                           
   6993 009A81 01 00                        	.word	1
   6994 009A83 05 00                        	.word	5
   6995 009A85 09 00                        	.word	9
   6996 009A87 0D 00                        	.word	13
   6997 009A89 11 00                        	.word	17
   6998 009A8B 15 00                        	.word	21
   6999 009A8D 19 00                        	.word	25
   7000 009A8F 1D 00                        	.word	29
                                           
   7002 009A91                             InvaderType:
   7003 009A91 01 00                        	.word	1
   7004 009A93 01 00                        	.word	1
   7005 009A95 01 00                        	.word	1
   7006 009A97 01 00                        	.word	1
   7007 009A99 01 00                        	.word	1
   7008 009A9B 01 00                        	.word	1
   7009 009A9D 01 00                        	.word	1
   7010 009A9F 01 00                        	.word	1
                                           
   7012 009AA1 02 00                        	.word	2
   7013 009AA3 02 00                        	.word	2
   7014 009AA5 02 00                        	.word	2
   7015 009AA7 02 00                        	.word	2
   7016 009AA9 02 00                        	.word	2
   7017 009AAB 02 00                        	.word	2
   7018 009AAD 02 00                        	.word	2
   7019 009AAF 02 00                        	.word	2
                                           
   7021 009AB1 02 00                        	.word	2
   7022 009AB3 02 00                        	.word	2
   7023 009AB5 02 00                        	.word	2
   7024 009AB7 02 00                        	.word	2
   7025 009AB9 02 00                        	.word	2
   7026 009ABB 02 00                        	.word	2
   7027 009ABD 02 00                        	.word	2
   7028 009ABF 02 00                        	.word	2
                                           
   7030 009AC1 03 00                        	.word	3
   7031 009AC3 03 00                        	.word	3
   7032 009AC5 03 00                        	.word	3
   7033 009AC7 03 00                        	.word	3
   7034 009AC9 03 00                        	.word	3
   7035 009ACB 03 00                        	.word	3
   7036 009ACD 03 00                        	.word	3
   7037 009ACF 03 00                        	.word	3
                                           
   7039 009AD1 03 00                        	.word	3
   7040 009AD3 03 00                        	.word	3
   7041 009AD5 03 00                        	.word	3
   7042 009AD7 03 00                        	.word	3
   7043 009AD9 03 00                        	.word	3
   7044 009ADB 03 00                        	.word	3
   7045 009ADD 03 00                        	.word	3
   7046 009ADF 03 00                        	.word	3
                                           			
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FTBios816.asm


                                           .include "invaders.asm"
                                           
                                           ;	cpu		W65C816S
                                           	cpu		FT832
   7051 009AE1 FF FF FF FF FF FF FF FF      	.org	$C000
   7051 009AE9 FF FF FF FF FF FF FF FF    
   7051 009AF1 FF FF FF FF FF FF FF FF    
   7051 009AF9 FF FF FF FF FF FF FF FF    
   7051 009B01 FF FF FF FF FF FF FF FF    
   7051 009B09 FF FF FF FF FF FF FF FF    
   7051 009B11 FF FF FF FF FF FF FF FF    
   7051 009B19 FF FF FF FF FF FF FF FF    
   7051 009B21 FF FF FF FF FF FF FF FF    
   7051 009B29 FF FF FF FF FF FF FF FF    
   7051 009B31 FF FF FF FF FF FF FF FF    
   7051 009B39 FF FF FF FF FF FF FF FF    
   7051 009B41 FF FF FF FF FF FF FF FF    
   7051 009B49 FF FF FF FF FF FF FF FF    
   7051 009B51 FF FF FF FF FF FF FF FF    
   7051 009B59 FF FF FF FF FF FF FF FF    
   7051 009B61 FF FF FF FF FF FF FF FF    
   7051 009B69 FF FF FF FF FF FF FF FF    
   7051 009B71 FF FF FF FF FF FF FF FF    
   7051 009B79 FF FF FF FF FF FF FF FF    
   7051 009B81 FF FF FF FF FF FF FF FF    
   7051 009B89 FF FF FF FF FF FF FF FF    
   7051 009B91 FF FF FF FF FF FF FF FF    
   7051 009B99 FF FF FF FF FF FF FF FF    
   7051 009BA1 FF FF FF FF FF FF FF FF    
   7051 009BA9 FF FF FF FF FF FF FF FF    
   7051 009BB1 FF FF FF FF FF FF FF FF    
   7051 009BB9 FF FF FF FF FF FF FF FF    
   7051 009BC1 FF FF FF FF FF FF FF FF    
   7051 009BC9 FF FF FF FF FF FF FF FF    
   7051 009BD1 FF FF FF FF FF FF FF FF    
   7051 009BD9 FF FF FF FF FF FF FF FF    
   7051 009BE1 FF FF FF FF FF FF FF FF    
   7051 009BE9 FF FF FF FF FF FF FF FF    
   7051 009BF1 FF FF FF FF FF FF FF FF    
   7051 009BF9 FF FF FF FF FF FF FF FF    
   7051 009C01 FF FF FF FF FF FF FF FF    
   7051 009C09 FF FF FF FF FF FF FF FF    
   7051 009C11 FF FF FF FF FF FF FF FF    
   7051 009C19 FF FF FF FF FF FF FF FF    
   7051 009C21 FF FF FF FF FF FF FF FF    
   7051 009C29 FF FF FF FF FF FF FF FF    
   7051 009C31 FF FF FF FF FF FF FF FF    
   7051 009C39 FF FF FF FF FF FF FF FF    
   7051 009C41 FF FF FF FF FF FF FF FF    
   7051 009C49 FF FF FF FF FF FF FF FF    
   7051 009C51 FF FF FF FF FF FF FF FF    
   7051 009C59 FF FF FF FF FF FF FF FF    
   7051 009C61 FF FF FF FF FF FF FF FF    
   7051 009C69 FF FF FF FF FF FF FF FF    
   7051 009C71 FF FF FF FF FF FF FF FF    
   7051 009C79 FF FF FF FF FF FF FF FF    
   7051 009C81 FF FF FF FF FF FF FF FF    
   7051 009C89 FF FF FF FF FF FF FF FF    
   7051 009C91 FF FF FF FF FF FF FF FF    
   7051 009C99 FF FF FF FF FF FF FF FF    
   7051 009CA1 FF FF FF FF FF FF FF FF    
   7051 009CA9 FF FF FF FF FF FF FF FF    
   7051 009CB1 FF FF FF FF FF FF FF FF    
   7051 009CB9 FF FF FF FF FF FF FF FF    
   7051 009CC1 FF FF FF FF FF FF FF FF    
   7051 009CC9 FF FF FF FF FF FF FF FF    
   7051 009CD1 FF FF FF FF FF FF FF FF    
   7051 009CD9 FF FF FF FF FF FF FF FF    
   7051 009CE1 FF FF FF FF FF FF FF FF    
   7051 009CE9 FF FF FF FF FF FF FF FF    
   7051 009CF1 FF FF FF FF FF FF FF FF    
   7051 009CF9 FF FF FF FF FF FF FF FF    
   7051 009D01 FF FF FF FF FF FF FF FF    
   7051 009D09 FF FF FF FF FF FF FF FF    
   7051 009D11 FF FF FF FF FF FF FF FF    
   7051 009D19 FF FF FF FF FF FF FF FF    
   7051 009D21 FF FF FF FF FF FF FF FF    
   7051 009D29 FF FF FF FF FF FF FF FF    
   7051 009D31 FF FF FF FF FF FF FF FF    
   7051 009D39 FF FF FF FF FF FF FF FF    
   7051 009D41 FF FF FF FF FF FF FF FF    
   7051 009D49 FF FF FF FF FF FF FF FF    
   7051 009D51 FF FF FF FF FF FF FF FF    
   7051 009D59 FF FF FF FF FF FF FF FF    
   7051 009D61 FF FF FF FF FF FF FF FF    
   7051 009D69 FF FF FF FF FF FF FF FF    
   7051 009D71 FF FF FF FF FF FF FF FF    
   7051 009D79 FF FF FF FF FF FF FF FF    
   7051 009D81 FF FF FF FF FF FF FF FF    
   7051 009D89 FF FF FF FF FF FF FF FF    
   7051 009D91 FF FF FF FF FF FF FF FF    
   7051 009D99 FF FF FF FF FF FF FF FF    
   7051 009DA1 FF FF FF FF FF FF FF FF    
   7051 009DA9 FF FF FF FF FF FF FF FF    
   7051 009DB1 FF FF FF FF FF FF FF FF    
   7051 009DB9 FF FF FF FF FF FF FF FF    
   7051 009DC1 FF FF FF FF FF FF FF FF    
   7051 009DC9 FF FF FF FF FF FF FF FF    
   7051 009DD1 FF FF FF FF FF FF FF FF    
   7051 009DD9 FF FF FF FF FF FF FF FF    
   7051 009DE1 FF FF FF FF FF FF FF FF    
   7051 009DE9 FF FF FF FF FF FF FF FF    
   7051 009DF1 FF FF FF FF FF FF FF FF    
   7051 009DF9 FF FF FF FF FF FF FF FF    
   7051 009E01 FF FF FF FF FF FF FF FF    
   7051 009E09 FF FF FF FF FF FF FF FF    
   7051 009E11 FF FF FF FF FF FF FF FF    
   7051 009E19 FF FF FF FF FF FF FF FF    
   7051 009E21 FF FF FF FF FF FF FF FF    
   7051 009E29 FF FF FF FF FF FF FF FF    
   7051 009E31 FF FF FF FF FF FF FF FF    
   7051 009E39 FF FF FF FF FF FF FF FF    
   7051 009E41 FF FF FF FF FF FF FF FF    
   7051 009E49 FF FF FF FF FF FF FF FF    
   7051 009E51 FF FF FF FF FF FF FF FF    
   7051 009E59 FF FF FF FF FF FF FF FF    
   7051 009E61 FF FF FF FF FF FF FF FF    
   7051 009E69 FF FF FF FF FF FF FF FF    
   7051 009E71 FF FF FF FF FF FF FF FF    
   7051 009E79 FF FF FF FF FF FF FF FF    
   7051 009E81 FF FF FF FF FF FF FF FF    
   7051 009E89 FF FF FF FF FF FF FF FF    
   7051 009E91 FF FF FF FF FF FF FF FF    
   7051 009E99 FF FF FF FF FF FF FF FF    
   7051 009EA1 FF FF FF FF FF FF FF FF    
   7051 009EA9 FF FF FF FF FF FF FF FF    
   7051 009EB1 FF FF FF FF FF FF FF FF    
   7051 009EB9 FF FF FF FF FF FF FF FF    
   7051 009EC1 FF FF FF FF FF FF FF FF    
   7051 009EC9 FF FF FF FF FF FF FF FF    
   7051 009ED1 FF FF FF FF FF FF FF FF    
   7051 009ED9 FF FF FF FF FF FF FF FF    
   7051 009EE1 FF FF FF FF FF FF FF FF    
   7051 009EE9 FF FF FF FF FF FF FF FF    
   7051 009EF1 FF FF FF FF FF FF FF FF    
   7051 009EF9 FF FF FF FF FF FF FF FF    
   7051 009F01 FF FF FF FF FF FF FF FF    
   7051 009F09 FF FF FF FF FF FF FF FF    
   7051 009F11 FF FF FF FF FF FF FF FF    
   7051 009F19 FF FF FF FF FF FF FF FF    
   7051 009F21 FF FF FF FF FF FF FF FF    
   7051 009F29 FF FF FF FF FF FF FF FF    
   7051 009F31 FF FF FF FF FF FF FF FF    
   7051 009F39 FF FF FF FF FF FF FF FF    
   7051 009F41 FF FF FF FF FF FF FF FF    
   7051 009F49 FF FF FF FF FF FF FF FF    
   7051 009F51 FF FF FF FF FF FF FF FF    
   7051 009F59 FF FF FF FF FF FF FF FF    
   7051 009F61 FF FF FF FF FF FF FF FF    
   7051 009F69 FF FF FF FF FF FF FF FF    
   7051 009F71 FF FF FF FF FF FF FF FF    
   7051 009F79 FF FF FF FF FF FF FF FF    
   7051 009F81 FF FF FF FF FF FF FF FF    
   7051 009F89 FF FF FF FF FF FF FF FF    
   7051 009F91 FF FF FF FF FF FF FF FF    
   7051 009F99 FF FF FF FF FF FF FF FF    
   7051 009FA1 FF FF FF FF FF FF FF FF    
   7051 009FA9 FF FF FF FF FF FF FF FF    
   7051 009FB1 FF FF FF FF FF FF FF FF    
   7051 009FB9 FF FF FF FF FF FF FF FF    
   7051 009FC1 FF FF FF FF FF FF FF FF    
   7051 009FC9 FF FF FF FF FF FF FF FF    
   7051 009FD1 FF FF FF FF FF FF FF FF    
   7051 009FD9 FF FF FF FF FF FF FF FF    
   7051 009FE1 FF FF FF FF FF FF FF FF    
   7051 009FE9 FF FF FF FF FF FF FF FF    
   7051 009FF1 FF FF FF FF FF FF FF FF    
   7051 009FF9 FF FF FF FF FF FF FF FF    
   7051 00A001 FF FF FF FF FF FF FF FF    
   7051 00A009 FF FF FF FF FF FF FF FF    
   7051 00A011 FF FF FF FF FF FF FF FF    
   7051 00A019 FF FF FF FF FF FF FF FF    
   7051 00A021 FF FF FF FF FF FF FF FF    
   7051 00A029 FF FF FF FF FF FF FF FF    
   7051 00A031 FF FF FF FF FF FF FF FF    
   7051 00A039 FF FF FF FF FF FF FF FF    
   7051 00A041 FF FF FF FF FF FF FF FF    
   7051 00A049 FF FF FF FF FF FF FF FF    
   7051 00A051 FF FF FF FF FF FF FF FF    
   7051 00A059 FF FF FF FF FF FF FF FF    
   7051 00A061 FF FF FF FF FF FF FF FF    
   7051 00A069 FF FF FF FF FF FF FF FF    
   7051 00A071 FF FF FF FF FF FF FF FF    
   7051 00A079 FF FF FF FF FF FF FF FF    
   7051 00A081 FF FF FF FF FF FF FF FF    
   7051 00A089 FF FF FF FF FF FF FF FF    
   7051 00A091 FF FF FF FF FF FF FF FF    
   7051 00A099 FF FF FF FF FF FF FF FF    
   7051 00A0A1 FF FF FF FF FF FF FF FF    
   7051 00A0A9 FF FF FF FF FF FF FF FF    
   7051 00A0B1 FF FF FF FF FF FF FF FF    
   7051 00A0B9 FF FF FF FF FF FF FF FF    
   7051 00A0C1 FF FF FF FF FF FF FF FF    
   7051 00A0C9 FF FF FF FF FF FF FF FF    
   7051 00A0D1 FF FF FF FF FF FF FF FF    
   7051 00A0D9 FF FF FF FF FF FF FF FF    
   7051 00A0E1 FF FF FF FF FF FF FF FF    
   7051 00A0E9 FF FF FF FF FF FF FF FF    
   7051 00A0F1 FF FF FF FF FF FF FF FF    
   7051 00A0F9 FF FF FF FF FF FF FF FF    
   7051 00A101 FF FF FF FF FF FF FF FF    
   7051 00A109 FF FF FF FF FF FF FF FF    
   7051 00A111 FF FF FF FF FF FF FF FF    
   7051 00A119 FF FF FF FF FF FF FF FF    
   7051 00A121 FF FF FF FF FF FF FF FF    
   7051 00A129 FF FF FF FF FF FF FF FF    
   7051 00A131 FF FF FF FF FF FF FF FF    
   7051 00A139 FF FF FF FF FF FF FF FF    
   7051 00A141 FF FF FF FF FF FF FF FF    
   7051 00A149 FF FF FF FF FF FF FF FF    
   7051 00A151 FF FF FF FF FF FF FF FF    
   7051 00A159 FF FF FF FF FF FF FF FF    
   7051 00A161 FF FF FF FF FF FF FF FF    
   7051 00A169 FF FF FF FF FF FF FF FF    
   7051 00A171 FF FF FF FF FF FF FF FF    
   7051 00A179 FF FF FF FF FF FF FF FF    
   7051 00A181 FF FF FF FF FF FF FF FF    
   7051 00A189 FF FF FF FF FF FF FF FF    
   7051 00A191 FF FF FF FF FF FF FF FF    
   7051 00A199 FF FF FF FF FF FF FF FF    
   7051 00A1A1 FF FF FF FF FF FF FF FF    
   7051 00A1A9 FF FF FF FF FF FF FF FF    
   7051 00A1B1 FF FF FF FF FF FF FF FF    
   7051 00A1B9 FF FF FF FF FF FF FF FF    
   7051 00A1C1 FF FF FF FF FF FF FF FF    
   7051 00A1C9 FF FF FF FF FF FF FF FF    
   7051 00A1D1 FF FF FF FF FF FF FF FF    
   7051 00A1D9 FF FF FF FF FF FF FF FF    
   7051 00A1E1 FF FF FF FF FF FF FF FF    
   7051 00A1E9 FF FF FF FF FF FF FF FF    
   7051 00A1F1 FF FF FF FF FF FF FF FF    
   7051 00A1F9 FF FF FF FF FF FF FF FF    
   7051 00A201 FF FF FF FF FF FF FF FF    
   7051 00A209 FF FF FF FF FF FF FF FF    
   7051 00A211 FF FF FF FF FF FF FF FF    
   7051 00A219 FF FF FF FF FF FF FF FF    
   7051 00A221 FF FF FF FF FF FF FF FF    
   7051 00A229 FF FF FF FF FF FF FF FF    
   7051 00A231 FF FF FF FF FF FF FF FF    
   7051 00A239 FF FF FF FF FF FF FF FF    
   7051 00A241 FF FF FF FF FF FF FF FF    
   7051 00A249 FF FF FF FF FF FF FF FF    
   7051 00A251 FF FF FF FF FF FF FF FF    
   7051 00A259 FF FF FF FF FF FF FF FF    
   7051 00A261 FF FF FF FF FF FF FF FF    
   7051 00A269 FF FF FF FF FF FF FF FF    
   7051 00A271 FF FF FF FF FF FF FF FF    
   7051 00A279 FF FF FF FF FF FF FF FF    
   7051 00A281 FF FF FF FF FF FF FF FF    
   7051 00A289 FF FF FF FF FF FF FF FF    
   7051 00A291 FF FF FF FF FF FF FF FF    
   7051 00A299 FF FF FF FF FF FF FF FF    
   7051 00A2A1 FF FF FF FF FF FF FF FF    
   7051 00A2A9 FF FF FF FF FF FF FF FF    
   7051 00A2B1 FF FF FF FF FF FF FF FF    
   7051 00A2B9 FF FF FF FF FF FF FF FF    
   7051 00A2C1 FF FF FF FF FF FF FF FF    
   7051 00A2C9 FF FF FF FF FF FF FF FF    
   7051 00A2D1 FF FF FF FF FF FF FF FF    
   7051 00A2D9 FF FF FF FF FF FF FF FF    
   7051 00A2E1 FF FF FF FF FF FF FF FF    
   7051 00A2E9 FF FF FF FF FF FF FF FF    
   7051 00A2F1 FF FF FF FF FF FF FF FF    
   7051 00A2F9 FF FF FF FF FF FF FF FF    
   7051 00A301 FF FF FF FF FF FF FF FF    
   7051 00A309 FF FF FF FF FF FF FF FF    
   7051 00A311 FF FF FF FF FF FF FF FF    
   7051 00A319 FF FF FF FF FF FF FF FF    
   7051 00A321 FF FF FF FF FF FF FF FF    
   7051 00A329 FF FF FF FF FF FF FF FF    
   7051 00A331 FF FF FF FF FF FF FF FF    
   7051 00A339 FF FF FF FF FF FF FF FF    
   7051 00A341 FF FF FF FF FF FF FF FF    
   7051 00A349 FF FF FF FF FF FF FF FF    
   7051 00A351 FF FF FF FF FF FF FF FF    
   7051 00A359 FF FF FF FF FF FF FF FF    
   7051 00A361 FF FF FF FF FF FF FF FF    
   7051 00A369 FF FF FF FF FF FF FF FF    
   7051 00A371 FF FF FF FF FF FF FF FF    
   7051 00A379 FF FF FF FF FF FF FF FF    
   7051 00A381 FF FF FF FF FF FF FF FF    
   7051 00A389 FF FF FF FF FF FF FF FF    
   7051 00A391 FF FF FF FF FF FF FF FF    
   7051 00A399 FF FF FF FF FF FF FF FF    
   7051 00A3A1 FF FF FF FF FF FF FF FF    
   7051 00A3A9 FF FF FF FF FF FF FF FF    
   7051 00A3B1 FF FF FF FF FF FF FF FF    
   7051 00A3B9 FF FF FF FF FF FF FF FF    
   7051 00A3C1 FF FF FF FF FF FF FF FF    
   7051 00A3C9 FF FF FF FF FF FF FF FF    
   7051 00A3D1 FF FF FF FF FF FF FF FF    
   7051 00A3D9 FF FF FF FF FF FF FF FF    
   7051 00A3E1 FF FF FF FF FF FF FF FF    
   7051 00A3E9 FF FF FF FF FF FF FF FF    
   7051 00A3F1 FF FF FF FF FF FF FF FF    
   7051 00A3F9 FF FF FF FF FF FF FF FF    
   7051 00A401 FF FF FF FF FF FF FF FF    
   7051 00A409 FF FF FF FF FF FF FF FF    
   7051 00A411 FF FF FF FF FF FF FF FF    
   7051 00A419 FF FF FF FF FF FF FF FF    
   7051 00A421 FF FF FF FF FF FF FF FF    
   7051 00A429 FF FF FF FF FF FF FF FF    
   7051 00A431 FF FF FF FF FF FF FF FF    
   7051 00A439 FF FF FF FF FF FF FF FF    
   7051 00A441 FF FF FF FF FF FF FF FF    
   7051 00A449 FF FF FF FF FF FF FF FF    
   7051 00A451 FF FF FF FF FF FF FF FF    
   7051 00A459 FF FF FF FF FF FF FF FF    
   7051 00A461 FF FF FF FF FF FF FF FF    
   7051 00A469 FF FF FF FF FF FF FF FF    
   7051 00A471 FF FF FF FF FF FF FF FF    
   7051 00A479 FF FF FF FF FF FF FF FF    
   7051 00A481 FF FF FF FF FF FF FF FF    
   7051 00A489 FF FF FF FF FF FF FF FF    
   7051 00A491 FF FF FF FF FF FF FF FF    
   7051 00A499 FF FF FF FF FF FF FF FF    
   7051 00A4A1 FF FF FF FF FF FF FF FF    
   7051 00A4A9 FF FF FF FF FF FF FF FF    
   7051 00A4B1 FF FF FF FF FF FF FF FF    
   7051 00A4B9 FF FF FF FF FF FF FF FF    
   7051 00A4C1 FF FF FF FF FF FF FF FF    
   7051 00A4C9 FF FF FF FF FF FF FF FF    
   7051 00A4D1 FF FF FF FF FF FF FF FF    
   7051 00A4D9 FF FF FF FF FF FF FF FF    
   7051 00A4E1 FF FF FF FF FF FF FF FF    
   7051 00A4E9 FF FF FF FF FF FF FF FF    
   7051 00A4F1 FF FF FF FF FF FF FF FF    
   7051 00A4F9 FF FF FF FF FF FF FF FF    
   7051 00A501 FF FF FF FF FF FF FF FF    
   7051 00A509 FF FF FF FF FF FF FF FF    
   7051 00A511 FF FF FF FF FF FF FF FF    
   7051 00A519 FF FF FF FF FF FF FF FF    
   7051 00A521 FF FF FF FF FF FF FF FF    
   7051 00A529 FF FF FF FF FF FF FF FF    
   7051 00A531 FF FF FF FF FF FF FF FF    
   7051 00A539 FF FF FF FF FF FF FF FF    
   7051 00A541 FF FF FF FF FF FF FF FF    
   7051 00A549 FF FF FF FF FF FF FF FF    
   7051 00A551 FF FF FF FF FF FF FF FF    
   7051 00A559 FF FF FF FF FF FF FF FF    
   7051 00A561 FF FF FF FF FF FF FF FF    
   7051 00A569 FF FF FF FF FF FF FF FF    
   7051 00A571 FF FF FF FF FF FF FF FF    
   7051 00A579 FF FF FF FF FF FF FF FF    
   7051 00A581 FF FF FF FF FF FF FF FF    
   7051 00A589 FF FF FF FF FF FF FF FF    
   7051 00A591 FF FF FF FF FF FF FF FF    
   7051 00A599 FF FF FF FF FF FF FF FF    
   7051 00A5A1 FF FF FF FF FF FF FF FF    
   7051 00A5A9 FF FF FF FF FF FF FF FF    
   7051 00A5B1 FF FF FF FF FF FF FF FF    
   7051 00A5B9 FF FF FF FF FF FF FF FF    
   7051 00A5C1 FF FF FF FF FF FF FF FF    
   7051 00A5C9 FF FF FF FF FF FF FF FF    
   7051 00A5D1 FF FF FF FF FF FF FF FF    
   7051 00A5D9 FF FF FF FF FF FF FF FF    
   7051 00A5E1 FF FF FF FF FF FF FF FF    
   7051 00A5E9 FF FF FF FF FF FF FF FF    
   7051 00A5F1 FF FF FF FF FF FF FF FF    
   7051 00A5F9 FF FF FF FF FF FF FF FF    
   7051 00A601 FF FF FF FF FF FF FF FF    
   7051 00A609 FF FF FF FF FF FF FF FF    
   7051 00A611 FF FF FF FF FF FF FF FF    
   7051 00A619 FF FF FF FF FF FF FF FF    
   7051 00A621 FF FF FF FF FF FF FF FF    
   7051 00A629 FF FF FF FF FF FF FF FF    
   7051 00A631 FF FF FF FF FF FF FF FF    
   7051 00A639 FF FF FF FF FF FF FF FF    
   7051 00A641 FF FF FF FF FF FF FF FF    
   7051 00A649 FF FF FF FF FF FF FF FF    
   7051 00A651 FF FF FF FF FF FF FF FF    
   7051 00A659 FF FF FF FF FF FF FF FF    
   7051 00A661 FF FF FF FF FF FF FF FF    
   7051 00A669 FF FF FF FF FF FF FF FF    
   7051 00A671 FF FF FF FF FF FF FF FF    
   7051 00A679 FF FF FF FF FF FF FF FF    
   7051 00A681 FF FF FF FF FF FF FF FF    
   7051 00A689 FF FF FF FF FF FF FF FF    
   7051 00A691 FF FF FF FF FF FF FF FF    
   7051 00A699 FF FF FF FF FF FF FF FF    
   7051 00A6A1 FF FF FF FF FF FF FF FF    
   7051 00A6A9 FF FF FF FF FF FF FF FF    
   7051 00A6B1 FF FF FF FF FF FF FF FF    
   7051 00A6B9 FF FF FF FF FF FF FF FF    
   7051 00A6C1 FF FF FF FF FF FF FF FF    
   7051 00A6C9 FF FF FF FF FF FF FF FF    
   7051 00A6D1 FF FF FF FF FF FF FF FF    
   7051 00A6D9 FF FF FF FF FF FF FF FF    
   7051 00A6E1 FF FF FF FF FF FF FF FF    
   7051 00A6E9 FF FF FF FF FF FF FF FF    
   7051 00A6F1 FF FF FF FF FF FF FF FF    
   7051 00A6F9 FF FF FF FF FF FF FF FF    
   7051 00A701 FF FF FF FF FF FF FF FF    
   7051 00A709 FF FF FF FF FF FF FF FF    
   7051 00A711 FF FF FF FF FF FF FF FF    
   7051 00A719 FF FF FF FF FF FF FF FF    
   7051 00A721 FF FF FF FF FF FF FF FF    
   7051 00A729 FF FF FF FF FF FF FF FF    
   7051 00A731 FF FF FF FF FF FF FF FF    
   7051 00A739 FF FF FF FF FF FF FF FF    
   7051 00A741 FF FF FF FF FF FF FF FF    
   7051 00A749 FF FF FF FF FF FF FF FF    
   7051 00A751 FF FF FF FF FF FF FF FF    
   7051 00A759 FF FF FF FF FF FF FF FF    
   7051 00A761 FF FF FF FF FF FF FF FF    
   7051 00A769 FF FF FF FF FF FF FF FF    
   7051 00A771 FF FF FF FF FF FF FF FF    
   7051 00A779 FF FF FF FF FF FF FF FF    
   7051 00A781 FF FF FF FF FF FF FF FF    
   7051 00A789 FF FF FF FF FF FF FF FF    
   7051 00A791 FF FF FF FF FF FF FF FF    
   7051 00A799 FF FF FF FF FF FF FF FF    
   7051 00A7A1 FF FF FF FF FF FF FF FF    
   7051 00A7A9 FF FF FF FF FF FF FF FF    
   7051 00A7B1 FF FF FF FF FF FF FF FF    
   7051 00A7B9 FF FF FF FF FF FF FF FF    
   7051 00A7C1 FF FF FF FF FF FF FF FF    
   7051 00A7C9 FF FF FF FF FF FF FF FF    
   7051 00A7D1 FF FF FF FF FF FF FF FF    
   7051 00A7D9 FF FF FF FF FF FF FF FF    
   7051 00A7E1 FF FF FF FF FF FF FF FF    
   7051 00A7E9 FF FF FF FF FF FF FF FF    
   7051 00A7F1 FF FF FF FF FF FF FF FF    
   7051 00A7F9 FF FF FF FF FF FF FF FF    
   7051 00A801 FF FF FF FF FF FF FF FF    
   7051 00A809 FF FF FF FF FF FF FF FF    
   7051 00A811 FF FF FF FF FF FF FF FF    
   7051 00A819 FF FF FF FF FF FF FF FF    
   7051 00A821 FF FF FF FF FF FF FF FF    
   7051 00A829 FF FF FF FF FF FF FF FF    
   7051 00A831 FF FF FF FF FF FF FF FF    
   7051 00A839 FF FF FF FF FF FF FF FF    
   7051 00A841 FF FF FF FF FF FF FF FF    
   7051 00A849 FF FF FF FF FF FF FF FF    
   7051 00A851 FF FF FF FF FF FF FF FF    
   7051 00A859 FF FF FF FF FF FF FF FF    
   7051 00A861 FF FF FF FF FF FF FF FF    
   7051 00A869 FF FF FF FF FF FF FF FF    
   7051 00A871 FF FF FF FF FF FF FF FF    
   7051 00A879 FF FF FF FF FF FF FF FF    
   7051 00A881 FF FF FF FF FF FF FF FF    
   7051 00A889 FF FF FF FF FF FF FF FF    
   7051 00A891 FF FF FF FF FF FF FF FF    
   7051 00A899 FF FF FF FF FF FF FF FF    
   7051 00A8A1 FF FF FF FF FF FF FF FF    
   7051 00A8A9 FF FF FF FF FF FF FF FF    
   7051 00A8B1 FF FF FF FF FF FF FF FF    
   7051 00A8B9 FF FF FF FF FF FF FF FF    
   7051 00A8C1 FF FF FF FF FF FF FF FF    
   7051 00A8C9 FF FF FF FF FF FF FF FF    
   7051 00A8D1 FF FF FF FF FF FF FF FF    
   7051 00A8D9 FF FF FF FF FF FF FF FF    
   7051 00A8E1 FF FF FF FF FF FF FF FF    
   7051 00A8E9 FF FF FF FF FF FF FF FF    
   7051 00A8F1 FF FF FF FF FF FF FF FF    
   7051 00A8F9 FF FF FF FF FF FF FF FF    
   7051 00A901 FF FF FF FF FF FF FF FF    
   7051 00A909 FF FF FF FF FF FF FF FF    
   7051 00A911 FF FF FF FF FF FF FF FF    
   7051 00A919 FF FF FF FF FF FF FF FF    
   7051 00A921 FF FF FF FF FF FF FF FF    
   7051 00A929 FF FF FF FF FF FF FF FF    
   7051 00A931 FF FF FF FF FF FF FF FF    
   7051 00A939 FF FF FF FF FF FF FF FF    
   7051 00A941 FF FF FF FF FF FF FF FF    
   7051 00A949 FF FF FF FF FF FF FF FF    
   7051 00A951 FF FF FF FF FF FF FF FF    
   7051 00A959 FF FF FF FF FF FF FF FF    
   7051 00A961 FF FF FF FF FF FF FF FF    
   7051 00A969 FF FF FF FF FF FF FF FF    
   7051 00A971 FF FF FF FF FF FF FF FF    
   7051 00A979 FF FF FF FF FF FF FF FF    
   7051 00A981 FF FF FF FF FF FF FF FF    
   7051 00A989 FF FF FF FF FF FF FF FF    
   7051 00A991 FF FF FF FF FF FF FF FF    
   7051 00A999 FF FF FF FF FF FF FF FF    
   7051 00A9A1 FF FF FF FF FF FF FF FF    
   7051 00A9A9 FF FF FF FF FF FF FF FF    
   7051 00A9B1 FF FF FF FF FF FF FF FF    
   7051 00A9B9 FF FF FF FF FF FF FF FF    
   7051 00A9C1 FF FF FF FF FF FF FF FF    
   7051 00A9C9 FF FF FF FF FF FF FF FF    
   7051 00A9D1 FF FF FF FF FF FF FF FF    
   7051 00A9D9 FF FF FF FF FF FF FF FF    
   7051 00A9E1 FF FF FF FF FF FF FF FF    
   7051 00A9E9 FF FF FF FF FF FF FF FF    
   7051 00A9F1 FF FF FF FF FF FF FF FF    
   7051 00A9F9 FF FF FF FF FF FF FF FF    
   7051 00AA01 FF FF FF FF FF FF FF FF    
   7051 00AA09 FF FF FF FF FF FF FF FF    
   7051 00AA11 FF FF FF FF FF FF FF FF    
   7051 00AA19 FF FF FF FF FF FF FF FF    
   7051 00AA21 FF FF FF FF FF FF FF FF    
   7051 00AA29 FF FF FF FF FF FF FF FF    
   7051 00AA31 FF FF FF FF FF FF FF FF    
   7051 00AA39 FF FF FF FF FF FF FF FF    
   7051 00AA41 FF FF FF FF FF FF FF FF    
   7051 00AA49 FF FF FF FF FF FF FF FF    
   7051 00AA51 FF FF FF FF FF FF FF FF    
   7051 00AA59 FF FF FF FF FF FF FF FF    
   7051 00AA61 FF FF FF FF FF FF FF FF    
   7051 00AA69 FF FF FF FF FF FF FF FF    
   7051 00AA71 FF FF FF FF FF FF FF FF    
   7051 00AA79 FF FF FF FF FF FF FF FF    
   7051 00AA81 FF FF FF FF FF FF FF FF    
   7051 00AA89 FF FF FF FF FF FF FF FF    
   7051 00AA91 FF FF FF FF FF FF FF FF    
   7051 00AA99 FF FF FF FF FF FF FF FF    
   7051 00AAA1 FF FF FF FF FF FF FF FF    
   7051 00AAA9 FF FF FF FF FF FF FF FF    
   7051 00AAB1 FF FF FF FF FF FF FF FF    
   7051 00AAB9 FF FF FF FF FF FF FF FF    
   7051 00AAC1 FF FF FF FF FF FF FF FF    
   7051 00AAC9 FF FF FF FF FF FF FF FF    
   7051 00AAD1 FF FF FF FF FF FF FF FF    
   7051 00AAD9 FF FF FF FF FF FF FF FF    
   7051 00AAE1 FF FF FF FF FF FF FF FF    
   7051 00AAE9 FF FF FF FF FF FF FF FF    
   7051 00AAF1 FF FF FF FF FF FF FF FF    
   7051 00AAF9 FF FF FF FF FF FF FF FF    
   7051 00AB01 FF FF FF FF FF FF FF FF    
   7051 00AB09 FF FF FF FF FF FF FF FF    
   7051 00AB11 FF FF FF FF FF FF FF FF    
   7051 00AB19 FF FF FF FF FF FF FF FF    
   7051 00AB21 FF FF FF FF FF FF FF FF    
   7051 00AB29 FF FF FF FF FF FF FF FF    
   7051 00AB31 FF FF FF FF FF FF FF FF    
   7051 00AB39 FF FF FF FF FF FF FF FF    
   7051 00AB41 FF FF FF FF FF FF FF FF    
   7051 00AB49 FF FF FF FF FF FF FF FF    
   7051 00AB51 FF FF FF FF FF FF FF FF    
   7051 00AB59 FF FF FF FF FF FF FF FF    
   7051 00AB61 FF FF FF FF FF FF FF FF    
   7051 00AB69 FF FF FF FF FF FF FF FF    
   7051 00AB71 FF FF FF FF FF FF FF FF    
   7051 00AB79 FF FF FF FF FF FF FF FF    
   7051 00AB81 FF FF FF FF FF FF FF FF    
   7051 00AB89 FF FF FF FF FF FF FF FF    
   7051 00AB91 FF FF FF FF FF FF FF FF    
   7051 00AB99 FF FF FF FF FF FF FF FF    
   7051 00ABA1 FF FF FF FF FF FF FF FF    
   7051 00ABA9 FF FF FF FF FF FF FF FF    
   7051 00ABB1 FF FF FF FF FF FF FF FF    
   7051 00ABB9 FF FF FF FF FF FF FF FF    
   7051 00ABC1 FF FF FF FF FF FF FF FF    
   7051 00ABC9 FF FF FF FF FF FF FF FF    
   7051 00ABD1 FF FF FF FF FF FF FF FF    
   7051 00ABD9 FF FF FF FF FF FF FF FF    
   7051 00ABE1 FF FF FF FF FF FF FF FF    
   7051 00ABE9 FF FF FF FF FF FF FF FF    
   7051 00ABF1 FF FF FF FF FF FF FF FF    
   7051 00ABF9 FF FF FF FF FF FF FF FF    
   7051 00AC01 FF FF FF FF FF FF FF FF    
   7051 00AC09 FF FF FF FF FF FF FF FF    
   7051 00AC11 FF FF FF FF FF FF FF FF    
   7051 00AC19 FF FF FF FF FF FF FF FF    
   7051 00AC21 FF FF FF FF FF FF FF FF    
   7051 00AC29 FF FF FF FF FF FF FF FF    
   7051 00AC31 FF FF FF FF FF FF FF FF    
   7051 00AC39 FF FF FF FF FF FF FF FF    
   7051 00AC41 FF FF FF FF FF FF FF FF    
   7051 00AC49 FF FF FF FF FF FF FF FF    
   7051 00AC51 FF FF FF FF FF FF FF FF    
   7051 00AC59 FF FF FF FF FF FF FF FF    
   7051 00AC61 FF FF FF FF FF FF FF FF    
   7051 00AC69 FF FF FF FF FF FF FF FF    
   7051 00AC71 FF FF FF FF FF FF FF FF    
   7051 00AC79 FF FF FF FF FF FF FF FF    
   7051 00AC81 FF FF FF FF FF FF FF FF    
   7051 00AC89 FF FF FF FF FF FF FF FF    
   7051 00AC91 FF FF FF FF FF FF FF FF    
   7051 00AC99 FF FF FF FF FF FF FF FF    
   7051 00ACA1 FF FF FF FF FF FF FF FF    
   7051 00ACA9 FF FF FF FF FF FF FF FF    
   7051 00ACB1 FF FF FF FF FF FF FF FF    
   7051 00ACB9 FF FF FF FF FF FF FF FF    
   7051 00ACC1 FF FF FF FF FF FF FF FF    
   7051 00ACC9 FF FF FF FF FF FF FF FF    
   7051 00ACD1 FF FF FF FF FF FF FF FF    
   7051 00ACD9 FF FF FF FF FF FF FF FF    
   7051 00ACE1 FF FF FF FF FF FF FF FF    
   7051 00ACE9 FF FF FF FF FF FF FF FF    
   7051 00ACF1 FF FF FF FF FF FF FF FF    
   7051 00ACF9 FF FF FF FF FF FF FF FF    
   7051 00AD01 FF FF FF FF FF FF FF FF    
   7051 00AD09 FF FF FF FF FF FF FF FF    
   7051 00AD11 FF FF FF FF FF FF FF FF    
   7051 00AD19 FF FF FF FF FF FF FF FF    
   7051 00AD21 FF FF FF FF FF FF FF FF    
   7051 00AD29 FF FF FF FF FF FF FF FF    
   7051 00AD31 FF FF FF FF FF FF FF FF    
   7051 00AD39 FF FF FF FF FF FF FF FF    
   7051 00AD41 FF FF FF FF FF FF FF FF    
   7051 00AD49 FF FF FF FF FF FF FF FF    
   7051 00AD51 FF FF FF FF FF FF FF FF    
   7051 00AD59 FF FF FF FF FF FF FF FF    
   7051 00AD61 FF FF FF FF FF FF FF FF    
   7051 00AD69 FF FF FF FF FF FF FF FF    
   7051 00AD71 FF FF FF FF FF FF FF FF    
   7051 00AD79 FF FF FF FF FF FF FF FF    
   7051 00AD81 FF FF FF FF FF FF FF FF    
   7051 00AD89 FF FF FF FF FF FF FF FF    
   7051 00AD91 FF FF FF FF FF FF FF FF    
   7051 00AD99 FF FF FF FF FF FF FF FF    
   7051 00ADA1 FF FF FF FF FF FF FF FF    
   7051 00ADA9 FF FF FF FF FF FF FF FF    
   7051 00ADB1 FF FF FF FF FF FF FF FF    
   7051 00ADB9 FF FF FF FF FF FF FF FF    
   7051 00ADC1 FF FF FF FF FF FF FF FF    
   7051 00ADC9 FF FF FF FF FF FF FF FF    
   7051 00ADD1 FF FF FF FF FF FF FF FF    
   7051 00ADD9 FF FF FF FF FF FF FF FF    
   7051 00ADE1 FF FF FF FF FF FF FF FF    
   7051 00ADE9 FF FF FF FF FF FF FF FF    
   7051 00ADF1 FF FF FF FF FF FF FF FF    
   7051 00ADF9 FF FF FF FF FF FF FF FF    
   7051 00AE01 FF FF FF FF FF FF FF FF    
   7051 00AE09 FF FF FF FF FF FF FF FF    
   7051 00AE11 FF FF FF FF FF FF FF FF    
   7051 00AE19 FF FF FF FF FF FF FF FF    
   7051 00AE21 FF FF FF FF FF FF FF FF    
   7051 00AE29 FF FF FF FF FF FF FF FF    
   7051 00AE31 FF FF FF FF FF FF FF FF    
   7051 00AE39 FF FF FF FF FF FF FF FF    
   7051 00AE41 FF FF FF FF FF FF FF FF    
   7051 00AE49 FF FF FF FF FF FF FF FF    
   7051 00AE51 FF FF FF FF FF FF FF FF    
   7051 00AE59 FF FF FF FF FF FF FF FF    
   7051 00AE61 FF FF FF FF FF FF FF FF    
   7051 00AE69 FF FF FF FF FF FF FF FF    
   7051 00AE71 FF FF FF FF FF FF FF FF    
   7051 00AE79 FF FF FF FF FF FF FF FF    
   7051 00AE81 FF FF FF FF FF FF FF FF    
   7051 00AE89 FF FF FF FF FF FF FF FF    
   7051 00AE91 FF FF FF FF FF FF FF FF    
   7051 00AE99 FF FF FF FF FF FF FF FF    
   7051 00AEA1 FF FF FF FF FF FF FF FF    
   7051 00AEA9 FF FF FF FF FF FF FF FF    
   7051 00AEB1 FF FF FF FF FF FF FF FF    
   7051 00AEB9 FF FF FF FF FF FF FF FF    
   7051 00AEC1 FF FF FF FF FF FF FF FF    
   7051 00AEC9 FF FF FF FF FF FF FF FF    
   7051 00AED1 FF FF FF FF FF FF FF FF    
   7051 00AED9 FF FF FF FF FF FF FF FF    
   7051 00AEE1 FF FF FF FF FF FF FF FF    
   7051 00AEE9 FF FF FF FF FF FF FF FF    
   7051 00AEF1 FF FF FF FF FF FF FF FF    
   7051 00AEF9 FF FF FF FF FF FF FF FF    
   7051 00AF01 FF FF FF FF FF FF FF FF    
   7051 00AF09 FF FF FF FF FF FF FF FF    
   7051 00AF11 FF FF FF FF FF FF FF FF    
   7051 00AF19 FF FF FF FF FF FF FF FF    
   7051 00AF21 FF FF FF FF FF FF FF FF    
   7051 00AF29 FF FF FF FF FF FF FF FF    
   7051 00AF31 FF FF FF FF FF FF FF FF    
   7051 00AF39 FF FF FF FF FF FF FF FF    
   7051 00AF41 FF FF FF FF FF FF FF FF    
   7051 00AF49 FF FF FF FF FF FF FF FF    
   7051 00AF51 FF FF FF FF FF FF FF FF    
   7051 00AF59 FF FF FF FF FF FF FF FF    
   7051 00AF61 FF FF FF FF FF FF FF FF    
   7051 00AF69 FF FF FF FF FF FF FF FF    
   7051 00AF71 FF FF FF FF FF FF FF FF    
   7051 00AF79 FF FF FF FF FF FF FF FF    
   7051 00AF81 FF FF FF FF FF FF FF FF    
   7051 00AF89 FF FF FF FF FF FF FF FF    
   7051 00AF91 FF FF FF FF FF FF FF FF    
   7051 00AF99 FF FF FF FF FF FF FF FF    
   7051 00AFA1 FF FF FF FF FF FF FF FF    
   7051 00AFA9 FF FF FF FF FF FF FF FF    
   7051 00AFB1 FF FF FF FF FF FF FF FF    
   7051 00AFB9 FF FF FF FF FF FF FF FF    
   7051 00AFC1 FF FF FF FF FF FF FF FF    
   7051 00AFC9 FF FF FF FF FF FF FF FF    
   7051 00AFD1 FF FF FF FF FF FF FF FF    
   7051 00AFD9 FF FF FF FF FF FF FF FF    
   7051 00AFE1 FF FF FF FF FF FF FF FF    
   7051 00AFE9 FF FF FF FF FF FF FF FF    
   7051 00AFF1 FF FF FF FF FF FF FF FF    
   7051 00AFF9 FF FF FF FF FF FF FF FF    
   7051 00B001 FF FF FF FF FF FF FF FF    
   7051 00B009 FF FF FF FF FF FF FF FF    
   7051 00B011 FF FF FF FF FF FF FF FF    
   7051 00B019 FF FF FF FF FF FF FF FF    
   7051 00B021 FF FF FF FF FF FF FF FF    
   7051 00B029 FF FF FF FF FF FF FF FF    
   7051 00B031 FF FF FF FF FF FF FF FF    
   7051 00B039 FF FF FF FF FF FF FF FF    
   7051 00B041 FF FF FF FF FF FF FF FF    
   7051 00B049 FF FF FF FF FF FF FF FF    
   7051 00B051 FF FF FF FF FF FF FF FF    
   7051 00B059 FF FF FF FF FF FF FF FF    
   7051 00B061 FF FF FF FF FF FF FF FF    
   7051 00B069 FF FF FF FF FF FF FF FF    
   7051 00B071 FF FF FF FF FF FF FF FF    
   7051 00B079 FF FF FF FF FF FF FF FF    
   7051 00B081 FF FF FF FF FF FF FF FF    
   7051 00B089 FF FF FF FF FF FF FF FF    
   7051 00B091 FF FF FF FF FF FF FF FF    
   7051 00B099 FF FF FF FF FF FF FF FF    
   7051 00B0A1 FF FF FF FF FF FF FF FF    
   7051 00B0A9 FF FF FF FF FF FF FF FF    
   7051 00B0B1 FF FF FF FF FF FF FF FF    
   7051 00B0B9 FF FF FF FF FF FF FF FF    
   7051 00B0C1 FF FF FF FF FF FF FF FF    
   7051 00B0C9 FF FF FF FF FF FF FF FF    
   7051 00B0D1 FF FF FF FF FF FF FF FF    
   7051 00B0D9 FF FF FF FF FF FF FF FF    
   7051 00B0E1 FF FF FF FF FF FF FF FF    
   7051 00B0E9 FF FF FF FF FF FF FF FF    
   7051 00B0F1 FF FF FF FF FF FF FF FF    
   7051 00B0F9 FF FF FF FF FF FF FF FF    
   7051 00B101 FF FF FF FF FF FF FF FF    
   7051 00B109 FF FF FF FF FF FF FF FF    
   7051 00B111 FF FF FF FF FF FF FF FF    
   7051 00B119 FF FF FF FF FF FF FF FF    
   7051 00B121 FF FF FF FF FF FF FF FF    
   7051 00B129 FF FF FF FF FF FF FF FF    
   7051 00B131 FF FF FF FF FF FF FF FF    
   7051 00B139 FF FF FF FF FF FF FF FF    
   7051 00B141 FF FF FF FF FF FF FF FF    
   7051 00B149 FF FF FF FF FF FF FF FF    
   7051 00B151 FF FF FF FF FF FF FF FF    
   7051 00B159 FF FF FF FF FF FF FF FF    
   7051 00B161 FF FF FF FF FF FF FF FF    
   7051 00B169 FF FF FF FF FF FF FF FF    
   7051 00B171 FF FF FF FF FF FF FF FF    
   7051 00B179 FF FF FF FF FF FF FF FF    
   7051 00B181 FF FF FF FF FF FF FF FF    
   7051 00B189 FF FF FF FF FF FF FF FF    
   7051 00B191 FF FF FF FF FF FF FF FF    
   7051 00B199 FF FF FF FF FF FF FF FF    
   7051 00B1A1 FF FF FF FF FF FF FF FF    
   7051 00B1A9 FF FF FF FF FF FF FF FF    
   7051 00B1B1 FF FF FF FF FF FF FF FF    
   7051 00B1B9 FF FF FF FF FF FF FF FF    
   7051 00B1C1 FF FF FF FF FF FF FF FF    
   7051 00B1C9 FF FF FF FF FF FF FF FF    
   7051 00B1D1 FF FF FF FF FF FF FF FF    
   7051 00B1D9 FF FF FF FF FF FF FF FF    
   7051 00B1E1 FF FF FF FF FF FF FF FF    
   7051 00B1E9 FF FF FF FF FF FF FF FF    
   7051 00B1F1 FF FF FF FF FF FF FF FF    
   7051 00B1F9 FF FF FF FF FF FF FF FF    
   7051 00B201 FF FF FF FF FF FF FF FF    
   7051 00B209 FF FF FF FF FF FF FF FF    
   7051 00B211 FF FF FF FF FF FF FF FF    
   7051 00B219 FF FF FF FF FF FF FF FF    
   7051 00B221 FF FF FF FF FF FF FF FF    
   7051 00B229 FF FF FF FF FF FF FF FF    
   7051 00B231 FF FF FF FF FF FF FF FF    
   7051 00B239 FF FF FF FF FF FF FF FF    
   7051 00B241 FF FF FF FF FF FF FF FF    
   7051 00B249 FF FF FF FF FF FF FF FF    
   7051 00B251 FF FF FF FF FF FF FF FF    
   7051 00B259 FF FF FF FF FF FF FF FF    
   7051 00B261 FF FF FF FF FF FF FF FF    
   7051 00B269 FF FF FF FF FF FF FF FF    
   7051 00B271 FF FF FF FF FF FF FF FF    
   7051 00B279 FF FF FF FF FF FF FF FF    
   7051 00B281 FF FF FF FF FF FF FF FF    
   7051 00B289 FF FF FF FF FF FF FF FF    
   7051 00B291 FF FF FF FF FF FF FF FF    
   7051 00B299 FF FF FF FF FF FF FF FF    
   7051 00B2A1 FF FF FF FF FF FF FF FF    
   7051 00B2A9 FF FF FF FF FF FF FF FF    
   7051 00B2B1 FF FF FF FF FF FF FF FF    
   7051 00B2B9 FF FF FF FF FF FF FF FF    
   7051 00B2C1 FF FF FF FF FF FF FF FF    
   7051 00B2C9 FF FF FF FF FF FF FF FF    
   7051 00B2D1 FF FF FF FF FF FF FF FF    
   7051 00B2D9 FF FF FF FF FF FF FF FF    
   7051 00B2E1 FF FF FF FF FF FF FF FF    
   7051 00B2E9 FF FF FF FF FF FF FF FF    
   7051 00B2F1 FF FF FF FF FF FF FF FF    
   7051 00B2F9 FF FF FF FF FF FF FF FF    
   7051 00B301 FF FF FF FF FF FF FF FF    
   7051 00B309 FF FF FF FF FF FF FF FF    
   7051 00B311 FF FF FF FF FF FF FF FF    
   7051 00B319 FF FF FF FF FF FF FF FF    
   7051 00B321 FF FF FF FF FF FF FF FF    
   7051 00B329 FF FF FF FF FF FF FF FF    
   7051 00B331 FF FF FF FF FF FF FF FF    
   7051 00B339 FF FF FF FF FF FF FF FF    
   7051 00B341 FF FF FF FF FF FF FF FF    
   7051 00B349 FF FF FF FF FF FF FF FF    
   7051 00B351 FF FF FF FF FF FF FF FF    
   7051 00B359 FF FF FF FF FF FF FF FF    
   7051 00B361 FF FF FF FF FF FF FF FF    
   7051 00B369 FF FF FF FF FF FF FF FF    
   7051 00B371 FF FF FF FF FF FF FF FF    
   7051 00B379 FF FF FF FF FF FF FF FF    
   7051 00B381 FF FF FF FF FF FF FF FF    
   7051 00B389 FF FF FF FF FF FF FF FF    
   7051 00B391 FF FF FF FF FF FF FF FF    
   7051 00B399 FF FF FF FF FF FF FF FF    
   7051 00B3A1 FF FF FF FF FF FF FF FF    
   7051 00B3A9 FF FF FF FF FF FF FF FF    
   7051 00B3B1 FF FF FF FF FF FF FF FF    
   7051 00B3B9 FF FF FF FF FF FF FF FF    
   7051 00B3C1 FF FF FF FF FF FF FF FF    
   7051 00B3C9 FF FF FF FF FF FF FF FF    
   7051 00B3D1 FF FF FF FF FF FF FF FF    
   7051 00B3D9 FF FF FF FF FF FF FF FF    
   7051 00B3E1 FF FF FF FF FF FF FF FF    
   7051 00B3E9 FF FF FF FF FF FF FF FF    
   7051 00B3F1 FF FF FF FF FF FF FF FF    
   7051 00B3F9 FF FF FF FF FF FF FF FF    
   7051 00B401 FF FF FF FF FF FF FF FF    
   7051 00B409 FF FF FF FF FF FF FF FF    
   7051 00B411 FF FF FF FF FF FF FF FF    
   7051 00B419 FF FF FF FF FF FF FF FF    
   7051 00B421 FF FF FF FF FF FF FF FF    
   7051 00B429 FF FF FF FF FF FF FF FF    
   7051 00B431 FF FF FF FF FF FF FF FF    
   7051 00B439 FF FF FF FF FF FF FF FF    
   7051 00B441 FF FF FF FF FF FF FF FF    
   7051 00B449 FF FF FF FF FF FF FF FF    
   7051 00B451 FF FF FF FF FF FF FF FF    
   7051 00B459 FF FF FF FF FF FF FF FF    
   7051 00B461 FF FF FF FF FF FF FF FF    
   7051 00B469 FF FF FF FF FF FF FF FF    
   7051 00B471 FF FF FF FF FF FF FF FF    
   7051 00B479 FF FF FF FF FF FF FF FF    
   7051 00B481 FF FF FF FF FF FF FF FF    
   7051 00B489 FF FF FF FF FF FF FF FF    
   7051 00B491 FF FF FF FF FF FF FF FF    
   7051 00B499 FF FF FF FF FF FF FF FF    
   7051 00B4A1 FF FF FF FF FF FF FF FF    
   7051 00B4A9 FF FF FF FF FF FF FF FF    
   7051 00B4B1 FF FF FF FF FF FF FF FF    
   7051 00B4B9 FF FF FF FF FF FF FF FF    
   7051 00B4C1 FF FF FF FF FF FF FF FF    
   7051 00B4C9 FF FF FF FF FF FF FF FF    
   7051 00B4D1 FF FF FF FF FF FF FF FF    
   7051 00B4D9 FF FF FF FF FF FF FF FF    
   7051 00B4E1 FF FF FF FF FF FF FF FF    
   7051 00B4E9 FF FF FF FF FF FF FF FF    
   7051 00B4F1 FF FF FF FF FF FF FF FF    
   7051 00B4F9 FF FF FF FF FF FF FF FF    
   7051 00B501 FF FF FF FF FF FF FF FF    
   7051 00B509 FF FF FF FF FF FF FF FF    
   7051 00B511 FF FF FF FF FF FF FF FF    
   7051 00B519 FF FF FF FF FF FF FF FF    
   7051 00B521 FF FF FF FF FF FF FF FF    
   7051 00B529 FF FF FF FF FF FF FF FF    
   7051 00B531 FF FF FF FF FF FF FF FF    
   7051 00B539 FF FF FF FF FF FF FF FF    
   7051 00B541 FF FF FF FF FF FF FF FF    
   7051 00B549 FF FF FF FF FF FF FF FF    
   7051 00B551 FF FF FF FF FF FF FF FF    
   7051 00B559 FF FF FF FF FF FF FF FF    
   7051 00B561 FF FF FF FF FF FF FF FF    
   7051 00B569 FF FF FF FF FF FF FF FF    
   7051 00B571 FF FF FF FF FF FF FF FF    
   7051 00B579 FF FF FF FF FF FF FF FF    
   7051 00B581 FF FF FF FF FF FF FF FF    
   7051 00B589 FF FF FF FF FF FF FF FF    
   7051 00B591 FF FF FF FF FF FF FF FF    
   7051 00B599 FF FF FF FF FF FF FF FF    
   7051 00B5A1 FF FF FF FF FF FF FF FF    
   7051 00B5A9 FF FF FF FF FF FF FF FF    
   7051 00B5B1 FF FF FF FF FF FF FF FF    
   7051 00B5B9 FF FF FF FF FF FF FF FF    
   7051 00B5C1 FF FF FF FF FF FF FF FF    
   7051 00B5C9 FF FF FF FF FF FF FF FF    
   7051 00B5D1 FF FF FF FF FF FF FF FF    
   7051 00B5D9 FF FF FF FF FF FF FF FF    
   7051 00B5E1 FF FF FF FF FF FF FF FF    
   7051 00B5E9 FF FF FF FF FF FF FF FF    
   7051 00B5F1 FF FF FF FF FF FF FF FF    
   7051 00B5F9 FF FF FF FF FF FF FF FF    
   7051 00B601 FF FF FF FF FF FF FF FF    
   7051 00B609 FF FF FF FF FF FF FF FF    
   7051 00B611 FF FF FF FF FF FF FF FF    
   7051 00B619 FF FF FF FF FF FF FF FF    
   7051 00B621 FF FF FF FF FF FF FF FF    
   7051 00B629 FF FF FF FF FF FF FF FF    
   7051 00B631 FF FF FF FF FF FF FF FF    
   7051 00B639 FF FF FF FF FF FF FF FF    
   7051 00B641 FF FF FF FF FF FF FF FF    
   7051 00B649 FF FF FF FF FF FF FF FF    
   7051 00B651 FF FF FF FF FF FF FF FF    
   7051 00B659 FF FF FF FF FF FF FF FF    
   7051 00B661 FF FF FF FF FF FF FF FF    
   7051 00B669 FF FF FF FF FF FF FF FF    
   7051 00B671 FF FF FF FF FF FF FF FF    
   7051 00B679 FF FF FF FF FF FF FF FF    
   7051 00B681 FF FF FF FF FF FF FF FF    
   7051 00B689 FF FF FF FF FF FF FF FF    
   7051 00B691 FF FF FF FF FF FF FF FF    
   7051 00B699 FF FF FF FF FF FF FF FF    
   7051 00B6A1 FF FF FF FF FF FF FF FF    
   7051 00B6A9 FF FF FF FF FF FF FF FF    
   7051 00B6B1 FF FF FF FF FF FF FF FF    
   7051 00B6B9 FF FF FF FF FF FF FF FF    
   7051 00B6C1 FF FF FF FF FF FF FF FF    
   7051 00B6C9 FF FF FF FF FF FF FF FF    
   7051 00B6D1 FF FF FF FF FF FF FF FF    
   7051 00B6D9 FF FF FF FF FF FF FF FF    
   7051 00B6E1 FF FF FF FF FF FF FF FF    
   7051 00B6E9 FF FF FF FF FF FF FF FF    
   7051 00B6F1 FF FF FF FF FF FF FF FF    
   7051 00B6F9 FF FF FF FF FF FF FF FF    
   7051 00B701 FF FF FF FF FF FF FF FF    
   7051 00B709 FF FF FF FF FF FF FF FF    
   7051 00B711 FF FF FF FF FF FF FF FF    
   7051 00B719 FF FF FF FF FF FF FF FF    
   7051 00B721 FF FF FF FF FF FF FF FF    
   7051 00B729 FF FF FF FF FF FF FF FF    
   7051 00B731 FF FF FF FF FF FF FF FF    
   7051 00B739 FF FF FF FF FF FF FF FF    
   7051 00B741 FF FF FF FF FF FF FF FF    
   7051 00B749 FF FF FF FF FF FF FF FF    
   7051 00B751 FF FF FF FF FF FF FF FF    
   7051 00B759 FF FF FF FF FF FF FF FF    
   7051 00B761 FF FF FF FF FF FF FF FF    
   7051 00B769 FF FF FF FF FF FF FF FF    
   7051 00B771 FF FF FF FF FF FF FF FF    
   7051 00B779 FF FF FF FF FF FF FF FF    
   7051 00B781 FF FF FF FF FF FF FF FF    
   7051 00B789 FF FF FF FF FF FF FF FF    
   7051 00B791 FF FF FF FF FF FF FF FF    
   7051 00B799 FF FF FF FF FF FF FF FF    
   7051 00B7A1 FF FF FF FF FF FF FF FF    
   7051 00B7A9 FF FF FF FF FF FF FF FF    
   7051 00B7B1 FF FF FF FF FF FF FF FF    
   7051 00B7B9 FF FF FF FF FF FF FF FF    
   7051 00B7C1 FF FF FF FF FF FF FF FF    
   7051 00B7C9 FF FF FF FF FF FF FF FF    
   7051 00B7D1 FF FF FF FF FF FF FF FF    
   7051 00B7D9 FF FF FF FF FF FF FF FF    
   7051 00B7E1 FF FF FF FF FF FF FF FF    
   7051 00B7E9 FF FF FF FF FF FF FF FF    
   7051 00B7F1 FF FF FF FF FF FF FF FF    
   7051 00B7F9 FF FF FF FF FF FF FF FF    
   7051 00B801 FF FF FF FF FF FF FF FF    
   7051 00B809 FF FF FF FF FF FF FF FF    
   7051 00B811 FF FF FF FF FF FF FF FF    
   7051 00B819 FF FF FF FF FF FF FF FF    
   7051 00B821 FF FF FF FF FF FF FF FF    
   7051 00B829 FF FF FF FF FF FF FF FF    
   7051 00B831 FF FF FF FF FF FF FF FF    
   7051 00B839 FF FF FF FF FF FF FF FF    
   7051 00B841 FF FF FF FF FF FF FF FF    
   7051 00B849 FF FF FF FF FF FF FF FF    
   7051 00B851 FF FF FF FF FF FF FF FF    
   7051 00B859 FF FF FF FF FF FF FF FF    
   7051 00B861 FF FF FF FF FF FF FF FF    
   7051 00B869 FF FF FF FF FF FF FF FF    
   7051 00B871 FF FF FF FF FF FF FF FF    
   7051 00B879 FF FF FF FF FF FF FF FF    
   7051 00B881 FF FF FF FF FF FF FF FF    
   7051 00B889 FF FF FF FF FF FF FF FF    
   7051 00B891 FF FF FF FF FF FF FF FF    
   7051 00B899 FF FF FF FF FF FF FF FF    
   7051 00B8A1 FF FF FF FF FF FF FF FF    
   7051 00B8A9 FF FF FF FF FF FF FF FF    
   7051 00B8B1 FF FF FF FF FF FF FF FF    
   7051 00B8B9 FF FF FF FF FF FF FF FF    
   7051 00B8C1 FF FF FF FF FF FF FF FF    
   7051 00B8C9 FF FF FF FF FF FF FF FF    
   7051 00B8D1 FF FF FF FF FF FF FF FF    
   7051 00B8D9 FF FF FF FF FF FF FF FF    
   7051 00B8E1 FF FF FF FF FF FF FF FF    
   7051 00B8E9 FF FF FF FF FF FF FF FF    
   7051 00B8F1 FF FF FF FF FF FF FF FF    
   7051 00B8F9 FF FF FF FF FF FF FF FF    
   7051 00B901 FF FF FF FF FF FF FF FF    
   7051 00B909 FF FF FF FF FF FF FF FF    
   7051 00B911 FF FF FF FF FF FF FF FF    
   7051 00B919 FF FF FF FF FF FF FF FF    
   7051 00B921 FF FF FF FF FF FF FF FF    
   7051 00B929 FF FF FF FF FF FF FF FF    
   7051 00B931 FF FF FF FF FF FF FF FF    
   7051 00B939 FF FF FF FF FF FF FF FF    
   7051 00B941 FF FF FF FF FF FF FF FF    
   7051 00B949 FF FF FF FF FF FF FF FF    
   7051 00B951 FF FF FF FF FF FF FF FF    
   7051 00B959 FF FF FF FF FF FF FF FF    
   7051 00B961 FF FF FF FF FF FF FF FF    
   7051 00B969 FF FF FF FF FF FF FF FF    
   7051 00B971 FF FF FF FF FF FF FF FF    
   7051 00B979 FF FF FF FF FF FF FF FF    
   7051 00B981 FF FF FF FF FF FF FF FF    
   7051 00B989 FF FF FF FF FF FF FF FF    
   7051 00B991 FF FF FF FF FF FF FF FF    
   7051 00B999 FF FF FF FF FF FF FF FF    
   7051 00B9A1 FF FF FF FF FF FF FF FF    
   7051 00B9A9 FF FF FF FF FF FF FF FF    
   7051 00B9B1 FF FF FF FF FF FF FF FF    
   7051 00B9B9 FF FF FF FF FF FF FF FF    
   7051 00B9C1 FF FF FF FF FF FF FF FF    
   7051 00B9C9 FF FF FF FF FF FF FF FF    
   7051 00B9D1 FF FF FF FF FF FF FF FF    
   7051 00B9D9 FF FF FF FF FF FF FF FF    
   7051 00B9E1 FF FF FF FF FF FF FF FF    
   7051 00B9E9 FF FF FF FF FF FF FF FF    
   7051 00B9F1 FF FF FF FF FF FF FF FF    
   7051 00B9F9 FF FF FF FF FF FF FF FF    
   7051 00BA01 FF FF FF FF FF FF FF FF    
   7051 00BA09 FF FF FF FF FF FF FF FF    
   7051 00BA11 FF FF FF FF FF FF FF FF    
   7051 00BA19 FF FF FF FF FF FF FF FF    
   7051 00BA21 FF FF FF FF FF FF FF FF    
   7051 00BA29 FF FF FF FF FF FF FF FF    
   7051 00BA31 FF FF FF FF FF FF FF FF    
   7051 00BA39 FF FF FF FF FF FF FF FF    
   7051 00BA41 FF FF FF FF FF FF FF FF    
   7051 00BA49 FF FF FF FF FF FF FF FF    
   7051 00BA51 FF FF FF FF FF FF FF FF    
   7051 00BA59 FF FF FF FF FF FF FF FF    
   7051 00BA61 FF FF FF FF FF FF FF FF    
   7051 00BA69 FF FF FF FF FF FF FF FF    
   7051 00BA71 FF FF FF FF FF FF FF FF    
   7051 00BA79 FF FF FF FF FF FF FF FF    
   7051 00BA81 FF FF FF FF FF FF FF FF    
   7051 00BA89 FF FF FF FF FF FF FF FF    
   7051 00BA91 FF FF FF FF FF FF FF FF    
   7051 00BA99 FF FF FF FF FF FF FF FF    
   7051 00BAA1 FF FF FF FF FF FF FF FF    
   7051 00BAA9 FF FF FF FF FF FF FF FF    
   7051 00BAB1 FF FF FF FF FF FF FF FF    
   7051 00BAB9 FF FF FF FF FF FF FF FF    
   7051 00BAC1 FF FF FF FF FF FF FF FF    
   7051 00BAC9 FF FF FF FF FF FF FF FF    
   7051 00BAD1 FF FF FF FF FF FF FF FF    
   7051 00BAD9 FF FF FF FF FF FF FF FF    
   7051 00BAE1 FF FF FF FF FF FF FF FF    
   7051 00BAE9 FF FF FF FF FF FF FF FF    
   7051 00BAF1 FF FF FF FF FF FF FF FF    
   7051 00BAF9 FF FF FF FF FF FF FF FF    
   7051 00BB01 FF FF FF FF FF FF FF FF    
   7051 00BB09 FF FF FF FF FF FF FF FF    
   7051 00BB11 FF FF FF FF FF FF FF FF    
   7051 00BB19 FF FF FF FF FF FF FF FF    
   7051 00BB21 FF FF FF FF FF FF FF FF    
   7051 00BB29 FF FF FF FF FF FF FF FF    
   7051 00BB31 FF FF FF FF FF FF FF FF    
   7051 00BB39 FF FF FF FF FF FF FF FF    
   7051 00BB41 FF FF FF FF FF FF FF FF    
   7051 00BB49 FF FF FF FF FF FF FF FF    
   7051 00BB51 FF FF FF FF FF FF FF FF    
   7051 00BB59 FF FF FF FF FF FF FF FF    
   7051 00BB61 FF FF FF FF FF FF FF FF    
   7051 00BB69 FF FF FF FF FF FF FF FF    
   7051 00BB71 FF FF FF FF FF FF FF FF    
   7051 00BB79 FF FF FF FF FF FF FF FF    
   7051 00BB81 FF FF FF FF FF FF FF FF    
   7051 00BB89 FF FF FF FF FF FF FF FF    
   7051 00BB91 FF FF FF FF FF FF FF FF    
   7051 00BB99 FF FF FF FF FF FF FF FF    
   7051 00BBA1 FF FF FF FF FF FF FF FF    
   7051 00BBA9 FF FF FF FF FF FF FF FF    
   7051 00BBB1 FF FF FF FF FF FF FF FF    
   7051 00BBB9 FF FF FF FF FF FF FF FF    
   7051 00BBC1 FF FF FF FF FF FF FF FF    
   7051 00BBC9 FF FF FF FF FF FF FF FF    
   7051 00BBD1 FF FF FF FF FF FF FF FF    
   7051 00BBD9 FF FF FF FF FF FF FF FF    
   7051 00BBE1 FF FF FF FF FF FF FF FF    
   7051 00BBE9 FF FF FF FF FF FF FF FF    
   7051 00BBF1 FF FF FF FF FF FF FF FF    
   7051 00BBF9 FF FF FF FF FF FF FF FF    
   7051 00BC01 FF FF FF FF FF FF FF FF    
   7051 00BC09 FF FF FF FF FF FF FF FF    
   7051 00BC11 FF FF FF FF FF FF FF FF    
   7051 00BC19 FF FF FF FF FF FF FF FF    
   7051 00BC21 FF FF FF FF FF FF FF FF    
   7051 00BC29 FF FF FF FF FF FF FF FF    
   7051 00BC31 FF FF FF FF FF FF FF FF    
   7051 00BC39 FF FF FF FF FF FF FF FF    
   7051 00BC41 FF FF FF FF FF FF FF FF    
   7051 00BC49 FF FF FF FF FF FF FF FF    
   7051 00BC51 FF FF FF FF FF FF FF FF    
   7051 00BC59 FF FF FF FF FF FF FF FF    
   7051 00BC61 FF FF FF FF FF FF FF FF    
   7051 00BC69 FF FF FF FF FF FF FF FF    
   7051 00BC71 FF FF FF FF FF FF FF FF    
   7051 00BC79 FF FF FF FF FF FF FF FF    
   7051 00BC81 FF FF FF FF FF FF FF FF    
   7051 00BC89 FF FF FF FF FF FF FF FF    
   7051 00BC91 FF FF FF FF FF FF FF FF    
   7051 00BC99 FF FF FF FF FF FF FF FF    
   7051 00BCA1 FF FF FF FF FF FF FF FF    
   7051 00BCA9 FF FF FF FF FF FF FF FF    
   7051 00BCB1 FF FF FF FF FF FF FF FF    
   7051 00BCB9 FF FF FF FF FF FF FF FF    
   7051 00BCC1 FF FF FF FF FF FF FF FF    
   7051 00BCC9 FF FF FF FF FF FF FF FF    
   7051 00BCD1 FF FF FF FF FF FF FF FF    
   7051 00BCD9 FF FF FF FF FF FF FF FF    
   7051 00BCE1 FF FF FF FF FF FF FF FF    
   7051 00BCE9 FF FF FF FF FF FF FF FF    
   7051 00BCF1 FF FF FF FF FF FF FF FF    
   7051 00BCF9 FF FF FF FF FF FF FF FF    
   7051 00BD01 FF FF FF FF FF FF FF FF    
   7051 00BD09 FF FF FF FF FF FF FF FF    
   7051 00BD11 FF FF FF FF FF FF FF FF    
   7051 00BD19 FF FF FF FF FF FF FF FF    
   7051 00BD21 FF FF FF FF FF FF FF FF    
   7051 00BD29 FF FF FF FF FF FF FF FF    
   7051 00BD31 FF FF FF FF FF FF FF FF    
   7051 00BD39 FF FF FF FF FF FF FF FF    
   7051 00BD41 FF FF FF FF FF FF FF FF    
   7051 00BD49 FF FF FF FF FF FF FF FF    
   7051 00BD51 FF FF FF FF FF FF FF FF    
   7051 00BD59 FF FF FF FF FF FF FF FF    
   7051 00BD61 FF FF FF FF FF FF FF FF    
   7051 00BD69 FF FF FF FF FF FF FF FF    
   7051 00BD71 FF FF FF FF FF FF FF FF    
   7051 00BD79 FF FF FF FF FF FF FF FF    
   7051 00BD81 FF FF FF FF FF FF FF FF    
   7051 00BD89 FF FF FF FF FF FF FF FF    
   7051 00BD91 FF FF FF FF FF FF FF FF    
   7051 00BD99 FF FF FF FF FF FF FF FF    
   7051 00BDA1 FF FF FF FF FF FF FF FF    
   7051 00BDA9 FF FF FF FF FF FF FF FF    
   7051 00BDB1 FF FF FF FF FF FF FF FF    
   7051 00BDB9 FF FF FF FF FF FF FF FF    
   7051 00BDC1 FF FF FF FF FF FF FF FF    
   7051 00BDC9 FF FF FF FF FF FF FF FF    
   7051 00BDD1 FF FF FF FF FF FF FF FF    
   7051 00BDD9 FF FF FF FF FF FF FF FF    
   7051 00BDE1 FF FF FF FF FF FF FF FF    
   7051 00BDE9 FF FF FF FF FF FF FF FF    
   7051 00BDF1 FF FF FF FF FF FF FF FF    
   7051 00BDF9 FF FF FF FF FF FF FF FF    
   7051 00BE01 FF FF FF FF FF FF FF FF    
   7051 00BE09 FF FF FF FF FF FF FF FF    
   7051 00BE11 FF FF FF FF FF FF FF FF    
   7051 00BE19 FF FF FF FF FF FF FF FF    
   7051 00BE21 FF FF FF FF FF FF FF FF    
   7051 00BE29 FF FF FF FF FF FF FF FF    
   7051 00BE31 FF FF FF FF FF FF FF FF    
   7051 00BE39 FF FF FF FF FF FF FF FF    
   7051 00BE41 FF FF FF FF FF FF FF FF    
   7051 00BE49 FF FF FF FF FF FF FF FF    
   7051 00BE51 FF FF FF FF FF FF FF FF    
   7051 00BE59 FF FF FF FF FF FF FF FF    
   7051 00BE61 FF FF FF FF FF FF FF FF    
   7051 00BE69 FF FF FF FF FF FF FF FF    
   7051 00BE71 FF FF FF FF FF FF FF FF    
   7051 00BE79 FF FF FF FF FF FF FF FF    
   7051 00BE81 FF FF FF FF FF FF FF FF    
   7051 00BE89 FF FF FF FF FF FF FF FF    
   7051 00BE91 FF FF FF FF FF FF FF FF    
   7051 00BE99 FF FF FF FF FF FF FF FF    
   7051 00BEA1 FF FF FF FF FF FF FF FF    
   7051 00BEA9 FF FF FF FF FF FF FF FF    
   7051 00BEB1 FF FF FF FF FF FF FF FF    
   7051 00BEB9 FF FF FF FF FF FF FF FF    
   7051 00BEC1 FF FF FF FF FF FF FF FF    
   7051 00BEC9 FF FF FF FF FF FF FF FF    
   7051 00BED1 FF FF FF FF FF FF FF FF    
   7051 00BED9 FF FF FF FF FF FF FF FF    
   7051 00BEE1 FF FF FF FF FF FF FF FF    
   7051 00BEE9 FF FF FF FF FF FF FF FF    
   7051 00BEF1 FF FF FF FF FF FF FF FF    
   7051 00BEF9 FF FF FF FF FF FF FF FF    
   7051 00BF01 FF FF FF FF FF FF FF FF    
   7051 00BF09 FF FF FF FF FF FF FF FF    
   7051 00BF11 FF FF FF FF FF FF FF FF    
   7051 00BF19 FF FF FF FF FF FF FF FF    
   7051 00BF21 FF FF FF FF FF FF FF FF    
   7051 00BF29 FF FF FF FF FF FF FF FF    
   7051 00BF31 FF FF FF FF FF FF FF FF    
   7051 00BF39 FF FF FF FF FF FF FF FF    
   7051 00BF41 FF FF FF FF FF FF FF FF    
   7051 00BF49 FF FF FF FF FF FF FF FF    
   7051 00BF51 FF FF FF FF FF FF FF FF    
   7051 00BF59 FF FF FF FF FF FF FF FF    
   7051 00BF61 FF FF FF FF FF FF FF FF    
   7051 00BF69 FF FF FF FF FF FF FF FF    
   7051 00BF71 FF FF FF FF FF FF FF FF    
   7051 00BF79 FF FF FF FF FF FF FF FF    
   7051 00BF81 FF FF FF FF FF FF FF FF    
   7051 00BF89 FF FF FF FF FF FF FF FF    
   7051 00BF91 FF FF FF FF FF FF FF FF    
   7051 00BF99 FF FF FF FF FF FF FF FF    
   7051 00BFA1 FF FF FF FF FF FF FF FF    
   7051 00BFA9 FF FF FF FF FF FF FF FF    
   7051 00BFB1 FF FF FF FF FF FF FF FF    
   7051 00BFB9 FF FF FF FF FF FF FF FF    
   7051 00BFC1 FF FF FF FF FF FF FF FF    
   7051 00BFC9 FF FF FF FF FF FF FF FF    
   7051 00BFD1 FF FF FF FF FF FF FF FF    
   7051 00BFD9 FF FF FF FF FF FF FF FF    
   7051 00BFE1 FF FF FF FF FF FF FF FF    
   7051 00BFE9 FF FF FF FF FF FF FF FF    
   7051 00BFF1 FF FF FF FF FF FF FF FF    
   7051 00BFF9 FF FF FF FF FF FF FF       
                                           
   7053 00C000                             start:
   7054 00C000 78                           	SEI					; not strictly necessary after power on reset
   7055 00C001 D8                           	CLD
                                           ;	CLV					; overflow low
                                           ;	SEC					; carry high
                                           ;	XCE					; sets 32 bit mode, 32 bit registers
                                           ;	REP		#$30		; 32 bit registers
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$3FFF
                                           ;	TAS
                                           ;
   7065 00C002 18                           	CLC					; switch to '816 mode
   7066 00C003 E2 40                        	SEP		#$40		; set overflow bit
   7067 00C005 FB                           	XCE
   7068 00C006 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           	; Setup all the segment descriptors
                                           	; This must be done before the stack can be accessed, and
                                           	; before subroutine calls and task switching can be made.
                                           
                                           	; First setup segment #0, the segment the core starts running under.
                                           	; It's setup for flat addressing.
   7078 00C008 A9 00 00                     	LDA		#0
   7079 00C00B 42 EB                        	XBAW
   7080 00C00D A9 00 00                     	LDA		#0
   7081 00C010 A2 8D 09                     	LDX		#$98D		; present, writeable, executable, max size.
   7082 00C013 A8                           	TAY
   7083 00C014 42 BA                        	SDU
   7084 00C016 C8                           	INY
                                           
                                           	; Flag remaining segments as not present 
   7087 00C017 A2 00 00                     	LDX		#$000		; not present, non-executable, non-writeable, min size
   7088 00C01A                             .0003:
   7089 00C01A 42 BA                        	SDU					; update segment descriptor
   7090 00C01C C8                           	INY
   7091 00C01D C0 00 10                     	CPY		#4096
   7092 00C020 D0 F8                        	BNE		.0003
                                           
                                           	; setup code segment #1
   7095 00C022 A2 05 09                     	LDX		#$905		; executable, 64k
   7096 00C025 A8                           	TAY
   7097 00C026 C8                           	INY
   7098 00C027 42 BA                        	SDU
                                           	; setup data segment #2
   7100 00C029 A2 8B 08                     	LDX		#$88B		; writeable, 256M
   7101 00C02C C8                           	INY
   7102 00C02D 42 BA                        	SDU
                                           	; setup stack segment #3 (for 65c02 mode)
   7104 00C02F A2 82 08                     	LDX		#$882		; writeable, 1k (based at zero)
   7105 00C032 C8                           	INY
   7106 00C033 42 BA                        	SDU
                                           	; setup stack segment #4 (for 65c816 mode)
   7108 00C035 A2 85 08                     	LDX		#$885		; writeable, 64k (based at zero)
   7109 00C038 C8                           	INY
   7110 00C039 42 BA                        	SDU
                                           	; seg #5 is the maxed out segment
   7112 00C03B A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   7113 00C03E C8                           	INY
   7114 00C03F 42 BA                        	SDU
                                           
                                           	; I/O segment
   7117 00C041 A9 F0 00                     	LDA		#$00F0
   7118 00C044 42 EB                        	XBAW
   7119 00C046 A9 00 00                     	LDA		#$0000
   7120 00C049 A2 87 08                     	LDX		#$887		; writeable, 1M (based at $F00000)
   7121 00C04C A0 FF 0F                     	LDY		#$FFF
   7122 00C04F 42 BA                        	SDU
                                           
                                           	; now set the code segment (test far jump)
   7125 00C051 42 5C 58 C0 00 01 00         	JMF		1:.0004
   7126 00C058                             .0004:
                                           	; set the stack segment
                                           	; (must be before PEA/PLDS)
   7129 00C058 A9 05 00                     	LDA		#5
   7130 00C05B 42 5A                        	TASS
   7131 00C05D A9 FF 6B                     	LDA		#$6BFF		; set top of stack
   7132 00C060 1B                           	TAS
                                           
                                           	; setup the programmable address decodes
   7135 00C061 A9 70 00                     	LDA		#$0070		; program chip selects for I/O
   7136 00C064 8D 00 B0                     	STA		PCS0		; at $007000
   7137 00C067 A9 71 00                     	LDA		#$0071
   7138 00C06A 8D 02 B0                     	STA		PCS1
                                           ;	LDA		#$FEA1		; select $FEA1xx I/O
                                           ;	STA		PCS3
                                           ;	LDA		#$0000		; select zero page ram
                                           ;	STA		PCS5
                                           
                                           	; set the data segment
                                           	; this must be setup after address decoding is setup
   7146 00C06D F4 05 00                     	PEA		5
   7147 00C070 42 2B                        	PLDS
                                           
   7149 00C072 20 63 D9                     	JSR		FMTK_Init
                                           
                                           	; Setup the counters
   7152 00C075 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
                                           	; Counter #0 is setup as a free running tick count
   7156 00C077 A9 FF                        	LDA		#$FF		; set limit to $FFFFFF
   7157 00C079 8D 10 B0                     	STA		CTR0_LMT
   7158 00C07C 8D 11 B0                     	STA		CTR0_LMT+1
   7159 00C07F 8D 12 B0                     	STA		CTR0_LMT+2
   7160 00C082 A9 14                        	LDA		#$14		; count up, on mpu clock
   7161 00C084 8D 13 B0                     	STA		CTR0_CTRL
                                           	; Counter #1 is set to interrupt at a 50Hz rate
   7163 00C087 A9 2A                        	LDA		#$2A	;94		; divide by 95794 (for 50Hz)
   7164 00C089 8D 14 B0                     	STA		CTR1_LMT		; FFFFFE = 2Hz with 33MHz clock
   7165 00C08C A9 2C                        	LDA		#$2C	;57
   7166 00C08E 8D 15 B0                     	STA		CTR1_LMT+1
   7167 00C091 A9 0A                        	LDA		#$0A	;09
   7168 00C093 8D 16 B0                     	STA		CTR1_LMT+2
   7169 00C096 A9 05                        	LDA		#$05		; count down, on mpu clock, irq disenabled
   7170 00C098 8D 17 B0                     	STA		CTR1_CTRL
                                           	; Counter #2 isn't setup
                                           
   7173 00C09B C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   7176 00C09D 20 11 CF                     	JSR		ResetKbd
                                           
   7178 00C0A0 64 D0                        	STZ		TaskSwitchEn
                                           
                                           	; Setup the task registers
   7181 00C0A2 A0 09 00                     	LDY		#9			; # tasks to setup
   7182 00C0A5 A2 01 00                     	LDX		#1
   7183 00C0A8                             .0001:
   7184 00C0A8 42 4C 3D E3 00 00            	LDT		TaskStartTbl,X
   7185 00C0AE E8                           	INX
   7186 00C0AF 88                           	DEY
   7187 00C0B0 D0 F6                        	BNE		.0001
                                           
   7189 00C0B2 42 9C 00 20 05 00            	STZ		running_task	; task #0 is the running task
   7190 00C0B8 64 CE                        	STZ		IOFocusTask		; task #0 has the focus to begin with
                                           
   7192 00C0BA A9 D2 E2                     	LDA		#BrkRout1
   7193 00C0BD 8D 02 01                     	STA		$0102
                                           
   7195 00C0C0 64 04                        	STZ		TickCount
   7196 00C0C2 64 06                        	STZ		TickCount+2
   7197 00C0C4                             Task0:
   7198 00C0C4 A9 01 00                     	LDA		#$01
   7199 00C0C7 8D 00 70                     	STA		$7000
   7200 00C0CA                             .0001:
   7201 00C0CA A9 04 00                     	LDA		#$04
   7202 00C0CD 8D 00 70                     	STA		$7000
   7203 00C0D0 A9 FF 0F                     	LDA		#$FFF
   7204 00C0D3 85 44                        	STA		Vidptr+4
   7205 00C0D5 85 4A                        	STA		Vidregs+4
   7206 00C0D7 A9 0D 00                     	LDA		#VIDBUF>>16
   7207 00C0DA 85 42                        	STA		Vidptr+2
   7208 00C0DC 64 40                        	STZ		Vidptr
   7209 00C0DE A9 0D BF                     	LDA		#$BF0D	; 'm'
   7210 00C0E1 42 DA 42 87 40               	STA		FAR {Vidptr}
   7211 00C0E6 A9 0E 00                     	LDA		#VIDREGS >> 16
   7212 00C0E9 85 48                        	STA		Vidregs+2
   7213 00C0EB A9 00 A0                     	LDA		#VIDREGS
   7214 00C0EE 85 46                        	STA		Vidregs
   7215 00C0F0 A0 07 00                     	LDY		#7	
   7216 00C0F3 A9 21 00                     	LDA		#$21		; divide by 3 vertically, 2 horizontally
   7217 00C0F6 20 7E CD                     	JSR		SetVideoReg	; clear POR state
   7218 00C0F9 A9 54 00                     	LDA		#84		; set window left position 84
   7219 00C0FC A0 02 00                     	LDY		#2
   7220 00C0FF 20 7E CD                     	JSR		SetVideoReg
   7221 00C102 A9 00 00                     	LDA		#0
   7222 00C105 A0 03 00                     	LDY		#3
   7223 00C108 20 7E CD                     	JSR		SetVideoReg
   7224 00C10B A9 10 00                     	LDA		#16			; set window top position
   7225 00C10E A0 04 00                     	LDY		#4
   7226 00C111 20 7E CD                     	JSR		SetVideoReg
   7227 00C114 20 63 CD                     	JSR		GetTextRowsCols
   7228 00C117 A9 22 CB                     	LDA		#DisplayChar
   7229 00C11A 8D F0 03                     	STA		OutputVec
   7230 00C11D AD F0 03                     	LDA		OutputVec
   7231 00C120 C9 22 CB                     	CMP		#DisplayChar
   7232 00C123 D0 A5                        	BNE		.0001
   7233 00C125 A9 02 00                     	LDA		#$02
   7234 00C128 8D 00 70                     	STA		$7000
   7235 00C12B A9 00 BF                     	LDA		#$BF00
   7236 00C12E 85 36                        	STA		NormAttr
   7237 00C130 20 A8 CD                     	JSR		ClearScreen
   7238 00C133 20 E7 CC                     	JSR		HomeCursor
                                           ;	JSR		beep
   7240 00C136 A9 03 00                     	LDA		#$03
   7241 00C139 42 3B 05 00 8D 00 70         	STA		5:$7000
   7242 00C140 F4 05 00                     	PEA		5
   7243 00C143 F4 7E C9                     	PEA		msgStarting
   7244 00C146 20 34 CD                     	JSR		DisplayString
   7245 00C149 20 88 D6                     	JSR		rtc_init
   7246 00C14C 20 90 D6                     	JSR		rtc_read
   7247 00C14F C9 00 00                     	CMP		#0
   7248 00C152 F0 09                        	BEQ		.0006
   7249 00C154 F4 01 00                     	PEA		1
   7250 00C157 F4 58 D7                     	PEA		msgRtcReadFail
   7251 00C15A 20 34 CD                     	JSR		DisplayString
   7252 00C15D                             .0006:
                                           ;	SEP		#$1000		; turn on single step mode
                                           ;	LDA		#0
                                           ;	STA		$FFF:FAC1
                                           ;	STA		$FFF:FAC1+2
                                           ;	STA		$FFF:FAC1+4
                                           ;	STA		$FFF:FAC1+6
                                           ;	STA		$FFF:FAC1+8
                                           ;	STA		$FFF:FAC1+10
                                           ;	LDA		#3
                                           ;	STA		$7000
                                           ;	LDA		#1234
                                           ;	STA		FAC1
                                           ;	LDA		#5			; FIX2FLT
                                           ;	JSR 	FPCommandWait
                                           ;	LDA		#4
                                           ;	STA		$7000
                                           ;	JSR		DivideByTen
                                           ;	LDA		#5
                                           ;	STA		$7000
                                           ;	JSR		FAC1ToString
                                           ;	PEA		2
                                           ;	PEA		$3A0
                                           ;	JSR		DisplayString
                                           ;	LDA		#' '
                                           ;	JSR		OutChar
                                           ;	JSR		DispFAC1
                                           
                                           ;	FORK	#11
                                           ;	TTA
                                           ;	CMP		#11
                                           ;	LBEQ	KeybdInit
                                           
                                           ;	REP		#$130
                                           ;	SEP		#$200		; 32 bit mode
                                           ;	NDX 	32
                                           ;	MEM		32
                                           ;	LDA		#0
                                           ;	JSR		hTcbToAddr
                                           ;	TAX
                                           ;	LDA		#$20
                                           ;	STA.B	TCB_priority,X
                                           ;	LDA		#0
                                           ;	JSR		InsertIntoReadyFifo
                                           ;	REP		#$230		; back to 16 bit mode
                                           ;	SEP		#$100
                                           
                                           	; Create a workhorse OS context that will allow subroutine calls into
                                           	; the OS code from alternate contexts which may not have the same VM
                                           	; settings.
                                           	;
   7303 00C15D 78                           	SEI
   7304 00C15E 42 A0 FD 00                  	FORK	#$FD
   7305 00C162 42 1A                        	TTA
   7306 00C164 29 FF 01                     	AND		#$01FF
   7307 00C167 C9 FD 00                     	CMP		#$FD
   7308 00C16A D0 1D                        	BNE		TaskMon2
   7309 00C16C                             TaskFD:
   7310 00C16C 42 C2 30 02                  	REP		#$230		; in case we loop back to here
   7311 00C170 42 E2 00 01                  	SEP		#$100
   7312 00C174 68                           	PLA					; get 16 bit value from stack
   7313 00C175 A2 FF 22                     	LDX		#$22FF
   7314 00C178 9A                           	TXS
   7315 00C179 48                           	PHA					; store 16 bit value to new stack
   7316 00C17A 42 C2 30 01                  	REP		#$130
   7317 00C17E 42 E2 00 02                  	SEP		#$200		; switch to 32 bit mode
   7318 00C182 42 78 01                     	SEI		#1			; interrupts masked while in context
                                           	; After the first return, the context should never use this
                                           	; return point again. As routines in the context are called
                                           	; with JCR.
   7322 00C185 42 60                        	RTT
   7323 00C187 80 1A                        	BRA		TaskMon1
                                           	NDX		16
                                           	MEM		16
                                           
   7327 00C189                             TaskMon2:
                                           	NDX		16
                                           	MEM		16
                                           	; Create a workhorse BIOS context that will allow subroutine calls into
                                           	; the BIOS code from alternate contexts which may not have the same VM
                                           	; settings.
                                           	;
   7334 00C189 42 78 01                     	SEI		#1
   7335 00C18C 42 A0 FC 00                  	FORK	#$FC
   7336 00C190 42 1A                        	TTA
   7337 00C192 29 FF 01                     	AND		#$01FF
   7338 00C195 C9 FC 00                     	CMP		#$FC
   7339 00C198 D0 09                        	BNE		TaskMon1
   7340 00C19A                             TaskFC:
   7341 00C19A 68                           	PLA
   7342 00C19B A2 FF 23                     	LDX		#$23FF
   7343 00C19E 9A                           	TXS
   7344 00C19F 48                           	PHA
   7345 00C1A0 58                           	CLI
   7346 00C1A1 42 60                        	RTT
                                           
   7348 00C1A3                             TaskMon1:
                                           	; Start the single stepping task.
                                           ;	TSK		#9
   7351 00C1A3 58                           	CLI
                                           
   7353 00C1A4                             Mon1:
   7354 00C1A4                             .mon1:
   7355 00C1A4 58                           	CLI
   7356 00C1A5 A9 FF 6B                     	LDA		#$6BFF
   7357 00C1A8 1B                           	TAS
   7358 00C1A9 20 88 CD                     	JSR		CursorOn
   7359 00C1AC 20 0B CD                     	JSR		OutCRLF
   7360 00C1AF A9 24 00                     	LDA		#'$'
   7361 00C1B2 85 D0                        	STA		TaskSwitchEn
   7362 00C1B4                             .mon3:
   7363 00C1B4 58                           	CLI
   7364 00C1B5 48                           	PHA
   7365 00C1B6 A9 00 00                     	LDA		#0
   7366 00C1B9 42 20 E1 DF FD               	JCR		RequestIOFocus,OSctx
   7367 00C1BE 68                           	PLA
   7368 00C1BF 20 14 CD                     	JSR		OutChar
   7369 00C1C2 20 A9 D0                     	JSR		KeybdGetCharWait
   7370 00C1C5 29 FF 00                     	AND		#$FF
                                           ;	CMP		#'.'
                                           ;	BEQ		.mon3
   7373 00C1C8 C9 0D 00                     	CMP		#CR
   7374 00C1CB D0 E7                        	BNE		.mon3
   7375 00C1CD A5 32                        	LDA		CursorY
   7376 00C1CF 0A                           	ASL
   7377 00C1D0 AA                           	TAX
   7378 00C1D1 42 1B BD FF E2               	LDA		CS:LineTbl,X
   7379 00C1D6 0A                           	ASL
   7380 00C1D7 AA                           	TAX
   7381 00C1D8                             .mon4:
   7382 00C1D8 20 16 C9                     	JSR		IgnoreBlanks
   7383 00C1DB 20 D0 C2                     	JSR		MonGetch
   7384 00C1DE C9 24 00                     	CMP		#'$'
   7385 00C1E1 F0 F5                        	BEQ		.mon4
   7386 00C1E3 C9 53 00                     	CMP		#'S'
   7387 00C1E6 D0 4E                        	BNE		.mon2
   7388 00C1E8 20 D0 C2                     	JSR		MonGetch
   7389 00C1EB C9 45 00                     	CMP		#'E'
   7390 00C1EE D0 11                        	BNE		.mon10
   7391 00C1F0 20 D0 C2                     	JSR		MonGetch
   7392 00C1F3 C9 43 00                     	CMP		#'C'
   7393 00C1F6 F0 FF 71 02                  	LBEQ	GetSecnum
   7394 00C1FA C9 49 00                     	CMP		#'I'
   7395 00C1FD F0 FF F9 00                  	LBEQ	do_SEI
   7396 00C201                             .mon10:
   7397 00C201 C9 55 00                     	CMP		#'U'
   7398 00C204 D0 FF F8 FF                  	LBNE	doSavefile
   7399 00C208 A9 08 00                     	LDA		#8
   7400 00C20B 42 20 E1 DF FD               	JCR		RequestIOFocus,OSctx
   7401 00C210 42 C2 30 01                  	REP		#$130
   7402 00C214 42 E2 00 02                  	SEP		#$200
                                           	MEM		32
                                           	NDX		32
   7405 00C218 A9 08 00 00 00               	LDA		#8
   7406 00C21D 20 A4 DA                     	JSR		hTcbToAddr
   7407 00C220 AA                           	TAX
   7408 00C221 A9 20 00 00 00               	LDA		#$20
   7409 00C226 95 24                        	STA		TCB_priority,X
   7410 00C228 20 32 E1                     	JSR		InsertIntoReadyFifo
   7411 00C22B 42 C2 00 02                  	REP		#$200
   7412 00C22F 42 E2 00 01                  	SEP		#$100
                                           	MEM		16
                                           	NDX		16
                                           	;TSK		JMP:#8
   7416 00C233 82 6E FF                     	BRL		.mon1
                                           	;JMP		$8000		; invoke Supermon832
   7418 00C236                             .mon2:
   7419 00C236 C9 43 00                     	CMP		#'C'
   7420 00C239 D0 09                        	BNE		.mon5
   7421 00C23B 20 A8 CD                     	JSR		ClearScreen
   7422 00C23E 20 E7 CC                     	JSR		HomeCursor
   7423 00C241 82 60 FF                     	BRL		.mon1
   7424 00C244                             .mon5:
   7425 00C244 C9 4D 00                     	CMP		#'M'
   7426 00C247 D0 06                        	BNE		.mon6
   7427 00C249 20 59 C7                     	JSR		doMemoryDump
   7428 00C24C 82 55 FF                     	BRL		Mon1
   7429 00C24F                             .mon6:
   7430 00C24F C9 44 00                     	CMP		#'D'
   7431 00C252 F0 FF 97 00                  	LBEQ	doD
   7432 00C256 C9 3E 00                     	CMP		#'>'
   7433 00C259 F0 FF 6E 05                  	LBEQ	doMemoryEdit
   7434 00C25D C9 46 00                     	CMP		#'F'
   7435 00C260 F0 FF A2 05                  	LBEQ	doFill
   7436 00C264 C9 4A 00                     	CMP		#'J'
   7437 00C267 F0 FF 41 06                  	LBEQ	doJump
   7438 00C26B C9 54 00                     	CMP		#'T'
   7439 00C26E F0 FF 22 01                  	LBEQ	doTask
   7440 00C272 C9 49 00                     	CMP		#'I'
   7441 00C275 F0 FF 6B 02                  	LBEQ	doInvaders
   7442 00C279 C9 52 00                     	CMP		#'R'
   7443 00C27C D0 0F                        	BNE		.mon7
   7444 00C27E 20 D0 C2                     	JSR		MonGetch
   7445 00C281 C9 44 00                     	CMP		#'D'
   7446 00C284 F0 FF F8 01                  	LBEQ	doRead
   7447 00C288 CA                           	DEX
   7448 00C289 CA                           	DEX
   7449 00C28A 82 64 02                     	BRL		doRegs
   7450 00C28D                             .mon7:
   7451 00C28D C9 42 00                     	CMP		#'B'
   7452 00C290 F0 FF 25 01                  	LBEQ	doBasic
   7453 00C294 C9 57 00                     	CMP		#'W'
   7454 00C297 F0 FF DE 01                  	LBEQ	doWrite
   7455 00C29B C9 66 00                     	CMP		#'f'
   7456 00C29E D0 FF 02 FF                  	LBNE	Mon1
   7457 00C2A2 20 D0 C2                     	JSR		MonGetch
   7458 00C2A5 C9 6D 00                     	CMP		#'m'
   7459 00C2A8 D0 FF F8 FE                  	LBNE	Mon1
   7460 00C2AC 20 D0 C2                     	JSR		MonGetch
   7461 00C2AF C9 74 00                     	CMP		#'t'
   7462 00C2B2 D0 FF EE FE                  	LBNE	Mon1
   7463 00C2B6 20 90 D7                     	JSR		SDC_Format
   7464 00C2B9 82 E8 FE                     	BRL		Mon1
   7465 00C2BC                             .mon8:
   7466 00C2BC C9 4C 00                     	CMP		#'L'
   7467 00C2BF D0 03                        	BNE		.mon9
   7468 00C2C1 82 8B 01                     	BRL		doLoadfile
   7469 00C2C4                             .mon9:
   7470 00C2C4 82 DD FE                     	BRL		Mon1
                                           ; Get a character from the screen, skipping over spaces and tabs
                                           ;
   7473 00C2C7                             MonGetNonSpace:
   7474 00C2C7                             .0001:
   7475 00C2C7 20 D0 C2                     	JSR		MonGetch
   7476 00C2CA C9 20 00                     	CMP		#' '
   7477 00C2CD F0 F8                        	BEQ		.0001
   7478 00C2CF 60                           	RTS
                                           
                                           ; Get a character from the screen.
                                           ;
   7482 00C2D0                             MonGetch:
   7483 00C2D0 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7484 00C2D8 E8                           	INX
   7485 00C2D9 E8                           	INX
   7486 00C2DA 29 FF 00                     	AND		#$FF
   7487 00C2DD 20 16 CB                     	JSR		ScreenToAscii
   7488 00C2E0 60                           	RTS
                                           
   7490 00C2E1                             MonErr:
   7491 00C2E1 F4 01 00                     	PEA		1
   7492 00C2E4 F4 18 E5                     	PEA		msgErr
   7493 00C2E7 20 34 CD                     	JSR		DisplayString
   7494 00C2EA 82 B7 FE                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7498 00C2ED                             doD:
   7499 00C2ED 20 D0 C2                     	JSR		MonGetch
   7500 00C2F0 C9 54 00                     	CMP		#'T'
   7501 00C2F3 F0 35                        	BEQ		doDate
   7502 00C2F5 CA                           	DEX
   7503 00C2F6 CA                           	DEX
   7504 00C2F7 82 62 05                     	BRL		doDisassemble
                                           
                                           ;------------------------------------------------------------------------------
                                           ; SEI <level>
                                           ; Sets the interrupt mask level.
                                           ;------------------------------------------------------------------------------
                                           
   7511 00C2FA                             do_SEI:
   7512 00C2FA 20 6E CE                     	JSR		GetHexNumber
   7513 00C2FD A5 0C                        	LDA		NumWorkArea
   7514 00C2FF D0 06                        	BNE		.0001
   7515 00C301 42 78 00                     	SEI		#0
   7516 00C304 82 9D FE                     	BRL		Mon1
   7517 00C307                             .0001:
   7518 00C307 C9 01 00                     	CMP		#1
   7519 00C30A D0 06                        	BNE		.0002
   7520 00C30C 42 78 01                     	SEI		#1
   7521 00C30F 82 92 FE                     	BRL		Mon1
   7522 00C312                             .0002:
   7523 00C312 C9 02 00                     	CMP		#2
   7524 00C315 D0 06                        	BNE		.0003
   7525 00C317 42 78 02                     	SEI		#2
   7526 00C31A 82 87 FE                     	BRL		Mon1
   7527 00C31D                             .0003:
   7528 00C31D C9 03 00                     	CMP		#3
   7529 00C320 D0 FF 80 FE                  	LBNE	Mon1
   7530 00C324 42 78 03                     	SEI		#3
   7531 00C327 82 7A FE                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; DT? - displays the date from the RTC
                                           ; DT <year> <month> <day> - updates the RTC with the year, month and day.
                                           ;------------------------------------------------------------------------------
                                           
   7538 00C32A                             doDate:
   7539 00C32A 20 D0 C2                     	JSR		MonGetch
   7540 00C32D C9 3F 00                     	CMP		#'?'
   7541 00C330 F0 35                        	BEQ		DispDate
   7542 00C332 CA                           	DEX
   7543 00C333 CA                           	DEX
   7544 00C334 20 6E CE                     	JSR		GetHexNumber
   7545 00C337 C0 00 00                     	CPY		#0
   7546 00C33A F0 28                        	BEQ		.0001
   7547 00C33C A5 0C                        	LDA		NumWorkArea
   7548 00C33E 42 8B 8D 06 03               	STA.B	RTCBuf+6
   7549 00C343 20 6E CE                     	JSR		GetHexNumber
   7550 00C346 C0 00 00                     	CPY		#0
   7551 00C349 F0 19                        	BEQ		.0001
   7552 00C34B A5 0C                        	LDA		NumWorkArea
   7553 00C34D 42 8B 8D 05 03               	STA.B	RTCBuf+5
   7554 00C352 20 6E CE                     	JSR		GetHexNumber
   7555 00C355 C0 00 00                     	CPY		#0
   7556 00C358 F0 0A                        	BEQ		.0001
   7557 00C35A A5 0C                        	LDA		NumWorkArea
   7558 00C35C 42 8B 8D 04 03               	STA.B	RTCBuf+4
   7559 00C361 20 12 D7                     	JSR		rtc_write
   7560 00C364                             .0001:
   7561 00C364 82 3D FE                     	BRL		Mon1
                                           
   7563 00C367                             DispDate:
   7564 00C367 20 90 D6                     	JSR		rtc_read
   7565 00C36A 42 8B AD 06 03               	LDA.B	RTCBuf+6
   7566 00C36F 20 18 CE                     	JSR		DispByte
   7567 00C372 A9 2F 00                     	LDA		#'/'
   7568 00C375 20 14 CD                     	JSR		OutChar
   7569 00C378 42 8B AD 05 03               	LDA.B	RTCBuf+5
   7570 00C37D 20 18 CE                     	JSR		DispByte
   7571 00C380 A9 2F 00                     	LDA		#'/'
   7572 00C383 20 14 CD                     	JSR		OutChar
   7573 00C386 42 8B AD 04 03               	LDA.B	RTCBuf+4
   7574 00C38B 20 18 CE                     	JSR		DispByte
   7575 00C38E 20 0B CD                     	JSR		OutCRLF
   7576 00C391 82 10 FE                     	BRL		Mon1
                                           		
                                           ;------------------------------------------------------------------------------
   7579 00C394                             doTask:
   7580 00C394 20 D0 C2                     	JSR		MonGetch
   7581 00C397 C9 53 00                     	CMP		#'S'
   7582 00C39A D0 14                        	BNE		.0001
   7583 00C39C 20 6E CE                     	JSR		GetHexNumber
   7584 00C39F A5 0C                        	LDA		NumWorkArea
   7585 00C3A1 0A                           	ASL
   7586 00C3A2 AA                           	TAX		
   7587 00C3A3 A9 20 00                     	LDA		#$20
   7588 00C3A6 95 24                        	STA		TCB_priority,X
   7589 00C3A8 A5 0C                        	LDA		NumWorkArea
   7590 00C3AA 20 32 E1                     	JSR		InsertIntoReadyFifo
                                           ;	TSK
   7592 00C3AD 82 F4 FD                     	BRL		Mon1
   7593 00C3B0                             .0001:
   7594 00C3B0 CA                           	DEX
   7595 00C3B1 CA                           	DEX
   7596 00C3B2 20 6E CE                     	JSR		GetHexNumber
   7597 00C3B5 A5 0C                        	LDA		NumWorkArea
   7598 00C3B7 42 3A                        	TSK
                                           	BRK		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Start the BASIC interpreter.
                                           ;------------------------------------------------------------------------------
                                           
   7605 00C3B9                             doBasic:
                                           	; Setup the BASIC descriptor
   7607 00C3B9 A9 01 00                     	LDA		#$0001
   7608 00C3BC 42 EB                        	XBAW
   7609 00C3BE A9 00 00                     	LDA		#$0000
   7610 00C3C1 A2 85 09                     	LDX		#$985		; executable, writeable, 64k (based at $10000)
   7611 00C3C4 A0 FD 0F                     	LDY		#$FFD
   7612 00C3C7 42 BA                        	SDU
   7613 00C3C9 A9 07 00                     	LDA		#7
   7614 00C3CC 42 20 E1 DF FD               	JCR		RequestIOFocus,OSctx
   7615 00C3D1 42 20 C4 DF FD               	JCR		SetIOFocus,OSctx
                                           	; Switch to 32 bit mode in order to set the task priority and insert the
                                           	; BASIC task into the ready queue.
   7618 00C3D6 42 C2 30 01                  	REP		#$130
   7619 00C3DA 42 E2 00 02                  	SEP		#$200
                                           	MEM		32
                                           	NDX		32
   7622 00C3DE A9 07 00 00 00               	LDA		#7
   7623 00C3E3 20 A4 DA                     	JSR		hTcbToAddr
   7624 00C3E6 AA                           	TAX
   7625 00C3E7 A9 20 00 00 00               	LDA		#$20
   7626 00C3EC 95 24                        	STA		TCB_priority,X
   7627 00C3EE 20 32 E1                     	JSR		InsertIntoReadyFifo
   7628 00C3F1 42 C2 30 02                  	REP		#$230
   7629 00C3F5 42 E2 00 01                  	SEP		#$100
                                           	NDX		16
                                           	MEM		16
                                           ;	TSK		#7
   7633 00C3F9 82 A8 FD                     	BRL		Mon1
                                           
   7635 00C3FC                             ClearFilenameBuf:
   7636 00C3FC A0 00 00                     	LDY		#0
   7637 00C3FF A9 20 00                     	LDA		#' '
   7638 00C402                             .0002:
   7639 00C402 42 8B 99 80 03               	STA.B	FilenameBuf,Y
   7640 00C407 C8                           	INY
   7641 00C408 C0 0F 00                     	CPY		#15
   7642 00C40B D0 F5                        	BNE		.0002
   7643 00C40D A9 00 00                     	LDA		#0
   7644 00C410 42 8B 99 80 03               	STA.B	FilenameBuf,Y
   7645 00C415 60                           	RTS
                                           
   7647 00C416                             MonGetFilename:
   7648 00C416 20 FC C3                     	JSR		ClearFilenameBuf
   7649 00C419                             .0004:
   7650 00C419 20 D0 C2                     	JSR		MonGetch
   7651 00C41C C9 20 00                     	CMP		#' '
   7652 00C41F F0 F8                        	BEQ		.0004
   7653 00C421 C9 22 00                     	CMP		#'"'
   7654 00C424 D0 26                        	BNE		.badFname
   7655 00C426                             .nextChar:
   7656 00C426 20 D0 C2                     	JSR		MonGetch
   7657 00C429 C9 22 00                     	CMP		#'"'
   7658 00C42C F0 1D                        	BEQ		.0001
   7659 00C42E C9 2E 00                     	CMP		#'.'
   7660 00C431 D0 05                        	BNE		.0003
   7661 00C433 A0 0D 00                     	LDY		#13
   7662 00C436 80 EE                        	BRA		.nextChar
   7663 00C438                             .0003:
   7664 00C438 42 8B 99 80 03               	STA.B	FilenameBuf,Y
   7665 00C43D C8                           	INY
   7666 00C43E C0 0F 00                     	CPY		#15
   7667 00C441 D0 E3                        	BNE		.nextChar
   7668 00C443 20 D0 C2                     	JSR		MonGetch
   7669 00C446 C9 22 00                     	CMP		#'"'
   7670 00C449 D0 01                        	BNE		.badFname
   7671 00C44B                             .0001:
   7672 00C44B 60                           	RTS
   7673 00C44C                             .badFname:
   7674 00C44C 82 55 FD                     	BRL		Mon1
                                           
   7676 00C44F                             doLoadfile:
   7677 00C44F 20 16 C4                     	JSR		MonGetFilename
   7678 00C452 20 6E CE                     	JSR		GetHexNumber
   7679 00C455 C0 00 00                     	CPY		#0
   7680 00C458 F0 10                        	BEQ		.noBuf
   7681 00C45A A5 0E                        	LDA		NumWorkArea+2
   7682 00C45C 48                           	PHA
   7683 00C45D A5 0C                        	LDA		NumWorkArea
   7684 00C45F 48                           	PHA
   7685 00C460 F4 00 00                     	PEA		0
   7686 00C463 A9 80 03                     	LDA		#FilenameBuf
   7687 00C466 48                           	PHA
   7688 00C467 20 65 D8                     	JSR		SDC_Loadfile
   7689 00C46A                             .noBuf:
   7690 00C46A 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get starting sector number for SD Card read/write routines
                                           ;------------------------------------------------------------------------------
                                           
   7696 00C46B                             GetSecnum:
   7697 00C46B 20 6E CE                     	JSR		GetHexNumber
   7698 00C46E A5 0C                        	LDA		NumWorkArea
   7699 00C470 85 C4                        	STA		secnum
   7700 00C472 A5 0E                        	LDA		NumWorkArea+2
   7701 00C474 85 C6                        	STA		secnum+2
   7702 00C476 82 2B FD                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Read or write a block of memory to SD Card.
                                           ;------------------------------------------------------------------------------
                                           
   7708 00C479                             doWrite:
   7709 00C479 A9 FF FF                     	LDA		#$FFFF
   7710 00C47C 85 BA                        	STA		rw_flag
   7711 00C47E 80 02                        	BRA		doReadWrite
   7712 00C480                             doRead:
   7713 00C480 64 BA                        	STZ		rw_flag
   7714 00C482                             doReadWrite:
   7715 00C482 20 43 CE                     	JSR		GetRange
   7716 00C485 20 10 D5                     	JSR		spi_master_init
   7717 00C488 C9 00 00                     	CMP		#0
   7718 00C48B F0 03                        	BEQ		.0004
   7719 00C48D 82 14 FD                     	BRL		Mon1
   7720 00C490                             .0004:
   7721 00C490 20 0B CD                     	JSR		OutCRLF
   7722 00C493                             .0002:
   7723 00C493 20 D4 C4                     	JSR		DispSecnum
   7724 00C496 A5 22                        	LDA		RangeStart+2
   7725 00C498 48                           	PHA
   7726 00C499 A5 20                        	LDA		RangeStart
   7727 00C49B 48                           	PHA
   7728 00C49C A5 C6                        	LDA		secnum+2
   7729 00C49E 48                           	PHA
   7730 00C49F A5 C4                        	LDA		secnum
   7731 00C4A1 48                           	PHA
   7732 00C4A2 24 BA                        	BIT		rw_flag
   7733 00C4A4 50 05                        	BVC		.0005
   7734 00C4A6 20 BC D5                     	JSR		spi_master_write
   7735 00C4A9 80 03                        	BRA		.0006
   7736 00C4AB                             .0005:
   7737 00C4AB 20 44 D5                     	JSR		spi_master_read
   7738 00C4AE                             .0006:
   7739 00C4AE E6 C4                        	INC		secnum
   7740 00C4B0 D0 02                        	BNE		.0001
   7741 00C4B2 E6 C6                        	INC		secnum+2
   7742 00C4B4                             .0001:
   7743 00C4B4 18                           	CLC
   7744 00C4B5 A5 20                        	LDA		RangeStart
   7745 00C4B7 69 00 02                     	ADC		#512
   7746 00C4BA 85 20                        	STA		RangeStart
   7747 00C4BC A5 22                        	LDA		RangeStart+2
   7748 00C4BE 69 00 00                     	ADC		#0
   7749 00C4C1 85 22                        	STA		RangeStart+2
   7750 00C4C3 38                           	SEC
   7751 00C4C4 A5 20                        	LDA		RangeStart
   7752 00C4C6 E5 24                        	SBC		RangeEnd
   7753 00C4C8 A5 22                        	LDA		RangeStart+2
   7754 00C4CA E5 26                        	SBC		RangeEnd+2
   7755 00C4CC 30 C5                        	BLT		.0002
   7756 00C4CE 20 0B CD                     	JSR		OutCRLF
   7757 00C4D1 82 D0 FC                     	BRL		Mon1
                                           
   7759 00C4D4                             DispSecnum:
   7760 00C4D4 A5 C6                        	LDA		secnum+2
   7761 00C4D6 20 13 CE                     	JSR		DispWord
   7762 00C4D9 A5 C4                        	LDA		secnum
   7763 00C4DB 20 13 CE                     	JSR		DispWord
   7764 00C4DE A9 0D 00                     	LDA		#$0D
   7765 00C4E1 4C 14 CD                     	JMP		OutChar
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7769 00C4E4                             doInvaders:
   7770 00C4E4 A9 FF FF                     	LDA		#$FFFF
   7771 00C4E7 8D 68 78                     	STA		do_invaders
   7772 00C4EA 42 A2 05 00                  	TSK		#5
                                           ;	FORK	#5
                                           ;	TTA
                                           ;	CMP		#5
                                           ;	LBEQ	InvadersTask
   7777 00C4EE 82 B3 FC                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display Registers
                                           ; R<xx>		xx = context register to display
                                           ; Update Registers
                                           ; R.<reg> <val>
                                           ;	reg = CS PB PC A X Y SP SR DS DB DP or MP
                                           ;------------------------------------------------------------------------------
                                           
   7787 00C4F1                             doRegs:
   7788 00C4F1 20 D0 C2                     	JSR		MonGetch
   7789 00C4F4 C9 2E 00                     	CMP		#'.'
   7790 00C4F7 D0 FF 2F 01                  	LBNE	.0004
   7791 00C4FB 20 D0 C2                     	JSR		MonGetch
   7792 00C4FE C9 43 00                     	CMP		#'C'
   7793 00C501 D0 26                        	BNE		.0005
   7794 00C503 20 D0 C2                     	JSR		MonGetch
   7795 00C506 C9 53 00                     	CMP		#'S'
   7796 00C509 D0 FF 97 FC                  	LBNE	Mon1
   7797 00C50D 20 16 C9                     	JSR		IgnoreBlanks
   7798 00C510 20 6E CE                     	JSR		GetHexNumber
   7799 00C513 A5 0C                        	LDA		NumWorkArea
   7800 00C515 85 80                        	STA		reg_cs
   7801 00C517 A5 0E                        	LDA		NumWorkArea+2
   7802 00C519 85 82                        	STA		reg_cs+2
   7803 00C51B                             .buildrec
   7804 00C51B 20 EC C6                     	JSR		BuildRec
   7805 00C51E A6 BE                        	LDX		WorkTR
   7806 00C520 42 6C 00 01 00 00            	LDT		ldtrec
   7807 00C526 82 7B FC                     	BRL		Mon1
   7808 00C529                             .0005:
   7809 00C529 C9 50 00                     	CMP		#'P'
   7810 00C52C D0 27                        	BNE		.0006
   7811 00C52E 20 D0 C2                     	JSR		MonGetch
   7812 00C531 C9 42 00                     	CMP		#'B'
   7813 00C534 D0 0C                        	BNE		.0007
   7814 00C536 20 16 C9                     	JSR		IgnoreBlanks
   7815 00C539 20 6E CE                     	JSR		GetHexNumber
   7816 00C53C A5 0E                        	LDA		NumWorkArea+2
   7817 00C53E 85 8E                        	STA		reg_pc+2
   7818 00C540 80 D9                        	BRA		.buildrec
   7819 00C542                             .0007:
   7820 00C542 C9 43 00                     	CMP		#'C'
   7821 00C545 D0 FF 5B FC                  	LBNE	Mon1
   7822 00C549 20 16 C9                     	JSR		IgnoreBlanks
   7823 00C54C 20 6E CE                     	JSR		GetHexNumber
   7824 00C54F A5 0C                        	LDA		NumWorkArea
   7825 00C551 85 8C                        	STA		reg_pc
   7826 00C553 80 C6                        	BRA		.buildrec
   7827 00C555                             .0006:
   7828 00C555 C9 41 00                     	CMP		#'A'
   7829 00C558 D0 10                        	BNE		.0008
   7830 00C55A 20 16 C9                     	JSR		IgnoreBlanks
   7831 00C55D 20 6E CE                     	JSR		GetHexNumber
   7832 00C560 A5 0C                        	LDA		NumWorkArea
   7833 00C562 85 90                        	STA		reg_a
   7834 00C564 A5 0E                        	LDA		NumWorkArea+2
   7835 00C566 85 92                        	STA		reg_a+2
   7836 00C568 80 B1                        	BRA		.buildrec
   7837 00C56A                             .0008:
   7838 00C56A C9 58 00                     	CMP		#'X'
   7839 00C56D D0 11                        	BNE		.0009
   7840 00C56F 20 16 C9                     	JSR		IgnoreBlanks
   7841 00C572 20 6E CE                     	JSR		GetHexNumber
   7842 00C575 A5 0C                        	LDA		NumWorkArea
   7843 00C577 85 94                        	STA		reg_x
   7844 00C579 A5 0E                        	LDA		NumWorkArea+2
   7845 00C57B 85 96                        	STA		reg_x+2
   7846 00C57D 82 9B FF                     	BRL		.buildrec
   7847 00C580                             .0009:
   7848 00C580 C9 59 00                     	CMP		#'Y'
   7849 00C583 D0 11                        	BNE		.0010
   7850 00C585 20 16 C9                     	JSR		IgnoreBlanks
   7851 00C588 20 6E CE                     	JSR		GetHexNumber
   7852 00C58B A5 0C                        	LDA		NumWorkArea
   7853 00C58D 85 98                        	STA		reg_y
   7854 00C58F A5 0E                        	LDA		NumWorkArea+2
   7855 00C591 85 9A                        	STA		reg_y+2
   7856 00C593 82 85 FF                     	BRL		.buildrec
   7857 00C596                             .0010:
   7858 00C596 C9 53 00                     	CMP		#'S'
   7859 00C599 D0 2D                        	BNE		.0011
   7860 00C59B 20 D0 C2                     	JSR		MonGetch
   7861 00C59E C9 50 00                     	CMP		#'P'
   7862 00C5A1 D0 11                        	BNE		.0015
   7863 00C5A3 20 16 C9                     	JSR		IgnoreBlanks
   7864 00C5A6 20 6E CE                     	JSR		GetHexNumber
   7865 00C5A9 A5 0C                        	LDA		NumWorkArea
   7866 00C5AB 85 9C                        	STA		reg_sp
   7867 00C5AD A5 0E                        	LDA		NumWorkArea+2
   7868 00C5AF 85 9E                        	STA		reg_sp+2
   7869 00C5B1 82 67 FF                     	BRL		.buildrec
   7870 00C5B4                             .0015:
   7871 00C5B4 C9 52 00                     	CMP		#'R'
   7872 00C5B7 D0 FF E9 FB                  	LBNE	Mon1
   7873 00C5BB 20 16 C9                     	JSR		IgnoreBlanks
   7874 00C5BE 20 6E CE                     	JSR		GetHexNumber
   7875 00C5C1 A5 0C                        	LDA		NumWorkArea
   7876 00C5C3 85 A0                        	STA		reg_sr
   7877 00C5C5 82 53 FF                     	BRL		.buildrec
   7878 00C5C8                             .0011:
   7879 00C5C8 C9 44 00                     	CMP		#'D'
   7880 00C5CB D0 3F                        	BNE		.0014
   7881 00C5CD 20 D0 C2                     	JSR		MonGetch
   7882 00C5D0 C9 53 00                     	CMP		#'S'
   7883 00C5D3 D0 11                        	BNE		.0012
   7884 00C5D5 20 16 C9                     	JSR		IgnoreBlanks
   7885 00C5D8 20 6E CE                     	JSR		GetHexNumber
   7886 00C5DB A5 0C                        	LDA		NumWorkArea
   7887 00C5DD 85 84                        	STA		reg_ds
   7888 00C5DF A5 0E                        	LDA		NumWorkArea+2
   7889 00C5E1 85 86                        	STA		reg_ds+2
   7890 00C5E3 82 35 FF                     	BRL		.buildrec
   7891 00C5E6                             .0012:
   7892 00C5E6 C9 42 00                     	CMP		#'B'
   7893 00C5E9 D0 0D                        	BNE		.0013
   7894 00C5EB 20 16 C9                     	JSR		IgnoreBlanks
   7895 00C5EE 20 6E CE                     	JSR		GetHexNumber
   7896 00C5F1 A5 0C                        	LDA		NumWorkArea
   7897 00C5F3 85 A4                        	STA		reg_db
   7898 00C5F5 82 23 FF                     	BRL		.buildrec
   7899 00C5F8                             .0013:
   7900 00C5F8 C9 50 00                     	CMP		#'P'
   7901 00C5FB D0 FF A5 FB                  	LBNE	Mon1
   7902 00C5FF 20 16 C9                     	JSR		IgnoreBlanks
   7903 00C602 20 6E CE                     	JSR		GetHexNumber
   7904 00C605 A5 0C                        	LDA		NumWorkArea
   7905 00C607 85 A8                        	STA		reg_dp
   7906 00C609 82 0F FF                     	BRL		.buildrec
   7907 00C60C                             .0014:
   7908 00C60C C9 4D 00                     	CMP		#'M'
   7909 00C60F D0 FF 91 FB                  	LBNE	Mon1
   7910 00C613 20 D0 C2                     	JSR		MonGetch
   7911 00C616 C9 50 00                     	CMP		#'P'
   7912 00C619 D0 FF 87 FB                  	LBNE	Mon1
   7913 00C61D 20 16 C9                     	JSR		IgnoreBlanks
   7914 00C620 20 6E CE                     	JSR		GetHexNumber
   7915 00C623 A5 0C                        	LDA		NumWorkArea
   7916 00C625 85 B0                        	STA		reg_mp
   7917 00C627 82 F1 FE                     	BRL		.buildrec
                                           
   7919 00C62A                             .0004:
   7920 00C62A CA                           	DEX
   7921 00C62B CA                           	DEX
                                           ;	JSR		IgnoreBlanks
   7923 00C62C 20 6E CE                     	JSR		GetHexNumber
   7924 00C62F C0 00 00                     	CPY		#0
   7925 00C632 F0 FF 6E FB                  	LBEQ	Mon1
   7926 00C636 A5 0C                        	LDA		NumWorkArea
   7927 00C638 85 BE                        	STA		WorkTR
   7928 00C63A 42 28 03 00                  	BSR		DispRegs
   7929 00C63E 82 63 FB                     	BRL		Mon1
                                           
   7931 00C641                             DispRegs:
   7932 00C641 F4 01 00                     	PEA		1
   7933 00C644 F4 9D E4                     	PEA		msgRegs
   7934 00C647 20 34 CD                     	JSR		DisplayString
   7935 00C64A 20 3A CE                     	JSR		space
                                           
   7937 00C64D A5 BE                        	LDA		WorkTR
   7938 00C64F 0A                           	ASL
   7939 00C650 0A                           	ASL
   7940 00C651 0A                           	ASL
   7941 00C652 0A                           	ASL
   7942 00C653 AA                           	TAX
                                           
   7944 00C654 A0 00 00                     	LDY		#0
   7945 00C657                             .0001:
   7946 00C657 42 4A                        	INF
   7947 00C659 E8                           	INX
   7948 00C65A 99 80 00                     	STA		reg_cs,Y
   7949 00C65D 42 EB                        	XBAW
   7950 00C65F 99 82 00                     	STA		reg_cs+2,Y
   7951 00C662 42 C8                        	INY4
   7952 00C664 C0 30 00                     	CPY		#48
   7953 00C667 D0 EE                        	BNE		.0001
                                           
                                           	; Display CS
   7956 00C669 A5 80                        	LDA		reg_cs
   7957 00C66B 20 13 CE                     	JSR		DispWord
   7958 00C66E A9 3A 00                     	LDA		#':'
   7959 00C671 20 14 CD                     	JSR		OutChar
                                           
                                           	; Display PB PC
   7962 00C674 A5 8E                        	LDA		reg_pc+2
   7963 00C676 20 18 CE                     	JSR		DispByte
   7964 00C679 A5 8C                        	LDA		reg_pc
   7965 00C67B 20 13 CE                     	JSR		DispWord
   7966 00C67E 20 3A CE                     	JSR		space
                                           
                                           	; Display SRX,SR
   7969 00C681 A5 A0                        	LDA		reg_cs+32
   7970 00C683 A2 10 00                     	LDX		#16
   7971 00C686                             .0003:
   7972 00C686 0A                           	ASL
   7973 00C687 48                           	PHA
   7974 00C688 A9 30 00                     	LDA		#'0'
   7975 00C68B 69 00 00                     	ADC		#0
   7976 00C68E 20 21 CE                     	JSR		DispNybble
   7977 00C691 68                           	PLA
   7978 00C692 CA                           	DEX
   7979 00C693 D0 F1                        	BNE		.0003
   7980 00C695 20 3A CE                     	JSR		space
                                           
   7982 00C698 A2 10 00                     	LDX		#16
   7983 00C69B                             .0002
                                           	; display Acc,.X,.Y,.SP
   7985 00C69B B5 82                        	LDA		reg_cs+2,X
   7986 00C69D 20 13 CE                     	JSR		DispWord
   7987 00C6A0 B5 80                        	LDA		reg_cs,X
   7988 00C6A2 20 13 CE                     	JSR		DispWord
   7989 00C6A5 20 3A CE                     	JSR		space
   7990 00C6A8 42 E8                        	INX4
   7991 00C6AA E0 20 00                     	CPX		#32
   7992 00C6AD D0 EC                        	BNE		.0002
                                           
   7994 00C6AF F4 01 00                     	PEA		1
   7995 00C6B2 F4 F9 E4                     	PEA		msgRegs2
   7996 00C6B5 20 34 CD                     	JSR		DisplayString
   7997 00C6B8 20 3A CE                     	JSR		space
                                           
                                           	; Display SS
   8000 00C6BB A5 88                        	LDA		reg_ss
   8001 00C6BD 20 13 CE                     	JSR		DispWord
   8002 00C6C0 20 3A CE                     	JSR		space
                                           
                                           	; Display DS
   8005 00C6C3 A5 84                        	LDA		reg_ds
   8006 00C6C5 20 13 CE                     	JSR		DispWord
   8007 00C6C8 20 3A CE                     	JSR		space
                                           
                                           	; Display DB
   8010 00C6CB A5 A4                        	LDA		reg_db
   8011 00C6CD 20 18 CE                     	JSR		DispByte
   8012 00C6D0 20 3A CE                     	JSR		space
                                           
                                           	; Display DPR
   8015 00C6D3 A5 A8                        	LDA		reg_dp
   8016 00C6D5 20 13 CE                     	JSR		DispWord
   8017 00C6D8 20 3A CE                     	JSR		space
                                           
                                           	; Display back link
   8020 00C6DB A5 AC                        	LDA		reg_bl
   8021 00C6DD 20 13 CE                     	JSR		DispWord
                                           
                                           	; Display map number
   8024 00C6E0 20 3A CE                     	JSR		space
   8025 00C6E3 A5 B0                        	LDA		reg_mp
   8026 00C6E5 20 18 CE                     	JSR		DispByte
                                           
   8028 00C6E8 20 0B CD                     	JSR		OutCRLF
   8029 00C6EB 60                           	RTS
                                           
                                           ; Build a startup record from the register values so that a context reg
                                           ; may be loaded
                                           
   8034 00C6EC                             BuildRec:
   8035 00C6EC A5 80                        	LDA		reg_cs
   8036 00C6EE 8D 00 01                     	STA		ldtrec
   8037 00C6F1 A5 84                        	LDA		reg_ds
   8038 00C6F3 8D 02 01                     	STA		ldtrec+2
   8039 00C6F6 A5 88                        	LDA		reg_ss
   8040 00C6F8 8D 04 01                     	STA		ldtrec+4
   8041 00C6FB A5 8C                        	LDA		reg_pc
   8042 00C6FD 8D 06 01                     	STA		ldtrec+6
   8043 00C700 A5 8E                        	LDA		reg_pc+2
   8044 00C702 29 FF 00                     	AND		#$FF
   8045 00C705 E2 30                        	SEP		#$30		; 8 bit regs
                                           	MEM		8
   8047 00C707 EB                           	XBA
   8048 00C708 A5 90                        	LDA		reg_a
   8049 00C70A EB                           	XBA
   8050 00C70B C2 30                        	REP		#$30
                                           	MEM		16
   8052 00C70D 8D 08 01                     	STA		ldtrec+8
   8053 00C710 A5 91                        	LDA		reg_a+1
   8054 00C712 8D 0A 01                     	STA		ldtrec+10
   8055 00C715 A5 93                        	LDA		reg_a+3
   8056 00C717 8D 0C 01                     	STA		ldtrec+12
   8057 00C71A A5 95                        	LDA		reg_x+1
   8058 00C71C 8D 0E 01                     	STA		ldtrec+14
   8059 00C71F A5 97                        	LDA		reg_x+3
   8060 00C721 8D 10 01                     	STA		ldtrec+16
   8061 00C724 A5 99                        	LDA		reg_y+1
   8062 00C726 8D 12 01                     	STA		ldtrec+18
   8063 00C729 A5 9B                        	LDA		reg_y+3
   8064 00C72B 8D 14 01                     	STA		ldtrec+20
   8065 00C72E A5 9D                        	LDA		reg_sp+1
   8066 00C730 8D 16 01                     	STA		ldtrec+22
   8067 00C733 A5 9F                        	LDA		reg_sp+3
   8068 00C735 8D 18 01                     	STA		ldtrec+24
   8069 00C738 E2 30                        	SEP		#$30
   8070 00C73A A5 A1                        	LDA		reg_sr+1
   8071 00C73C 8D 1A 01                     	STA		ldtrec+26
   8072 00C73F A5 A4                        	LDA		reg_db
   8073 00C741 8D 1B 01                     	STA		ldtrec+27
   8074 00C744 A5 A8                        	LDA		reg_dp
   8075 00C746 8D 1C 01                     	STA		ldtrec+28
   8076 00C749 A5 A9                        	LDA		reg_dp+1
   8077 00C74B 8D 1D 01                     	STA		ldtrec+29
   8078 00C74E A5 B0                        	LDA		reg_mp
   8079 00C750 8D 1E 01                     	STA		ldtrec+30
   8080 00C753 9C 1F 01                     	STZ		ldtrec+31
   8081 00C756 C2 30                        	REP		#$30
   8082 00C758 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Dump memory.
                                           ;------------------------------------------------------------------------------
                                           
   8088 00C759                             doMemoryDump:
   8089 00C759 20 16 C9                     	JSR		IgnoreBlanks
   8090 00C75C 20 43 CE                     	JSR		GetRange
   8091 00C75F 20 0B CD                     	JSR		OutCRLF
   8092 00C762                             .0007:
   8093 00C762 A9 3E 00                     	LDA		#'>'
   8094 00C765 20 14 CD                     	JSR		OutChar
   8095 00C768 20 06 C9                     	JSR		DispRangeStart
   8096 00C76B A0 00 00                     	LDY		#0
   8097 00C76E                             .0001:
   8098 00C76E 42 B7 20                     	LDA		{RangeStart},Y
   8099 00C771 20 18 CE                     	JSR		DispByte
   8100 00C774 A9 20 00                     	LDA		#' '
   8101 00C777 20 14 CD                     	JSR		OutChar
   8102 00C77A C8                           	INY
   8103 00C77B C0 08 00                     	CPY		#8
   8104 00C77E D0 EE                        	BNE		.0001
   8105 00C780 A0 00 00                     	LDY 	#0
   8106 00C783                             .0005:
   8107 00C783 42 B7 20                     	LDA		{RangeStart},Y
   8108 00C786 29 FF 00                     	AND		#$FF
   8109 00C789 C9 20 00                     	CMP		#' '
   8110 00C78C B0 05                        	BCS		.0002
   8111 00C78E                             .0004:
   8112 00C78E A9 2E 00                     	LDA		#'.'
   8113 00C791 80 05                        	BRA		.0003
   8114 00C793                             .0002:
   8115 00C793 C9 7F 00                     	CMP		#$7f
   8116 00C796 B0 F6                        	BCS		.0004
   8117 00C798                             .0003:
   8118 00C798 20 14 CD                     	JSR		OutChar
   8119 00C79B C8                           	INY
   8120 00C79C C0 08 00                     	CPY		#8
   8121 00C79F D0 E2                        	BNE		.0005
   8122 00C7A1 20 0B CD                     	JSR		OutCRLF
   8123 00C7A4 18                           	CLC
   8124 00C7A5 A5 20                        	LDA		RangeStart
   8125 00C7A7 69 08 00                     	ADC		#8
   8126 00C7AA 85 20                        	STA		RangeStart
   8127 00C7AC 90 02                        	BCC		.0006
   8128 00C7AE E6 22                        	INC		RangeStart+2
   8129 00C7B0                             .0006:
   8130 00C7B0 38                           	SEC
   8131 00C7B1 A5 24                        	LDA		RangeEnd
   8132 00C7B3 E5 20                        	SBC		RangeStart
   8133 00C7B5 A5 26                        	LDA		RangeEnd+2
   8134 00C7B7 E5 22                        	SBC		RangeStart+2
   8135 00C7B9 08                           	PHP
   8136 00C7BA 20 8D D0                     	JSR		KeybdGetCharNoWait;Ctx,7
   8137 00C7BD 29 FF 00                     	AND		#$FF
   8138 00C7C0 C9 03 00                     	CMP		#CTRLC
   8139 00C7C3 F0 04                        	BEQ		.0009
   8140 00C7C5 28                           	PLP
   8141 00C7C6 10 9A                        	BPL		.0007
   8142 00C7C8                             .0008:
   8143 00C7C8 60                           	RTS
   8144 00C7C9                             .0009:
   8145 00C7C9 28                           	PLP
   8146 00C7CA 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Edit memory.
                                           ; ><memory address> <val1> <val2> ... <val8>
                                           ;------------------------------------------------------------------------------
                                           
   8153 00C7CB                             doMemoryEdit:
   8154 00C7CB 20 16 C9                     	JSR		IgnoreBlanks
   8155 00C7CE 20 6E CE                     	JSR		GetHexNumber
   8156 00C7D1 C0 00 00                     	CPY		#0
   8157 00C7D4 F0 FF CC F9                  	LBEQ	Mon1
   8158 00C7D8 A5 0C                        	LDA		NumWorkArea
   8159 00C7DA 85 20                        	STA		RangeStart
   8160 00C7DC A5 0E                        	LDA		NumWorkArea+2
   8161 00C7DE 85 22                        	STA		RangeStart+2
   8162 00C7E0 A0 00 00                     	LDY		#0
   8163 00C7E3                             .0001:
   8164 00C7E3 5A                           	PHY
   8165 00C7E4 20 16 C9                     	JSR		IgnoreBlanks
   8166 00C7E7 20 6E CE                     	JSR		GetHexNumber
   8167 00C7EA C0 00 00                     	CPY		#0
   8168 00C7ED F0 13                        	BEQ		.0002
   8169 00C7EF 7A                           	PLY
   8170 00C7F0 E2 20                        	SEP		#$20
   8171 00C7F2 A5 0C                        	LDA		NumWorkArea
   8172 00C7F4 42 97 20                     	STA		{RangeStart},Y
   8173 00C7F7 C2 20                        	REP		#$20
   8174 00C7F9 C8                           	INY
   8175 00C7FA C0 08 00                     	CPY		#8
   8176 00C7FD D0 E4                        	BNE		.0001
   8177 00C7FF 82 A2 F9                     	BRL		Mon1
   8178 00C802                             .0002:
   8179 00C802 7A                           	PLY
   8180 00C803 82 9E F9                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Fill memory.
                                           ; $F <start address> <end address> <val1>
                                           ;------------------------------------------------------------------------------
                                           
   8187 00C806                             doFill:
   8188 00C806 20 16 C9                     	JSR		IgnoreBlanks
   8189 00C809 20 6E CE                     	JSR		GetHexNumber
   8190 00C80C C0 00 00                     	CPY		#0
   8191 00C80F F0 FF CE FA                  	LBEQ	MonErr
   8192 00C813 A5 0C                        	LDA		NumWorkArea
   8193 00C815 85 20                        	STA		RangeStart
   8194 00C817 A5 0E                        	LDA		NumWorkArea+2
   8195 00C819 85 22                        	STA		RangeStart+2
   8196 00C81B 20 16 C9                     	JSR		IgnoreBlanks
   8197 00C81E 20 6E CE                     	JSR		GetHexNumber
   8198 00C821 C0 00 00                     	CPY		#0
   8199 00C824 F0 FF B9 FA                  	LBEQ	MonErr
   8200 00C828 A5 0C                        	LDA		NumWorkArea
   8201 00C82A 85 24                        	STA		RangeEnd
   8202 00C82C A5 0E                        	LDA		NumWorkArea+2
   8203 00C82E 85 26                        	STA		RangeEnd+2
   8204 00C830 20 16 C9                     	JSR		IgnoreBlanks
   8205 00C833 20 6E CE                     	JSR		GetHexNumber
   8206 00C836 C0 00 00                     	CPY		#0
   8207 00C839 F0 FF A4 FA                  	LBEQ	MonErr
   8208 00C83D A6 0C                        	LDX		NumWorkArea
                                           	; Process in 32 bit mode
   8210 00C83F 42 E2 00 02                  	SEP		#$200
   8211 00C843 42 C2 00 01                  	REP		#$100
   8212 00C847 A5 24                        	LDA		RangeEnd
   8213 00C849 38                           	SEC
   8214 00C84A E5 20                        	SBC		RangeStart
   8215 00C84C A4 20                        	LDY		RangeStart
   8216 00C84E 42 44 00                     	FIL		$00
                                           	; Back to 16 bits mode
   8218 00C851 42 C2 00 02                  	REP		#$200
   8219 00C855 42 E2 00 01                  	SEP		#$100
   8220 00C859 82 48 F9                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Disassemble code
                                           ;------------------------------------------------------------------------------
                                           
   8226 00C85C                             doDisassemble:
   8227 00C85C 20 D0 C2                     	JSR		MonGetch
   8228 00C85F C9 4D 00                     	CMP		#'M'
   8229 00C862 F0 11                        	BEQ		.0002
   8230 00C864                             .0004:
   8231 00C864 C9 4E 00                     	CMP		#'N'
   8232 00C867 D0 1B                        	BNE		.0003
   8233 00C869 E2 20                        	SEP		#$20
                                           	MEM		8
   8235 00C86B A5 BC                        	LDA		$BC
   8236 00C86D 09 40                        	ORA		#$40
   8237 00C86F 85 BC                        	STA		$BC
   8238 00C871 C2 20                        	REP		#$20
   8239 00C873 80 11                        	BRA		.0005
   8240 00C875                             .0002:
   8241 00C875 E2 20                        	SEP		#$20
   8242 00C877 A5 BC                        	LDA		$BC
   8243 00C879 09 80                        	ORA		#$80
   8244 00C87B 85 BC                        	STA		$BC
   8245 00C87D C2 20                        	REP		#$20
   8246 00C87F 20 D0 C2                     	JSR		MonGetch
   8247 00C882 80 E0                        	BRA		.0004
                                           	MEM		16
   8249 00C884                             .0003:
   8250 00C884 CA                           	DEX
   8251 00C885 CA                           	DEX
   8252 00C886                             .0005:
   8253 00C886 20 16 C9                     	JSR		IgnoreBlanks
   8254 00C889 20 43 CE                     	JSR		GetRange
   8255 00C88C A5 20                        	LDA		RangeStart
   8256 00C88E 85 8F                        	STA		$8F				; addra
   8257 00C890 A5 21                        	LDA		RangeStart+1
   8258 00C892 85 90                        	STA		$90
   8259 00C894 20 0B CD                     	JSR		OutCRLF
   8260 00C897 A0 14 00                     	LDY		#20
   8261 00C89A                             .0001:
   8262 00C89A 5A                           	PHY
   8263 00C89B E2 30                        	SEP		#$30
   8264 00C89D 20 59 86                     	JSR		dpycod
   8265 00C8A0 C2 30                        	REP		#$30
   8266 00C8A2 20 0B CD                     	JSR		OutCRLF
   8267 00C8A5 7A                           	PLY
   8268 00C8A6 88                           	DEY
   8269 00C8A7 D0 F1                        	BNE		.0001
   8270 00C8A9 4C A4 C1                     	JMP		Mon1
                                           
                                           ;$BC flimflag
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Jump to subroutine
                                           ;
                                           ; Either JSR for 16 bit address or JSL for 24 bit address
                                           ;------------------------------------------------------------------------------
                                           
   8280 00C8AC                             doJump:
   8281 00C8AC 20 D0 C2                     	JSR		MonGetch
   8282 00C8AF C9 53 00                     	CMP		#'S'
   8283 00C8B2 D0 FF EE F8                  	LBNE	Mon1
   8284 00C8B6 20 D0 C2                     	JSR		MonGetch
   8285 00C8B9 C9 52 00                     	CMP		#'R'
   8286 00C8BC D0 1A                        	BNE		.testL
   8287 00C8BE 20 16 C9                     	JSR		IgnoreBlanks
   8288 00C8C1 20 6E CE                     	JSR		GetHexNumber
   8289 00C8C4 C0 00 00                     	CPY		#0
   8290 00C8C7 F0 FF D9 F8                  	LBEQ	Mon1
   8291 00C8CB A5 0C                        	LDA		NumWorkArea
   8292 00C8CD 85 24                        	STA		RangeEnd
   8293 00C8CF A2 00 00                     	LDX		#0
   8294 00C8D2 FC 24 00                     	JSR		(RangeEnd,X)
   8295 00C8D5 82 CC F8                     	BRL		Mon1
   8296 00C8D8                             .testL:
   8297 00C8D8 C9 4C 00                     	CMP		#'L'
   8298 00C8DB D0 FF C5 F8                  	LBNE	Mon1
   8299 00C8DF 20 16 C9                     	JSR		IgnoreBlanks
   8300 00C8E2 20 6E CE                     	JSR		GetHexNumber
   8301 00C8E5 C0 00 00                     	CPY		#0
   8302 00C8E8 F0 FF B8 F8                  	LBEQ	Mon1
   8303 00C8EC A9 5C 00                     	LDA		#$5C			; JML opcode
   8304 00C8EF 85 23                        	STA		RangeEnd-1
   8305 00C8F1 A5 0C                        	LDA		NumWorkArea
   8306 00C8F3 85 24                        	STA		RangeEnd
   8307 00C8F5 A5 0D                        	LDA		NumWorkArea+1
   8308 00C8F7 85 25                        	STA		RangeEnd+1
   8309 00C8F9 A9 24 00                     	LDA		#RangeEnd
   8310 00C8FC 42 E0 01                     	CACHE	#1				; 1= invalidate instruction line identified by accumulator
   8311 00C8FF 22 24 00 00                  	JSL		RangeEnd
   8312 00C903 82 9E F8                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   8316 00C906                             DispRangeStart:
   8317 00C906 A5 21                        	LDA		RangeStart+1
   8318 00C908 20 13 CE                     	JSR		DispWord
   8319 00C90B A5 20                        	LDA		RangeStart
   8320 00C90D 20 18 CE                     	JSR		DispByte
   8321 00C910 A9 20 00                     	LDA		#' '
   8322 00C913 4C 14 CD                     	JMP		OutChar
                                           	
                                           ; Skip over blanks in the input
                                           ;------------------------------------------------------------------------------
                                           
   8327 00C916                             IgnoreBlanks:
   8328 00C916                             .0001:
   8329 00C916 20 D0 C2                     	JSR		MonGetch
   8330 00C919 C9 20 00                     	CMP		#' '
   8331 00C91C F0 F8                        	BEQ		.0001
   8332 00C91E CA                           	DEX
   8333 00C91F CA                           	DEX
   8334 00C920 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; BIOSInput allows full screen editing of text until a carriage return is keyed
                                           ; at which point the line the cursor is on is copied to a buffer. The buffer
                                           ; must be at least TEXTCOLS characters in size.
                                           ;------------------------------------------------------------------------------
                                           ;
   8342 00C921                             BIOSInput:
   8343 00C921                             .bin1:
   8344 00C921 20 A9 D0                     	JSR		KeybdGetCharWait
   8345 00C924 29 FF 00                     	AND		#$FF
   8346 00C927 C9 0D 00                     	CMP		#CR
   8347 00C92A F0 05                        	BEQ		.bin2
   8348 00C92C 20 14 CD                     	JSR		OutChar
   8349 00C92F 80 F0                        	BRA		.bin1
   8350 00C931                             .bin2:
   8351 00C931 A5 30                        	LDA		CursorX
   8352 00C933 F0 1E                        	BEQ		.bin4
   8353 00C935 A5 34                        	LDA		VideoPos	; get current video position
   8354 00C937 38                           	SEC
   8355 00C938 E5 30                        	SBC		CursorX		; go back to the start of the line
   8356 00C93A 0A                           	ASL
   8357 00C93B AA                           	TAX
   8358 00C93C                             .bin3:
   8359 00C93C 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   8360 00C944 29 FF 00                     	AND		#$FF
   8361 00C947 93 03                        	STA		(3,s),Y
   8362 00C949 E8                           	INX
   8363 00C94A E8                           	INX
   8364 00C94B C8                           	INY
   8365 00C94C C6 30                        	DEC		CursorX
   8366 00C94E D0 EC                        	BNE		.bin3
   8367 00C950 A9 00 00                     	LDA		#0
   8368 00C953                             .bin4:
   8369 00C953 93 03                        	STA		(3,s),Y	; NULL terminate buffer
   8370 00C955 60                           	RTS
                                           
   8372 00C956                             .st0003:
   8373 00C956 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD
                                         
   8374 00C95E 10 F6                        	BPL		.st0003
   8375 00C960 48                           	PHA						; save off the char (we need to trash acc)
   8376 00C961 42 3B FF 0F AF 14 A1 0E      	LDA		$FFF:KEYBD+4	; clear keyboard strobe (must be a read operation)
                                         
   8377 00C969 68                           	PLA						; restore char
   8378 00C96A 20 22 CB                     	JSR		DisplayChar
   8379 00C96D 80 E7                        	BRA		.st0003
   8380 00C96F A0 00 00                     	ldy		#$0000
   8381 00C972                             .st0001:
   8382 00C972 A2 00 00                     	ldx		#$0000
   8383 00C975                             .st0002:
   8384 00C975 E8                           	inx
   8385 00C976 D0 FD                        	bne		.st0002
   8386 00C978 20 BB C9                     	jsr		echo_switch
   8387 00C97B C8                           	iny
   8388 00C97C 80 F4                        	bra		.st0001
                                           
   8390 00C97E                             msgStarting:
   8391 00C97E 46 54 38 33 32 20 54 65      	.byte	"FT832 Test System Starting",CR,LF
   8391 00C986 73 74 20 53 79 73 74 65    
   8391 00C98E 6D 20 53 74 61 72 74 69    
   8391 00C996 6E 67 0D 0A                
   8392 00C99A 36 35 43 30 32 2F 36 35      	.byte	"65C02/65C816/65C832 Compatible",CR,LF,0
   8392 00C9A2 43 38 31 36 2F 36 35 43    
   8392 00C9AA 38 33 32 20 43 6F 6D 70    
   8392 00C9B2 61 74 69 62 6C 65 0D 0A    
   8392 00C9BA 00                         
                                           
   8394 00C9BB                             echo_switch:
   8395 00C9BB AD 00 71                     	lda		$7100
   8396 00C9BE 8D 00 70                     	sta		$7000
   8397 00C9C1 60                           	rts
                                           
                                           ;------------------------------------------------------------------------------
                                           ; On entry to the SSM task the .A register will be set to the task number
                                           ; being single stepped. The .X register will contain the address of the
                                           ; next instruction to execute.
                                           ;------------------------------------------------------------------------------
                                           
   8405 00C9C2                             SSMInit:
                                           	; setup SSM data segment in SDT
   8407 00C9C2 A0 06 00                     	LDY		#6
   8408 00C9C5 A9 01 00                     	LDA		#1
   8409 00C9C8 42 EB                        	XBAW
   8410 00C9CA A9 00 00                     	LDA		#$0000
   8411 00C9CD A2 82 08                     	LDX		#$882		; 1k data
   8412 00C9D0 42 BA                        	SDU
                                           	; Setup SSM stack segment in SDT
   8414 00C9D2 C8                           	INY
   8415 00C9D3 A9 00 04                     	LDA		#$0400
   8416 00C9D6 A2 82 08                     	LDX		#$882		; 1k stack
   8417 00C9D9 42 BA                        	SDU
                                           	; Setup SSM code segment in SDT
   8419 00C9DB C8                           	INY
   8420 00C9DC A9 00 00                     	LDA		#$0000
   8421 00C9DF 42 EB                        	XBAW
   8422 00C9E1 A9 00 00                     	LDA		#$0000
   8423 00C9E4 A2 05 09                     	LDX		#$905
   8424 00C9E7 42 BA                        	SDU
   8425 00C9E9 42 5C F0 C9 00 08 00         	JMF		8:.0001
   8426 00C9F0                             .0001:
                                           	; Initialize data selector and stack selector, pointer
                                           	; The stack is begin switched from the one currently defined by
                                           	; by the task table. So the return task needs to be popped off
                                           	; the current stack and placed on the new one.
   8431 00C9F0 FA                           	PLX					; get the task to return to
   8432 00C9F1 A9 07 00                     	LDA		#7
   8433 00C9F4 78                           	SEI
   8434 00C9F5 42 5A                        	TASS
   8435 00C9F7 A9 FF 03                     	LDA		#$3FF		; setup stack pointer
   8436 00C9FA 1B                           	TAS
   8437 00C9FB 58                           	CLI
   8438 00C9FC DA                           	PHX					; save return task on new stack
   8439 00C9FD F4 06 00                     	PEA		6
   8440 00CA00 42 2B                        	PLDS
                                           
   8442 00CA02 A9 09 00                     	LDA		#9
   8443 00CA05 42 20 C4 DF FD               	JCR		SetIOFocus,$FD
   8444 00CA0A A9 00 61                     	LDA		#$6100
   8445 00CA0D 85 36                        	STA		NormAttr
   8446 00CA0F A9 FF 0F                     	LDA		#4095		; set segment
   8447 00CA12 85 44                        	STA		Vidptr+4
   8448 00CA14 85 4A                        	STA		Vidregs+4
   8449 00CA16 A9 0B 00                     	LDA		#$000B		; screen location is $FB0000
   8450 00CA19 85 42                        	STA		Vidptr+2
   8451 00CA1B 64 40                        	STZ		Vidptr
   8452 00CA1D A9 0E 00                     	LDA		#$000E		; regset is at $FEA010
   8453 00CA20 85 48                        	STA		Vidregs+2
   8454 00CA22 A9 10 A0                     	LDA		#$A010
   8455 00CA25 85 46                        	STA		Vidregs
   8456 00CA27 A0 07 00                     	LDY		#7
   8457 00CA2A A9 10 00                     	LDA		#$10		; divide by 2 vertically, 1 horizontally
   8458 00CA2D 20 7E CD                     	JSR		SetVideoReg
   8459 00CA30 A9 B4 00                     	LDA		#180		; set window left position 672
   8460 00CA33 A0 02 00                     	LDY		#2
   8461 00CA36 20 7E CD                     	JSR		SetVideoReg
   8462 00CA39 A9 02 00                     	LDA		#2
   8463 00CA3C A0 03 00                     	LDY		#3
   8464 00CA3F 20 7E CD                     	JSR		SetVideoReg
   8465 00CA42 A9 20 00                     	LDA		#32			; set window top position
   8466 00CA45 A0 04 00                     	LDY		#4
   8467 00CA48 20 7E CD                     	JSR		SetVideoReg
   8468 00CA4B 20 63 CD                     	JSR		GetTextRowsCols
   8469 00CA4E A9 22 CB                     	LDA		#DisplayChar
   8470 00CA51 8D F0 03                     	STA		OutputVec
   8471 00CA54 20 A8 CD                     	JSR		ClearScreen
   8472 00CA57 20 E7 CC                     	JSR		HomeCursor
   8473 00CA5A F4 08 00                     	PEA		8
   8474 00CA5D F4 D8 CA                     	PEA		msgSSM
   8475 00CA60 20 34 CD                     	JSR		DisplayString
   8476 00CA63 42 60                        	RTT
   8477 00CA65                             SSMTask:
   8478 00CA65 85 BE                        	STA		WorkTR
   8479 00CA67 20 41 C6                     	JSR		DispRegs
   8480 00CA6A                             .0004:
   8481 00CA6A A9 53 00                     	LDA		#'S'
   8482 00CA6D 20 14 CD                     	JSR		OutChar
   8483 00CA70 A9 53 00                     	LDA		#'S'
   8484 00CA73 20 14 CD                     	JSR		OutChar
   8485 00CA76 A9 4D 00                     	LDA		#'M'
   8486 00CA79 20 14 CD                     	JSR		OutChar
   8487 00CA7C A9 3E 00                     	LDA		#'>'
   8488 00CA7F                             .0005:
   8489 00CA7F 20 14 CD                     	JSR		OutChar
   8490 00CA82                             .0008:
   8491 00CA82 20 A9 D0                     	JSR		KeybdGetCharWait
   8492 00CA85 B0 FB                        	BCS		.0008
   8493 00CA87 29 FF 00                     	AND		#$FF
   8494 00CA8A C9 53 00                     	CMP		#'S'		; step
   8495 00CA8D D0 04                        	BNE		.0001
   8496 00CA8F                             .0002:
   8497 00CA8F 42 60                        	RTT
   8498 00CA91 80 D2                        	BRA		SSMTask
   8499 00CA93                             .0001:
   8500 00CA93 C9 58 00                     	CMP		#'X'
   8501 00CA96 D0 16                        	BNE		.0006
   8502 00CA98 A5 A0                        	LDA		reg_sr
   8503 00CA9A 29 FF EF                     	AND		#$EFFF
   8504 00CA9D 85 A0                        	STA		reg_sr
   8505 00CA9F 20 EC C6                     	JSR		BuildRec
   8506 00CAA2 A6 BE                        	LDX		WorkTR
   8507 00CAA4 42 6C 00 01 00 00            	LDT		ldtrec
   8508 00CAAA 42 60                        	RTT
   8509 00CAAC 80 B7                        	BRA		SSMTask
   8510 00CAAE                             .0006:
   8511 00CAAE C9 0D 00                     	CMP		#CR
   8512 00CAB1 D0 CC                        	BNE		.0005
   8513 00CAB3 A5 32                        	LDA		CursorY
   8514 00CAB5 0A                           	ASL
   8515 00CAB6 AA                           	TAX
   8516 00CAB7 42 1B BD FF E2               	LDA		CS:LineTbl,X
   8517 00CABC 18                           	CLC
   8518 00CABD 69 04 00                     	ADC		#4
   8519 00CAC0 0A                           	ASL
   8520 00CAC1 AA                           	TAX
   8521 00CAC2 20 16 C9                     	JSR		IgnoreBlanks
   8522 00CAC5 20 D0 C2                     	JSR		MonGetch
   8523 00CAC8 C9 4D 00                     	CMP		#'M'
   8524 00CACB D0 03                        	BNE		.0007
   8525 00CACD 20 59 C7                     	JSR		doMemoryDump
   8526 00CAD0                             .0007:
   8527 00CAD0 82 AC FF                     	BRL		.0005
   8528 00CAD3 42 60                        	RTT
   8529 00CAD5 82 8D FF                     	BRL		SSMTask
                                           
   8531 00CAD8                             msgSSM:
   8532 00CAD8 53 69 6E 67 6C 65 20 73      	.byte	"Single step mode task starting.",CR,LF,0
   8532 00CAE0 74 65 70 20 6D 6F 64 65    
   8532 00CAE8 20 74 61 73 6B 20 73 74    
   8532 00CAF0 61 72 74 69 6E 67 2E 0D    
   8532 00CAF8 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert Ascii character to screen character.
                                           ;------------------------------------------------------------------------------
                                           
   8538 00CAFA                             AsciiToScreen:
   8539 00CAFA 29 FF 00                     	AND		#$FF
   8540 00CAFD 89 20 00                     	BIT		#%00100000	; if bit 5 isn't set
   8541 00CB00 F0 08                        	BEQ		.00001
   8542 00CB02 89 40 00                     	BIT		#%01000000	; or bit 6 isn't set
   8543 00CB05 F0 03                        	BEQ		.00001
   8544 00CB07 29 9F 00                     	AND		#%10011111
   8545 00CB0A                             .00001:
   8546 00CB0A 60                           	rts
                                           
                                           	MEM		8
   8549 00CB0B                             AsciiToScreen8:
   8550 00CB0B 89 20                        	BIT		#%00100000	; if bit 5 isn't set
   8551 00CB0D F0 06                        	BEQ		.00001
   8552 00CB0F 89 40                        	BIT		#%01000000	; or bit 6 isn't set
   8553 00CB11 F0 02                        	BEQ		.00001
   8554 00CB13 29 9F                        	AND		#%10011111
   8555 00CB15                             .00001:
   8556 00CB15 60                           	rts
                                           
                                           	MEM		16
                                           ;------------------------------------------------------------------------------
                                           ; Convert screen character to ascii character
                                           ;------------------------------------------------------------------------------
                                           ;
   8563 00CB16                             ScreenToAscii:
   8564 00CB16 29 FF 00                     	AND		#$FF
   8565 00CB19 C9 1B 00                     	CMP		#26+1
   8566 00CB1C B0 03                        	BCS		.0001
   8567 00CB1E 69 60 00                     	ADC		#$60
   8568 00CB21                             .0001:
   8569 00CB21 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display a character on the screen device
                                           ; Expects the processor to be in 16 bit mode with 16 bit acc and 16 bit indexes
                                           ;------------------------------------------------------------------------------
                                           ;
   8576 00CB22                             DisplayChar:
   8577 00CB22 29 FF 00                     	AND		#$0FF
   8578 00CB25 24 3C                        	BIT		EscState		; check if processing escape sequence
   8579 00CB27 30 FF 89 00                  	LBMI	processEsc
   8580 00CB2B C9 08 00                     	CMP		#BS
   8581 00CB2E F0 FF 33 01                  	LBEQ	doBackSpace
   8582 00CB32 C9 91 00                     	CMP		#$91			; cursor right
   8583 00CB35 F0 FF 89 01                  	LBEQ	doCursorRight
   8584 00CB39 C9 93 00                     	CMP		#$93			; cursor left
   8585 00CB3C F0 FF 8D 01                  	LBEQ	doCursorLeft
   8586 00CB40 C9 90 00                     	CMP		#$90			; cursor up
   8587 00CB43 F0 FF 8D 01                  	LBEQ	doCursorUp
   8588 00CB47 C9 92 00                     	CMP		#$92			; cursor down
   8589 00CB4A F0 FF 8D 01                  	LBEQ	doCursorDown
   8590 00CB4E C9 99 00                     	CMP		#$99			; delete
   8591 00CB51 F0 FF 3B 01                  	LBEQ	doDelete
   8592 00CB55 C9 0D 00                     	CMP		#CR
   8593 00CB58 F0 47                        	BEQ		doCR
   8594 00CB5A C9 0A 00                     	CMP		#LF
   8595 00CB5D F0 47                        	BEQ		doLF
   8596 00CB5F C9 94 00                     	CMP		#$94
   8597 00CB62 F0 FF 54 01                  	LBEQ	doCursorHome	; cursor home
   8598 00CB66 C9 1B 00                     	CMP		#ESC
   8599 00CB69 D0 05                        	BNE		.0003
   8600 00CB6B 64 3C                        	STZ		EscState		; put a -1 in the escape state
   8601 00CB6D C6 3C                        	DEC		EscState
   8602 00CB6F 60                           	RTS
   8603 00CB70                             .0003:
   8604 00CB70 20 FA CA                     	JSR		AsciiToScreen
   8605 00CB73 05 36                        	ORA		NormAttr
   8606 00CB75 48                           	PHA
   8607 00CB76 A5 34                        	LDA		VideoPos
   8608 00CB78 0A                           	ASL
   8609 00CB79 A8                           	TAY
   8610 00CB7A 68                           	PLA
   8611 00CB7B 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8612 00CB80 A5 30                        	LDA		CursorX
   8613 00CB82 1A                           	INA
   8614 00CB83 C5 4C                        	CMP		Textcols
   8615 00CB85 D0 15                        	BNE		.0001
   8616 00CB87 64 30                        	STZ		CursorX
   8617 00CB89 A5 32                        	LDA		CursorY
   8618 00CB8B 1A                           	INA
   8619 00CB8C C5 4E                        	CMP		Textrows
   8620 00CB8E F0 05                        	BEQ		.0002
   8621 00CB90 85 32                        	STA		CursorY
   8622 00CB92 82 59 01                     	BRL		SyncVideoPos
   8623 00CB95                             .0002:
   8624 00CB95 3A                           	DEA
   8625 00CB96 20 EE CC                     	JSR		SyncVideoPos
   8626 00CB99 82 33 02                     	BRL		ScrollUp
   8627 00CB9C                             .0001:
   8628 00CB9C 85 30                        	STA		CursorX
   8629 00CB9E 82 4D 01                     	BRL		SyncVideoPos
   8630 00CBA1                             doCR:
   8631 00CBA1 64 30                        	STZ		CursorX
   8632 00CBA3 82 48 01                     	BRL		SyncVideoPos
   8633 00CBA6                             doLF:
   8634 00CBA6 A5 32                        	LDA		CursorY
   8635 00CBA8 1A                           	INA
   8636 00CBA9 C5 4E                        	CMP		Textrows
   8637 00CBAB 10 FF 20 02                  	LBPL	ScrollUp
   8638 00CBAF 85 32                        	STA		CursorY
   8639 00CBB1 82 3A 01                     	BRL		SyncVideoPos
                                           
                                           ; Process escape sequences for WYSE terminal emulation
                                           ; Handles:
                                           ; {esc}T		- clear to end of line
                                           ; {esc}W		- delete character
                                           ; {esc}`1		- cursor on
                                           ; {esc}`0		- cursor off
                                           ; {esc}({esc}G4	- reverse video
                                           ; {esc}({esc}G0	- normal video
                                           ;
                                           ; EscState
                                           ; -1 = first esc char
                                           ; -2 = second esc char
                                           ; ...
                                           ;
   8655 00CBB4                             processEsc:
   8656 00CBB4 A6 3C                        	LDX		EscState
   8657 00CBB6 E0 FF FF                     	CPX		#-1
   8658 00CBB9 D0 45                        	BNE		.0006
   8659 00CBBB C9 54 00                     	CMP		#'T'	; clear to EOL
   8660 00CBBE D0 1D                        	BNE		.0003
   8661 00CBC0 A5 34                        	LDA		VideoPos
   8662 00CBC2 0A                           	ASL
   8663 00CBC3 A8                           	TAY
   8664 00CBC4 A6 30                        	LDX		CursorX
   8665 00CBC6 E8                           	INX
   8666 00CBC7                             .0001:
   8667 00CBC7 E4 4C                        	CPX		Textcols
   8668 00CBC9 10 0F                        	BPL		.0002
   8669 00CBCB A9 20 00                     	LDA		#' '
   8670 00CBCE 05 36                        	ORA		NormAttr
   8671 00CBD0 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8672 00CBD5 E8                           	INX
   8673 00CBD6 C8                           	INY
   8674 00CBD7 C8                           	INY
   8675 00CBD8 D0 ED                        	BNE		.0001
   8676 00CBDA                             .0002:
   8677 00CBDA 64 3C                        	STZ		EscState
   8678 00CBDC 60                           	RTS
   8679 00CBDD                             .0003:
   8680 00CBDD C9 57 00                     	CMP		#'W'
   8681 00CBE0 D0 05                        	BNE		.0004
   8682 00CBE2 64 3C                        	STZ		EscState
   8683 00CBE4 82 A9 00                     	BRL		doDelete
   8684 00CBE7                             .0004:
   8685 00CBE7 C9 60 00                     	CMP		#'`'
   8686 00CBEA D0 06                        	BNE		.0005
   8687 00CBEC A9 FE FF                     	LDA		#-2
   8688 00CBEF 85 3C                        	STA		EscState
   8689 00CBF1 60                           	RTS
   8690 00CBF2                             .0005:
   8691 00CBF2 C9 28 00                     	CMP		#'('
   8692 00CBF5 D0 06                        	BNE		.0008
   8693 00CBF7 A9 FD FF                     	LDA		#-3
   8694 00CBFA 85 3C                        	STA		EscState
   8695 00CBFC 60                           	RTS
   8696 00CBFD                             .0008:
   8697 00CBFD 64 3C                        	STZ		EscState
   8698 00CBFF 60                           	RTS
   8699 00CC00                             .0006:
   8700 00CC00 E0 FE FF                     	CPX		#-2
   8701 00CC03 D0 11                        	BNE		.0007
   8702 00CC05 64 3C                        	STZ		EscState
   8703 00CC07 C9 31 00                     	CMP		#'1'
   8704 00CC0A F0 FF 7A 01                  	LBEQ	CursorOn
   8705 00CC0E C9 30 00                     	CMP		#'0'
   8706 00CC11 F0 FF 83 01                  	LBEQ	CursorOff
   8707 00CC15 60                           	RTS
   8708 00CC16                             .0007:
   8709 00CC16 E0 FD FF                     	CPX		#-3
   8710 00CC19 D0 0B                        	BNE		.0009
   8711 00CC1B C9 1B 00                     	CMP		#ESC
   8712 00CC1E D0 DD                        	BNE		.0008
   8713 00CC20 A9 FC FF                     	LDA		#-4
   8714 00CC23 85 3C                        	STA		EscState
   8715 00CC25 60                           	RTS
   8716 00CC26                             .0009:
   8717 00CC26 E0 FC FF                     	CPX		#-4
   8718 00CC29 D0 0B                        	BNE		.0010
   8719 00CC2B C9 47 00                     	CMP		#'G'
   8720 00CC2E D0 CD                        	BNE		.0008
   8721 00CC30 A9 FB FF                     	LDA		#-5
   8722 00CC33 85 3C                        	STA		EscState
   8723 00CC35 60                           	RTS
   8724 00CC36                             .0010:
   8725 00CC36 E0 FB FF                     	CPX		#-5
   8726 00CC39 D0 C2                        	BNE		.0008
   8727 00CC3B 64 3C                        	STZ		EscState
   8728 00CC3D C9 34 00                     	CMP		#'4'
   8729 00CC40 D0 12                        	BNE		.0011
   8730 00CC42 A5 36                        	LDA		NormAttr
                                           	; Swap the high nybbles of the attribute
   8732 00CC44 EB                           	XBA				
   8733 00CC45 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
   8736 00CC47 2A                           	ROL
   8737 00CC48 2A                           	ROL
   8738 00CC49 2A                           	ROL
   8739 00CC4A 2A                           	ROL
   8740 00CC4B C2 30                        	REP		#$30		; set 16 bit regs
                                           	NDX		16			; tell the assembler
                                           	MEM		16
   8743 00CC4D EB                           	XBA
   8744 00CC4E 29 00 FF                     	AND		#$FF00
   8745 00CC51 85 36                        	STA		NormAttr
   8746 00CC53 60                           	RTS
   8747 00CC54                             .0011:
   8748 00CC54 C9 30 00                     	CMP		#'0'
   8749 00CC57 D0 06                        	BNE		.0012
   8750 00CC59 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8751 00CC5C 85 36                        	STA		NormAttr
   8752 00CC5E 60                           	RTS
   8753 00CC5F                             .0012:
   8754 00CC5F A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8755 00CC62 85 36                        	STA		NormAttr
   8756 00CC64 60                           	RTS
                                           
   8758 00CC65                             doBackSpace:
   8759 00CC65 A6 30                        	LDX		CursorX
   8760 00CC67 F0 26                        	BEQ		.0001		; Can't backspace anymore
   8761 00CC69 A5 34                        	LDA		VideoPos
   8762 00CC6B 0A                           	ASL
   8763 00CC6C A8                           	TAY
   8764 00CC6D                             .0002:
   8765 00CC6D 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8766 00CC72 88                           	DEY
   8767 00CC73 88                           	DEY
   8768 00CC74 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8769 00CC79 42 C8                        	INY4
   8770 00CC7B E8                           	INX
   8771 00CC7C E4 4C                        	CPX		Textcols
   8772 00CC7E D0 ED                        	BNE		.0002
   8773 00CC80                             .0003:
   8774 00CC80 A9 20 00                     	LDA		#' '
   8775 00CC83 05 36                        	ORA		NormAttr
   8776 00CC85 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8777 00CC8A C6 30                        	DEC		CursorX
   8778 00CC8C 82 5F 00                     	BRL		SyncVideoPos
   8779 00CC8F                             .0001:
   8780 00CC8F 60                           	RTS
                                           
                                           ; Deleting a character does not change the video position so there's no need
                                           ; to resynchronize it.
                                           
   8785 00CC90                             doDelete:
   8786 00CC90 A6 30                        	LDX		CursorX
   8787 00CC92 A5 34                        	LDA		VideoPos
   8788 00CC94 0A                           	ASL
   8789 00CC95 A8                           	TAY
   8790 00CC96                             .0002:
   8791 00CC96 E8                           	INX
   8792 00CC97 E4 4C                        	CPX		Textcols
   8793 00CC99 10 14                        	BPL		.0001
   8794 00CC9B CA                           	DEX
   8795 00CC9C C8                           	INY
   8796 00CC9D C8                           	INY
   8797 00CC9E 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8798 00CCA3 88                           	DEY
   8799 00CCA4 88                           	DEY
   8800 00CCA5 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8801 00CCAA C8                           	INY
   8802 00CCAB C8                           	INY
   8803 00CCAC E8                           	INX
   8804 00CCAD 80 E7                        	BRA		.0002
   8805 00CCAF                             .0001:
   8806 00CCAF A9 20 00                     	LDA		#' '
   8807 00CCB2 05 36                        	ORA		NormAttr
   8808 00CCB4 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8809 00CCB9 60                           	RTS
                                           
   8811 00CCBA                             doCursorHome:
   8812 00CCBA A5 30                        	LDA		CursorX
   8813 00CCBC F0 24                        	BEQ		doCursor1
   8814 00CCBE 64 30                        	STZ		CursorX
   8815 00CCC0 80 2C                        	BRA		SyncVideoPos
   8816 00CCC2                             doCursorRight:
   8817 00CCC2 A5 30                        	LDA		CursorX
   8818 00CCC4 1A                           	INA
   8819 00CCC5 C5 4C                        	CMP		Textcols
   8820 00CCC7 10 1D                        	BPL		doRTS
   8821 00CCC9                             doCursor2:
   8822 00CCC9 85 30                        	STA		CursorX
   8823 00CCCB 80 21                        	BRA		SyncVideoPos
   8824 00CCCD                             doCursorLeft:
   8825 00CCCD A5 30                        	LDA		CursorX
   8826 00CCCF F0 15                        	BEQ		doRTS
   8827 00CCD1 3A                           	DEA
   8828 00CCD2 80 F5                        	BRA		doCursor2
   8829 00CCD4                             doCursorUp:
   8830 00CCD4 A5 32                        	LDA		CursorY
   8831 00CCD6 F0 0E                        	BEQ		doRTS
   8832 00CCD8 3A                           	DEA
   8833 00CCD9 80 07                        	BRA		doCursor1
   8834 00CCDB                             doCursorDown:
   8835 00CCDB A5 32                        	LDA		CursorY
   8836 00CCDD 1A                           	INA
   8837 00CCDE C5 4E                        	CMP		Textrows
   8838 00CCE0 10 04                        	BPL		doRTS
   8839 00CCE2                             doCursor1:
   8840 00CCE2 85 32                        	STA		CursorY
   8841 00CCE4 80 08                        	BRA		SyncVideoPos
   8842 00CCE6                             doRTS:
   8843 00CCE6 60                           	RTS
                                           
   8845 00CCE7                             HomeCursor:
   8846 00CCE7 A9 00 00                     	LDA		#0
   8847 00CCEA 64 30                        	STZ		CursorX
   8848 00CCEC 64 32                        	STZ		CursorY
                                           
                                           ; Synchronize the absolute video position with the cursor co-ordinates.
                                           ;
   8852 00CCEE                             SyncVideoPos:
   8853 00CCEE 48                           	PHA
   8854 00CCEF 5A                           	PHY
   8855 00CCF0 A5 32                        	LDA		CursorY
   8856 00CCF2 0A                           	ASL
   8857 00CCF3 AA                           	TAX
   8858 00CCF4 42 3B 05 00 BD FF E2         	LDA		5:LineTbl,X
   8859 00CCFB 18                           	CLC
   8860 00CCFC 65 30                        	ADC		CursorX
   8861 00CCFE 85 34                        	STA		VideoPos
   8862 00CD00 A0 0D 00                     	LDY		#13
   8863 00CD03 42 DA 42 97 46               	STA		FAR {Vidregs},Y		; Update the position in the text controller
   8864 00CD08 7A                           	PLY
   8865 00CD09 68                           	PLA
   8866 00CD0A 60                           	RTS
                                           
   8868 00CD0B                             OutCRLF:
   8869 00CD0B A9 0D 00                     	LDA		#CR
   8870 00CD0E 20 14 CD                     	JSR		OutChar
   8871 00CD11 A9 0A 00                     	LDA		#LF
                                           
   8873 00CD14                             OutChar:
   8874 00CD14                             .chkFocus:
   8875 00CD14 48                           	PHA
   8876 00CD15 42 20 D4 DF FD               	JCR		CheckIOFocus,OSctx
   8877 00CD1A D0 10                        	BNE		.noFocus
   8878 00CD1C 68                           	PLA
   8879 00CD1D DA                           	PHX
   8880 00CD1E 5A                           	PHY
   8881 00CD1F 08                           	PHP
   8882 00CD20 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8885 00CD22 A2 00 00                     	LDX		#0
   8886 00CD25 FC F0 03                     	JSR		(OutputVec,x)
   8887 00CD28 28                           	PLP
   8888 00CD29 7A                           	PLY
   8889 00CD2A FA                           	PLX
   8890 00CD2B 60                           	RTS
                                           	; Here the task doesn't have the I/O focus and it's trying to
                                           	; display something, so switch to another task until this task
                                           	; has focus.
   8894 00CD2C                             .noFocus:
   8895 00CD2C 68                           	PLA
   8896 00CD2D 42 20 64 E1 FD               	JCR		FMTK_ScheduleTask,OSctx	; schedule another task
   8897 00CD32 80 E0                        	BRA		.chkFocus
                                           
   8899 00CD34                             DisplayString:
   8900 00CD34 08                           	PHP							; push reg settings
   8901 00CD35 E2 20                        	SEP		#$20				; ACC = 8 bit
                                           	MEM		8
   8903 00CD37 A0 00 00                     	LDY		#0
   8904 00CD3A                             .0002:
   8905 00CD3A 42 DA B3 04                  	LDA		FAR (4,S),Y
   8906 00CD3E F0 06                        	BEQ		.0001
   8907 00CD40 20 14 CD                     	JSR		OutChar
   8908 00CD43 C8                           	INY
   8909 00CD44 80 F4                        	BRA		.0002
   8910 00CD46                             .0001:
   8911 00CD46 28                           	PLP							; restore regs settings
                                           ;	REP		#$20				; ACC 16 bits
                                           	MEM		16
   8914 00CD47 42 C0 04                     	RTS		#4					; pop stack argument
                                           
   8916 00CD4A                             DisplayString2:
   8917 00CD4A 68                           	PLA							; pop return address
   8918 00CD4B FA                           	PLX							; get string address parameter
   8919 00CD4C 48                           	PHA							; push return address
   8920 00CD4D E2 20                        	SEP		#$20				; ACC = 8 bit
   8921 00CD4F 86 38                        	STX		StringPos
   8922 00CD51 A0 00 00                     	LDY		#0
   8923 00CD54 A2 32 00                     	LDX		#50
   8924 00CD57                             .0002:
   8925 00CD57 B1 38                        	LDA		(StringPos),Y
   8926 00CD59 20 14 CD                     	JSR		OutChar
   8927 00CD5C C8                           	INY
   8928 00CD5D CA                           	DEX
   8929 00CD5E D0 F7                        	BNE		.0002
   8930 00CD60                             .0001:
   8931 00CD60 C2 20                        	REP		#$20				; ACC 16 bits
   8932 00CD62 60                           	RTS
                                           
   8934 00CD63                             GetTextRowsCols:
   8935 00CD63 48                           	PHA
   8936 00CD64 5A                           	PHY
   8937 00CD65 A0 00 00                     	LDY		#0
   8938 00CD68 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8939 00CD6F 85 4C                        	STA		Textcols
   8940 00CD71 C8                           	INY
   8941 00CD72 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8942 00CD79 85 4E                        	STA		Textrows
   8943 00CD7B 7A                           	PLY
   8944 00CD7C 68                           	PLA
   8945 00CD7D 60                           	RTS
                                           
                                           ; .Y = register number to set
                                           ; Acc = value
                                           ;
   8950 00CD7E                             SetVideoReg:
   8951 00CD7E 08                           	PHP								; save regs size settings
   8952 00CD7F E2 20                        	SEP		#$20
   8953 00CD81 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8954 00CD86 28                           	PLP								; restore reg size settings
   8955 00CD87 60                           	RTS
                                           
   8957 00CD88                             CursorOn:
   8958 00CD88 48                           	PHA
   8959 00CD89 5A                           	PHY
   8960 00CD8A A0 09 00                     	LDY		#9
   8961 00CD8D A9 60 1F                     	LDA		#$1F60
   8962 00CD90 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8963 00CD95 7A                           	PLY
   8964 00CD96 68                           	PLA
   8965 00CD97 60                           	RTS
                                           
   8967 00CD98                             CursorOff:
   8968 00CD98 48                           	PHA
   8969 00CD99 5A                           	PHY
   8970 00CD9A A0 09 00                     	LDY		#9
   8971 00CD9D A9 20 00                     	LDA		#$0020
   8972 00CDA0 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8973 00CDA5 7A                           	PLY
   8974 00CDA6 68                           	PLA
   8975 00CDA7 60                           	RTS
                                           
   8977 00CDA8                             ClearScreen:
   8978 00CDA8                             .tstFocus:
   8979 00CDA8 42 20 D4 DF FD               	JCR		CheckIOFocus,OSctx
   8980 00CDAD D0 19                        	BNE		.noFocus
   8981 00CDAF A2 FF 0F                     	LDX		#4095
   8982 00CDB2 A0 00 00                     	LDY		#$00
   8983 00CDB5 A9 20 00                     	LDA		#' '
   8984 00CDB8 20 FA CA                     	JSR		AsciiToScreen
   8985 00CDBB 05 36                        	ORA		NormAttr
   8986 00CDBD                             .0001:
   8987 00CDBD 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8988 00CDC2 C8                           	INY
   8989 00CDC3 C8                           	INY
   8990 00CDC4 CA                           	DEX
   8991 00CDC5 D0 F6                        	BNE		.0001
   8992 00CDC7 60                           	RTS
   8993 00CDC8                             .noFocus:
   8994 00CDC8 42 20 64 E1 FD               	JCR		FMTK_ScheduleTask,OSctx	; Schedule another task
   8995 00CDCD 80 D9                        	BRA		.tstFocus
                                           
   8997 00CDCF                             ScrollUp:
   8998 00CDCF A0 00 00                     	LDY		#0				; .Y used as index to char
   8999 00CDD2 A2 2B 0A                     	LDX 	#2603			; number of chars on screen
   9000 00CDD5                             .0001:
   9001 00CDD5 5A                           	PHY						; save off current .Y
   9002 00CDD6 98                           	TYA								
   9003 00CDD7 18                           	CLC						; Add double the number of text
   9004 00CDD8 65 4C                        	ADC		Textcols		; columns to .Y to find start of next
   9005 00CDDA 18                           	CLC						; row 
   9006 00CDDB 65 4C                        	ADC		Textcols
   9007 00CDDD A8                           	TAY						
   9008 00CDDE 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y	; .A = Load buffer[textcols+Y]
   9009 00CDE3 7A                           	PLY						; .Y = restore current .Y
   9010 00CDE4 42 DA 42 97 40               	STA		FAR {Vidptr},Y	; Store .A in buffer[0+Y]
   9011 00CDE9 C8                           	INY						; advance to next character
   9012 00CDEA C8                           	INY						; decrement total char count
   9013 00CDEB CA                           	DEX
   9014 00CDEC D0 E7                        	BNE		.0001
   9015 00CDEE A5 4E                        	LDA		Textrows
   9016 00CDF0 3A                           	DEA
                                           
   9018 00CDF1                             BlankLine:
   9019 00CDF1 0A                           	ASL
   9020 00CDF2 A8                           	TAY
   9021 00CDF3 42 1B B9 FF E2               	LDA		CS:LineTbl,Y
   9022 00CDF8 0A                           	ASL
   9023 00CDF9 A8                           	TAY
   9024 00CDFA A6 4C                        	LDX		Textcols		; number of chars to clear
   9025 00CDFC A5 36                        	LDA		NormAttr
   9026 00CDFE 09 20 00                     	ORA		#$20			; space
   9027 00CE01                             .0001:
   9028 00CE01 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   9029 00CE06 C8                           	INY						; increment to next char
   9030 00CE07 C8                           	INY
   9031 00CE08 CA                           	DEX						; decrement number of chars
   9032 00CE09 D0 F6                        	BNE		.0001
   9033 00CE0B 60                           	RTS
                                           
   9035 00CE0C                             DispDWord:
   9036 00CE0C 42 EB                        	XBAW
   9037 00CE0E 20 13 CE                     	JSR		DispWord
   9038 00CE11 42 EB                        	XBAW
   9039 00CE13                             DispWord:
   9040 00CE13 EB                           	XBA
   9041 00CE14 20 18 CE                     	JSR		DispByte
   9042 00CE17 EB                           	XBA
   9043 00CE18                             DispByte:
   9044 00CE18 48                           	PHA
   9045 00CE19 4A                           	LSR
   9046 00CE1A 4A                           	LSR
   9047 00CE1B 4A                           	LSR
   9048 00CE1C 4A                           	LSR
   9049 00CE1D 20 21 CE                     	JSR		DispNybble
   9050 00CE20 68                           	PLA
   9051 00CE21                             DispNybble:
   9052 00CE21 48                           	PHA
   9053 00CE22 29 0F 00                     	AND		#$0F
   9054 00CE25 C9 0A 00                     	CMP		#10
   9055 00CE28 90 08                        	BCC		.0001
   9056 00CE2A 69 36 00                     	ADC		#'A'-11			; -11 cause the carry is set
   9057 00CE2D 20 14 CD                     	JSR		OutChar
   9058 00CE30 68                           	PLA
   9059 00CE31 60                           	RTS
   9060 00CE32                             .0001:
   9061 00CE32 09 30 00                     	ORA		#'0'
   9062 00CE35 20 14 CD                     	JSR		OutChar
   9063 00CE38 68                           	PLA
   9064 00CE39 60                           	RTS
                                           
   9066 00CE3A                             space:
   9067 00CE3A 48                           	PHA
   9068 00CE3B A9 20 00                     	LDA		#' '
   9069 00CE3E 20 14 CD                     	JSR		OutChar
   9070 00CE41 68                           	PLA
   9071 00CE42 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get a range (two hex numbers)
                                           ;------------------------------------------------------------------------------
                                           
   9077 00CE43                             GetRange:
   9078 00CE43 20 16 C9                     	JSR		IgnoreBlanks
   9079 00CE46 20 6E CE                     	JSR		GetHexNumber
   9080 00CE49 C0 00 00                     	CPY		#0
   9081 00CE4C F0 1F                        	BEQ		.0001
   9082 00CE4E A5 0C                        	LDA		NumWorkArea
   9083 00CE50 85 20                        	STA		RangeStart
   9084 00CE52 85 24                        	STA		RangeEnd
   9085 00CE54 A5 0E                        	LDA		NumWorkArea+2
   9086 00CE56 85 22                        	STA		RangeStart+2
   9087 00CE58 85 26                        	STA		RangeEnd+2
   9088 00CE5A 20 16 C9                     	JSR		IgnoreBlanks
   9089 00CE5D 20 6E CE                     	JSR		GetHexNumber
   9090 00CE60 C0 00 00                     	CPY		#0
   9091 00CE63 F0 08                        	BEQ		.0001
   9092 00CE65 A5 0C                        	LDA		NumWorkArea
   9093 00CE67 85 24                        	STA		RangeEnd
   9094 00CE69 A5 0E                        	LDA		NumWorkArea+2
   9095 00CE6B 85 26                        	STA		RangeEnd+2
   9096 00CE6D                             .0001:
   9097 00CE6D 60                           	RTS
                                           	
                                           ; Get a hexidecimal number. Maximum of six digits.
                                           ; .X = text pointer (updated)
                                           ;------------------------------------------------------------------------------
                                           ;
   9103 00CE6E                             GetHexNumber:
   9104 00CE6E A0 00 00                     	LDY		#0					; maximum of eight digits
   9105 00CE71 64 0C                        	STZ		NumWorkArea
   9106 00CE73 64 0E                        	STZ		NumWorkArea+2
   9107 00CE75                             gthxn2:
   9108 00CE75 20 D0 C2                     	JSR		MonGetch
   9109 00CE78 20 9B CE                     	JSR		AsciiToHexNybble
   9110 00CE7B 30 1B                        	BMI		gthxn1
   9111 00CE7D 06 0C                        	ASL		NumWorkArea
   9112 00CE7F 26 0E                        	ROL		NumWorkArea+2
   9113 00CE81 06 0C                        	ASL		NumWorkArea
   9114 00CE83 26 0E                        	ROL		NumWorkArea+2
   9115 00CE85 06 0C                        	ASL		NumWorkArea
   9116 00CE87 26 0E                        	ROL		NumWorkArea+2
   9117 00CE89 06 0C                        	ASL		NumWorkArea
   9118 00CE8B 26 0E                        	ROL		NumWorkArea+2
   9119 00CE8D 05 0C                        	ORA		NumWorkArea
   9120 00CE8F 85 0C                        	STA		NumWorkArea
   9121 00CE91 C8                           	INY
   9122 00CE92 C0 08 00                     	CPY		#8
   9123 00CE95 D0 DE                        	BNE		gthxn2
   9124 00CE97 60                           	RTS
   9125 00CE98                             gthxn1:
   9126 00CE98 CA                           	DEX
   9127 00CE99 CA                           	DEX
   9128 00CE9A 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert ASCII character in the range '0' to '9', 'a' to 'f' or 'A' to 'F'
                                           ; to a hex nybble.
                                           ;------------------------------------------------------------------------------
                                           ;
   9135 00CE9B                             AsciiToHexNybble:
   9136 00CE9B C9 30 00                     	CMP		#'0'
   9137 00CE9E 90 30                        	BCC		gthx3
   9138 00CEA0 C9 3A 00                     	CMP		#'9'+1
   9139 00CEA3 B0 05                        	BCS		gthx5
   9140 00CEA5 38                           	SEC
   9141 00CEA6 E9 30 00                     	SBC		#'0'
   9142 00CEA9 60                           	RTS
   9143 00CEAA                             gthx5:
   9144 00CEAA C9 41 00                     	CMP		#'A'
   9145 00CEAD 90 21                        	BCC		gthx3
   9146 00CEAF C9 47 00                     	CMP		#'F'+1
   9147 00CEB2 B0 09                        	BCS		gthx6
   9148 00CEB4 38                           	SEC
   9149 00CEB5 E9 41 00                     	SBC		#'A'
   9150 00CEB8 18                           	CLC
   9151 00CEB9 69 0A 00                     	ADC		#10
   9152 00CEBC 60                           	RTS
   9153 00CEBD                             gthx6:
   9154 00CEBD C9 61 00                     	CMP		#'a'
   9155 00CEC0 90 0E                        	BCC		gthx3
   9156 00CEC2 C9 7B 00                     	CMP		#'z'+1
   9157 00CEC5 B0 09                        	BCS		gthx3
   9158 00CEC7 38                           	SEC
   9159 00CEC8 E9 61 00                     	SBC		#'a'
   9160 00CECB 18                           	CLC
   9161 00CECC 69 0A 00                     	ADC		#10
   9162 00CECF 60                           	RTS
   9163 00CED0                             gthx3:
   9164 00CED0 A9 FF FF                     	LDA		#-1		; not a hex number
   9165 00CED3 60                           	RTS
                                           
   9167 00CED4                             AsciiToDecNybble:
   9168 00CED4 C9 30 00                     	CMP		#'0'
   9169 00CED7 90 0A                        	BCC		gtdc3
   9170 00CED9 C9 3A 00                     	CMP		#'9'+1
   9171 00CEDC B0 05                        	BCS		gtdc3
   9172 00CEDE 38                           	SEC
   9173 00CEDF E9 30 00                     	SBC		#'0'
   9174 00CEE2 60                           	RTS
   9175 00CEE3                             gtdc3:
   9176 00CEE3 A9 FF FF                     	LDA		#-1
   9177 00CEE6 60                           	RTS
                                           
   9179 00CEE7                             getcharNoWait:
   9180 00CEE7 A9 01 00                     	LDA		#1
   9181 00CEEA 42 5B 85 BC                  	STA		ZS:keybd_cmd
   9182 00CEEE 42 A2 06 00                  	TSK		#6
   9183 00CEF2 42 5B A5 BA                  	LDA		ZS:keybd_char
   9184 00CEF6 10 02                        	BPL		.0001
   9185 00CEF8 38                           	SEC
   9186 00CEF9 60                           	RTS
   9187 00CEFA                             .0001:
   9188 00CEFA 18                           	CLC
   9189 00CEFB 60                           	RTS
                                           
   9191 00CEFC                             getcharWait:
   9192 00CEFC A9 02 00                     	LDA		#2
   9193 00CEFF 42 5B 85 BC                  	STA		ZS:keybd_cmd
   9194 00CF03 42 A2 06 00                  	TSK		#6
   9195 00CF07 42 5B A5 BA                  	LDA		ZS:keybd_char
   9196 00CF0B 10 02                        	BPL		.0001
   9197 00CF0D 38                           	SEC
   9198 00CF0E 60                           	RTS
   9199 00CF0F                             .0001:
   9200 00CF0F 18                           	CLC
   9201 00CF10 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; Keyboard processing routines follow.
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   9208 00CF11                             ResetKbd:
   9209 00CF11 E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   9212 00CF13 64 08                        	STZ		KeyState1
   9213 00CF15 64 09                        	STZ		KeyState2
   9214 00CF17 A9 FF                        	LDA		#$FF
   9215 00CF19 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9216 00CF21 20 34 D0                     	JSR		KeybdWaitTx
   9217 00CF24 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9220 00CF26 60                           	RTS
   9221 00CF27                             KeybdInit:
   9222 00CF27 A9 00 20                     	LDA		#$2000
   9223 00CF2A 1B                           	TAS
   9224 00CF2B A9 05 00                     	LDA		#5
   9225 00CF2E 85 BC                        	STA		keybd_cmd
   9226 00CF30 E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   9229 00CF32 64 08                        	STZ		KeyState1
   9230 00CF34 64 09                        	STZ		KeyState2
   9231 00CF36 A0 0C                        	LDY		#12
   9232 00CF38 42 60                        	RTT
   9233 00CF3A                             .resetAgain:
   9234 00CF3A A9 FF                        	LDA		#$FF			; send reset code to keyboard
   9235 00CF3C 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9236 00CF44 20 34 D0                     	JSR		KeybdWaitTx
   9237 00CF47                             .0001:
   9238 00CF47 20 0F D0                     	JSR		KeybdRecvByte	; Look for $AA
   9239 00CF4A 90 5A                        	BCC		.tryAgain
   9240 00CF4C C9 AA                        	CMP		#$AA			;
   9241 00CF4E F0 37                        	BEQ		.config
   9242 00CF50                             .0002:
                                           	; wait until keyboard not busy
   9244 00CF50 20 52 D0                     	JSR		Wait10ms
   9245 00CF53 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		;
                                         
   9246 00CF5B 89 40                        	BIT		#$40
   9247 00CF5D D0 47                        	BNE		.tryAgain
   9248 00CF5F A9 FF                        	LDA		#$FF			; send reset code to keyboard
   9249 00CF61 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9250 00CF69 20 52 D0                     	JSR		Wait10ms
   9251 00CF6C 20 34 D0                     	JSR		KeybdWaitTx		; wait until no longer busy
   9252 00CF6F 20 0F D0                     	JSR		KeybdRecvByte	; look for an ACK ($FA)
   9253 00CF72 90 32                        	BCC		.tryAgain
   9254 00CF74 C9 FE                        	CMP		#$FE
   9255 00CF76 F0 2E                        	BEQ		.tryAgain
   9256 00CF78 C9 FA                        	CMP		#$FA
   9257 00CF7A D0 2A                        	BNE		.tryAgain
   9258 00CF7C 20 0F D0                     	JSR		KeybdRecvByte
   9259 00CF7F C9 FC                        	CMP		#$FC			; reset error ?
   9260 00CF81 F0 23                        	BEQ		.tryAgain
   9261 00CF83 C9 AA                        	CMP		#$AA			; reset complete okay ?
   9262 00CF85 D0 1F                        	BNE		.tryAgain
   9263 00CF87                             .config:
   9264 00CF87 20 34 D0                     	JSR		KeybdWaitBusy
   9265 00CF8A A9 F0                        	LDA		#$F0			; send scan code select
   9266 00CF8C 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9267 00CF94 20 34 D0                     	JSR		KeybdWaitTx
   9268 00CF97 90 0D                        	BCC		.tryAgain
   9269 00CF99 20 0F D0                     	JSR		KeybdRecvByte	; wait for response from keyboard
   9270 00CF9C 90 08                        	BCC		.tryAgain
   9271 00CF9E C9 FE                        	CMP		#$FE
   9272 00CFA0 F0 04                        	BEQ		.tryAgain
   9273 00CFA2 C9 FA                        	CMP		#$FA
   9274 00CFA4 F0 16                        	BEQ		.0004
   9275 00CFA6                             .tryAgain:
   9276 00CFA6 88                           	DEY
   9277 00CFA7 D0 9E                        	BNE		.0001
   9278 00CFA9 C6 BC                        	DEC		keybd_cmd
   9279 00CFAB D0 8D                        	BNE		.resetAgain
   9280 00CFAD                             .keybdErr:
   9281 00CFAD C2 30                        	REP		#$30
   9282 00CFAF F4 01 00                     	PEA		1
   9283 00CFB2 F4 6A D0                     	PEA		msgKeybdNR
   9284 00CFB5 20 34 CD                     	JSR		DisplayString
   9285 00CFB8 42 60                        	RTT
   9286 00CFBA 80 1A                        	BRA		KeybdService
   9287 00CFBC                             .0004:
   9288 00CFBC A9 02                        	LDA		#2				; select scan code set #2
   9289 00CFBE 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9290 00CFC6 20 34 D0                     	JSR		KeybdWaitTx
   9291 00CFC9 90 DB                        	BCC		.tryAgain
   9292 00CFCB 20 0F D0                     	JSR		KeybdRecvByte
   9293 00CFCE 90 D6                        	BCC		.tryAgain
   9294 00CFD0 C2 30                        	REP		#$30
   9295 00CFD2 42 60                        	RTT
   9296 00CFD4 80 00                        	BRA		KeybdService
                                           
   9298 00CFD6                             KeybdService:
   9299 00CFD6 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9302 00CFD8 A9 00 20                     	LDA		#$2000
   9303 00CFDB 1B                           	TAS
   9304 00CFDC A5 BC                        	LDA		keybd_cmd
   9305 00CFDE C9 01 00                     	CMP		#1
   9306 00CFE1 D0 18                        	BNE		.0001
   9307 00CFE3 20 8D D0                     	JSR		KeybdGetCharNoWait
   9308 00CFE6 B0 08                        	BCS		.nokey
   9309 00CFE8 64 BC                        	STZ		keybd_cmd
   9310 00CFEA 85 BA                        	STA		keybd_char
   9311 00CFEC 42 60                        	RTT
   9312 00CFEE 80 E6                        	BRA		KeybdService
   9313 00CFF0                             .nokey
   9314 00CFF0 A9 FF FF                     	LDA		#-1
   9315 00CFF3 64 BC                        	STZ		keybd_cmd
   9316 00CFF5 85 BA                        	STA		keybd_char
   9317 00CFF7 42 60                        	RTT
   9318 00CFF9 80 DB                        	BRA		KeybdService
   9319 00CFFB                             .0001:
   9320 00CFFB C9 02 00                     	CMP		#2
   9321 00CFFE D0 0B                        	BNE		.0002
   9322 00D000 20 A9 D0                     	JSR		KeybdGetCharWait
   9323 00D003 64 BC                        	STZ		keybd_cmd
   9324 00D005 85 BA                        	STA		keybd_char
   9325 00D007 42 60                        	RTT
   9326 00D009 80 CB                        	BRA		KeybdService
   9327 00D00B                             .0002:
   9328 00D00B 42 60                        	RTT
   9329 00D00D 80 C7                        	BRA		KeybdService
                                           
                                           	MEM		8
                                           	NDX		8
                                           
                                           ; Receive a byte from the keyboard, used after a command is sent to the
                                           ; keyboard in order to wait for a response.
                                           ;
   9337 00D00F                             KeybdRecvByte:
   9338 00D00F 5A                           	PHY
   9339 00D010 A0 14                        	LDY		#20				; wait up to .2s
   9340 00D012                             .0003:
   9341 00D012 20 34 D0                     	JSR		KeybdWaitBusy
   9342 00D015 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1	; wait for response from keyboard
                                         
   9343 00D01D 0A                           	ASL						; is input buffer full ?
   9344 00D01E B0 09                        	BCS		.0004			; yes, branch
   9345 00D020 20 52 D0                     	JSR		Wait10ms		; wait a bit
   9346 00D023 88                           	DEY
   9347 00D024 D0 EC                        	BNE		.0003			; go back and try again
   9348 00D026 7A                           	PLY						; timeout
   9349 00D027 18                           	CLC						; carry clear = no code
   9350 00D028 60                           	RTS
   9351 00D029                             .0004:
   9352 00D029 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD		; clear recieve state
                                         
   9353 00D031 7A                           	PLY
   9354 00D032 38                           	SEC						; carry set = code available
   9355 00D033 60                           	RTS
                                           
                                           ; Wait until the keyboard isn't busy anymore
                                           ; Wait until the keyboard transmit is complete
                                           ; Returns .CF = 1 if successful, .CF=0 timeout
                                           ;
   9361 00D034                             KeybdWaitBusy:				; alias for KeybdWaitTx
   9362 00D034                             KeybdWaitTx:
   9363 00D034 48                           	PHA
   9364 00D035 5A                           	PHY
   9365 00D036 A0 0A                        	LDY		#10				; wait a max of .1s
   9366 00D038                             .0001:
   9367 00D038 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1
                                         
   9368 00D040 89 40                        	BIT		#$40			; check for transmit busy bit
   9369 00D042 F0 0A                        	BEQ		.0002			; branch if bit clear
   9370 00D044 20 52 D0                     	JSR		Wait10ms		; delay a little bit
   9371 00D047 88                           	DEY						; go back and try again
   9372 00D048 D0 EE                        	BNE		.0001
   9373 00D04A 7A                           	PLY						; timed out
   9374 00D04B 68                           	PLA
   9375 00D04C 18                           	CLC						; return carry clear
   9376 00D04D 60                           	RTS
   9377 00D04E                             .0002:
   9378 00D04E 7A                           	PLY						; wait complete, return 
   9379 00D04F 68                           	PLA
   9380 00D050 38                           	SEC						; carry set
   9381 00D051 60                           	RTS
                                           
                                           ; Wait approximately 10ms. Used by keyboard routines. Makes use of the free
                                           ; running counter #0.
                                           ; .A = trashed (=-5)
                                           ;
   9387 00D052                             Wait10ms:
   9388 00D052 48                           	PHA
   9389 00D053 DA                           	PHX				; save .X
   9390 00D054 42 5B A5 12                  	LDA		ZS:CNT0H	; get starting count
   9391 00D058 AA                           	TAX				; save it off in .X
   9392 00D059                             .0002:
   9393 00D059 38                           	SEC				; compare to current counter value
   9394 00D05A 42 5B E5 12                  	SBC		ZS:CNT0H
   9395 00D05E 49 FF                        	EOR		#$FF	; make negative
   9396 00D060 C9 0A                        	CMP		#10
   9397 00D062 10 03                        	BPL     .0001
   9398 00D064 8A                           	TXA				; prepare for next check, get startcount in .A
   9399 00D065 80 F2                        	BRA		.0002	; go back if less than 5 ticks
   9400 00D067                             .0001:
   9401 00D067 FA                           	PLX				; restore .X
   9402 00D068 68                           	PLA
   9403 00D069 60                           	RTS
                                           
                                           	MEM		16
                                           	NDX		16
                                           
   9408 00D06A                             msgKeybdNR:
   9409 00D06A 0D 0A 4B 65 79 62 6F 61      	.byte	CR,LF,"Keyboard not responding.",CR,LF,0
   9409 00D072 72 64 20 6E 6F 74 20 72    
   9409 00D07A 65 73 70 6F 6E 64 69 6E    
   9409 00D082 67 2E 0D 0A 00             
                                           
                                           	cpu		FT832
                                           
   9413 00D087                             KeybdGetCharNoWaitCtx:
   9414 00D087 20 8D D0                     	JSR		KeybdGetCharNoWait
   9415 00D08A 42 40 00                     	RTC		#0
   9416 00D08D                             	
   9417 00D08D 08                           	PHP
   9418 00D08E 42 78 01                     	SEI		#1
   9419 00D091 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9422 00D093 42 20 D4 DF FD               	JCR		CheckIOFocus,OSctx
   9423 00D098 D0 0B                        	BNE		.noFocus
   9424 00D09A E2 20                        	SEP		#$20
   9425 00D09C C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
                                           ;	STZ		TaskSwitchEn
   9429 00D09E 58                           	CLI
   9430 00D09F A9 00                        	LDA		#0
   9431 00D0A1 85 0B                        	STA		KeybdWaitFlag
   9432 00D0A3 80 14                        	BRA		KeybdGetChar1
   9433 00D0A5                             .noFocus:
   9434 00D0A5 58                           	CLI
   9435 00D0A6 28                           	PLP
   9436 00D0A7 38                           	SEC		; flag no key available
   9437 00D0A8 60                           	RTS
                                           
   9439 00D0A9                             KeybdGetCharWait:
   9440 00D0A9 08                           	PHP
   9441 00D0AA E2 20                        	SEP		#$20
   9442 00D0AC C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9445 00D0AE A9 FF                        	LDA		#$FF
   9446 00D0B0 85 0B                        	STA		KeybdWaitFlag
   9447 00D0B2 80 05                        	BRA		KeybdGetChar1
                                           
                                           ; Wait for a keyboard character to be available
                                           ; Returns (CF=1) if no key available
                                           ; Return key (CF=0) if key is available
                                           ;
                                           ;
   9454 00D0B4                             KeybdGetChar:
   9455 00D0B4 08                           	PHP
   9456 00D0B5 E2 20                        	SEP		#$20		; 8 bit acc
   9457 00D0B7 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9460 00D0B9                             KeybdGetChar1:
   9461 00D0B9 DA                           	PHX
   9462 00D0BA EB                           	XBA					; force .B to zero for TAX
   9463 00D0BB A9 00                        	LDA		#0
   9464 00D0BD EB                           	XBA
   9465 00D0BE                             .0002:
   9466 00D0BE                             .0003:
   9467 00D0BE 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		; check MSB of keyboard status reg.
                                         
   9468 00D0C6 2A                           	ROL
   9469 00D0C7 2A                           	ROL
   9470 00D0C8 B0 0B                        	BCS		.0011		; check busy flag, branch if busy
   9471 00D0CA 6A                           	ROR
   9472 00D0CB B0 0F                        	BCS		.0006		; branch if keystroke ready
   9473 00D0CD 24 0B                        	BIT		KeybdWaitFlag
   9474 00D0CF 30 04                        	BMI		.0011
   9475 00D0D1 FA                           	PLX
   9476 00D0D2 28                           	PLP
   9477 00D0D3 38                           	SEC
   9478 00D0D4 60                           	RTS
   9479 00D0D5                             .0011:
   9480 00D0D5 42 20 64 E1 FD               	JCR		FMTK_ScheduleTask,OSctx	; go run something else for a bit
   9481 00D0DA 80 E2                        	BRA		.0003
   9482 00D0DC                             .0006:
   9483 00D0DC 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD	; get scan code value
                                         
   9484 00D0E4 42 3B FF 0F 42 9C 12 A1      	STZ		$FFF:KEYBD+2	; clear read flag
   9484 00D0EC 0E 00                      
                                           	;REP		#$20
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;SEP		#$20
   9489 00D0EE                             .0001:
   9490 00D0EE C9 F0                        	CMP		#SC_KEYUP	; keyup scan code ?
   9491 00D0F0 F0 FF 6F 00                  	LBEQ	.doKeyup	; 
   9492 00D0F4 C9 E0                        	CMP		#SC_EXTEND	; extended scan code ?
   9493 00D0F6 F0 FF 70 00                  	LBEQ	.doExtend
   9494 00D0FA C9 14                        	CMP		#$14		; control ?
   9495 00D0FC F0 FF 73 00                  	LBEQ	.doCtrl
   9496 00D100 C9 12                        	CMP		#$12		; left shift
   9497 00D102 F0 FF 7D 00                  	LBEQ	.doShift
   9498 00D106 C9 59                        	CMP		#$59		; right shift
   9499 00D108 F0 FF 77 00                  	LBEQ	.doShift
   9500 00D10C C9 77                        	CMP		#SC_NUMLOCK
   9501 00D10E F0 FF 81 00                  	LBEQ	.doNumLock
   9502 00D112 C9 58                        	CMP		#SC_CAPSLOCK
   9503 00D114 F0 FF 8B 00                  	LBEQ	.doCapsLock
   9504 00D118 C9 7E                        	CMP		#SC_SCROLLLOCK
   9505 00D11A F0 FF 95 00                  	LBEQ	.doScrollLock
   9506 00D11E 46 08                        	LSR		KeyState1
   9507 00D120 B0 9C                        	BCS		.0003
   9508 00D122 AA                           	TAX
   9509 00D123 A9 80                        	LDA		#$80
   9510 00D125 24 09                        	BIT		KeyState2	; Is extended code ?
   9511 00D127 F0 13                        	BEQ		.0010
   9512 00D129 A9 7F                        	LDA		#$7F
   9513 00D12B 25 09                        	AND		KeyState2
   9514 00D12D 85 09                        	STA		KeyState2
   9515 00D12F 46 08                        	LSR		KeyState1	; clear keyup
   9516 00D131 8A                           	TXA
   9517 00D132 29 7F                        	AND		#$7F
   9518 00D134 AA                           	TAX
   9519 00D135 42 1B BD 90 D4               	LDA		cs:keybdExtendedCodes,X
   9520 00D13A 80 23                        	BRA		.0008
   9521 00D13C                             .0010:
   9522 00D13C A9 04                        	LDA		#4
   9523 00D13E 24 09                        	BIT		KeyState2	; Is Cntrl down ?
   9524 00D140 F0 0B                        	BEQ		.0009
   9525 00D142 8A                           	TXA
   9526 00D143 29 7F                        	AND		#$7F		; table is 128 chars
   9527 00D145 AA                           	TAX
   9528 00D146 42 1B BD 10 D4               	LDA		cs:keybdControlCodes,X
   9529 00D14B 80 12                        	BRA		.0008
   9530 00D14D                             .0009:
   9531 00D14D A9 01                        	LDA		#$1			; Is shift down ?
   9532 00D14F 24 09                        	BIT		KeyState2
   9533 00D151 F0 07                        	BEQ		.0007
   9534 00D153 42 1B BD 10 D3               	LDA		cs:shiftedScanCodes,X
   9535 00D158 80 05                        	BRA		.0008
   9536 00D15A                             .0007:
   9537 00D15A 42 1B BD 10 D2               	LDA		cs:unshiftedScanCodes,X
   9538 00D15F                             .0008:
   9539 00D15F FA                           	PLX
   9540 00D160 28                           	PLP
   9541 00D161 18                           	CLC
   9542 00D162 60                           	RTS
                                           	MEM		8
   9544 00D163                             .doKeyup:
   9545 00D163 A9 01                        	LDA		#1
   9546 00D165 04 08                        	TSB		KeyState1
   9547 00D167 82 54 FF                     	BRL		.0003
   9548 00D16A                             .doExtend:				; set extended key flag
   9549 00D16A A5 09                        	LDA		KeyState2
   9550 00D16C 09 80                        	ORA		#$80
   9551 00D16E 85 09                        	STA		KeyState2
   9552 00D170 82 4B FF                     	BRL		.0003
   9553 00D173                             .doCtrl:
   9554 00D173 A9 04                        	LDA		#4
   9555 00D175 46 08                        	LSR		KeyState1	; check key up/down	
   9556 00D177 90 05                        	BCC		.0004		; keydown = carry clear
   9557 00D179 14 09                        	TRB		KeyState2
   9558 00D17B 82 40 FF                     	BRL		.0003
   9559 00D17E                             .0004:
   9560 00D17E 04 09                        	TSB		KeyState2	; set control active bit
   9561 00D180 82 3B FF                     	BRL		.0003
   9562 00D183                             .doShift:
   9563 00D183 A9 01                        	LDA		#1
   9564 00D185 46 08                        	LSR		KeyState1	; check key up/down	
   9565 00D187 90 05                        	BCC		.0005
   9566 00D189 14 09                        	TRB		KeyState2
   9567 00D18B 82 30 FF                     	BRL		.0003
   9568 00D18E                             .0005:
   9569 00D18E 04 09                        	TSB		KeyState2
   9570 00D190 82 2B FF                     	BRL		.0003
   9571 00D193                             .doNumLock:
   9572 00D193 A5 09                        	LDA		KeyState2
   9573 00D195 49 10                        	EOR		#16
   9574 00D197 85 09                        	STA		KeyState2
   9575 00D199 E2 30                        	SEP		#$30
   9576 00D19B 20 C3 D1                     	JSR		KeybdSetLEDStatus
   9577 00D19E C2 20                        	REP		#$20
   9578 00D1A0 82 1B FF                     	BRL		.0003
   9579 00D1A3                             .doCapsLock:
   9580 00D1A3 A5 09                        	LDA		KeyState2
   9581 00D1A5 49 20                        	EOR		#32
   9582 00D1A7 85 09                        	STA		KeyState2
   9583 00D1A9 E2 30                        	SEP		#$30
   9584 00D1AB 20 C3 D1                     	JSR		KeybdSetLEDStatus
   9585 00D1AE C2 20                        	REP		#$20
   9586 00D1B0 82 0B FF                     	BRL		.0003
   9587 00D1B3                             .doScrollLock:
   9588 00D1B3 A5 09                        	LDA		KeyState2
   9589 00D1B5 49 40                        	EOR		#64
   9590 00D1B7 85 09                        	STA		KeyState2
   9591 00D1B9 E2 30                        	SEP		#$30
   9592 00D1BB 20 C3 D1                     	JSR		KeybdSetLEDStatus
   9593 00D1BE C2 20                        	REP		#$20
   9594 00D1C0 82 FB FE                     	BRL		.0003
                                           
   9596 00D1C3                             KeybdSetLEDStatus:
                                           ;	PHDS				; save off DS
                                           ;	PEA		5			; set DS to zero
                                           ;	PLDS
   9600 00D1C3 A9 00                        	LDA		#0
   9601 00D1C5 85 0A                        	STA		KeybdLEDs
   9602 00D1C7 A9 10                        	LDA		#16
   9603 00D1C9 24 09                        	BIT		KeyState2
   9604 00D1CB F0 06                        	BEQ		.0002
   9605 00D1CD A5 0A                        	LDA		KeybdLEDs	; set bit 1 for Num lock, 0 for scrolllock , 2 for caps lock
   9606 00D1CF 09 02                        	ORA		#$2
   9607 00D1D1 85 0A                        	STA		KeybdLEDs
   9608 00D1D3                             .0002:
   9609 00D1D3 A9 20                        	LDA		#32
   9610 00D1D5 24 09                        	BIT		KeyState2
   9611 00D1D7 F0 06                        	BEQ		.0003
   9612 00D1D9 A5 0A                        	LDA		KeybdLEDs
   9613 00D1DB 09 04                        	ORA		#$4
   9614 00D1DD 85 0A                        	STA		KeybdLEDs
   9615 00D1DF                             .0003:
   9616 00D1DF A9 40                        	LDA		#64
   9617 00D1E1 24 09                        	BIT		KeyState2
   9618 00D1E3 F0 06                        	BEQ		.0004
   9619 00D1E5 A5 0A                        	LDA		KeybdLEDs
   9620 00D1E7 09 01                        	ORA		#1
   9621 00D1E9 85 0A                        	STA		KeybdLEDs
   9622 00D1EB                             .0004:
   9623 00D1EB A9 ED                        	LDA		#$ED		; set status LEDs command
   9624 00D1ED 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9625 00D1F5 20 34 D0                     	JSR		KeybdWaitTx
   9626 00D1F8 20 0F D0                     	JSR		KeybdRecvByte
   9627 00D1FB 90 12                        	BCC		.0001
   9628 00D1FD C9 FA                        	CMP		#$FA
   9629 00D1FF A5 0A                        	LDA		KeybdLEDs
   9630 00D201 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9631 00D209 20 34 D0                     	JSR		KeybdWaitTx
   9632 00D20C 20 0F D0                     	JSR		KeybdRecvByte	; wait for $FA byte
   9633 00D20F                             .0001:
                                           ;	PLDS				; recover DS
   9635 00D20F 60                           	RTS
                                           
                                           
                                           	;--------------------------------------------------------------------------
                                           	; PS2 scan codes to ascii conversion tables.
                                           	;--------------------------------------------------------------------------
                                           	;
   9642 00D210                             unshiftedScanCodes:
   9643 00D210 2E A9 2E A5 A3 A1 A2 AC      	.byte	$2e,$a9,$2e,$a5,$a3,$a1,$a2,$ac
                                         
   9644 00D218 2E AA A8 A6 A4 09 60 2E      	.byte	$2e,$aa,$a8,$a6,$a4,$09,$60,$2e
                                         
   9645 00D220 2E 2E 2E 2E 2E 71 31 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$71,$31,$2e
                                         
   9646 00D228 2E 2E 7A 73 61 77 32 2E      	.byte	$2e,$2e,$7a,$73,$61,$77,$32,$2e
                                         
   9647 00D230 2E 63 78 64 65 34 33 2E      	.byte	$2e,$63,$78,$64,$65,$34,$33,$2e
                                         
   9648 00D238 2E 20 76 66 74 72 35 2E      	.byte	$2e,$20,$76,$66,$74,$72,$35,$2e
                                         
   9649 00D240 2E 6E 62 68 67 79 36 2E      	.byte	$2e,$6e,$62,$68,$67,$79,$36,$2e
                                         
   9650 00D248 2E 2E 6D 6A 75 37 38 2E      	.byte	$2e,$2e,$6d,$6a,$75,$37,$38,$2e
                                         
   9651 00D250 2E 2C 6B 69 6F 30 39 2E      	.byte	$2e,$2c,$6b,$69,$6f,$30,$39,$2e
                                         
   9652 00D258 2E 2E 2F 6C 3B 70 2D 2E      	.byte	$2e,$2e,$2f,$6c,$3b,$70,$2d,$2e
                                         
   9653 00D260 2E 2E 27 2E 5B 3D 2E 2E      	.byte	$2e,$2e,$27,$2e,$5b,$3d,$2e,$2e
                                         
   9654 00D268 AD 2E 0D 5D 2E 5C 2E 2E      	.byte	$ad,$2e,$0d,$5d,$2e,$5c,$2e,$2e
                                         
   9655 00D270 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9656 00D278 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9657 00D280 98 7F 92 2E 91 90 1B AF      	.byte	$98,$7f,$92,$2e,$91,$90,$1b,$af
                                         
   9658 00D288 AB 2E 97 2E 2E 96 AE 2E      	.byte	$ab,$2e,$97,$2e,$2e,$96,$ae,$2e
                                         
                                           
   9660 00D290 2E 2E 2E A7 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$a7,$2e,$2e,$2e,$2e
                                         
   9661 00D298 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9662 00D2A0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9663 00D2A8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9664 00D2B0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9665 00D2B8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9666 00D2C0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9667 00D2C8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9668 00D2D0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9669 00D2D8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9670 00D2E0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9671 00D2E8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9672 00D2F0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9673 00D2F8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9674 00D300 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9675 00D308 2E 2E FA 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$fa,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9677 00D310                             shiftedScanCodes:
   9678 00D310 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9679 00D318 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9680 00D320 2E 2E 2E 2E 2E 51 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$51,$21,$2e
                                         
   9681 00D328 2E 2E 5A 53 41 57 40 2E      	.byte	$2e,$2e,$5a,$53,$41,$57,$40,$2e
                                         
   9682 00D330 2E 43 58 44 45 24 23 2E      	.byte	$2e,$43,$58,$44,$45,$24,$23,$2e
                                         
   9683 00D338 2E 20 56 46 54 52 25 2E      	.byte	$2e,$20,$56,$46,$54,$52,$25,$2e
                                         
   9684 00D340 2E 4E 42 48 47 59 5E 2E      	.byte	$2e,$4e,$42,$48,$47,$59,$5e,$2e
                                         
   9685 00D348 2E 2E 4D 4A 55 26 2A 2E      	.byte	$2e,$2e,$4d,$4a,$55,$26,$2a,$2e
                                         
   9686 00D350 2E 3C 4B 49 4F 29 28 2E      	.byte	$2e,$3c,$4b,$49,$4f,$29,$28,$2e
                                         
   9687 00D358 2E 3E 3F 4C 3A 50 5F 2E      	.byte	$2e,$3e,$3f,$4c,$3a,$50,$5f,$2e
                                         
   9688 00D360 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9689 00D368 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9690 00D370 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9691 00D378 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9692 00D380 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9693 00D388 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9695 00D390 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9696 00D398 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9697 00D3A0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9698 00D3A8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9699 00D3B0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9700 00D3B8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9701 00D3C0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9702 00D3C8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9703 00D3D0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9704 00D3D8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9705 00D3E0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9706 00D3E8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9707 00D3F0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9708 00D3F8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9709 00D400 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9710 00D408 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
                                           ; control
   9713 00D410                             keybdControlCodes:
   9714 00D410 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9715 00D418 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9716 00D420 2E 2E 2E 2E 2E 11 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$11,$21,$2e
                                         
   9717 00D428 2E 2E 1A 13 01 17 40 2E      	.byte	$2e,$2e,$1a,$13,$01,$17,$40,$2e
                                         
   9718 00D430 2E 03 18 04 05 24 23 2E      	.byte	$2e,$03,$18,$04,$05,$24,$23,$2e
                                         
   9719 00D438 2E 20 16 06 14 12 25 2E      	.byte	$2e,$20,$16,$06,$14,$12,$25,$2e
                                         
   9720 00D440 2E 0E 02 08 07 19 5E 2E      	.byte	$2e,$0e,$02,$08,$07,$19,$5e,$2e
                                         
   9721 00D448 2E 2E 0D 0A 15 26 2A 2E      	.byte	$2e,$2e,$0d,$0a,$15,$26,$2a,$2e
                                         
   9722 00D450 2E 3C 0B 09 0F 29 28 2E      	.byte	$2e,$3c,$0b,$09,$0f,$29,$28,$2e
                                         
   9723 00D458 2E 3E 3F 0C 3A 10 5F 2E      	.byte	$2e,$3e,$3f,$0c,$3a,$10,$5f,$2e
                                         
   9724 00D460 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9725 00D468 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9726 00D470 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9727 00D478 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9728 00D480 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9729 00D488 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9731 00D490                             keybdExtendedCodes:
   9732 00D490 2E 2E 2E 2E A3 A1 A2 2E      	.byte	$2e,$2e,$2e,$2e,$a3,$a1,$a2,$2e
                                         
   9733 00D498 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9734 00D4A0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9735 00D4A8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9736 00D4B0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9737 00D4B8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9738 00D4C0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9739 00D4C8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9740 00D4D0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9741 00D4D8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9742 00D4E0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9743 00D4E8 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9744 00D4F0 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9745 00D4F8 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9746 00D500 98 99 92 2E 91 90 2E 2E      	.byte	$98,$99,$92,$2e,$91,$90,$2e,$2e
                                         
   9747 00D508 2E 2E 97 2E 2E 96 2E 2E      	.byte	$2e,$2e,$97,$2e,$2e,$96,$2e,$2e
                                         
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; SPI MASTER driver
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ; spi_master_init
                                           ; Initialize the spi master controller
                                           
   9758 00D510                             spi_master_init:
   9759 00D510 08                           	
   9760 00D511 E2 20                        	SEP		#$20
                                           	MEM		8
   9762 00D513 A9 01                        	LDA		#SPI_INIT_SD
   9763 00D515 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9764 00D519 A9 01                        	LDA		#SPI_TRANS_START
   9765 00D51B 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9766 00D51F                             .0001:
   9767 00D51F AF 04 C0 FE                  	LDA		SPI_TRANS_STATUS_REG	; wait for SPI transfer to complete
   9768 00D523 C9 01                        	CMP		#SPI_TRANS_BUSY
   9769 00D525 F0 F8                        	BEQ		.0001
   9770 00D527 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9771 00D52B 29 03                        	AND		#3	; INIT errors
   9772 00D52D C9 00                        	CMP		#SPI_INIT_NO_ERROR
   9773 00D52F F0 0E                        	BEQ		.0004
   9774 00D531 28                           	PLP
                                           	MEM		16
                                           	NDX		16
   9777 00D532 F4 01 00                     	PEA		1
   9778 00D535 F4 31 D6                     	PEA		msgSpiInitError
   9779 00D538 20 34 CD                     	JSR		DisplayString
   9780 00D53B A9 01 00                     	LDA		#1
   9781 00D53E 60                           	RTS
   9782 00D53F                             .0004:
   9783 00D53F 28                           	PLP
                                           	;PEA		1
                                           	;PEA		msgSpiInited
                                           	;JSR		DisplayString
   9787 00D540 A9 00 00                     	LDA		#0
   9788 00D543 60                           	RTS
                                           
                                           ; spi_master_read
                                           ; read a block from the SD card
                                           ;
                                           ; Parameters:
                                           ;	32 bit buffer address pushed onto stack
                                           ;	32 bit block number pushed onto stack
                                           ;
   9797 00D544                             spi_master_read:
   9798 00D544 08                           	PHP
   9799 00D545 E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
   9802 00D547 BA                           	TSX
   9803 00D548 B5 04                        	LDA		4,X
   9804 00D54A 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9805 00D54E B5 05                        	LDA		5,X
   9806 00D550 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9807 00D554 B5 06                        	LDA		6,X
   9808 00D556 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9809 00D55A B5 07                        	LDA		7,X
   9810 00D55C 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
   9811 00D560 B5 08                        	LDA		8,X
   9812 00D562 85 C8                        	STA		bufptr
   9813 00D564 B5 09                        	LDA		9,X
   9814 00D566 85 C9                        	STA		bufptr+1
   9815 00D568 B5 0A                        	LDA		10,X
   9816 00D56A 85 CA                        	STA		bufptr+2
   9817 00D56C B5 0B                        	LDA		11,X
   9818 00D56E 85 CB                        	STA		bufptr+3
   9819 00D570 A9 02                        	LDA		#SPI_RW_READ_SD_BLOCK
   9820 00D572 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9821 00D576 A9 01                        	LDA		#SPI_TRANS_START
   9822 00D578 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9823 00D57C                             .0001:
   9824 00D57C AF 04 C0 FE                  	LDA		SPI_TRANS_STATUS_REG		; wait for SPI transfer to complete
   9825 00D580 C9 01                        	CMP		#SPI_TRANS_BUSY
   9826 00D582 F0 F8                        	BEQ		.0001
   9827 00D584 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9828 00D588 4A                           	LSR
   9829 00D589 4A                           	LSR
   9830 00D58A 29 03                        	AND		#3	; INIT errors
   9831 00D58C C9 00                        	CMP		#SPI_READ_NO_ERROR
   9832 00D58E F0 10                        	BEQ		.0004
   9833 00D590 28                           	PLP
                                           	MEM		16
   9835 00D591 F4 01 00                     	PEA		1
   9836 00D594 F4 65 D6                     	PEA		msgSpiReadError
   9837 00D597 20 34 CD                     	JSR		DisplayString
   9838 00D59A A9 01 00                     	LDA		#1
   9839 00D59D 42 C0 08                     	RTS		#8
   9840 00D5A0                             .0004:
   9841 00D5A0 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9844 00D5A2 A2 00 02                     	LDX		#512
   9845 00D5A5 A0 00 00                     	LDY		#0
   9846 00D5A8                             .0003:
                                           	;TXA
                                           	;AND		#$0F
                                           	;BNE		.0002
                                           	;PLP
                                           	;JSR		OutCRLF
                                           	;PHP
                                           	;SEP		#$20
   9854 00D5A8                             .0002:
   9855 00D5A8 AF 10 C0 FE                  	LDA		SPI_RX_FIFO_DATA_REG
   9856 00D5AC 42 97 C8                     	STA		{bufptr},Y
   9857 00D5AF C8                           	INY
                                           	;PLP
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;PHP
   9862 00D5B0 E2 20                        	SEP		#$20
   9863 00D5B2 CA                           	DEX
   9864 00D5B3 D0 F3                        	BNE		.0003
   9865 00D5B5 28                           	PLP
                                           	;JSR		OutCRLF
                                           	MEM		16
                                           	NDX		16
   9869 00D5B6 A9 00 00                     	LDA		#0
   9870 00D5B9 42 C0 08                     	RTS		#8
                                           
   9872 00D5BC                             spi_master_write:
   9873 00D5BC 08                           	PHP
   9874 00D5BD E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
                                           
   9878 00D5BF BA                           	TSX
   9879 00D5C0 B5 08                        	LDA		8,X
   9880 00D5C2 85 C8                        	STA		bufptr
   9881 00D5C4 B5 09                        	LDA		9,X
   9882 00D5C6 85 C9                        	STA		bufptr+1
   9883 00D5C8 B5 0A                        	LDA		10,X
   9884 00D5CA 85 CA                        	STA		bufptr+2
   9885 00D5CC B5 0B                        	LDA		11,X
   9886 00D5CE 85 CB                        	STA		bufptr+3
                                           
   9888 00D5D0 A0 00 00                     	LDY		#0
   9889 00D5D3                             .0001:
   9890 00D5D3 42 B7 C8                     	LDA		{bufptr},Y
   9891 00D5D6 8F 20 C0 FE                  	STA		SPI_TX_FIFO_DATA_REG
   9892 00D5DA C8                           	INY
   9893 00D5DB C0 00 02                     	CPY		#512
   9894 00D5DE D0 F3                        	BNE		.0001
                                           
   9896 00D5E0 B5 04                        	LDA		4,X
   9897 00D5E2 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9898 00D5E6 B5 05                        	LDA		5,X
   9899 00D5E8 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9900 00D5EC B5 06                        	LDA		6,X
   9901 00D5EE 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9902 00D5F2 B5 07                        	LDA		7,X
   9903 00D5F4 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
                                           
   9905 00D5F8 A9 03                        	LDA		#SPI_RW_WRITE_SD_BLOCK
   9906 00D5FA 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9907 00D5FE A9 01                        	LDA		#SPI_TRANS_START
   9908 00D600 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9909 00D604                             .0002:
   9910 00D604 AF 04 C0 FE                  	LDA		SPI_TRANS_STATUS_REG		; wait for SPI transfer to complete
   9911 00D608 C9 01                        	CMP		#SPI_TRANS_BUSY
   9912 00D60A F0 F8                        	BEQ		.0002
   9913 00D60C AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9914 00D610 4A                           	LSR
   9915 00D611 4A                           	LSR
   9916 00D612 4A                           	LSR
   9917 00D613 4A                           	LSR
   9918 00D614 29 03                        	AND		#3	; write errors
   9919 00D616 C9 00                        	CMP		#SPI_WRITE_NO_ERROR
   9920 00D618 F0 10                        	BEQ		.0004
   9921 00D61A 28                           	PLP
                                           	MEM		16
   9923 00D61B F4 01 00                     	PEA		1
   9924 00D61E F4 76 D6                     	PEA		msgSpiWriteError
   9925 00D621 20 34 CD                     	JSR		DisplayString
   9926 00D624 A9 01 00                     	LDA		#1
   9927 00D627 42 C0 08                     	RTS		#8
   9928 00D62A                             .0004:
   9929 00D62A 28                           	PLP
   9930 00D62B A9 00 00                     	LDA		#0
   9931 00D62E 42 C0 08                     	RTS		#8
                                           
   9933 00D631                             msgSpiInitError:
   9934 00D631 45 72 72 6F 72 20 69 6E      .byte	"Error initializing SPI master",$0D,$0A,$00
   9934 00D639 69 74 69 61 6C 69 7A 69    
   9934 00D641 6E 67 20 53 50 49 20 6D    
   9934 00D649 61 73 74 65 72 0D 0A 00    
                                         
   9935 00D651                             msgSpiInited:
   9936 00D651 53 50 49 20 6D 61 73 74      .byte	"SPI master inited",$0D,$0A,$00
   9936 00D659 65 72 20 69 6E 69 74 65    
   9936 00D661 64 0D 0A 00                
   9937 00D665                             msgSpiReadError:
   9938 00D665 53 50 49 20 72 65 61 64      .byte	"SPI read error",$0D,$0A,$00
   9938 00D66D 20 65 72 72 6F 72 0D 0A    
   9938 00D675 00                         
   9939 00D676                             msgSpiWriteError:
   9940 00D676 53 50 49 20 77 72 69 74      .byte	"SPI write error",$0D,$0A,$00
   9940 00D67E 65 20 65 72 72 6F 72 0D    
   9940 00D686 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; RTC driver for MCP7941x
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
   9948 00D688                             rtc_init:
   9949 00D688 A9 11 00                     		LDA		#17					; constant for 400kHz I2C from 33MHz
   9950 00D68B 8F 00 C1 FE                  		STA		I2C_PRESCALE_LO
   9951 00D68F 60                           		RTS
                                           
                                           ; Read all the RTC sram registers into a buffer
                                           
   9955 00D690                             rtc_read:
   9956 00D690 08                           		PHP
   9957 00D691 E2 30                        		SEP		#$30
                                           		MEM		8
                                           		NDX		8
   9960 00D693 A9 80                        		LDA		#$80				; enable I2C
   9961 00D695 8F 02 C1 FE                  		STA		I2C_CONTROL
   9962 00D699 A9 DE                        		LDA		#$DE				; read address, write op
   9963 00D69B A0 90                        		LDY		#$90				; STA + wr bit
   9964 00D69D 20 00 D7                     		JSR		rtc_wr_cmd
   9965 00D6A0 30 4D                        		BMI		.rxerr
   9966 00D6A2 A9 00                        		LDA		#$00				; address zero
   9967 00D6A4 A0 10                        		LDY		#$10				; wr bit
   9968 00D6A6 20 00 D7                     		JSR		rtc_wr_cmd
   9969 00D6A9 30 44                        		BMI		.rxerr
   9970 00D6AB A9 DF                        		LDA		#$DF				; read address, read op
   9971 00D6AD A0 90                        		LDY		#$90				; STA + wr bit
   9972 00D6AF 20 00 D7                     		JSR		rtc_wr_cmd
   9973 00D6B2 30 3B                        		BMI		.rxerr
   9974 00D6B4 A2 00                        		LDX		#0
   9975 00D6B6                             .0001:
   9976 00D6B6 A9 20                        		LDA		#$20				; rd bit
   9977 00D6B8 8F 04 C1 FE                  		STA		I2C_CMD
   9978 00D6BC 20 F7 D6                     		JSR		rtc_wait_tip
   9979 00D6BF AF 04 C1 FE                  		LDA		I2C_STAT
   9980 00D6C3 30 2A                        		BMI		.rxerr
   9981 00D6C5 AF 03 C1 FE                  		LDA		I2C_RX
   9982 00D6C9 9D 00 03                     		STA		RTCBuf,X
   9983 00D6CC E8                           		INX
   9984 00D6CD E0 5F                        		CPX		#$5F
   9985 00D6CF D0 E5                        		BNE		.0001
   9986 00D6D1 A9 68                        		LDA		#$68				; STO, rd bit + nack
   9987 00D6D3 8F 04 C1 FE                  		STA		I2C_CMD
   9988 00D6D7 20 F7 D6                     		JSR		rtc_wait_tip
   9989 00D6DA AF 04 C1 FE                  		LDA		I2C_STAT
   9990 00D6DE 30 0F                        		BMI		.rxerr
   9991 00D6E0 AF 03 C1 FE                  		LDA		I2C_RX
   9992 00D6E4 9D 00 03                     		STA		RTCBuf,X
   9993 00D6E7 A9 00                        		LDA		#0					; disable I2C and return 0
   9994 00D6E9 8F 02 C1 FE                  		STA		I2C_CONTROL
   9995 00D6ED 28                           		PLP
   9996 00D6EE 60                           		RTS
   9997 00D6EF                             .rxerr:
   9998 00D6EF 42 9C 02 C1 FE 00            		STZ		I2C_CONTROL			; disable I2C and return status
   9999 00D6F5 28                           		PLP
  10000 00D6F6 60                           		RTS
                                           
  10002 00D6F7                             rtc_wait_tip:
  10003 00D6F7                             .0001:
  10004 00D6F7 AF 04 C1 FE                  		LDA		I2C_STAT
  10005 00D6FB 29 04                        		AND		#$4					; transmit in progress bit
  10006 00D6FD D0 F8                        		BNE		.0001
  10007 00D6FF 60                           		RTS
                                           
  10009 00D700                             rtc_wr_cmd:
  10010 00D700 8F 03 C1 FE                  		STA		I2C_TX
  10011 00D704 42 8C 04 C1 FE 00            		STY		I2C_CMD
  10012 00D70A 20 F7 D6                     		JSR		rtc_wait_tip
  10013 00D70D AF 04 C1 FE                  		LDA		I2C_STAT
  10014 00D711 60                           		RTS
                                           
  10016 00D712                             rtc_write:
  10017 00D712 08                           		PHP
  10018 00D713 E2 30                        		SEP		#$30
                                           		MEM		8
                                           		NDX		8
  10021 00D715 A9 80                        		LDA		#$80				; enable I2C
  10022 00D717 8F 02 C1 FE                  		STA		I2C_CONTROL
  10023 00D71B A9 DE                        		LDA		#$DE				; read address, write op
  10024 00D71D A0 90                        		LDY		#$90				; STA + wr bit
  10025 00D71F 20 00 D7                     		JSR		rtc_wr_cmd
  10026 00D722 30 2C                        		BMI		.rxerr
  10027 00D724 A9 00                        		LDA		#$00				; address zero
  10028 00D726 A0 10                        		LDY		#$10				; wr bit
  10029 00D728 20 00 D7                     		JSR		rtc_wr_cmd
  10030 00D72B 30 23                        		BMI		.rxerr
  10031 00D72D A2 00                        		LDX		#0
  10032 00D72F                             .0001:
  10033 00D72F BD 00 03                     		LDA		RTCBuf,X
  10034 00D732 A0 10                        		LDY		#$10
  10035 00D734 20 00 D7                     		JSR		rtc_wr_cmd
  10036 00D737 30 17                        		BMI		.rxerr
  10037 00D739 E8                           		INX
  10038 00D73A E0 5F                        		CPX		#$5F
  10039 00D73C D0 F1                        		BNE		.0001
  10040 00D73E BD 00 03                     		LDA		RTCBuf,X
  10041 00D741 A0 50                        		LDY		#$50				; STO, wr bit
  10042 00D743 20 00 D7                     		JSR		rtc_wr_cmd
  10043 00D746 30 08                        		BMI		.rxerr
  10044 00D748 A9 00                        		LDA		#0					; disable I2C and return 0
  10045 00D74A 8F 02 C1 FE                  		STA		I2C_CONTROL
  10046 00D74E 28                           		PLP
  10047 00D74F 60                           		RTS
  10048 00D750                             .rxerr:
  10049 00D750 42 9C 02 C1 FE 00            		STZ		I2C_CONTROL			; disable I2C and return status
  10050 00D756 28                           		PLP
  10051 00D757 60                           		RTS
                                           
  10053 00D758                             msgRtcReadFail:
  10054 00D758 52 54 43 20 72 65 61 64      	.byte	"RTC read/write failed.",$0D,$0A,$00
  10054 00D760 2F 77 72 69 74 65 20 66    
  10054 00D768 61 69 6C 65 64 2E 0D 0A    
  10054 00D770 00                         
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ; Get char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
                                           	MEM		16
                                           	NDX		16
  10066 00D771                             SuperGetch:
  10067 00D771 20 8D D0                     	JSR		KeybdGetCharNoWait
  10068 00D774 29 FF 00                     	AND		#$FF
  10069 00D777 6B                           	RTL
                                           
                                           ; Put char routine for Supermon
                                           ;
  10073 00D778                             SuperPutch:
  10074 00D778 20 14 CD                     	JSR		OutChar
  10075 00D77B 6B                           	RTL
                                           
  10077 00D77C                             warm_start:
  10078 00D77C 42 E2 00 01                  	SEP		#$100		; 16 bit mode
  10079 00D780 C2 30                        	REP		#$30		; 16 bit MEM,NDX
                                           	MEM		16
                                           	NDX		16
  10082 00D782 A9 FF 3F                     	LDA		#$3FFF
  10083 00D785 1B                           	TAS
  10084 00D786 20 88 CD                     	JSR		CursorOn
  10085 00D789 82 18 EA                     	BRL		Mon1
                                           
                                           	cpu		FT832
  10088 00D78C                             ICacheIL832:
  10089 00D78C 42 E0 01                     	CACHE	#1			; 1= invalidate instruction line identified by accumulator
  10090 00D78F 60                           	RTS
                                           
                                           ;============================================================================
                                           ;============================================================================
                                           ; SD Card COS
                                           ;============================================================================
                                           ;============================================================================
                                           
                                           ; "Format" the SD card. This basically just sets the BAM to zero indicating
                                           ; no allocated clusters, and zeros out the root directory
                                           ;
  10101 00D790                             SDC_Format:
  10102 00D790 A9 00 00                     	LDA		#0
  10103 00D793 A2 00 00                     	LDX		#0
  10104 00D796                             .zeroSector:
  10105 00D796 9F 00 00 0F                  	STA		$F0000,X
  10106 00D79A E8                           	INX
  10107 00D79B E0 00 02                     	CPX		#512
  10108 00D79E D0 F6                        	BNE		.zeroSector
  10109 00D7A0 A9 FF FF                     	LDA		#$FFFF				; the first 17 clusters are allocated
  10110 00D7A3 8F 00 00 0F                  	STA		$F0000				; for the BAM and root directory
  10111 00D7A7 A9 00 80                     	LDA		#$8000
  10112 00D7AA 8F 02 00 0F                  	STA		$F0002
                                           
  10114 00D7AE 20 10 D5                     	JSR		spi_master_init
  10115 00D7B1 64 C4                        	STZ		secnum				; set starting sector # to zero
  10116 00D7B3 64 C6                        	STZ		secnum+2
  10117 00D7B5                             .nextSector:
  10118 00D7B5 F4 0F 00                     	PEA		$000F				; push buffer address
  10119 00D7B8 F4 00 00                     	PEA		$0000
  10120 00D7BB A5 C6                        	LDA		secnum+2			; push sector number
  10121 00D7BD 48                           	PHA
  10122 00D7BE A5 C4                        	LDA		secnum
  10123 00D7C0 48                           	PHA
  10124 00D7C1 20 BC D5                     	JSR		spi_master_write
  10125 00D7C4 42 9C 00 00 0F 00            	STZ		$F0000
  10126 00D7CA 42 9C 02 00 0F 00            	STZ		$F0002
  10127 00D7D0 A5 C4                        	LDA		secnum
  10128 00D7D2 C9 87 00                     	CMP		#135
  10129 00D7D5 F0 04                        	BEQ		.doneFmt
  10130 00D7D7 E6 C4                        	INC		secnum
  10131 00D7D9 80 DA                        	BRA		.nextSector
  10132 00D7DB                             .doneFmt:
  10133 00D7DB 60                           	RTS
                                           
                                           ; Parameters
                                           ; .A = # of sectors to read
                                           ; starting sector number
                                           ; pointer to buffer
                                           ;
  10140 00D7DC                             SDC_Jmp:
  10141 00D7DC 6C F4 03                     	JMP		(spi_rw_vect)
                                           
  10143 00D7DF                             SDC_ReadWriteMultiple:
  10144 00D7DF 85 D2                        	STA		numsec
  10145 00D7E1 3B                           	TSA
  10146 00D7E2 38                           	SEC
  10147 00D7E3 E9 08 00                     	SBC		#8
  10148 00D7E6 1B                           	TAS
  10149 00D7E7 A3 0B                        	LDA		11,S
  10150 00D7E9 83 01                        	STA		1,S
  10151 00D7EB A3 0D                        	LDA		13,S
  10152 00D7ED 83 03                        	STA		3,S
  10153 00D7EF A3 0F                        	LDA		15,S
  10154 00D7F1 83 05                        	STA		5,S
  10155 00D7F3 A3 11                        	LDA		17,S
  10156 00D7F5 83 07                        	STA		7,S
  10157 00D7F7                             .nextSector:
  10158 00D7F7 20 DC D7                     	JSR		SDC_Jmp
  10159 00D7FA C9 00 00                     	CMP		#0
  10160 00D7FD D0 26                        	BNE		.abort
  10161 00D7FF 3B                           	TSA
  10162 00D800 38                           	SEC
  10163 00D801 E9 08 00                     	SBC		#8
  10164 00D804 1B                           	TAS
  10165 00D805 BA                           	TSX
                                           	; increment the starting sector #
  10167 00D806 F6 0B                        	INC		11,X
  10168 00D808 D0 02                        	BNE		.0001
  10169 00D80A F6 0D                        	INC		13,X
  10170 00D80C                             .0001:
  10171 00D80C 18                           	CLC
                                           	; increment buffer pointer by 512 bytes
  10173 00D80D F6 11                        	INC		17,X
  10174 00D80F F6 11                        	INC		17,X
                                           	; copy parameters back to stack
  10176 00D811 B5 0B                        	LDA		11,X
  10177 00D813 95 01                        	STA		1,X
  10178 00D815 B5 0D                        	LDA		13,X
  10179 00D817 95 03                        	STA		3,X
  10180 00D819 B5 0F                        	LDA		15,X
  10181 00D81B 95 05                        	STA		5,X
  10182 00D81D B5 11                        	LDA		17,X
  10183 00D81F 95 07                        	STA		7,X
  10184 00D821 C6 D2                        	DEC		numsec
  10185 00D823 D0 D2                        	BNE		.nextSector
  10186 00D825                             .abort:
  10187 00D825 42 C0 08                     	RTS		#8
                                           
  10189 00D828                             SDC_SaveRootDir:
  10190 00D828 A9 BC D5                     	LDA		#spi_master_write
  10191 00D82B 80 03                        	BRA		SDC_SRD1
  10192 00D82D                             SDC_LoadRootDir:
  10193 00D82D A9 44 D5                     	LDA		#spi_master_read	; flag an spi read
  10194 00D830                             SDC_SRD1:
  10195 00D830 8D F4 03                     	STA		spi_rw_vect
  10196 00D833 F4 0E 00                     	PEA		$000E				; directory buffer address = $EF000
  10197 00D836 F4 00 F0                     	PEA		$F000
  10198 00D839 F4 00 00                     	PEA		$0
  10199 00D83C A9 80 00                     	LDA		#128				; root directory is at sector 128
  10200 00D83F 48                           	PHA
  10201 00D840 A9 08 00                     	LDA		#8					; 8 sectors to load
  10202 00D843 20 DF D7                     	JSR		SDC_ReadWriteMultiple
  10203 00D846 60                           	RTS
                                           
  10205 00D847                             SDC_SaveBAM:
  10206 00D847 A9 BC D5                     	LDA		#spi_master_write
  10207 00D84A 80 03                        	BRA		SDC_SVB1
  10208 00D84C                             SDC_LoadBAM:
  10209 00D84C A9 44 D5                     	LDA		#spi_master_read
  10210 00D84F                             SDC_SVB1:
  10211 00D84F 8D F4 03                     	STA		spi_rw_vect
  10212 00D852 F4 0F 00                     	PEA		$000F
  10213 00D855 F4 00 00                     	PEA		$0000
  10214 00D858 F4 00 00                     	PEA		$0000				; BAM starts at sector zero
  10215 00D85B F4 00 00                     	PEA		$0000
  10216 00D85E A9 80 00                     	LDA		#128				; 128 sectors to read
  10217 00D861 20 DF D7                     	JSR		SDC_ReadWriteMultiple
  10218 00D864 60                           	RTS
                                           
                                           ; Parameters (on stack)
                                           ; pointer to filename
                                           ; pointer to disk buffer
                                           ;
  10224 00D865                             SDC_Loadfile:
  10225 00D865 20 2D D8                     	JSR		SDC_LoadRootDir
  10226 00D868 A2 20 00                     	LDX		#32
  10227 00D86B                             .nxt2:
  10228 00D86B A0 00 00                     	LDY		#0
  10229 00D86E A9 0E 00                     	LDA		#$000E
  10230 00D871 8D 6B D8                     	STA		dirptr+2
  10231 00D874 A9 00 F0                     	LDA		#$F000
  10232 00D877 42 8A                        	AAX
  10233 00D879 8D 69 D8                     	STA		dirptr
  10234 00D87C                             .nxtCmp:
  10235 00D87C 42 8B 42 B3 03               	LDA.B	{3,S},Y
  10236 00D881 F0 2F                        	BEQ		.doneCmp
  10237 00D883 42 8B D7 69                  	CMP.B	[dirptr],Y
  10238 00D887 D0 2D                        	BNE		.nextDirentry
  10239 00D889 C8                           	INY
  10240 00D88A C0 0F 00                     	CPY		#15
  10241 00D88D 30 ED                        	BLT		.nxtCmp
  10242 00D88F                             .found:
  10243 00D88F A3 09                        	LDA		9,S
  10244 00D891 AA                           	TAX
  10245 00D892 A3 07                        	LDA		7,S
  10246 00D894 DA                           	PHX
  10247 00D895 48                           	PHA
  10248 00D896 A0 1A 00                     	LDY		#26
  10249 00D899 B7 69                        	LDA		[dirptr],Y 
  10250 00D89B AA                           	TAX
  10251 00D89C A0 18 00                     	LDY		#24
  10252 00D89F B7 69                        	LDA		[dirptr],Y
  10253 00D8A1 20 CD D8                     	JSR		ClusterToSector
  10254 00D8A4 DA                           	PHX
  10255 00D8A5 48                           	PHA
  10256 00D8A6 A0 1D 00                     	LDY		#29
  10257 00D8A9 B7 69                        	LDA		[dirptr],Y
  10258 00D8AB 4A                           	LSR
  10259 00D8AC 20 A3 D8                     	JSR		SDC_ReadMultiple
  10260 00D8AF 42 C0 08                     	RTS		#8
  10261 00D8B2                             .doneCmp:
  10262 00D8B2 B7 69                        	LDA		[dirptr],Y
  10263 00D8B4 F0 D9                        	BEQ		.found
  10264 00D8B6                             .nextDirentry:
  10265 00D8B6 8A                           	TXA
  10266 00D8B7 18                           	CLC
  10267 00D8B8 69 20 00                     	ADC		#32
  10268 00D8BB AA                           	TAX
  10269 00D8BC E0 00 10                     	CPX		#$1000
  10270 00D8BF 30 AA                        	BLT		.nxt2
  10271 00D8C1 F4 05 00                     	PEA		5
  10272 00D8C4 F4 E2 D8                     	PEA		msgFileNotFound
  10273 00D8C7 20 34 CD                     	JSR		DisplayString
  10274 00D8CA 42 C0 08                     	RTS		#8
                                           
  10276 00D8CD                             ClusterToSector:
  10277 00D8CD 85 0C                        	STA		NumWorkArea
  10278 00D8CF 86 0E                        	STX		NumWorkArea+2
  10279 00D8D1 06 0C                        	ASL		NumWorkArea
  10280 00D8D3 26 0E                        	ROL		NumWorkArea+2
  10281 00D8D5 06 0C                        	ASL		NumWorkArea
  10282 00D8D7 26 0E                        	ROL		NumWorkArea+2
  10283 00D8D9 06 0C                        	ASL		NumWorkArea
  10284 00D8DB 26 0E                        	ROL		NumWorkArea+2
  10285 00D8DD A5 0C                        	LDA		NumWorkArea
  10286 00D8DF A6 0E                        	LDX		NumWorkArea+2
  10287 00D8E1 60                           	RTS
                                           
  10289 00D8E2                             msgFileNotFound:
  10290 00D8E2 46 69 6C 65 20 6E 6F 74      	.byte	"File not found",$0D,$0A,$00
  10290 00D8EA 20 66 6F 75 6E 64 0D 0A    
  10290 00D8F2 00                         
                                           
                                           ;============================================================================
                                           ; BASIC support functions
                                           ;============================================================================
                                           
                                           ; Char get routine for BASIC
                                           ; Same thing as for Supermon, except carry flag needs to be inverted
                                           ; This routine should be called from a different context than the BIOS,
                                           ; otherwise the call will be ignored.
                                           ;
  10301 00D8F3                             BasicGetch:
  10302 00D8F3 20 8D D0                     	JSR		KeybdGetCharNoWait
  10303 00D8F6 29 FF 00                     	AND		#$FF
  10304 00D8F9 42 18                        	CMC
  10305 00D8FB 42 40 00                     	RTC		#0
                                           
  10307 00D8FE                             xitBasic:
  10308 00D8FE 85 C0                        	STA		ExitCode
  10309 00D900 AF 00 20 05                  	LDA		running_task
  10310 00D904 42 20 EA DF FD               	JCR		ReleaseIOFocus,OSctx
  10311 00D909 A2 40 00                     	LDX		#TCB_SIZE
  10312 00D90C 42 2A                        	MUL
  10313 00D90E 42 9E 25 00 02 00            	STZ		tcbs+TCB_status,X	; no longer ready
  10314 00D914 A9 00 00                     	LDA		#0
  10315 00D917 42 20 C4 DF FD               	JCR		SetIOFocus,OSctx
  10316 00D91C                             .0001:
  10317 00D91C 42 20 64 E1 FD               	JCR		FMTK_ScheduleTask,OSctx
                                           	;TSK		JMP:#0		; scheduler will start monitor again, it's in the ready queue
  10319 00D921 80 F9                        	BRA		.0001			; we shouldn't get here, another ready task was scheduled
                                           
  10321 00D923                             BASIC_Savefile:
  10322 00D923 20 10 D5                     	JSR		spi_master_init
  10323 00D926 D0 18                        	BNE		.0001
  10324 00D928 A9 BC D5                     	LDA		#spi_master_write
  10325 00D92B 8D F4 03                     	STA		spi_rw_vect
  10326 00D92E F4 01 00                     	PEA		$1		; buffer = $10000
  10327 00D931 F4 00 00                     	PEA		$0
  10328 00D934 F4 00 00                     	PEA		$0
  10329 00D937 F4 88 00                     	PEA		136		; starting sector
  10330 00D93A A9 40 00                     	LDA		#64		; 64 sectors (32 kiB)
  10331 00D93D 20 DF D7                     	JSR		SDC_ReadWriteMultiple
  10332 00D940                             .0001:
  10333 00D940 42 40 00                     	RTC		#0
                                           
  10335 00D943                             BASIC_Loadfile:
  10336 00D943 20 10 D5                     	JSR		spi_master_init
  10337 00D946 D0 18                        	BNE		.0001		
  10338 00D948 A9 44 D5                     	LDA		#spi_master_read
  10339 00D94B 8D F4 03                     	STA		spi_rw_vect
  10340 00D94E F4 01 00                     	PEA		$1		; buffer = $10000
  10341 00D951 F4 00 00                     	PEA		$0
  10342 00D954 F4 00 00                     	PEA		$0
  10343 00D957 F4 88 00                     	PEA		136		; starting sector
  10344 00D95A A9 40 00                     	LDA		#64		; 64 sectors (32 kiB)
  10345 00D95D 20 DF D7                     	JSR		SDC_ReadWriteMultiple
  10346 00D960                             .0001:
  10347 00D960 42 40 00                     	RTC		#0
                                           
                                           ;============================================================================
                                           ; Multi-tasking kernel
                                           ;============================================================================
                                           
  10353 00D963                             FMTK_Init:
  10354 00D963 42 C2 30 01                  	REP		#$130
  10355 00D967 42 E2 00 02                  	SEP		#$200
                                           	MEM		32
                                           	NDX		32
  10358 00D96B 42 AB 42 9C 00 20 05 00      	STZ.H	running_task
                                         
                                           
  10360 00D973 20 8B D9                     	JSR		ZeroIRQHooks
  10361 00D976 20 C3 D9                     	JSR		InitMSGArray
  10362 00D979 20 9B D9                     	JSR		InitMBXArray
  10363 00D97C 20 56 DA                     	JSR		InitTCBArray
  10364 00D97F 20 E6 D9                     	JSR		InitJCBArray
  10365 00D982 42 C2 30 02                  	REP		#$230
  10366 00D986 42 E2 00 01                  	SEP		#$100
                                           	MEM		16
                                           	NDX		16
  10369 00D98A 60                           	RTS
                                           
                                           	; zero out the IRQ hook vectors
  10372 00D98B                             ZeroIRQHooks:
  10373 00D98B A9 00 00                     	LDA		#0
  10374 00D98E AA                           	TAX
  10375 00D98F                             .0001:
  10376 00D98F 9F 12 20 05                  	STA		IRQ1Hook,X
  10377 00D993 42 E8                        	INX4
  10378 00D995 E0 40 00                     	CPX		#MAX_IRQ_HOOKS*4
  10379 00D998 D0 F5                        	BNE		.0001
  10380 00D99A 60                           	RTS
                                           
                                           
                                           	; initialize mailbox array
                                           	; create free mailbox list
  10385 00D99B                             InitMBXArray:
  10386 00D99B A0 00 00                     	LDY		#0
  10387 00D99E                             .nxtMbx:
  10388 00D99E 98                           	TYA
  10389 00D99F 20 B4 DA                     	JSR		hMbxToAddr
  10390 00D9A2 AA                           	TAX
  10391 00D9A3 98                           	TYA
  10392 00D9A4 42 AB 95 16                  	STA.H	MBX_number,X
  10393 00D9A8 1A                           	INA
  10394 00D9A9 42 AB 95 00                  	STA.H	MBX_link,X
  10395 00D9AD C8                           	INY
  10396 00D9AE C0 00 04                     	CPY		#NR_MBX
  10397 00D9B1 30 EB                        	BLT		.nxtMbx
  10398 00D9B3 A9 FF FF                     	LDA		#$FFFFFFFF
  10399 00D9B6 42 AB 95 00                  	STA.H	MBX_link,X
  10400 00D9BA 42 AB 42 9C 08 20 05 00      	STZ.H	freeMBX
                                         
  10401 00D9C2 60                           	RTS
                                           
                                           	; initialize message array
                                           	; create the free message list
                                           	; for each message
                                           	; msg->link = handle of next message
  10407 00D9C3                             InitMSGArray:
  10408 00D9C3 A0 00 00                     	LDY		#0
  10409 00D9C6                             .nxtMsg:
  10410 00D9C6 98                           	TYA
  10411 00D9C7 20 C4 DA                     	JSR		hMsgToAddr
  10412 00D9CA AA                           	TAX
  10413 00D9CB C8                           	INY
  10414 00D9CC 98                           	TYA
  10415 00D9CD 42 AB 95 10                  	STA.H	MSG_link,X
  10416 00D9D1 C0 00 10                     	CPY		#NR_MSG
  10417 00D9D4 30 F0                        	BLT		.nxtMsg
                                           	; flag the last message as no more links
  10419 00D9D6 A9 FF FF                     	LDA		#$FFFFFFFF
  10420 00D9D9 42 AB 95 10                  	STA.H	MSG_link,X
                                           	; now point free list to first message
  10422 00D9DD 42 AB 42 9C 0A 20 05 00      	STZ.H	freeMSG
                                         
  10423 00D9E5 60                           	RTS
                                           
                                           	; Initialize JCB array
  10426 00D9E6                             InitJCBArray:
  10427 00D9E6 A0 00 00                     	LDY		#0
  10428 00D9E9                             .nxtJcb:
  10429 00D9E9 98                           	TYA
  10430 00D9EA 20 94 DA                     	JSR		hJcbToAddr
  10431 00D9ED AA                           	TAX
  10432 00D9EE 98                           	TYA
  10433 00D9EF 42 8B 9D 5B 03               	STA.B	JCB_number,X
  10434 00D9F4 A9 FF FF                     	LDA		#$FFFFFFFF
  10435 00D9F7 42 8B 95 00                  	STA.B	JCB_iof_next,X
  10436 00D9FB 42 8B 95 01                  	STA.B	JCB_iof_prev,X
  10437 00D9FF 42 8B 74 02                  	STZ.B	JCB_user_name,X
  10438 00DA03 42 8B 74 22                  	STZ.B	JCB_path,X
  10439 00DA07 42 8B 9E 22 01               	STZ.B	JCB_exit_runfile,X
  10440 00DA0C 42 8B 9E 22 02               	STZ.B	JCB_command_line,X
  10441 00DA11 42 8B 9E 30 03               	STZ.B	JCB_CursorRow,X
  10442 00DA16 42 8B 9E 31 03               	STZ.B	JCB_CursorCol,X
  10443 00DA1B A9 00 BF                     	LDA		#$BF00
  10444 00DA1E 42 AB 9D 32 03               	STA.H	JCB_NormAttr,X
  10445 00DA23 42 AB 74 08                  	STZ.H	KeyState1,X
  10446 00DA27 42 AB 74 09                  	STZ.H	KeyState2,X
  10447 00DA2B 42 8B 9E 39 03               	STZ.B	JCB_KeybdHead,X
  10448 00DA30 42 8B 9E 3A 03               	STZ.B	JCB_KeybdTail,X
  10449 00DA35 5A                           	PHY
  10450 00DA36 A0 00 00                     	LDY		#0
  10451 00DA39                             .nxt1:
  10452 00DA39 98                           	TYA
  10453 00DA3A DA                           	PHX
  10454 00DA3B 42 8A                        	AAX						; add .A and .X
  10455 00DA3D AA                           	TAX
  10456 00DA3E A9 FF FF                     	LDA		#$FFFFFFFF
  10457 00DA41 42 AB 9D 60 03               	STA.H	JCB_hMbxs,X
  10458 00DA46 FA                           	PLX
  10459 00DA47 C8                           	INY
  10460 00DA48 C8                           	INY
  10461 00DA49 C0 40 00                     	CPY		#NR_MBXperJCB*2
  10462 00DA4C 30 EB                        	BLT		.nxt1
  10463 00DA4E 7A                           	PLY
  10464 00DA4F C8                           	INY
  10465 00DA50 C0 40 00                     	CPY		#NR_JCB
  10466 00DA53 30 94                        	BLT		.nxtJcb
  10467 00DA55 60                           	RTS
                                           
  10469 00DA56                             InitTCBArray:
                                           	; Initialize TCB array
  10471 00DA56 A0 00 00                     	LDY		#0
  10472 00DA59                             .nxtTcb:
  10473 00DA59 98                           	TYA
  10474 00DA5A 20 A4 DA                     	JSR		hTcbToAddr
  10475 00DA5D AA                           	TAX
  10476 00DA5E 98                           	TYA
  10477 00DA5F 42 AB 95 22                  	STA.H	TCB_number,X
  10478 00DA63 A9 FF FF                     	LDA		#$FFFFFFFF
  10479 00DA66 42 AB 95 08                  	STA.H	TCB_mbq_next,X
  10480 00DA6A 42 AB 95 0A                  	STA.H	TCB_mbq_prev,X
  10481 00DA6E 42 AB 95 1C                  	STA.H	TCB_msg_link,X
  10482 00DA72 42 AB 95 20                  	STA.H	TCB_hWaitMbx,X
  10483 00DA76 42 8B 95 27                  	STA.B	TCB_hJcb,X
  10484 00DA7A A9 02 00                     	LDA		#2
  10485 00DA7D 42 8B 95 24                  	STA.B	TCB_priority,X
  10486 00DA81 42 8B 74 25                  	STZ.B	TCB_status,X
  10487 00DA85 74 28                        	STZ		TCB_start_tick,X
  10488 00DA87 74 2C                        	STZ		TCB_end_tick,X
  10489 00DA89 74 30                        	STZ		TCB_ticks,X
  10490 00DA8B 74 34                        	STZ		TCB_exception,X
  10491 00DA8D C8                           	INY
  10492 00DA8E C0 00 02                     	CPY		#NR_TCB
  10493 00DA91 30 C6                        	BLT		.nxtTcb
  10494 00DA93 60                           	RTS
                                           
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FMTKmsg.asm

                                           ; ============================================================================
                                           ; FMTKmsg.asm
                                           ;        __
                                           ;   \\__/ o\    (C) 2017  Robert Finch, Waterloo
                                           ;    \  __ /    All rights reserved.
                                           ;     \/_//     robfinch<remove>@finitron.ca
                                           ;       ||
                                           ;  
                                           ;
                                           ; This source file is free software: you can redistribute it and/or modify 
                                           ; it under the terms of the GNU Lesser General Public License as published 
                                           ; by the Free Software Foundation, either version 3 of the License, or     
                                           ; (at your option) any later version.                                      
                                           ;                                                                          
                                           ; This source file is distributed in the hope that it will be useful,      
                                           ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                           ; GNU General Public License for more details.                             
                                           ;                                                                          
                                           ; You should have received a copy of the GNU General Public License        
                                           ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                           ;                   
                                           ;
                                           ; Messaging Primitives for FMTK                                                       
                                           ; ============================================================================
                                           ;
                                           
                                           		CPU		FT832
                                           		MEM		32
                                           		NDX		32
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Handle to address conversion functions.
                                           ;----------------------------------------------------------------------------
                                           
                                           public hJcbToAddr:
  10533 00DA94 48                           		PHA
  10534 00DA95 A2 00 04 00 00               		LDX		#JCB_SIZE
  10535 00DA9A 42 2A                        		MUL
  10536 00DA9C 18                           		CLC
  10537 00DA9D 69 00 80 02 00               		ADC		#jcbs
  10538 00DAA2 FA                           		PLX
  10539 00DAA3 60                           		RTS
                                           
                                           public hTcbToAddr:
  10542 00DAA4 DA                           		PHX
  10543 00DAA5 A2 40 00 00 00               		LDX		#TCB_SIZE
  10544 00DAAA 42 2A                        		MUL
  10545 00DAAC 18                           		CLC
  10546 00DAAD 69 00 00 02 00               		ADC		#tcbs
  10547 00DAB2 FA                           		PLX
  10548 00DAB3 60                           		RTS
                                           
                                           public hMbxToAddr:
  10551 00DAB4 DA                           		PHX
  10552 00DAB5 A2 18 00 00 00               		LDX		#MBX_SIZE
  10553 00DABA 42 2A                        		MUL
  10554 00DABC 18                           		CLC
  10555 00DABD 69 00 80 03 00               		ADC		#mailboxes
  10556 00DAC2 FA                           		PLX
  10557 00DAC3 60                           		RTS
                                           
                                           public hMsgToAddr:
  10560 00DAC4 DA                           		PHX
  10561 00DAC5 A2 14 00 00 00               		LDX		#MSG_SIZE
  10562 00DACA 42 2A                        		MUL
  10563 00DACC 18                           		CLC
  10564 00DACD 69 00 E0 03 00               		ADC		#messages
  10565 00DAD2 FA                           		PLX
  10566 00DAD3 60                           		RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; QueueMsg
                                           ;	Queue a message at a mailbox
                                           ; Assumes:
                                           ;	Mailbox parameter is valid
                                           ;	System semaphore is locked already
                                           ; Parameters:
                                           ;	.A	mailbox handle
                                           ;	.X  message handle
                                           ;----------------------------------------------------------------------------
                                           ;
  10579 00DAD4                             QueueMsg:
  10580 00DAD4 42 AB 86 94                  		STX.H	reg_x
  10581 00DAD8 42 AB 85 90                  		STA.H	reg_a
  10582 00DADC 20 B4 DA                     		JSR		hMbxToAddr
  10583 00DADF AA                           		TAX
  10584 00DAE0 42 AB F6 0E                  		INC.H	MBX_mq_count,X	; increment queued messages count
  10585 00DAE4 42 BB B5 08                  		LDA.UH	MBX_mq_tail,X	; if (mailboxes[hMbx]->mq_tail >= 0)
  10586 00DAE8 30 0E                        		BMI		.0001			; branch if no messages queued
  10587 00DAEA 20 C4 DA                     		JSR		hMsgToAddr
  10588 00DAED AA                           		TAX
  10589 00DAEE 42 BB A5 94                  		LDA.UH	reg_x			; .A = message handle
  10590 00DAF2 42 AB 95 10                  		STA.H	MSG_link,X		; message[mailbox[hMbx]->mq_tail].link = hMsg
  10591 00DAF6 80 10                        		BRA		.0002
  10592 00DAF8                             .0001:							; else
  10593 00DAF8 42 AB A5 90                  		LDA.H	reg_a			;	.A = mailbox handle
  10594 00DAFC 20 B4 DA                     		JSR		hMbxToAddr
  10595 00DAFF AA                           		TAX
  10596 00DB00 42 BB A5 94                  		LDA.UH	reg_x
  10597 00DB04 42 AB 95 06                  		STA.H	MBX_mq_head,X	; mailbox[hMbx].mq_head = hMsg
  10598 00DB08                             .0002:
  10599 00DB08 42 BB A5 90                  		LDA.UH	reg_a			; .A = mailbox handle
  10600 00DB0C 20 B4 DA                     		JSR		hMbxToAddr
  10601 00DB0F AA                           		TAX						; .X = index into mailboxes array
  10602 00DB10 42 BB A5 94                  		LDA.UH	reg_x			; .A = message handle
  10603 00DB14 42 AB 95 08                  		STA.H	MBX_mq_tail,X	; mailbox[hMbx]->mq_tail = hMsg
  10604 00DB18 20 C4 DA                     		JSR		hMsgToAddr
  10605 00DB1B AA                           		TAX
  10606 00DB1C A9 FF FF FF FF               		LDA		#$FFFFFFFF
  10607 00DB21 42 AB 95 10                  		STA.H	MSG_link,X		; message[hMsg]->link = -1
  10608 00DB25 60                           		RTS		
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Dequeue message from mailbox
                                           ;
                                           ; Assumes:
                                           ;	Mailbox parameter is valid
                                           ;	System semaphore is locked already
                                           ; Parameters:
                                           ;	.A = mailbox number
                                           ; Returns:
                                           ;	.A = -1 if no messages available
                                           ;	.A = handle of message
                                           ;----------------------------------------------------------------------------
                                           ;
  10623 00DB26                             DequeueMsg:
  10624 00DB26 20 B4 DA                     	JSR		hMbxToAddr
  10625 00DB29 AA                           	TAX
  10626 00DB2A 42 BB B5 0E                  	LDA.UH	MBX_mq_count,X	; if (mbx->mq_count)
  10627 00DB2E F0 2A                        	BEQ		.noMessage
  10628 00DB30 42 AB D6 0E                  	DEC.H	MBX_mq_count,X	; mbx->mq_count--;
  10629 00DB34 42 BB B5 06                  	LDA.UH	MBX_mq_head,X	; .A = message handle
  10630 00DB38 30 20                        	BMI		.noMessage
  10631 00DB3A 20 C4 DA                     	JSR		hMsgToAddr
  10632 00DB3D 48                           	PHA
  10633 00DB3E A8                           	TAY
  10634 00DB3F 42 AB B9 10 00               	LDA.H	MSG_link,Y
  10635 00DB44 42 AB 95 06                  	STA.H	MBX_mq_head,X
  10636 00DB48 10 09                        	BPL		.0001
  10637 00DB4A A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10638 00DB4F 42 AB 95 08                  	STA.H	MBX_mq_tail,X
  10639 00DB53                             .0001:
  10640 00DB53 68                           	PLA
  10641 00DB54 42 AB 99 10 00               	STA.H	MSG_link,Y		; tmpmsg->link = hm
  10642 00DB59 60                           	RTS						; return hm
  10643 00DB5A                             .noMessage:
  10644 00DB5A A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10645 00DB5F 60                           	RTS
                                           
                                           
                                           ;----------------------------------------------------------------------------
                                           ;		Dequeues a thread from a mailbox. The thread will also
                                           ;	be removed from the timeout list (if it's present there),
                                           ;	and	the timeout list will be adjusted accordingly.
                                           ;
                                           ;	.A = handle to mailbox
                                           ; Returns:
                                           ;	.A = handle to thread (-1 if none available)
                                           ;----------------------------------------------------------------------------
                                           
  10658 00DB60                             DequeueThreadFromMbx:
  10659 00DB60 20 B4 DA                     	JSR		hMbxToAddr
  10660 00DB63 AA                           	TAX
  10661 00DB64 42 AB B5 02                  	LDA.H	MBX_tq_head,X
  10662 00DB68 10 06                        	BPL		.0001
  10663 00DB6A A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10664 00DB6F 60                           	RTS						; return .A < 0
  10665 00DB70                             .0001:
  10666 00DB70 42 AB D6 0C                  	DEC.H	MBX_tq_count,X
  10667 00DB74 42 BB B5 02                  	LDA.UH	MBX_tq_head,X
  10668 00DB78 42 AB 8F 02 20 05            	STA.H	hTcbTmp
  10669 00DB7E 20 A4 DA                     	JSR		hTcbToAddr
  10670 00DB81 A8                           	TAY
  10671 00DB82 42 AB B9 08 00               	LDA.H	TCB_mbq_next,Y
  10672 00DB87 42 AB 95 02                  	STA.H	MBX_tq_head,X
  10673 00DB8B 30 0C                        	BMI		.0002
  10674 00DB8D A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10675 00DB92 42 AB 99 0A 00               	STA.H	TCB_mbq_prev,Y
  10676 00DB97 80 09                        	BRA		.0003
  10677 00DB99                             .0002:
  10678 00DB99 A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10679 00DB9E 42 AB 95 04                  	STA.H	MBX_tq_tail,X
  10680 00DBA2                             .0003:
  10681 00DBA2 42 8B B9 25 00               	LDA.B	TCB_status,Y
  10682 00DBA7 29 08 00 00 00               	AND		#TS_TIMEOUT
  10683 00DBAC F0 17                        	BEQ		.0004
  10684 00DBAE 42 BB AF 02 20 05            	LDA.UH	hTcbTmp
  10685 00DBB4 42 AB 8F 02 C3 FE            	STA.H	TIMEOUT_LIST+2	; which task to remove
  10686 00DBBA A9 03 00 00 00               	LDA		#TOL_RMV		; remove command to timeout list
  10687 00DBBF 42 8B 8F 00 C3 FE            	STA.B	TIMEOUT_LIST	; remove the task
  10688 00DBC5                             .0004:
  10689 00DBC5 A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10690 00DBCA 42 AB 99 0A 00               	STA.H	TCB_mbq_prev,Y
  10691 00DBCF 42 AB 99 08 00               	STA.H	TCB_mbq_next,Y
  10692 00DBD4 42 AB 99 20 00               	STA.H	TCB_hWaitMbx,Y
  10693 00DBD9 42 AB B9 25 00               	LDA.H	TCB_status,Y
  10694 00DBDE 29 FB FF FF FF               	AND		#~TS_WAITMSG
  10695 00DBE3 42 AB 99 25 00               	STA.H	TCB_status,Y
  10696 00DBE8 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10697 00DBEE 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Queue a thread at a mailbox
                                           ;
                                           ; .A = handle to TCB
                                           ; .X = mailbox
                                           ;----------------------------------------------------------------------------
                                           
  10706 00DBEF                             QueueThreadAtMbx:
  10707 00DBEF 42 AB 8F 02 20 05            	STA.H	hTcbTmp
  10708 00DBF5 42 AB 42 8E 04 20 05 00      	STX.H	hMbxTmp
                                         
  10709 00DBFD 20 A4 DA                     	JSR		hTcbToAddr
  10710 00DC00 AA                           	TAX
  10711 00DC01 42 8B B5 25                  	LDA.B	TCB_status,X
  10712 00DC05 09 04 00 00 00               	ORA		#TS_WAITMSG
  10713 00DC0A 42 8B 95 25                  	STA.B	TCB_status,X
  10714 00DC0E 42 AB 42 AE 04 20 05 00      	LDX.H	hMbxTmp
                                         
  10715 00DC16 42 AB 95 20                  	STA.H	TCB_hWaitMbx,X
  10716 00DC1A A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10717 00DC1F 42 AB 95 08                  	STA.H	TCB_mbq_next,X
  10718 00DC23 42 AB AF 04 20 05            	LDA.H	hMbxTmp
  10719 00DC29 20 B4 DA                     	JSR		hMbxToAddr
  10720 00DC2C A8                           	TAY
  10721 00DC2D B9 02 00                     	LDA		MBX_tq_head,Y
  10722 00DC30 10 23                        	BPL		.0001
  10723 00DC32 A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10724 00DC37 42 AB 95 0A                  	STA.H	TCB_mbq_prev,X
  10725 00DC3B AF 02 20 05                  	LDA		hTcbTmp
  10726 00DC3F 42 AB 99 02 00               	STA.H	MBX_tq_head,Y
  10727 00DC44 42 AB 99 04 00               	STA.H	MBX_tq_tail,Y
  10728 00DC49 A9 01 00 00 00               	LDA		#1
  10729 00DC4E 42 AB 99 0C 00               	STA.H	MBX_tq_count,Y
  10730 00DC53 80 32                        	BRA		.0002
  10731 00DC55                             .0001:
  10732 00DC55 42 AB B9 04 00               	LDA.H	MBX_tq_tail,Y
  10733 00DC5A 42 AB 95 0A                  	STA.H	TCB_mbq_prev,X
  10734 00DC5E 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10735 00DC64 42 AB 99 04 00               	STA.H	MBX_tq_tail,Y
  10736 00DC69 42 AB B9 0C 00               	LDA.H	MBX_tq_count,Y
  10737 00DC6E 1A                           	INA
  10738 00DC6F 42 AB 99 0C 00               	STA.H	MBX_tq_count,Y
  10739 00DC74 42 AB B9 04 00               	LDA.H	MBX_tq_tail,Y
  10740 00DC79 20 A4 DA                     	JSR		hTcbToAddr
  10741 00DC7C AA                           	TAX
  10742 00DC7D 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10743 00DC83 42 AB 95 08                  	STA.H	TCB_mbq_next,X
  10744 00DC87                             .0002:
  10745 00DC87 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Allocate a mailbox
                                           ;	The mailbox is added to the array of mailboxes that the job uses.
                                           ;	The default queue strategy is to queue the eight most recent messages.
                                           ; Parameters:
                                           ;	<none>
                                           ; Returns:
                                           ; .A = handle to mailbox (-4 = no mailbox available)
                                           ; .NF set on error, clear otherwise
                                           ;----------------------------------------------------------------------------
                                           
                                           public FMTK_AllocMbx:
                                           	; First ensure that there is an open mailbox slot in the JCB.
                                           	; JCB's only support a limited number of mailboxes
  10761 00DC88 20 FC DF                     	JSR		GetJCB
  10762 00DC8B AA                           	TAX
  10763 00DC8C 20 94 DA                     	JSR		hJcbToAddr
  10764 00DC8F A0 00 00 00 00               	LDY		#0
  10765 00DC94                             .0002:
  10766 00DC94 42 AB B9 60 03               	LDA.H	JCB_hMbxs,Y
  10767 00DC99 30 11                        	BMI		.gotMbxSlot
  10768 00DC9B C8                           	INY
  10769 00DC9C C8                           	INY
  10770 00DC9D C0 40 00 00 00               	CPY		#NR_MBXperJCB*2
  10771 00DCA2 D0 F0                        	BNE		.0002
  10772 00DCA4 A9 FB FF FF FF               	LDA		#E_TooManyMbx
  10773 00DCA9 42 40 00                     	RTC		#0
  10774 00DCAC                             .gotMbxSlot:
  10775 00DCAC 42 AB AF 08 20 05            	LDA.H	freeMBX
  10776 00DCB2 10 08                        	BPL		.0001
  10777 00DCB4 A9 FC FF FF FF               	LDA		#E_NoMoreMbx
  10778 00DCB9 42 40 00                     	RTC		#0
  10779 00DCBC                             .0001:
  10780 00DCBC 42 AB 99 60 03               	STA.H	JCB_hMbxs,Y
  10781 00DCC1 48                           	PHA
  10782 00DCC2 20 B4 DA                     	JSR		hMbxToAddr
  10783 00DCC5 AA                           	TAX
  10784 00DCC6 42 AB B5 00                  	LDA.H	MBX_link,X
  10785 00DCCA 42 AB 8F 08 20 05            	STA.H	freeMBX
  10786 00DCD0 42 AB 42 CE 10 20 05 00      	DEC.H	nMailbox
                                         
  10787 00DCD8 20 C2 DF                     	JSR		UnlockSysSema
  10788 00DCDB 20 FC DF                     	JSR		GetJCB
  10789 00DCDE 42 8B 95 01                  	STA.B	MBX_owner,X
  10790 00DCE2 A9 FF FF FF FF               	LDA		#$FFFFFFFF
  10791 00DCE7 42 AB 95 02                  	STA.H	MBX_tq_head,X
  10792 00DCEB 42 AB 95 04                  	STA.H	MBX_tq_tail,X
  10793 00DCEF 42 AB 95 06                  	STA.H	MBX_mq_head,X
  10794 00DCF3 42 AB 95 08                  	STA.H	MBX_mq_tail,X
  10795 00DCF7 42 AB 74 0C                  	STZ.H	MBX_tq_count,X
  10796 00DCFB 42 AB 74 0E                  	STZ.H	MBX_mq_count,X
  10797 00DCFF 42 AB 74 12                  	STZ.H	MBX_mq_missed,X
  10798 00DD03 A9 08 00 00 00               	LDA		#8
  10799 00DD08 42 AB 95 10                  	STA.H	MBX_mq_size,X
  10800 00DD0C A9 00 00 00 00               	LDA		#MQS_NEWEST
  10801 00DD11 95 14                        	STA		MBX_mq_strategy,X
  10802 00DD13 68                           	PLA
  10803 00DD14 42 40 00                     	RTC		#0
                                           
                                           ;----------------------------------------------------------------------------
                                           ; SendMsg
                                           ;
                                           ; Parameters:
                                           ;	.A = mailbox handle
                                           ;	D1  (on stack word)
                                           ;	D2  (on stack word)
                                           ;	D3	(on stack word)
                                           ;----------------------------------------------------------------------------
                                           
                                           public FMTK_SendMsg:
                                           public FMTK_PostMsg:
  10817 00DD17 42 AB 8F 04 20 05            	STA.H	hMbxTmp
  10818 00DD1D 20 B4 DA                     	JSR		hMbxToAddr
  10819 00DD20 42 8B B5 01                  	LDA.B	MBX_owner,X
  10820 00DD24 30 07                        	BMI		.notOwned
  10821 00DD26 C9 00 04 00 00               	CMP		#NR_MBX
  10822 00DD2B 30 08                        	BLT		.ownerOk
  10823 00DD2D                             .notOwned:
  10824 00DD2D A9 FF FF FF FF               	LDA		#E_NotAlloc
  10825 00DD32 42 40 0C                     	RTC		#12
  10826 00DD35                             .ownerOk:
  10827 00DD35 42 AB AF 0A 20 05            	LDA.H	freeMSG
  10828 00DD3B 30 07                        	BMI		.noMsg
  10829 00DD3D C9 00 10 00 00               	CMP		#NR_MSG
  10830 00DD42 30 08                        	BLT		.msgOk
  10831 00DD44                             .noMsg:
  10832 00DD44 A9 FD FF FF FF               	LDA		#E_NoMoreMsgBlks
  10833 00DD49 42 40 0C                     	RTC		#12
  10834 00DD4C                             .msgOk:
  10835 00DD4C 42 AB 8F 06 20 05            	STA.H	hMsgTmp
  10836 00DD52 20 C4 DA                     	JSR		hMsgToAddr
  10837 00DD55 AA                           	TAX
  10838 00DD56 B5 10                        	LDA		MSG_link,X
  10839 00DD58 8F 0A 20 05                  	STA		freeMSG
  10840 00DD5C 42 CE 0E 20 05 00            	DEC		nMsgBlk
  10841 00DD62 A9 00 00 00 00               	LDA		#MBT_DATA
  10842 00DD67 42 8B 95 12                  	STA.B	MSG_type,X
  10843 00DD6B A3 03                        	LDA		3,S
  10844 00DD6D 95 00                        	STA		MSG_d1,X
  10845 00DD6F A3 07                        	LDA		7,S
  10846 00DD71 95 04                        	STA		MSG_d2,X
  10847 00DD73 A3 0B                        	LDA		11,S
  10848 00DD75 95 08                        	STA		MSG_d3,X
  10849 00DD77 20 60 DB                     	JSR		DequeueThreadFromMbx
  10850 00DD7A C9 00 00 00 00               	CMP		#0
  10851 00DD7F 10 14                        	BPL		.thrdOk
  10852 00DD81 42 AB AF 04 20 05            	LDA.H	hMbxTmp
  10853 00DD87 42 AB 42 AE 06 20 05 00      	LDX.H	hMsgTmp
                                         
  10854 00DD8F 20 D4 DA                     	JSR		QueueMsg
  10855 00DD92 42 40 0C                     	RTC		#12
  10856 00DD95                             .thrdOk:
  10857 00DD95 8F 02 20 05                  	STA		hTcbTmp
  10858 00DD99 20 A4 DA                     	JSR		hTcbToAddr
  10859 00DD9C A8                           	TAY
  10860 00DD9D 42 8B B5 12                  	LDA.B	MSG_type,X
  10861 00DDA1 42 8B 99 1E 00               	STA.B	TCB_msg_type,Y
  10862 00DDA6 B5 00                        	LDA		MSG_d1,X
  10863 00DDA8 99 0C 00                     	STA		TCB_msg_d1,Y
  10864 00DDAB B5 04                        	LDA		MSG_d2,X
  10865 00DDAD 99 10 00                     	STA		TCB_msg_d2,Y
  10866 00DDB0 B5 08                        	LDA		MSG_d3,X
  10867 00DDB2 99 14 00                     	STA		TCB_msg_d3,Y
  10868 00DDB5 A9 01 00 00 00               	LDA		#MT_FREE
  10869 00DDBA 95 12                        	STA		MSG_type,X
  10870 00DDBC 42 AB AF 0A 20 05            	LDA.H	freeMSG
  10871 00DDC2 42 AB 95 10                  	STA.H	MSG_link,X
  10872 00DDC6 AF 06 20 05                  	LDA		hMsgTmp
  10873 00DDCA 8F 0A 20 05                  	STA		freeMSG
  10874 00DDCE 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10875 00DDD4 20 A4 DA                     	JSR		hTcbToAddr
  10876 00DDD7 AA                           	TAX
  10877 00DDD8 42 8B B5 25                  	LDA.B	TCB_status,X
  10878 00DDDC 29 08 00 00 00               	AND		#TS_TIMEOUT
  10879 00DDE1 F0 17                        	BEQ		.noTimeout
  10880 00DDE3 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10881 00DDE9 42 AB 8F 02 C3 FE            	STA.H	TIMEOUT_LIST+2
  10882 00DDEF A9 03 00 00 00               	LDA		#TOL_RMV
  10883 00DDF4 42 8B 8F 00 C3 FE            	STA.B	TIMEOUT_LIST
  10884 00DDFA                             .noTimeout:
  10885 00DDFA 42 AB AF 02 20 05            	LDA.H	hTcbTmp
  10886 00DE00 20 32 E1                     	JSR		InsertIntoReadyFifo		
  10887 00DE03 A9 00 00 00 00               	LDA		#E_Ok
  10888 00DE08 42 40 0C                     	RTC		#12
                                           
                                           ;----------------------------------------------------------------------------
                                           ;	Wait for message. If timelimit is zero then the thread will wait
                                           ; indefinately for a message.
                                           ;
                                           ; Parameters:
                                           ;	.A = mailbox number
                                           ;	*d1 = pointer to where to store D1 (on stack)
                                           ;	*d2 = pointer to where to store D2 (on stack)
                                           ;	*d3 = pointer to where to store D3 (on stack)
                                           ;   TimeLimit = value on stack
                                           ;----------------------------------------------------------------------------
                                           
                                           public FMTK_WaitMsg:
  10903 00DE0B 42 AB 8F 04 20 05            	STA.H	hMbxTmp
  10904 00DE11 20 B4 DA                     	JSR		hMbxToAddr
  10905 00DE14 B5 01                        	LDA		MBX_owner,X
  10906 00DE16 30 07                        	BMI		.notOwned
  10907 00DE18 C9 00 04 00 00               	CMP		#NR_MBX
  10908 00DE1D 30 08                        	BLT		.ownerOk
  10909 00DE1F                             .notOwned:
  10910 00DE1F A9 FF FF FF FF               	LDA		#E_NotAlloc
  10911 00DE24 42 40 10                     	RTC		#16
  10912 00DE27                             .ownerOk:
  10913 00DE27 AF 04 20 05                  	LDA		hMbxTmp
  10914 00DE2B 20 26 DB                     	JSR		DequeueMsg
  10915 00DE2E C9 00 00 00 00               	CMP		#0
  10916 00DE33 10 FF 7A 00                  	LBPL	.gotMsg
  10917 00DE37 42 1A                        	TTA
  10918 00DE39 48                           	PHA
  10919 00DE3A 20 A4 DA                     	JSR		hTcbToAddr
  10920 00DE3D AA                           	TAX
  10921 00DE3E 74 25                        	STZ		TCB_status,X	; remove thread from ready list
  10922 00DE40 20 EF DB                     	JSR		QueueThreadAtMbx
  10923 00DE43 A3 0F                        	LDA		15,S			; .A = time limit param
  10924 00DE45 F0 18                        	BEQ		.noTimelimit
  10925 00DE47 8F 00 C3 FE                  	STA		TIMEOUT_LIST + 4
  10926 00DE4B 68                           	PLA
  10927 00DE4C 42 AB 8F 00 C3 FE            	STA.H	TIMEOUT_LIST + 2
  10928 00DE52 A9 02 00 00 00               	LDA		#TOL_INS
  10929 00DE57 42 8B 8F 00 C3 FE            	STA.B	TIMEOUT_LIST
  10930 00DE5D 80 01                        	BRA		.0001
  10931 00DE5F                             .noTimelimit:
  10932 00DE5F 68                           	PLA
  10933 00DE60                             .0001:
  10934 00DE60 42 20 00 FF FD               	JCR		$FF00,$FD		; invoke scheduler
                                           	; Control will return here as a result of a SendMsg or timeout
  10936 00DE65 42 AB AF 00 20 05            	LDA.H	running_task
  10937 00DE6B 20 A4 DA                     	JSR		hTcbToAddr
  10938 00DE6E AA                           	TAX
  10939 00DE6F B5 1E                        	LDA		TCB_msg_type,X
  10940 00DE71 C9 00 00 00 00               	CMP		#MT_NONE
  10941 00DE76 D0 08                        	BNE		.0002
  10942 00DE78 A9 FE FF FF FF               	LDA		#E_NoMsg
  10943 00DE7D 42 40 10                     	RTC		#16
  10944 00DE80                             .0002:
  10945 00DE80 A9 00 00 00 00               	LDA		#MT_NONE
  10946 00DE85 42 8B 95 1E                  	STA.B	TCB_msg_type,X
  10947 00DE89 A0 00 00 00 00               	LDY		#0
  10948 00DE8E A3 03                        	LDA		3,S
  10949 00DE90 F0 05                        	BEQ		.noD1x
  10950 00DE92 B5 0C                        	LDA		TCB_msg_d1,X
  10951 00DE94 42 93 03                     	STA		{3,S},Y
  10952 00DE97                             .noD1x:
  10953 00DE97 A3 07                        	LDA		7,S
  10954 00DE99 F0 05                        	BEQ		.noD2x:
  10955 00DE9B B5 10                        	LDA		TCB_msg_d2,X
  10956 00DE9D 42 93 07                     	STA		{7,S},Y
  10957 00DEA0                             .noD2x:
  10958 00DEA0 A3 0B                        	LDA		11,S
  10959 00DEA2 F0 05                        	BEQ		.noD3x
  10960 00DEA4 B5 14                        	LDA		TCB_msg_d3,X
  10961 00DEA6 42 93 0B                     	STA		{11,S},Y
  10962 00DEA9                             .noD3x:
  10963 00DEA9 A9 00 00 00 00               	LDA		#E_Ok
  10964 00DEAE 42 40 10                     	RTC		#16
                                           	;-----------------------------------------------------
                                           	; We get here if there was initially a message
                                           	; available in the mailbox, or a message was made
                                           	; available after a task switch.
                                           	;-----------------------------------------------------
  10970 00DEB1                             .gotMsg:
  10971 00DEB1 42 AB 8F 06 20 05            	STA.H	hMsgTmp
  10972 00DEB7 20 C4 DA                     	JSR		hMsgToAddr
  10973 00DEBA AA                           	TAX
  10974 00DEBB A0 00 00 00 00               	LDY		#0
  10975 00DEC0 A3 03                        	LDA		3,S
  10976 00DEC2 F0 05                        	BEQ		.noD1
  10977 00DEC4 B5 00                        	LDA		MSG_d1,X
  10978 00DEC6 42 93 03                     	STA		{3,S},Y
  10979 00DEC9                             .noD1:
  10980 00DEC9 A3 07                        	LDA		7,S
  10981 00DECB F0 05                        	BEQ		.noD2
  10982 00DECD B5 04                        	LDA		MSG_d2,X
  10983 00DECF 42 93 07                     	STA		{7,S},Y
  10984 00DED2                             .noD2:
  10985 00DED2 A3 0B                        	LDA		11,S
  10986 00DED4 F0 05                        	BEQ		.noD3
  10987 00DED6 B5 08                        	LDA		MSG_d3,X
  10988 00DED8 42 93 0B                     	STA		{11,S},Y
  10989 00DEDB                             .noD3:
  10990 00DEDB A9 01 00 00 00               	LDA		#MT_FREE
  10991 00DEE0 42 8B 95 12                  	STA.B	MSG_type,X
  10992 00DEE4 42 AB AF 0A 20 05            	LDA.H	freeMSG
  10993 00DEEA 42 AB 95 10                  	STA.H	MSG_link,X
  10994 00DEEE 42 AB AF 06 20 05            	LDA.H	hMsgTmp
  10995 00DEF4 42 AB 8F 0A 20 05            	STA.H	freeMSG
  10996 00DEFA 42 AB 42 EE 0E 20 05 00      	INC.H	nMsgBlk
                                         
  10997 00DF02 A9 00 00 00 00               	LDA		#E_Ok
  10998 00DF07 42 40 10                     	RTC		#16
                                           
                                           ;----------------------------------------------------------------------------
                                           ; FMTK_CheckMsg(hMbx,int *d1, int *d2, int *d3, int qrmv);
                                           ;
                                           ;		Check for message at mailbox. If no message is
                                           ;	available return immediately to the caller (CheckMsg() is
                                           ;	non blocking). Optionally removes the message from the
                                           ;	mailbox.
                                           ;
                                           ; Parameters:
                                           ;	.A = handle to mailbox
                                           ;	d1 = address to store d1 in (word on stack)
                                           ;	d2 = address to store d2 in (word on stack)
                                           ;	d3 = address to store d3 in (word on stack)
                                           ;	qrmv = 1=remove message from queue (word on stack)
                                           ;----------------------------------------------------------------------------
                                           
                                           public FMTK_CheckMsg:
  11017 00DF0A 20 B4 DA                     	JSR		hMbxToAddr
  11018 00DF0D B5 01                        	LDA		MBX_owner,X
  11019 00DF0F 30 07                        	BMI		.notOwned
  11020 00DF11 C9 00 04 00 00               	CMP		#NR_MBX
  11021 00DF16 30 08                        	BLT		.ownerOk
  11022 00DF18                             .notOwned:
  11023 00DF18 A9 FF FF FF FF               	LDA		#E_NotAlloc
  11024 00DF1D 42 C0 10                     	RTS		#16
  11025 00DF20                             .ownerOk:
  11026 00DF20 A3 0F                        	LDA		15,S
  11027 00DF22 F0 09                        	BEQ		.0001
  11028 00DF24 42 AB B5 16                  	LDA.H	MBX_number,X
  11029 00DF28 20 26 DB                     	JSR		DequeueMsg
  11030 00DF2B 80 04                        	BRA		.0002
  11031 00DF2D                             .0001:
  11032 00DF2D 42 AB B5 06                  	LDA.H	MBX_mq_head,X
  11033 00DF31                             .0002:
  11034 00DF31 C9 00 00 00 00               	CMP		#0
  11035 00DF36 10 08                        	BPL		.gotMsg
  11036 00DF38 A9 FE FF FF FF               	LDA		#E_NoMsg
  11037 00DF3D 42 40 10                     	RTC		#16
  11038 00DF40                             .gotMsg:
  11039 00DF40 42 AB 8F 06 20 05            	STA.H	hMsgTmp
  11040 00DF46 20 C4 DA                     	JSR		hMsgToAddr
  11041 00DF49 AA                           	TAX
  11042 00DF4A A0 00 00 00 00               	LDY		#0
  11043 00DF4F A3 03                        	LDA		3,S
  11044 00DF51 F0 05                        	BEQ		.noD1
  11045 00DF53 B5 00                        	LDA		MSG_d1,X
  11046 00DF55 42 93 03                     	STA		{3,S},Y
  11047 00DF58                             .noD1:
  11048 00DF58 A3 07                        	LDA		7,S
  11049 00DF5A F0 05                        	BEQ		.noD2
  11050 00DF5C B5 04                        	LDA		MSG_d2,X
  11051 00DF5E 42 93 07                     	STA		{7,S},Y
  11052 00DF61                             .noD2:
  11053 00DF61 A3 0B                        	LDA		11,S
  11054 00DF63 F0 05                        	BEQ		.noD3
  11055 00DF65 B5 08                        	LDA		MSG_d3,X
  11056 00DF67 42 93 0B                     	STA		{11,S},Y
  11057 00DF6A                             .noD3:
  11058 00DF6A A3 0F                        	LDA		15,S
  11059 00DF6C F0 27                        	BEQ		.noRmv
  11060 00DF6E A9 01 00 00 00               	LDA		#MT_FREE
  11061 00DF73 42 8B 95 12                  	STA.B	MSG_type,X
  11062 00DF77 42 AB AF 0A 20 05            	LDA.H	freeMSG
  11063 00DF7D 42 AB 95 10                  	STA.H	MSG_link,X
  11064 00DF81 42 AB AF 06 20 05            	LDA.H	hMsgTmp
  11065 00DF87 42 AB 8F 0A 20 05            	STA.H	freeMSG
  11066 00DF8D 42 AB 42 EE 0E 20 05 00      	INC.H	nMsgBlk
                                         
  11067 00DF95                             .noRmv:
  11068 00DF95 A9 00 00 00 00               	LDA		#E_Ok
  11069 00DF9A 42 40 10                     	RTC		#16
                                           
                                           ;----------------------------------------------------------------------------
                                           ; PeekMsg(hMbx,int *d1, int *d2, int *d3);
                                           ;
                                           ; Checks for a message without removing it from the queue.
                                           ;----------------------------------------------------------------------------
                                           
                                           public FMTK_PeekMsg:
  11078 00DF9D 8F 04 20 05                  	STA		hMbxTmp
  11079 00DFA1 A9 00 00 00 00               	LDA		#0
  11080 00DFA6 48                           	PHA
  11081 00DFA7 BA                           	TSX
  11082 00DFA8 B5 0B                        	LDA		11,X
  11083 00DFAA 48                           	PHA
  11084 00DFAB B5 0B                        	LDA		11,X
  11085 00DFAD 48                           	PHA
  11086 00DFAE B5 0B                        	LDA		11,X
  11087 00DFB0 48                           	PHA
  11088 00DFB1 AF 04 20 05                  	LDA		hMbxTmp
  11089 00DFB5 20 C2 DF                     	JSR		UnlockSysSema
  11090 00DFB8 20 0A DF                     	JSR		FMTK_CheckMsg
  11091 00DFBB 42 40 0C                     	RTC		#12
                                           
Finitron FT832 assembler   version 1.4   Mon Jun 05 03:19:34 2017     Page 1
FTBios816.asm


                                           .include "FMTKmsg.asm"
                                           
                                           	MEM		32
                                           	NDX		32
                                           
  11097 00DFBE                             LockSysSema:
  11098 00DFBE 42 78 01                     	SEI		#1
  11099 00DFC1 60                           	RTS
  11100 00DFC2                             UnlockSysSema:
  11101 00DFC2 58                           	CLI		; SEI #0
  11102 00DFC3 60                           	RTS
                                           
                                           	MEM		32
                                           	NDX		32
  11106 00DFC4                             SetIOFocus:
  11107 00DFC4 85 CE                        	STA		IOFocusTask
  11108 00DFC6 42 40 00                     	RTC		#0
  11109 00DFC9 82 A0 E1                     	BRL		TaskFD
  11110 00DFCC                             GetIOFocus:
  11111 00DFCC A5 CE                        	LDA		IOFocusTask
  11112 00DFCE 42 40 00                     	RTC		#0
  11113 00DFD1 82 98 E1                     	BRL		TaskFD
                                           
                                           ; Returns:
                                           ; .ZF = 1 if task has IO focus
                                           
  11118 00DFD4                             CheckIOFocus:
  11119 00DFD4 42 AB AF 00 20 05            	LDA.H	running_task
  11120 00DFDA 42 AB C5 CE                  	CMP.H	IOFocusTask
  11121 00DFDE 42 40 00                     	RTC		#0
                                           
  11123 00DFE1                             RequestIOFocus:
  11124 00DFE1 42 24 52 20 05 00            	BMS		IOFocusBmp
  11125 00DFE7 42 40 00                     	RTC		#0
                                           
  11127 00DFEA                             ReleaseIOFocus:
  11128 00DFEA 42 34 52 20 05 00            	BMC		IOFocusBmp
  11129 00DFF0 42 40 00                     	RTC		#0
                                           
  11131 00DFF3                             TestIOFocus:
  11132 00DFF3 42 14 52 20 05 00            	BMT		IOFocusBmp
  11133 00DFF9 42 40 00                     	RTC		#0
                                           
                                           	; Get the handle of the currently active JCB. This will be the one for
                                           	; which the running task is owned by.
  11137 00DFFC                             GetJCB:
  11138 00DFFC 42 AB AF 00 20 05            	LDA.H	running_task
  11139 00E002 20 A4 DA                     	JSR		hTcbToAddr
  11140 00E005 DA                           	PHX
  11141 00E006 AA                           	TAX
  11142 00E007 42 8B B5 27                  	LDA.B	TCB_hJcb,X
  11143 00E00B FA                           	PLX
  11144 00E00C 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Sleep
                                           ;	Put task to sleep.
                                           ; Parameters:
                                           ;	.A	length of time to sleep
                                           ;----------------------------------------------------------------------------
                                           
  11153 00E00D                             FMTK_Sleep:
  11154 00E00D 48                           		PHA
  11155 00E00E 42 AB AF 00 20 05            		LDA.H	running_task
  11156 00E014 42 AB 8F 02 C3 FE            		STA.H	TIMEOUT_LIST+2
  11157 00E01A 20 A4 DA                     		JSR		hTcbToAddr
  11158 00E01D AA                           		TAX
  11159 00E01E A9 08 00 00 00               		LDA		#TS_TIMEOUT
  11160 00E023 95 25                        		STA		TCB_status,X
  11161 00E025 68                           		PLA
  11162 00E026 8F 04 C3 FE                  		STA		TIMEOUT_LIST+4
  11163 00E02A A9 02 00 00 00               		LDA		#TOL_INS
  11164 00E02F 42 8B 8F 00 C3 FE            		STA.B	TIMEOUT_LIST
  11165 00E035 42 40 00                     		RTC		#0
                                           
                                           ;----------------------------------------------------------------------------
                                           ; FMTK_KillTask:
                                           ;	Kill a task.
                                           ;----------------------------------------------------------------------------
                                           
  11172 00E038                             FMTK_KillTask:
  11173 00E038 20 3E E0                     		JSR		KillTask
  11174 00E03B 42 40 00                     		RTC		#0
  11175 00E03E                             KillTask:
  11176 00E03E 48                           		PHA
  11177 00E03F 42 AB 8F 02 C3 FE            		STA.H	TIMEOUT_LIST+2	; remove task from timeout list (it might be on)
  11178 00E045 A9 03 00 00 00               		LDA		#TOL_RMV
  11179 00E04A 42 8B 8F 00 C3 FE            		STA.B	TIMEOUT_LIST
  11180 00E050 68                           		PLA
  11181 00E051 48                           		PHA
  11182 00E052 20 A4 DA                     		JSR		hTcbToAddr
  11183 00E055 AA                           		TAX
  11184 00E056 74 25                        		STZ		TCB_status,X	; remove task from ready list
                                           		; Remove task from Job's task list
  11186 00E058 42 8B B5 27                  		LDA.B	TCB_hJcb,X
  11187 00E05C 20 94 DA                     		JSR		hJcbToAddr
  11188 00E05F AA                           		TAX
  11189 00E060 68                           		PLA						; .A = taskno
  11190 00E061 A0 00 00 00 00               		LDY		#0
  11191 00E066                             .0002:
  11192 00E066 DA                           		PHX
  11193 00E067 48                           		PHA
  11194 00E068 98                           		TYA						; setup for X+Y addressing
  11195 00E069 42 8A                        		AAX
  11196 00E06B 68                           		PLA
  11197 00E06C 42 AB DD 5C 03               		CMP.H	JCB_tasks,X
  11198 00E071 D0 0A                        		BNE		.0001
  11199 00E073 42 AB 9E 5C 03               		STZ.H	JCB_tasks,X		; set field to -1
  11200 00E078 42 AB DE 5C 03               		DEC.H	JCB_tasks,X
  11201 00E07D FA                          .0001:	
  11202 00E07E C8                           		INY
  11203 00E07F C8                           		INY
  11204 00E080 C0 10 00 00 00               		CPY		#16
  11205 00E085 30 DF                        		BLT		.0002
                                           		; The Job is finished if there are no more tasks associated with it.
  11207 00E087 A0 00 00 00 00               		LDY		#0
  11208 00E08C                             .0003:
  11209 00E08C DA                           		PHX
  11210 00E08D 98                           		TYA
  11211 00E08E 42 8A                        		AAX
  11212 00E090 42 AB BD 5C 03               		LDA.H	JCB_tasks,X
  11213 00E095 10 20                        		BPL		.notDoneJob
  11214 00E097 FA                           		PLX
  11215 00E098 C8                           		INY
  11216 00E099 C8                           		INY
  11217 00E09A C0 10 00 00 00               		CPY		#16
  11218 00E09F 30 EB                        		BLT		.0003
                                           		; Done the job, add the jcb to the free list.
  11220 00E0A1 42 8B AF 0C 20 05            		LDA.B	freeJCB
  11221 00E0A7 42 8B 9D 5E 03               		STA.B	JCB_next,X
  11222 00E0AC 42 8B B5 22                  		LDA.B	TCB_number,X
  11223 00E0B0 42 8B 8F 0C 20 05            		STA.B	freeJCB
  11224 00E0B6 60                           		RTS
  11225 00E0B7                             .notDoneJob:
  11226 00E0B7 FA                           		PLX
  11227 00E0B8 60                           		RTS
                                           
  11229 00E0B9                             FMTK_ExitTask:
  11230 00E0B9 42 AB AF 00 20 05            		LDA.H	running_task
  11231 00E0BF 20 3E E0                     		JSR		KillTask
  11232 00E0C2 82 9F 00                     		BRL		FMTK_ScheduleTask
                                           
                                           ;----------------------------------------------------------------------------
                                           ; SelectTaskToRun:
                                           ;
                                           ; Selects a task to run from the ready fifo. The ready fifo is really a 
                                           ; group of fifos, one each for a priority group. Priority groups are
                                           ; priorities of: $0x, $1x, $2x, $3x, $4x
                                           ;
                                           ; Returns
                                           ;	.A = task number to run
                                           ; Modifies:
                                           ;	.X, .Y, and flags
                                           ;----------------------------------------------------------------------------
                                           
  11247 00E0C5                             StartQ:
  11248 00E0C5 00 01 00 02 00 03 00 04      	.byte	0,1,0,2,0,3,0,4,0,1,0,2,0,3,0,4
  11248 00E0CD 00 01 00 02 00 03 00 04    
                                         
                                           
  11250 00E0D5                             SelectTaskToRun:
  11251 00E0D5 A9 04 00 00 00               	LDA		#4
  11252 00E0DA 42 8B 85 CC                  	STA.B	qcnt
  11253 00E0DE 42 8B A5 04                  	LDA.B	TickCount		; vary the starting queue to check
  11254 00E0E2 29 0F 00 00 00               	AND		#$0F			; based on the tick count
  11255 00E0E7 A8                           	TAY
  11256 00E0E8 42 8B B9 C5 E0               	LDA.B	StartQ,Y
  11257 00E0ED 0A                           	ASL
  11258 00E0EE AA                           	TAX
  11259 00E0EF                             .nextQ:
  11260 00E0EF                             .notReady:
  11261 00E0EF 42 AB BF 10 C2 FE            	LDA.H	READY_FIFO_CNT,X	; get count of ready tasks in fifo
  11262 00E0F5 F0 22                        	BEQ		.fifoEmpty
  11263 00E0F7 42 AB BF 00 C2 FE            	LDA.H	READY_FIFO,X	; get ready task from fifo
  11264 00E0FD 20 A4 DA                     	JSR		hTcbToAddr
  11265 00E100 A8                           	TAY
  11266 00E101 42 8B B9 25 00               	LDA.B	TCB_status,Y	; check the status and make sure it's ready
  11267 00E106 89 03 00 00 00               	BIT		#TS_READY|TS_PREEMPT
  11268 00E10B F0 E2                        	BEQ		.notReady
  11269 00E10D 42 AB B9 22 00               	LDA.H	TCB_number,Y
  11270 00E112 42 AB 9F 00 C2 FE            	STA.H	READY_FIFO,X	; add back to fifo as last entry
  11271 00E118 60                           	RTS
                                           
                                           	; move to the next queue
  11274 00E119                             .fifoEmpty:
  11275 00E119 E8                           	INX
  11276 00E11A E8                           	INX
  11277 00E11B E0 0A 00 00 00               	CPX		#10
  11278 00E120 30 05                        	BLT		.0001
  11279 00E122 A2 00 00 00 00               	LDX		#0				; cycle back around to first Q
  11280 00E127                             .0001:
  11281 00E127 42 8B C6 CC                  	DEC.B	qcnt
  11282 00E12B D0 C2                        	BNE		.nextQ
  11283 00E12D AF 00 20 05                  	LDA		running_task	; if all queues empty, keep running the current
  11284 00E131 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Insert task into ready fifo.
                                           ;
                                           ; If the task has a bad priority setting then it's added as a lowest
                                           ; priority task, priority zero. It's desired for the task to run even if
                                           ; the priority is screwy.
                                           ;
                                           ; Parameters:
                                           ;	.A = handle to TCB
                                           ; Modifies:
                                           ;	.X = priority queue index
                                           ;----------------------------------------------------------------------------
                                           
  11299 00E132                             InsertIntoReadyFifo:
  11300 00E132 48                           	PHA
  11301 00E133 20 A4 DA                     	JSR		hTcbToAddr
  11302 00E136 AA                           	TAX							; .X = task number (index into tables)
  11303 00E137 A9 01 00 00 00               	LDA		#TS_READY			; set task status to ready
  11304 00E13C 42 8B 95 25                  	STA.B	TCB_status,X
  11305 00E140 42 8B B5 24                  	LDA.B	TCB_priority,X		; get the priority
  11306 00E144 4A                           	LSR							; use upper nybble to identify priority que
  11307 00E145 4A                           	LSR
  11308 00E146 4A                           	LSR
  11309 00E147 4A                           	LSR
  11310 00E148 C9 04 00 00 00               	CMP		#4					; valid priority ?
  11311 00E14D 42 B0 05                     	BLE		.0001
  11312 00E150 A9 00 00 00 00               	LDA		#0
  11313 00E155                             .0001:
  11314 00E155 0A                           	ASL
  11315 00E156 AA                           	TAX
  11316 00E157 68                           	PLA
  11317 00E158 42 AB 9F 00 C2 FE            	STA.H	READY_FIFO,X
  11318 00E15E 60                           	RTS
                                           
                                           ; IRQ routine for all modes. The interrupted task must of had interrupts
                                           ; enabled and this status should be saved on the stack with the value of
                                           ; the status register. The RTI instruction will pop the status register off
                                           ; the stack and restore the interrupt enable.
                                           ; Note that all this routine does is switch to a task which has a different
                                           ; register set, so there's no need to stack and restore registers. The
                                           ; task switch also allows the routine to be located anywhere in the memory
                                           ; system, so we don't have to worry about using up bank 0 memory.
                                           
  11329 00E15F                             IRQRout832:
  11330 00E15F                             IRQRout816:
  11331 00E15F                             IRQRout02:
  11332 00E15F 42 A2 01 00                  	TSK		#1			; switch to the interrupt handling task
  11333 00E163 40                           	RTI
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Select a task to run from the ready queue.
                                           ; Called by some OS primitives
                                           ; Even if the task was preempted a regular RTT instruction is used to
                                           ; return. This is because this function was called via JCR.
                                           ;----------------------------------------------------------------------------
                                           
  11342 00E164                             FMTK_ScheduleTask:
                                           	; Got here via a JCR which pushed the return context. It's not needed
  11344 00E164 68                           	PLA						; get rid of return context
                                           	; update the number of tick the task has been running.
  11346 00E165 42 AB AF 00 20 05            	LDA.H	running_task	; get currently running task
  11347 00E16B 20 A4 DA                     	JSR		hTcbToAddr		; get address from handle
  11348 00E16E AA                           	TAX
  11349 00E16F A5 04                        	LDA		TickCount		; get the tick count
  11350 00E171 95 2C                        	STA		TCB_end_tick,X	; store it in end ticks
  11351 00E173 38                           	SEC
  11352 00E174 F5 28                        	SBC		TCB_start_tick,X; subtract off the latest starting tick
  11353 00E176 18                           	CLC						; to get the difference 
  11354 00E177 75 30                        	ADC		TCB_ticks,X		; ticks = ticks + (end tick - start tick)
  11355 00E179 95 30                        	STA		TCB_ticks,X
  11356 00E17B 20 D5 E0                     	JSR		SelectTaskToRun
  11357 00E17E 42 AB 83 03                  	STA.H	$3,S			; change return task # on stack
  11358 00E182 42 AB 8F 00 20 05            	STA.H	running_task
  11359 00E188 20 A4 DA                     	JSR		hTcbToAddr		; handle to address
  11360 00E18B AA                           	TAX
  11361 00E18C A9 01 00 00 00               	LDA		#TS_READY		; reset task status to ready
  11362 00E191 42 8B 95 25                  	STA.B	TCB_status,X
  11363 00E195 A5 04                        	LDA		TickCount		; get the tick count
  11364 00E197 95 28                        	STA		TCB_start_tick,X	; update starting tick
  11365 00E199 42 40 00                     	RTC		#0				; return
  11366 00E19C 80 C6                        	BRA		FMTK_ScheduleTask
                                           
                                           ;----------------------------------------------------------------------------
                                           ; This task has interrupts masked in it's startup record and therefore runs
                                           ; with interrupts masked as the task never enables interrupts. Note that it's
                                           ; important that interrupts are masked while this is running, otherwise the
                                           ; uncleared interrupt status would cause another interrupt resulting in an
                                           ; infinite interrupt loop.
                                           ;
                                           ; This task always needs to return using a RTI in order to keep the internal
                                           ; IRQ state stack in sync.
                                           ;----------------------------------------------------------------------------
  11378 00E19E                             Task1:
                                           	; Counter #1 is set to interrupt at a 50Hz rate
                                           ;	LDA		#$2A	;94		; divide by 95794 (for 50Hz)
                                           ;	STA.B	CTR1_LMT		; FFFFFE = 2Hz with 33MHz clock
                                           ;	LDA		#$2C	;57		; 
                                           ;	STA.B	CTR1_LMT+1
                                           ;	LDA		#$0A	;09
                                           ;	STA.B	CTR1_LMT+2
                                           ;	LDA		#$05		; count down, on mpu clock, irq disenabled
                                           ;	STA.B	CTR1_CTRL
                                           ;	RTT					; falls through on next task activation
                                           
  11390 00E19E                             TimeSliceIRQ:
  11391 00E19E 42 8B AD 1F B0               	LDA.B	MPU_IRQ_STATUS	; check if counter expired
  11392 00E1A3 89 02 00 00 00               	BIT		#2				; counter #1 IRQ active bit
  11393 00E1A8 F0 FF 87 00                  	LBEQ	.notTimeSlice	; no IRQ ?
                                           
                                           	; update the tick count
  11396 00E1AC A5 04                        	LDA		TickCount		; increment the tick count
  11397 00E1AE 1A                           	INA						; lower 16 bits
  11398 00E1AF 85 04                        	STA		TickCount
  11399 00E1B1 42 3B FF 0F 42 8B 8F A4      	STA.B	$FFF:$D00A4		; update on-screen IRQ live indicator
  11399 00E1B9 00 0D                      
                                           
                                           	; clear the IRQ source
  11402 00E1BB A9 05 00 00 00               	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
  11403 00E1C0 42 8B 8D 17 B0               	STA.B	CTR1_CTRL		; set control register clearing interrupt
                                           
                                           	; Set flag for EhBASIC Irq
  11406 00E1C5 42 8B AF DF 00 01            	LDA.B	$100DF		
  11407 00E1CB 09 20 00 00 00               	ORA		#$20
  11408 00E1D0 42 8B 8F DF 00 01            	STA.B	$100DF
                                           	
                                           	; and set the task status to PREEMPT
  11411 00E1D6 42 AB AF 00 20 05            	LDA.H	running_task
  11412 00E1DC 20 A4 DA                     	JSR		hTcbToAddr		; get address from handle
  11413 00E1DF AA                           	TAX
  11414 00E1E0 A5 04                        	LDA		TickCount		; get the tick count
  11415 00E1E2 95 2C                        	STA		TCB_end_tick,X	; store it in end ticks
  11416 00E1E4 38                           	SEC
  11417 00E1E5 F5 28                        	SBC		TCB_start_tick,X; subtract off the latest starting tick
  11418 00E1E7 18                           	CLC						; to get the difference 
  11419 00E1E8 75 30                        	ADC		TCB_ticks,X		; ticks = ticks + (end tick - start tick)
  11420 00E1EA 95 30                        	STA		TCB_ticks,X
  11421 00E1EC A9 02 00 00 00               	LDA		#TS_PREEMPT
  11422 00E1F1 42 8B 95 25                  	STA.B	TCB_status,X	; set status of outgoing task to PREEMPT
                                           
                                           	; take care of the timeout list
  11425 00E1F5                             .nextTo:
  11426 00E1F5 A9 01 00 00 00               	LDA		#TOL_DEC		; .A = decrement command #
  11427 00E1FA 42 8B 8F 00 C3 FE            	STA.B	TIMEOUT_LIST	; decrement the timeout list
  11428 00E200 EA                           	NOP						; might take up to 3 clock cycles
  11429 00E201 EA                           	NOP
  11430 00E202 42 AB AF 02 C3 FE            	LDA.H	TIMEOUT_LIST+2	; get any timedout task
  11431 00E208 30 05                        	BMI		.noMoreTos
  11432 00E20A 20 32 E1                     	JSR		InsertIntoReadyFifo	; placed timedout task on ready list
  11433 00E20D 80 E6                        	BRA		.nextTo
                                           
                                           	; Switch to the next task to run
  11436 00E20F                             .noMoreTos:
  11437 00E20F 42 8B A5 D0                  	LDA.B	TaskSwitchEn	; only switch tasks if enabled
  11438 00E213 F0 1A                        	BEQ		.0001
  11439 00E215 20 D5 E0                     	JSR		SelectTaskToRun
  11440 00E218 BA                           	TSX
  11441 00E219 42 AB B4 01                  	LDY.H	$1,X			; .Y = outgoing task
  11442 00E21D 42 AB 95 01                  	STA.H	$1,X			; change return task # on stack
  11443 00E221 42 AB 8F 00 20 05            	STA.H	running_task	; update running task var
  11444 00E227 20 A4 DA                     	JSR		hTcbToAddr		; convert task handle to address
  11445 00E22A AA                           	TAX
  11446 00E22B A5 04                        	LDA		TickCount		; update starting tick for task
  11447 00E22D 95 28                        	STA		TCB_start_tick,X
  11448 00E22F                             .0001:
  11449 00E22F 40                           	RTI						; return from interrupt
  11450 00E230 82 6B FF                     	BRL		TimeSliceIRQ	; the next time task1 is run it will start here
                                           
                                           ; We get here if it wasn't a timeslice interrupt. There still might be other
                                           ; devices tied to the same IRQ line which need servicing.
                                           
  11455 00E233                             .notTimeSlice:
  11456 00E233 A2 00 00 00 00               	LDX		#0
  11457 00E238                             .0002:
  11458 00E238 BF 12 20 05                  	LDA		IRQ1Hook,X		; get the hook pointer
  11459 00E23C F0 04                        	BEQ		.noHook			; check if valid
  11460 00E23E DA                           	PHX						; save off .X
  11461 00E23F 42 80                        	JCI						; call the hook routine
  11462 00E241 FA                           	PLX						; restore .X
  11463 00E242                             .noHook:
  11464 00E242 42 E8                        	INX4					; move to next hook
  11465 00E244 E0 40 00 00 00               	CPX		#MAX_IRQ_HOOKS*4
  11466 00E249 D0 ED                        	BNE		.0002			; last allowed hook ?
  11467 00E24B 40                           	RTI
  11468 00E24C 82 4F FF                     	BRL		TimeSliceIRQ	; the next time task1 is run it will start here
                                           
                                           ;============================================================================
                                           ; End Of Multi-tasking kernel
                                           ;============================================================================
                                           
                                           	MEM		16
                                           	NDX		16
  11476 00E24F                             BtnuIRQ:
  11477 00E24F 42 3B FF 0F 42 8B AF A0      	LDA.B	$FFF:$D00A0
  11477 00E257 00 0D                      
  11478 00E259 1A                           	INA
  11479 00E25A 42 3B FF 0F 42 8B 8F A0      	STA.B	$FFF:$D00A0
  11479 00E262 00 0D                      
                                           ;	JSR		spi_master_init
                                           ;	CMP		#0
                                           ;	BNE		.0001
                                           ;	LDX		#0
                                           ;.0002:
                                           ;	PEA		$000F
                                           ;	TXA
                                           ;	XBA
                                           ;	ASL
                                           ;	PHA
                                           ;	PEA		0
                                           ;	PEA		0
                                           ;	STX		reg_x
                                           ;	JSR		spi_master_read
                                           ;	LDX		reg_x
                                           ;	INX
                                           ;	CPX		#128
                                           ;	BNE		.0002
                                           ;.0001:
  11499 00E264 40                           	RTI
  11500 00E265 80 E8                        	BRA		BtnuIRQ
                                           
                                           ; IRQ handler task - 32 bit
                                           ;
  11504 00E267                             IRQTask:
                                           	MEM		8
                                           	NDX		32
  11507 00E267                             IRQTask1:
  11508 00E267 AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
  11509 00E26A 89 02                        	BIT		#2
  11510 00E26C F0 16                        	BEQ		.0001
  11511 00E26E A6 04                        	LDX		TickCount		; increment the tick count
  11512 00E270 E8                           	INX
  11513 00E271 86 04                        	STX		TickCount
  11514 00E273 42 3B FF 0F 42 8B 42 8E      	STX.B	$FFF:$D00A2			; update on-screen IRQ live indicator
  11514 00E27B A2 00 0D 00                
  11515 00E27F A9 05                        	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
  11516 00E281 8D 17 B0                     	STA		CTR1_CTRL
  11517 00E284                             .0001:
  11518 00E284 42 60                        	RTT					; go back to interrupted task
  11519 00E286 80 DF                        	BRA		IRQTask1	; the next time task is run it will start here
                                           
                                           ; This little task sample runs in native 32 bit mode and displays
                                           ; "Hello World!" on the screen.
                                           
                                           	CPU		FT832
                                           	MEM		8
                                           	NDX		32
                                           
  11528 00E288                             Task2:
  11529 00E288 A2 F8 01 00 00               	LDX		#84*2*3
  11530 00E28D                             .0003:
  11531 00E28D A0 00 00 00 00               	LDY		#0
  11532 00E292                             .0002:
  11533 00E292 42 1B B9 AD E2               	LDA		CS:msgHelloWorld,Y
  11534 00E297 F0 10                        	BEQ		.0001
  11535 00E299 20 0B CB                     	JSR		AsciiToScreen8
  11536 00E29C 42 3B FF 0F 9F 00 00 0D      	STA		$FFF:VIDBUF,X
                                         
  11537 00E2A4 E8                           	INX
  11538 00E2A5 E8                           	INX
  11539 00E2A6 C8                           	INY
  11540 00E2A7 80 E9                        	BRA		.0002
  11541 00E2A9                             .0001:
  11542 00E2A9 42 60                        	RTT
  11543 00E2AB 80 E0                        	BRA		.0003
                                           
  11545 00E2AD                             msgHelloWorld:
  11546 00E2AD 0D 0A 48 65 6C 6C 6F 20      	.byte	CR,LF,"Hello World!",CR,LF,0
  11546 00E2B5 57 6F 72 6C 64 21 0D 0A    
  11546 00E2BD 00                         
                                           
                                           	NDX		16
                                           	MEM		16
                                           
  11551 00E2BE                             BrkTask:
  11552 00E2BE 42 EE 00 00 D0 FF            	INC		$FFD00000
  11553 00E2C4 42 60                        	RTT
  11554 00E2C6 80 F6                        	BRA		BrkTask
                                           
                                           ; The following store sequence for the benefit of Supermon816
                                           ;
  11558 00E2C8                             BrkRout:
  11559 00E2C8 0B                           	PHD
  11560 00E2C9 8B                           	PHB
  11561 00E2CA C2 30                        	REP		#$30
  11562 00E2CC 48                           	PHA
  11563 00E2CD DA                           	PHX
  11564 00E2CE 5A                           	PHY
  11565 00E2CF 6C 02 01                     	JMP		($0102)		; This jump normally points to BrkRout1
                                           
  11567 00E2D2                             BrkRout1:
  11568 00E2D2 C2 30                        	REP		#$30
  11569 00E2D4 7A                           	PLY
  11570 00E2D5 FA                           	PLX
  11571 00E2D6 68                           	PLA
  11572 00E2D7 AB                           	PLB
  11573 00E2D8 2B                           	PLD
  11574 00E2D9 E2 20                        	SEP		#$20
  11575 00E2DB 68                           	PLA
  11576 00E2DC C2 30                        	REP		#$30
  11577 00E2DE 68                           	PLA
  11578 00E2DF 20 13 CE                     	JSR		DispWord
  11579 00E2E2 A2 00 00                     	LDX		#0
  11580 00E2E5 A0 40 00                     	LDY		#64
  11581 00E2E8                             .0001:
  11582 00E2E8 42 F0                        	.word	$f042		; pchist
  11583 00E2EA 20 13 CE                     	JSR		DispWord
  11584 00E2ED A9 20 00                     	LDA		#' '
  11585 00E2F0 20 14 CD                     	JSR		OutChar
  11586 00E2F3 E8                           	INX
  11587 00E2F4 88                           	DEY
  11588 00E2F5 D0 F1                        	BNE		.0001
  11589 00E2F7 A9 FF FF                     	LDA		#$FFFF
  11590 00E2FA 8D 00 70                     	STA		$7000
  11591 00E2FD                             Hung:
  11592 00E2FD 80 FE                        	BRA		Hung
                                           
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------
                                           	; I/O page is located at $F0xx
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------	
                                           	;org		$F100
                                           
  11601 00E2FF                             LineTbl:
  11602 00E2FF 00 00                        	.WORD	0
  11603 00E301 54 00                        	.WORD	TEXTCOLS
  11604 00E303 A8 00                        	.WORD	TEXTCOLS*2
  11605 00E305 FC 00                        	.WORD	TEXTCOLS*3
  11606 00E307 50 01                        	.WORD	TEXTCOLS*4
  11607 00E309 A4 01                        	.WORD	TEXTCOLS*5
  11608 00E30B F8 01                        	.WORD	TEXTCOLS*6
  11609 00E30D 4C 02                        	.WORD	TEXTCOLS*7
  11610 00E30F A0 02                        	.WORD	TEXTCOLS*8
  11611 00E311 F4 02                        	.WORD	TEXTCOLS*9
  11612 00E313 48 03                        	.WORD	TEXTCOLS*10
  11613 00E315 9C 03                        	.WORD	TEXTCOLS*11
  11614 00E317 F0 03                        	.WORD	TEXTCOLS*12
  11615 00E319 44 04                        	.WORD	TEXTCOLS*13
  11616 00E31B 98 04                        	.WORD	TEXTCOLS*14
  11617 00E31D EC 04                        	.WORD	TEXTCOLS*15
  11618 00E31F 40 05                        	.WORD	TEXTCOLS*16
  11619 00E321 94 05                        	.WORD	TEXTCOLS*17
  11620 00E323 E8 05                        	.WORD	TEXTCOLS*18
  11621 00E325 3C 06                        	.WORD	TEXTCOLS*19
  11622 00E327 90 06                        	.WORD	TEXTCOLS*20
  11623 00E329 E4 06                        	.WORD	TEXTCOLS*21
  11624 00E32B 38 07                        	.WORD	TEXTCOLS*22
  11625 00E32D 8C 07                        	.WORD	TEXTCOLS*23
  11626 00E32F E0 07                        	.WORD	TEXTCOLS*24
  11627 00E331 34 08                        	.WORD	TEXTCOLS*25
  11628 00E333 88 08                        	.WORD	TEXTCOLS*26
  11629 00E335 DC 08                        	.WORD	TEXTCOLS*27
  11630 00E337 30 09                        	.WORD	TEXTCOLS*28
  11631 00E339 84 09                        	.WORD	TEXTCOLS*29
  11632 00E33B D8 09                        	.WORD	TEXTCOLS*30
                                           
  11634 00E33D                             TaskStartTbl:
  11635 00E33D 00 00                        	.WORD	0			; CS
  11636 00E33F 00 00                        	.WORD	0			; DS
  11637 00E341 00 00                        	.WORD	0			; SS
  11638 00E343 C4 C0                        	.WORD	Task0		; PC
  11639 00E345 00                           	.BYTE	Task0>>16	; PB
  11640 00E346 00 00                        	.WORD	0			; acc
  11641 00E348 00 00                        	.WORD	0
  11642 00E34A 00 00                        	.WORD	0			; x
  11643 00E34C 00 00                        	.WORD	0
  11644 00E34E 00 00                        	.WORD	0			; y
  11645 00E350 00 00                        	.WORD	0
  11646 00E352 FF 3F                        	.WORD	$3FFF		; sp
  11647 00E354 00 00                        	.WORD	0
  11648 00E356 04                           	.BYTE	4			; SR	( 16 bit regs )
  11649 00E357 01                           	.BYTE	1			; SR extension ( 16 bit mode)
  11650 00E358 00                           	.BYTE	0			; DB
  11651 00E359 00 00                        	.WORD	0			; DPR
  11652 00E35B 00 00                        	.WORD	0
                                           
                                           	; TASK #1
                                           	; Interrupt handler task
  11656 00E35D 00 00                        	.WORD	0			; CS
  11657 00E35F 05 00                        	.WORD	5			; DS
  11658 00E361 05 00                        	.WORD	5			; SS
  11659 00E363 9E E1                        	.WORD	Task1		; PC
  11660 00E365 00                           	.BYTE	Task1>>16
  11661 00E366 00 00                        	.WORD	0			; acc
  11662 00E368 00 00                        	.WORD	0
  11663 00E36A 00 00                        	.WORD	0			; x
  11664 00E36C 00 00                        	.WORD	0
  11665 00E36E 00 00                        	.WORD	0			; y
  11666 00E370 00 00                        	.WORD	0
  11667 00E372 FF 3B                        	.WORD	$3BFF		; sp
  11668 00E374 00 00                        	.WORD	0
  11669 00E376 04                           	.BYTE	4			; SR	(32 bit regs)
  11670 00E377 02                           	.BYTE	2			; SR extension	(32 bit mode)
  11671 00E378 00                           	.BYTE	0			; DB
  11672 00E379 00 00                        	.WORD	0			; DPR
  11673 00E37B 00 00                        	.WORD	0
                                           
  11675 00E37D 00 00                        	.WORD	0			; CS
  11676 00E37F 00 00                        	.WORD	0			; DS
  11677 00E381 00 00                        	.WORD	0			; SS
  11678 00E383 88 E2                        	.WORD	Task2		; PC
  11679 00E385 00                           	.BYTE	Task2>>16
  11680 00E386 00 00                        	.WORD	0			; acc
  11681 00E388 00 00                        	.WORD	0
  11682 00E38A 00 00                        	.WORD	0			; x
  11683 00E38C 00 00                        	.WORD	0
  11684 00E38E 00 00                        	.WORD	0			; y
  11685 00E390 00 00                        	.WORD	0
  11686 00E392 FF 37                        	.WORD	$37FF		; sp
  11687 00E394 00 00                        	.WORD	0
  11688 00E396 20                           	.BYTE	$20			; SR			; eight bit mem
  11689 00E397 02                           	.BYTE	2			; SR extension
  11690 00E398 00                           	.BYTE	0			; DB
  11691 00E399 00 00                        	.WORD	0			; DPR
  11692 00E39B 00 00                        	.WORD	0
                                           
                                           	; TASK #3
                                           	; Button Interrupt handler task
  11696 00E39D 00 00                        	.WORD	0			; CS
  11697 00E39F 05 00                        	.WORD	5			; DS
  11698 00E3A1 05 00                        	.WORD	5			; SS
  11699 00E3A3 4F E2                        	.WORD	BtnuIRQ		; PC
  11700 00E3A5 00                           	.BYTE	BtnuIRQ>>16
  11701 00E3A6 00 00                        	.WORD	0			; acc
  11702 00E3A8 00 00                        	.WORD	0
  11703 00E3AA 00 00                        	.WORD	0			; x
  11704 00E3AC 00 00                        	.WORD	0
  11705 00E3AE 00 00                        	.WORD	0			; y
  11706 00E3B0 00 00                        	.WORD	0
  11707 00E3B2 FF 3A                        	.WORD	$3AFF		; sp
  11708 00E3B4 00 00                        	.WORD	0
  11709 00E3B6 04                           	.BYTE	4			; SR
  11710 00E3B7 01                           	.BYTE	1			; SR extension
  11711 00E3B8 00                           	.BYTE	0			; DB
  11712 00E3B9 00 00                        	.WORD	0			; DPR
  11713 00E3BB 00 00                        	.WORD	0
                                           
  11715 00E3BD 00 00                        	.WORD	0			; CS
  11716 00E3BF 00 00                        	.WORD	0			; DS
  11717 00E3C1 00 00                        	.WORD	0			; SS
  11718 00E3C3 BE E2                        	.WORD	BrkTask		; PC
  11719 00E3C5 00                           	.BYTE	BrkTask>>16
  11720 00E3C6 00 00                        	.WORD	0			; acc
  11721 00E3C8 00 00                        	.WORD	0
  11722 00E3CA 00 00                        	.WORD	0			; x
  11723 00E3CC 00 00                        	.WORD	0
  11724 00E3CE 00 00                        	.WORD	0			; y
  11725 00E3D0 00 00                        	.WORD	0
  11726 00E3D2 FF 2F                        	.WORD	$2FFF		; sp
  11727 00E3D4 00 00                        	.WORD	0
  11728 00E3D6 00                           	.BYTE	0			; SR
  11729 00E3D7 01                           	.BYTE	1			; SR extension
  11730 00E3D8 00                           	.BYTE	0			; DB
  11731 00E3D9 00 00                        	.WORD	0			; DPR
  11732 00E3DB 00 00                        	.WORD	0
                                           
                                           	; task #5
                                           	; DS is placed at $7800
  11736 00E3DD 00 00                        	.WORD	0			; CS
  11737 00E3DF 00 00                        	.WORD	0    		; DS
  11738 00E3E1 00 00                        	.WORD	0			; SS
  11739 00E3E3 F1 98                        	.WORD	InvadersTask	; PC
  11740 00E3E5 00                           	.BYTE	InvadersTask>>16
  11741 00E3E6 00 00                        	.WORD	0			; acc
  11742 00E3E8 00 00                        	.WORD	0
  11743 00E3EA 00 00                        	.WORD	0			; x
  11744 00E3EC 00 00                        	.WORD	0
  11745 00E3EE 00 00                        	.WORD	0			; y
  11746 00E3F0 00 00                        	.WORD	0
  11747 00E3F2 FF 2B                        	.WORD	$2BFF		; sp
  11748 00E3F4 00 00                        	.WORD	0
  11749 00E3F6 00                           	.BYTE	0			; SR
  11750 00E3F7 01                           	.BYTE	1			; SR extension
  11751 00E3F8 00                           	.BYTE	0			; DB
  11752 00E3F9 00 00                        	.WORD	0			; DPR
  11753 00E3FB 00 00                        	.WORD	0
                                           
  11755 00E3FD 00 00                        	.WORD	0			; CS
  11756 00E3FF 00 00                        	.WORD	0			; DS
  11757 00E401 00 00                        	.WORD	0			; SS
  11758 00E403 67 E2                        	.WORD	IRQTask		; PC
  11759 00E405 00                           	.BYTE	IRQTask>>16
  11760 00E406 00 00                        	.WORD	0			; acc
  11761 00E408 00 00                        	.WORD	0
  11762 00E40A 00 00                        	.WORD	0			; x
  11763 00E40C 00 00                        	.WORD	0
  11764 00E40E 00 00                        	.WORD	0			; y
  11765 00E410 00 00                        	.WORD	0
  11766 00E412 FF 27                        	.WORD	$27FF		; sp
  11767 00E414 00 00                        	.WORD	0
  11768 00E416 24                           	.BYTE	$24			; SR	8 bit acc, mask interrupts
  11769 00E417 02                           	.BYTE	2			; SR extension - 832 mode
  11770 00E418 00                           	.BYTE	0			; DB
  11771 00E419 00 00                        	.WORD	0			; DPR
  11772 00E41B 00 00                        	.WORD	0
                                           
                                           	; task 7 (Basic)
  11775 00E41D FD 0F                        	.WORD	$FFD		; CS
  11776 00E41F FD 0F                        	.WORD	$FFD		; DS
  11777 00E421 FD 0F                        	.WORD	$FFD		; SS
  11778 00E423 00 C0                        	.WORD	$C000		; PC
  11779 00E425 00                           	.BYTE	$00
  11780 00E426 00 00                        	.WORD	0			; acc
  11781 00E428 00 00                        	.WORD	0
  11782 00E42A 00 00                        	.WORD	0			; x
  11783 00E42C 00 00                        	.WORD	0
  11784 00E42E 00 00                        	.WORD	0			; y
  11785 00E430 00 00                        	.WORD	0
  11786 00E432 FF 01                        	.WORD	$01FF		; sp
  11787 00E434 00 00                        	.WORD	0
  11788 00E436 00                           	.BYTE	0			; SR
  11789 00E437 00                           	.BYTE	0			; SR extension - 02 mode
  11790 00E438 00                           	.BYTE	0			; DB
  11791 00E439 00 00                        	.WORD	0			; DPR
  11792 00E43B 3F 00                        	.WORD	63			; map
                                           
                                           	; task 8 (Supermon)
  11795 00E43D 00 00                        	.WORD	$0			; CS
  11796 00E43F 05 00                        	.WORD	$5			; DS
  11797 00E441 05 00                        	.WORD	$5			; SS
  11798 00E443 00 80                        	.WORD	$8000		; PC
  11799 00E445 00                           	.BYTE	$00
  11800 00E446 00 00                        	.WORD	0			; acc
  11801 00E448 00 00                        	.WORD	0
  11802 00E44A 00 00                        	.WORD	0			; x
  11803 00E44C 00 00                        	.WORD	0
  11804 00E44E 00 00                        	.WORD	0			; y
  11805 00E450 00 00                        	.WORD	0
  11806 00E452 FF 2B                        	.WORD	$2BFF		; sp
  11807 00E454 00 00                        	.WORD	0
  11808 00E456 00                           	.BYTE	0			; SR
  11809 00E457 01                           	.BYTE	1			; SR extension - 816 mode
  11810 00E458 00                           	.BYTE	0			; DB
  11811 00E459 00 00                        	.WORD	0			; DPR
  11812 00E45B 00 00                        	.WORD	0			; map
                                           
                                           	; task 9 (single step)
  11815 00E45D 00 00                        	.WORD	0			; CS
  11816 00E45F 00 00                        	.WORD	0			; DS
  11817 00E461 00 00                        	.WORD	0			; SS
  11818 00E463 C2 C9                        	.WORD	SSMInit		; PC
  11819 00E465 00                           	.BYTE	SSMInit>>16
  11820 00E466 00 00                        	.WORD	0			; acc
  11821 00E468 00 00                        	.WORD	0
  11822 00E46A 00 00                        	.WORD	0			; x
  11823 00E46C 00 00                        	.WORD	0
  11824 00E46E 00 00                        	.WORD	0			; y
  11825 00E470 00 00                        	.WORD	0
  11826 00E472 FF 33                        	.WORD	$33FF		; sp
  11827 00E474 00 00                        	.WORD	0
  11828 00E476 04                           	.BYTE	$4			; SR	16 bit regs, mask interrupts
  11829 00E477 01                           	.BYTE	1			; SR extension - 816 mode
  11830 00E478 00                           	.BYTE	0			; DB
  11831 00E479 00 00                        	.WORD	0			; DPR
  11832 00E47B 00 00                        	.WORD	0
                                           
                                           	; task 10 - BRK routine
  11835 00E47D 00 00                        	.WORD	0			; CS
  11836 00E47F 00 00                        	.WORD	0			; DS
  11837 00E481 00 00                        	.WORD	0			; SS
  11838 00E483 C8 E2                        	.WORD	BrkRout		; PC
  11839 00E485 00                           	.BYTE	BrkRout>>16
  11840 00E486 00 00                        	.WORD	0			; acc
  11841 00E488 00 00                        	.WORD	0
  11842 00E48A 00 00                        	.WORD	0			; x
  11843 00E48C 00 00                        	.WORD	0
  11844 00E48E 00 00                        	.WORD	0			; y
  11845 00E490 00 00                        	.WORD	0
  11846 00E492 FF 32                        	.WORD	$32FF		; sp
  11847 00E494 00 00                        	.WORD	0
  11848 00E496 04                           	.BYTE	$4			; SR	32 bit regs, mask interrupts
  11849 00E497 02                           	.BYTE	2			; SR extension - 832 mode
  11850 00E498 00                           	.BYTE	0			; DB
  11851 00E499 00 00                        	.WORD	0			; DPR
  11852 00E49B 00 00                        	.WORD	0
                                           
  11854 00E49D                             msgRegs:
  11855 00E49D 0D 0A                        	.byte	CR,LF
  11856 00E49F 20 20 20 20 20 20 20 20          .byte   "             xxxsxi31",CR,LF
  11856 00E4A7 20 20 20 20 20 78 78 78    
  11856 00E4AF 73 78 69 33 31 0D 0A       
  11857 00E4B6 20 20 43 53 20 20 50 42          .byte   "  CS  PB PC  xxxsxn26NVmxDIZC    .A       .X       .Y       SP  ",CR,LF,0
  11857 00E4BE 20 50 43 20 20 78 78 78    
  11857 00E4C6 73 78 6E 32 36 4E 56 6D    
  11857 00E4CE 78 44 49 5A 43 20 20 20    
  11857 00E4D6 20 2E 41 20 20 20 20 20    
  11857 00E4DE 20 20 2E 58 20 20 20 20    
  11857 00E4E6 20 20 20 2E 59 20 20 20    
  11857 00E4EE 20 20 20 20 53 50 20 20    
  11857 00E4F6 0D 0A 00                   
  11858 00E4F9                             msgRegs2:
  11859 00E4F9 0D 0A                        	.byte	CR,LF
  11860 00E4FB 20 20 53 53 20 20 20 44      	.byte	"  SS   DS  DB  DP   BL  MP",CR,LF,0
  11860 00E503 53 20 20 44 42 20 20 44    
  11860 00E50B 50 20 20 20 42 4C 20 20    
  11860 00E513 4D 50 0D 0A 00             
  11861 00E518                             msgErr:
  11862 00E518 2A 2A 2A 45 72 72 0D 0A      	.byte	"***Err",CR,LF,0
  11862 00E520 00                         
                                           
                                           ;	cpu		FT832
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$12345678
                                           ;	LDX		#$98765432
                                           ;	STA.B	{$23},Y
                                           ;	LDY.UH	$44455556,X
                                           ;	LDA.H	CS:$44455556,X
                                           ;	LDA.UB	SEG $8888:$1234,Y
                                           ;	JSF	    $0000:start
                                           ;	RTF
                                           ;	ADC     SEG $9821:$1200,X
                                           ;	EOR     $821:$1200,X
                                           ;	EOR     $841:$12
                                           ;	SBC     FAR {$24},Y
                                           ;	AND     FAR($25)
                                           ;	ORA     FAR ($26,x)
                                           ;	TSK		#2
                                           ;	TSK
                                           ;	LDT		$10000,X
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; +---------------------------+
                                           ; | block status / ptr to free|
                                           ; +---------------------------+
                                           ; | pointer to previous block |
                                           ; +---------------------------+
                                           ; | pointer to next block     |
                                           ; +---------------------------+
                                           ;
                                           	MEM		32
                                           	NDX		32
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
  11902 00E521                             FreeSysMem:
  11903 00E521 38                           	SEC
  11904 00E522 E9 0C 00 00 00               	SBC		#12		;	backup to block header
  11905 00E527 A8                           	TAY				;	.Y = pointer to block to free (this)
  11906 00E528 08                           	PHP				; save interrupt mask
  11907 00E529 78                           	SEI				; no interrupts
                                           	STZ		$0,Y	; set status as free
  11909 00E52A B6 08                        	LDX		$8,Y	;	.X = pointer to next block
  11910 00E52C B5 00                        	LDA		$0,X	;	.A = next->status
  11911 00E52E F0 3A                        	BEQ		.0001	;	branch if not free
                                           	; merge block with next free block
  11913 00E530 B5 08                        	LDA		$8,X	;   .A = pointer to next next block
  11914 00E532 99 08 00                     	STA		$8,Y	;
  11915 00E535 AA                           	TAX
  11916 00E536 94 04                        	STY		$4,X	;	next->next->prev = this
  11917 00E538                             .0001:
                                           	; merge block with a previous free block
  11919 00E538 B6 04                        	LDX		$4,Y	;	.X = pointer to prev block
  11920 00E53A B5 00                        	LDA		$0,X	;	.A = prev->status
  11921 00E53C F0 20                        	BEQ		.0002	;	branch if not free
  11922 00E53E B9 08 00                     	LDA		$8,Y	;   prev->next = this->next
  11923 00E541 95 08                        	STA		$8,X
  11924 00E543 A8                           	TAY				;	.Y = this->next
  11925 00E544 96 04                        	STX		$4,Y	;	this->next->prev = this->prev
  11926 00E546 9B                           	TXY
  11927 00E547                             .0002:
  11928 00E547 AD B4 E4                     	LDA		heap_free_ptr
  11929 00E54A 99 00 00                     	STA		$0,Y
  11930 00E54D 8C B4 E4                     	STY		heap_free_ptr
  11931 00E550 58                           	CLI
  11932 00E551 28                           	PLP
  11933 00E552 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	; round allocation size to mmu available sizes
                                           
  11939 00E553 A2 00 00 00 00               	LDX		#0
  11940 00E558 18                           	CLC				; add room for header
  11941 00E559 69 0C 00 00 00               	ADC		#12
  11942 00E55E                             .0002:
  11943 00E55E DD 91 E5                     	CMP		mmas,X
  11944 00E561 42 B0 D4                     	BLE		.0001
  11945 00E564 E8                           	INX
  11946 00E565 E8                           	INX
  11947 00E566 E8                           	INX
  11948 00E567 E8                           	INX
  11949 00E568 80 F4                        	BRA		.0002
  11950 00E56A                             .0001:
  11951 00E56A BD 91 E5                     	LDA		mmas,X
  11952 00E56D AA                           	TAX
  11953 00E56E AC D9 E4                     	LDY		free_heap_ptr
                                           	; subtract .Y from .A
  11955 00E571 38                           	SEC
  11956 00E572 B9 08 00                     	LDA		$8,Y
  11957 00E575 8C DF E4                     	STY		tmpy
  11958 00E578 ED DF E4                     	SBC		tmpy
  11959 00E57B DD 91 E5                     	CMP		mmas,X
                                           ;	BLT		.0003
                                           	; here block is big enough
  11962 00E57E 48                           	PHA
  11963 00E57F B9 00 00                     	LDA		$0,Y
  11964 00E582 8D D9 E4                     	STA		free_heap_ptr
                                           	STZ		$0,Y
  11966 00E585 68                           	PLA
  11967 00E586 38                           	SEC
  11968 00E587 FD 91 E5                     	SBC		mmas,X
  11969 00E58A C9 FF 00 00 00               	CMP		#$0FF
  11970 00E58F 30 00                        	BLT		.0004
                                           
  11972 00E591                             .0004:
                                           	
                                           
                                           ; Memory management allocation sizes
                                           ;
  11977 00E591                             mmas:
  11978 00E591 00 00 00 00                  	WORD	$0000,$0000
  11979 00E595 FF 00 00 00                  	WORD	$00FF,$0000
  11980 00E599 FF 03 00 00                  	WORD	$03FF,$0000
  11981 00E59D FF 0F 00 00                  	WORD	$0FFF,$0000
  11982 00E5A1 FF 3F 00 00                  	WORD	$3FFF,$0000
  11983 00E5A5 FF FF 00 00                  	WORD	$FFFF,$0000
  11984 00E5A9 FF FF 03 00                  	WORD	$FFFF,$0003
  11985 00E5AD FF FF 0F 00                  	WORD	$FFFF,$000F
  11986 00E5B1 FF FF 3F 00                  	WORD	$FFFF,$003F
  11987 00E5B5 FF FF FF 00                  	WORD	$FFFF,$00FF
  11988 00E5B9 FF FF FF 03                  	WORD	$FFFF,$03FF
  11989 00E5BD FF FF FF 0F                  	WORD	$FFFF,$0FFF
  11990 00E5C1 FF FF FF 3F                  	WORD	$FFFF,$3FFF
  11991 00E5C5 FF FF FF FF                  	WORD	$FFFF,$FFFF
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	MEM		16
                                           	NDX		16
  11999 00E5C9 4C 91 E6                     	JMP		MusicPlay
  12000 00E5CC                             beep:
  12001 00E5CC A9 0F 00                     	LDA		#15					; set volume to max
  12002 00E5CF 42 3B FF 0F 8F B0 B0 0E      	STA		$FFF:SID+SID_VOLUME		
                                         
  12003 00E5D7 A9 6F 0C                     	LDA		#$0C6F				; 10C6F = 800 Hz
  12004 00E5DA 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  12005 00E5E2 A9 01 00                     	LDA		#1
  12006 00E5E5 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  12007 00E5ED A9 C3 00                     	LDA		#195				; 2ms
  12008 00E5F0 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  12009 00E5F8 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  12009 00E600 0E 00                      
  12010 00E602 A9 28 09                     	LDA		#2344				; 24 ms decay
  12011 00E605 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  12012 00E60D 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  12012 00E615 0E 00                      
  12013 00E617 A9 80 00                     	LDA		#$80				; 50% sustain level
  12014 00E61A 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  12015 00E622 A9 BC BE                     	LDA		#48828				; 500 ms release
  12016 00E625 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  12017 00E62D 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  12017 00E635 0E 00                      
  12018 00E637 A9 01 00                     	LDA		#1					; reset envelope generator
  12019 00E63A 42 3B FF 0F 8F 0A B0 0E      	STA		$FFF:SID+SID_CTRL0+2
                                         
  12020 00E642 EA                           	NOP
  12021 00E643 EA                           	NOP
  12022 00E644 42 3B FF 0F 42 9C 0A B0      	STZ		$FFF:SID+SID_CTRL0+2
  12022 00E64C 0E 00                      
  12023 00E64E A9 04 15                     	LDA		#$1504				; gate on
  12024 00E651 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
                                           	; delay for about 1s
  12026 00E659 A0 27 00                     	LDY		#39
  12027 00E65C                             .0002:
  12028 00E65C A2 FF FF                     	LDX		#65535
  12029 00E65F                             .0001:
  12030 00E65F CA                           	DEX
  12031 00E660 D0 FD                        	BNE		.0001
  12032 00E662 88                           	DEY
  12033 00E663 D0 F7                        	BNE		.0002
  12034 00E665 A9 04 05                     	LDA		#$0504				; gate off
  12035 00E668 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  12036 00E670 60                           	RTS
  12037 00E671                             	
  12038 00E671 01 00                        	dh	1
  12039 00E673 89 83                        	dw	33673		; G4
  12040 00E675 0C 00                        	dw	12			; 1/8 sec
  12041 00E677 04 00                        	dw	4			; space
                                           
  12043 00E679 01 00                        	dh	1
  12044 00E67B 89 83                        	dw	33673		; G4
  12045 00E67D 0C 00                        	dw	12			; 1/8
  12046 00E67F 04 00                        	dw	4			; space
                                           
  12048 00E681 01 00                        	dh	1
  12049 00E683 89 83                        	dw	33673		; G4
  12050 00E685 0C 00                        	dw	12			; 1/8
  12051 00E687 04 00                        	dw	4			; space
                                           
  12053 00E689 00 00                        	dh	0
  12054 00E68B 00 00                        	dw	0			; G4
  12055 00E68D 00 00                        	dw	0			; 1/8
  12056 00E68F 00 00                        	dw	0			; space
                                           
  12058 00E691                             MusicPlay:
  12059 00E691 A2 00 00                     	LDX		#0
  12060 00E694 A9 C3 00                     	LDA		#195				; 2ms
  12061 00E697 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  12062 00E69F 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  12062 00E6A7 0E 00                      
  12063 00E6A9 A9 28 09                     	LDA		#2344				; 24 ms decay
  12064 00E6AC 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  12065 00E6B4 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  12065 00E6BC 0E 00                      
  12066 00E6BE A9 D0 00                     	LDA		#$D0				; sustain level
  12067 00E6C1 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  12068 00E6C9 A9 F8 11                     	LDA		#4600				; ??? ms release
  12069 00E6CC 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  12070 00E6D4 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  12070 00E6DC 0E 00                      
  12071 00E6DE                             .0001:
  12072 00E6DE BD 71 E6                     	LDA		music_tbl,x			; check for last note
  12073 00E6E1 F0 56                        	BEQ		.xit
  12074 00E6E3 BD 73 E6                     	LDA		music_tbl+2,x			; set the frequency
  12075 00E6E6 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  12076 00E6EE BD 75 E6                     	LDA		music_tbl+4,x
  12077 00E6F1 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  12078 00E6F9 A9 04 15                     	LDA		#$1504				; gate on
  12079 00E6FC 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  12080 00E704 78                           	SEI
  12081 00E705 BD 77 E6                     	LDA		music_tbl+6,x
  12082 00E708 8D 04 01                     	STA		timeout1
  12083 00E70B BD 79 E6                     	LDA		music_tbl+8,x
  12084 00E70E 8D 06 01                     	STA		timeout1+2
  12085 00E711 20 3A E7                     	JSR		MusicWaitTimeout
  12086 00E714 A9 04 05                     	LDA		#$0504				; gate off
  12087 00E717 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  12088 00E71F 78                           	SEI
  12089 00E720 BD 7B E6                     	LDA		music_tbl+10,x		; note release delay
  12090 00E723 8D 04 01                     	STA		timeout1
  12091 00E726 BD 7D E6                     	LDA		music_tbl+12,x
  12092 00E729 8D 06 01                     	STA		timeout1+2
  12093 00E72C 20 3A E7                     	JSR		MusicWaitTimeout
  12094 00E72F E8                           	INX
  12095 00E730 E8                           	INX
  12096 00E731 42 E8                        	INX4
  12097 00E733 42 E8                        	INX4
  12098 00E735 42 E8                        	INX4
  12099 00E737 80 A5                        	BRA		.0001
  12100 00E739                             .xit:
  12101 00E739 60                           	RTS
                                           
  12103 00E73A                             MusicWaitTimeout:
  12104 00E73A                             .0001:
  12105 00E73A 58                           	CLI
  12106 00E73B EA                           	NOP
  12107 00E73C EA                           	NOP
  12108 00E73D 78                           	SEI
  12109 00E73E AD 04 01                     	LDA		timeout1
  12110 00E741 0D 06 01                     	ORA		timeout1+2
  12111 00E744 D0 F4                        	BNE		.0001
  12112 00E746 58                           	CLI
  12113 00E747 60                           	RTS
                                           
  12115 00E748                             MusicTimeoutIRQ:
  12116 00E748 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
  12119 00E74A AD 04 01                     	LDA		timeout1
  12120 00E74D 0D 06 01                     	ORA		timeout1+2
  12121 00E750 F0 13                        	BEQ		.0001
  12122 00E752 38                           	SEC
  12123 00E753 AD 04 01                     	LDA		timeout1
  12124 00E756 E9 01 00                     	SBC		#1
  12125 00E759 8D 04 01                     	STA		timeout1
  12126 00E75C AD 06 01                     	LDA		timeout1+2
  12127 00E75F E9 00 00                     	SBC		#0
  12128 00E762 8D 06 01                     	STA		timeout1+2
  12129 00E765                             .0001:
  12130 00E765 60                           	RTS
                                           
  12132 00E766 FF FF FF FF FF FF FF FF      	.org	$FE00
  12132 00E76E FF FF FF FF FF FF FF FF    
  12132 00E776 FF FF FF FF FF FF FF FF    
  12132 00E77E FF FF FF FF FF FF FF FF    
  12132 00E786 FF FF FF FF FF FF FF FF    
  12132 00E78E FF FF FF FF FF FF FF FF    
  12132 00E796 FF FF FF FF FF FF FF FF    
  12132 00E79E FF FF FF FF FF FF FF FF    
  12132 00E7A6 FF FF FF FF FF FF FF FF    
  12132 00E7AE FF FF FF FF FF FF FF FF    
  12132 00E7B6 FF FF FF FF FF FF FF FF    
  12132 00E7BE FF FF FF FF FF FF FF FF    
  12132 00E7C6 FF FF FF FF FF FF FF FF    
  12132 00E7CE FF FF FF FF FF FF FF FF    
  12132 00E7D6 FF FF FF FF FF FF FF FF    
  12132 00E7DE FF FF FF FF FF FF FF FF    
  12132 00E7E6 FF FF FF FF FF FF FF FF    
  12132 00E7EE FF FF FF FF FF FF FF FF    
  12132 00E7F6 FF FF FF FF FF FF FF FF    
  12132 00E7FE FF FF FF FF FF FF FF FF    
  12132 00E806 FF FF FF FF FF FF FF FF    
  12132 00E80E FF FF FF FF FF FF FF FF    
  12132 00E816 FF FF FF FF FF FF FF FF    
  12132 00E81E FF FF FF FF FF FF FF FF    
  12132 00E826 FF FF FF FF FF FF FF FF    
  12132 00E82E FF FF FF FF FF FF FF FF    
  12132 00E836 FF FF FF FF FF FF FF FF    
  12132 00E83E FF FF FF FF FF FF FF FF    
  12132 00E846 FF FF FF FF FF FF FF FF    
  12132 00E84E FF FF FF FF FF FF FF FF    
  12132 00E856 FF FF FF FF FF FF FF FF    
  12132 00E85E FF FF FF FF FF FF FF FF    
  12132 00E866 FF FF FF FF FF FF FF FF    
  12132 00E86E FF FF FF FF FF FF FF FF    
  12132 00E876 FF FF FF FF FF FF FF FF    
  12132 00E87E FF FF FF FF FF FF FF FF    
  12132 00E886 FF FF FF FF FF FF FF FF    
  12132 00E88E FF FF FF FF FF FF FF FF    
  12132 00E896 FF FF FF FF FF FF FF FF    
  12132 00E89E FF FF FF FF FF FF FF FF    
  12132 00E8A6 FF FF FF FF FF FF FF FF    
  12132 00E8AE FF FF FF FF FF FF FF FF    
  12132 00E8B6 FF FF FF FF FF FF FF FF    
  12132 00E8BE FF FF FF FF FF FF FF FF    
  12132 00E8C6 FF FF FF FF FF FF FF FF    
  12132 00E8CE FF FF FF FF FF FF FF FF    
  12132 00E8D6 FF FF FF FF FF FF FF FF    
  12132 00E8DE FF FF FF FF FF FF FF FF    
  12132 00E8E6 FF FF FF FF FF FF FF FF    
  12132 00E8EE FF FF FF FF FF FF FF FF    
  12132 00E8F6 FF FF FF FF FF FF FF FF    
  12132 00E8FE FF FF FF FF FF FF FF FF    
  12132 00E906 FF FF FF FF FF FF FF FF    
  12132 00E90E FF FF FF FF FF FF FF FF    
  12132 00E916 FF FF FF FF FF FF FF FF    
  12132 00E91E FF FF FF FF FF FF FF FF    
  12132 00E926 FF FF FF FF FF FF FF FF    
  12132 00E92E FF FF FF FF FF FF FF FF    
  12132 00E936 FF FF FF FF FF FF FF FF    
  12132 00E93E FF FF FF FF FF FF FF FF    
  12132 00E946 FF FF FF FF FF FF FF FF    
  12132 00E94E FF FF FF FF FF FF FF FF    
  12132 00E956 FF FF FF FF FF FF FF FF    
  12132 00E95E FF FF FF FF FF FF FF FF    
  12132 00E966 FF FF FF FF FF FF FF FF    
  12132 00E96E FF FF FF FF FF FF FF FF    
  12132 00E976 FF FF FF FF FF FF FF FF    
  12132 00E97E FF FF FF FF FF FF FF FF    
  12132 00E986 FF FF FF FF FF FF FF FF    
  12132 00E98E FF FF FF FF FF FF FF FF    
  12132 00E996 FF FF FF FF FF FF FF FF    
  12132 00E99E FF FF FF FF FF FF FF FF    
  12132 00E9A6 FF FF FF FF FF FF FF FF    
  12132 00E9AE FF FF FF FF FF FF FF FF    
  12132 00E9B6 FF FF FF FF FF FF FF FF    
  12132 00E9BE FF FF FF FF FF FF FF FF    
  12132 00E9C6 FF FF FF FF FF FF FF FF    
  12132 00E9CE FF FF FF FF FF FF FF FF    
  12132 00E9D6 FF FF FF FF FF FF FF FF    
  12132 00E9DE FF FF FF FF FF FF FF FF    
  12132 00E9E6 FF FF FF FF FF FF FF FF    
  12132 00E9EE FF FF FF FF FF FF FF FF    
  12132 00E9F6 FF FF FF FF FF FF FF FF    
  12132 00E9FE FF FF FF FF FF FF FF FF    
  12132 00EA06 FF FF FF FF FF FF FF FF    
  12132 00EA0E FF FF FF FF FF FF FF FF    
  12132 00EA16 FF FF FF FF FF FF FF FF    
  12132 00EA1E FF FF FF FF FF FF FF FF    
  12132 00EA26 FF FF FF FF FF FF FF FF    
  12132 00EA2E FF FF FF FF FF FF FF FF    
  12132 00EA36 FF FF FF FF FF FF FF FF    
  12132 00EA3E FF FF FF FF FF FF FF FF    
  12132 00EA46 FF FF FF FF FF FF FF FF    
  12132 00EA4E FF FF FF FF FF FF FF FF    
  12132 00EA56 FF FF FF FF FF FF FF FF    
  12132 00EA5E FF FF FF FF FF FF FF FF    
  12132 00EA66 FF FF FF FF FF FF FF FF    
  12132 00EA6E FF FF FF FF FF FF FF FF    
  12132 00EA76 FF FF FF FF FF FF FF FF    
  12132 00EA7E FF FF FF FF FF FF FF FF    
  12132 00EA86 FF FF FF FF FF FF FF FF    
  12132 00EA8E FF FF FF FF FF FF FF FF    
  12132 00EA96 FF FF FF FF FF FF FF FF    
  12132 00EA9E FF FF FF FF FF FF FF FF    
  12132 00EAA6 FF FF FF FF FF FF FF FF    
  12132 00EAAE FF FF FF FF FF FF FF FF    
  12132 00EAB6 FF FF FF FF FF FF FF FF    
  12132 00EABE FF FF FF FF FF FF FF FF    
  12132 00EAC6 FF FF FF FF FF FF FF FF    
  12132 00EACE FF FF FF FF FF FF FF FF    
  12132 00EAD6 FF FF FF FF FF FF FF FF    
  12132 00EADE FF FF FF FF FF FF FF FF    
  12132 00EAE6 FF FF FF FF FF FF FF FF    
  12132 00EAEE FF FF FF FF FF FF FF FF    
  12132 00EAF6 FF FF FF FF FF FF FF FF    
  12132 00EAFE FF FF FF FF FF FF FF FF    
  12132 00EB06 FF FF FF FF FF FF FF FF    
  12132 00EB0E FF FF FF FF FF FF FF FF    
  12132 00EB16 FF FF FF FF FF FF FF FF    
  12132 00EB1E FF FF FF FF FF FF FF FF    
  12132 00EB26 FF FF FF FF FF FF FF FF    
  12132 00EB2E FF FF FF FF FF FF FF FF    
  12132 00EB36 FF FF FF FF FF FF FF FF    
  12132 00EB3E FF FF FF FF FF FF FF FF    
  12132 00EB46 FF FF FF FF FF FF FF FF    
  12132 00EB4E FF FF FF FF FF FF FF FF    
  12132 00EB56 FF FF FF FF FF FF FF FF    
  12132 00EB5E FF FF FF FF FF FF FF FF    
  12132 00EB66 FF FF FF FF FF FF FF FF    
  12132 00EB6E FF FF FF FF FF FF FF FF    
  12132 00EB76 FF FF FF FF FF FF FF FF    
  12132 00EB7E FF FF FF FF FF FF FF FF    
  12132 00EB86 FF FF FF FF FF FF FF FF    
  12132 00EB8E FF FF FF FF FF FF FF FF    
  12132 00EB96 FF FF FF FF FF FF FF FF    
  12132 00EB9E FF FF FF FF FF FF FF FF    
  12132 00EBA6 FF FF FF FF FF FF FF FF    
  12132 00EBAE FF FF FF FF FF FF FF FF    
  12132 00EBB6 FF FF FF FF FF FF FF FF    
  12132 00EBBE FF FF FF FF FF FF FF FF    
  12132 00EBC6 FF FF FF FF FF FF FF FF    
  12132 00EBCE FF FF FF FF FF FF FF FF    
  12132 00EBD6 FF FF FF FF FF FF FF FF    
  12132 00EBDE FF FF FF FF FF FF FF FF    
  12132 00EBE6 FF FF FF FF FF FF FF FF    
  12132 00EBEE FF FF FF FF FF FF FF FF    
  12132 00EBF6 FF FF FF FF FF FF FF FF    
  12132 00EBFE FF FF FF FF FF FF FF FF    
  12132 00EC06 FF FF FF FF FF FF FF FF    
  12132 00EC0E FF FF FF FF FF FF FF FF    
  12132 00EC16 FF FF FF FF FF FF FF FF    
  12132 00EC1E FF FF FF FF FF FF FF FF    
  12132 00EC26 FF FF FF FF FF FF FF FF    
  12132 00EC2E FF FF FF FF FF FF FF FF    
  12132 00EC36 FF FF FF FF FF FF FF FF    
  12132 00EC3E FF FF FF FF FF FF FF FF    
  12132 00EC46 FF FF FF FF FF FF FF FF    
  12132 00EC4E FF FF FF FF FF FF FF FF    
  12132 00EC56 FF FF FF FF FF FF FF FF    
  12132 00EC5E FF FF FF FF FF FF FF FF    
  12132 00EC66 FF FF FF FF FF FF FF FF    
  12132 00EC6E FF FF FF FF FF FF FF FF    
  12132 00EC76 FF FF FF FF FF FF FF FF    
  12132 00EC7E FF FF FF FF FF FF FF FF    
  12132 00EC86 FF FF FF FF FF FF FF FF    
  12132 00EC8E FF FF FF FF FF FF FF FF    
  12132 00EC96 FF FF FF FF FF FF FF FF    
  12132 00EC9E FF FF FF FF FF FF FF FF    
  12132 00ECA6 FF FF FF FF FF FF FF FF    
  12132 00ECAE FF FF FF FF FF FF FF FF    
  12132 00ECB6 FF FF FF FF FF FF FF FF    
  12132 00ECBE FF FF FF FF FF FF FF FF    
  12132 00ECC6 FF FF FF FF FF FF FF FF    
  12132 00ECCE FF FF FF FF FF FF FF FF    
  12132 00ECD6 FF FF FF FF FF FF FF FF    
  12132 00ECDE FF FF FF FF FF FF FF FF    
  12132 00ECE6 FF FF FF FF FF FF FF FF    
  12132 00ECEE FF FF FF FF FF FF FF FF    
  12132 00ECF6 FF FF FF FF FF FF FF FF    
  12132 00ECFE FF FF FF FF FF FF FF FF    
  12132 00ED06 FF FF FF FF FF FF FF FF    
  12132 00ED0E FF FF FF FF FF FF FF FF    
  12132 00ED16 FF FF FF FF FF FF FF FF    
  12132 00ED1E FF FF FF FF FF FF FF FF    
  12132 00ED26 FF FF FF FF FF FF FF FF    
  12132 00ED2E FF FF FF FF FF FF FF FF    
  12132 00ED36 FF FF FF FF FF FF FF FF    
  12132 00ED3E FF FF FF FF FF FF FF FF    
  12132 00ED46 FF FF FF FF FF FF FF FF    
  12132 00ED4E FF FF FF FF FF FF FF FF    
  12132 00ED56 FF FF FF FF FF FF FF FF    
  12132 00ED5E FF FF FF FF FF FF FF FF    
  12132 00ED66 FF FF FF FF FF FF FF FF    
  12132 00ED6E FF FF FF FF FF FF FF FF    
  12132 00ED76 FF FF FF FF FF FF FF FF    
  12132 00ED7E FF FF FF FF FF FF FF FF    
  12132 00ED86 FF FF FF FF FF FF FF FF    
  12132 00ED8E FF FF FF FF FF FF FF FF    
  12132 00ED96 FF FF FF FF FF FF FF FF    
  12132 00ED9E FF FF FF FF FF FF FF FF    
  12132 00EDA6 FF FF FF FF FF FF FF FF    
  12132 00EDAE FF FF FF FF FF FF FF FF    
  12132 00EDB6 FF FF FF FF FF FF FF FF    
  12132 00EDBE FF FF FF FF FF FF FF FF    
  12132 00EDC6 FF FF FF FF FF FF FF FF    
  12132 00EDCE FF FF FF FF FF FF FF FF    
  12132 00EDD6 FF FF FF FF FF FF FF FF    
  12132 00EDDE FF FF FF FF FF FF FF FF    
  12132 00EDE6 FF FF FF FF FF FF FF FF    
  12132 00EDEE FF FF FF FF FF FF FF FF    
  12132 00EDF6 FF FF FF FF FF FF FF FF    
  12132 00EDFE FF FF FF FF FF FF FF FF    
  12132 00EE06 FF FF FF FF FF FF FF FF    
  12132 00EE0E FF FF FF FF FF FF FF FF    
  12132 00EE16 FF FF FF FF FF FF FF FF    
  12132 00EE1E FF FF FF FF FF FF FF FF    
  12132 00EE26 FF FF FF FF FF FF FF FF    
  12132 00EE2E FF FF FF FF FF FF FF FF    
  12132 00EE36 FF FF FF FF FF FF FF FF    
  12132 00EE3E FF FF FF FF FF FF FF FF    
  12132 00EE46 FF FF FF FF FF FF FF FF    
  12132 00EE4E FF FF FF FF FF FF FF FF    
  12132 00EE56 FF FF FF FF FF FF FF FF    
  12132 00EE5E FF FF FF FF FF FF FF FF    
  12132 00EE66 FF FF FF FF FF FF FF FF    
  12132 00EE6E FF FF FF FF FF FF FF FF    
  12132 00EE76 FF FF FF FF FF FF FF FF    
  12132 00EE7E FF FF FF FF FF FF FF FF    
  12132 00EE86 FF FF FF FF FF FF FF FF    
  12132 00EE8E FF FF FF FF FF FF FF FF    
  12132 00EE96 FF FF FF FF FF FF FF FF    
  12132 00EE9E FF FF FF FF FF FF FF FF    
  12132 00EEA6 FF FF FF FF FF FF FF FF    
  12132 00EEAE FF FF FF FF FF FF FF FF    
  12132 00EEB6 FF FF FF FF FF FF FF FF    
  12132 00EEBE FF FF FF FF FF FF FF FF    
  12132 00EEC6 FF FF FF FF FF FF FF FF    
  12132 00EECE FF FF FF FF FF FF FF FF    
  12132 00EED6 FF FF FF FF FF FF FF FF    
  12132 00EEDE FF FF FF FF FF FF FF FF    
  12132 00EEE6 FF FF FF FF FF FF FF FF    
  12132 00EEEE FF FF FF FF FF FF FF FF    
  12132 00EEF6 FF FF FF FF FF FF FF FF    
  12132 00EEFE FF FF FF FF FF FF FF FF    
  12132 00EF06 FF FF FF FF FF FF FF FF    
  12132 00EF0E FF FF FF FF FF FF FF FF    
  12132 00EF16 FF FF FF FF FF FF FF FF    
  12132 00EF1E FF FF FF FF FF FF FF FF    
  12132 00EF26 FF FF FF FF FF FF FF FF    
  12132 00EF2E FF FF FF FF FF FF FF FF    
  12132 00EF36 FF FF FF FF FF FF FF FF    
  12132 00EF3E FF FF FF FF FF FF FF FF    
  12132 00EF46 FF FF FF FF FF FF FF FF    
  12132 00EF4E FF FF FF FF FF FF FF FF    
  12132 00EF56 FF FF FF FF FF FF FF FF    
  12132 00EF5E FF FF FF FF FF FF FF FF    
  12132 00EF66 FF FF FF FF FF FF FF FF    
  12132 00EF6E FF FF FF FF FF FF FF FF    
  12132 00EF76 FF FF FF FF FF FF FF FF    
  12132 00EF7E FF FF FF FF FF FF FF FF    
  12132 00EF86 FF FF FF FF FF FF FF FF    
  12132 00EF8E FF FF FF FF FF FF FF FF    
  12132 00EF96 FF FF FF FF FF FF FF FF    
  12132 00EF9E FF FF FF FF FF FF FF FF    
  12132 00EFA6 FF FF FF FF FF FF FF FF    
  12132 00EFAE FF FF FF FF FF FF FF FF    
  12132 00EFB6 FF FF FF FF FF FF FF FF    
  12132 00EFBE FF FF FF FF FF FF FF FF    
  12132 00EFC6 FF FF FF FF FF FF FF FF    
  12132 00EFCE FF FF FF FF FF FF FF FF    
  12132 00EFD6 FF FF FF FF FF FF FF FF    
  12132 00EFDE FF FF FF FF FF FF FF FF    
  12132 00EFE6 FF FF FF FF FF FF FF FF    
  12132 00EFEE FF FF FF FF FF FF FF FF    
  12132 00EFF6 FF FF FF FF FF FF FF FF    
  12132 00EFFE FF FF FF FF FF FF FF FF    
  12132 00F006 FF FF FF FF FF FF FF FF    
  12132 00F00E FF FF FF FF FF FF FF FF    
  12132 00F016 FF FF FF FF FF FF FF FF    
  12132 00F01E FF FF FF FF FF FF FF FF    
  12132 00F026 FF FF FF FF FF FF FF FF    
  12132 00F02E FF FF FF FF FF FF FF FF    
  12132 00F036 FF FF FF FF FF FF FF FF    
  12132 00F03E FF FF FF FF FF FF FF FF    
  12132 00F046 FF FF FF FF FF FF FF FF    
  12132 00F04E FF FF FF FF FF FF FF FF    
  12132 00F056 FF FF FF FF FF FF FF FF    
  12132 00F05E FF FF FF FF FF FF FF FF    
  12132 00F066 FF FF FF FF FF FF FF FF    
  12132 00F06E FF FF FF FF FF FF FF FF    
  12132 00F076 FF FF FF FF FF FF FF FF    
  12132 00F07E FF FF FF FF FF FF FF FF    
  12132 00F086 FF FF FF FF FF FF FF FF    
  12132 00F08E FF FF FF FF FF FF FF FF    
  12132 00F096 FF FF FF FF FF FF FF FF    
  12132 00F09E FF FF FF FF FF FF FF FF    
  12132 00F0A6 FF FF FF FF FF FF FF FF    
  12132 00F0AE FF FF FF FF FF FF FF FF    
  12132 00F0B6 FF FF FF FF FF FF FF FF    
  12132 00F0BE FF FF FF FF FF FF FF FF    
  12132 00F0C6 FF FF FF FF FF FF FF FF    
  12132 00F0CE FF FF FF FF FF FF FF FF    
  12132 00F0D6 FF FF FF FF FF FF FF FF    
  12132 00F0DE FF FF FF FF FF FF FF FF    
  12132 00F0E6 FF FF FF FF FF FF FF FF    
  12132 00F0EE FF FF FF FF FF FF FF FF    
  12132 00F0F6 FF FF FF FF FF FF FF FF    
  12132 00F0FE FF FF FF FF FF FF FF FF    
  12132 00F106 FF FF FF FF FF FF FF FF    
  12132 00F10E FF FF FF FF FF FF FF FF    
  12132 00F116 FF FF FF FF FF FF FF FF    
  12132 00F11E FF FF FF FF FF FF FF FF    
  12132 00F126 FF FF FF FF FF FF FF FF    
  12132 00F12E FF FF FF FF FF FF FF FF    
  12132 00F136 FF FF FF FF FF FF FF FF    
  12132 00F13E FF FF FF FF FF FF FF FF    
  12132 00F146 FF FF FF FF FF FF FF FF    
  12132 00F14E FF FF FF FF FF FF FF FF    
  12132 00F156 FF FF FF FF FF FF FF FF    
  12132 00F15E FF FF FF FF FF FF FF FF    
  12132 00F166 FF FF FF FF FF FF FF FF    
  12132 00F16E FF FF FF FF FF FF FF FF    
  12132 00F176 FF FF FF FF FF FF FF FF    
  12132 00F17E FF FF FF FF FF FF FF FF    
  12132 00F186 FF FF FF FF FF FF FF FF    
  12132 00F18E FF FF FF FF FF FF FF FF    
  12132 00F196 FF FF FF FF FF FF FF FF    
  12132 00F19E FF FF FF FF FF FF FF FF    
  12132 00F1A6 FF FF FF FF FF FF FF FF    
  12132 00F1AE FF FF FF FF FF FF FF FF    
  12132 00F1B6 FF FF FF FF FF FF FF FF    
  12132 00F1BE FF FF FF FF FF FF FF FF    
  12132 00F1C6 FF FF FF FF FF FF FF FF    
  12132 00F1CE FF FF FF FF FF FF FF FF    
  12132 00F1D6 FF FF FF FF FF FF FF FF    
  12132 00F1DE FF FF FF FF FF FF FF FF    
  12132 00F1E6 FF FF FF FF FF FF FF FF    
  12132 00F1EE FF FF FF FF FF FF FF FF    
  12132 00F1F6 FF FF FF FF FF FF FF FF    
  12132 00F1FE FF FF FF FF FF FF FF FF    
  12132 00F206 FF FF FF FF FF FF FF FF    
  12132 00F20E FF FF FF FF FF FF FF FF    
  12132 00F216 FF FF FF FF FF FF FF FF    
  12132 00F21E FF FF FF FF FF FF FF FF    
  12132 00F226 FF FF FF FF FF FF FF FF    
  12132 00F22E FF FF FF FF FF FF FF FF    
  12132 00F236 FF FF FF FF FF FF FF FF    
  12132 00F23E FF FF FF FF FF FF FF FF    
  12132 00F246 FF FF FF FF FF FF FF FF    
  12132 00F24E FF FF FF FF FF FF FF FF    
  12132 00F256 FF FF FF FF FF FF FF FF    
  12132 00F25E FF FF FF FF FF FF FF FF    
  12132 00F266 FF FF FF FF FF FF FF FF    
  12132 00F26E FF FF FF FF FF FF FF FF    
  12132 00F276 FF FF FF FF FF FF FF FF    
  12132 00F27E FF FF FF FF FF FF FF FF    
  12132 00F286 FF FF FF FF FF FF FF FF    
  12132 00F28E FF FF FF FF FF FF FF FF    
  12132 00F296 FF FF FF FF FF FF FF FF    
  12132 00F29E FF FF FF FF FF FF FF FF    
  12132 00F2A6 FF FF FF FF FF FF FF FF    
  12132 00F2AE FF FF FF FF FF FF FF FF    
  12132 00F2B6 FF FF FF FF FF FF FF FF    
  12132 00F2BE FF FF FF FF FF FF FF FF    
  12132 00F2C6 FF FF FF FF FF FF FF FF    
  12132 00F2CE FF FF FF FF FF FF FF FF    
  12132 00F2D6 FF FF FF FF FF FF FF FF    
  12132 00F2DE FF FF FF FF FF FF FF FF    
  12132 00F2E6 FF FF FF FF FF FF FF FF    
  12132 00F2EE FF FF FF FF FF FF FF FF    
  12132 00F2F6 FF FF FF FF FF FF FF FF    
  12132 00F2FE FF FF FF FF FF FF FF FF    
  12132 00F306 FF FF FF FF FF FF FF FF    
  12132 00F30E FF FF FF FF FF FF FF FF    
  12132 00F316 FF FF FF FF FF FF FF FF    
  12132 00F31E FF FF FF FF FF FF FF FF    
  12132 00F326 FF FF FF FF FF FF FF FF    
  12132 00F32E FF FF FF FF FF FF FF FF    
  12132 00F336 FF FF FF FF FF FF FF FF    
  12132 00F33E FF FF FF FF FF FF FF FF    
  12132 00F346 FF FF FF FF FF FF FF FF    
  12132 00F34E FF FF FF FF FF FF FF FF    
  12132 00F356 FF FF FF FF FF FF FF FF    
  12132 00F35E FF FF FF FF FF FF FF FF    
  12132 00F366 FF FF FF FF FF FF FF FF    
  12132 00F36E FF FF FF FF FF FF FF FF    
  12132 00F376 FF FF FF FF FF FF FF FF    
  12132 00F37E FF FF FF FF FF FF FF FF    
  12132 00F386 FF FF FF FF FF FF FF FF    
  12132 00F38E FF FF FF FF FF FF FF FF    
  12132 00F396 FF FF FF FF FF FF FF FF    
  12132 00F39E FF FF FF FF FF FF FF FF    
  12132 00F3A6 FF FF FF FF FF FF FF FF    
  12132 00F3AE FF FF FF FF FF FF FF FF    
  12132 00F3B6 FF FF FF FF FF FF FF FF    
  12132 00F3BE FF FF FF FF FF FF FF FF    
  12132 00F3C6 FF FF FF FF FF FF FF FF    
  12132 00F3CE FF FF FF FF FF FF FF FF    
  12132 00F3D6 FF FF FF FF FF FF FF FF    
  12132 00F3DE FF FF FF FF FF FF FF FF    
  12132 00F3E6 FF FF FF FF FF FF FF FF    
  12132 00F3EE FF FF FF FF FF FF FF FF    
  12132 00F3F6 FF FF FF FF FF FF FF FF    
  12132 00F3FE FF FF FF FF FF FF FF FF    
  12132 00F406 FF FF FF FF FF FF FF FF    
  12132 00F40E FF FF FF FF FF FF FF FF    
  12132 00F416 FF FF FF FF FF FF FF FF    
  12132 00F41E FF FF FF FF FF FF FF FF    
  12132 00F426 FF FF FF FF FF FF FF FF    
  12132 00F42E FF FF FF FF FF FF FF FF    
  12132 00F436 FF FF FF FF FF FF FF FF    
  12132 00F43E FF FF FF FF FF FF FF FF    
  12132 00F446 FF FF FF FF FF FF FF FF    
  12132 00F44E FF FF FF FF FF FF FF FF    
  12132 00F456 FF FF FF FF FF FF FF FF    
  12132 00F45E FF FF FF FF FF FF FF FF    
  12132 00F466 FF FF FF FF FF FF FF FF    
  12132 00F46E FF FF FF FF FF FF FF FF    
  12132 00F476 FF FF FF FF FF FF FF FF    
  12132 00F47E FF FF FF FF FF FF FF FF    
  12132 00F486 FF FF FF FF FF FF FF FF    
  12132 00F48E FF FF FF FF FF FF FF FF    
  12132 00F496 FF FF FF FF FF FF FF FF    
  12132 00F49E FF FF FF FF FF FF FF FF    
  12132 00F4A6 FF FF FF FF FF FF FF FF    
  12132 00F4AE FF FF FF FF FF FF FF FF    
  12132 00F4B6 FF FF FF FF FF FF FF FF    
  12132 00F4BE FF FF FF FF FF FF FF FF    
  12132 00F4C6 FF FF FF FF FF FF FF FF    
  12132 00F4CE FF FF FF FF FF FF FF FF    
  12132 00F4D6 FF FF FF FF FF FF FF FF    
  12132 00F4DE FF FF FF FF FF FF FF FF    
  12132 00F4E6 FF FF FF FF FF FF FF FF    
  12132 00F4EE FF FF FF FF FF FF FF FF    
  12132 00F4F6 FF FF FF FF FF FF FF FF    
  12132 00F4FE FF FF FF FF FF FF FF FF    
  12132 00F506 FF FF FF FF FF FF FF FF    
  12132 00F50E FF FF FF FF FF FF FF FF    
  12132 00F516 FF FF FF FF FF FF FF FF    
  12132 00F51E FF FF FF FF FF FF FF FF    
  12132 00F526 FF FF FF FF FF FF FF FF    
  12132 00F52E FF FF FF FF FF FF FF FF    
  12132 00F536 FF FF FF FF FF FF FF FF    
  12132 00F53E FF FF FF FF FF FF FF FF    
  12132 00F546 FF FF FF FF FF FF FF FF    
  12132 00F54E FF FF FF FF FF FF FF FF    
  12132 00F556 FF FF FF FF FF FF FF FF    
  12132 00F55E FF FF FF FF FF FF FF FF    
  12132 00F566 FF FF FF FF FF FF FF FF    
  12132 00F56E FF FF FF FF FF FF FF FF    
  12132 00F576 FF FF FF FF FF FF FF FF    
  12132 00F57E FF FF FF FF FF FF FF FF    
  12132 00F586 FF FF FF FF FF FF FF FF    
  12132 00F58E FF FF FF FF FF FF FF FF    
  12132 00F596 FF FF FF FF FF FF FF FF    
  12132 00F59E FF FF FF FF FF FF FF FF    
  12132 00F5A6 FF FF FF FF FF FF FF FF    
  12132 00F5AE FF FF FF FF FF FF FF FF    
  12132 00F5B6 FF FF FF FF FF FF FF FF    
  12132 00F5BE FF FF FF FF FF FF FF FF    
  12132 00F5C6 FF FF FF FF FF FF FF FF    
  12132 00F5CE FF FF FF FF FF FF FF FF    
  12132 00F5D6 FF FF FF FF FF FF FF FF    
  12132 00F5DE FF FF FF FF FF FF FF FF    
  12132 00F5E6 FF FF FF FF FF FF FF FF    
  12132 00F5EE FF FF FF FF FF FF FF FF    
  12132 00F5F6 FF FF FF FF FF FF FF FF    
  12132 00F5FE FF FF FF FF FF FF FF FF    
  12132 00F606 FF FF FF FF FF FF FF FF    
  12132 00F60E FF FF FF FF FF FF FF FF    
  12132 00F616 FF FF FF FF FF FF FF FF    
  12132 00F61E FF FF FF FF FF FF FF FF    
  12132 00F626 FF FF FF FF FF FF FF FF    
  12132 00F62E FF FF FF FF FF FF FF FF    
  12132 00F636 FF FF FF FF FF FF FF FF    
  12132 00F63E FF FF FF FF FF FF FF FF    
  12132 00F646 FF FF FF FF FF FF FF FF    
  12132 00F64E FF FF FF FF FF FF FF FF    
  12132 00F656 FF FF FF FF FF FF FF FF    
  12132 00F65E FF FF FF FF FF FF FF FF    
  12132 00F666 FF FF FF FF FF FF FF FF    
  12132 00F66E FF FF FF FF FF FF FF FF    
  12132 00F676 FF FF FF FF FF FF FF FF    
  12132 00F67E FF FF FF FF FF FF FF FF    
  12132 00F686 FF FF FF FF FF FF FF FF    
  12132 00F68E FF FF FF FF FF FF FF FF    
  12132 00F696 FF FF FF FF FF FF FF FF    
  12132 00F69E FF FF FF FF FF FF FF FF    
  12132 00F6A6 FF FF FF FF FF FF FF FF    
  12132 00F6AE FF FF FF FF FF FF FF FF    
  12132 00F6B6 FF FF FF FF FF FF FF FF    
  12132 00F6BE FF FF FF FF FF FF FF FF    
  12132 00F6C6 FF FF FF FF FF FF FF FF    
  12132 00F6CE FF FF FF FF FF FF FF FF    
  12132 00F6D6 FF FF FF FF FF FF FF FF    
  12132 00F6DE FF FF FF FF FF FF FF FF    
  12132 00F6E6 FF FF FF FF FF FF FF FF    
  12132 00F6EE FF FF FF FF FF FF FF FF    
  12132 00F6F6 FF FF FF FF FF FF FF FF    
  12132 00F6FE FF FF FF FF FF FF FF FF    
  12132 00F706 FF FF FF FF FF FF FF FF    
  12132 00F70E FF FF FF FF FF FF FF FF    
  12132 00F716 FF FF FF FF FF FF FF FF    
  12132 00F71E FF FF FF FF FF FF FF FF    
  12132 00F726 FF FF FF FF FF FF FF FF    
  12132 00F72E FF FF FF FF FF FF FF FF    
  12132 00F736 FF FF FF FF FF FF FF FF    
  12132 00F73E FF FF FF FF FF FF FF FF    
  12132 00F746 FF FF FF FF FF FF FF FF    
  12132 00F74E FF FF FF FF FF FF FF FF    
  12132 00F756 FF FF FF FF FF FF FF FF    
  12132 00F75E FF FF FF FF FF FF FF FF    
  12132 00F766 FF FF FF FF FF FF FF FF    
  12132 00F76E FF FF FF FF FF FF FF FF    
  12132 00F776 FF FF FF FF FF FF FF FF    
  12132 00F77E FF FF FF FF FF FF FF FF    
  12132 00F786 FF FF FF FF FF FF FF FF    
  12132 00F78E FF FF FF FF FF FF FF FF    
  12132 00F796 FF FF FF FF FF FF FF FF    
  12132 00F79E FF FF FF FF FF FF FF FF    
  12132 00F7A6 FF FF FF FF FF FF FF FF    
  12132 00F7AE FF FF FF FF FF FF FF FF    
  12132 00F7B6 FF FF FF FF FF FF FF FF    
  12132 00F7BE FF FF FF FF FF FF FF FF    
  12132 00F7C6 FF FF FF FF FF FF FF FF    
  12132 00F7CE FF FF FF FF FF FF FF FF    
  12132 00F7D6 FF FF FF FF FF FF FF FF    
  12132 00F7DE FF FF FF FF FF FF FF FF    
  12132 00F7E6 FF FF FF FF FF FF FF FF    
  12132 00F7EE FF FF FF FF FF FF FF FF    
  12132 00F7F6 FF FF FF FF FF FF FF FF    
  12132 00F7FE FF FF FF FF FF FF FF FF    
  12132 00F806 FF FF FF FF FF FF FF FF    
  12132 00F80E FF FF FF FF FF FF FF FF    
  12132 00F816 FF FF FF FF FF FF FF FF    
  12132 00F81E FF FF FF FF FF FF FF FF    
  12132 00F826 FF FF FF FF FF FF FF FF    
  12132 00F82E FF FF FF FF FF FF FF FF    
  12132 00F836 FF FF FF FF FF FF FF FF    
  12132 00F83E FF FF FF FF FF FF FF FF    
  12132 00F846 FF FF FF FF FF FF FF FF    
  12132 00F84E FF FF FF FF FF FF FF FF    
  12132 00F856 FF FF FF FF FF FF FF FF    
  12132 00F85E FF FF FF FF FF FF FF FF    
  12132 00F866 FF FF FF FF FF FF FF FF    
  12132 00F86E FF FF FF FF FF FF FF FF    
  12132 00F876 FF FF FF FF FF FF FF FF    
  12132 00F87E FF FF FF FF FF FF FF FF    
  12132 00F886 FF FF FF FF FF FF FF FF    
  12132 00F88E FF FF FF FF FF FF FF FF    
  12132 00F896 FF FF FF FF FF FF FF FF    
  12132 00F89E FF FF FF FF FF FF FF FF    
  12132 00F8A6 FF FF FF FF FF FF FF FF    
  12132 00F8AE FF FF FF FF FF FF FF FF    
  12132 00F8B6 FF FF FF FF FF FF FF FF    
  12132 00F8BE FF FF FF FF FF FF FF FF    
  12132 00F8C6 FF FF FF FF FF FF FF FF    
  12132 00F8CE FF FF FF FF FF FF FF FF    
  12132 00F8D6 FF FF FF FF FF FF FF FF    
  12132 00F8DE FF FF FF FF FF FF FF FF    
  12132 00F8E6 FF FF FF FF FF FF FF FF    
  12132 00F8EE FF FF FF FF FF FF FF FF    
  12132 00F8F6 FF FF FF FF FF FF FF FF    
  12132 00F8FE FF FF FF FF FF FF FF FF    
  12132 00F906 FF FF FF FF FF FF FF FF    
  12132 00F90E FF FF FF FF FF FF FF FF    
  12132 00F916 FF FF FF FF FF FF FF FF    
  12132 00F91E FF FF FF FF FF FF FF FF    
  12132 00F926 FF FF FF FF FF FF FF FF    
  12132 00F92E FF FF FF FF FF FF FF FF    
  12132 00F936 FF FF FF FF FF FF FF FF    
  12132 00F93E FF FF FF FF FF FF FF FF    
  12132 00F946 FF FF FF FF FF FF FF FF    
  12132 00F94E FF FF FF FF FF FF FF FF    
  12132 00F956 FF FF FF FF FF FF FF FF    
  12132 00F95E FF FF FF FF FF FF FF FF    
  12132 00F966 FF FF FF FF FF FF FF FF    
  12132 00F96E FF FF FF FF FF FF FF FF    
  12132 00F976 FF FF FF FF FF FF FF FF    
  12132 00F97E FF FF FF FF FF FF FF FF    
  12132 00F986 FF FF FF FF FF FF FF FF    
  12132 00F98E FF FF FF FF FF FF FF FF    
  12132 00F996 FF FF FF FF FF FF FF FF    
  12132 00F99E FF FF FF FF FF FF FF FF    
  12132 00F9A6 FF FF FF FF FF FF FF FF    
  12132 00F9AE FF FF FF FF FF FF FF FF    
  12132 00F9B6 FF FF FF FF FF FF FF FF    
  12132 00F9BE FF FF FF FF FF FF FF FF    
  12132 00F9C6 FF FF FF FF FF FF FF FF    
  12132 00F9CE FF FF FF FF FF FF FF FF    
  12132 00F9D6 FF FF FF FF FF FF FF FF    
  12132 00F9DE FF FF FF FF FF FF FF FF    
  12132 00F9E6 FF FF FF FF FF FF FF FF    
  12132 00F9EE FF FF FF FF FF FF FF FF    
  12132 00F9F6 FF FF FF FF FF FF FF FF    
  12132 00F9FE FF FF FF FF FF FF FF FF    
  12132 00FA06 FF FF FF FF FF FF FF FF    
  12132 00FA0E FF FF FF FF FF FF FF FF    
  12132 00FA16 FF FF FF FF FF FF FF FF    
  12132 00FA1E FF FF FF FF FF FF FF FF    
  12132 00FA26 FF FF FF FF FF FF FF FF    
  12132 00FA2E FF FF FF FF FF FF FF FF    
  12132 00FA36 FF FF FF FF FF FF FF FF    
  12132 00FA3E FF FF FF FF FF FF FF FF    
  12132 00FA46 FF FF FF FF FF FF FF FF    
  12132 00FA4E FF FF FF FF FF FF FF FF    
  12132 00FA56 FF FF FF FF FF FF FF FF    
  12132 00FA5E FF FF FF FF FF FF FF FF    
  12132 00FA66 FF FF FF FF FF FF FF FF    
  12132 00FA6E FF FF FF FF FF FF FF FF    
  12132 00FA76 FF FF FF FF FF FF FF FF    
  12132 00FA7E FF FF FF FF FF FF FF FF    
  12132 00FA86 FF FF FF FF FF FF FF FF    
  12132 00FA8E FF FF FF FF FF FF FF FF    
  12132 00FA96 FF FF FF FF FF FF FF FF    
  12132 00FA9E FF FF FF FF FF FF FF FF    
  12132 00FAA6 FF FF FF FF FF FF FF FF    
  12132 00FAAE FF FF FF FF FF FF FF FF    
  12132 00FAB6 FF FF FF FF FF FF FF FF    
  12132 00FABE FF FF FF FF FF FF FF FF    
  12132 00FAC6 FF FF FF FF FF FF FF FF    
  12132 00FACE FF FF FF FF FF FF FF FF    
  12132 00FAD6 FF FF FF FF FF FF FF FF    
  12132 00FADE FF FF FF FF FF FF FF FF    
  12132 00FAE6 FF FF FF FF FF FF FF FF    
  12132 00FAEE FF FF FF FF FF FF FF FF    
  12132 00FAF6 FF FF FF FF FF FF FF FF    
  12132 00FAFE FF FF FF FF FF FF FF FF    
  12132 00FB06 FF FF FF FF FF FF FF FF    
  12132 00FB0E FF FF FF FF FF FF FF FF    
  12132 00FB16 FF FF FF FF FF FF FF FF    
  12132 00FB1E FF FF FF FF FF FF FF FF    
  12132 00FB26 FF FF FF FF FF FF FF FF    
  12132 00FB2E FF FF FF FF FF FF FF FF    
  12132 00FB36 FF FF FF FF FF FF FF FF    
  12132 00FB3E FF FF FF FF FF FF FF FF    
  12132 00FB46 FF FF FF FF FF FF FF FF    
  12132 00FB4E FF FF FF FF FF FF FF FF    
  12132 00FB56 FF FF FF FF FF FF FF FF    
  12132 00FB5E FF FF FF FF FF FF FF FF    
  12132 00FB66 FF FF FF FF FF FF FF FF    
  12132 00FB6E FF FF FF FF FF FF FF FF    
  12132 00FB76 FF FF FF FF FF FF FF FF    
  12132 00FB7E FF FF FF FF FF FF FF FF    
  12132 00FB86 FF FF FF FF FF FF FF FF    
  12132 00FB8E FF FF FF FF FF FF FF FF    
  12132 00FB96 FF FF FF FF FF FF FF FF    
  12132 00FB9E FF FF FF FF FF FF FF FF    
  12132 00FBA6 FF FF FF FF FF FF FF FF    
  12132 00FBAE FF FF FF FF FF FF FF FF    
  12132 00FBB6 FF FF FF FF FF FF FF FF    
  12132 00FBBE FF FF FF FF FF FF FF FF    
  12132 00FBC6 FF FF FF FF FF FF FF FF    
  12132 00FBCE FF FF FF FF FF FF FF FF    
  12132 00FBD6 FF FF FF FF FF FF FF FF    
  12132 00FBDE FF FF FF FF FF FF FF FF    
  12132 00FBE6 FF FF FF FF FF FF FF FF    
  12132 00FBEE FF FF FF FF FF FF FF FF    
  12132 00FBF6 FF FF FF FF FF FF FF FF    
  12132 00FBFE FF FF FF FF FF FF FF FF    
  12132 00FC06 FF FF FF FF FF FF FF FF    
  12132 00FC0E FF FF FF FF FF FF FF FF    
  12132 00FC16 FF FF FF FF FF FF FF FF    
  12132 00FC1E FF FF FF FF FF FF FF FF    
  12132 00FC26 FF FF FF FF FF FF FF FF    
  12132 00FC2E FF FF FF FF FF FF FF FF    
  12132 00FC36 FF FF FF FF FF FF FF FF    
  12132 00FC3E FF FF FF FF FF FF FF FF    
  12132 00FC46 FF FF FF FF FF FF FF FF    
  12132 00FC4E FF FF FF FF FF FF FF FF    
  12132 00FC56 FF FF FF FF FF FF FF FF    
  12132 00FC5E FF FF FF FF FF FF FF FF    
  12132 00FC66 FF FF FF FF FF FF FF FF    
  12132 00FC6E FF FF FF FF FF FF FF FF    
  12132 00FC76 FF FF FF FF FF FF FF FF    
  12132 00FC7E FF FF FF FF FF FF FF FF    
  12132 00FC86 FF FF FF FF FF FF FF FF    
  12132 00FC8E FF FF FF FF FF FF FF FF    
  12132 00FC96 FF FF FF FF FF FF FF FF    
  12132 00FC9E FF FF FF FF FF FF FF FF    
  12132 00FCA6 FF FF FF FF FF FF FF FF    
  12132 00FCAE FF FF FF FF FF FF FF FF    
  12132 00FCB6 FF FF FF FF FF FF FF FF    
  12132 00FCBE FF FF FF FF FF FF FF FF    
  12132 00FCC6 FF FF FF FF FF FF FF FF    
  12132 00FCCE FF FF FF FF FF FF FF FF    
  12132 00FCD6 FF FF FF FF FF FF FF FF    
  12132 00FCDE FF FF FF FF FF FF FF FF    
  12132 00FCE6 FF FF FF FF FF FF FF FF    
  12132 00FCEE FF FF FF FF FF FF FF FF    
  12132 00FCF6 FF FF FF FF FF FF FF FF    
  12132 00FCFE FF FF FF FF FF FF FF FF    
  12132 00FD06 FF FF FF FF FF FF FF FF    
  12132 00FD0E FF FF FF FF FF FF FF FF    
  12132 00FD16 FF FF FF FF FF FF FF FF    
  12132 00FD1E FF FF FF FF FF FF FF FF    
  12132 00FD26 FF FF FF FF FF FF FF FF    
  12132 00FD2E FF FF FF FF FF FF FF FF    
  12132 00FD36 FF FF FF FF FF FF FF FF    
  12132 00FD3E FF FF FF FF FF FF FF FF    
  12132 00FD46 FF FF FF FF FF FF FF FF    
  12132 00FD4E FF FF FF FF FF FF FF FF    
  12132 00FD56 FF FF FF FF FF FF FF FF    
  12132 00FD5E FF FF FF FF FF FF FF FF    
  12132 00FD66 FF FF FF FF FF FF FF FF    
  12132 00FD6E FF FF FF FF FF FF FF FF    
  12132 00FD76 FF FF FF FF FF FF FF FF    
  12132 00FD7E FF FF FF FF FF FF FF FF    
  12132 00FD86 FF FF FF FF FF FF FF FF    
  12132 00FD8E FF FF FF FF FF FF FF FF    
  12132 00FD96 FF FF FF FF FF FF FF FF    
  12132 00FD9E FF FF FF FF FF FF FF FF    
  12132 00FDA6 FF FF FF FF FF FF FF FF    
  12132 00FDAE FF FF FF FF FF FF FF FF    
  12132 00FDB6 FF FF FF FF FF FF FF FF    
  12132 00FDBE FF FF FF FF FF FF FF FF    
  12132 00FDC6 FF FF FF FF FF FF FF FF    
  12132 00FDCE FF FF FF FF FF FF FF FF    
  12132 00FDD6 FF FF FF FF FF FF FF FF    
  12132 00FDDE FF FF FF FF FF FF FF FF    
  12132 00FDE6 FF FF FF FF FF FF FF FF    
  12132 00FDEE FF FF FF FF FF FF FF FF    
  12132 00FDF6 FF FF FF FF FF FF FF FF    
  12132 00FDFE FF FF                      
  12133 00FE00 4C 71 D7                     	JMP		SuperGetch		; FE00
  12134 00FE03 4C 7C D7                     	JMP		warm_start		; FE03
  12135 00FE06 4C 78 D7                     	JMP		SuperPutch		; FE06
  12136 00FE09 4C 21 C9                     	JMP		BIOSInput		; FE09
  12137 00FE0C 4C F3 D8                     	JMP		BasicGetch		; FE0C
  12138 00FE0F 4C FE D8                     	JMP		xitBasic		; FE0F
  12139 00FE12 4C 43 D9                     	JMP		BASIC_Loadfile	; FE12
  12140 00FE15 4C 23 D9                     	JMP		BASIC_Savefile	; FE15
                                           
  12142 00FE18 FF FF FF FF FF FF FF FF      	.org	$FF00
  12142 00FE20 FF FF FF FF FF FF FF FF    
  12142 00FE28 FF FF FF FF FF FF FF FF    
  12142 00FE30 FF FF FF FF FF FF FF FF    
  12142 00FE38 FF FF FF FF FF FF FF FF    
  12142 00FE40 FF FF FF FF FF FF FF FF    
  12142 00FE48 FF FF FF FF FF FF FF FF    
  12142 00FE50 FF FF FF FF FF FF FF FF    
  12142 00FE58 FF FF FF FF FF FF FF FF    
  12142 00FE60 FF FF FF FF FF FF FF FF    
  12142 00FE68 FF FF FF FF FF FF FF FF    
  12142 00FE70 FF FF FF FF FF FF FF FF    
  12142 00FE78 FF FF FF FF FF FF FF FF    
  12142 00FE80 FF FF FF FF FF FF FF FF    
  12142 00FE88 FF FF FF FF FF FF FF FF    
  12142 00FE90 FF FF FF FF FF FF FF FF    
  12142 00FE98 FF FF FF FF FF FF FF FF    
  12142 00FEA0 FF FF FF FF FF FF FF FF    
  12142 00FEA8 FF FF FF FF FF FF FF FF    
  12142 00FEB0 FF FF FF FF FF FF FF FF    
  12142 00FEB8 FF FF FF FF FF FF FF FF    
  12142 00FEC0 FF FF FF FF FF FF FF FF    
  12142 00FEC8 FF FF FF FF FF FF FF FF    
  12142 00FED0 FF FF FF FF FF FF FF FF    
  12142 00FED8 FF FF FF FF FF FF FF FF    
  12142 00FEE0 FF FF FF FF FF FF FF FF    
  12142 00FEE8 FF FF FF FF FF FF FF FF    
  12142 00FEF0 FF FF FF FF FF FF FF FF    
  12142 00FEF8 FF FF FF FF FF FF FF FF    
                                         
  12143 00FF00 4C 64 E1                     	JMP		FMTK_ScheduleTask	; FE18
  12144 00FF03 4C 0D E0                     	JMP		FMTK_Sleep
  12145 00FF06 4C 06 FF                     	JMP		FMTK_StartTask
  12146 00FF09 4C B9 E0                     	JMP		FMTK_ExitTask
  12147 00FF0C 4C 38 E0                     	JMP		FMTK_KillTask
  12148 00FF0F 4C 88 DC                     	JMP		FMTK_AllocMbx
  12149 00FF12 4C 00 00                     	JMP		$0				; reserved for FreeMbx
  12150 00FF15 4C 17 DD                     	JMP		FMTK_SendMsg
  12151 00FF18 4C 17 DD                     	JMP		FMTK_PostMsg
  12152 00FF1B 4C 0B DE                     	JMP		FMTK_WaitMsg
  12153 00FF1E 4C 9D DF                     	JMP		FMTK_PeekMsg
  12154 00FF21 4C 0A DF                     	JMP		FMTK_CheckMsg
                                           
  12156 00FF24 FF FF FF FF FF FF FF FF      	.org 	$FFD6
  12156 00FF2C FF FF FF FF FF FF FF FF    
  12156 00FF34 FF FF FF FF FF FF FF FF    
  12156 00FF3C FF FF FF FF FF FF FF FF    
  12156 00FF44 FF FF FF FF FF FF FF FF    
  12156 00FF4C FF FF FF FF FF FF FF FF    
  12156 00FF54 FF FF FF FF FF FF FF FF    
  12156 00FF5C FF FF FF FF FF FF FF FF    
  12156 00FF64 FF FF FF FF FF FF FF FF    
  12156 00FF6C FF FF FF FF FF FF FF FF    
  12156 00FF74 FF FF FF FF FF FF FF FF    
  12156 00FF7C FF FF FF FF FF FF FF FF    
  12156 00FF84 FF FF FF FF FF FF FF FF    
  12156 00FF8C FF FF FF FF FF FF FF FF    
  12156 00FF94 FF FF FF FF FF FF FF FF    
  12156 00FF9C FF FF FF FF FF FF FF FF    
  12156 00FFA4 FF FF FF FF FF FF FF FF    
  12156 00FFAC FF FF FF FF FF FF FF FF    
  12156 00FFB4 FF FF FF FF FF FF FF FF    
  12156 00FFBC FF FF FF FF FF FF FF FF    
  12156 00FFC4 FF FF FF FF FF FF FF FF    
  12156 00FFCC FF FF FF FF FF FF FF FF    
  12156 00FFD4 FF FF                      
  12157 00FFD6 04 00                        	dw		4			; task #4
                                           
  12159 00FFD8 FF FF FF FF FF FF            	.org	$FFDE		; '832 IRQ vector
  12160 00FFDE 01 00                        	dw		1			;
                                           
                                           	.org	$FFE0		; IRQ3 vector
  12163 00FFE0 03 00                        	dw		3
                                           
  12165 00FFE2 FF FF FF FF                  	.org 	$FFE6
  12166 00FFE6 C8 E2                        	dw		BrkRout
                                           
  12168 00FFE8 FF FF FF FF FF FF            	.org	$FFEE		; '816 IRQ vector
  12169 00FFEE 01 00                        	dw		1			; IRQRout816
                                           
  12171 00FFF0 FF FF FF FF FF FF FF FF      	.org	$FFFC		; reset vector
  12171 00FFF8 FF FF FF FF                
  12172 00FFFC 00 C0                        	dw		$C000
                                           
                                           	.org	$FFFE
  12175 00FFFE 01 00                        	dw		1			; IRQRout02

Checksum=E146D8BB

Number of instructions processed: 5518
Number of opcode bytes: 13330
Bytes per instruction: 2.415730 (19.325843 bits)
Clock cycle count: 5861
Clocks per instruction: 1.062160

The above statistics are only estimates.

	The CPI assumes data memory access requires two clock cycles and instruction
	access is single cycle. The actual CPI may be higher if there are memory wait 
	states, or lower if data is found in the cache.
