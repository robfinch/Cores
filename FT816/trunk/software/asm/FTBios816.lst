Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
FTBios816.asm

                                        ; ============================================================================
                                        ; FTBios816.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014-2017  Robert Finch, Waterloo
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
     25 = 000000000000000D                            CR			EQU		13
     26 = 000000000000000A                            LF			EQU		10
     27 = 000000000000001B                            ESC			EQU		$1B
     28 = 0000000000000008                            BS			EQU		8
     29 = 0000000000000003                            CTRLC		EQU		3
                                        
     31 = 0000000000000012                            SC_LSHIFT	EQU		$12
     32 = 0000000000000059                            SC_RSHIFT	EQU		$59
     33 = 00000000000000F0                            SC_KEYUP	EQU		$F0
     34 = 00000000000000E0                            SC_EXTEND	EQU		$E0
     35 = 0000000000000014                            SC_CTRL		EQU		$14
     36 = 0000000000000011                            SC_ALT		EQU		$11
     37 = 0000000000000071                            SC_DEL		EQU		$71		; extend
     38 = 0000000000000058                            SC_LCTRL	EQU		$58
     39 = 0000000000000077                            SC_NUMLOCK	EQU		$77
     40 = 000000000000007E                            SC_SCROLLLOCK	EQU	$7E
     41 = 0000000000000058                            SC_CAPSLOCK	EQU		$58
                                        
     43 = 000000000000001F                            TEXTROWS	EQU		31
     44 = 0000000000000054                            TEXTCOLS	EQU		84
                                        
     46 = 0000000000000004                            TickCount	EQU		$4
     47 = 0000000000000008                            KeyState1	EQU		$8
     48 = 0000000000000009                            KeyState2	EQU		$9
     49 = 000000000000000A                            KeybdLEDs	EQU		$A
     50 = 000000000000000B                            KeybdWaitFlag	EQU	$B
     51 = 000000000000000C                            NumWorkArea	EQU		$C
                                        
                                        ; Range $10 to $1F reserved for hardware counters
     54 = 0000000000000010                            CNT0L		EQU		$10
     55 = 0000000000000011                            CNT0M		EQU		$11
     56 = 0000000000000012                            CNT0H		EQU		$12
     57 = 0000000000000020                            RangeStart	EQU		$20
     58 = 0000000000000024                            RangeEnd	EQU		$24
     59 = 0000000000000030                            CursorX		EQU		$30
     60 = 0000000000000032                            CursorY		EQU		$32
     61 = 0000000000000034                            VideoPos	EQU		$34
     62 = 0000000000000036                            NormAttr	EQU		$36
     63 = 0000000000000038                            StringPos	EQU		$38
     64 = 000000000000003C                            EscState	EQU		$3C
     65 = 0000000000000040                            Vidptr		EQU		$40
     66 = 0000000000000046                            Vidregs		EQU		$46
     67 = 000000000000004C                            Textcols	EQU		$4C
     68 = 000000000000004E                            Textrows	EQU		$4E
                                        
     70 = 0000000000000080                            reg_cs		EQU		$80
     71 = 00000084                      reg_ds		EQU		reg_cs + 4
     72 = 00000088                      reg_ss		EQU		reg_ds + 4
     73 = 0000008C                      reg_pc		EQU		reg_ss + 4
     74 = 00000090                      reg_a		EQU		reg_pc + 4
     75 = 00000094                      reg_x		EQU		reg_a + 4
     76 = 00000098                      reg_y		EQU		reg_x + 4
     77 = 0000009C                      reg_sp		EQU		reg_y + 4
     78 = 000000A0                      reg_sr		EQU		reg_sp + 4
     79 = 000000A4                      reg_db		EQU		reg_sr + 4
     80 = 000000A8                      reg_dp		EQU		reg_db + 4
     81 = 000000AC                      reg_bl		EQU		reg_dp + 4
     82 = 000000B0                      reg_mp		EQU		reg_bl + 4
                                        
     84 = 0000000000000080                            cs_save		EQU		$80
     85 = 0000000000000084                            ds_save		EQU		$84
     86 = 0000000000000088                            pc_save		EQU		$88
     87 = 000000000000008C                            pb_save		EQU		$8C
     88 = 0000000000000090                            acc_save	EQU		$90
     89 = 0000000000000094                            x_save		EQU		$94
     90 = 0000000000000098                            y_save		EQU		$98
     91 = 000000000000009C                            sp_save		EQU		$9C
     92 = 00000000000000A0                            sr_save		EQU		$A0
     93 = 00000000000000A4                            srx_save	EQU		$A4
     94 = 00000000000000A8                            db_save		EQU		$A8
     95 = 00000000000000AC                            dpr_save	EQU		$AC
                                        
                                        ;running_task	EQU		$B8
                                        
     99 = 00000000000000BA                            keybd_char	EQU		$BA
    100 = 00000000000000BA                            rw_flag		EQU		$BA
    101 = 00000000000000BC                            keybd_cmd	EQU		$BC
    102 = 00000000000000BE                            WorkTR		EQU		$BE
    103 = 00000000000000C0                            ExitCode	EQU		$C0
    104 = 00000000000000C4                            secnum		EQU		$C4
    105 = 00000000000000C8                            bufptr		EQU		$C8
    106 = 0000000000000100                            ldtrec		EQU		$100
    107 = 0000000000000104                            timeout1	EQU		$104
                                        
    109 = 0000000000000300                            RTCBuf		EQU		$300
    110 = 00000000000003F0                            OutputVec	EQU		$03F0
                                        
    112 = 000000000000B000                            PCS0		EQU		$B000
    113 = 0000B002                      PCS1		EQU		PCS0 + 2
    114 = 0000B004                      PCS2		EQU		PCS1 + 2
    115 = 0000B006                      PCS3		EQU		PCS2 + 2
    116 = 0000B008                      PCS4	    EQU		PCS3 + 2
    117 = 0000B00A                      PCS5		EQU		PCS4 + 2
    118 = 0000B010                      CTR0_LMT	EQU		PCS0 + 16
    119 = 0000B013                      CTR0_CTRL	EQU		CTR0_LMT + 3
    120 = 0000B014                      CTR1_LMT	EQU		CTR0_CTRL + 1
    121 = 0000B017                      CTR1_CTRL	EQU		CTR1_LMT + 3
    122 = 000000000000B01F                            MPU_IRQ_STATUS	EQU		$B01F
                                        
    124 = 00000000000D0000                            VIDBUF		EQU		$D0000		; FD0000
    125 = 00000000000EA000                            VIDREGS		EQU		$EA000
    126 = 00000000000EA100                            PRNG		EQU		$EA100
    127 = 00000000000EA110                            KEYBD		EQU		$EA110
    128 = 00000000000EA200                            FAC1		EQU		$EA200
                                        
    130 = 0000000000FEC000                            SPIMASTER	EQU		$00FEC000
    131 = 00FEC000                      SPI_MASTER_VERSION_REG	EQU	SPIMASTER+$00
    132 = 00FEC001                      SPI_MASTER_CONTROL_REG	EQU	SPIMASTER+$01
    133 = 00FEC002                      SPI_TRANS_TYPE_REG	EQU		SPIMASTER+$02
    134 = 00FEC003                      SPI_TRANS_CTRL_REG	EQU		SPIMASTER+$03
    135 = 00FEC004                      SPI_TRANS_STATUS_REG	EQU	SPIMASTER+$04
    136 = 00FEC005                      SPI_TRANS_ERROR_REG		EQU	SPIMASTER+$05
    137 = 00FEC006                      SPI_DIRECT_ACCESS_DATA_REG		EQU	SPIMASTER+$06
    138 = 00FEC007                      SPI_SD_SECT_7_0_REG		EQU	SPIMASTER+$07
    139 = 00FEC008                      SPI_SD_SECT_15_8_REG	EQU	SPIMASTER+$08
    140 = 00FEC009                      SPI_SD_SECT_23_16_REG	EQU	SPIMASTER+$09
    141 = 00FEC00A                      SPI_SD_SECT_31_24_REG	EQU	SPIMASTER+$0A
    142 = 00FEC010                      SPI_RX_FIFO_DATA_REG	EQU	SPIMASTER+$10
    143 = 00FEC011                      SPI_RX_FIFO_DATA_COUNT_MSB	EQU	SPIMASTER+$11
    144 = 00FEC012                      SPI_RX_FIFO_DATA_COUNT_LSB  EQU SPIMASTER+$12
    145 = 00FEC014                      SPI_RX_FIFO_CTRL_REG		EQU	SPIMASTER+$14
    146 = 00FEC020                      SPI_TX_FIFO_DATA_REG	EQU	SPIMASTER+$20
    147 = 00FEC024                      SPI_TX_FIFO_CTRL_REG	EQU	SPIMASTER+$24
    148 = 00FEC030                      SPI_RESP_BYTE1			EQU	SPIMASTER+$30
    149 = 00FEC031                      SPI_RESP_BYTE2			EQU	SPIMASTER+$31
    150 = 00FEC032                      SPI_RESP_BYTE3			EQU	SPIMASTER+$32
    151 = 00FEC033                      SPI_RESP_BYTE4			EQU	SPIMASTER+$33
                                        
    153 = 0000000000000001                            SPI_INIT_SD			EQU		$01
    154 = 0000000000000001                            SPI_TRANS_START		EQU		$01
    155 = 0000000000000001                            SPI_TRANS_BUSY		EQU		$01
    156 = 0000000000000000                            SPI_INIT_NO_ERROR	EQU		$00
    157 = 0000000000000000                            SPI_READ_NO_ERROR	EQU		$00
    158 = 0000000000000000                            SPI_WRITE_NO_ERROR	EQU		$00
    159 = 0000000000000002                            SPI_RW_READ_SD_BLOCK	EQU		$02
    160 = 0000000000000003                            SPI_RW_WRITE_SD_BLOCK	EQU		$03
                                        
    162 = 0000000000FEC100                            I2C_MASTER		EQU		$00FEC100
    163 = 00FEC100                      I2C_PRESCALE_LO	EQU		I2C_MASTER+$00
    164 = 00FEC101                      I2C_PRESCALE_HI	EQU		I2C_MASTER+$01
    165 = 00FEC102                      I2C_CONTROL		EQU		I2C_MASTER+$02
    166 = 00FEC103                      I2C_TX			EQU		I2C_MASTER+$03
    167 = 00FEC103                      I2C_RX			EQU		I2C_MASTER+$03
    168 = 00FEC104                      I2C_CMD			EQU		I2C_MASTER+$04
    169 = 00FEC104                      I2C_STAT		EQU		I2C_MASTER+$04
                                        
    171 = 00000000000EB000                            SID			EQU		$EB000		; FEB000
    172 = 0000000000000000                            SID_FREQ0		EQU		$00
    173 = 0000000000000004                            SID_PW0			EQU		$04
    174 = 0000000000000008                            SID_CTRL0		EQU		$08
    175 = 000000000000000C                            SID_ATTACK0		EQU		$0C
    176 = 0000000000000010                            SID_DECAY0		EQU		$10
    177 = 0000000000000014                            SID_SUSTAIN0	EQU		$14
    178 = 0000000000000018                            SID_RELEASE0	EQU		$18
    179 = 000000000000001C                            SID_WADR0		EQU		$1C
    180 = 00000000000000B0                            SID_VOLUME		EQU		$B0
                                        
    182 = 0000000000007868                            do_invaders			EQU		$7868
                                        
    184 = 0000000000020000                            TCB_Next		EQU		$20000	; 2 byte handles
    185 = 0000000000020400                            TCB_Prev		EQU		$20400	; 2 byte handles
    186 = 0000000000020800                            TCB_Timeout		EQU		$20800	; 4 byte value
    187 = 0000000000021000                            TCB_mbq_next	EQU		$21000	; 2 byte handles
    188 = 0000000000021400                            TCB_mbq_prev	EQU		$21400	; 2 byte handles
    189 = 0000000000021800                            TCB_msg_d1		EQU		$21800	; 4 byte value
    190 = 0000000000022000                            TCB_msg_d2		EQU		$22000	; 4 byte value
    191 = 0000000000022800                            TCB_msg_d3		EQU		$22800	; 4 byte value
    192 = 0000000000023000                            TCB_msg_tgtadr	EQU		$23000	; 2 byte handle
    193 = 0000000000023400                            TCB_msg_retadr	EQU		$23400	; 2 byte handle
    194 = 0000000000023800                            TCB_msg_link	EQU		$23800	; 2 byte handle
    195 = 0000000000023C00                            TCB_msg_type	EQU		$23C00	; 2 byte value
    196 = 0000000000024000                            TCB_hMbx1		EQU		$24000	; 2 byte handle
    197 = 0000000000024400                            TCB_hMbx2		EQU		$24400	; 2 byte handle
    198 = 0000000000024800                            TCB_hMbx3		EQU		$24800	; 2 byte handle
    199 = 0000000000024C00                            TCB_hMbx4		EQU		$24C00	; 2 byte handle
    200 = 0000000000025000                            TCB_hWaitMbx	EQU		$25000	; 2 byte handle
    201 = 0000000000025400                            TCB_number		EQU		$25400	; 2 byte value
    202 = 0000000000025800                            TCB_priority	EQU		$25800	; 1 byte value
    203 = 0000000000025A00                            TCB_status		EQU		$25A00	; 1 byte value
    204 = 0000000000025C00                            TCB_affinity	EQU		$25C00	; 1 byte value
    205 = 0000000000025E00                            TCB_hJob		EQU		$25E00	; 1 byte handle
    206 = 0000000000026000                            TCB_start_tick	EQU		$26000	; 4 byte value
    207 = 0000000000026800                            TCB_end_tick	EQU		$26800	; 4 byte value
    208 = 0000000000027000                            TCB_ticks		EQU		$27000	; 4 byte value
    209 = 0000000000027800                            TCB_exception	EQU		$27800	; 4 byte value
                                        
    211 = 000000000002FFFE                            running_task	EQU		$2FFFE
                                        
    213 = 000000000002C000                            MSG_d1		EQU		$2C000	; 4 byte value	( 4096 messages )
    214 = 0000000000030000                            MSG_d2		EQU		$30000	; 4 byte value
    215 = 0000000000034000                            MSG_d3		EQU		$34000	; 4 byte value
    216 = 0000000000038000                            MSG_tgtadr	EQU		$38000	; 2 byte handle
    217 = 000000000003A000                            MSG_retadr	EQU		$3A000	; 2 byte handle
    218 = 000000000003C000                            MSG_link	EQU		$3C000	; 2 byte handle
    219 = 000000000003E000                            MSG_type	EQU		$3E000	; 2 byte value
                                        
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
supermon832.asm

                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;	.opt proc65c02,caseinsensitive
                                        	cpu	W65C02
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;*                                                                                 *
                                        ;*      SUPERMON 816 MACHINE LANGUAGE MONITOR FOR THE W65C816S MICROPROCESSOR      *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;*      Copyright ©1991-2014 by BCS Technology Limited.  All rights reserved.      *
                                        ;*                                                                                 *
                                        ;* Permission is hereby granted to use, copy, modify and distribute this software, *
                                        ;* provided this copyright notice remains in the source code and  proper  attribu- *
                                        ;* tion is given.  Redistribution, regardless of form, must be at no charge to the *
                                        ;* end  user.  This code or any part thereof, including any derivation, MAY NOT be *
                                        ;* incorporated into any package intended for sale,  unless written permission has * 
                                        ;* been given by the copyright holder.                                             *
                                        ;*                                                                                 *
                                        ;* THERE IS NO WARRANTY OF ANY KIND WITH THIS SOFTWARE.  The user assumes all risk *
                                        ;* in connection with the incorporation of this software into any system.          *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a salute to Jim Butterfield, who passed away on June 29, 2007.  *
                                        ;*                                                                                 *
                                        ;* Jim, who was the unofficial  spokesman for  Commodore  International during the *  
                                        ;* heyday of the company's 8 bit supremacy, scratch-developed the Supermon machine *
                                        ;* language monitor for the PET & CBM computers.   When the best-selling Commodore *
                                        ;* 64 was introduced, Jim adapted his software to the new machine & gave the adap- *
                                        ;* tation the name Supermon 64.   Commodore  subsequently  integrated a customized *
                                        ;* version of Supermon 64 into the C-128 to act as the resident M/L monitor.       *
                                        ;*                                                                                 *
                                        ;* Although Supermon 816 is not an adaptation of Supermon 64,  it was  decided  to *
                                        ;* keep the Supermon name alive, since Supermon 816's general operation & user in- *
                                        ;* terface is similar to that of Supermon 64.   Supermon 816 is 100 percent native *
                                        ;* mode 65C816 code & was developed from a blank canvas.                           *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* This version customized for the RTF65002 test system                            *
                                        ;* Finitron.ca                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a full featured monitor and supports the following operations:  *
                                        ;*                                                                                 *
                                        ;*     A — Assemble code                                                           *
                                        ;*     C — Compare memory regions                                                  *
                                        ;*     D — Disassemble code                                                        *
                                        ;*     F — Fill memory region (cannot span banks)                                  *
                                        ;*     G — Execute code (stops at BRK)                                             *
                                        ;*     H — Search (hunt) memory region                                             *
                                        ;*     J — Execute code as a subroutine (stops at BRK or RTS)                      *
                                        ;*     M — Dump & display memory range                                             *
                                        ;*     R — Dump & display 65C816 registers                                         *
                                        ;*     T — Copy (transfer) memory region                                           *
                                        ;*     X — Exit Supermon 816 & return to operating environment                     *
                                        ;*     > — Modify up to 32 bytes of memory                                         *
                                        ;*     ; — Modify 65C816 registers                                                 *
                                        ;*                                                                                 *
                                        ;* Supermon 816 accepts binary (%), octal (@), decimal (+) and hexadecimal ($) as  *
                                        ;* input for numeric parameters.  Additionally, the H and > operations accept an   *
                                        ;* ASCII string in place of numeric values by preceding the string with ', e.g.:   *
                                        ;*                                                                                 *
                                        ;*     h 042000 042FFF 'BCS Technology Limited                                     *
                                        ;*                                                                                 *
                                        ;* If no radix symbol is entered hex is assumed.                                   *
                                        ;*                                                                                 *
                                        ;* Numeric conversion is also available.  For example, typing:                     *
                                        ;*                                                                                 *
                                        ;*     +1234567 <CR>                                                               *
                                        ;*                                                                                 *
                                        ;* will display:                                                                   *
                                        ;*                                                                                 *
                                        ;*         $12D687                                                                 *
                                        ;*         +1234567                                                                *
                                        ;*         @04553207                                                               *
                                        ;*         %100101101011010000111                                                  *
                                        ;*                                                                                 *
                                        ;* In the above example, <CR> means the console keyboard's return or enter key.    *
                                        ;*                                                                                 *
                                        ;* All numeric values are internally processed as 32 bit unsigned integers.  Addr- *
                                        ;* esses may be entered as 8, 16 or 24 bit values.  During instruction assembly,   *
                                        ;* immediate mode operands may be forced to 16 bits by preceding the operand with  *
                                        ;* an exclamation point if the instruction can accept a 16 bit operand, e.g.:      *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 lda !#4                                                            *
                                        ;*                                                                                 *
                                        ;* The above will assemble as:                                                     *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A9 04 00     LDA #$0004                                           *
                                        ;*                                                                                 *
                                        ;* Entering:                                                                       *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 ldx !#+157                                                         *
                                        ;*                                                                                 *
                                        ;* will assemble as:                                                               *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D 00     LDX #$009D                                           *
                                        ;*                                                                                 *
                                        ;* Absent the ! in the operand field, the above would have been assembled as:      *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D        LDX #$9D                                             *
                                        ;*                                                                                 *
                                        ;* If an immediate mode operand is greater than $FF assembly of a 16 bit operand   *
                                        ;* is implied.                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* A Note on the PEA & PEI Instructions                                            *
                                        ;* ————————————————————————————————————                                            *
                                        ;*                                                                                 *
                                        ;* The Eyes and Lichty programming manual uses the following syntax for the PEA    *
                                        ;* and PEI instructions:                                                           *
                                        ;*                                                                                 *
                                        ;*     PEA <operand>                                                               *
                                        ;*     PEI (<operand>)                                                             *
                                        ;*                                                                                 *
                                        ;* The WDC data sheet that was published at the time of the 65C816's release in    *
                                        ;* 1984 does not indicate a recommended or preferred syntax for any of the above   *
                                        ;* instructions.  PEA pushes its operand to the stack and hence operates like any  *
                                        ;* other immediate mode instruction, in that the operand is the data (however, PEA *
                                        ;* doesn't affect the status register).  Similarly, PEI pushes the 16 bit value    *
                                        ;* stored at <operand> and <operand>+1, and hence operates like any other direct   *
                                        ;* (zero) page instruction, again without affecting the status register.           *
                                        ;*                                                                                 *
                                        ;* BCS Technology Limited is of the opinion that the developer of the ORCA/M as-   *
                                        ;* sembler, which is the assembler referred to in the Eyes and Lichty manual, mis- *
                                        ;* understood how PEA and PEI behave during runtime, and hence chose an incorrect  *
                                        ;* syntax for these two instructions.  This error was subsequently carried forward *
                                        ;* by Eyes and Lichty.                                                             *
                                        ;*                                                                                 *
                                        ;* Supermon 816's assembler uses the following syntax for PEA and PEI:             *
                                        ;*                                                                                 *
                                        ;*     PEA #<operand>                                                              *
                                        ;*     PEI <operand>                                                               *
                                        ;*                                                                                 *
                                        ;* The operand for PEA is treated as a 16 bit value, even if entered as an 8 bit   *
                                        ;* value.  The operand for PEI must be 8 bits.                                     *
                                        ;*                                                                                 *
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;	* * * * * * * * * * * *
                                        ;	* VERSION INFORMATION *
                                        ;	* * * * * * * * * * * *
                                        ;
                                        softvers .macro                ;software version — change with each revision...
                                                 .byte "1"             ;major
                                                 .byte "."
                                                 .byte "0"             ;minor
                                                 .byte "."
                                                 .byte "0"             ;revision
                                                 .endm
                                        ;
                                        ;REVISION TABLE
                                        ;
                                        ;Ver  Rev Date    Description
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;1.0  2013/11/01  A) Original derived from the POC V1.1 single-board computer
                                        ;                    firmware.
                                        ;     2013/11/04  A) Fixed a problem where the B-accumulator wasn't always being
                                        ;                    be copied to shadow storage after return from execution of
                                        ;                    a J command.
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	        COMMENT ABBREVIATIONS
                                        ;	————————————————————————————————————————————————————
                                        ;	  BCD   binary-coded decimal
                                        ;	   DP   direct page or page zero
                                        ;	  EOF   end-of-field
                                        ;	  EOI   end-of-input
                                        ;	  LSB   least significant byte/bit
                                        ;	  LSD   least significant digit
                                        ;	  LSN   least significant nybble
                                        ;	  LSW   least significant word
                                        ;	  MPU   microprocessor
                                        ;	  MSB   most significant byte/bit
                                        ;	  MSD   most significant digit
                                        ;	  MSN   most significant nybble
                                        ;	  MSW   most-significant word
                                        ;	  RAM   random access memory
                                        ;	   WS   whitespace, i.e., blanks & horizontal tabs
                                        ;	————————————————————————————————————————————————————
                                        ;	A word is defined as 16 bits.
                                        ;
                                        ;	   MPU REGISTER SYMBOLS
                                        ;	——————————————————————————
                                        ;	   .A   accumulator LSB
                                        ;	   .B   accumulator MSB
                                        ;	   .C   16 bit accumulator
                                        ;	   .X   X-index
                                        ;	   .Y   Y-index
                                        ;      DS   data segment
                                        ;	   DB   data bank
                                        ;	   DP   direct page
                                        ;      CS   code segment
                                        ;	   PB   program bank
                                        ;	   PC   program counter
                                        ;	   SP   stack pointer
                                        ;	   SR   MPU status
                                        ;      SRX  status extension
                                        ;	————————————————————————————
                                        ;
                                        ;	  MPU STATUS REGISTER SYMBOLS
                                        ;	———————————————————————————————
                                        ;	    C   carry
                                        ;	    D   decimal mode
                                        ;	    I   maskable interrupts
                                        ;	    m   accumulator/memory size
                                        ;	    N   result negative
                                        ;	    V   sign overflow
                                        ;	    x   index registers size
                                        ;	    Z   result zero
                                        ;
                                        ;      16   16 bit emulation flag
                                        ;      32   32 bit emulation flag
                                        ;	———————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SYSTEM INTERFACE DEFINITIONS
                                        ;
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;	This section defines the interface between Supermon 816 & the host
                                        ;	system.   Change these definitions to suit your system, but do not
                                        ;	change any label names.  All definitions must have valid values in
                                        ;	order to assemble Supermon 816.
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————
    442 = 000000000000C000                            _origin_ =$00C000              ;assembly address...
                                        ;
                                        ;	Set _ORIGIN_ to Supermon 816's desired assembly address.
                                        ;	————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    448 = 000000000000FE03                            vecexit  =$00FE03              ;exit to environment address...
                                        ;
                                        ;	Set VECEXIT to where Supermon 816 should go when it exits.  Supermon 816
                                        ;	will do a JML (long jump) to this address, which means VECEXIT must be a
                                        ;	24 bit address.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    456 = 0000000000000102                            vecbrki  =$0102                ;BRK handler indirect vector...
    457 = 0000000000000105                            vecbrkia =$0105                ;system indirect BRK vector
                                        ;
                                        ;	Supermon 816 will modify this vector so that execution of a BRK instruc-
                                        ;	tion is intercepted & the registers  are  captured.   Your BRK front end
                                        ;	should jump through this vector after pushing the registers as follows:
                                        ;
                                        ;	         phb                   ;save DB
                                        ;	         phd                   ;save DP
                                        ;	         rep #%00110000        ;16 bit registers
                                        ;	         pha
                                        ;	         phx
                                        ;	         phy
                                        ;	         jmp (vecbrki)         ;indirect vector
                                        ;
                                        ;	When a G or J command is issued, the above sequence will be reversed be-
                                        ;	fore a jump is made to the code to be executed.  Upon exit from Supermon
                                        ;	816, the original address at VECBRKI will be restored.
                                        ;
                                        ;	If your BRK front end doesn't conform to the above you will have to mod-
                                        ;	ify Supermon 816 to accommodate the differences.  The most likely needed
                                        ;	changes will be in the order in which registers are pushed to the stack.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    481 = 0000000000003FFF                            hwstack  =$3fff                ;top of hardware stack...
                                        ;
                                        ;	Supermon 816 initializes the stack pointer to this address when the cold
                                        ;	start at MONCOLD is called to enter the monitor.  The stack pointer will
                                        ;	be undisturbed when entry into Supermon 816 is through JMONBRK (see jump
                                        ;	table definitions).
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    490 = 0000000000000080                            zeropage =$80                  ;Supermon 816's direct page...
                                        ;
                                        ;	Supermon 816 uses direct page starting at this address.  Be sure that no
                                        ;	conflict occurs with other software.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    496 = 00000000000000FC                            biosctx	 =$FC
                                        ;	————————————————————————————————————————————————————————————————————————
    498 = 000000000000FE00                            getcha   =$FE00                ;get keystroke from console...
                                        ;
                                        ;	GETCHA refers to an operating system API call that returns a keystroke
                                        ;	in the 8 bit accumulator.  Supermon 816  assumes that GETCHA is a non-
                                        ;	blocking subroutine & returns with carry clear to indicate that a key-
                                        ;	stroke is in .A, or with carry set to indicate that no keystroke was
                                        ;	available.  GETCHA will be called with a JSR instruction.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from GETCHA.
                                        ;	You may have to modify Supermon 816 at all calls to GETCHA if your "get
                                        ;	keystroke" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    512 = 000000000000FE06                            putcha   =$FE06                ;print character on console...
                                        ;
                                        ;	PUTCHA refers to an operating system API call that prints a character to
                                        ;	the console screen.  The character to be printed will be in .A, which
                                        ;	will be set to 8-bit width.  Supermon 816 assumes that PUTCHA will block
                                        ;	until the character can be processed.  PUTCHA will be called with a JSR
                                        ;	instructions.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from PUTCHA.
                                        ;	You may have to modify Supermon 816 at all calls to PUTCHA if your "put
                                        ;	character" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    526 = 0000000000000003                            stopkey  =$03                  ;display abort key...
                                        ;
                                        ;	Supermon 816 will poll for a "stop key" during display operations, such
                                        ;	as code disassembly & memory dumps, so as to abort further processing &
                                        ;	return to the command prompt.  STOPKEY must be defined with the ASCII
                                        ;	value that the "stop key" will emit when typed.  The polling is via a
                                        ;	call to GETCHA (described above).  The default STOPKEY definition of $03
                                        ;	is for ASCII <ETX> or [Ctrl-C].
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    536 = 0000000000000200                            ibuffer  =$000200               ;input buffer &...
    537 = 00000251                      auxbuf   =ibuffer+s_ibuf+1 ;auxiliary buffer...
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	Supermon 816 will use the above definitions for input buffers.  These
                                        ;	buffers may be located anywhere in RAM that is convenient.  The buffers
                                        ;	are stateless, which means that unless Supermon 816 has control of your
                                        ;	system, they may be overwritten without consequence.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S INSTRUCTION SYNTHESIS MACROS —— !!!!! DO NOT EDIT !!!!!
                                        ;
                                        _asm24_  .macro .ad
                                                 .byte <.ad,>.ad,.ad >> 16
                                                 .endm
                                        ;
                                        brl      .macro .ad
                                        .ba      =*+3
                                                 .byte $82
                                                 .word .ad-.ba
                                                 .endm
                                        ;
                                        ; jml is supported for the RTF65002 in 65c02 mode. And the opcode is supported
                                        ; by the assembler.
                                        ;jml      .macro .ad
                                        ; ;        .byte $5c
                                        ;         _asm24_ .ad
                                        ;         .endm
                                        ;
                                        mvn      .macro .s,.d
                                                 .byte $54,.d,.s
                                                 .endm
                                        ;
                                        mvp      .macro .s,.d
                                                 .byte $44,.d,.s
                                                 .endm
                                        ;
                                        pea      .macro .op
                                                 .byte $f4
                                                 .word .op
                                                 .endm
                                        ;
                                        phb      .macro
                                                 .byte $8b
                                                 .endm
                                        ;
                                        phk      .macro
                                                 .byte $4b
                                                 .endm
                                        ;
                                        plb      .macro
                                                 .byte $ab
                                                 .endm
                                        ;
                                        rep      .macro .op
                                                 .byte $c2,.op
                                                 .endm
                                        ;
                                        sep      .macro .op
                                                 .byte $e2,.op
                                                 .endm
                                        ;
                                        tcd      .macro
                                                 .byte $5b
                                                 .endm
                                        ;
                                        tcs      .macro
                                                 .byte $1b
                                                 .endm
                                        ;
                                        tdc      .macro
                                                 .byte $7b
                                                 .endm
                                        ;
                                        tsc      .macro
                                                 .byte $3b
                                                 .endm
                                        ;
                                        txy      .macro
                                                 .byte $9b
                                                 .endm
                                        ;
                                        tyx      .macro
                                                 .byte $bb
                                                 .endm
                                        ;
                                        wai      .macro
                                                 .byte $cb
                                                 .endm
                                        ;
                                        xba      .macro
                                                 .byte $eb
                                                 .endm
                                        ;
                                        adcw     .macro .op
                                                 adc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        andw     .macro .op
                                                 and #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        bitw     .macro .op
                                                 bit #<.op
                                                 .byte >.op
                                                 .endm
                                        ;         
                                        cmpw     .macro .op
                                                 cmp #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpxw     .macro .op
                                                 cpx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpyw     .macro .op
                                                 cpy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        eorw     .macro .op
                                                 eor #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldaw     .macro .op
                                                 lda #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldxw     .macro .op
                                                 ldx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldyw     .macro .op
                                                 ldy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        oraw     .macro .op
                                                 ora #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        sbcw     .macro .op
                                                 sbc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldalx    .macro .ad
                                                 .byte $+         .byte a_esc,"("
                                     +            .byte a_esc,"G4"
                                        
                                     +            .byte <.ad,>.ad,.ad >> 16
                                        
                                                 .endm
                                        ;
                                        adcil    .macro .ad
                                                 .byte $67,.ad
                                                 .endm
                                        ;
                                        adcily   .macro .ad
                                                 .byte $77,.ad
                                                 .endm
                                        ;
                                        andil    .macro .ad
                                                 .byte $27,.ad
                                                 .endm
                                        ;
                                        andily   .macro .ad
                                                 .byte $37,.ad
                                                 .endm
                                        ;
                                        cmpil    .macro .ad
                                                 .byte $c7,.ad
                                                 .endm
                                        ;
                                        cmpily   .macro .ad
                                                 .byte $d7,.ad
                                                 .endm
                                        ;
                                        eoril    .macro .ad
                                                 .byte $47,.ad
                                                 .endm
                                        ;
                                        eorily   .macro .ad
                                                 .byte $57,.ad
                                                 .endm
                                        ;
                                        ldail    .macro .ad
                                                 .byte $a7,.ad
                                                 .endm
                                        ;
                                        ldaily   .macro .ad
                                                 .byte $b7,.ad
                                                 .endm
                                        ;
                                        orail    .macro .ad
                                                 .byte $07,.ad
                                                 .endm
                                        ;
                                        oraily   .macro .ad
                                                 .byte $17,.ad
                                                 .endm
                                        ;
                                        sbcil    .macro .ad
                                                 .byte $e7,.ad
                                                 .endm
                                        ;
                                        sbcily   .macro .ad
                                                 .byte $f7,.ad
                                                 .endm
                                        ;
                                        stail    .macro .ad
                                                 .byte $87,.ad
                                                 .endm
                                        ;
                                        staily   .macro .ad
                                                 .byte $97,.ad
                                                 .endm
                                        ;
                                        adcs     .macro .of
                                                 .byte $63,.of
                                                 .endm
                                        ;
                                        adcsi    .macro .of
                                                 .byte $73,.of
                                                 .endm
                                        ;
                                        ands     .macro .of
                                                 .byte $23,.of
                                                 .endm
                                        ;
                                        andsi    .macro .of
                                                 .byte $33,.of
                                                 .endm
                                        ;
                                        cmps     .macro .of
                                                 .byte $c3,.of
                                                 .endm
                                        ;
                                        cmpsi    .macro .of
                                                 .byte $d3,.of
                                                 .endm
                                        ;
                                        eors     .macro .of
                                                 .byte $43,.of
                                                 .endm
                                        ;
                                        eorsi    .macro .of
                                                 .byte $53,.of
                                                 .endm
                                        ;
                                        ldas     .macro .of
                                                 .byte $a3,.of
                                                 .endm
                                        ;
                                        ldasi    .macro .of
                                                 .byte $b3,.of
                                                 .endm
                                        ;
                                        oras     .macro .of
                                                 .byte $03,.of
                                                 .endm
                                        ;
                                        orasi    .macro .of
                                                 .byte $13,.of
                                                 .endm
                                        ;
                                        sbcs     .macro .of
                                                 .byte $e3,.of
                                                 .endm
                                        ;
                                        sbcsi    .macro .of
                                                 .byte $f3,.of
                                                 .endm
                                        ;
                                        stas     .macro .of
                                                 .byte $83,.of
                                                 .endm
                                        ;
                                        stasi    .macro .of
                                                 .byte $93,.of
                                                 .endm
                                        ;
                                        longa    .macro
                                                 .byte $c2,$20
                                                 .endm
                                        ;
                                        longr    .macro
                                                 .byte $c2,$30
                                                 .endm
                                        ;
                                        longx    .macro
                                                 .byte $c2,$10
                                                 .endm
                                        ;
                                        shorta   .macro
                                                 .byte $e2,$20
                                                 .endm
                                        ;
                                        shorti   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        shortr   .macro
                                                 .byte $e2,$30
                                                 .endm
                                        ;
                                        shortx   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL MACROS
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The following macros execute terminal  control procedures  that  perform
                                        ;	such tasks as clearing the screen,  switching  between  normal & reverse
                                        ;	video, etc.  These macros are for WYSE 60 & compatible displays, such as
                                        ;	the WYSE 150, WYSE 160, WYSE 325 & WYSE GPT.   Only the functions needed
                                        ;	by Supermon 816 are included.
                                        ;
                                        ;	If your console is not WYSE 60 compatible, you will need to  edit  these
                                        ;	macros as required to control your particular console or terminal.  Note
                                        ;	that in some cases one macro may call another.  Exercise caution in your
                                        ;	edits to avoid introducing display bugs.
                                        ;
                                        ;	If your console display cannot execute one of these procedures,  such as
                                        ;	'CL' (clear to end of line), you will have to develop an alternative.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	clearing data...
                                        ;
                                        bs       .macro                ;destructive backspace
                                                 .byte a_bs
                                     +            .byte a_esc,"W"
                                        
                                                 .endm
                                        ;
                                        cl       .macro                ;clear to end of line 
                                                 .byte a_esc,"T"
                                                 .endm
                                        ;
                                        ;
                                        ;	cursor control...
                                        ;
                                        cn       .macro                ;cursor on
                                                 .byte a_esc,"`1"
                                                 .endm
                                        ;
                                        co       .macro                ;cursor off
                                                 .byte a_esc,"`0"
                                                 .endm
                                        ;
                                        cr       .macro                ;carriage return
                                                 .byte a_cr
                                                 .endm
                                        ;
                                        lf       .macro                ;carriage return/line feed
                                     +            .byte a_cr
                                        
                                                 .byte a_lf
                                                 .endm
                                        ;
                                        ;
                                        ;	display attributes...
                                        ;
                                        bf       .macro                ;reverse foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G4"
                                                 .endm
                                        ;
                                        er       .macro                ;enable normal foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        sf       .macro                ;set foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        ;
                                        ;	display editing...
                                        ;
                                        dcuc     .macro                ;delete char under cursor
                                                 .byte a_esc,"W"
                                                 .endm
                                        ;
                                        ;
                                        ;	miscellaneous control...
                                        ;
                                        rb       .macro                ;ring "bell"
                                                 .byte a_bel
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASCII CONTROL DEFINITIONS (menmonic order)
                                        ;
    946 = 0000000000000007                            a_bel    =$07                  ;<BEL> alert/ring bell
    947 = 0000000000000008                            a_bs     =$08                  ;<BS>  backspace
    948 = 000000000000000D                            a_cr     =$0d                  ;<CR>  carriage return
    949 = 000000000000007F                            a_del    =$7f                  ;<DEL> delete
    950 = 000000000000001B                            a_esc    =$1b                  ;<ESC> escape
    951 = 0000000000000009                            a_ht     =$09                  ;<HT>  horizontal tabulation
    952 = 000000000000000A                            a_lf     =$0a                  ;<LF>  linefeed
                                        ;
                                        ;
                                        ;	miscellaneous (description order)...
                                        ;
    957 = 20                            a_blank  =' '                  ;blank (whitespace)
    958 = 7A                            a_asclch ='z'                  ;end of lowercase ASCII
    959 = 000000000000005F                            a_lctouc =$5f                  ;LC to UC conversion mask
    960 = 61                            a_asclcl ='a'                  ;start of lowercase ASCII
    961 = 3A                            a_colon  =':'
                                        ;
                                        ;================================================================================
                                        ;
                                        ;GLOBAL ATOMIC CONSTANTS
                                        ;
                                        ;
                                        ;	data type sizes...
                                        ;
    970 = 0000000000000001                            s_byte   =1                    ;byte
    971 = 0000000000000002                            s_word   =2                    ;word (16 bits)
    972 = 0000000000000003                            s_xword  =3                    ;extended word (24 bits)
    973 = 0000000000000004                            s_dword  =4                    ;double word (32 bits)
    974 = 0000000000000100                            s_rampag =$0100                ;65xx RAM page
                                        ;
                                        ;
                                        ;	data type sizes in bits...
                                        ;
    979 = 0000000000000008                            s_bibyte =8                    ;byte
    980 = 0000000000000004                            s_bnybbl =4                    ;nybble
                                        ;
                                        ;
                                        ;	miscellaneous...
                                        ;
    985 = 000000000000002C                            bitabs   =$2c                  ;absolute BIT opcode
    986 = 0000000000000024                            bitzp    =$24                  ;zero page BIT opcode
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S NATIVE MODE STATUS REGISTER DEFINITIONS
                                        ;
    992 = 00000001                      s_mpudbx =s_byte               ;data bank size
    993 = 00000002                      s_mpudpx =s_word               ;direct page size
    994 = 00000001                      s_mpupbx =s_byte               ;program bank size
    995 = 00000002                      s_mpupcx =s_word               ;program counter size
    996 = 00000002                      s_mpuspx =s_word               ;stack pointer size
    997 = 00000001                      s_mpusrx =s_byte               ;status size
                                        ;
                                        ;
                                        ;	status register flags...
                                        ;
   1002 = 0000000000000001                            sr_car   =%00000001            ;C
   1003 = 00000002                      sr_zer   =sr_car << 1          ;Z
   1004 = 00000004                      sr_irq   =sr_zer << 1          ;I
   1005 = 00000008                      sr_bdm   =sr_irq << 1          ;D
   1006 = 00000010                      sr_ixw   =sr_bdm << 1          ;x
   1007 = 00000020                      sr_amw   =sr_ixw << 1          ;m
   1008 = 00000040                      sr_ovl   =sr_amw << 1          ;V
   1009 = 00000080                      sr_neg   =sr_ovl << 1          ;N
   1010 = 00000100                      sr_16	 =sr_neg << 1
   1011 = 00000200                      sr_32    =sr_16 << 1
                                        ;
                                        ;	NVmxDIZC
                                        ;	xxxxxxxx
                                        ;	||||||||
                                        ;	|||||||+———> 1 = carry set/generated
                                        ;	||||||+————> 1 = result = zero
                                        ;	|||||+—————> 1 = IRQs ignored
                                        ;	||||+——————> 0 = binary arithmetic mode
                                        ;	||||         1 = decimal arithmetic mode
                                        ;	|||+———————> 0 = 16 bit index
                                        ;	|||          1 = 8 bit index
                                        ;	||+————————> 0 = 16 bit .A & memory
                                        ;	||           1 = 8 bit .A & memory
                                        ;	|+—————————> 1 = sign overflow
                                        ;	+——————————> 1 = result = negative
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"SIZE-OF" CONSTANTS
                                        ;
   1032 = 00000003                      s_addr   =s_xword              ;24 bit address
   1033 = 0000000000000020                            s_auxbuf =32                   ;auxiliary buffer
   1034 = 0000000000000050                            s_ibuf   =80                   ;input buffer
   1035 = 0000000000000003                            s_mnemon =3                    ;MPU ASCII mnemonic
   1036 = 0000000000000002                            s_mnepck =2                    ;MPU encoded mnemonic
   1037 = 0000000000000003                            s_mvinst =3                    ;MVN/MVP instruction
   1038 = 00000001                      s_opcode =s_byte               ;MPU opcode
   1039 = 00000003                      s_oper   =s_xword              ;operand
   1040 = 00000004                      s_pfac   =s_dword              ;primary math accumulator
   1041 = 00000006                      s_sfac   =s_dword+s_word       ;secondary math accumulators
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"NUMBER-OF" CONSTANTS
                                        ;
   1047 = 0000000000000015                            n_dbytes =21                   ;default disassembly bytes
   1048 = 0000000000000008                            n_dump   =8                    ;bytes per memory dump line
   1049 = 000000FF                      n_mbytes =s_rampag-1           ;default memory dump bytes
   1050 = 0000000000000008                            n_hccols =8                    ;compare/hunt display columns
   1051 = 00000009                      n_opcols =3*s_oper             ;disassembly operand columns
   1052 = 0000000000000004                            n_opslsr =4                    ;LSRs to extract instruction size
   1053 = 0000000000000005                            n_shfenc =5                    ;shifts to encode/decode mnemonic
                                        ;
                                        ;================================================================================
                                        ;
                                        ;NUMERIC CONVERSION CONSTANTS
                                        ;
   1059 = 0000000000000006                            a_hexdec ='A'-'9'-2            ;hex to decimal difference
   1060 = 25                            c_bin    ='%'                  ;binary prefix
   1061 = 2B                            c_dec    ='+'                  ;decimal prefix
   1062 = 24                            c_hex    ='$'                  ;hexadecimal prefix
   1063 = 40                            c_oct    ='@'                  ;octal prefix
   1064 = 66                            k_hex    ='f'                  ;hex ASCII conversion
   1065 = 00000020                      m_bits   =s_pfac*s_bibyte      ;operand bit size
   1066 = 00000030                      m_cbits  =s_sfac*s_bibyte      ;workspace bit size
   1067 = 000000000000000F                            bcdumask =%00001111            ;isolate BCD units mask
   1068 = 0000000000000030                            btoamask =%00110000            ;binary to ASCII mask
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER CONSTANTS
                                        ;
   1074 = 3F                            a_mnecvt ='?'                  ;encoded mnemonic conversion base
   1075 = 000000000000001F                            aimmaska =%00011111            ;.A immediate opcode test #1
   1076 = 0000000000000009                            aimmaskb =%00001001            ;.A immediate opcode test #2
   1077 = 41                            asmprfx  ='A'                  ;assemble code prefix
   1078 = 0000000000000009                            ascprmct =9                    ;assembler prompt "size-of"
   1079 = 2E                            disprfx  ='.'                  ;disassemble code prefix
   1080 = 00000000000000C0                            flimmask =%11000000            ;force long immediate flag
   1081 = 0000000000000054                            opc_mvn  =$54                  ;MVN opcode
   1082 = 0000000000000044                            opc_mvp  =$44                  ;MVP opcode
   1083 = 00000000000000C2                            opc_rep  =$c2                  ;REP opcode
   1084 = 00000000000000E2                            opc_sep  =$e2                  ;SEP opcode
   1085 = 00000030                      pfmxmask =sr_amw | sr_ixw      ;MPU m & x flag bits mask
                                        ;
                                        ;
                                        ;	assembler prompt buffer offsets...
                                        ;
   1090 = 00000002                      apadrbkh =s_word               ;instruction address bank MSN
   1091 = 00000003                      apadrbkl =apadrbkh+s_byte      ;instruction address bank LSN
   1092 = 00000004                      apadrmbh =apadrbkl+s_byte      ;instruction address MSB MSN
   1093 = 00000005                      apadrmbl =apadrmbh+s_byte      ;instruction address MSB LSN
   1094 = 00000006                      apadrlbh =apadrmbl+s_byte      ;instruction address LSB MSN
   1095 = 00000007                      apadrlbl =apadrlbh+s_byte      ;instruction address LSB LSN
                                        ;
                                        ;
                                        ;	addressing mode preamble symbols...
                                        ;
   1100 = 21                            amp_flim ='!'                  ;force long immediate
   1101 = 23                            amp_imm  ='#'                  ;immediate
   1102 = 28                            amp_ind  ='('                  ;indirect
   1103 = 5B                            amp_indl ='['                  ;indirect long
   1104 = 7B                            amp_indxl = '{'				   ;indirect extra long
                                        ;
                                        ;
                                        ;	addressing mode symbolic translation indices...
                                        ;
   1109 = 0000000000000000                            am_nam   =%0000                ;(0)  no symbol
   1110 = 0000000000000001                            am_imm   =%0001                ;(1)  #
   1111 = 0000000000000002                            am_adrx  =%0010                ;(2)  dp,X or addr,X
   1112 = 0000000000000003                            am_adry  =%0011                ;(3)  dp,Y or addr,Y
   1113 = 0000000000000004                            am_ind   =%0100                ;(4)  (dp) or (addr)
   1114 = 0000000000000005                            am_indl  =%0101                ;(5)  [dp] or [addr]
   1115 = 0000000000000006                            am_indly =%0110                ;(6)  [dp],Y
   1116 = 0000000000000007                            am_indx  =%0111                ;(7)  (dp,X) or (addr,X)
   1117 = 0000000000000008                            am_indy  =%1000                ;(8)  (dp),Y
   1118 = 0000000000000009                            am_stk   =%1001                ;(9)  offset,S
   1119 = 000000000000000A                            am_stky  =%1010                ;(10) (offset,S),Y
   1120 = 000000000000000B                            am_move  =%1011                ;(11) MVN/MVP sbnk,dbnk
   1121 = 000000000000000C                            am_indxly=%1100				   ;(12) {dp},Y
                                        ;
                                        ;
                                        ;	operand size translation indices...
                                        ;
   1126 = 0000000000000000                            ops0     =%0000 << 4           ;no operand
   1127 = 0000000000000010                            ops1     =%0001 << 4           ;8 bit operand
   1128 = 0000000000000020                            ops2     =%0010 << 4           ;16 bit operand
   1129 = 0000000000000030                            ops3     =%0011 << 4           ;24 bit operand
   1130 = 0000000000000050                            bop1     =%0101 << 4           ;8 bit relative branch
   1131 = 0000000000000060                            bop2     =%0110 << 4           ;16 bit relative branch
   1132 = 0000000000000090                            vops     =%1001 << 4           ;8, 16, or 32 bit operand
   1133 = 0000000000010100                            ops5	 =$1010 << 4		   ;32 bit operand
                                        ;
                                        ;
                                        ;	operand size & addressing mode extraction masks...
                                        ;
   1138 = 000000000000000F                            amodmask =%00001111            ;addressing mode index
   1139 = 0000000000000030                            opsmask  =%00110000            ;operand size
   1140 = 00000000000000C0                            vopsmask =%11000000            ;BOPx & VOPS flag bits
                                        ;
                                        ;
                                        ;	instruction mnemonic encoding...
                                        ;
   1145 = 0000000000002144                            mne_adc  =$2144                ;ADC
   1146 = 0000000000002BC4                            mne_and  =$2bc4                ;AND
   1147 = 0000000000006D04                            mne_asl  =$6d04                ;ASL
   1148 = 0000000000002106                            mne_bcc  =$2106                ;BCC
   1149 = 000000000000A106                            mne_bcs  =$a106                ;BCS
   1150 = 0000000000009186                            mne_beq  =$9186                ;BEQ
   1151 = 000000000000AA86                            mne_bit  =$aa86                ;BIT
   1152 = 0000000000005386                            mne_bmi  =$5386                ;BMI
   1153 = 00000000000033C6                            mne_bne  =$33c6                ;BNE
   1154 = 0000000000006C46                            mne_bpl  =$6c46                ;BPL
   1155 = 00000000000014C6                            mne_bra  =$14c6                ;BRA
   1156 = 00000000000064C6                            mne_brk  =$64c6                ;BRK
   1157 = 0000000000006CC6                            mne_brl  =$6cc6                ;BRL
   1158 = 00000000000025C6                            mne_bvc  =$25c6                ;BVC
   1159 = 000000000000A5C6                            mne_bvs  =$a5c6                ;BVS
   1160 = 0000000000002348                            mne_clc  =$2348                ;CLC
   1161 = 0000000000002B48                            mne_cld  =$2b48                ;CLD
   1162 = 0000000000005348                            mne_cli  =$5348                ;CLI
   1163 = 000000000000BB48                            mne_clv  =$bb48                ;CLV
   1164 = 0000000000008B88                            mne_cmp  =$8b88                ;CMP
   1165 = 0000000000008C08                            mne_cop  =$8c08                ;COP
   1166 = 000000000000CC48                            mne_cpx  =$cc48                ;CPX
   1167 = 000000000000D448                            mne_cpy  =$d448                ;CPY
   1168 = 000000000000218A                            mne_dec  =$218a                ;DEC
   1169 = 000000000000C98A                            mne_dex  =$c98a                ;DEX
   1170 = 000000000000D18A                            mne_dey  =$d18a                ;DEY
   1171 = 0000000000009C0C                            mne_eor  =$9c0c                ;EOR
   1172 = 00000000000023D4                            mne_inc  =$23d4                ;INC
   1173 = 000000000000CBD4                            mne_inx  =$cbd4                ;INX
   1174 = 000000000000D3D4                            mne_iny  =$d3d4                ;INY
   1175 = 0000000000006B96                            mne_jml  =$6b96                ;JML
   1176 = 0000000000008B96                            mne_jmp  =$8b96                ;JMP
   1177 = 0000000000006D16                            mne_jsl  =$6d16                ;JSL
   1178 = 0000000000009D16                            mne_jsr  =$9d16                ;JSR
   1179 = 000000000000115A                            mne_lda  =$115a                ;LDA
   1180 = 000000000000C95A                            mne_ldx  =$c95a                ;LDX
   1181 = 000000000000D15A                            mne_ldy  =$d15a                ;LDY
   1182 = 0000000000009D1A                            mne_lsr  =$9d1a                ;LSR
   1183 = 0000000000007DDC                            mne_mvn  =$7ddc                ;MVN
   1184 = 0000000000008DDC                            mne_mvp  =$8ddc                ;MVP
   1185 = 0000000000008C1E                            mne_nop  =$8c1e                ;NOP
   1186 = 00000000000014E0                            mne_ora  =$14e0                ;ORA
   1187 = 00000000000011A2                            mne_pea  =$11a2                ;PEA
   1188 = 00000000000051A2                            mne_pei  =$51a2                ;PEI
   1189 = 00000000000099A2                            mne_per  =$99a2                ;PER
   1190 = 0000000000001262                            mne_pha  =$1262                ;PHA
   1191 = 0000000000001A62                            mne_phb  =$1a62                ;PHB
   1192 = 0000000000002A62                            mne_phd  =$2a62                ;PHD
   1193 = 0000000000006262                            mne_phk  =$6262                ;PHK
   1194 = 0000000000008A62                            mne_php  =$8a62                ;PHP
   1195 = 000000000000CA62                            mne_phx  =$ca62                ;PHX
   1196 = 000000000000D262                            mne_phy  =$d262                ;PHY
   1197 = 0000000000001362                            mne_pla  =$1362                ;PLA
   1198 = 0000000000001B62                            mne_plb  =$1b62                ;PLB
   1199 = 0000000000002B62                            mne_pld  =$2b62                ;PLD
   1200 = 0000000000008B62                            mne_plp  =$8b62                ;PLP
   1201 = 000000000000CB62                            mne_plx  =$cb62                ;PLX
   1202 = 000000000000D362                            mne_ply  =$d362                ;PLY
   1203 = 00000000000089A6                            mne_rep  =$89a6                ;REP
   1204 = 0000000000006C26                            mne_rol  =$6c26                ;ROL
   1205 = 0000000000009C26                            mne_ror  =$9c26                ;ROR
   1206 = 0000000000005566                            mne_rti  =$5566                ;RTI
   1207 = 0000000000006D66                            mne_rtl  =$6d66                ;RTL
   1208 = 000000000000A566                            mne_rts  =$a566                ;RTS
   1209 = 00000000000020E8                            mne_sbc  =$20e8                ;SBC
   1210 = 00000000000021A8                            mne_sec  =$21a8                ;SEC
   1211 = 00000000000029A8                            mne_sed  =$29a8                ;SED
   1212 = 00000000000051A8                            mne_sei  =$51a8                ;SEI
   1213 = 00000000000089A8                            mne_sep  =$89a8                ;SEP
   1214 = 0000000000001568                            mne_sta  =$1568                ;STA
   1215 = 0000000000008D68                            mne_stp  =$8d68                ;STP
   1216 = 000000000000CD68                            mne_stx  =$cd68                ;STX
   1217 = 000000000000D568                            mne_sty  =$d568                ;STY
   1218 = 000000000000DD68                            mne_stz  =$dd68                ;STZ
   1219 = 000000000000C8AA                            mne_tax  =$c8aa                ;TAX
   1220 = 000000000000D0AA                            mne_tay  =$d0aa                ;TAY
   1221 = 000000000000292A                            mne_tcd  =$292a                ;TCD
   1222 = 000000000000A12A                            mne_tcs  =$a12a                ;TCS
   1223 = 000000000000216A                            mne_tdc  =$216a                ;TDC
   1224 = 0000000000001CEA                            mne_trb  =$1cea                ;TRB
   1225 = 0000000000001D2A                            mne_tsb  =$1d2a                ;TSB
   1226 = 000000000000252A                            mne_tsc  =$252a                ;TSC
   1227 = 000000000000CD2A                            mne_tsx  =$cd2a                ;TSX
   1228 = 000000000000166A                            mne_txa  =$166a                ;TXA
   1229 = 000000000000A66A                            mne_txs  =$a66a                ;TXS
   1230 = 000000000000D66A                            mne_txy  =$d66a                ;TXY
   1231 = 00000000000016AA                            mne_tya  =$16aa                ;TYA
   1232 = 000000000000CEAA                            mne_tyx  =$ceaa                ;TYX
   1233 = 00000000000050B0                            mne_wai  =$50b0                ;WAI
   1234 = 0000000000007170                            mne_wdm  =$7170                ;WDM
   1235 = 00000000000010F2                            mne_xba  =$10f2                ;XBA
   1236 = 0000000000003132                            mne_xce  =$3132                ;XCE
                                        ;
                                        ;
                                        ;	encoded instruction mnemonic indices...
                                        ;
   1241 = 0000000000000010                            mne_adcx =16                   ;ADC
   1242 = 000000000000001D                            mne_andx =29                   ;AND
   1243 = 000000000000002C                            mne_aslx =44                   ;ASL
   1244 = 000000000000000F                            mne_bccx =15                   ;BCC
   1245 = 0000000000000041                            mne_bcsx =65                   ;BCS
   1246 = 000000000000003B                            mne_beqx =59                   ;BEQ
   1247 = 0000000000000046                            mne_bitx =70                   ;BIT
   1248 = 0000000000000024                            mne_bmix =36                   ;BMI
   1249 = 000000000000001F                            mne_bnex =31                   ;BNE
   1250 = 000000000000002A                            mne_bplx =42                   ;BPL
   1251 = 0000000000000005                            mne_brax =5                    ;BRA
   1252 = 0000000000000027                            mne_brkx =39                   ;BRK
   1253 = 000000000000002B                            mne_brlx =43                   ;BRL
   1254 = 0000000000000017                            mne_bvcx =23                   ;BVC
   1255 = 0000000000000044                            mne_bvsx =68                   ;BVS
   1256 = 0000000000000014                            mne_clcx =20                   ;CLC
   1257 = 000000000000001B                            mne_cldx =27                   ;CLD
   1258 = 0000000000000023                            mne_clix =35                   ;CLI
   1259 = 0000000000000047                            mne_clvx =71                   ;CLV
   1260 = 0000000000000035                            mne_cmpx =53                   ;CMP
   1261 = 0000000000000037                            mne_copx =55                   ;COP
   1262 = 000000000000004E                            mne_cpxx =78                   ;CPX
   1263 = 0000000000000058                            mne_cpyx =88                   ;CPY
   1264 = 0000000000000012                            mne_decx =18                   ;DEC
   1265 = 000000000000004A                            mne_dexx =74                   ;DEX
   1266 = 0000000000000054                            mne_deyx =84                   ;DEY
   1267 = 000000000000003D                            mne_eorx =61                   ;EOR
   1268 = 0000000000000015                            mne_incx =21                   ;INC
   1269 = 000000000000004D                            mne_inxx =77                   ;INX
   1270 = 0000000000000057                            mne_inyx =87                   ;INY
   1271 = 0000000000000028                            mne_jmlx =40                   ;JML
   1272 = 0000000000000036                            mne_jmpx =54                   ;JMP
   1273 = 000000000000002D                            mne_jslx =45                   ;JSL
   1274 = 000000000000003F                            mne_jsrx =63                   ;JSR
   1275 = 0000000000000001                            mne_ldax =1                    ;LDA
   1276 = 0000000000000049                            mne_ldxx =73                   ;LDX
   1277 = 0000000000000053                            mne_ldyx =83                   ;LDY
   1278 = 0000000000000040                            mne_lsrx =64                   ;LSR
   1279 = 0000000000000030                            mne_mvnx =48                   ;MVN
   1280 = 000000000000003A                            mne_mvpx =58                   ;MVP
   1281 = 0000000000000038                            mne_nopx =56                   ;NOP
   1282 = 0000000000000006                            mne_orax =6                    ;ORA
   1283 = 0000000000000002                            mne_peax =2                    ;PEA
   1284 = 0000000000000021                            mne_peix =33                   ;PEI
   1285 = 000000000000003C                            mne_perx =60                   ;PER
   1286 = 0000000000000003                            mne_phax =3                    ;PHA
   1287 = 000000000000000A                            mne_phbx =10                   ;PHB
   1288 = 000000000000001A                            mne_phdx =26                   ;PHD
   1289 = 0000000000000026                            mne_phkx =38                   ;PHK
   1290 = 0000000000000033                            mne_phpx =51                   ;PHP
   1291 = 000000000000004B                            mne_phxx =75                   ;PHX
   1292 = 0000000000000055                            mne_phyx =85                   ;PHY
   1293 = 0000000000000004                            mne_plax =4                    ;PLA
   1294 = 000000000000000B                            mne_plbx =11                   ;PLB
   1295 = 000000000000001C                            mne_pldx =28                   ;PLD
   1296 = 0000000000000034                            mne_plpx =52                   ;PLP
   1297 = 000000000000004C                            mne_plxx =76                   ;PLX
   1298 = 0000000000000056                            mne_plyx =86                   ;PLY
   1299 = 0000000000000031                            mne_repx =49                   ;REP
   1300 = 0000000000000029                            mne_rolx =41                   ;ROL
   1301 = 000000000000003E                            mne_rorx =62                   ;ROR
   1302 = 0000000000000025                            mne_rtix =37                   ;RTI
   1303 = 000000000000002E                            mne_rtlx =46                   ;RTL
   1304 = 0000000000000043                            mne_rtsx =67                   ;RTS
   1305 = 000000000000000E                            mne_sbcx =14                   ;SBC
   1306 = 0000000000000013                            mne_secx =19                   ;SEC
   1307 = 0000000000000019                            mne_sedx =25                   ;SED
   1308 = 0000000000000022                            mne_seix =34                   ;SEI
   1309 = 0000000000000032                            mne_sepx =50                   ;SEP
   1310 = 0000000000000007                            mne_stax =7                    ;STA
   1311 = 0000000000000039                            mne_stpx =57                   ;STP
   1312 = 0000000000000050                            mne_stxx =80                   ;STX
   1313 = 0000000000000059                            mne_styx =89                   ;STY
   1314 = 000000000000005B                            mne_stzx =91                   ;STZ
   1315 = 0000000000000048                            mne_taxx =72                   ;TAX
   1316 = 0000000000000052                            mne_tayx =82                   ;TAY
   1317 = 0000000000000018                            mne_tcdx =24                   ;TCD
   1318 = 0000000000000042                            mne_tcsx =66                   ;TCS
   1319 = 0000000000000011                            mne_tdcx =17                   ;TDC
   1320 = 000000000000000C                            mne_trbx =12                   ;TRB
   1321 = 000000000000000D                            mne_tsbx =13                   ;TSB
   1322 = 0000000000000016                            mne_tscx =22                   ;TSC
   1323 = 000000000000004F                            mne_tsxx =79                   ;TSX
   1324 = 0000000000000008                            mne_txax =8                    ;TXA
   1325 = 0000000000000045                            mne_txsx =69                   ;TXS
   1326 = 000000000000005A                            mne_txyx =90                   ;TXY
   1327 = 0000000000000009                            mne_tyax =9                    ;TYA
   1328 = 0000000000000051                            mne_tyxx =81                   ;TYX
   1329 = 0000000000000020                            mne_waix =32                   ;WAI
   1330 = 000000000000002F                            mne_wdmx =47                   ;WDM
   1331 = 0000000000000000                            mne_xbax =0                    ;XBA
   1332 = 000000000000001E                            mne_xcex =30                   ;XCE
                                        ;
                                        ;================================================================================
                                        ;
                                        ;MISCELLANEOUS CONSTANTS
                                        ;
   1338 = 0000000000000004                            halftab  =4                    ;1/2 tabulation spacing
   1339 = 3E                            memprfx  ='>'                  ;memory dump prefix
   1340 = 3A                            memsepch =':'                  ;memory dump separator
   1341 = 2E                            memsubch ='.'                  ;memory dump non-print char
   1342 = 0000000000000030                            srinit   =%00110000            ;SR initialization value
                                        ;
                                        ;================================================================================
                                        ;
                                        ;DIRECT PAGE STORAGE
                                        ;
   1348 = 00000080                      reg_csx  =zeropage			;CS
   1349 = 00000082                      reg_dsx  =reg_csx + 2		;DS
   1350 = 00000084                      reg_ssx  =reg_dsx + 2		;SS
   1351 = 00000086                      reg_pcx  =reg_ssx + 2	    ;PC
   1352 = 00000088                      reg_pbx  =reg_pcx + 2       ;PB
   1353 = 00000089                      reg_ax   =reg_pbx + 1       ;.C
   1354 = 0000008D                      reg_xx   =reg_ax + 4        ;.X
   1355 = 00000091                      reg_yx   =reg_xx + 4        ;.Y
   1356 = 00000095                      reg_spx  =reg_yx + 4        ;SP
   1357 = 00000099                      reg_srx  =reg_spx + 4       ;SR
   1358 = 0000009A                      reg_srxx =reg_srx + 1       ;SRX
   1359 = 0000009B                      reg_dbx  =reg_srxx + 1      ;DB
   1360 = 0000009C                      reg_dpx  =reg_dbx + 1       ;DP
                                        ;
                                        ;
                                        ;	general workspace...
                                        ;
   1365 = 000000A0                      addra    =reg_dpx+4            ;address #1
   1366 = 000000A4                      addrb    =addra+4              ;address #2
   1367 = 000000A7                      faca     =addrb+s_addr         ;primary accumulator
   1368 = 000000AB                      facax    =faca+s_pfac          ;extended primary accumulator
   1369 = 000000AF                      facb     =facax+s_pfac         ;secondary accumulator
   1370 = 000000B5                      facc     =facb+s_sfac          ;tertiary accumulator
   1371 = 000000BB                      operand  =facc+s_sfac          ;instruction operand
   1372 = 000000BE                      auxbufix =operand+s_oper       ;auxiliary buffer index
   1373 = 000000BF                      ibufidx  =auxbufix+s_byte      ;input buffer index
   1374 = 000000C0                      bitsdig  =ibufidx+s_byte       ;bits per numeral
   1375 = 000000C1                      numeral  =bitsdig+s_byte       ;numeral buffer
   1376 = 000000C2                      radix    =numeral+s_byte       ;radix index
   1377 = 000000C3                      admodidx =radix+s_byte         ;addressing mode index
   1378 = 000000C4                      charcnt  =admodidx+s_byte      ;character counter
   1379 = 000000C6                      instsize =charcnt+s_word       ;instruction size
   1380 = 000000C8                      mnepck   =instsize+s_word      ;encoded mnemonic
   1381 = 000000CA                      opcode   =mnepck+s_mnepck      ;current opcode
   1382 = 000000CB                      status   =opcode+s_byte        ;I/O status flag
   1383 = 000000CC                      xrtemp   =status+s_byte        ;temp .X storage
   1384 = 000000CD                      eopsize  =xrtemp+s_byte        ;entered operand size
   1385 = 000000CE                      flimflag =eopsize+s_byte       ;forced long immediate...
                                        ;
                                        ;	xx000000
                                        ;	||
                                        ;	|+—————————> 0: .X/.Y = 8 bits
                                        ;	|            1: .X/.Y = 16 bits
                                        ;	+——————————> 0: .A = 8 bits
                                        ;	             1: .A = 16 bits
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	During assembly, FLIMFLAG indicates the operand size used with an immed-
                                        ;	iate mode instruction, thus causing the following disassembly to display
                                        ;	the assembled  operand size.   During disassembly,  FLIMFLAG will mirror
                                        ;	the effect of the most recent REP or SEP instruction.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1401 = 000000CF                      iopsize  =flimflag+s_byte      ;operand size
   1402 = 000000D0                      range    =iopsize+s_byte       ;allowable radix range
   1403 = 000000D1                      vopsflag =range+s_byte         ;VOPS & ROPS mode bits
                                        ;
                                        ;
                                        ;	copy/fill workspace (overlaps some of the above)...
                                        ;
   1408 = 000000D2                      mcftwork =vopsflag+s_byte	;faca                 ;start of copy/fill code
   1409 = 000000D3                      mcftopc  =mcftwork+s_byte      ;instruction opcode
   1410 = 000000D4                      mcftbnk  =mcftopc+s_byte       ;banks
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SUPERMON 816 JUMP TABLE
                                        ;
                                                 org	_origin_
                                        ;
   1419 C000                            		 MEM	8
   1420 C000                            		 NDX	8
                                        		 CPU	W65C02
   1422 C000 80 02                      JMON     bra mon               ;cold start entry
   1423 C002 80 3E                      JMONBRK  bra monbrk            ;software interrupt intercept
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mon: SUPERMON 816 COLD START
                                        ;
   1429 C004 C2 20                      mon +         .byte $c2,$20
                                        
   1430 C006 AD 02 01                             lda vecbrki           ;BRK vector
   1431 C009 C9 42                    +            cmp #<monbrk
   1431 C00B C0                       +            .byte >monbrk
                                        ;pointing at monitor?
   1432 C00C D0 03                                bne .2            ;yes, ignore cold start
   1433 C00E 4C 7F C0                             jmp	monreg			; got a branch out of range here when debugging code
                                        								; was included
   1435 C011                            .2
                                        ;
   1437 C011 8D 05 01                             sta vecbrkia          ;save vector for exit
   1438 C014 A9 42                    +            lda #<monbrk
   1438 C016 C0                       +            .byte >monbrk
                                        ;Supermon 816 intercepts...
   1439 C017 8D 02 01                             sta vecbrki           ;BRK handler
   1440 C01A E2 30                    +            .byte $e2,$30
                                                        ;8 bit registers
   1441 C01C A2 49                                ldx #vopsflag-reg_pbx
                                        ;
   1443 C01E 74 88                      .0000010 stz reg_pbx,x         ;clear DP storage
   1444 C020 CA                                   dex
   1445 C021 10 FB                                bpl .0000010
                                        ;
   1447 C023 A9 30                                lda #srinit
   1448 C025 85 99                                sta reg_srx           ;status register
   1449 C027 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   1450 C029 A9 FF                    +            lda #<hwstack
   1450 C02B 3F                       +            .byte >hwstack
                                        ;top of hardware stack
   1451 C02C 1B                       +            .byte $1b
                                                           ;set SP
   1452 C02D 7B                       +            .byte $7b
                                                           ;get & save...
   1453 C02E 85 9C                                sta reg_dpx           ;DP register
   1454 C030 A9 00                    +            lda #<0
   1454 C032 00                       +            .byte >0
                                        
   1455 C033 E2 20                    +            .byte $e2,$20
                                        
   1456 C035 4B                       +            .byte $4b
                                        
   1457 C036 68                                   pla                   ;capture PB &...
   1458 C037 85 88                                sta reg_pbx           ;set
   1459 C039 8B                       +            .byte $8b
                                        
   1460 C03A 68                                   pla                   ;capture DB &...
   1461 C03B 85 9B                                sta reg_dbx           ;set
   1462 C03D F4                       +            .byte $f4
   1462 C03E 30 D0                    +            .word mm_entry
                                        ;"...ready..."
   1463 C040 80 30                                bra moncom
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monbrk: SOFTWARE INTERRUPT INTERCEPT
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This is the entry point taken when a BRK instruction is executed.  It is
                                        ;	assumed that the BRK  handler has pushed the registers to the stack that
                                        ;	are not automatically pushed by the MPU in response to BRK.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1475 C042 58                         monbrk   cli                   ;reenable IRQs
   1476 C043                            		 phds
   1477 C043 68                          		 pla
   1478 C044 85 82                       		 sta reg_dsx
                                           		 CPU	FT832
   1480 00C046 42 7A                        		 tssa
   1481 00C048 85 84                        		 sta	reg_ssx
                                        		 CPU	W65C02
   1483 C04A 7A                                   ply                   ;recover registers
   1484 C04B FA                                   plx
   1485 C04C 68                                   pla
   1486 C04D C2 30                    +            .byte $c2,$30
                                                         ;store 16 bit registers
   1487 C04F 85 89                                sta reg_ax            ;.A
   1488 C051 86 8D                                stx reg_xx            ;.X
   1489 C053 84 91                                sty reg_yx            ;.Y
   1490 C055 E2 10                    +            .byte $e2,$10
                                                        ;8 bit index registers
   1491 C057 68                                   pla                   ;get DP &...
   1492 C058 85 9C                                sta reg_dpx           ;store
   1493 C05A FA                                   plx                   ;get DB &...
   1494 C05B 86 9B                                stx reg_dbx           ;store
   1495 C05D FA                                   plx                   ;get SR &...
   1496 C05E 86 99                                stx reg_srx           ;store
   1497 C060 68                                   pla                   ;get PC &...
   1498 C061 85 86                                sta reg_pcx           ;store
   1499 C063 E2 20                    +            .byte $e2,$20
                                        
   1500 C065 68                                   pla                   ;get PB &...
   1501 C066 85 88                                sta reg_pbx           ;store
   1502 C068 C2 20                    +            .byte $c2,$20
                                        
   1503 C06A 68                          		 pla				   ; get CS &...
   1504 C06B 85 80                       		 sta	reg_csx		   ; store
   1505 C06D E2 20                    +            .byte $e2,$20
                                        
   1506 C06F F4                       +            .byte $f4
   1506 C070 25 D0                    +            .word mm_brk
                                        ;"*BRK"
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncom: COMMON ENTRY POINT
                                        ;
                                        ;	——————————————————————————————————————
                                        ;	DO NOT directly call this entry point!
                                        ;	——————————————————————————————————————
                                        ;
   1516 C072                            moncom   
   1517 C072 20 19 C8                    		 jsr sprint            ;print heading
   1518 C075 C2 20                    +            .byte $c2,$20
                                        
   1519 C077 3B                       +            .byte $3b
                                                           ;get SP &...
   1520 C078 85 95                                sta reg_spx           ;store
   1521 C07A C2 FF                    +            .byte $c2,%11111111
                                        ;clear SR &...
   1522 C07C E2 30                    +            .byte $e2,srinit
                                        ;set default state
   1523 C07E 38                                   sec                   ;see next
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monreg: DISPLAY MPU REGISTERS
                                        ;
                                        ;	—————————
                                        ;	syntax: R
                                        ;	—————————
                                        ;
   1533 C07F B0 03                      monreg   bcs .0000010          ;okay to proceed
                                        ;
   1535 C081 4C 65 C1                             jmp monerr            ;error if called with a parm
                                        ;
   1537 C084 F4                         .0000010 +         .byte $f4
   1537 C085 5B D0                    +            .word mm_regs
                                        
   1538 C087 20 19 C8                             jsr sprint            ;display heading
                                        ;
                                        ;
                                        ;	display code selector & program bank & counter...
                                        ;
   1543 C08A C2 20                    +            .byte $c2,$20
                                        
   1544 C08C A5 80                       		 lda	reg_csx
   1545 C08E E2 20                    +            .byte $e2,$20
                                        
   1546 C090 20 D3 C7                    		 jsr    dpyhexw
   1547 C093 E2 20                    +            .byte $e2,$20
                                        
   1548 C095 A9 3A                       		 lda #a_colon
   1549 C097 20 13 C8                             jsr printcmn          ;':'
   1550 C09A A5 88                                lda reg_pbx           ;PB
   1551 C09C 20 E3 C7                             jsr dpyhex            ;display as hex ASCII
   1552 C09F 20 11 C8                             jsr printspc          ;inter-field space
   1553 C0A2 C2 20                    +            .byte $c2,$20
                                        
   1554 C0A4 A5 86                                lda reg_pcx
   1555 C0A6 E2 20                    +            .byte $e2,$20
                                        
   1556 C0A8 20 D3 C7                             jsr dpyhexw           ;display PC
   1557 C0AB A2 02                                ldx #2
   1558 C0AD 20 F2 C7                             jsr multspc           ;inter-field spacing
                                        ;
                                        ;
                                        ;	display SR in bitwise fashion...
                                        ;
   1563 C0B0 A5 9A                       		 lda reg_srxx
   1564 C0B2 4A                          		 lsr
   1565 C0B3 4A                          		 lsr
   1566 C0B4 69 30                       		 adc #'0'
                                           		 cpu FT832
   1568 00C0B6 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1570 C0BB A5 9A                       		 lda reg_srxx
   1571 C0BD 4A                          		 lsr
   1572 C0BE 69 30                       		 adc #'0'
                                           		 cpu FT832
   1574 00C0C0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        
   1577 C0C5 A6 99                                ldx reg_srx           ;SR
   1578 C0C7 A0 08                                ldy #s_bibyte         ;bits in a byte
                                        ;
   1580 C0C9 8A                         .0000020 txa                   ;remaining SR bits
   1581 C0CA 0A                                   asl                   ;grab one of them
   1582 C0CB AA                                   tax                   ;save remainder
   1583 C0CC A9 30                                lda #'0'              ;a clear bit but...
   1584 C0CE 69 00                                adc #0                ;adjust if set &...
                                           		 cpu FT832
   1586 00C0D0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1588 C0D5 88                                   dey                   ;bit processed
   1589 C0D6 D0 F1                                bne .0000020          ;do another
                                        ;
                                        ;
                                        ;	display .C, .X, .Y, SP & DP...
                                        ;
   1594 C0D8 20 11 C8                   .0000030 jsr printspc          ;spacing
   1595 C0DB C2 20                    +            .byte $c2,$20
                                        
   1596 C0DD B9 8B 00                             lda reg_ax+2,y        ;get register value
   1597 C0E0 E2 20                    +            .byte $e2,$20
                                        
   1598 C0E2 20 D3 C7                             jsr dpyhexw           ;convert & display
   1599 C0E5 C2 20                    +            .byte $c2,$20
                                        
   1600 C0E7 B9 89 00                             lda reg_ax,y          ;get register value
   1601 C0EA E2 20                    +            .byte $e2,$20
                                        
   1602 C0EC 20 D3 C7                             jsr dpyhexw           ;convert & display
                                        ;         .rept s_word
   1604 C0EF C8                                     iny
   1605 C0F0 C8                                     iny
                                        ;         .endr
                                        ;         .rept s_word
   1608 C0F1 C8                                     iny
   1609 C0F2 C8                                     iny
                                        ;         .endr
   1611 C0F3 C0 0F                                cpy #reg_spx-reg_ax+3
   1612 C0F5 90 E1                                bcc .0000030          ;next
                                        ;
                                        ;
                                        ;	display DS SS DB...
                                        ;
   1617 C0F7 F4                       +            .byte $f4
   1617 C0F8 B7 D0                    +            .word mm_regs2
                                        
   1618 C0FA 20 19 C8                    		 jsr sprint
   1619 C0FD C2 20                    +            .byte $c2,$20
                                        
   1620 C0FF A5 82                                lda reg_dsx          ;get DS &...
   1621 C101 E2 20                    +            .byte $e2,$20
                                        
   1622 C103 20 D3 C7                             jsr dpyhexw           ;convert & display
   1623 C106 20 11 C8                             jsr printspc          ;more spacing
   1624 C109 C2 20                    +            .byte $c2,$20
                                        
   1625 C10B A5 84                                lda reg_ssx           ;get SS &...
   1626 C10D E2 20                    +            .byte $e2,$20
                                        
   1627 C10F 20 D3 C7                             jsr dpyhexw           ;convert & display
   1628 C112 20 11 C8                             jsr printspc          ;more spacing
   1629 C115 A5 9B                                lda reg_dbx           ;get DB &...
   1630 C117 20 E3 C7                             jsr dpyhex            ;display it
   1631 C11A 20 11 C8                             jsr printspc          ;more spacing
   1632 C11D C2 20                    +            .byte $c2,$20
                                        
   1633 C11F A5 9C                                lda reg_dpx           ;get DPR &...
   1634 C121 E2 20                    +            .byte $e2,$20
                                        
   1635 C123 20 D3 C7                             jsr dpyhexw           ;convert & display
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monce: COMMAND EXECUTIVE
                                        ;	
   1641 C126 E2 20                      monce +         .byte $e2,$20
                                        
   1642 C128 A9 00                                lda #0                ;default buffer index
                                        ;
   1644 C12A E2 30                      moncea +         .byte $e2,$30
                                                        ;alternate entry point
   1645 C12C 85 BF                                sta ibufidx           ;(re)set buffer index
   1646 C12E F4                       +            .byte $f4
   1646 C12F 52 D0                    +            .word mm_prmpt
                                        
   1647 C131 20 19 C8                             jsr sprint            ;display input prompt
   1648 C134 20 3B CC                             jsr input             ;await some input
                                        ;
   1650 C137                            .0000010:
   1651 C137 20 9D CC                    		jsr getcharc          ;read from buffer
   1652 C13A F0 EA                                beq monce             ;terminator, just loop
                                        ;
   1654 C13C C9 20                                cmp #a_blank
   1655 C13E F0 F7                                beq .0000010          ;strip leading blanks
                                        ;
   1657 C140 A2 0C                                ldx #n_mpctab-1       ;number of primary commands
                                        ;
   1659 C142 DD B7 CC                   .0000020 cmp mpctab,x          ;search primary command list
   1660 C145 D0 0E                                bne .0000030
                                        ;
   1662 C147 8A                                   txa                   ;get index
   1663 C148 0A                                   asl                   ;double for offset
   1664 C149 AA                                   tax
   1665 C14A C2 20                    +            .byte $c2,$20
                                        
   1666 C14C BD C4 CC                             lda mpcextab,x        ;command address -1
   1667 C14F 48                                   pha                   ;prime the stack
   1668 C150 E2 20                    +            .byte $e2,$20
                                        
   1669 C152 4C DF CA                             jmp getparm           ;evaluate parm & execute command
                                        ;
   1671 C155 CA                         .0000030 dex
   1672 C156 10 EA                                bpl .0000020          ;continue searching primary commands
                                        ;
   1674 C158 A2 03                                ldx #n_radix-1        ;number of radices
                                        ;
   1676 C15A DD F2 CC                   .0000040 cmp radxtab,x         ;search conversion command list
   1677 C15D D0 03                                bne .0000050
                                        ;
   1679 C15F 4C AF C5                             jmp monenv            ;convert & display parameter
                                        ;
   1681 C162 CA                         .0000050 dex
   1682 C163 10 F5                                bpl .0000040
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monerr: COMMON ERROR HANDLER
                                        ;
   1688 C165 E2 30                      monerr +         .byte $e2,$30
                                                        ;8 bit registers
                                        ;
   1690 C167 20 BA C7                   monerraa jsr dpyerr            ;indicate an error &...
   1691 C16A 80 BA                                bra monce             ;return to input loop
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monasc: ASSEMBLE CODE
                                        ;
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;	syntax: A <addr> <mnemonic> [<argument>]
                                        ;
                                        ;	After a line of code has been successfully assembled it will be disass-
                                        ;	embled & displayed,  & the monitor will prompt with the next address to
                                        ;	which code may be assembled.
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;
   1705 C16C 90 03                      monasc   bcc .0000020          ;assembly address entered
                                        ;
   1707 C16E 4C 65 C1                   .0000010 jmp monerr            ;terminate w/error
                                        ;
                                        ;
                                        ;	evaluate assembly address...
                                        ;
   1712 C171 20 CB CA                   .0000020 jsr facasize          ;check address...
   1713 C174 C9 04                                cmp #s_dword          ;range
   1714 C176 B0 F6                                bcs .0000010          ;out of range — error
                                        ;
   1716 C178 20 AD CA                             jsr facaddra          ;store assembly address
                                        ;
                                        ;
                                        ;	initialize workspace...
                                        ;
   1721 C17B A2 1F                                ldx #s_auxbuf-s_byte
                                        ;
   1723 C17D 9E 51 02                   .0000030 stz auxbuf,x          ;clear addressing mode buffer
   1724 C180 CA                                   dex
   1725 C181 D0 FA                                bne .0000030
                                        ;
   1727 C183 A9 20                                lda #a_blank
   1728 C185 8D 51 02                             sta auxbuf            ;preamble placeholder
   1729 C188 20 1A CA                             jsr clroper           ;clear operand
   1730 C18B 64 BE                                stz auxbufix          ;reset addressing mode index
   1731 C18D 64 CE                                stz flimflag          ;clear forced long immediate
   1732 C18F 64 C8                                stz mnepck            ;clear encoded...
   1733 C191 64 C9                                stz mnepck+s_byte     ;mnemonic workspace
   1734 C193 64 D1                                stz vopsflag          ;clear 8/16 or relative flag
                                        ;
                                        ;
                                        ;	encode mnemonic...
                                        ;
   1739 C195 A0 03                                ldy #s_mnemon         ;expected mnemonic size
                                        ;
   1741 C197 20 2C CC                   .0000040 jsr getcharw          ;get from buffer wo/whitespace
   1742 C19A D0 0A                                bne .0000060          ;gotten
                                        ;
   1744 C19C C0 03                                cpy #s_mnemon         ;any input at all?
   1745 C19E 90 03                                bcc .0000050          ;yes
                                        ;
   1747 C1A0 4C 26 C1                             jmp monce             ;no, abort further assembly
                                        ;
   1749 C1A3 4C 45 C3                   .0000050 jmp monasc10          ;incomplete mnemonic — error
                                        ;
   1751 C1A6 38                         .0000060 sec
   1752 C1A7 E9 3F                                sbc #a_mnecvt         ;ASCII to binary factor
   1753 C1A9 A2 05                                ldx #n_shfenc         ;shifts required to encode
                                        ;
   1755 C1AB 4A                         .0000070 lsr                   ;shift out a bit...
   1756 C1AC 66 C9                                ror mnepck+s_byte     ;into...
   1757 C1AE 66 C8                                ror mnepck            ;encoded mnemonic
   1758 C1B0 CA                                   dex
   1759 C1B1 D0 F8                                bne .0000070          ;next bit
                                        ;
   1761 C1B3 88                                   dey
   1762 C1B4 D0 E1                                bne .0000040          ;get next char
                                        ;
                                        ;
                                        ;	test for copy instruction...
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The MVN & MVP instructions accept two operands & hence have an irregular
                                        ;	syntax.  Therefore, special handling is necessary to assemble either of
                                        ;	these instructions.
                                        ;
                                        ;	The official WDC syntax has the programmer entering a pair of 24 bit ad-
                                        ;	dresses as operands, with the assembler isolating bits 16-23 to	use as
                                        ;	operands.  This formality has been dispensed with in this monitor & the
                                        ;	operands are expected to be 8 bit bank values.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1777 C1B6 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   1778 C1B8 A5 C8                                lda mnepck            ;packed menmonic
   1779 C1BA A2 54                                ldx #opc_mvn          ;MVN opcode
   1780 C1BC C9 DC                    +            cmp #<mne_mvn
   1780 C1BE 7D                       +            .byte >mne_mvn
                                        ;is it MVN?
   1781 C1BF F0 07                                beq monasc01          ;yes
                                        ;
   1783 C1C1 A2 44                                ldx #opc_mvp          ;MVP opcode
   1784 C1C3 C9 DC                    +            cmp #<mne_mvp
   1784 C1C5 8D                       +            .byte >mne_mvp
                                        ;is it MVP?
   1785 C1C6 D0 30                                bne monasc02          ;no
                                        ;
                                        ;
                                        ;	assemble copy instruction...
                                        ;
   1790 C1C8 86 CA                      monasc01 stx opcode            ;store relevant opcode
   1791 C1CA E2 20                    +            .byte $e2,$20
                                        
   1792 C1CC 20 3B CB                             jsr instdata          ;get instruction data
   1793 C1CF 86 CD                                stx eopsize           ;effective operand size
   1794 C1D1 E8                                   inx
   1795 C1D2 86 C6                                stx instsize          ;instruction size
   1796 C1D4 A2 01                                ldx #s_oper-s_word    ;operand index
   1797 C1D6 86 CC                                stx xrtemp            ;set it
                                        ;
   1799 C1D8 20 34 C8                   .0000010 jsr ascbin            ;evaluate bank number
   1800 C1DB B0 50                                bcs monasc04          ;conversion error
                                        ;
   1802 C1DD F0 4E                                beq monasc04          ;nothing returned — error
                                        ;
   1804 C1DF 20 CB CA                             jsr facasize          ;bank must be...
   1805 C1E2 C9 02                                cmp #s_word           ;8 bits
   1806 C1E4 B0 47                                bcs monasc04          ;it isn't — error
                                        ;
   1808 C1E6 A5 A7                                lda faca              ;bank
   1809 C1E8 A6 CC                                ldx xrtemp            ;operand index
   1810 C1EA 95 BB                                sta operand,x         ;store
   1811 C1EC C6 CC                                dec xrtemp            ;index=index-1
   1812 C1EE 10 E8                                bpl .0000010          ;get destination bank
                                        ;
   1814 C1F0 20 CC CB                             jsr getcharr          ;should be no more input
   1815 C1F3 D0 38                                bne monasc04          ;there is — error
                                        ;
   1817 C1F5 4C F3 C2                             jmp monasc08          ;finish MVN/MVP assembly 
                                        ;
                                        ;
                                        ;	continue with normal assembly...
                                        ;
   1822 C1F8 E2 20                      monasc02 +         .byte $e2,$20
                                                        ;back to 8 bits
                                        ;
   1824 C1FA 20 2C CC                   monasc03 jsr getcharw          ;get next char
   1825 C1FD F0 3D                                beq monasc06          ;EOI, no argument
                                        ;
   1827 C1FF C9 21                                cmp #amp_flim
   1828 C201 D0 0A                                bne .0000010          ;no forced long immediate
                                        ;
   1830 C203 A5 CE                                lda flimflag          ;FLIM already set?
   1831 C205 D0 26                                bne monasc04          ;yes — error
                                        ;
   1833 C207 A9 C0                                lda #flimmask
   1834 C209 85 CE                                sta flimflag          ;set flag &...
   1835 C20B 80 ED                                bra monasc03          ;get next char
                                        ;
   1837 C20D C9 23                      .0000010 cmp #amp_imm          ;immediate mode?
   1838 C20F F0 08                                beq .0000020          ;yes
                                        ;
   1840 C211 C9 28                                cmp #amp_ind          ;indirect mode?
   1841 C213 F0 04                                beq .0000020          ;yes
                                        ;
   1843 C215 C9 5B                                cmp #amp_indl         ;indirect long mode?
   1844 C217 D0 07                                bne .0000030          ;no
                                        ;
   1846 C219 8D 51 02                   .0000020 sta auxbuf            ;set addressing mode preamble
   1847 C21C E6 BE                                inc auxbufix          ;bump aux buffer index &...
   1848 C21E 80 02                                bra .0000040          ;evaluate operand
                                        ;
   1850 C220 C6 BF                      .0000030 dec ibufidx           ;position back to char
                                        ;
   1852 C222 20 34 C8                   .0000040 jsr ascbin            ;evaluate operand
   1853 C225 D0 09                                bne monasc05          ;evaluated
                                        ;
   1855 C227 B0 04                                bcs monasc04          ;conversion error
                                        ;
   1857 C229 A5 BE                                lda auxbufix          ;no operand...any preamble?
   1858 C22B F0 0F                                beq monasc06          ;no, syntax is okay so far
                                        ;
   1860 C22D 4C 45 C3                   monasc04 jmp monasc10          ;abort w/error
                                        ;
   1862 C230 20 CB CA                   monasc05 jsr facasize          ;size operand
   1863 C233 C9 04                                cmp #s_dword          ;max is 24 bits
   1864 C235 B0 F6                                bcs monasc04          ;too big
                                        ;
   1866 C237 85 CD                                sta eopsize           ;save operand size
   1867 C239 20 C1 CA                             jsr facaoper          ;store operand
                                        ;
   1869 C23C C6 BF                      monasc06 dec ibufidx           ;back to last char
   1870 C23E A6 BE                                ldx auxbufix          ;mode buffer index
   1871 C240 D0 01                                bne .0000010          ;preamble in buffer
                                        ;
   1873 C242 E8                                   inx                   ;step past preamble position
                                        ;
   1875 C243 20 9D CC                   .0000010 jsr getcharc          ;get a char w/forced UC
   1876 C246 F0 0A                                beq .0000030          ;EOI
                                        ;
   1878 C248 E0 20                                cpx #s_auxbuf         ;mode buffer full?
   1879 C24A B0 E1                                bcs monasc04          ;yes, too much input
                                        ;
   1881 C24C 9D 51 02                   .0000020 sta auxbuf,x          ;store for comparison
   1882 C24F E8                                   inx
   1883 C250 D0 F1                                bne .0000010
                                        ;
                                        ;
                                        ;	evaluate mnemonic...
                                        ;
   1888 C252 A2 5B                      .0000030 ldx #n_mnemon-1       ;starting mnemonic index
                                        ;
   1890 C254 8A                         monasc07 txa                   ;convert index...
   1891 C255 0A                                   asl                   ;to offset
   1892 C256 A8                                   tay                   ;now mnemonic table index
   1893 C257 C2 20                    +            .byte $c2,$20
                                                         ;16 bit compare
   1894 C259 B9 FF CC                             lda mnetab,y          ;get mnemonic from table
   1895 C25C C5 C8                                cmp mnepck            ;compare to entered mnemonic
   1896 C25E E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   1897 C260 F0 05                                beq .0000020          ;match
                                        ;
   1899 C262 CA                         .0000010 dex                   ;try next mnemonic
   1900 C263 30 C8                                bmi monasc04          ;unknown mnemonic — error
                                        ;
   1902 C265 80 ED                                bra monasc07          ;keep going
                                        ;
   1904 C267 86 C8                      .0000020 stx mnepck            ;save mnemonic index
   1905 C269 8A                                   txa
   1906 C26A A2 00                                ldx #0                ;trial opcode
                                        ;
   1908 C26C DD B7 CD                   .0000030 cmp mnetabix,x        ;search index table...
   1909 C26F F0 05                                beq .0000050          ;for a match
                                        ;
   1911 C271 E8                         .0000040 inx                   ;keep going until we...
   1912 C272 D0 F8                                bne .0000030          ;search entire table
                                        ;
   1914 C274 80 B7                                bra monasc04          ;this shouldn't happen!
                                        ;
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;	If the mnemonic index table search fails then there is a coding error
                                        ;	somewhere, as every entry in the mnemonic table is supposed to have a
                                        ;	matching cardinal index.
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	evaluate addressing mode...
                                        ;
   1925 C276 86 CA                      .0000050 stx opcode            ;save trial opcode
   1926 C278 20 3B CB                             jsr instdata          ;get related instruction data
   1927 C27B 85 D1                                sta vopsflag          ;save 8/16 or relative flag
   1928 C27D 86 CF                                stx iopsize           ;operand size
   1929 C27F E8                                   inx
   1930 C280 86 C6                                stx instsize          ;instruction size
   1931 C282 A6 CA                                ldx opcode            ;recover trial opcode
   1932 C284 98                                   tya                   ;addressing mode
   1933 C285 0A                                   asl                   ;create table index
   1934 C286 A8                                   tay
   1935 C287 C2 20                    +            .byte $c2,$20
                                        
   1936 C289 B9 BB CF                             lda ms_lutab,y        ;mode lookup table
   1937 C28C 85 A4                                sta addrb             ;set pointer
   1938 C28E E2 20                    +            .byte $e2,$20
                                        
   1939 C290 A0 00                                ldy #0
                                        ;
   1941 C292 B1 A4                      .0000060 lda (addrb),y         ;table addressing mode
   1942 C294 D9 51 02                             cmp auxbuf,y          ;entered addressing mode
   1943 C297 F0 04                                beq .0000080          ;okay so far
                                        ;
   1945 C299 A5 C8                      .0000070 lda mnepck            ;reload mnemonic index        
   1946 C29B 80 D4                                bra .0000040          ;wrong opcode for addresing mode
                                        ;
   1948 C29D 09 00                      .0000080 ora #0                ;last char the terminator?
   1949 C29F F0 03                                beq .0000090          ;yes, evaluate operand
                                        ;
   1951 C2A1 C8                                   iny
   1952 C2A2 80 EE                                bra .0000060          ;keep testing
                                        ;
                                        ;
                                        ;	evaluate operand...
                                        ;
   1957 C2A4 A5 CD                      .0000090 lda eopsize           ;entered operand size
   1958 C2A6 D0 06                                bne .0000100          ;non-zero
                                        ;
   1960 C2A8 05 CF                                ora iopsize           ;instruction operand size
   1961 C2AA D0 ED                                bne .0000070          ;wrong opcode — keep trying
                                        ;
   1963 C2AC 80 45                                bra monasc08          ;assemble instruction
                                        ;
   1965 C2AE 24 D1                      .0000100 bit vopsflag          ;is this a branch?
   1966 C2B0 70 3A                                bvs .0000160          ;yes, evaluate
                                        ;
   1968 C2B2 A5 CF                                lda iopsize           ;instruction operand size
   1969 C2B4 24 D1                                bit vopsflag          ;variable size operand allowed?
   1970 C2B6 30 15                                bmi .0000130          ;yes
                                        ;
   1972 C2B8 24 CE                                bit flimflag          ;was forced immediate set?
   1973 C2BA 10 03                                bpl .0000110          ;no
                                        ;         
   1975 C2BC 4C 45 C3                             jmp monasc10          ;yes — error
                                        ;
   1977 C2BF C5 CD                      .0000110 cmp eopsize           ;entered operand size
   1978 C2C1 90 D6                                bcc .0000070          ;operand too big
                                        ;
   1980 C2C3 85 CD                                sta eopsize           ;new operand size
   1981 C2C5 80 2C                                bra monasc08          ;assemble, otherwise...
                                        ;
   1983 C2C7 C5 CD                      .0000120 cmp eopsize           ;exact size match required
   1984 C2C9 D0 CE                                bne .0000070          ;mismatch — wrong opcode
                                        ;
   1986 C2CB 80 26                                bra monasc08          ;assemble
                                        ;
                                        ;
                                        ;	process variable size immediate mode operand...
                                        ;
   1991 C2CD A6 CD                      .0000130 ldx eopsize           ;entered operand size
   1992 C2CF E0 03                                cpx #s_xword          ;check size
   1993 C2D1 B0 72                                bcs monasc10          ;too big — error
                                        ;
   1995 C2D3 24 CE                                bit flimflag          ;forced long immediate?
   1996 C2D5 10 06                                bpl .0000140          ;no
                                        ;
   1998 C2D7 A2 02                                ldx #s_word           ;promote operand size to...
   1999 C2D9 86 CD                                stx eopsize           ;16 bits
   2000 C2DB 80 08                                bra .0000150
                                        ;
   2002 C2DD E0 02                      .0000140 cpx #s_word           ;16 bits?
   2003 C2DF D0 04                                bne .0000150          ;no
                                        ;
   2005 C2E1 A0 C0                                ldy #flimmask         ;yes so force long...
   2006 C2E3 84 CE                                sty flimflag          ;immediate disassembly
                                        ;
   2008 C2E5 1A                         .0000150 ina                   ;new instruction operand size
   2009 C2E6 C5 CD                                cmp eopsize           ;compare against operand size
   2010 C2E8 90 AF                                bcc .0000070          ;mismatch — can't assemble
                                        ;
   2012 C2EA 80 07                                bra monasc08          ;okay, assemble
                                        ;
                                        ;
                                        ;	process relative branch...
                                        ;
   2017 C2EC 20 87 CB                   .0000160 jsr targoff           ;compute branch offset
   2018 C2EF B0 54                                bcs monasc10          ;branch out of range
                                        ;
   2020 C2F1 85 CD                                sta eopsize           ;effective operand size
                                        ;
                                        ;
                                        ;	assemble instruction...
                                        ;
   2025 C2F3 A5 CA                      monasc08 lda opcode            ;opcode
   2026 C2F5 87 A0                    +            .byte $87,addra
                                        ;store at assembly address
   2027 C2F7 A6 CD                                ldx eopsize           ;any operand to process?
   2028 C2F9 F0 09                                beq .0000020          ;no
                                        ;
   2030 C2FB 9B                       +            .byte $9b
                                                           ;also storage offset
                                        ;
   2032 C2FC CA                         .0000010 dex
   2033 C2FD B5 BB                                lda operand,x         ;get operand byte &...
   2034 C2FF 97 A0                    +            .byte $97,addra
                                        ;poke into memory
   2035 C301 88                                   dey
   2036 C302 D0 F8                                bne .0000010          ;next
                                        ;
   2038 C304 A9 0D                      .0000020 lda #a_cr
                                           		 cpu FT832
   2040 00C306 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2042 C30B A9 41                                lda #asmprfx          ;assembly prefix
   2043 C30D 20 57 C6                             jsr dpycodaa          ;disassemble & display
                                        ;
                                        ;
                                        ;	prompt for next instruction...
                                        ;
   2048 C310 A9 20                      monasc09 lda #a_blank
   2049 C312 A2 08                                ldx #ascprmct-1
                                        ;
   2051 C314 9D 00 02                   .0000010 sta ibuffer,x         ;prepare buffer for...
   2052 C317 CA                                   dex                   ;next instruction
   2053 C318 10 FA                                bpl .0000010
                                        ;
   2055 C31A A9 41                                lda #asmprfx          ;assemble code...
   2056 C31C 8D 00 02                             sta ibuffer           ;prompt prefix
   2057 C31F A5 A2                                lda addra+s_word      ;next instruction address bank
   2058 C321 20 86 C9                             jsr binhex            ;convert to ASCII
   2059 C324 8D 02 02                             sta ibuffer+apadrbkh  ;store MSN in buffer
   2060 C327 8E 03 02                             stx ibuffer+apadrbkl  ;store LSN in buffer
   2061 C32A A5 A1                                lda addra+s_byte      ;next instruction address MSB
   2062 C32C 20 86 C9                             jsr binhex
   2063 C32F 8D 04 02                             sta ibuffer+apadrmbh
   2064 C332 8E 05 02                             stx ibuffer+apadrmbl
   2065 C335 A5 A0                                lda addra             ;next instruction address LSB
   2066 C337 20 86 C9                             jsr binhex
   2067 C33A 8D 06 02                             sta ibuffer+apadrlbh
   2068 C33D 8E 07 02                             stx ibuffer+apadrlbl
   2069 C340 A9 09                                lda #ascprmct         ;effective input count
   2070 C342 4C 2A C1                             jmp moncea            ;reenter input loop
                                        ;
                                        ;
                                        ;	process assembly error...
                                        ;
   2075 C345 20 BA C7                   monasc10 jsr dpyerr            ;indicate error &...
   2076 C348 80 C6                                bra monasc09          ;prompt w/same assembly address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondsc: DISASSEMBLE CODE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: D [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2086 C34A B0 11                      mondsc   bcs .0000010          ;no parameters
                                        ;
   2088 C34C 64 CE                                stz flimflag          ;reset to 8 bit mode
   2089 C34E 20 CB CA                             jsr facasize          ;check starting...
   2090 C351 C9 04                                cmp #s_dword          ;address
   2091 C353 B0 46                                bcs .0000050          ;out of range — error
                                        ;
   2093 C355 20 AD CA                             jsr facaddra          ;copy starting address
   2094 C358 20 DF CA                             jsr getparm           ;get ending address
   2095 C35B 90 17                                bcc .0000020          ;gotten
                                        ;
   2097 C35D 20 99 C9                   .0000010 jsr clrfaca           ;clear accumulator
   2098 C360 C2 20                    +            .byte $c2,$20
                                        
   2099 C362 18                                   clc
   2100 C363 A5 A0                                lda addra             ;starting address
   2101 C365 69 15                    +            adc #<n_dbytes
   2101 C367 00                       +            .byte >n_dbytes
                                        ;default bytes
   2102 C368 85 A7                                sta faca              ;effective ending address
   2103 C36A E2 20                    +            .byte $e2,$20
                                        
   2104 C36C A5 A2                                lda addra+s_word      ;starting bank
   2105 C36E 69 00                                adc #0
   2106 C370 85 A9                                sta faca+s_word       ;effective ending bank
   2107 C372 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2109 C374 20 CB CA                   .0000020 jsr facasize          ;check ending...
   2110 C377 C9 04                                cmp #s_dword          ;address
   2111 C379 B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2113 C37B 20 B7 CA                             jsr facaddrb          ;set ending address
   2114 C37E 20 DF CA                             jsr getparm           ;check for excess input
   2115 C381 90 18                                bcc .0000050          ;present — error
                                        ;
   2117 C383 20 05 CA                             jsr calccnt           ;calculate bytes
   2118 C386 90 13                                bcc .0000050          ;end < start
                                        ;
   2120 C388 20 AF CC                   .0000030 jsr teststop          ;test for display stop
   2121 C38B B0 0B                                bcs .0000040          ;stopped
                                        ;
   2123 C38D 20 01 C8                             jsr newline           ;next line
   2124 C390 20 55 C6                             jsr dpycod            ;disassemble & display
   2125 C393 20 63 CA                             jsr decdcnt           ;decrement byte count
   2126 C396 90 F0                                bcc .0000030          ;not done
                                        ;
   2128 C398 4C 26 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2130 C39B 4C 65 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjmp: EXECUTE CODE
                                        ;
                                        ;	—————————————————————————————————————————————————————————————
                                        ;	syntax: G [<addr>]
                                        ;
                                        ;	If no address is specified, the current values in the PB & PC
                                        ;	shadow registers are used.
                                        ;	—————————————————————————————————————————————————————————————
                                        ;
   2143 C39E 20 70 CB                   monjmp   jsr setxaddr          ;set execution address
   2144 C3A1 B0 29                                bcs monjmpab          ;out of range — error
                                        ;
   2146 C3A3 20 DF CA                             jsr getparm           ;check for excess input
   2147 C3A6 90 24                                bcc monjmpab          ;too much input — error
                                        ;
   2149 C3A8 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   2150 C3AA A5 95                                lda reg_spx
   2151 C3AC 1B                       +            .byte $1b
                                                           ;restore SP
                                        ;
   2153 C3AD E2 20                      monjmpaa +         .byte $e2,$20
                                        
   2154 C3AF A5 88                                lda reg_pbx
   2155 C3B1 48                                   pha                   ;restore PB
   2156 C3B2 C2 20                    +            .byte $c2,$20
                                        
   2157 C3B4 A5 86                                lda reg_pcx
   2158 C3B6 48                                   pha                   ;restore PC
   2159 C3B7 E2 20                    +            .byte $e2,$20
                                        
   2160 C3B9 A5 99                                lda reg_srx
   2161 C3BB 48                                   pha                   ;restore SR
   2162 C3BC A5 9B                                lda reg_dbx
   2163 C3BE 48                                   pha
   2164 C3BF AB                       +            .byte $ab
                                                           ;restore DB
   2165 C3C0 C2 30                    +            .byte $c2,$30
                                        
   2166 C3C2 A5 9C                                lda reg_dpx
   2167 C3C4 5B                       +            .byte $5b
                                                           ;restore DP
   2168 C3C5 A5 89                                lda reg_ax            ;restore .C
   2169 C3C7 A6 8D                                ldx reg_xx            ;restore .X
   2170 C3C9 A4 91                                ldy reg_yx            ;restore .Y
   2171 C3CB 40                                   rti                   ;execute code
                                        ;
   2173 C3CC 4C 65 C1                   monjmpab jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjsr: EXECUTE CODE AS SUBROUTINE
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	syntax: J [<addr>]
                                        ;
                                        ;	If no address is specified the current values in the PB & PC
                                        ;	shadow registers are used.   An RTS at the end of the called
                                        ;	subroutine will return control to the monitor  provided  the
                                        ;	stack remains in balance.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2188 C3CF 20 70 CB                   monjsr   jsr setxaddr          ;set execution address
   2189 C3D2 B0 F8                                bcs monjmpab          ;out of range — error
                                        ;
   2191 C3D4 20 DF CA                             jsr getparm           ;check for excess input
   2192 C3D7 90 F3                                bcc monjmpab          ;too much input — error
                                        ;
   2194 C3D9 C2 20                    +            .byte $c2,$20
                                        
   2195 C3DB A5 95                                lda reg_spx
   2196 C3DD 1B                       +            .byte $1b
                                                           ;restore SP &...
   2197 C3DE 20 AD C3                             jsr monjmpaa          ;call subroutine
   2198 C3E1 08                                   php                   ;push SR
   2199 C3E2 C2 30                    +            .byte $c2,$30
                                        
   2200 C3E4 85 89                                sta reg_ax            ;save...
   2201 C3E6 86 8D                                stx reg_xx            ;register...
   2202 C3E8 84 91                                sty reg_yx            ;returns
   2203 C3EA E2 10                    +            .byte $e2,$10
                                                        ;8 bit .X & .Y
   2204 C3EC FA                                   plx                   ;get & save...
   2205 C3ED 86 99                                stx reg_srx           ;return SR
   2206 C3EF 3B                       +            .byte $3b
                                                           ;get & save...
   2207 C3F0 85 95                                sta reg_spx           ;return SP
   2208 C3F2 7B                       +            .byte $7b
                                                           ;get & save...
   2209 C3F3 85 9C                                sta reg_dpx           ;DP pointer
   2210 C3F5 E2 20                    +            .byte $e2,$20
                                                        ;8 bit .A
   2211 C3F7 4B                       +            .byte $4b
                                                           ;get &...
   2212 C3F8 68                                   pla                   ;save...
   2213 C3F9 85 88                                sta reg_pbx           ;return PB
   2214 C3FB 8B                       +            .byte $8b
                                                           ;get &...
   2215 C3FC 68                                   pla                   ;save...
   2216 C3FD 85 9B                                sta reg_dbx           ;return DB
   2217 C3FF F4                       +            .byte $f4
   2217 C400 D0 D0                    +            .word mm_rts
                                        ;"*RET"
   2218 C402 4C 72 C0                             jmp moncom            ;return to monitor
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchm: CHANGE and/or DUMP MEMORY
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	syntax: > [<addr> <operand> [<operand>]...]
                                        ;
                                        ;	> <addr> without operands will dump 16 bytes
                                        ;	of memory, starting at <addr>.
                                        ;	————————————————————————————————————————————
                                        ;
   2231 C405 B0 23                      monchm   bcs .0000030          ;no address given — quit
                                        ;
   2233 C407 20 CB CA                             jsr facasize          ;size address
   2234 C40A C9 04                                cmp #s_dword
   2235 C40C B0 1F                                bcs .0000040          ;address out of range — error
                                        ;
   2237 C40E 20 AD CA                             jsr facaddra          ;set starting address
   2238 C411 20 E0 CB                             jsr getpat            ;evaluate change pattern
   2239 C414 90 04                                bcc .0000010          ;entered
                                        ;
   2241 C416 10 0C                                bpl .0000020          ;not entered
                                        ;
   2243 C418 80 13                                bra .0000040          ;evaluation error
                                        ;
   2245 C41A 88                         .0000010 dey                   ;next byte
   2246 C41B 30 07                                bmi .0000020          ;done
                                        ;
   2248 C41D B9 51 02                             lda auxbuf,y          ;write pattern...
   2249 C420 97 A0                    +            .byte $97,addra
                                        ;to memory
   2250 C422 80 F6                                bra .0000010          ;next
                                        ;
   2252 C424 20 01 C8                   .0000020 jsr newline           ;next line
   2253 C427 20 73 C7                             jsr dpymem            ;regurgitate changes
                                        ;
   2255 C42A 4C 26 C1                   .0000030 jmp monce             ;back to command loop
                                        ;
   2257 C42D 4C 65 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncmp: COMPARE MEMORY
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: C <start> <end> <ref>
                                        ;	—————————————————————————————
                                        ;
   2267 C430 B0 26                      moncmp   bcs .0000030          ;start not given — quit
                                        ;
   2269 C432 20 87 CA                             jsr enddest           ;get end & reference addresses
   2270 C435 B0 24                                bcs .0000040          ;range or other error
                                        ;
   2272 C437 64 CC                                stz xrtemp            ;column counter
                                        ;
   2274 C439 20 AF CC                   .0000010 jsr teststop          ;check for stop
   2275 C43C B0 1A                                bcs .0000030          ;abort
                                        ;
   2277 C43E A7 A0                    +            .byte $a7,addra
                                        ;get from reference location
   2278 C440 C7 BB                    +            .byte $c7,operand
                                        ;test against compare location
   2279 C442 F0 03                                beq .0000020          ;match, don't display address
                                        ;
   2281 C444 20 3B C6                             jsr dpycaddr          ;display current location
                                        ;
   2283 C447 20 07 CB                   .0000020 jsr nxtaddra          ;next reference location
   2284 C44A B0 0C                                bcs .0000030          ;done
                                        ;
   2286 C44C C2 20                    +            .byte $c2,$20
                                        
   2287 C44E E6 BB                                inc operand           ;bump bits 0-15
   2288 C450 E2 20                    +            .byte $e2,$20
                                        
   2289 C452 D0 E5                                bne .0000010
                                        ;
   2291 C454 E6 BD                                inc operand+s_word    ;bump bits 16-23
   2292 C456 80 E1                                bra .0000010
                                        ;
   2294 C458 4C 26 C1                   .0000030 jmp monce             ;return to command exec
                                        ;
   2296 C45B 4C 65 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncpy: COPY (transfer) MEMORY
                                        ;
                                        ;	————————————————————————————————
                                        ;	syntax: T <start> <end> <target>
                                        ;	————————————————————————————————
                                        ;
   2306 C45E B0 49                      moncpy   bcs .0000040          ;start not given — quit
                                        ;
   2308 C460 20 87 CA                             jsr enddest           ;get end & target addresses
   2309 C463 B0 47                                bcs .0000050          ;range or other error
                                        ;
   2311 C465 C2 20                    +            .byte $c2,$20
                                        
   2312 C467 38                                   sec
   2313 C468 A5 A4                                lda addrb             ;ending address
   2314 C46A E5 A0                                sbc addra             ;starting address
   2315 C46C 90 3E                                bcc .0000050          ;start > end — error
                                        ;
   2317 C46E 85 AF                                sta facb              ;bytes to copy
   2318 C470 E2 20                    +            .byte $e2,$20
                                        
   2319 C472 C2 10                    +            .byte $c2,$10
                                        
   2320 C474 A5 BD                                lda operand+s_word    ;target bank
   2321 C476 A4 BB                                ldy operand           ;target address
   2322 C478 C5 A2                                cmp addra+s_word      ;source bank
   2323 C47A C2 20                    +            .byte $c2,$20
                                        
   2324 C47C D0 1C                                bne .0000020          ;can use forward copy
                                        ;
   2326 C47E C4 A0                                cpy addra             ;source address
   2327 C480 90 18                                bcc .0000020          ;can use forward copy
                                        ;
   2329 C482 D0 02                                bne .0000010          ;must use reverse copy
                                        ;
   2331 C484 80 26                                bra .0000050          ;copy in place — error
                                        ;
   2333 C486 A5 AF                      .0000010 lda facb              ;get bytes to copy
   2334 C488 48                                   pha                   ;protect
   2335 C489 20 95 CC                             jsr lodbnk            ;load banks
   2336 C48C 20 2D CA                             jsr cprvsup           ;do reverse copy setup
   2337 C48F 68                                   pla                   ;get bytes to copy
   2338 C490 AA                                   tax                   ;save a copy
   2339 C491 18                                   clc
   2340 C492 65 BB                                adc operand           ;change target to...
   2341 C494 A8                                   tay                   ;target end
   2342 C495 8A                                   txa                   ;recover bytes to copy
   2343 C496 A6 A4                                ldx addrb             ;source end
   2344 C498 80 0C                                bra .0000030
                                        ;
   2346 C49A A5 AF                      .0000020 lda facb              ;get bytes to copy
   2347 C49C 48                                   pha                   ;protect
   2348 C49D 20 95 CC                             jsr lodbnk            ;load banks
   2349 C4A0 20 26 CA                             jsr cpfwsup           ;do forward copy setup
   2350 C4A3 68                                   pla                   ;get bytes to copy
   2351 C4A4 A6 A0                                ldx addra             ;source start
                                        ;
   2353 C4A6 4C D2 00                   .0000030 jmp mcftwork          ;copy memory
                                        ;
   2355 C4A9 4C 26 C1                   .0000040 jmp monce             ;back to executive
                                        ;
   2357 C4AC 4C 65 C1                   .0000050 jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondmp: DISPLAY MEMORY RANGE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: M [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2367 C4AF B0 0F                      mondmp   bcs .0000010          ;no parameters
                                        ;
   2369 C4B1 20 CB CA                             jsr facasize          ;check address...
   2370 C4B4 C9 04                                cmp #s_dword          ;range
   2371 C4B6 B0 46                                bcs .0000050          ;address out of range
                                        ;
   2373 C4B8 20 AD CA                             jsr facaddra          ;copy starting address
   2374 C4BB 20 DF CA                             jsr getparm           ;get ending address
   2375 C4BE 90 17                                bcc .0000020          ;gotten
                                        ;
   2377 C4C0 20 99 C9                   .0000010 jsr clrfaca           ;clear accumulator
   2378 C4C3 C2 20                    +            .byte $c2,$20
                                        
   2379 C4C5 18                                   clc
   2380 C4C6 A5 A0                                lda addra             ;starting address
   2381 C4C8 69 FF                    +            adc #<n_mbytes
   2381 C4CA 00                       +            .byte >n_mbytes
                                        ;default bytes
   2382 C4CB 85 A7                                sta faca              ;effective ending address
   2383 C4CD E2 20                    +            .byte $e2,$20
                                        
   2384 C4CF A5 A2                                lda addra+s_word      ;starting bank
   2385 C4D1 69 00                                adc #0
   2386 C4D3 85 A9                                sta faca+s_word       ;effective ending bank
   2387 C4D5 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2389 C4D7 20 CB CA                   .0000020 jsr facasize          ;check ending address...
   2390 C4DA C9 04                                cmp #s_dword          ;range
   2391 C4DC B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2393 C4DE 20 B7 CA                             jsr facaddrb          ;copy ending address
   2394 C4E1 20 DF CA                             jsr getparm           ;check for excess input
   2395 C4E4 90 18                                bcc .0000050          ;error
                                        ;
   2397 C4E6 20 05 CA                             jsr calccnt           ;calculate bytes to dump
   2398 C4E9 90 13                                bcc .0000050          ;end < start
                                        ;
   2400 C4EB 20 AF CC                   .0000030 jsr teststop          ;test for display stop
   2401 C4EE B0 0B                                bcs .0000040          ;stopped
                                        ;
   2403 C4F0 20 01 C8                             jsr newline           ;next line
   2404 C4F3 20 73 C7                             jsr dpymem            ;display
   2405 C4F6 20 63 CA                             jsr decdcnt           ;decrement byte count
   2406 C4F9 90 F0                                bcc .0000030          ;not done
                                        ;
   2408 C4FB 4C 26 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2410 C4FE 4C 65 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monfil: FILL MEMORY
                                        ;
                                        ;	—————————————————————————————————————————
                                        ;	syntax: F <start> <end> <fill>
                                        ;
                                        ;	<start> & <end> must be in the same bank.
                                        ;	—————————————————————————————————————————
                                        ;
   2422 C501 B0 5E                      monfil   bcs .0000010          ;start not given — quit
                                        ;
   2424 C503 20 CB CA                             jsr facasize          ;check size
   2425 C506 C9 04                                cmp #s_dword
   2426 C508 B0 5A                                bcs .0000020          ;out of range — error...
                                        ;
   2428 C50A 20 AD CA                             jsr facaddra          ;store start
   2429 C50D 20 DF CA                             jsr getparm           ;evaluate end
   2430 C510 B0 52                                bcs .0000020          ;not entered — error
                                        ;
   2432 C512 20 CB CA                             jsr facasize          ;check size
   2433 C515 C9 04                                cmp #s_dword
   2434 C517 B0 4B                                bcs .0000020          ;out of range — error
                                        ;
   2436 C519 A5 A9                                lda faca+s_word       ;end bank
   2437 C51B C5 A2                                cmp addra+s_word      ;start bank
   2438 C51D D0 45                                bne .0000020          ;not same — error
                                        ;
   2440 C51F 20 B7 CA                             jsr facaddrb          ;store <end>
   2441 C522 C2 20                    +            .byte $c2,$20
                                        
   2442 C524 38                                   sec
   2443 C525 A5 A4                                lda addrb             ;ending address
   2444 C527 E5 A0                                sbc addra             ;starting address
   2445 C529 90 39                                bcc .0000020          ;start > end — error
                                        ;
   2447 C52B 85 AF                                sta facb              ;bytes to copy
   2448 C52D E2 20                    +            .byte $e2,$20
                                        
   2449 C52F 20 DF CA                             jsr getparm           ;evaluate <fill>
   2450 C532 B0 30                                bcs .0000020          ;not entered — error
                                        ;
   2452 C534 20 CB CA                             jsr facasize          ;<fill> should be...
   2453 C537 C9 02                                cmp #s_word           ;8 bits
   2454 C539 B0 29                                bcs .0000020          ;it isn't — error
                                        ;
   2456 C53B 20 C1 CA                             jsr facaoper          ;store <fill>
   2457 C53E 20 DF CA                             jsr getparm           ;should be no more parameters
   2458 C541 90 21                                bcc .0000020          ;there are — error
                                        ;
   2460 C543 A5 BB                                lda operand           ;<fill>
   2461 C545 87 A0                    +            .byte $87,addra
                                        ;fill 1st location
   2462 C547 C2 30                    +            .byte $c2,$30
                                                         ;16 bit operations
   2463 C549 A5 AF                                lda facb              ;
   2464 C54B F0 14                                beq .0000010          ;only 1 location — finished
                                        ;
   2466 C54D 3A                                   dea                   ;zero align &...
   2467 C54E 48                                   pha                   ;protect
   2468 C54F E2 20                    +            .byte $e2,$20
                                        
   2469 C551 A5 A2                                lda addra+s_word      ;start bank
   2470 C553 EB                       +            .byte $eb
                                        
   2471 C554 A5 A6                                lda addrb+s_word      ;end bank
   2472 C556 20 26 CA                             jsr cpfwsup           ;do forward copy setup
   2473 C559 68                                   pla                   ;recover fill count
   2474 C55A A6 A0                                ldx addra             ;fill-from starting location
   2475 C55C 9B                       +            .byte $9b
                                        
   2476 C55D C8                                   iny                   ;fill-to starting location
   2477 C55E 4C D2 00                             jmp mcftwork          ;fill memory
                                        ;
   2479 C561 4C 26 C1                   .0000010 jmp monce             ;goto command executive
                                        ;
   2481 C564 4C 65 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monhnt: SEARCH (hunt) MEMORY
                                        ;
                                        ;	———————————————————————————————————
                                        ;	syntax: H <addr1> <addr2> <pattern>
                                        ;	———————————————————————————————————
                                        ;
   2491 C567 B0 40                      monhnt   bcs .0000050          ;no start address
                                        ;
   2493 C569 20 CB CA                             jsr facasize          ;size starting address
   2494 C56C C9 04                                cmp #s_dword
   2495 C56E B0 3C                                bcs .0000060          ;address out of range — error
                                        ;
   2497 C570 20 AD CA                             jsr facaddra          ;store starting address
   2498 C573 20 DF CA                             jsr getparm           ;evaluate ending address
   2499 C576 B0 34                                bcs .0000060          ;no address — error
                                        ;
   2501 C578 20 CB CA                             jsr facasize          ;size ending address
   2502 C57B C9 04                                cmp #s_dword
   2503 C57D B0 2D                                bcs .0000060          ;address out of range — error
                                        ;
   2505 C57F 20 B7 CA                             jsr facaddrb          ;store ending address
   2506 C582 20 05 CA                             jsr calccnt           ;calculate byte range
   2507 C585 90 25                                bcc .0000060          ;end < start
                                        ;
   2509 C587 20 E0 CB                             jsr getpat            ;evaluate search pattern
   2510 C58A B0 20                                bcs .0000060          ;error
                                        ;
   2512 C58C 64 CC                                stz xrtemp            ;clear column counter
                                        ;
   2514 C58E 20 AF CC                   .0000010 jsr teststop          ;check for stop
   2515 C591 B0 16                                bcs .0000050          ;abort
                                        ;
   2517 C593 A4 BE                                ldy auxbufix          ;pattern index
                                        ;
   2519 C595 88                         .0000020 dey
   2520 C596 30 09                                bmi .0000030          ;pattern match
                                        ;
   2522 C598 B7 A0                    +            .byte $b7,addra
                                        ;get from memory
   2523 C59A D9 51 02                             cmp auxbuf,y          ;test against pattern
   2524 C59D D0 05                                bne .0000040          ;mismatch, next location
                                        ;
   2526 C59F F0 F4                                beq .0000020          ;match, keep testing
                                        ;
   2528 C5A1 20 3B C6                   .0000030 jsr dpycaddr          ;display current location
                                        ;
   2530 C5A4 20 07 CB                   .0000040 jsr nxtaddra          ;next location
   2531 C5A7 90 E5                                bcc .0000010          ;not done
                                        ;
   2533 C5A9 4C 26 C1                   .0000050 jmp monce             ;back to executive
                                        ;
   2535 C5AC 4C 65 C1                   .0000060 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monenv: CONVERT NUMERIC VALUE
                                        ;
                                        ;	——————————————————————
                                        ;	syntax: <radix><value>
                                        ;	——————————————————————
                                        ;
   2545 C5AF 20 DD CA                   monenv   jsr getparmr          ;reread & evaluate parameter
   2546 C5B2 B0 26                                bcs .0000020          ;none entered
                                        ;
   2548 C5B4 A2 00                                ldx #0                ;radix index
   2549 C5B6 A0 04                                ldy #n_radix          ;number of radices
                                        ;
   2551 C5B8 5A                         .0000010 phy                   ;save counter
   2552 C5B9 DA                                   phx                   ;save radix index
   2553 C5BA 20 01 C8                             jsr newline           ;next line &...
   2554 C5BD 20 69 C7                             jsr clearlin          ;clear it
   2555 C5C0 A9 20                                lda #a_blank
   2556 C5C2 A2 04                                ldx #halftab
   2557 C5C4 20 F2 C7                             jsr multspc           ;indent 1/2 tab
   2558 C5C7 FA                                   plx                   ;get radix index but...
   2559 C5C8 DA                                   phx                   ;put it back
   2560 C5C9 BD F2 CC                             lda radxtab,x         ;get radix
   2561 C5CC 20 F2 C8                             jsr binasc            ;convert to ASCII
   2562 C5CF 5A                                   phy                   ;string address MSB
   2563 C5D0 DA                                   phx                   ;string address LSB
   2564 C5D1 20 19 C8                             jsr sprint            ;print
   2565 C5D4 FA                                   plx                   ;get index again
   2566 C5D5 7A                                   ply                   ;get counter
   2567 C5D6 E8                                   inx
   2568 C5D7 88                                   dey
   2569 C5D8 D0 DE                                bne .0000010          ;no
                                        
   2571 C5DA 4C 26 C1                   .0000020 jmp monce             ;back to command exec
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchr: CHANGE REGISTERS
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	syntax: ; [PB [PC [.S [.C [.X [.Y [SP [DP [DB]]]]]]]]]
                                        ;
                                        ;	; with no parameters is the same as the R command.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   2583 C5DD B0 33                      monchr   bcs .0000040          ;dump registers & quit
                                        ;
   2585 C5DF A0 00                                ldy #0                ;register counter
   2586 C5E1 84 B5                                sty facc              ;initialize register index
                                        ;
   2588 C5E3 20 CB CA                   .0000010 jsr facasize          ;get parameter size
   2589 C5E6 D9 F6 CC                             cmp rcvltab,y         ;check against size table
   2590 C5E9 B0 2A                                bcs .0000050          ;out of range
                                        ;
   2592 C5EB B9 F6 CC                             lda rcvltab,y         ;determine number of bytes...
   2593 C5EE C9 03                                cmp #s_word+1         ;to store
   2594 C5F0 66 B6                                ror facc+s_byte       ;condition flag
   2595 C5F2 10 02                                bpl .0000020          ;8 bit register size
                                        ;
   2597 C5F4 C2 20                    +            .byte $c2,$20
                                                         ;16 bit register size
                                        ;
   2599 C5F6 A6 B5                      .0000020 ldx facc              ;get register index
   2600 C5F8 A5 A7                                lda faca              ;get parm
   2601 C5FA 95 88                                sta reg_pbx,x         ;put in shadow storage
   2602 C5FC E2 20                    +            .byte $e2,$20
                                        
   2603 C5FE 06 B6                                asl facc+s_byte       ;mode flag to carry
   2604 C600 8A                                   txa                   ;register index
   2605 C601 69 01                                adc #s_byte           ;at least 1 byte stored
   2606 C603 85 B5                                sta facc              ;save new index
   2607 C605 20 DF CA                             jsr getparm           ;get a parameter
   2608 C608 B0 08                                bcs .0000040          ;EOI
                                        ;
   2610 C60A C8                                   iny                   ;bump register count
   2611 C60B C0 09                                cpy #n_regchv         ;all registers processed?
   2612 C60D D0 D4                                bne .0000010          ;no, keep going
                                        ;
   2614 C60F 20 0D C8                   .0000030 jsr alert             ;excessive input
                                        ;
   2616 C612 4C 7F C0                   .0000040 jmp monreg            ;display changes
                                        ;
   2618 C615 4C 65 C1                   .0000050 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monxit: EXIT TO OPERATING ENVIRONMENT
                                        ;
                                        ;	—————————
                                        ;	syntax: X
                                        ;	—————————
                                        ;
   2628 C618 90 1E                      monxit   bcc .0000020          ;no parameters allowed
                                        ;
   2630 C61A C2 20                    +            .byte $c2,$20
                                        
   2631 C61C AD 02 01                             lda vecbrki           ;BRK indirect vector
   2632 C61F C9 42                    +            cmp #<monbrk
   2632 C621 C0                       +            .byte >monbrk
                                        ;we intercept it?
   2633 C622 D0 09                                bne .0000010          ;no, don't change it
                                        ;
   2635 C624 AD 05 01                             lda vecbrkia          ;old vector
   2636 C627 8D 02 01                             sta vecbrki           ;restore it
   2637 C62A 9C 05 01                             stz vecbrkia          ;invalidate old vector
                                        ;         
   2639 C62D E2 30                      .0000010 +         .byte $e2,$30
                                        
                                           		 CPU FT832
   2641 00C62F 42 CB 42 A2 00 00            		 TSK	JMP:#0
   2642 00C635 4C 00 C0                     		 JMP	$C000
                                        		 CPU	W65C02
                                        ;         jml vecexit           ;long jump to exit
                                        ;
   2646 C638 4C 65 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * *                                         * *
                                        ; * * S T A R T   o f   S U B R O U T I N E S * *
                                        ; * *                                         * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;dpycaddr: DISPLAY CURRENT ADDRESS IN COLUMNS
                                        ;
   2658 C63B A6 CC                      dpycaddr ldx xrtemp            ;column count
   2659 C63D D0 05                                bne .0000010          ;not at right side
                                        ;
   2661 C63F 20 01 C8                             jsr newline           ;next row
   2662 C642 A2 08                                ldx #n_hccols         ;max columns
                                        ;
   2664 C644 E0 08                      .0000010 cpx #n_hccols         ;max columns
   2665 C646 F0 07                                beq .0000020          ;at left margin
                                        ;
   2667 C648 A9 09                                lda #a_ht
                                           		 cpu FT832
   2669 00C64A 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2672 C64F CA                         .0000020 dex                   ;one less column
   2673 C650 86 CC                                stx xrtemp            ;save column counter
   2674 C652 4C C6 C7                             jmp prntladr          ;print reference address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpycod: DISASSEMBLE & DISPLAY CODE
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This function disassembles & displays the machine code at  the  location
                                        ;	pointed to by ADDRA.  Upon return, ADDRA will point to the opcode of the
                                        ;	next instruction.   The entry point at DPYCODAA  should be called with a
                                        ;	disassembly prefix character loaded in .A.   If entered  at  DPYCOD, the
                                        ;	default character will be display at the beginning of each  disassembled
                                        ;	instruction.
                                        ;
                                        ;	The disassembly of immediate mode instructions that can take an 8 or  16
                                        ;	bit operand is affected by the bit pattern that is  stored  in  FLIMFLAG
                                        ;	upon entry to this function:
                                        ;
                                        ;	    FLIMFLAG: xx000000
                                        ;	              ||
                                        ;	              |+—————————> 0:  8 bit .X or .Y operand
                                        ;	              |            1: 16 bit .X or .Y operand
                                        ;	              +——————————> 0:  8 bit .A or BIT # operand
                                        ;	                           1: 16 bit .A or BIT # operand
                                        ;
                                        ;	FLIMFLAG is conditioned according to the operand of  the  most  recently
                                        ;	disassembled REP or SEP instruction.   Hence repetitive  calls  to  this
                                        ;	subroutine will usually result in the correct disassembly of 16 bit imm-
                                        ;	ediate mode instructions.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   2705 C655 A9 2E                       public dpycod   lda #disprfx          ;default prefix
                                        ;
                                        ;
                                        ;	alternate prefix display entry point...
                                        ;
   2710 C657                            dpycodaa 
                                           		 cpu FT832
   2712 00C657 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2714 C65C 20 11 C8                             jsr printspc          ;space
   2715 C65F 20 C6 C7                             jsr prntladr          ;print long address
   2716 C662 20 11 C8                             jsr printspc          ;space to opcode field
   2717 C665 20 D9 CA                             jsr getbyte           ;get opcode
   2718 C668 85 CA                                sta opcode            ;save &...
   2719 C66A 20 06 C8                             jsr printbyt          ;display as hex
                                        ;
                                        ;
                                        ;	decode menmonic & addressing info...
                                        ;
   2724 C66D A6 CA                                ldx opcode            ;current mnemonic
   2725 C66F BD B7 CD                             lda mnetabix,x        ;get mnemonic index
   2726 C672 0A                                   asl                   ;double for...
   2727 C673 A8                                   tay                   ;mnemonic table offset
   2728 C674 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   2729 C676 B9 FF CC                             lda mnetab,y          ;copy encoded mnemonic to...
   2730 C679 85 C8                                sta mnepck            ;working storage
   2731 C67B E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   2732 C67D 20 3B CB                             jsr instdata          ;extract mode & size data
   2733 C680 85 D1                                sta vopsflag          ;save mode flags
   2734 C682 84 C3                                sty admodidx          ;save mode index
   2735 C684 0A                                   asl                   ;variable immediate instruction?
   2736 C685 90 1F                                bcc dpycod01          ;no, effective operand size in .X
                                        ;
                                        ;
                                        ;	determine immediate mode operand size...
                                        ;
   2741 C687 A5 CA                                lda opcode            ;current opcode
   2742 C689 24 CE                                bit flimflag          ;operand display mode
   2743 C68B 10 08                                bpl .0000010          ;8 bit .A & BIT immediate mode
                                        ;
   2745 C68D 29 1F                                and #aimmaska         ;determine if...
   2746 C68F C9 09                                cmp #aimmaskb         ;.A or BIT immediate
   2747 C691 F0 10                                beq .0000030          ;display 16 bit operand
                                        ;
   2749 C693 A5 CA                                lda opcode            ;not .A or BIT immediate
                                        ;
   2751 C695 50 0F                      .0000010 bvc dpycod01          ;8 bit .X/.Y immediate mode
                                        ;
   2753 C697 A0 03                                ldy #n_vopidx-1       ;opcodes to test
                                        ;
   2755 C699 D9 B7 CF                   .0000020 cmp vopidx,y          ;looking for LDX #, CPY #, etc.
   2756 C69C F0 07                                beq .0000040          ;disassemble a 16 bit operand
                                        ;
   2758 C69E 88                                   dey
   2759 C69F 10 F8                                bpl .0000020          ;keep trying
                                        ;
   2761 C6A1 80 03                                bra dpycod01          ;not .X or .Y immediate
                                        ;
   2763 C6A3 A5 CA                      .0000030 lda opcode            ;reload
                                        ;
   2765 C6A5 E8                         .0000040 inx                   ;16 bit operand
                                        ;
                                        ;
                                        ;	get & display operand bytes...
                                        ;
   2770 C6A6 86 CF                      dpycod01 stx iopsize           ;operand size...
   2771 C6A8 E8                                   inx                   ;plus opcode becomes...
   2772 C6A9 86 C6                                stx instsize          ;instruction size
   2773 C6AB 86 C4                                stx charcnt           ;total bytes to process
   2774 C6AD A9 0B                                lda #n_opcols+2       ;total operand columns plus WS
   2775 C6AF 85 CC                                sta xrtemp            ;initialize counter
   2776 C6B1 20 1A CA                             jsr clroper           ;clear operand
   2777 C6B4 A4 CF                                ldy iopsize           ;operand size
   2778 C6B6 F0 16                                beq .0000020          ;no operand
                                        ;
   2780 C6B8 A2 00                                ldx #0                ;operand index
                                        ;
   2782 C6BA 20 D9 CA                   .0000010 jsr getbyte           ;get operand byte
   2783 C6BD 95 BB                                sta operand,x         ;save
   2784 C6BF DA                                   phx                   ;protect operand index
   2785 C6C0 20 06 C8                             jsr printbyt          ;print operand byte
   2786 C6C3 C6 CC                                dec xrtemp            ;3 columns used, 2 for...
   2787 C6C5 C6 CC                                dec xrtemp            ;operand nybbles &...
   2788 C6C7 C6 CC                                dec xrtemp            ;1 for whitespace
   2789 C6C9 FA                                   plx                   ;get operand index
   2790 C6CA E8                                   inx                   ;bump it
   2791 C6CB 88                                   dey
   2792 C6CC D0 EC                                bne .0000010          ;next
                                        ;
   2794 C6CE A6 CC                      .0000020 ldx xrtemp            ;operand columns remaining
   2795 C6D0 20 F2 C7                             jsr multspc           ;space to mnemonic field
                                        ;
                                        ;
                                        ;	display mnemonic...
                                        ;
   2800 C6D3 A0 03                                ldy #s_mnemon         ;size of ASCII mnemonic
                                        ;
   2802 C6D5 A9 00                      .0000030 lda #0                ;initialize char
   2803 C6D7 A2 05                                ldx #n_shfenc         ;shifts to execute
                                        ;
   2805 C6D9 06 C8                      .0000040 asl mnepck            ;shift encoded mnemonic
   2806 C6DB 26 C9                                rol mnepck+s_byte
   2807 C6DD 2A                                   rol
   2808 C6DE CA                                   dex
   2809 C6DF D0 F8                                bne .0000040
                                        ;
   2811 C6E1 69 3F                                adc #a_mnecvt         ;convert to ASCII &...
   2812 C6E3 48                                   pha                   ;stash
   2813 C6E4 88                                   dey
   2814 C6E5 D0 EE                                bne .0000030          ;continue with mnemonic
                                        ;
   2816 C6E7 A0 03                                ldy #s_mnemon
                                        ;
   2818 C6E9 68                         .0000050 pla                   ;get mnenmonic byte
                                           		 cpu FT832
   2820 00C6EA 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2822 C6EF 88                                   dey
   2823 C6F0 D0 F7                                bne .0000050
                                        ;
                                        ;
                                        ;	display operand...
                                        ;
   2828 C6F2 A5 CF                                lda iopsize           ;operand size
   2829 C6F4 F0 73                                beq clearlin          ;zero, disassembly finished
                                        ;
   2831 C6F6 20 11 C8                             jsr printspc          ;space to operand field
   2832 C6F9 24 D1                                bit vopsflag          ;check mode flags
   2833 C6FB 50 08                                bvc dpycod02          ;not a branch
                                        ;
   2835 C6FD 20 51 CB                             jsr offtarg           ;compute branch target
   2836 C700 A6 C6                                ldx instsize          ;effective instruction size
   2837 C702 CA                                   dex
   2838 C703 86 CF                                stx iopsize           ;effective operand size
                                        ;
   2840 C705 64 D1                      dpycod02 stz vopsflag          ;clear
   2841 C707 A5 C3                                lda admodidx          ;instruction addressing mode
   2842 C709 C9 0B                                cmp #am_move          ;block move instruction?
   2843 C70B D0 02                                bne .0000010          ;no
                                        ;
   2845 C70D 66 D1                                ror vopsflag          ;yes
                                        ;
   2847 C70F 0A                         .0000010 asl                   ;convert addressing mode to...
   2848 C710 AA                                   tax                   ;symbology table index
   2849 C711 C2 20                    +            .byte $c2,$20
                                                         ;do a 16 bit load
   2850 C713 BD BB CF                             lda ms_lutab,x        ;addressing symbol pointer
   2851 C716 48                                   pha
   2852 C717 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bit loads
   2853 C719 A0 00                                ldy #0
   2854 C71B B3 01                    +            .byte $b3,1
                                        ;get 1st char
   2855 C71D C9 20                                cmp #a_blank
   2856 C71F F0 05                                beq .0000020          ;no addresing mode preamble
                                        ;
                                           		 cpu FT832
   2859 00C721 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2862 C726 A9 24                      .0000020 lda #c_hex
                                           		 cpu FT832
   2864 00C728 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2866 C72D A4 CF                                ldy iopsize           ;operand size = index
                                        ;
   2868 C72F 88                         .0000030 dey
   2869 C730 30 16                                bmi .0000040          ;done with operand
                                        ;
   2871 C732 B9 BB 00                             lda operand,y         ;get operand byte
   2872 C735 20 E3 C7                             jsr dpyhex            ;print operand byte
   2873 C738 24 D1                                bit vopsflag          ;block move?
   2874 C73A 10 F3                                bpl .0000030          ;no
                                        ;
   2876 C73C 64 D1                                stz vopsflag          ;reset
   2877 C73E 5A                                   phy                   ;protect operand index
   2878 C73F F4                       +            .byte $f4
   2878 C740 F4 CF                    +            .word ms_move
                                        
   2879 C742 20 19 C8                             jsr sprint            ;display MVN/MVP operand separator
   2880 C745 7A                                   ply                   ;recover operand index again
   2881 C746 80 E7                                bra .0000030          ;continue
                                        ;
   2883 C748 FA                         .0000040 plx                   ;symbology LSB
   2884 C749 7A                                   ply                   ;symbology MSB
   2885 C74A E8                                   inx                   ;move past preamble
   2886 C74B D0 01                                bne .0000050
                                        ;
   2888 C74D C8                                   iny
                                        ;
   2890 C74E 5A                         .0000050 phy
   2891 C74F DA                                   phx
   2892 C750 20 19 C8                             jsr sprint            ;print postamble, if any
                                        ;
                                        ;
                                        ;	condition immediate mode display format...
                                        ;
   2897 C753 A5 BB                      dpycod03 lda operand           ;operand LSB
   2898 C755 29 30                                and #pfmxmask         ;isolate M & X bits
   2899 C757 0A                                   asl                   ;shift to match...
   2900 C758 0A                                   asl                   ;FLIMFLAG alignment
   2901 C759 A6 CA                                ldx opcode            ;current instruction
   2902 C75B E0 C2                                cpx #opc_rep          ;was it REP?
   2903 C75D D0 04                                bne .0000010          ;no
                                        ;
   2905 C75F 04 CE                                tsb flimflag          ;set flag bits as required
   2906 C761 80 06                                bra clearlin
                                        ;
   2908 C763 E0 E2                      .0000010 cpx #opc_sep          ;was it SEP?
   2909 C765 D0 02                                bne clearlin          ;no, just exit
                                        ;
   2911 C767 14 CE                                trb flimflag          ;clear flag bits as required
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clearlin: CLEAR DISPLAY LINE
                                        ;
   2917 C769 F4                         clearlin +         .byte $f4
   2917 C76A 11 D0                    +            .word dc_cl
                                        
   2918 C76C 80 4F                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyibuf: DISPLAY MONITOR INPUT BUFFER CONTENTS
                                        ;
   2924 C76E F4                         dpyibuf +         .byte $f4
   2924 C76F 00 02                    +            .word ibuffer
                                        
   2925 C771 80 4A                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpymem: DISPLAY MEMORY
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	This function displays 16 bytes of memory as hex values & as
                                        ;	ASCII equivalents.  The starting address for the display is
                                        ;	in ADDRA & is expected to be a 24 bit address.  Upon return,
                                        ;	ADDRA will point to the start of the next 16 bytes.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2938 C773 E2 30                      dpymem +         .byte $e2,$30
                                        
   2939 C775 64 C4                                stz charcnt           ;reset
   2940 C777 A9 3E                                lda #memprfx
                                           		 cpu FT832
   2942 00C779 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2944 C77E 20 C6 C7                             jsr prntladr          ;print 24 bit address
   2945 C781 A2 00                                ldx #0                ;string buffer index
   2946 C783 A0 08                                ldy #n_dump           ;bytes per line
                                        ;
   2948 C785 20 D9 CA                   .0000010 jsr getbyte           ;get from RAM, also...
   2949 C788 48                                   pha                   ;save for decoding
   2950 C789 DA                                   phx                   ;save string index
   2951 C78A 20 06 C8                             jsr printbyt          ;display as hex ASCII
   2952 C78D E6 C4                                inc charcnt           ;bytes displayed +1
   2953 C78F FA                                   plx                   ;recover string index &...
   2954 C790 68                                   pla                   ;byte
   2955 C791 C9 20                                cmp #a_blank          ;printable?
   2956 C793 90 04                                bcc .0000020          ;no
                                        ;
   2958 C795 C9 7F                                cmp #a_del
   2959 C797 90 02                                bcc .0000030          ;is printable
                                        ;
   2961 C799 A9 2E                      .0000020 lda #memsubch         ;substitute character
                                        ;
   2963 C79B 9D 00 02                   .0000030 sta ibuffer,x         ;save char
   2964 C79E E8                                   inx                   ;bump index
   2965 C79F 88                                   dey                   ;byte count -= 1
   2966 C7A0 D0 E3                                bne .0000010          ;not done
                                        ;
   2968 C7A2 9E 00 02                             stz ibuffer,x         ;terminate ASCII string
   2969 C7A5 A9 3A                                lda #memsepch
                                           		 cpu FT832
   2971 00C7A7 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2973 C7AC F4                       +            .byte $f4
   2973 C7AD 07 D0                    +            .word dc_bf
                                        
   2974 C7AF 20 19 C8                             jsr sprint            ;select reverse video
   2975 C7B2 20 6E C7                             jsr dpyibuf           ;display ASCII equivalents
   2976 C7B5 F4                       +            .byte $f4
   2976 C7B6 1C D0                    +            .word dc_er
                                        ;normal video
   2977 C7B8 80 03                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyerr: DISPLAY ERROR SIGNAL
                                        ;
   2983 C7BA F4                         dpyerr +         .byte $f4
   2983 C7BB 49 D0                    +            .word mm_err
                                        ;"*ERR"
                                        ;
   2985 C7BD 20 19 C8                   dpyerraa jsr sprint
   2986 C7C0 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;gendbs: GENERATE DESTRUCTIVE BACKSPACE
                                        ;
   2992 C7C1 F4                         gendbs +         .byte $f4
   2992 C7C2 0D D0                    +            .word dc_bs
                                        ;destructive backspace
   2993 C7C4 80 F7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;prntladr: PRINT 24 BIT CURRENT ADDRESS
                                        ;
   2999 C7C6 08                         prntladr php                   ;protect register sizes
   3000 C7C7 E2 20                    +            .byte $e2,$20
                                        
   3001 C7C9 A5 A2                                lda addra+s_word      ;get bank byte &...
   3002 C7CB 20 E3 C7                             jsr dpyhex            ;display it
   3003 C7CE C2 20                    +            .byte $c2,$20
                                        
   3004 C7D0 A5 A0                                lda addra             ;get 16 bit address
   3005 C7D2 28                                   plp                   ;restore register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhexw: DISPLAY BINARY WORD AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .C: word to display
                                        ;
                                        ;	Returned Values: .C: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3019 C7D3 08                         dpyhexw  php                   ;save register sizes
   3020 C7D4 C2 20                    +            .byte $c2,$20
                                        
   3021 C7D6 48                                   pha                   ;protect value
   3022 C7D7 E2 20                    +            .byte $e2,$20
                                        
   3023 C7D9 EB                       +            .byte $eb
                                                           ;get MSB &...
   3024 C7DA 20 E3 C7                             jsr dpyhex            ;display
   3025 C7DD C2 20                    +            .byte $c2,$20
                                        
   3026 C7DF 68                                   pla                   ;recover value
   3027 C7E0 E2 20                    +            .byte $e2,$20
                                                        ;only LSB visible
   3028 C7E2 28                                   plp                   ;reset register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhex: DISPLAY BINARY BYTE AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to display
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3042 C7E3 20 86 C9                   dpyhex   jsr binhex            ;convert to hex ASCII
                                           		 cpu FT832
   3044 00C7E6 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3046 C7EB 8A                                   txa
                                           		 cpu FT832
   3048 00C7EC 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3050 C7F1 60                          		 rts
                                                 ;jmp putcha            ;print LSN
                                        ;
                                        ;================================================================================
                                        ;
                                        ;multspc: PRINT MULTIPLE BLANKS
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .X: number of blanks to print
                                        ;
                                        ;	Register Returns: none
                                        ;
                                        ;	Calling Example : ldx #3
                                        ;	                  jsr multspc    ;print 3 spaces
                                        ;
                                        ;	Notes: This sub will print 1 blank if .X=0.
                                        ;	————————————————————————————————————————————————
                                        ;
   3068 C7F2 8A                         multspc  txa
   3069 C7F3 D0 01                                bne .0000010          ;blank count specified
                                        ;
   3071 C7F5 E8                                   inx                   ;default to 1 blank
                                        ;
   3073 C7F6 A9 20                      .0000010 lda #a_blank
                                        ;
   3075 C7F8                            .0000020 
                                           		 cpu FT832
   3077 00C7F8 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3079 C7FD CA                                   dex
   3080 C7FE D0 F8                                bne .0000020
                                        ;
   3082 C800 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;newline: PRINT NEWLINE (CRLF)
                                        ;
   3088 C801 F4                         newline +         .byte $f4
   3088 C802 22 D0                    +            .word dc_lf
                                        
   3089 C804 80 B7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printbyt: PRINT A BYTE WITH LEADING SPACE
                                        ;
   3095 C806 48                         printbyt pha                   ;protect byte
   3096 C807 20 11 C8                             jsr printspc          ;print leading space
   3097 C80A 68                                   pla                   ;restore &...
   3098 C80B 80 D6                                bra dpyhex            ;print byte
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;alert: ALERT USER w/TERMINAL BELL
                                        ;
   3104 C80D A9 07                      alert    lda #a_bel
   3105 C80F 80 02                                bra printcmn
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printspc: PRINT A SPACE
                                        ;
   3111 C811 A9 20                      printspc lda #a_blank
                                        ;
   3113 C813                            printcmn 
                                           		 cpu FT832
   3115 00C813 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3117 C818 60                          		 rts
                                        ;jmp putcha
                                        ;
                                        ;================================================================================
                                        ;
                                        ;sprint: PRINT NULL-TERMINATED CHARACTER STRING
                                        ;
                                        ;	—————————————————————————————————————————————————————————
                                        ;	Preparatory Ops : SP+1: string address LSB
                                        ;	                  SP+2: string address MSB
                                        ;
                                        ;	Register Returns: .A: used
                                        ;	                  .B: entry value
                                        ;	                  .X: used
                                        ;	                  .Y: used
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: okay
                                        ;	           |||||||      1: string too long (1)
                                        ;	           ||||+++————> not defined
                                        ;	           |||+———————> 1
                                        ;	           ||+————————> 1
                                        ;	           ++—————————> not defined
                                        ;
                                        ;	Example: PER STRING
                                        ;	         JSR SPRINT
                                        ;	         BCS TOOLONG
                                        ;
                                        ;	Notes: 1) Maximum permissible string length including the
                                        ;	          terminator is 32,767 bytes.
                                        ;	       2) All registers are forced to 8 bits.
                                        ;	       3) DO NOT JUMP OR BRANCH INTO THIS FUNCTION!
                                        ;	—————————————————————————————————————————————————————————
                                        ;
   3152 C819 E2 20                      sprint +         .byte $e2,$20
                                                        ;8 bit accumulator
   3153 C81B C2 10                    +            .byte $c2,$10
                                                         ;16 bit index
                                        ;
                                        ;—————————————————————————————————————————————————————————
   3305 = 0000000000000001                            .reetaddr =1                    ;return address
                                        
   3307 = 00000003                      .src     =.reetaddr+s_word      ;string address stack offset
                                        
                                        ;—————————————————————————————————————————————————————————
                                        ;
   3162 C81D A0 00                    +            ldy #<0
   3162 C81F 00                       +            .byte >0
                                        
   3163 C820 18                                   clc                   ;no initial error
                                        ;
   3165 C821 B3 03                      .0000010 +         .byte $b3,.src
                                        ;get a byte
   3166 C823 F0 09                                beq .0000020          ;done
                                        ;
                                           		 cpu FT832
   3169 00C825 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3171 C82A C8                                   iny
   3172 C82B 10 F4                                bpl .0000010          ;next
                                        ;
   3174 C82D 38                                   sec                   ;string too long
                                        ;
   3176 C82E FA                         .0000020 plx                   ;pull RTS address
   3177 C82F 7A                                   ply                   ;clear string pointer
   3178 C830 DA                                   phx                   ;replace RTS
   3179 C831 E2 10                    +            .byte $e2,$10
                                        
   3180 C833 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ascbin: CONVERT NULL-TERMINATED ASCII NUMBER STRING TO BINARY
                                        ;
                                        ;	———————————————————————————————————————————————————
                                        ;	Preparatory Ops: ASCII number string in IBUFFER
                                        ;
                                        ;	Returned Values: FACA: converted parameter
                                        ;	                   .A: used
                                        ;	                   .X: used
                                        ;	                   .Y: used
                                        ;	                   .C: 1 = conversion error
                                        ;	                   .Z: 1 = nothing to convert
                                        ;
                                        ;	Notes: 1) Conversion stops when a non-numeric char-
                                        ;	          acter is encountered.
                                        ;	       2) Radix symbols are as follows:
                                        ;
                                        ;	          % binary
                                        ;	          @ octal
                                        ;	          + decimal
                                        ;	          $ hexadecimal
                                        ;
                                        ;	          Hex is the default if no radix is speci-
                                        ;	          fied in the 1st character of the string.
                                        ;	———————————————————————————————————————————————————
                                        ;
   3209 C834 E2 30                      ascbin +         .byte $e2,$30
                                        
   3210 C836 20 99 C9                             jsr clrfaca           ;clear accumulator
   3211 C839 64 C4                                stz charcnt           ;zero char count
   3212 C83B 64 C2                                stz radix             ;initialize
                                        ;
                                        ;
                                        ;	process radix if present...
                                        ;
   3217 C83D 20 2C CC                             jsr getcharw          ;get next non-WS char
   3218 C840 D0 02                                bne .0000010          ;got something
                                        ;
   3220 C842 18                                   clc                   ;no more input
   3221 C843 60                                   rts
                                        ;
   3223 C844 A2 03                      .0000010 ldx #n_radix-1        ;number of radices
                                        ;
   3225 C846 DD F2 CC                   .0000020 cmp radxtab,x         ;recognized radix?
   3226 C849 F0 06                                beq .0000030          ;yes
                                        ;
   3228 C84B CA                                   dex
   3229 C84C 10 F8                                bpl .0000020          ;try next
                                        ;
   3231 C84E C6 BF                                dec ibufidx           ;reposition to previous char
   3232 C850 E8                                   inx                   ;not recognized, assume hex
                                        ;
   3234 C851 C9 2B                      .0000030 cmp #c_dec            ;decimal radix?
   3235 C853 D0 02                                bne .0000040          ;not decimal
                                        ;
   3237 C855 66 C2                                ror radix             ;flag decimal conversion
                                        ;
   3239 C857 BD DE CC                   .0000040 lda basetab,x         ;number bases table
   3240 C85A 85 D0                                sta range             ;set valid numeral range
   3241 C85C BD E2 CC                             lda bitsdtab,x        ;get bits per digit
   3242 C85F 85 C0                                sta bitsdig           ;store
                                        ;
                                        ;
                                        ;	process numerals...
                                        ;
   3247 C861 20 CE CB                   ascbin01 jsr getchar           ;get next char
   3248 C864 F0 70                                beq ascbin03          ;EOI
                                        ;
   3250 C866 C9 20                                cmp #' '
   3251 C868 F0 6C                                beq ascbin03          ;blank — EOF
                                        ;
   3253 C86A C9 2C                                cmp #','
   3254 C86C F0 68                                beq ascbin03          ;comma — EOF
                                        ;
   3256 C86E C9 09                                cmp #a_ht
   3257 C870 F0 64                                beq ascbin03          ;tab — EOF
                                        ;
   3259 C872 20 F3 C9                             jsr nybtobin          ;change to binary
   3260 C875 B0 60                                bcs ascbin04          ;not a recognized numeral
                                        ;
   3262 C877 C5 D0                                cmp range             ;check range
   3263 C879 B0 5C                                bcs ascbin04          ;not valid for base
                                        ;
   3265 C87B 85 C1                                sta numeral           ;save processed numeral
   3266 C87D E6 C4                                inc charcnt           ;bump numeral count
   3267 C87F 24 C2                                bit radix             ;working in base 10?
   3268 C881 10 15                                bpl .0000030          ;no
                                        ;
                                        ;
                                        ;	compute N*2 for decimal conversion...
                                        ;
   3273 C883 A2 00                                ldx #0                ;accumulator index
   3274 C885 A0 02                                ldy #s_pfac/2         ;iterations
   3275 C887 C2 20                    +            .byte $c2,$20
                                        
   3276 C889 18                                   clc
                                        ;
   3278 C88A B5 A7                      .0000020 lda faca,x            ;N
   3279 C88C 2A                                   rol                   ;N=N*2
   3280 C88D 95 AF                                sta facb,x
   3281 C88F E8                                   inx
   3282 C890 E8                                   inx
   3283 C891 88                                   dey
   3284 C892 D0 F6                                bne .0000020
                                        ;
   3286 C894 B0 41                                bcs ascbin04          ;overflow — error
                                        ;
   3288 C896 E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	compute N*base for binary, octal or hex...
                                        ;	or N*8 for decimal...
                                        ;
   3294 C898 A6 C0                      .0000030 ldx bitsdig           ;bits per digit
   3295 C89A C2 20                    +            .byte $c2,$20
                                                         ;16 bit shifts
                                        ;
   3297 C89C 06 A7                      .0000040 asl faca
   3298 C89E 26 A9                                rol faca+s_word
   3299 C8A0 B0 35                                bcs ascbin04          ;overflow — error
                                        ;
   3301 C8A2 CA                                   dex
   3302 C8A3 D0 F7                                bne .0000040          ;next shift
                                        ;
   3304 C8A5 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   3305 C8A7 24 C2                                bit radix             ;check base
   3306 C8A9 10 13                                bpl ascbin02          ;not decimal
                                        ;
                                        ;
                                        ;	compute N*10 for decimal (N*8 + N*2)...
                                        ;
   3311 C8AB A0 04                                ldy #s_pfac
   3312 C8AD C2 20                    +            .byte $c2,$20
                                        
                                        ;
   3314 C8AF B5 A7                      .0000050 lda faca,x            ;N*8
   3315 C8B1 75 AF                                adc facb,x            ;N*2
   3316 C8B3 95 A7                                sta faca,x            ;now N*10
   3317 C8B5 E8                                   inx
   3318 C8B6 E8                                   inx
   3319 C8B7 88                                   dey
   3320 C8B8 D0 F5                                bne .0000050
                                        ;
   3322 C8BA B0 1B                                bcs ascbin04          ;overflow — error
                                        ;
   3324 C8BC E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	add current numeral to partial result...
                                        ;
   3329 C8BE A5 A7                      ascbin02 lda faca              ;N
   3330 C8C0 65 C1                                adc numeral           ;N=N+D
   3331 C8C2 85 A7                                sta faca
   3332 C8C4 A2 01                                ldx #1
   3333 C8C6 A0 03                                ldy #s_pfac-1
                                        ;
   3335 C8C8 B5 A7                      .0000010 lda faca,x
   3336 C8CA 69 00                                adc #0                ;account for carry
   3337 C8CC 95 A7                                sta faca,x
   3338 C8CE E8                                   inx
   3339 C8CF 88                                   dey
   3340 C8D0 D0 F6                                bne .0000010
                                        ;
   3342 C8D2 90 8D                                bcc ascbin01          ;next if no overflow
                                        ;
   3344 C8D4 B0 01                                bcs ascbin04          ;overflow — error
                                        ;
                                        ;
                                        ;	finish up...
                                        ;
   3349 C8D6 18                         ascbin03 clc                   ;no error
                                        ;
   3351 C8D7 E2 20                      ascbin04 +         .byte $e2,$20
                                                        ;reset if necessary
   3352 C8D9 A5 C4                                lda charcnt           ;load char count
   3353 C8DB 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bcdasc: CONVERT BCD DIGIT TO ASCII
                                        ;
                                        ;	———————————————————————————————————————
                                        ;	Preparatory Ops: .A: BCD digit, $00-$99
                                        ;
                                        ;	Returned Values: .A: ASCII MSD
                                        ;	                 .X: ASCII LSD
                                        ;	                 .Y: entry value
                                        ;	———————————————————————————————————————
                                        ;
   3367 C8DC 20 E8 C8                   bcdasc   jsr bintonyb          ;extract nybbles
   3368 C8DF 48                                   pha                   ;save tens
   3369 C8E0 8A                                   txa                 
   3370 C8E1 09 30                                ora #btoamask         ;change units to ASCII
   3371 C8E3 AA                                   tax                   ;store
   3372 C8E4 68                                   pla                   ;get tens
   3373 C8E5 09 30                                ora #btoamask         ;change to ASCII
   3374 C8E7 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bintonyb: EXTRACT BINARY NYBBLES
                                        ;
                                        ;	—————————————————————————————————
                                        ;	Preparatory Ops: .A: binary value
                                        ;
                                        ;	Returned Values: .A: MSN
                                        ;	                 .X: LSN
                                        ;	                 .Y: entry value
                                        ;	—————————————————————————————————
                                        ;
   3388 C8E8 48                         bintonyb pha                   ;save
   3389 C8E9 29 0F                                and #bcdumask         ;extract LSN
   3390 C8EB AA                                   tax                   ;save it
   3391 C8EC 68                                   pla
                                        ;         .rept s_bnybbl        ;extract MSN
   3393 C8ED 4A                                     lsr
   3394 C8EE 4A                                     lsr
   3395 C8EF 4A                                     lsr
   3396 C8F0 4A                                     lsr
                                        ;         .endr
   3398 C8F1 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binasc: CONVERT 32-BIT BINARY TO NULL-TERMINATED ASCII NUMBER STRING
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	Preparatory Ops: FACA: 32-bit operand
                                        ;	                   .A: radix character, w/bit 7 set to
                                        ;	                       suppress radix symbol in the
                                        ;	                       conversion string
                                        ;
                                        ;	Returned Values: ibuffer: conversion string
                                        ;	                      .A: string length
                                        ;	                      .X: string address LSB
                                        ;	                      .Y: string address MSB
                                        ;
                                        ;	Execution Notes: ibufidx & instsize are overwritten.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   3418 C8F2 64 BF                      binasc   stz ibufidx           ;initialize string index
   3419 C8F4 64 C6                                stz instsize          ;clear format flag
                                        ;
                                        ;
                                        ;	evaluate radix...
                                        ;
   3424 C8F6 0A                                   asl                   ;extract format flag &...
   3425 C8F7 66 C6                                ror instsize          ;save it
   3426 C8F9 4A                                   lsr                   ;extract radix character
   3427 C8FA A2 03                                ldx #n_radix-1        ;total radices
                                        ;
   3429 C8FC DD F2 CC                   .0000010 cmp radxtab,x         ;recognized radix?
   3430 C8FF F0 04                                beq .0000020          ;yes
                                        ;
   3432 C901 CA                                   dex
   3433 C902 10 F8                                bpl .0000010          ;try next
                                        ;
   3435 C904 E8                                   inx                   ;assume hex
                                        ;
   3437 C905 86 C2                      .0000020 stx radix             ;save radix index for later
   3438 C907 24 C6                                bit instsize
   3439 C909 30 08                                bmi .0000030          ;no radix symbol wanted
                                        ;
   3441 C90B BD F2 CC                             lda radxtab,x         ;radix table
   3442 C90E 8D 00 02                             sta ibuffer           ;prepend to string
   3443 C911 E6 BF                                inc ibufidx           ;bump string index
                                        ;
   3445 C913 C9 2B                      .0000030 cmp #c_dec            ;converting to decimal?
   3446 C915 D0 07                                bne .0000040          ;no
                                        ;
   3448 C917 20 AB C9                             jsr facabcd           ;convert operand to BCD
   3449 C91A A9 00                                lda #0
   3450 C91C 80 17                                bra .0000070          ;skip binary stuff
                                        ;
                                        ;
                                        ;	prepare for binary, octal or hex conversion...
                                        ;
   3455 C91E A2 00                      .0000040 ldx #0                ;operand index
   3456 C920 A0 05                                ldy #s_sfac-1         ;workspace index
                                        ;
   3458 C922 B5 A7                      .0000050 lda faca,x            ;copy operand to...
   3459 C924 99 AF 00                             sta facb,y            ;workspace in...
   3460 C927 88                                   dey                   ;big-endian order
   3461 C928 E8                                   inx
   3462 C929 E0 04                                cpx #s_pfac
   3463 C92B D0 F5                                bne .0000050
                                        ;
   3465 C92D A9 00                                lda #0
   3466 C92F BB                       +            .byte $bb
                                        
                                        ;
   3468 C930 95 AF                      .0000060 sta facb,x            ;pad workspace
   3469 C932 CA                                   dex
   3470 C933 10 FB                                bpl .0000060
                                        ;
                                        ;
                                        ;	set up conversion parameters...
                                        ;
   3475 C935 85 B5                      .0000070 sta facc              ;initialize byte counter
   3476 C937 A4 C2                                ldy radix             ;radix index
   3477 C939 B9 EE CC                             lda numstab,y         ;numerals in string
   3478 C93C 85 B6                                sta facc+s_byte       ;set remaining numeral count
   3479 C93E B9 E6 CC                             lda bitsntab,y        ;bits per numeral
   3480 C941 85 B7                                sta facc+s_word       ;set
   3481 C943 B9 EA CC                             lda lzsttab,y         ;leading zero threshold
   3482 C946 85 B8                                sta facc+s_xword      ;set
                                        ;
                                        ;
                                        ;	generate conversion string...
                                        ;
   3487 C948 A9 00                      .0000080 lda #0
   3488 C94A A4 B7                                ldy facc+s_word       ;bits per numeral
                                        ;
   3490 C94C A2 05                      .0000090 ldx #s_sfac-1         ;workspace size
   3491 C94E 18                                   clc                   ;avoid starting carry
                                        ;
   3493 C94F 36 AF                      .0000100 rol facb,x            ;shift out a bit...
   3494 C951 CA                                   dex                   ;from the operand or...
   3495 C952 10 FB                                bpl .0000100          ;BCD conversion result
                                        ;
   3497 C954 2A                                   rol                   ;bit to .A
   3498 C955 88                                   dey
   3499 C956 D0 F4                                bne .0000090          ;more bits to grab
                                        ;
   3501 C958 A8                                   tay                   ;if numeral isn't zero...
   3502 C959 D0 0A                                bne .0000110          ;skip leading zero tests
                                        ;
   3504 C95B A6 B6                                ldx facc+s_byte       ;remaining numerals
   3505 C95D E4 B8                                cpx facc+s_xword      ;leading zero threshold
   3506 C95F 90 04                                bcc .0000110          ;below it, must convert
                                        ;
   3508 C961 A6 B5                                ldx facc              ;processed byte count
   3509 C963 F0 11                                beq .0000130          ;discard leading zero
                                        ;
   3511 C965 C9 0A                      .0000110 cmp #10               ;check range
   3512 C967 90 02                                bcc .0000120          ;is 0-9
                                        ;
   3514 C969 69 06                                adc #a_hexdec         ;apply hex adjust
                                        ;
   3516 C96B 69 30                      .0000120 adc #'0'              ;change to ASCII
   3517 C96D A4 BF                                ldy ibufidx           ;string index
   3518 C96F 99 00 02                             sta ibuffer,y         ;save numeral in buffer
   3519 C972 E6 BF                                inc ibufidx           ;next buffer position
   3520 C974 E6 B5                                inc facc              ;bytes=bytes+1
                                        ;
   3522 C976 C6 B6                      .0000130 dec facc+s_byte       ;numerals=numerals-1
   3523 C978 D0 CE                                bne .0000080          ;not done
                                        ;
                                        ;
                                        ;	terminate string & exit...
                                        ;
   3528 C97A A6 BF                                ldx ibufidx           ;printable string length
   3529 C97C 9E 00 02                             stz ibuffer,x         ;terminate string
   3530 C97F 8A                                   txa
   3531 C980 A2 00                                ldx #<ibuffer         ;converted string
   3532 C982 A0 02                                ldy #>ibuffer
   3533 C984 18                                   clc                   ;all okay
   3534 C985 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binhex: CONVERT BINARY BYTE TO HEX ASCII CHARS
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to convert
                                        ;
                                        ;	Returned Values: .A: MSN ASCII char
                                        ;	                 .X: LSN ASCII char
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————————————
                                        ;
   3548 C986 20 E8 C8                   binhex   jsr bintonyb          ;generate binary values
   3549 C989 48                                   pha                   ;save MSN
   3550 C98A 8A                                   txa
   3551 C98B 20 90 C9                             jsr .0000010          ;generate ASCII LSN
   3552 C98E AA                                   tax                   ;save
   3553 C98F 68                                   pla                   ;get input
                                        ;
                                        ;
                                        ;	convert nybble to hex ASCII equivalent...
                                        ;
   3558 C990 C9 0A                      .0000010 cmp #10
   3559 C992 90 02                                bcc .0000020          ;in decimal range
                                        ;
   3561 C994 69 66                                adc #k_hex            ;hex compensate
                                        ;         
   3563 C996 49 30                      .0000020 eor #'0'              ;finalize nybble
   3564 C998 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfaca: CLEAR FLOATING ACCUMULATOR A
                                        ;
   3570 C999 08                         clrfaca  php
   3571 C99A C2 20                    +            .byte $c2,$20
                                        
   3572 C99C 64 A7                                stz faca
   3573 C99E 64 A9                                stz faca+s_word
   3574 C9A0 28                                   plp
   3575 C9A1 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfacb: CLEAR FLOATING ACCUMULATOR B
                                        ;
   3581 C9A2 08                         clrfacb  php
   3582 C9A3 C2 20                    +            .byte $c2,$20
                                        
   3583 C9A5 64 AF                                stz facb
   3584 C9A7 64 B1                                stz facb+s_word
   3585 C9A9 28                                   plp
   3586 C9AA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facabcd: CONVERT FACA INTO BCD
                                        ;
   3592 C9AB A2 03                      facabcd  ldx #s_pfac-1         ;primary accumulator size -1
                                        ;
   3594 C9AD B5 A7                      .0000010 lda faca,x            ;value to be converted
   3595 C9AF 48                                   pha                   ;preserve
   3596 C9B0 CA                                   dex
   3597 C9B1 10 FA                                bpl .0000010          ;next
                                        ;
   3599 C9B3 A2 05                                ldx #s_sfac-1         ;workspace size
                                        ;
   3601 C9B5 74 AF                      .0000020 stz facb,x            ;clear final result
   3602 C9B7 74 B5                                stz facc,x            ;clear scratchpad
   3603 C9B9 CA                                   dex
   3604 C9BA 10 F9                                bpl .0000020
                                        ;
   3606 C9BC E6 BA                                inc facc+s_sfac-s_byte
   3607 C9BE F8                                   sed                   ;select decimal mode
   3608 C9BF A0 1F                                ldy #m_bits-1         ;bits to convert -1
                                        ;
   3610 C9C1 A2 03                      .0000030 ldx #s_pfac-1         ;operand size
   3611 C9C3 18                                   clc                   ;no carry at start
                                        ;
   3613 C9C4 76 A7                      .0000040 ror faca,x            ;grab LS bit in operand
   3614 C9C6 CA                                   dex
   3615 C9C7 10 FB                                bpl .0000040
                                        ;
   3617 C9C9 90 0D                                bcc .0000060          ;LS bit clear
                                        ;
   3619 C9CB 18                                   clc
   3620 C9CC A2 05                                ldx #s_sfac-1
                                        ;
   3622 C9CE B5 AF                      .0000050 lda facb,x            ;partial result
   3623 C9D0 75 B5                                adc facc,x            ;scratchpad
   3624 C9D2 95 AF                                sta facb,x            ;new partial result
   3625 C9D4 CA                                   dex
   3626 C9D5 10 F7                                bpl .0000050
                                        ;
   3628 C9D7 18                                   clc
                                        ;
   3630 C9D8 A2 05                      .0000060 ldx #s_sfac-1
                                        ;
   3632 C9DA B5 B5                      .0000070 lda facc,x            ;scratchpad
   3633 C9DC 75 B5                                adc facc,x            ;double &...
   3634 C9DE 95 B5                                sta facc,x            ;save
   3635 C9E0 CA                                   dex
   3636 C9E1 10 F7                                bpl .0000070
                                        ;
   3638 C9E3 88                                   dey
   3639 C9E4 10 DB                                bpl .0000030          ;next operand bit
                                        ;
   3641 C9E6 D8                                   cld
   3642 C9E7 A2 00                                ldx #0
   3643 C9E9 A0 04                                ldy #s_pfac
                                        ;
   3645 C9EB 68                         .0000080 pla                   ;operand
   3646 C9EC 95 A7                                sta faca,x            ;restore
   3647 C9EE E8                                   inx
   3648 C9EF 88                                   dey
   3649 C9F0 D0 F9                                bne .0000080          ;next
                                        ;
   3651 C9F2 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nybtobin: CONVERT ASCII NYBBLE TO BINARY
                                        ;
   3657 C9F3 20 A2 CC                   nybtobin jsr toupper           ;convert case if necessary
   3658 C9F6 38                                   sec
   3659 C9F7 E9 30                                sbc #'0'              ;change to binary
   3660 C9F9 90 08                                bcc .0000020          ;not a numeral — error
                                        ;
   3662 C9FB C9 0A                                cmp #10
   3663 C9FD 90 03                                bcc .0000010          ;numeral is 0-9
                                        ;
   3665 C9FF E9 07                                sbc #a_hexdec+1       ;10-15 ——> A-F
   3666 CA01 18                                   clc                   ;no conversion error
                                        ;
   3668 CA02 60                         .0000010 rts
                                        ;
   3670 CA03 38                         .0000020 sec                   ;conversion error
   3671 CA04 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;calccnt: COMPUTE BYTE COUNT FROM ADDRESS RANGE
                                        ;
   3677 CA05 20 A2 C9                   calccnt  jsr clrfacb           ;clear accumulator
   3678 CA08 C2 20                    +            .byte $c2,$20
                                        
   3679 CA0A 38                                   sec
   3680 CA0B A5 A4                                lda addrb             ;ending address
   3681 CA0D E5 A0                                sbc addra             ;starting address
   3682 CA0F 85 AF                                sta facb              ;byte count
   3683 CA11 E2 20                    +            .byte $e2,$20
                                        
   3684 CA13 A5 A6                                lda addrb+s_word      ;handle banks
   3685 CA15 E5 A2                                sbc addra+s_word
   3686 CA17 85 B1                                sta facb+s_word
   3687 CA19 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clroper: CLEAR OPERAND
                                        ;
   3693 CA1A DA                         clroper  phx
   3694 CA1B A2 02                                ldx #s_oper-1
                                        ;
   3696 CA1D 74 BB                      .0000010 stz operand,x
   3697 CA1F CA                                   dex
   3698 CA20 10 FB                                bpl .0000010
                                        ;
   3700 CA22 64 CD                                stz eopsize
   3701 CA24 FA                                   plx
   3702 CA25 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpfwsup: FOWARD COPY MEMORY SETUP
                                        ;
   3708 CA26 C2 30                      cpfwsup +         .byte $c2,$30
                                        
   3709 CA28 A2 54                    +            ldx #<opc_mvn
   3709 CA2A 00                       +            .byte >opc_mvn
                                        ;"move next" opcode
   3710 CA2B 80 05                                bra cpsup
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cprvsup: REVERSE COPY MEMORY SETUP
                                        ;
   3716 CA2D C2 30                      cprvsup +         .byte $c2,$30
                                        
   3717 CA2F A2 44                    +            ldx #<opc_mvp
   3717 CA31 00                       +            .byte >opc_mvp
                                        ;"move previous" opcode
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cpsup: COPY MEMORY SETUP
                                        ;
   3723 CA32 48                         cpsup    pha                   ;save banks
   3724 CA33 8A                                   txa                   ;protect...
   3725 CA34 EB                       +            .byte $eb
                                                           ;opcode
   3726 CA35 E2 20                    +            .byte $e2,$20
                                        
   3727 CA37 A2 08                    +            ldx #<(cpcodeee-cpcode-1)
   3727 CA39 00                       +            .byte >(cpcodeee-cpcode-1)
                                        
                                        ;
   3729 CA3A BF                         .0000010 +         .byte $bf
   3729 CA3B 5A CA 00                 +   +         .byte <cpcode,>cpcode,cpcode >> 16
                                     +   
                                        ;transfer copy code to...
   3730 CA3E 95 D2                                sta mcftwork,x        ;to workspace
   3731 CA40 CA                                   dex
   3732 CA41 10 F7                                bpl .0000010
                                        ;
   3734 CA43 EB                       +            .byte $eb
                                                           ;recover opcode &...
   3735 CA44 85 D3                                sta mcftopc           ;set it
   3736 CA46 C2 20                    +            .byte $c2,$20
                                        
   3737 CA48 68                                   pla                   ;get banks &...
   3738 CA49 85 D4                                sta mcftbnk           ;set them
                                         
                                        ; We just dynamically created a routine, so the cache (if one is present) has
                                        ; to be invalidated. Otherwise the processor could execute dead code from the
                                        ; cache. Two lines are invalidated in case the code crosses a line boundary.
                                        ;
                                        ;	acc = 16 bit address to invalidate
                                        ;
                                        ; If there is no cache in the processor then these lines can be deleted.
                                        ;-------------------------------------------------------------------------------
                                           		 CPU	FT832
                                           		 MEM	16
   3750 00CA4B 48                                    pha
   3751 00CA4C A9 D2 00                              lda	#mcftwork
   3752 00CA4F 42 E0 01                     		 cache	#1				; 1= invalidate line identified by address in acc
   3753 00CA52 A9 E2 00                              lda	#mcftwork+16
   3754 00CA55 42 E0 01                     		 cache	#1
   3755 00CA58 68                                    pla
                                        		 CPU	W65C02
   3757 CA59                            		 MEM	8
                                        ;---------------------------------------------
   3759 CA59 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpcode: COPY MEMORY CODE
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	This code is transfered to workspace when a
                                        ;	copy or fill operation is to be performed.
                                        ;	———————————————————————————————————————————
                                        ;
   3770 CA5A 8B                         cpcode +         .byte $8b
                                                           ;must preserve data bank
                                        ;         .rept s_mvinst
   3772 CA5B EA                                     nop                 ;placeholder
   3773 CA5C EA                                     nop
   3774 CA5D EA                                     nop
                                        ;         .endr
   3776 CA5E AB                       +            .byte $ab
                                                           ;restore data bank
   3777 CA5F 5C 26 C1 00                          jml monce             ;return to command executive
   3961 = 0000CA63                      cpcodeee =*                    ;placeholder — do not delete
                                        ;
                                        ;================================================================================
                                        ;
                                        ;decdcnt: DECREMENT DUMP COUNT
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	Preparatory Ops: bytes to process in FACB
                                        ;	                 bytes processed in CHARCNT
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = count = zero
                                        ;	———————————————————————————————————————————
                                        ;
   3794 CA63 E2 20                      decdcnt +         .byte $e2,$20
                                        
   3795 CA65 A9 00                                lda #0
   3796 CA67 EB                       +            .byte $eb
                                                           ;clear .B
   3797 CA68 A5 B1                                lda facb+s_word       ;count MSW
   3798 CA6A C2 20                    +            .byte $c2,$20
                                        
   3799 CA6C 38                                   sec
   3800 CA6D 05 AF                                ora facb              ;count LSW
   3801 CA6F F0 13                                beq .0000020          ;zero, just exit
                                        ;
   3803 CA71 A5 AF                                lda facb
   3804 CA73 E5 C4                                sbc charcnt           ;bytes processed
   3805 CA75 85 AF                                sta facb
   3806 CA77 E2 20                    +            .byte $e2,$20
                                        
   3807 CA79 A5 B1                                lda facb+s_word
   3808 CA7B E9 00                                sbc #0                ;handle borrow
   3809 CA7D 90 04                                bcc .0000010          ;underflow
                                        ;
   3811 CA7F 85 B1                                sta facb+s_word
   3812 CA81 18                                   clc                   ;count > 0
   3813 CA82 60                                   rts
                                        ;
   3815 CA83 38                         .0000010 sec
                                        ;
   3817 CA84 E2 20                      .0000020 +         .byte $e2,$20
                                        
   3818 CA86 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;enddest: GET 2ND & 3RD ADDRESSES FOR COMPARE & TRANSFER
                                        ;
   3824 CA87 20 CB CA                   enddest  jsr facasize          ;check start...
   3825 CA8A C9 04                                cmp #s_dword          ;for range
   3826 CA8C B0 1E                                bcs .0000010          ;out of range — error
                                        ;
   3828 CA8E 20 AD CA                             jsr facaddra          ;store start
   3829 CA91 20 DF CA                             jsr getparm           ;get end
   3830 CA94 B0 16                                bcs .0000010          ;not entered — error
                                        ;
   3832 CA96 20 CB CA                             jsr facasize          ;check end...
   3833 CA99 C9 04                                cmp #s_dword          ;for range
   3834 CA9B B0 0F                                bcs .0000010          ;out of range — error
                                        ;
   3836 CA9D 20 B7 CA                             jsr facaddrb          ;store end
   3837 CAA0 20 DF CA                             jsr getparm           ;get destination
   3838 CAA3 B0 07                                bcs .0000010          ;not entered — error
                                        ;
   3840 CAA5 20 CB CA                             jsr facasize          ;check destination...
   3841 CAA8 C9 04                                cmp #s_dword          ;for range
   3842 CAAA 90 15                                bcc facaoper          ;store dest address
                                        ;
   3844 CAAC 60                         .0000010 rts                   ;exit w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddra: COPY FACA TO ADDRA
                                        ;
   3850 CAAD A2 02                      facaddra ldx #s_xword-1
                                        ;
   3852 CAAF B5 A7                      .0000010 lda faca,x
   3853 CAB1 95 A0                                sta addra,x
   3854 CAB3 CA                                   dex
   3855 CAB4 10 F9                                bpl .0000010
                                        ;
   3857 CAB6 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddrb: COPY FACA TO ADDRB
                                        ;
   3863 CAB7 A2 02                      facaddrb ldx #s_xword-1
                                        ;
   3865 CAB9 B5 A7                      .0000010 lda faca,x
   3866 CABB 95 A4                                sta addrb,x
   3867 CABD CA                                   dex
   3868 CABE 10 F9                                bpl .0000010
                                        ;
   3870 CAC0 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaoper: COPY FACA TO OPERAND
                                        ;
   3876 CAC1 A2 02                      facaoper ldx #s_oper-1
                                        ;
   3878 CAC3 B5 A7                      .0000010 lda faca,x
   3879 CAC5 95 BB                                sta operand,x
   3880 CAC7 CA                                   dex
   3881 CAC8 10 F9                                bpl .0000010
                                        ;
   3883 CACA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facasize: REPORT OPERAND SIZE IN FACA
                                        ;
                                        ;	——————————————————————————————————————————
                                        ;	Preparatory Ops: operand in FACA
                                        ;
                                        ;	Returned Values: .A: s_byte  (1)
                                        ;	                     s_word  (2)
                                        ;	                     s_xword (3)
                                        ;	                     s_dword (4)
                                        ;
                                        ;	Notes: 1) This function will always report
                                        ;	          a non-zero result.
                                        ;	——————————————————————————————————————————
                                        ;
   3901 CACB E2 30                      facasize +         .byte $e2,$30
                                        
   3902 CACD A2 03                                ldx #s_dword-1
                                        ;
   3904 CACF B5 A7                      .0000010 lda faca,x            ;get byte
   3905 CAD1 D0 03                                bne .0000020          ;done
                                        ;
   3907 CAD3 CA                                   dex
   3908 CAD4 D0 F9                                bne .0000010          ;next byte
                                        ;
   3910 CAD6 E8                         .0000020 inx                   ;count=index+1
   3911 CAD7 8A                                   txa
   3912 CAD8 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getbyte: GET A BYTE FROM MEMORY
                                        ;
   3918 CAD9 A7 A0                      getbyte +         .byte $a7,addra
                                        ;get a byte
   3919 CADB 80 3F                                bra incaddra          ;bump address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getparm: GET A PARAMETER
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops: null-terminated input in IBUFFER
                                        ;
                                        ;	Returned Values: .A: chars in converted parameter
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = no parameter entered
                                        ;	—————————————————————————————————————————————————
                                        ;
   3934 CADD C6 BF                      getparmr dec ibufidx           ;reread previous char
                                        ;
   3936 CADF 5A                         getparm  phy                   ;preserve
   3937 CAE0 20 34 C8                             jsr ascbin            ;convert parameter to binary
   3938 CAE3 B0 1C                                bcs .0000040          ;conversion error
                                        ;
   3940 CAE5 20 CC CB                             jsr getcharr          ;reread last char
   3941 CAE8 D0 08                                bne .0000010          ;not end-of-input
                                        ;
   3943 CAEA C6 BF                                dec ibufidx           ;reindex to terminator
   3944 CAEC A5 C4                                lda charcnt           ;get chars processed so far
   3945 CAEE F0 0C                                beq .0000030          ;none
                                        ;
   3947 CAF0 D0 08                                bne .0000020          ;some
                                        ;
   3949 CAF2 C9 20                      .0000010 cmp #a_blank          ;recognized delimiter
   3950 CAF4 F0 04                                beq .0000020          ;end of parameter
                                        ;
   3952 CAF6 C9 2C                                cmp #','              ;recognized delimiter
   3953 CAF8 D0 07                                bne .0000040          ;unknown delimter
                                        ;
   3955 CAFA 18                         .0000020 clc
   3956 CAFB 24                                   .byte bitzp           ;skip SEC below
                                        ;
   3958 CAFC 38                         .0000030 sec
   3959 CAFD 7A                                   ply                   ;restore
   3960 CAFE A5 C4                                lda charcnt           ;get count
   3961 CB00 60                                   rts                   ;done
                                        ;
   3963 CB01                            .0000040 
                                        ;.rept 3               ;clean up stack
   3965 CB01 68                          			pla
   3966 CB02 68                          			pla
   3967 CB03 68                                     pla
                                        ;        .endr
   3969 CB04 4C 65 C1                             jmp monerr            ;abort w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nxtaddra: TEST & INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR NXTADDRA
                                        ;
                                        ;	Exit registers: .A: used
                                        ;	                .B: used
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    |||||||+———> 0: ADDRA < ADDRB
                                        ;	                    |||||||      1: ADDRA >= ADDRB
                                        ;	                    ||||||+————> undefined
                                        ;	                    |||+++—————> entry value
                                        ;	                    ||+————————> 1
                                        ;	                    ++—————————> undefined
                                        ;	——————————————————————————————————————————————————
                                        ;
   3995 CB07 E2 20                      nxtaddra +         .byte $e2,$20
                                        
   3996 CB09 A5 A2                                lda addra+s_word      ;bits 16-23
   3997 CB0B C5 A6                                cmp addrb+s_word
   3998 CB0D 90 0D                                bcc incaddra          ;increment
                                        ;
   4000 CB0F D0 0A                                bne .0000010          ;don't increment
                                        ;
   4002 CB11 C2 20                    +            .byte $c2,$20
                                        
   4003 CB13 A5 A0                                lda addra             ;bits 0-15
   4004 CB15 C5 A4                                cmp addrb             ;condition flags
   4005 CB17 E2 20                    +            .byte $e2,$20
                                        
   4006 CB19 90 01                                bcc incaddra          ;increment
                                        ;
   4008 CB1B 60                         .0000010 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incaddra: INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR INCADDRA
                                        ;
                                        ;	Exit registers: .A: entry value
                                        ;	                .B: entry value
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    ++++++++———> entry value
                                        ;	——————————————————————————————————————————————————
                                        ;
   4029 CB1C 08                         incaddra php
   4030 CB1D C2 20                    +            .byte $c2,$20
                                        
   4031 CB1F E6 A0                                inc addra             ;bump bits 0-15
   4032 CB21 D0 04                                bne .0000010
                                        ;
   4034 CB23 E2 20                    +            .byte $e2,$20
                                        
   4035 CB25 E6 A2                                inc addra+s_word      ;bump bits 16-23
                                        ;
   4037 CB27 28                         .0000010 plp
   4038 CB28 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incoper: INCREMENT OPERAND ADDRESS
                                        ;
   4044 CB29 18                         incoper  clc
   4045 CB2A 08                                   php
   4046 CB2B C2 30                    +            .byte $c2,$30
                                        
   4047 CB2D 48                                   pha
   4048 CB2E E6 BB                                inc operand           ;handle base address
   4049 CB30 D0 06                                bne .0000010
                                        ;              
   4051 CB32 E2 20                    +            .byte $e2,$20
                                        
   4052 CB34 E6 BD                                inc operand+s_word    ;handle bank
   4053 CB36 C2 20                    +            .byte $c2,$20
                                        
                                        ;
   4055 CB38 68                         .0000010 pla
   4056 CB39 28                                   plp
   4057 CB3A 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;instdata: GET INSTRUCTION SIZE & ADDRESSING MODE DATA
                                        ;
                                        ;	——————————————————————————————————
                                        ;	Preparatory Ops: .X: 65C816 opcode
                                        ;
                                        ;	Returned Values: .A: mode flags
                                        ;	                 .X: operand size
                                        ;	                 .Y: mode index
                                        ;	——————————————————————————————————
                                        ;
   4071 CB3B E2 30                      instdata +         .byte $e2,$30
                                        
   4072 CB3D BD B7 CE                             lda mnetabam,x        ;addressing mode data
   4073 CB40 48                                   pha                   ;save mode flag bits
   4074 CB41 48                                   pha                   ;save size data
   4075 CB42 29 0F                                and #amodmask         ;extract mode index &...
   4076 CB44 A8                                   tay                   ;save
   4077 CB45 68                                   pla                   ;recover data
   4078 CB46 29 30                                and #opsmask          ;mask mode fields &...
                                        ;         .rept n_opslsr        ;extract operand size
   4080 CB48 4A                                     lsr
   4081 CB49 4A                                     lsr
   4082 CB4A 4A                                     lsr
   4083 CB4B 4A                                     lsr
                                        ;         .endr
   4085 CB4C AA                                   tax                   ;operand size
   4086 CB4D 68                                   pla                   ;recover mode flags
   4087 CB4E 29 C0                                and #vopsmask         ;discard mode & size fields
   4088 CB50 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;offtarg: CONVERT BRANCH OFFSET TO TARGET ADDRESS
                                        ;
                                        ;	———————————————————————————————————————————————
                                        ;	Preparatory Ops:    ADDRA: base address
                                        ;	                 INSTSIZE: instruction size
                                        ;	                  OPERAND: offset
                                        ;
                                        ;	Returned Values:  OPERAND: target address (L/H)
                                        ;	                       .A: used
                                        ;	                       .X: entry value
                                        ;                              .Y: entry value
                                        ;	———————————————————————————————————————————————
                                        ;
   4105 CB51 C2 20                      offtarg +         .byte $c2,$20
                                        
   4106 CB53 A5 A0                                lda addra             ;base address
   4107 CB55 E2 20                    +            .byte $e2,$20
                                        
   4108 CB57 46 C6                                lsr instsize          ;bit 0 will be set if...
   4109 CB59 B0 07                                bcs .0000010          ;a long branch
                                        ;
   4111 CB5B 24 BB                                bit operand           ;short forward or backward?
   4112 CB5D 10 03                                bpl .0000010          ;forward
                                        ;
   4114 CB5F EB                       +            .byte $eb
                                                           ;expose address MSB
   4115 CB60 3A                                   dea                   ;back a page
   4116 CB61 EB                       +            .byte $eb
                                                           ;expose address LSB
                                        ;
   4118 CB62 C2 20                      .0000010 +         .byte $c2,$20
                                        
   4119 CB64 18                                   clc
   4120 CB65 65 BB                                adc operand           ;calculate target address
   4121 CB67 85 BB                                sta operand           ;new operand
   4122 CB69 E2 20                    +            .byte $e2,$20
                                        
   4123 CB6B A9 03                                lda #s_xword
   4124 CB6D 85 C6                                sta instsize          ;effective instruction size
   4125 CB6F 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;setxaddr: SET EXECUTION ADDRESS
                                        ;
   4131 CB70 B0 13                      setxaddr bcs .0000010          ;no address given
                                        ;
   4133 CB72 20 CB CA                             jsr facasize          ;check address...
   4134 CB75 C9 04                                cmp #s_dword          ;range
   4135 CB77 B0 0D                                bcs .0000020          ;out of range
                                        ;
   4137 CB79 C2 20                    +            .byte $c2,$20
                                        
   4138 CB7B A5 A7                                lda faca              ;execution address
   4139 CB7D 85 86                                sta reg_pcx           ;set new PC value
   4140 CB7F E2 20                    +            .byte $e2,$20
                                        
   4141 CB81 A5 A9                                lda faca+s_word
   4142 CB83 85 88                                sta reg_pbx           ;set new PB value
                                        ;
   4144 CB85 18                         .0000010 clc                   ;no error
                                        ;
   4146 CB86 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;targoff: CONVERT BRANCH TARGET ADDRESS TO BRANCH OFFSET                   
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops:   ADDRA: instruction address
                                        ;	                 OPERAND: target address
                                        ;
                                        ;	Returned Values: OPERAND: computed offset
                                        ;	                      .A: effective operand size
                                        ;	                      .X: entry value
                                        ;                             .Y: entry value
                                        ;	                      .C: 1 = branch out of range
                                        ;
                                        ;	Execution notes: ADDRB is set to the branch base
                                        ;	                 address.
                                        ;	—————————————————————————————————————————————————
                                        ;
   4166 CB87 64 C7                      targoff  stz instsize+s_byte   ;always zero
   4167 CB89 A5 C6                                lda instsize          ;instruction size will tell...
   4168 CB8B 4A                                   lsr                   ;if long or short branch
                                        ;
                                        ;—————————————————————————————————————————————————
   4378 = 000000BA                      .btype   =facc+5               ;branch type flag
                                        ;—————————————————————————————————————————————————
                                        ;
   4174 CB8C 66 BA                                ror .btype            ;set branch type...
                                        ;
                                        ;	x0000000
                                        ;	|
                                        ;	+——————————> 0: short
                                        ;	             1: long
                                        ;
   4181 CB8E C2 20                    +            .byte $c2,$20
                                        
   4182 CB90 18                                   clc
   4183 CB91 A5 A0                                lda addra             ;instruction address
   4184 CB93 65 C6                                adc instsize          ;instruction size
   4185 CB95 85 A4                                sta addrb             ;base address
   4186 CB97 38                                   sec
   4187 CB98 A5 BB                                lda operand           ;target address
   4188 CB9A E5 A4                                sbc addrb             ;base address
   4189 CB9C 85 BB                                sta operand           ;offset
   4190 CB9E E2 20                    +            .byte $e2,$20
                                        
   4191 CBA0 90 15                                bcc .0000040          ;backward branch
                                        ;
   4193 CBA2 24 BA                                bit .btype            ;check branch range
   4194 CBA4 30 0A                                bmi .0000020          ;long
                                        ;
                                        ;
                                        ;	process short forward branch...
                                        ;
   4199 CBA6 EB                       +            .byte $eb
                                                           ;offset MSB should be zero
   4200 CBA7 D0 21                                bne .0000060          ;it isn't — out of range
                                        ;
   4202 CBA9 EB                       +            .byte $eb
                                                           ;offset LSB should be $00-$7F
   4203 CBAA 30 1E                                bmi .0000060          ;it isn't — out of range
                                        ;
   4205 CBAC A9 01                      .0000010 lda #s_byte           ;final instruction size
   4206 CBAE 18                                   clc                   ;branch in range
   4207 CBAF 60                                   rts
                                        ;
                                        ;
                                        ;	process long forward branch...
                                        ;
   4212 CBB0 EB                         .0000020 +         .byte $eb
                                                           ;offset MSB should be positive
   4213 CBB1 30 17                                bmi .0000060          ;it isn't — branch out of range
                                        ;
   4215 CBB3 A9 02                      .0000030 lda #s_word
   4216 CBB5 18                                   clc
   4217 CBB6 60                                   rts
                                        ;
                                        ;
                                        ;	process backward branch...
                                        ;
   4222 CBB7 24 BA                      .0000040 bit .btype            ;long or short?
   4223 CBB9 30 0C                                bmi .0000050          ;long
                                        ;
                                        ;
                                        ;	process short backward branch...
                                        ;
   4228 CBBB EB                       +            .byte $eb
                                                           ;offset MSB should be negative
   4229 CBBC 10 0C                                bpl .0000060          ;it isn't — out of range
                                        ;
   4231 CBBE 49 FF                                eor #%11111111        ;complement offset MSB 2s 
   4232 CBC0 D0 08                                bne .0000060          ;out of range
                                        ;
   4234 CBC2 EB                       +            .byte $eb
                                                           ;offset LSB should be $80-$FF
   4235 CBC3 30 E7                                bmi .0000010          ;it is — branch in range
                                        ;
   4237 CBC5 80 03                                bra .0000060          ;branch out of range
                                        ;
                                        ;
                                        ;	process long backward branch...
                                        ;
   4242 CBC7 EB                         .0000050 +         .byte $eb
                                                           ;offset MSB should be negative
   4243 CBC8 30 E9                                bmi .0000030          ;it is — branch in range
                                        ;
   4245 CBCA 38                         .0000060 sec                   ;range error
   4246 CBCB 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharr: GET PREVIOUS INPUT BUFFER CHARACTER
                                        ;
   4252 CBCC C6 BF                      getcharr dec ibufidx           ;move back a char
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getchar: GET A CHARACTER FROM INPUT BUFFER
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops : none
                                        ;
                                        ;	Register Returns: .A: character or <NUL>
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> entry value
                                        ;	           ||||||+————> 1: <NUL> gotten
                                        ;	           |||||+—————> entry value
                                        ;	           ||||+——————> entry value
                                        ;	           |||+———————> entry value
                                        ;	           ||+————————> entry value
                                        ;	           |+—————————> not defined
                                        ;	           +——————————> not defined
                                        ;	——————————————————————————————————————————————
                                        ;
   4278 CBCE DA                         getchar  phx
   4279 CBCF 5A                                   phy
   4280 CBD0 08                                   php                   ;save register sizes
   4281 CBD1 E2 30                    +            .byte $e2,$30
                                                        ;force 8 bits
   4282 CBD3 A6 BF                                ldx ibufidx           ;buffer index
   4283 CBD5 BD 00 02                             lda ibuffer,x         ;get char
   4284 CBD8 E6 BF                                inc ibufidx           ;bump index
   4285 CBDA 28                                   plp                   ;restore register widths
   4286 CBDB 7A                                   ply
   4287 CBDC FA                                   plx
                                        ; Changed the following to XBA instruction which seems to work as well.
                                        ; XBA doesn't access the stack memory saving a data memory access,
                                        ; and hence is faster.
   4291 CBDD EB                       +            .byte $eb
                                        		;	pha                   ;condition...
   4292 CBDE EB                       +            .byte $eb
                                        		;   pla                   ;.Z
   4293 CBDF 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getpat: GET PATTERN FOR MEMORY CHANGE or SEARCH
                                        ;
                                        ;	—————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated pattern in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: pattern length if entered
                                        ;	                 .C: 0 = pattern valid
                                        ;	                     1 = exception:
                                        ;	                 .N  0 = no pattern entered
                                        ;	                     1 = evaluation error
                                        ;
                                        ;	Notes: 1) If pattern is preceded by "'" the following
                                        ;	          characters are interpreted as ASCII.
                                        ;	       2) A maximum of 32 bytes or characters is
                                        ;	          accepted.  Excess input will be discarded.
                                        ;	—————————————————————————————————————————————————————
                                        ;
   4316 CBE0 64 CB                      getpat   stz status            ;clear pattern type indicator
   4317 CBE2 A0 00                                ldy #0                ;pattern index
   4318 CBE4 20 CC CB                             jsr getcharr          ;get last char
   4319 CBE7 F0 3C                                beq .0000070          ;EOS
                                        ;
   4321 CBE9 A6 BF                                ldx ibufidx           ;current buffer index
   4322 CBEB 20 2C CC                             jsr getcharw          ;get next
   4323 CBEE F0 35                                beq .0000070          ;EOS
                                        ;
   4325 CBF0 C9 27                                cmp #''''			; *** watch syntax here, the following line of code was omitted when only ''' was present
   4326 CBF2 D0 04                                bne .0000010          ;not ASCII input
                                        ;
   4328 CBF4 66 CB                                ror status            ;condition flag
   4329 CBF6 80 12                                bra .0000030          ;balance of input is ASCII
                                        ;
   4331 CBF8 86 BF                      .0000010 stx ibufidx           ;restore buffer index
                                        ;
   4333 CBFA 20 DF CA                   .0000020 jsr getparm           ;evaluate numeric pattern
   4334 CBFD B0 21                                bcs .0000060          ;done w/pattern
                                        ;
   4336 CBFF 20 CB CA                             jsr facasize          ;size
   4337 CC02 C9 02                                cmp #s_word
   4338 CC04 B0 1F                                bcs .0000070          ;not a byte — error
                                        ;
   4340 CC06 A5 A7                                lda faca              ;get byte &...
   4341 CC08 80 05                                bra .0000040          ;store
                                        ;
   4343 CC0A 20 CE CB                   .0000030 jsr getchar           ;get ASCII char
   4344 CC0D F0 11                                beq .0000060          ;done w/pattern
                                        ;
   4346 CC0F C0 20                      .0000040 cpy #s_auxbuf         ;pattern buffer full?
   4347 CC11 F0 0A                                beq .0000050          ;yes
                                        ;
   4349 CC13 99 51 02                             sta auxbuf,y          ;store pattern
   4350 CC16 C8                                   iny
   4351 CC17 24 CB                                bit status
   4352 CC19 10 DF                                bpl .0000020          ;get next numeric value
                                        ;
   4354 CC1B 80 ED                                bra .0000030          ;get next ASCII char
                                        ;
   4356 CC1D 20 0D C8                   .0000050 jsr alert             ;excess input
                                        ;
   4358 CC20 84 BE                      .0000060 sty auxbufix          ;save pattern size
   4359 CC22 98                                   tya                   ;condition .Z
   4360 CC23 18                                   clc                   ;pattern valid
   4361 CC24 60                                   rts
                                        ;
                                        ;
                                        ;	no pattern entered...
                                        ;
   4366 CC25 C2 80                      .0000070 +         .byte $c2,%10000000
                                        
   4367 CC27 38                                   sec
   4368 CC28 60                                   rts
                                        ;
                                        ;
                                        ;	evaluation error...
                                        ;
   4373 CC29 E2 81                      .0000080 +         .byte $e2,%10000001
                                        
   4374 CC2B 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharw: GET FROM INPUT BUFFER, DISCARDING WHITESPACE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;
                                        ;	Notes: Whitespace is defined as a blank ($20) or a
                                        ;	       horizontal tab ($09).
                                        ;	——————————————————————————————————————————————————
                                        ;
   4392 CC2C 20 CE CB                   getcharw jsr getchar           ;get from buffer
   4393 CC2F F0 08                                beq .0000010          ;EOI
                                        ;
   4395 CC31 C9 20                                cmp #' '
   4396 CC33 F0 F7                                beq getcharw          ;discard whitespace
                                        ;
   4398 CC35 C9 09                                cmp #a_ht             ;also whitespace
   4399 CC37 F0 F3                                beq getcharw
                                        ;
   4401 CC39 18                         .0000010 clc
   4402 CC3A 60                                   rts  
                                        ;
                                        ;================================================================================
                                        ;
                                        ;input: INTERACTIVE INPUT FROM CONSOLE CHANNEL
                                        ;
                                        ;	———————————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Zero IBUFIDX or load IBUFFER with default
                                        ;	                 input & set IBUFIDX to the number of chars
                                        ;	                 loaded into the buffer.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: characters entered
                                        ;	                 .Y: used
                                        ;
                                        ;	Example: STZ IBUFIDX
                                        ;	         JSR INPUT
                                        ;
                                        ;	Notes: Input is collected in IBUFFER & is null-terminated.
                                        ;	       IBUFIDX is reset to zero upon exit.
                                        ;	———————————————————————————————————————————————————————————
                                        ;
   4424 CC3B                            input:
   4425 CC3B A6 BF                       	    ldx ibufidx
   4426 CC3D 9E 00 02                             stz ibuffer,x         ;be sure buffer is terminated
   4427 CC40 20 6E C7                             jsr dpyibuf           ;print default input if any
   4428 CC43 F4                       +            .byte $f4
   4428 CC44 14 D0                    +            .word dc_cn
                                        
   4429 CC46 20 19 C8                             jsr sprint            ;enable cursor
   4430 CC49 A6 BF                                ldx ibufidx           ;starting buffer index
                                        ;
                                        ;
                                        ;	main input loop...
                                        ;
   4435 CC4B                               .0000010 CPU FT832
   4436 00CC4B 42 20 00 FE FC               		 jcr getcha,biosctx            ;poll for input
                                        		 CPU	W65C02
   4438 CC50 90 02                                bcc .0000020          ;got something
                                        ;
                                        ;         jsr	$F409          ;wait 'til any IRQ &... (Reschedule tasks)
   4441 CC52 80 F7                                bra .0000010          ;try again
                                        ;
   4443 CC54                            .0000020
   4444 CC54 C9 7F                       		cmp #a_del            ;above ASCII range?
   4445 CC56 B0 F3                                bcs .0000010          ;yes, ignore
                                        ;
   4447 CC58 C9 09                                cmp #a_ht             ;horizontal tab?
   4448 CC5A D0 02                                bne .0000030          ;no
                                        ;
   4450 CC5C A9 20                                lda #a_blank          ;replace <HT> w/blank
                                        ;
   4452 CC5E C9 20                      .0000030 cmp #a_blank          ;control char?
   4453 CC60 90 12                                bcc .0000050          ;yes
                                        ;
                                        ;
                                        ;	process QWERTY character...
                                        ;
   4458 CC62 E0 50                                cpx #s_ibuf           ;room in buffer?
   4459 CC64 B0 05                                bcs .0000040          ;no
                                        ;
   4461 CC66 9D 00 02                             sta ibuffer,x         ;store char
   4462 CC69 E8                                   inx                   ;bump index
   4463 CC6A 2C                                   .byte bitabs          ;echo char
                                        ;
   4465 CC6B A9 07                      .0000040 lda #a_bel            ;alert user
                                           		 cpu FT832
   4467 00CC6D 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   4469 CC72 80 D7                                bra .0000010          ;get some more
                                        ;
                                        ;
                                        ;	process carriage return...
                                        ;
   4474 CC74 C9 0D                      .0000050 cmp #a_cr             ;carriage return?
   4475 CC76 D0 0E                                bne .0000060          ;no
                                        ;
   4477 CC78 DA                                   phx                   ;protect input count
   4478 CC79 F4                       +            .byte $f4
   4478 CC7A 18 D0                    +            .word dc_co
                                        
   4479 CC7C 20 19 C8                             jsr sprint            ;cursor off
   4480 CC7F FA                                   plx                   ;recover input count
   4481 CC80 9E 00 02                             stz ibuffer,x         ;terminate input &...
   4482 CC83 64 BF                                stz ibufidx           ;reset buffer index
   4483 CC85 60                                   rts                   ;done
                                        ;
                                        ;
                                        ;	process backspace...
                                        ;
   4488 CC86 C9 08                      .0000060 cmp #a_bs             ;backspace?
   4489 CC88 D0 C1                                bne .0000010          ;no
                                        ;
   4491 CC8A 8A                                   txa
   4492 CC8B F0 BE                                beq .0000010          ;no input, ignore <BS>
                                        ;
   4494 CC8D CA                                   dex                   ;1 less char
   4495 CC8E DA                                   phx                   ;preserve count
   4496 CC8F 20 C1 C7                             jsr gendbs            ;destructive backspace
   4497 CC92 FA                                   plx                   ;restore count
   4498 CC93 80 B6                                bra .0000010          ;get more input
                                        ;
                                        ;================================================================================
                                        ;
                                        ;lodbnk: LOAD SOURCE & DESTINATION BANKS
                                        ;
   4504 CC95 E2 20                      lodbnk +         .byte $e2,$20
                                        
   4505 CC97 A5 BD                                lda operand+s_word    ;destination bank
   4506 CC99 EB                       +            .byte $eb
                                                           ;make it MSB
   4507 CC9A A5 A2                                lda addra+s_word      ;source bank is LSB
   4508 CC9C 60                                   rts
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;getcharc: GET A CHARACTER FROM INPUT BUFFER & CONVERT CASE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;	——————————————————————————————————————————————————
                                        ;
   4523 CC9D 20 CE CB                   getcharc jsr getchar           ;get from buffer
   4524 CCA0 F0 0C                                beq touppera          ;just return
                                        ;
                                        ;================================================================================
                                        ;
                                        ;toupper: FORCE CHARACTER TO UPPER CASE
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .A: character to convert
                                        ;
                                        ;	Register Returns: .A: converted character
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: no change
                                        ;
                                        ;	Notes: 1) This subroutine has no effect on char-
                                        ;	          acters that are not alpha.
                                        ;	————————————————————————————————————————————————
                                        ;
   4544 CCA2 08                         toupper  php                   ;protect flags
   4545 CCA3 C9 61                                cmp #a_asclcl         ;check char range
   4546 CCA5 90 06                                bcc .0000010          ;not LC alpha
                                        ;
   4548 CCA7 C9 7B                                cmp #a_asclch+s_byte
   4549 CCA9 B0 02                                bcs .0000010          ;not LC alpha
                                        ;
   4551 CCAB 29 5F                                and #a_lctouc         ;force to UC
                                        ;
   4553 CCAD 28                         .0000010 plp                   ;restore flags
                                        ;
   4555 CCAE 60                         touppera rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;teststop: TEST FOR STOP KEY
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops: none
                                        ;
                                        ;	Returned Values: .A: detected keypress, if any
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: normal key detected
                                        ;	           |||||||      1: <STOP> detected
                                        ;	           +++++++————> not defined
                                        ;
                                        ;	Example: jsr teststop
                                        ;	         bcs stopped
                                        ;
                                        ;	Notes: The symbol STOPKEY defines the ASCII
                                        ;	       value of the "stop key."
                                        ;	——————————————————————————————————————————————
                                        ;
   4581 CCAF                            teststop 
                                            		CPU	TF832
   4583 00000CCAF                           		jcr getcha,biosctx            ;poll console
                                        		CPU	W65C02
   4585 CCAF B0 04                                bcs .0000010          ;no input
                                        ;
   4587 CCB1 C9 03                                cmp #stopkey          ;stop key pressed?
   4588 CCB3 F0 01                                beq .0000020          ;yes
                                        ;
   4590 CCB5 18                         .0000010 clc
                                        ;
   4592 CCB6 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;COMMAND PROCESSING DATA TABLES
                                        ;
                                        ;
                                        ;	monitor commands...
                                        ;
   4601 CCB7 41                         mpctab   .byte "A"             ;assemble code
   4602 CCB8 43                                   .byte "C"             ;compare memory ranges
   4603 CCB9 44                                   .byte "D"             ;disassemble code
   4604 CCBA 46                                   .byte "F"             ;fill memory
   4605 CCBB 47                                   .byte "G"             ;execute code
   4606 CCBC 48                                   .byte "H"             ;search memory
   4607 CCBD 4A                                   .byte "J"             ;execute code as subroutine
   4608 CCBE 4D                                   .byte "M"             ;dump memory range
   4609 CCBF 52                                   .byte "R"             ;dump registers
   4610 CCC0 54                                   .byte "T"             ;copy memory range
   4611 CCC1 58                                   .byte "X"             ;exit from monitor
   4612 CCC2 3E                                   .byte ">"             ;change memory
   4613 CCC3 3B                                   .byte ";"             ;change registers
   4840 = 0000000D                      n_mpctab =*-mpctab             ;entries in above table
                                        ;
                                        ;
                                        ;	monitor command jump table...
                                        ;
   4619 CCC4 6B C1                      mpcextab .word monasc-s_byte   ; A  assemble code
   4620 CCC6 2F C4                                .word moncmp-s_byte   ; C  compare memory ranges
   4621 CCC8 49 C3                                .word mondsc-s_byte   ; D  disassemble code
   4622 CCCA 00 C5                                .word monfil-s_byte   ; F  fill memory
   4623 CCCC 9D C3                                .word monjmp-s_byte   ; G  execute code
   4624 CCCE 66 C5                                .word monhnt-s_byte   ; H  search memory
   4625 CCD0 CE C3                                .word monjsr-s_byte   ; J  execute code as subroutine
   4626 CCD2 AE C4                                .word mondmp-s_byte   ; M  dump memory range
   4627 CCD4 7E C0                                .word monreg-s_byte   ; R  dump registers
   4628 CCD6 5D C4                                .word moncpy-s_byte   ; T  copy memory range
   4629 CCD8 17 C6                                .word monxit-s_byte   ; X  exit from monitor
   4630 CCDA 04 C4                                .word monchm-s_byte   ; >  change memory
   4631 CCDC DC C5                                .word monchr-s_byte   ; ;  change registers
                                        ;
                                        ;
                                        ;	number conversion...
                                        ;        
   4636 CCDE 10 0A 08 02                basetab  .byte 16,10,8,2       ;supported number bases
   4637 CCE2 04 03 03 01                bitsdtab .byte 4,3,3,1         ;bits per binary digit
   4638 CCE6 04 04 03 01                bitsntab .byte 4,4,3,1         ;bits per ASCII character
   4639 CCEA 03 02 09 02                lzsttab  .byte 3,2,9,2         ;leading zero suppression thresholds
   4640 CCEE 0C 0C 10 30                numstab  .byte 12,12,16,48     ;bin to ASCII conversion numerals
   4641 CCF2 24                         radxtab  .byte c_hex           ;hexadecimal radix
   4642 CCF3 2B                                   .byte c_dec           ;decimal radix
   4643 CCF4 40                                   .byte c_oct           ;octal radix
   4644 CCF5 25                                   .byte c_bin           ;binary radix
   4871 = 00000004                      n_radix  =*-radxtab            ;number of recognized radices
                                        ;
                                        ;
                                        ;	shadow MPU register sizes...
                                        ;
   4650 CCF6 02                         rcvltab  .byte s_mpupbx+s_byte ; PB
   4651 CCF7 03                                   .byte s_mpupcx+s_byte ; PC
   4652 CCF8 02                                   .byte s_mpusrx+s_byte ; SR
   4653 CCF9 03                                   .byte s_word+s_byte   ; .C
   4654 CCFA 03                                   .byte s_word+s_byte   ; .X
   4655 CCFB 03                                   .byte s_word+s_byte   ; .Y
   4656 CCFC 03                                   .byte s_mpuspx+s_byte ; SP
   4657 CCFD 03                                   .byte s_mpudpx+s_byte ; DP
   4658 CCFE 02                                   .byte s_mpudbx+s_byte ; DB
   4885 = 00000009                      n_regchv =*-rcvltab            ;total shadow registers
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER DATA TABLES
                                        ;
                                        ;
                                        ;	numerically sorted & encoded W65C816S mnemonics...
                                        ;
   4668 CCFF F2 10                      mnetab   .word mne_xba         ;  0 — XBA
   4669 CD01 5A 11                                .word mne_lda         ;  1 — LDA
   4670 CD03 A2 11                                .word mne_pea         ;  2 — PEA
   4671 CD05 62 12                                .word mne_pha         ;  3 — PHA
   4672 CD07 62 13                                .word mne_pla         ;  4 — PLA
   4673 CD09 C6 14                                .word mne_bra         ;  5 — BRA
   4674 CD0B E0 14                                .word mne_ora         ;  6 — ORA
   4675 CD0D 68 15                                .word mne_sta         ;  7 — STA
   4676 CD0F 6A 16                                .word mne_txa         ;  8 — TXA
   4677 CD11 AA 16                                .word mne_tya         ;  9 — TYA
   4678 CD13 62 1A                                .word mne_phb         ; 10 — PHB
   4679 CD15 62 1B                                .word mne_plb         ; 11 — PLB
   4680 CD17 EA 1C                                .word mne_trb         ; 12 — TRB
   4681 CD19 2A 1D                                .word mne_tsb         ; 13 — TSB
   4682 CD1B E8 20                                .word mne_sbc         ; 14 — SBC
   4683 CD1D 06 21                                .word mne_bcc         ; 15 — BCC
   4684 CD1F 44 21                                .word mne_adc         ; 16 — ADC
   4685 CD21 6A 21                                .word mne_tdc         ; 17 — TDC
   4686 CD23 8A 21                                .word mne_dec         ; 18 — DEC
   4687 CD25 A8 21                                .word mne_sec         ; 19 — SEC
   4688 CD27 48 23                                .word mne_clc         ; 20 — CLC
   4689 CD29 D4 23                                .word mne_inc         ; 21 — INC
   4690 CD2B 2A 25                                .word mne_tsc         ; 22 — TSC
   4691 CD2D C6 25                                .word mne_bvc         ; 23 — BVC
   4692 CD2F 2A 29                                .word mne_tcd         ; 24 — TCD
   4693 CD31 A8 29                                .word mne_sed         ; 25 — SED
   4694 CD33 62 2A                                .word mne_phd         ; 26 — PHD
   4695 CD35 48 2B                                .word mne_cld         ; 27 — CLD
   4696 CD37 62 2B                                .word mne_pld         ; 28 — PLD
   4697 CD39 C4 2B                                .word mne_and         ; 29 — AND
   4698 CD3B 32 31                                .word mne_xce         ; 30 — XCE
   4699 CD3D C6 33                                .word mne_bne         ; 31 — BNE
   4700 CD3F B0 50                                .word mne_wai         ; 32 — WAI
   4701 CD41 A2 51                                .word mne_pei         ; 33 — PEI
   4702 CD43 A8 51                                .word mne_sei         ; 34 — SEI
   4703 CD45 48 53                                .word mne_cli         ; 35 — CLI
   4704 CD47 86 53                                .word mne_bmi         ; 36 — BMI
   4705 CD49 66 55                                .word mne_rti         ; 37 — RTI
   4706 CD4B 62 62                                .word mne_phk         ; 38 — PHK
   4707 CD4D C6 64                                .word mne_brk         ; 39 — BRK
   4708 CD4F 96 6B                                .word mne_jml         ; 40 — JML
   4709 CD51 26 6C                                .word mne_rol         ; 41 — ROL
   4710 CD53 46 6C                                .word mne_bpl         ; 42 — BPL
   4711 CD55 C6 6C                                .word mne_brl         ; 43 — BRL
   4712 CD57 04 6D                                .word mne_asl         ; 44 — ASL
   4713 CD59 16 6D                                .word mne_jsl         ; 45 — JSL
   4714 CD5B 66 6D                                .word mne_rtl         ; 46 — RTL
   4715 CD5D 70 71                                .word mne_wdm         ; 47 — WDM
   4716 CD5F DC 7D                                .word mne_mvn         ; 48 — MVN
   4717 CD61 A6 89                                .word mne_rep         ; 49 — REP
   4718 CD63 A8 89                                .word mne_sep         ; 50 — SEP
   4719 CD65 62 8A                                .word mne_php         ; 51 — PHP
   4720 CD67 62 8B                                .word mne_plp         ; 52 — PLP
   4721 CD69 88 8B                                .word mne_cmp         ; 53 — CMP
   4722 CD6B 96 8B                                .word mne_jmp         ; 54 — JMP
   4723 CD6D 08 8C                                .word mne_cop         ; 55 — COP
   4724 CD6F 1E 8C                                .word mne_nop         ; 56 — NOP
   4725 CD71 68 8D                                .word mne_stp         ; 57 — STP
   4726 CD73 DC 8D                                .word mne_mvp         ; 58 — MVP
   4727 CD75 86 91                                .word mne_beq         ; 59 — BEQ
   4728 CD77 A2 99                                .word mne_per         ; 60 — PER
   4729 CD79 0C 9C                                .word mne_eor         ; 61 — EOR
   4730 CD7B 26 9C                                .word mne_ror         ; 62 — ROR
   4731 CD7D 16 9D                                .word mne_jsr         ; 63 — JSR
   4732 CD7F 1A 9D                                .word mne_lsr         ; 64 — LSR
   4733 CD81 06 A1                                .word mne_bcs         ; 65 — BCS
   4734 CD83 2A A1                                .word mne_tcs         ; 66 — TCS
   4735 CD85 66 A5                                .word mne_rts         ; 67 — RTS
   4736 CD87 C6 A5                                .word mne_bvs         ; 68 — BVS
   4737 CD89 6A A6                                .word mne_txs         ; 69 — TXS
   4738 CD8B 86 AA                                .word mne_bit         ; 70 — BIT
   4739 CD8D 48 BB                                .word mne_clv         ; 71 — CLV
   4740 CD8F AA C8                                .word mne_tax         ; 72 — TAX
   4741 CD91 5A C9                                .word mne_ldx         ; 73 — LDX
   4742 CD93 8A C9                                .word mne_dex         ; 74 — DEX
   4743 CD95 62 CA                                .word mne_phx         ; 75 — PHX
   4744 CD97 62 CB                                .word mne_plx         ; 76 — PLX
   4745 CD99 D4 CB                                .word mne_inx         ; 77 — INX
   4746 CD9B 48 CC                                .word mne_cpx         ; 78 — CPX
   4747 CD9D 2A CD                                .word mne_tsx         ; 79 — TSX
   4748 CD9F 68 CD                                .word mne_stx         ; 80 — STX
   4749 CDA1 AA CE                                .word mne_tyx         ; 81 — TYX
   4750 CDA3 AA D0                                .word mne_tay         ; 82 — TAY
   4751 CDA5 5A D1                                .word mne_ldy         ; 83 — LDY
   4752 CDA7 8A D1                                .word mne_dey         ; 84 — DEY
   4753 CDA9 62 D2                                .word mne_phy         ; 85 — PHY
   4754 CDAB 62 D3                                .word mne_ply         ; 86 — PLY
   4755 CDAD D4 D3                                .word mne_iny         ; 87 — INY
   4756 CDAF 48 D4                                .word mne_cpy         ; 88 — CPY
   4757 CDB1 68 D5                                .word mne_sty         ; 89 — STY
   4758 CDB3 6A D6                                .word mne_txy         ; 90 — TXY
   4759 CDB5 68 DD                                .word mne_stz         ; 91 — STZ
                                        ;
   4987 = 000000B8                      s_mnetab =*-mnetab             ;mnemonic table size
   4988 = 0000005C                      n_mnemon =s_mnetab/s_word      ;total mnemonics
                                        ;
                                        ;
                                        ;	mnemonic lookup indices in opcode order...
                                        ;
   4767 CDB7 27                         mnetabix .byte mne_brkx        ; $00  BRK
   4768 CDB8 06                                   .byte mne_orax        ; $01  ORA (dp,X)
   4769 CDB9 37                                   .byte mne_copx        ; $02  COP
   4770 CDBA 06                                   .byte mne_orax        ; $03  ORA offset,S
   4771 CDBB 0D                                   .byte mne_tsbx        ; $04  TSB dp
   4772 CDBC 06                                   .byte mne_orax        ; $05  ORA dp
   4773 CDBD 2C                                   .byte mne_aslx        ; $06  ASL dp
   4774 CDBE 06                                   .byte mne_orax        ; $07  ORA [dp]
   4775 CDBF 33                                   .byte mne_phpx        ; $08  PHP
   4776 CDC0 06                                   .byte mne_orax        ; $09  ORA #
   4777 CDC1 2C                                   .byte mne_aslx        ; $0A  ASL A
   4778 CDC2 1A                                   .byte mne_phdx        ; $0B  PHD
   4779 CDC3 0D                                   .byte mne_tsbx        ; $0C  TSB abs
   4780 CDC4 06                                   .byte mne_orax        ; $0D  ORA abs
   4781 CDC5 2C                                   .byte mne_aslx        ; $0E  ASL abs
   4782 CDC6 06                                   .byte mne_orax        ; $0F  ORA absl
                                        ;
   4784 CDC7 2A                                   .byte mne_bplx        ; $10  BPL abs
   4785 CDC8 06                                   .byte mne_orax        ; $11  ORA (dp),Y
   4786 CDC9 06                                   .byte mne_orax        ; $12  ORA (dp)
   4787 CDCA 06                                   .byte mne_orax        ; $13  ORA (offset,S),Y
   4788 CDCB 0C                                   .byte mne_trbx        ; $14  TRB dp
   4789 CDCC 06                                   .byte mne_orax        ; $15  ORA dp,X
   4790 CDCD 2C                                   .byte mne_aslx        ; $16  ASL dp,X
   4791 CDCE 06                                   .byte mne_orax        ; $17  ORA [dp],Y
   4792 CDCF 14                                   .byte mne_clcx        ; $18  CLC
   4793 CDD0 06                                   .byte mne_orax        ; $19  ORA abs
   4794 CDD1 15                                   .byte mne_incx        ; $1A  INC A
   4795 CDD2 42                                   .byte mne_tcsx        ; $1B  TCS
   4796 CDD3 0C                                   .byte mne_trbx        ; $1C  TRB abs
   4797 CDD4 06                                   .byte mne_orax        ; $1D  ORA abs,X
   4798 CDD5 2C                                   .byte mne_aslx        ; $1E  ASL abs,X
   4799 CDD6 06                                   .byte mne_orax        ; $1F  ORA absl,X
                                        ;
   4801 CDD7 3F                                   .byte mne_jsrx        ; $20  JSR abs
   4802 CDD8 1D                                   .byte mne_andx        ; $21  AND (dp,X)
   4803 CDD9 2D                                   .byte mne_jslx        ; $22  JSL absl
   4804 CDDA 1D                                   .byte mne_andx        ; $23  AND offset,S
   4805 CDDB 46                                   .byte mne_bitx        ; $24  BIT dp
   4806 CDDC 1D                                   .byte mne_andx        ; $25  AND dp
   4807 CDDD 29                                   .byte mne_rolx        ; $26  ROL dp
   4808 CDDE 1D                                   .byte mne_andx        ; $27  AND [dp]
   4809 CDDF 34                                   .byte mne_plpx        ; $28  PLP
   4810 CDE0 1D                                   .byte mne_andx        ; $29  AND #
   4811 CDE1 29                                   .byte mne_rolx        ; $2A  ROL A
   4812 CDE2 1C                                   .byte mne_pldx        ; $2B  PLD
   4813 CDE3 46                                   .byte mne_bitx        ; $2C  BIT abs
   4814 CDE4 1D                                   .byte mne_andx        ; $2D  AND abs
   4815 CDE5 29                                   .byte mne_rolx        ; $2E  ROL abs
   4816 CDE6 1D                                   .byte mne_andx        ; $2F  AND absl
                                        ;
   4818 CDE7 24                                   .byte mne_bmix        ; $30  BMI abs
   4819 CDE8 1D                                   .byte mne_andx        ; $31  AND (dp),Y
   4820 CDE9 1D                                   .byte mne_andx        ; $32  AND (dp)
   4821 CDEA 1D                                   .byte mne_andx        ; $33  AND (offset,S),Y
   4822 CDEB 46                                   .byte mne_bitx        ; $34  BIT dp,X
   4823 CDEC 1D                                   .byte mne_andx        ; $35  AND dp,X
   4824 CDED 29                                   .byte mne_rolx        ; $36  ROL dp,X
   4825 CDEE 1D                                   .byte mne_andx        ; $37  AND [dp],Y
   4826 CDEF 13                                   .byte mne_secx        ; $38  SEC
   4827 CDF0 1D                                   .byte mne_andx        ; $39  AND abs,Y
   4828 CDF1 12                                   .byte mne_decx        ; $3A  DEC A
   4829 CDF2 16                                   .byte mne_tscx        ; $3B  TSC
   4830 CDF3 46                                   .byte mne_bitx        ; $3C  BIT abs,X
   4831 CDF4 1D                                   .byte mne_andx        ; $3D  AND abs,X
   4832 CDF5 29                                   .byte mne_rolx        ; $3E  ROL abs,X
   4833 CDF6 1D                                   .byte mne_andx        ; $3F  AND absl,X
                                        ;
   4835 CDF7 25                                   .byte mne_rtix        ; $40  RTI
   4836 CDF8 3D                                   .byte mne_eorx        ; $41  EOR (dp,X)
   4837 CDF9 2F                                   .byte mne_wdmx        ; $42  WDM
   4838 CDFA 3D                                   .byte mne_eorx        ; $43  EOR offset,S
   4839 CDFB 3A                                   .byte mne_mvpx        ; $44  MVP sb,db
   4840 CDFC 3D                                   .byte mne_eorx        ; $45  EOR dp
   4841 CDFD 40                                   .byte mne_lsrx        ; $46  LSR dp
   4842 CDFE 3D                                   .byte mne_eorx        ; $47  EOR [dp]
   4843 CDFF 03                                   .byte mne_phax        ; $48  PHA
   4844 CE00 3D                                   .byte mne_eorx        ; $49  EOR #
   4845 CE01 40                                   .byte mne_lsrx        ; $4A  LSR A
   4846 CE02 26                                   .byte mne_phkx        ; $4B  PHK
   4847 CE03 36                                   .byte mne_jmpx        ; $4C  JMP abs
   4848 CE04 3D                                   .byte mne_eorx        ; $4D  EOR abs
   4849 CE05 40                                   .byte mne_lsrx        ; $4E  LSR abs
   4850 CE06 3D                                   .byte mne_eorx        ; $4F  EOR absl
                                        ;
   4852 CE07 17                                   .byte mne_bvcx        ; $50  BVC abs
   4853 CE08 3D                                   .byte mne_eorx        ; $51  EOR (dp),Y
   4854 CE09 3D                                   .byte mne_eorx        ; $52  EOR (dp)
   4855 CE0A 3D                                   .byte mne_eorx        ; $53  EOR (offset,S),Y
   4856 CE0B 30                                   .byte mne_mvnx        ; $54  MVN sb,db
   4857 CE0C 3D                                   .byte mne_eorx        ; $55  EOR dp,X
   4858 CE0D 40                                   .byte mne_lsrx        ; $56  LSR dp,X
   4859 CE0E 3D                                   .byte mne_eorx        ; $57  EOR [dp],Y
   4860 CE0F 23                                   .byte mne_clix        ; $58  CLI
   4861 CE10 3D                                   .byte mne_eorx        ; $59  EOR abs,Y
   4862 CE11 55                                   .byte mne_phyx        ; $5A  PHY
   4863 CE12 18                                   .byte mne_tcdx        ; $5B  TCD
   4864 CE13 28                                   .byte mne_jmlx        ; $5C  JML absl
   4865 CE14 3D                                   .byte mne_eorx        ; $5D  EOR abs,X
   4866 CE15 40                                   .byte mne_lsrx        ; $5E  LSR abs,X
   4867 CE16 3D                                   .byte mne_eorx        ; $5F  EOR absl,X
                                        ;
   4869 CE17 43                                   .byte mne_rtsx        ; $60  RTS
   4870 CE18 10                                   .byte mne_adcx        ; $61  ADC (dp,X)
   4871 CE19 3C                                   .byte mne_perx        ; $62  PER
   4872 CE1A 10                                   .byte mne_adcx        ; $63  ADC offset,S
   4873 CE1B 5B                                   .byte mne_stzx        ; $64  STZ dp
   4874 CE1C 10                                   .byte mne_adcx        ; $65  ADC dp
   4875 CE1D 3E                                   .byte mne_rorx        ; $66  ROR dp
   4876 CE1E 10                                   .byte mne_adcx        ; $67  ADC [dp]
   4877 CE1F 04                                   .byte mne_plax        ; $68  PLA
   4878 CE20 10                                   .byte mne_adcx        ; $69  ADC #
   4879 CE21 3E                                   .byte mne_rorx        ; $6A  ROR A
   4880 CE22 2E                                   .byte mne_rtlx        ; $6B  RTL
   4881 CE23 36                                   .byte mne_jmpx        ; $6C  JMP (abs)
   4882 CE24 10                                   .byte mne_adcx        ; $6D  ADC abs
   4883 CE25 3E                                   .byte mne_rorx        ; $6E  ROR abs
   4884 CE26 10                                   .byte mne_adcx        ; $6F  ADC absl
                                        ;
   4886 CE27 44                                   .byte mne_bvsx        ; $70  BVS abs
   4887 CE28 10                                   .byte mne_adcx        ; $71  ADC (dp),Y
   4888 CE29 10                                   .byte mne_adcx        ; $72  ADC (dp)
   4889 CE2A 10                                   .byte mne_adcx        ; $73  ADC (offset,S),Y
   4890 CE2B 5B                                   .byte mne_stzx        ; $74  STZ dp,X
   4891 CE2C 10                                   .byte mne_adcx        ; $75  ADC dp,X
   4892 CE2D 3E                                   .byte mne_rorx        ; $76  ROR dp,X
   4893 CE2E 10                                   .byte mne_adcx        ; $77  ADC [dp],Y
   4894 CE2F 22                                   .byte mne_seix        ; $78  SEI
   4895 CE30 10                                   .byte mne_adcx        ; $79  ADC abs,Y
   4896 CE31 56                                   .byte mne_plyx        ; $7A  PLY
   4897 CE32 11                                   .byte mne_tdcx        ; $7B  TDC
   4898 CE33 36                                   .byte mne_jmpx        ; $7C  JMP (abs,X)
   4899 CE34 10                                   .byte mne_adcx        ; $7D  ADC abs,X
   4900 CE35 3E                                   .byte mne_rorx        ; $7E  ROR abs,X
   4901 CE36 10                                   .byte mne_adcx        ; $7F  ADC absl,X
                                        ;
   4903 CE37 05                                   .byte mne_brax        ; $80  BRA abs
   4904 CE38 07                                   .byte mne_stax        ; $81  STA (dp,X)
   4905 CE39 2B                                   .byte mne_brlx        ; $82  BRL abs
   4906 CE3A 07                                   .byte mne_stax        ; $83  STA offset,S
   4907 CE3B 59                                   .byte mne_styx        ; $84  STY dp
   4908 CE3C 07                                   .byte mne_stax        ; $85  STA dp
   4909 CE3D 50                                   .byte mne_stxx        ; $86  STX dp
   4910 CE3E 07                                   .byte mne_stax        ; $87  STA [dp]
   4911 CE3F 54                                   .byte mne_deyx        ; $88  DEY
   4912 CE40 46                                   .byte mne_bitx        ; $89  BIT #
   4913 CE41 08                                   .byte mne_txax        ; $8A  TXA
   4914 CE42 0A                                   .byte mne_phbx        ; $8B  PHB
   4915 CE43 59                                   .byte mne_styx        ; $8C  STY abs
   4916 CE44 07                                   .byte mne_stax        ; $8D  STA abs
   4917 CE45 50                                   .byte mne_stxx        ; $8E  STX abs
   4918 CE46 07                                   .byte mne_stax        ; $8F  STA absl
                                        ;
   4920 CE47 0F                                   .byte mne_bccx        ; $90  BCC abs
   4921 CE48 07                                   .byte mne_stax        ; $91  STA (dp),Y
   4922 CE49 07                                   .byte mne_stax        ; $92  STA (dp)
   4923 CE4A 07                                   .byte mne_stax        ; $93  STA (offset,S),Y
   4924 CE4B 59                                   .byte mne_styx        ; $94  STY dp,X
   4925 CE4C 07                                   .byte mne_stax        ; $95  STA dp,X
   4926 CE4D 50                                   .byte mne_stxx        ; $96  STX dp,Y
   4927 CE4E 07                                   .byte mne_stax        ; $97  STA [dp],Y
   4928 CE4F 09                                   .byte mne_tyax        ; $98  TYA
   4929 CE50 07                                   .byte mne_stax        ; $99  STA abs,Y
   4930 CE51 45                                   .byte mne_txsx        ; $9A  TXS
   4931 CE52 5A                                   .byte mne_txyx        ; $9B  TXY
   4932 CE53 5B                                   .byte mne_stzx        ; $9C  STZ abs
   4933 CE54 07                                   .byte mne_stax        ; $9D  STA abs,X
   4934 CE55 5B                                   .byte mne_stzx        ; $9E  STZ abs,X
   4935 CE56 07                                   .byte mne_stax        ; $9F  STA absl,X
                                        ;
   4937 CE57 53                                   .byte mne_ldyx        ; $A0  LDY #
   4938 CE58 01                                   .byte mne_ldax        ; $A1  LDA (dp,X)
   4939 CE59 49                                   .byte mne_ldxx        ; $A2  LDX #
   4940 CE5A 01                                   .byte mne_ldax        ; $A3  LDA offset,S
   4941 CE5B 53                                   .byte mne_ldyx        ; $A4  LDY dp
   4942 CE5C 01                                   .byte mne_ldax        ; $A5  LDA dp
   4943 CE5D 49                                   .byte mne_ldxx        ; $A6  LDX dp
   4944 CE5E 01                                   .byte mne_ldax        ; $A7  LDA [dp]
   4945 CE5F 52                                   .byte mne_tayx        ; $A8  TAY
   4946 CE60 01                                   .byte mne_ldax        ; $A9  LDA #
   4947 CE61 48                                   .byte mne_taxx        ; $AA  TAX
   4948 CE62 0B                                   .byte mne_plbx        ; $AB  PLB
   4949 CE63 53                                   .byte mne_ldyx        ; $AC  LDY abs
   4950 CE64 01                                   .byte mne_ldax        ; $AD  LDA abs
   4951 CE65 49                                   .byte mne_ldxx        ; $AE  LDX abs
   4952 CE66 01                                   .byte mne_ldax        ; $AF  LDA absl
                                        ;
   4954 CE67 41                                   .byte mne_bcsx        ; $B0  BCS abs
   4955 CE68 01                                   .byte mne_ldax        ; $B1  LDA (dp),Y
   4956 CE69 01                                   .byte mne_ldax        ; $B2  LDA (dp)
   4957 CE6A 01                                   .byte mne_ldax        ; $B3  LDA (offset,S),Y
   4958 CE6B 53                                   .byte mne_ldyx        ; $B4  LDY dp,X
   4959 CE6C 01                                   .byte mne_ldax        ; $B5  LDA dp,X
   4960 CE6D 49                                   .byte mne_ldxx        ; $B6  LDX dp,Y
   4961 CE6E 01                                   .byte mne_ldax        ; $B7  LDA [dp],Y
   4962 CE6F 47                                   .byte mne_clvx        ; $B8  CLV
   4963 CE70 01                                   .byte mne_ldax        ; $B9  LDA abs,Y
   4964 CE71 4F                                   .byte mne_tsxx        ; $BA  TSX
   4965 CE72 51                                   .byte mne_tyxx        ; $BB  TYX
   4966 CE73 53                                   .byte mne_ldyx        ; $BC  LDY abs,X
   4967 CE74 01                                   .byte mne_ldax        ; $BD  LDA abs,X
   4968 CE75 49                                   .byte mne_ldxx        ; $BE  LDX abs,Y
   4969 CE76 01                                   .byte mne_ldax        ; $BF  LDA absl,X
                                        ;
   4971 CE77 58                                   .byte mne_cpyx        ; $C0  CPY #
   4972 CE78 35                                   .byte mne_cmpx        ; $C1  CMP (dp,X)
   4973 CE79 31                                   .byte mne_repx        ; $C2  REP #
   4974 CE7A 35                                   .byte mne_cmpx        ; $C3  CMP offset,S
   4975 CE7B 58                                   .byte mne_cpyx        ; $C4  CPY dp
   4976 CE7C 35                                   .byte mne_cmpx        ; $C5  CMP dp
   4977 CE7D 12                                   .byte mne_decx        ; $C6  DEC dp
   4978 CE7E 35                                   .byte mne_cmpx        ; $C7  CMP [dp]
   4979 CE7F 57                                   .byte mne_inyx        ; $C8  INY
   4980 CE80 35                                   .byte mne_cmpx        ; $C9  CMP #
   4981 CE81 4A                                   .byte mne_dexx        ; $CA  DEX
   4982 CE82 20                                   .byte mne_waix        ; $CB  WAI
   4983 CE83 58                                   .byte mne_cpyx        ; $CC  CPY abs
   4984 CE84 35                                   .byte mne_cmpx        ; $CD  CMP abs
   4985 CE85 12                                   .byte mne_decx        ; $CE  DEC abs
   4986 CE86 35                                   .byte mne_cmpx        ; $CF  CMP absl
                                        ;
   4988 CE87 1F                                   .byte mne_bnex        ; $D0  BNE abs
   4989 CE88 35                                   .byte mne_cmpx        ; $D1  CMP (dp),Y
   4990 CE89 35                                   .byte mne_cmpx        ; $D2  CMP (dp)
   4991 CE8A 35                                   .byte mne_cmpx        ; $D3  CMP (offset,S),Y
   4992 CE8B 21                                   .byte mne_peix        ; $D4  PEI dp
   4993 CE8C 35                                   .byte mne_cmpx        ; $D5  CMP dp,X
   4994 CE8D 12                                   .byte mne_decx        ; $D6  DEC dp,X
   4995 CE8E 35                                   .byte mne_cmpx        ; $D7  CMP [dp],Y
   4996 CE8F 1B                                   .byte mne_cldx        ; $D8  CLD
   4997 CE90 35                                   .byte mne_cmpx        ; $D9  CMP abs,Y
   4998 CE91 4B                                   .byte mne_phxx        ; $DA  PHX
   4999 CE92 39                                   .byte mne_stpx        ; $DB  STP
   5000 CE93 36                                   .byte mne_jmpx        ; $DC  JMP [abs]
   5001 CE94 35                                   .byte mne_cmpx        ; $DD  CMP abs,X
   5002 CE95 12                                   .byte mne_decx        ; $DE  DEC abs,X
   5003 CE96 35                                   .byte mne_cmpx        ; $DF  CMP absl,X
                                        ;
   5005 CE97 4E                                   .byte mne_cpxx        ; $E0  CPX #
   5006 CE98 0E                                   .byte mne_sbcx        ; $E1  SBC (dp,X)
   5007 CE99 32                                   .byte mne_sepx        ; $E2  SEP #
   5008 CE9A 0E                                   .byte mne_sbcx        ; $E3  SBC offset,S
   5009 CE9B 4E                                   .byte mne_cpxx        ; $E4  CPX dp
   5010 CE9C 0E                                   .byte mne_sbcx        ; $E5  SBC dp
   5011 CE9D 15                                   .byte mne_incx        ; $E6  INC dp
   5012 CE9E 0E                                   .byte mne_sbcx        ; $E7  SBC [dp]
   5013 CE9F 4D                                   .byte mne_inxx        ; $E8  INX
   5014 CEA0 0E                                   .byte mne_sbcx        ; $E9  SBC #
   5015 CEA1 38                                   .byte mne_nopx        ; $EA  NOP
   5016 CEA2 00                                   .byte mne_xbax        ; $EB  XBA
   5017 CEA3 4E                                   .byte mne_cpxx        ; $EC  CPX abs
   5018 CEA4 0E                                   .byte mne_sbcx        ; $ED  SBC abs
   5019 CEA5 15                                   .byte mne_incx        ; $EE  INC abs
   5020 CEA6 0E                                   .byte mne_sbcx        ; $EF  SBC absl
                                        ;
   5022 CEA7 3B                                   .byte mne_beqx        ; $F0  BEQ abs
   5023 CEA8 0E                                   .byte mne_sbcx        ; $F1  SBC (dp),Y
   5024 CEA9 0E                                   .byte mne_sbcx        ; $F2  SBC (dp)
   5025 CEAA 0E                                   .byte mne_sbcx        ; $F3  SBC (offset,S),Y
   5026 CEAB 02                                   .byte mne_peax        ; $F4  PEA #
   5027 CEAC 0E                                   .byte mne_sbcx        ; $F5  SBC dp,X
   5028 CEAD 15                                   .byte mne_incx        ; $F6  INC dp,X
   5029 CEAE 0E                                   .byte mne_sbcx        ; $F7  SBC [dp],Y
   5030 CEAF 19                                   .byte mne_sedx        ; $F8  SED
   5031 CEB0 0E                                   .byte mne_sbcx        ; $F9  SBC abs,Y
   5032 CEB1 4C                                   .byte mne_plxx        ; $FA  PLX
   5033 CEB2 1E                                   .byte mne_xcex        ; $FB  XCE
   5034 CEB3 3F                                   .byte mne_jsrx        ; $FC  JSR (abs,X)
   5035 CEB4 0E                                   .byte mne_sbcx        ; $FD  SBC abs,X
   5036 CEB5 15                                   .byte mne_incx        ; $FE  INC abs,X
   5037 CEB6 0E                                   .byte mne_sbcx        ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	instruction addressing modes & sizes in opcode order...
                                        ;
                                        ;	    xxxxxxxx
                                        ;	    ||||||||
                                        ;	    ||||++++———> Addressing Mode
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||          0000  dp, abs, absl, implied or A
                                        ;	    ||||          0001  #
                                        ;	    ||||          0010  dp,X, abs,X or absl,X
                                        ;	    ||||          0011  dp,Y or abs,Y
                                        ;	    ||||          0100  (dp) or (abs)
                                        ;	    ||||          0101  [dp] or [abs]
                                        ;	    ||||          0110  [dp],Y
                                        ;	    ||||          0111  (dp,X) or (abs,X)
                                        ;	    ||||          1000  (dp),Y
                                        ;	    ||||          1001  offset,S
                                        ;	    ||||          1010  (offset,S),Y
                                        ;	    ||||          1011  sbnk,dbnk (MVN or MVP)
                                        ;	    ||||          —-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—
                                        ;	    ||||           #    = immediate
                                        ;	    ||||           A    = accumulator
                                        ;	    ||||           abs  = absolute
                                        ;	    ||||           absl = absolute long
                                        ;	    ||||           dbnk = destination bank
                                        ;	    ||||           dp   = direct (zero) page
                                        ;	    ||||           S    = stack relative
                                        ;	    ||||           sbnk = source bank
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||
                                        ;	    ||++———————> binary-encoded operand size
                                        ;	    |+—————————> 1: relative branch instruction
                                        ;	    +——————————> 1: variable operand size...
                                        ;
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;	    Variable operand size refers to an immediate mode instruction
                                        ;	    that can accept either an 8 or 16 bit operand.  During instr-
                                        ;	    uction assembly, an 8 bit operand can be forced to 16 bits by
                                        ;	    preceding the operand field with !,  e.g.,  LDA !#$01,  which
                                        ;	    will assemble as $A9 $01 $00.
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;
   5081 CEB7 00                         mnetabam .byte ops0 | am_nam   ; $00  BRK
   5082 CEB8 17                                   .byte ops1 | am_indx  ; $01  ORA (dp,X)
   5083 CEB9 10                                   .byte ops1 | am_nam   ; $02  COP
   5084 CEBA 19                                   .byte ops1 | am_stk   ; $03  ORA offset,S
   5085 CEBB 10                                   .byte ops1 | am_nam   ; $04  TSB dp
   5086 CEBC 10                                   .byte ops1 | am_nam   ; $05  ORA dp
   5087 CEBD 10                                   .byte ops1 | am_nam   ; $06  ASL dp
   5088 CEBE 15                                   .byte ops1 | am_indl  ; $07  ORA [dp]
   5089 CEBF 00                                   .byte ops0 | am_nam   ; $08  PHP
   5090 CEC0 91                                   .byte vops | am_imm   ; $09  ORA #
   5091 CEC1 00                                   .byte ops0 | am_nam   ; $0A  ASL A
   5092 CEC2 00                                   .byte ops0 | am_nam   ; $0B  PHD
   5093 CEC3 20                                   .byte ops2 | am_nam   ; $0C  TSB abs
   5094 CEC4 20                                   .byte ops2 | am_nam   ; $0D  ORA abs
   5095 CEC5 20                                   .byte ops2 | am_nam   ; $0E  ASL abs
   5096 CEC6 30                                   .byte ops3 | am_nam   ; $0F  ORA absl
                                        ;
   5098 CEC7 50                                   .byte bop1 | am_nam   ; $10  BPL abs
   5099 CEC8 18                                   .byte ops1 | am_indy  ; $11  ORA (dp),Y
   5100 CEC9 14                                   .byte ops1 | am_ind   ; $12  ORA (dp)
   5101 CECA 1A                                   .byte ops1 | am_stky  ; $13  ORA (offset,S),Y
   5102 CECB 10                                   .byte ops1 | am_nam   ; $14  TRB dp
   5103 CECC 12                                   .byte ops1 | am_adrx  ; $15  ORA dp,X
   5104 CECD 12                                   .byte ops1 | am_adrx  ; $16  ASL dp,X
   5105 CECE 16                                   .byte ops1 | am_indly ; $17  ORA [dp],Y
   5106 CECF 00                                   .byte ops0 | am_nam   ; $18  CLC
   5107 CED0 20                                   .byte ops2 | am_nam   ; $19  ORA abs
   5108 CED1 00                                   .byte ops0 | am_nam   ; $1A  INC A
   5109 CED2 00                                   .byte ops0 | am_nam   ; $1B  TCS
   5110 CED3 20                                   .byte ops2 | am_nam   ; $1C  TRB abs
   5111 CED4 22                                   .byte ops2 | am_adrx  ; $1D  ORA abs,X
   5112 CED5 22                                   .byte ops2 | am_adrx  ; $1E  ASL abs,X
   5113 CED6 32                                   .byte ops3 | am_adrx  ; $1F  ORA absl,X
                                        ;
   5115 CED7 20                                   .byte ops2 | am_nam   ; $20  JSR abs
   5116 CED8 17                                   .byte ops1 | am_indx  ; $21  AND (dp,X)
   5117 CED9 30                                   .byte ops3 | am_nam   ; $22  JSL absl
   5118 CEDA 19                                   .byte ops1 | am_stk   ; $23  AND offset,S
   5119 CEDB 10                                   .byte ops1 | am_nam   ; $24  BIT dp
   5120 CEDC 10                                   .byte ops1 | am_nam   ; $25  AND dp
   5121 CEDD 10                                   .byte ops1 | am_nam   ; $26  ROL dp
   5122 CEDE 15                                   .byte ops1 | am_indl  ; $27  AND [dp]
   5123 CEDF 00                                   .byte ops0 | am_nam   ; $28  PLP
   5124 CEE0 91                                   .byte vops | am_imm   ; $29  AND #
   5125 CEE1 00                                   .byte ops0 | am_nam   ; $2A  ROL A
   5126 CEE2 00                                   .byte ops0 | am_nam   ; $2B  PLD
   5127 CEE3 20                                   .byte ops2 | am_nam   ; $2C  BIT abs
   5128 CEE4 20                                   .byte ops2 | am_nam   ; $2D  AND abs
   5129 CEE5 20                                   .byte ops2 | am_nam   ; $2E  ROL abs
   5130 CEE6 30                                   .byte ops3 | am_nam   ; $2F  AND absl
                                        ;
   5132 CEE7 50                                   .byte bop1 | am_nam   ; $30  BMI abs
   5133 CEE8 18                                   .byte ops1 | am_indy  ; $31  AND (dp),Y
   5134 CEE9 14                                   .byte ops1 | am_ind   ; $32  AND (dp)
   5135 CEEA 1A                                   .byte ops1 | am_stky  ; $33  AND (offset,S),Y
   5136 CEEB 12                                   .byte ops1 | am_adrx  ; $34  BIT dp,X
   5137 CEEC 12                                   .byte ops1 | am_adrx  ; $35  AND dp,X
   5138 CEED 12                                   .byte ops1 | am_adrx  ; $36  ROL dp,X
   5139 CEEE 16                                   .byte ops1 | am_indly ; $37  AND [dp],Y
   5140 CEEF 00                                   .byte ops0 | am_nam   ; $38  SEC
   5141 CEF0 23                                   .byte ops2 | am_adry  ; $39  AND abs,Y
   5142 CEF1 00                                   .byte ops0 | am_nam   ; $3A  DEC A
   5143 CEF2 00                                   .byte ops0 | am_nam   ; $3B  TSC
   5144 CEF3 22                                   .byte ops2 | am_adrx  ; $3C  BIT abs,X
   5145 CEF4 22                                   .byte ops2 | am_adrx  ; $3D  AND abs,X
   5146 CEF5 22                                   .byte ops2 | am_adrx  ; $3E  ROL abs,X
   5147 CEF6 32                                   .byte ops3 | am_adrx  ; $3F  AND absl,X
                                        ;
   5149 CEF7 00                                   .byte ops0 | am_nam   ; $40  RTI
   5150 CEF8 17                                   .byte ops1 | am_indx  ; $41  EOR (dp,X)
   5151 CEF9 00                                   .byte ops0 | am_nam   ; $42  WDM
   5152 CEFA 19                                   .byte ops1 | am_stk   ; $43  EOR offset,S
   5153 CEFB 2B                                   .byte ops2 | am_move  ; $44  MVP sb,db
   5154 CEFC 10                                   .byte ops1 | am_nam   ; $45  EOR dp
   5155 CEFD 10                                   .byte ops1 | am_nam   ; $46  LSR dp
   5156 CEFE 15                                   .byte ops1 | am_indl  ; $47  EOR [dp]
   5157 CEFF 00                                   .byte ops0 | am_nam   ; $48  PHA
   5158 CF00 91                                   .byte vops | am_imm   ; $49  EOR #
   5159 CF01 00                                   .byte ops0 | am_nam   ; $4A  LSR A
   5160 CF02 00                                   .byte ops0 | am_nam   ; $4B  PHK
   5161 CF03 20                                   .byte ops2 | am_nam   ; $4C  JMP abs
   5162 CF04 20                                   .byte ops2 | am_nam   ; $4D  EOR abs
   5163 CF05 20                                   .byte ops2 | am_nam   ; $4E  LSR abs
   5164 CF06 30                                   .byte ops3 | am_nam   ; $4F  EOR absl
                                        ;
   5166 CF07 50                                   .byte bop1 | am_nam   ; $50  BVC abs
   5167 CF08 18                                   .byte ops1 | am_indy  ; $51  EOR (dp),Y
   5168 CF09 14                                   .byte ops1 | am_ind   ; $52  EOR (dp)
   5169 CF0A 1A                                   .byte ops1 | am_stky  ; $53  EOR (offset,S),Y
   5170 CF0B 2B                                   .byte ops2 | am_move  ; $54  MVN sb,db
   5171 CF0C 12                                   .byte ops1 | am_adrx  ; $55  EOR dp,X
   5172 CF0D 12                                   .byte ops1 | am_adrx  ; $56  LSR dp,X
   5173 CF0E 16                                   .byte ops1 | am_indly ; $57  EOR [dp],Y
   5174 CF0F 00                                   .byte ops0 | am_nam   ; $58  CLI
   5175 CF10 23                                   .byte ops2 | am_adry  ; $59  EOR abs,Y
   5176 CF11 00                                   .byte ops0 | am_nam   ; $5A  PHY
   5177 CF12 00                                   .byte ops0 | am_nam   ; $5B  TCD
   5178 CF13 30                                   .byte ops3 | am_nam   ; $5C  JML absl
   5179 CF14 22                                   .byte ops2 | am_adrx  ; $5D  EOR abs,X
   5180 CF15 22                                   .byte ops2 | am_adrx  ; $5E  LSR abs,X
   5181 CF16 32                                   .byte ops3 | am_adrx  ; $5F  EOR absl,X
                                        ;
   5183 CF17 00                                   .byte ops0 | am_nam   ; $60  RTS
   5184 CF18 17                                   .byte ops1 | am_indx  ; $61  ADC (dp,X)
   5185 CF19 60                                   .byte bop2 | am_nam   ; $62  PER
   5186 CF1A 19                                   .byte ops1 | am_stk   ; $63  ADC offset,S
   5187 CF1B 10                                   .byte ops1 | am_nam   ; $64  STZ dp
   5188 CF1C 10                                   .byte ops1 | am_nam   ; $65  ADC dp
   5189 CF1D 10                                   .byte ops1 | am_nam   ; $66  ROR dp
   5190 CF1E 15                                   .byte ops1 | am_indl  ; $67  ADC [dp]
   5191 CF1F 00                                   .byte ops0 | am_nam   ; $68  PLA
   5192 CF20 91                                   .byte vops | am_imm   ; $69  ADC #
   5193 CF21 00                                   .byte ops0 | am_nam   ; $6A  ROR A
   5194 CF22 00                                   .byte ops0 | am_nam   ; $6B  RTL
   5195 CF23 24                                   .byte ops2 | am_ind   ; $6C  JMP (abs)
   5196 CF24 20                                   .byte ops2 | am_nam   ; $6D  ADC abs
   5197 CF25 20                                   .byte ops2 | am_nam   ; $6E  ROR abs
   5198 CF26 30                                   .byte ops3 | am_nam   ; $6F  ADC absl
                                        ;
   5200 CF27 50                                   .byte bop1 | am_nam   ; $70  BVS abs
   5201 CF28 18                                   .byte ops1 | am_indy  ; $71  ADC (dp),Y
   5202 CF29 14                                   .byte ops1 | am_ind   ; $72  ADC (dp)
   5203 CF2A 1A                                   .byte ops1 | am_stky  ; $73  ADC (offset,S),Y
   5204 CF2B 12                                   .byte ops1 | am_adrx  ; $74  STZ dp,X
   5205 CF2C 12                                   .byte ops1 | am_adrx  ; $75  ADC dp,X
   5206 CF2D 12                                   .byte ops1 | am_adrx  ; $76  ROR dp,X
   5207 CF2E 16                                   .byte ops1 | am_indly ; $77  ADC [dp],Y
   5208 CF2F 00                                   .byte ops0 | am_nam   ; $78  SEI
   5209 CF30 23                                   .byte ops2 | am_adry  ; $79  ADC abs,Y
   5210 CF31 00                                   .byte ops0 | am_nam   ; $7A  PLY
   5211 CF32 00                                   .byte ops0 | am_nam   ; $7B  TDC
   5212 CF33 27                                   .byte ops2 | am_indx  ; $7C  JMP (abs,X)
   5213 CF34 22                                   .byte ops2 | am_adrx  ; $7D  ADC abs,X
   5214 CF35 22                                   .byte ops2 | am_adrx  ; $7E  ROR abs,X
   5215 CF36 32                                   .byte ops3 | am_adrx  ; $7F  ADC absl,X
                                        ;
   5217 CF37 50                                   .byte bop1 | am_nam   ; $80  BRA abs
   5218 CF38 17                                   .byte ops1 | am_indx  ; $81  STA (dp,X)
   5219 CF39 60                                   .byte bop2 | am_nam   ; $82  BRL abs
   5220 CF3A 19                                   .byte ops1 | am_stk   ; $83  STA offset,S
   5221 CF3B 10                                   .byte ops1 | am_nam   ; $84  STY dp
   5222 CF3C 10                                   .byte ops1 | am_nam   ; $85  STA dp
   5223 CF3D 10                                   .byte ops1 | am_nam   ; $86  STX dp
   5224 CF3E 15                                   .byte ops1 | am_indl  ; $87  STA [dp]
   5225 CF3F 00                                   .byte ops0 | am_nam   ; $88  DEY
   5226 CF40 91                                   .byte vops | am_imm   ; $89  BIT #
   5227 CF41 00                                   .byte ops0 | am_nam   ; $8A  TXA
   5228 CF42 00                                   .byte ops0 | am_nam   ; $8B  PHB
   5229 CF43 20                                   .byte ops2 | am_nam   ; $8C  STY abs
   5230 CF44 20                                   .byte ops2 | am_nam   ; $8D  STA abs
   5231 CF45 20                                   .byte ops2 | am_nam   ; $8E  STX abs
   5232 CF46 30                                   .byte ops3 | am_nam   ; $8F  STA absl
                                        ;
   5234 CF47 50                                   .byte bop1 | am_nam   ; $90  BCC abs
   5235 CF48 18                                   .byte ops1 | am_indy  ; $91  STA (dp),Y
   5236 CF49 14                                   .byte ops1 | am_ind   ; $92  STA (dp)
   5237 CF4A 1A                                   .byte ops1 | am_stky  ; $93  STA (offset,S),Y
   5238 CF4B 12                                   .byte ops1 | am_adrx  ; $94  STY dp,X
   5239 CF4C 12                                   .byte ops1 | am_adrx  ; $95  STA dp,X
   5240 CF4D 13                                   .byte ops1 | am_adry  ; $96  STX dp,Y
   5241 CF4E 16                                   .byte ops1 | am_indly ; $97  STA [dp],Y
   5242 CF4F 00                                   .byte ops0 | am_nam   ; $98  TYA
   5243 CF50 23                                   .byte ops2 | am_adry  ; $99  STA abs,Y
   5244 CF51 00                                   .byte ops0 | am_nam   ; $9A  TXS
   5245 CF52 00                                   .byte ops0 | am_nam   ; $9B  TXY
   5246 CF53 20                                   .byte ops2 | am_nam   ; $9C  STZ abs
   5247 CF54 22                                   .byte ops2 | am_adrx  ; $9D  STA abs,X
   5248 CF55 22                                   .byte ops2 | am_adrx  ; $9E  STZ abs,X
   5249 CF56 32                                   .byte ops3 | am_adrx  ; $9F  STA absl,X
                                        ;
   5251 CF57 91                                   .byte vops | am_imm   ; $A0  LDY #
   5252 CF58 17                                   .byte ops1 | am_indx  ; $A1  LDA (dp,X)
   5253 CF59 91                                   .byte vops | am_imm   ; $A2  LDX #
   5254 CF5A 19                                   .byte ops1 | am_stk   ; $A3  LDA offset,S
   5255 CF5B 10                                   .byte ops1 | am_nam   ; $A4  LDY dp
   5256 CF5C 10                                   .byte ops1 | am_nam   ; $A5  LDA dp
   5257 CF5D 10                                   .byte ops1 | am_nam   ; $A6  LDX dp
   5258 CF5E 15                                   .byte ops1 | am_indl  ; $A7  LDA [dp]
   5259 CF5F 00                                   .byte ops0 | am_nam   ; $A8  TAY
   5260 CF60 91                                   .byte vops | am_imm   ; $A9  LDA #
   5261 CF61 00                                   .byte ops0 | am_nam   ; $AA  TAX
   5262 CF62 00                                   .byte ops0 | am_nam   ; $AB  PLB
   5263 CF63 20                                   .byte ops2 | am_nam   ; $AC  LDY abs
   5264 CF64 20                                   .byte ops2 | am_nam   ; $AD  LDA abs
   5265 CF65 20                                   .byte ops2 | am_nam   ; $AE  LDX abs
   5266 CF66 30                                   .byte ops3 | am_nam   ; $AF  LDA absl
                                        ;
   5268 CF67 50                                   .byte bop1 | am_nam   ; $B0  BCS abs
   5269 CF68 18                                   .byte ops1 | am_indy  ; $B1  LDA (dp),Y
   5270 CF69 14                                   .byte ops1 | am_ind   ; $B2  LDA (dp)
   5271 CF6A 1A                                   .byte ops1 | am_stky  ; $B3  LDA (offset,S),Y
   5272 CF6B 12                                   .byte ops1 | am_adrx  ; $B4  LDY dp,X
   5273 CF6C 12                                   .byte ops1 | am_adrx  ; $B5  LDA dp,X
   5274 CF6D 13                                   .byte ops1 | am_adry  ; $B6  LDX dp,Y
   5275 CF6E 16                                   .byte ops1 | am_indly ; $B7  LDA [dp],Y
   5276 CF6F 00                                   .byte ops0 | am_nam   ; $B8  CLV
   5277 CF70 23                                   .byte ops2 | am_adry  ; $B9  LDA abs,Y
   5278 CF71 00                                   .byte ops0 | am_nam   ; $BA  TSX
   5279 CF72 00                                   .byte ops0 | am_nam   ; $BB  TYX
   5280 CF73 22                                   .byte ops2 | am_adrx  ; $BC  LDY abs,X
   5281 CF74 22                                   .byte ops2 | am_adrx  ; $BD  LDA abs,X
   5282 CF75 23                                   .byte ops2 | am_adry  ; $BE  LDX abs,Y
   5283 CF76 32                                   .byte ops3 | am_adrx  ; $BF  LDA absl,X
                                        ;
   5285 CF77 91                                   .byte vops | am_imm   ; $C0  CPY #
   5286 CF78 17                                   .byte ops1 | am_indx  ; $C1  CMP (dp,X)
   5287 CF79 11                                   .byte ops1 | am_imm   ; $C2  REP #
   5288 CF7A 19                                   .byte ops1 | am_stk   ; $C3  CMP offset,S
   5289 CF7B 10                                   .byte ops1 | am_nam   ; $C4  CPY dp
   5290 CF7C 10                                   .byte ops1 | am_nam   ; $C5  CMP dp
   5291 CF7D 10                                   .byte ops1 | am_nam   ; $C6  DEC dp
   5292 CF7E 15                                   .byte ops1 | am_indl  ; $C7  CMP [dp]
   5293 CF7F 00                                   .byte ops0 | am_nam   ; $C8  INY
   5294 CF80 91                                   .byte vops | am_imm   ; $C9  CMP #
   5295 CF81 00                                   .byte ops0 | am_nam   ; $CA  DEX
   5296 CF82 00                                   .byte ops0 | am_nam   ; $CB  WAI
   5297 CF83 20                                   .byte ops2 | am_nam   ; $CC  CPY abs
   5298 CF84 20                                   .byte ops2 | am_nam   ; $CD  CMP abs
   5299 CF85 20                                   .byte ops2 | am_nam   ; $CE  DEC abs
   5300 CF86 30                                   .byte ops3 | am_nam   ; $CF  CMP absl
                                        ;
   5302 CF87 50                                   .byte bop1 | am_nam   ; $D0  BNE abs
   5303 CF88 18                                   .byte ops1 | am_indy  ; $D1  CMP (dp),Y
   5304 CF89 14                                   .byte ops1 | am_ind   ; $D2  CMP (dp)
   5305 CF8A 1A                                   .byte ops1 | am_stky  ; $D3  CMP (offset,S),Y
   5306 CF8B 10                                   .byte ops1 | am_nam   ; $D4  PEI dp
   5307 CF8C 12                                   .byte ops1 | am_adrx  ; $D5  CMP dp,X
   5308 CF8D 12                                   .byte ops1 | am_adrx  ; $D6  DEC dp,X
   5309 CF8E 16                                   .byte ops1 | am_indly ; $D7  CMP [dp],Y
   5310 CF8F 00                                   .byte ops0 | am_nam   ; $D8  CLD
   5311 CF90 23                                   .byte ops2 | am_adry  ; $D9  CMP abs,Y
   5312 CF91 00                                   .byte ops0 | am_nam   ; $DA  PHX
   5313 CF92 00                                   .byte ops0 | am_nam   ; $DB  STP
   5314 CF93 25                                   .byte ops2 | am_indl  ; $DC  JMP [abs]
   5315 CF94 22                                   .byte ops2 | am_adrx  ; $DD  CMP abs,X
   5316 CF95 22                                   .byte ops2 | am_adrx  ; $DE  DEC abs,X
   5317 CF96 32                                   .byte ops3 | am_adrx  ; $DF  CMP absl,X
                                        ;
   5319 CF97 91                                   .byte vops | am_imm   ; $E0  CPX #
   5320 CF98 17                                   .byte ops1 | am_indx  ; $E1  SBC (dp,X)
   5321 CF99 11                                   .byte ops1 | am_imm   ; $E2  SEP #
   5322 CF9A 19                                   .byte ops1 | am_stk   ; $E3  SBC offset,S
   5323 CF9B 10                                   .byte ops1 | am_nam   ; $E4  CPX dp
   5324 CF9C 10                                   .byte ops1 | am_nam   ; $E5  SBC dp
   5325 CF9D 10                                   .byte ops1 | am_nam   ; $E6  INC dp
   5326 CF9E 15                                   .byte ops1 | am_indl  ; $E7  SBC [dp]
   5327 CF9F 00                                   .byte ops0 | am_nam   ; $E8  INX
   5328 CFA0 91                                   .byte vops | am_imm   ; $E9  SBC #
   5329 CFA1 00                                   .byte ops0 | am_nam   ; $EA  NOP
   5330 CFA2 00                                   .byte ops0 | am_nam   ; $EB  XBA
   5331 CFA3 20                                   .byte ops2 | am_nam   ; $EC  CPX abs
   5332 CFA4 20                                   .byte ops2 | am_nam   ; $ED  SBC abs
   5333 CFA5 20                                   .byte ops2 | am_nam   ; $EE  INC abs
   5334 CFA6 30                                   .byte ops3 | am_nam   ; $EF  SBC absl
                                        ;
   5336 CFA7 50                                   .byte bop1 | am_nam   ; $F0  BEQ abs
   5337 CFA8 18                                   .byte ops1 | am_indy  ; $F1  SBC (dp),Y
   5338 CFA9 14                                   .byte ops1 | am_ind   ; $F2  SBC (dp)
   5339 CFAA 1A                                   .byte ops1 | am_stky  ; $F3  SBC (offset,S),Y
   5340 CFAB 21                                   .byte ops2 | am_imm   ; $F4  PEA #
   5341 CFAC 12                                   .byte ops1 | am_adrx  ; $F5  SBC dp,X
   5342 CFAD 12                                   .byte ops1 | am_adrx  ; $F6  INC dp,X
   5343 CFAE 16                                   .byte ops1 | am_indly ; $F7  SBC [dp],Y
   5344 CFAF 00                                   .byte ops0 | am_nam   ; $F8  SED
   5345 CFB0 23                                   .byte ops2 | am_adry  ; $F9  SBC abs,Y
   5346 CFB1 00                                   .byte ops0 | am_nam   ; $FA  PLX
   5347 CFB2 00                                   .byte ops0 | am_nam   ; $FB  XCE
   5348 CFB3 27                                   .byte ops2 | am_indx  ; $FC  JSR (abs,X)
   5349 CFB4 22                                   .byte ops2 | am_adrx  ; $FD  SBC abs,X
   5350 CFB5 22                                   .byte ops2 | am_adrx  ; $FE  INC abs,X
   5351 CFB6 32                                   .byte ops3 | am_adrx  ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	.X & .Y immediate mode opcodes...
                                        ;
   5356 CFB7 A0                         vopidx   .byte $a0             ;LDY #
   5357 CFB8 A2                                   .byte $a2             ;LDX #
   5358 CFB9 C0                                   .byte $c0             ;CPY #
   5359 CFBA E0                                   .byte $e0             ;CPX #
   5586 = 00000004                      n_vopidx =*-vopidx             ;number of opcodes
                                        ;
                                        ;
                                        ;	addressing mode symbology lookup...
                                        ;
   5365 CFBB D3 CF                      ms_lutab .word ms_nam          ;(0000)  no symbol
   5366 CFBD DD CF                                .word ms_imm          ;(0001)  #
   5367 CFBF D5 CF                                .word ms_addrx        ;(0010)  dp,X or abs,X
   5368 CFC1 D9 CF                                .word ms_addry        ;(0011)  dp,Y or abs,Y
   5369 CFC3 DF CF                                .word ms_ind          ;(0100)  (dp) or (abs)
   5370 CFC5 E2 CF                                .word ms_indl         ;(0101)  [dp] or [abs]
   5371 CFC7 E5 CF                                .word ms_indly        ;(0110)  [dp],Y
   5372 CFC9 EA CF                                .word ms_indx         ;(0111)  (dp,X) or (abs,X)
   5373 CFCB EF CF                                .word ms_indy         ;(1000)  (dp),Y
   5374 CFCD F7 CF                                .word ms_stk          ;(1001)  offset,S
   5375 CFCF FB CF                                .word ms_stky         ;(1010) (offset,S),Y
   5376 CFD1 D3 CF                                .word ms_nam          ;(1011) sbnk,dbnk
                                        ;
                                        ;
                                        ;	addressing mode symbology strings...
                                        ;
   5381 CFD3 20 00                      ms_nam   .byte " ",0           ;no symbol
   5382 CFD5 20 2C 58 00                ms_addrx .byte " ,X",0         ;dp,X or addr,X
   5383 CFD9 20 2C 59 00                ms_addry .byte " ,Y",0         ;dp,Y or addr,Y
   5384 CFDD 23 00                      ms_imm   .byte "#",0           ;immediate
   5385 CFDF 28 29 00                   ms_ind   .byte "()",0          ;(dp) or (abs)
   5386 CFE2 5B 5D 00                   ms_indl  .byte "[]",0          ;[dp] or [abs]
   5387 CFE5 5B 5D 2C 59 00             ms_indly .byte "[],Y",0        ;[dp],Y
   5388 CFEA 28 2C 58 29 00             ms_indx  .byte "(,X)",0        ;(dp,X) or (abs,X)
   5389 CFEF 28 29 2C 59 00             ms_indy  .byte "(),Y",0        ;(dp),Y
   5390 CFF4 2C 24 00                   ms_move  .byte ",$",0          ;MVN/MVP sbnk,dbnk
   5391 CFF7 20 2C 53 00                ms_stk   .byte " ,S",0         ;offset,S
   5392 CFFB 28 2C 53 29 2C 59 00       ms_stky  .byte "(,S),Y",0      ;(offset,S),Y
   5393 D002 7B 7D 2C 59 00             ms_indxly	.byte "{},Y",0     ;{dp},Y
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL STRINGS
                                        ;
   5399 D007 1B 28                      dc_bf +         .byte a_esc,"("
   5399 D009 1B 47 34                 +            .byte a_esc,"G4"
                                                            ;enable reverse foreground
   5400 D00C 00                                   .byte 0
                                        ;
   5402 D00D 08                         dc_bs +         .byte a_bs
   5402 D00E 1B 57                    +   +         .byte a_esc,"W"
                                        
                                                            ;destructive backspace
   5404 D010 00                                   .byte 0
                                        ;
   5406 D011 1B 54                      dc_cl +         .byte a_esc,"T"
                                                            ;clear to end of line 
   5407 D013 00                                   .byte 0
                                        ;
   5409 D014 1B 60 31                   dc_cn +         .byte a_esc,"`1"
                                                            ;cursor on
   5410 D017 00                                   .byte 0
                                        ;
   5412 D018 1B 60 30                   dc_co +         .byte a_esc,"`0"
                                                            ;cursor off
   5413 D01B 00                                   .byte 0
                                        ;
   5415 D01C 1B 28                      dc_er +         .byte a_esc,"("
   5415 D01E 1B 47 30                 +            .byte a_esc,"G0"
                                                            ;enable normal foreground
   5416 D021 00                                   .byte 0
                                        ;
   5418 D022 0D                         dc_lf ++         .byte a_cr
                                     +   
   5418 D023 0A                       +            .byte a_lf
                                                            ;newline
   5419 D024 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;TEXT STRINGS
                                        ;
   5425 D025 07                         mm_brk +         .byte a_bel
                                        
   5426 D026 0D                       +   +         .byte a_cr
                                     +   
   5426 D027 0A                       +            .byte a_lf
                                        
   5427 D028 2A 2A 42 52 4B                       .byte "**BRK"
   5428 D02D 0D                       +   +         .byte a_cr
                                     +   
   5428 D02E 0A                       +            .byte a_lf
                                        
   5429 D02F 00                                   .byte 0
                                        ;
   5431 D030 0D                         mm_entry ++         .byte a_cr
                                     +   
   5431 D031 0A                       +            .byte a_lf
                                        
   5432 D032 0A 53 75 70 65 72 6D 6F              .byte a_lf,"Supermon 832 "
   5432 D03A 6E 20 38 33 32 20         
   5433 D040 31                       +            .byte "1"
   5433 D041 2E                       +            .byte "."
   5433 D042 30                       +            .byte "0"
   5433 D043 2E                       +            .byte "."
   5433 D044 30                       +            .byte "0"
                                        
   5434 D045 20                                   .byte " "
   5435 D046 0D                       +   +         .byte a_cr
                                     +   
   5435 D047 0A                       +            .byte a_lf
                                        
   5436 D048 00                                   .byte 0
                                        ;
   5438 D049 20 2A 2A 45 52 52 20 20    mm_err   .byte " **ERR  ",0
   5438 D051 00                        
                                        ;
   5440 D052 0D                         mm_prmpt ++         .byte a_cr
                                     +   
   5440 D053 0A                       +            .byte a_lf
                                        
   5441 D054 1B 28                    +            .byte a_esc,"("
   5441 D056 1B 47 30                 +            .byte a_esc,"G0"
                                        
   5442 D059 2E 00                                .byte ".",0
                                        ;
   5444 D05B 0D                         mm_regs ++         .byte a_cr
                                     +   
   5444 D05C 0A                       +            .byte a_lf
                                        
   5445 D05D 20 20 20 20 20 20 20 20              .byte "                    31"
   5445 D065 20 20 20 20 20 20 20 20   
   5445 D06D 20 20 20 20 33 31         
   5446 D073 0D                       +   +         .byte a_cr
                                     +   
   5446 D074 0A                       +            .byte a_lf
                                        
   5447 D075 20 20 20 43 53 20 20 50              .byte "   CS  PB  PC   26NVmxDIZC    .A       .X       .Y       SP  "
   5447 D07D 42 20 20 50 43 20 20 20   
   5447 D085 32 36 4E 56 6D 78 44 49   
   5447 D08D 5A 43 20 20 20 20 2E 41   
   5447 D095 20 20 20 20 20 20 20 2E   
   5447 D09D 58 20 20 20 20 20 20 20   
   5447 D0A5 2E 59 20 20 20 20 20 20   
   5447 D0AD 20 53 50 20 20            
   5448 D0B2 0D                       +   +         .byte a_cr
                                     +   
   5448 D0B3 0A                       +            .byte a_lf
                                        
   5449 D0B4 3B 20 00                             .byte "; ",0
   5450 D0B7 0D                         mm_regs2 ++         .byte a_cr
                                     +   
   5450 D0B8 0A                       +            .byte a_lf
                                        
   5451 D0B9 20 20 20 44 53 20 20 20              .byte "   DS   SS  DP  DB"
   5451 D0C1 53 53 20 20 44 50 20 20   
   5451 D0C9 44 42                     
   5452 D0CB 0D                       +   +         .byte a_cr
                                     +   
   5452 D0CC 0A                       +            .byte a_lf
                                        
   5453 D0CD 3B 20 00                             .byte "; ",0
                                        ;
   5455 D0D0 07                         mm_rts +         .byte a_bel
                                        
   5456 D0D1 0D                       +   +         .byte a_cr
                                     +   
   5456 D0D2 0A                       +            .byte a_lf
                                        
   5457 D0D3 2A 2A 52 54 53                       .byte "**RTS"
   5458 D0D8 0D                       +   +         .byte a_cr
                                     +   
   5458 D0D9 0A                       +            .byte a_lf
                                        
   5459 D0DA 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;VECTOR STORAGE
                                        ;
                                        ;
   5762 = 0000D0DB                      _txtend_ =*                     ;end of program text
                                        ;
                                        ;================================================================================
                                        	;.end
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
FTBios816.asm


                                        .include "supermon832.asm"
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
FAC1ToString.asm

                                        ; ============================================================================
                                        ; FAC1ToString.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014  Robert Finch, Stratford
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
                                        ; This code is a heavily modified version of the floating point to string
                                        ; conversion routine which is a part of Lee Davison's EhBASIC.
                                        ;
   5794 = 00000000000000C6                            Cvaral		= $C6		; current var address low byte
   5795 = 000000C7                      Cvarah		= Cvaral+1	; current var address high byte
   5796 = 00000000000000C0                            numexp		= $C0		; string to float number exponent count
   5797 = 00000000000000C2                            expcnt		= $C2		; string to float exponent count
   5798 = 00000000000000C4                            Sendl			= $C4	; BASIC pointer temp low byte
   5799 = 00000000000000C5                            Sendh			= $C5	; BASIC pointer temp low byte
                                        
   5801 = 00000000000003A0                            Decss		= $3A0		; number to decimal string start
   5802 = 000003A1                      Decssp1		= Decss+1	; number to decimal string start
   5803 = 0000000000000001                            FP_ADD		EQU		1
   5804 = 0000000000000002                            FP_SUB		EQU		2
   5805 = 0000000000000003                            FP_MUL		EQU		3
   5806 = 0000000000000004                            FP_DIV		EQU		4
   5807 = 0000000000000005                            FP_FIX2FLT	EQU		5
   5808 = 0000000000000006                            FP_FLT2FIX	EQU		6
   5809 = 0000000000000007                            FP_ABS		EQU		7
   5810 = 0000000000000010                            FP_NEG		EQU		16
   5811 = 0000000000000011                            FP_SWAP		EQU		17
   5812 = 0000000000000083                            FIXED_MUL	EQU		$83
   5813 = 0000000000000081                            FIXED_ADD	EQU		$81
   5814 = 0000000000000082                            FIXED_SUB	EQU		$82
                                        ;parameter FIXED_DIV = 8'h84;
                                        ;parameter FIXED_ABS = 8'h87;
                                        ;parameter FIXED_NEG = 8'h90;
   5818 = 0000000000FEA20E                            FP_CMDREG	EQU		$FEA20E
   5819 = 0000000000FEA20E                            FP_STATREG	EQU		$FEA20E
   5820 = 0000000000FEA200                            FAC1		EQU		$FEA200
   5821 = 0000000000FEA200                            FAC1_5		EQU		$FEA200
   5822 = 0000000000FEA202                            FAC1_4		EQU		$FEA202
   5823 = 0000000000FEA204                            FAC1_3		EQU		$FEA204
   5824 = 0000000000FEA206                            FAC1_2		EQU		$FEA206
   5825 = 0000000000FEA208                            FAC1_1		EQU		$FEA208
   5826 = 0000000000FEA208                            FAC1_msw	EQU		$FEA208
   5827 = 0000000000FEA20A                            FAC1_e		EQU		$FEA20A
   5828 = 0000000000FEA210                            FAC2		EQU		$FEA210
                                        
                                           	CPU		W65C816S
                                           	NDX		16
                                           	MEM		16
                                           	
                                           public FAC1ToString:
                                           
                                           ; The first chunk of code determines if the number is positive or negative
                                           ; and spits out the appropriate sign. Next it takes the absolute value of
                                           ; the accumulator so following code only has to deal with positive numbers.
                                           
   5544 00D0DB A0 00 00                     	LDY	#$00			; set index = 1
   5545 00D0DE AF 08 A2 FE                  	LDA	FAC1_msw		; test FAC1 sign (b15) (Can't use BIT)
   5546 00D0E2 10 0E                        	BPL	.0002		; branch if +ve
   5547 00D0E4 A9 2D 00                     	LDA	#'-'			; else character = "-"
   5548 00D0E7 99 A0 03                     	STA	Decss,Y		; save leading character (" " or "-")
   5549 00D0EA A9 10 00                     	LDA	#FP_NEG		; make the FAC positive
   5550 00D0ED 20 14 D3                     	JSR	FPCommandWait
   5551 00D0F0 80 06                        	BRA	.0001
   5552 00D0F2                             .0002:
   5553 00D0F2 A9 20 00                     	LDA	#$20			; character = " " (assume +ve)
   5554 00D0F5 99 A0 03                     	STA	Decss,Y
   5555 00D0F8                             .0001:
   5556 00D0F8 84 C4                        	STY	Sendl			; save index
                                           
                                           ; This little bit of code check for a zero exponent which indicates a
                                           ; value of zero.
                                           
   5561 00D0FA AF 0A A2 FE                  	LDA	FAC1_e		; get FAC1 exponent
   5562 00D0FE AA                           	TAX
   5563 00D0FF D0 06                        	BNE	LAB_2989		; branch if FAC1<>0
                                           					; exponent was $00 so FAC1 is 0
   5565 00D101 A9 30 00                     	LDA	#'0'			; set character = "0"
   5566 00D104 82 93 01                     	BRL	LAB_2A89		; save last character, [EOT] and exit
                                           
                                           ; This loop attempts to make small values more significant, so that there are
                                           ; fewer leading zeros in the value. (The exponent is decremented so that it
                                           ; corresponds). Because of the potential for extremely small values looping is
                                           ; limited. The problem is the 16 bit exponent can allow for much smaller
                                           ; values than an 8 bit exponent would and we don't want to loop for thousands
                                           ; of iterations in order to display a value that's almost zero.
                                           
                                           					; FAC1 is some non zero value
   5576 00D107                             LAB_2989
   5577 00D107 84 C4                        	STY	Sendl			; save off .Y
   5578 00D109 A0 67 06                     	LDY #1639			; max number of retries
   5579 00D10C A9 00 00                     	LDA	#$00			; clear (number exponent count)
   5580 00D10F 85 C0                        	STA numexp
   5581 00D111                             LOOP_MBMILLION:
   5582 00D111 E0 00 80                     	CPX	#$8000			; compare FAC1 exponent with $8000 (>1.00000)
   5583 00D114 B0 1A                        	BCS	LAB_299A		; branch if FAC1=>1
                                           					; FAC1<1
   5585 00D116 F4 63 D3                     	PEA	A_MILLION		; multiply FAC * 1,000,000
   5586 00D119 20 C9 D2                     	JSR	LOAD_FAC2		; 
   5587 00D11C 68                           	PLA					; get rid of parameter
   5588 00D11D 20 C3 D2                     	JSR	FMUL
   5589 00D120 A5 C0                        	LDA numexp
   5590 00D122 38                           	SEC
   5591 00D123 E9 06 00                     	SBC	#6				; set number exponent count (-6)
   5592 00D126 85 C0                        	STA numexp
   5593 00D128 AF 0A A2 FE                  	LDA FAC1_e
   5594 00D12C AA                           	TAX
   5595 00D12D 88                           	DEY
   5596 00D12E 10 E1                        	BPL	LOOP_MBMILLION
                                           
   5598 00D130                             LAB_299A
   5599 00D130 A4 C4                        	LDY	Sendl		; get back .Y
                                           
                                           ; These two loops coerce the value of the FAC to be between 100,000 and
                                           ; 1,000,000. This gives a maximum of six digits before the decimal point
                                           ; in scientific notation.
                                           
                                           ; This loop divides by 10 until the value in the FAC is less than 1,000,000
                                           ;
   5607 00D132                             LOOP_DB10:
   5608 00D132 F4 7B D3                     	PEA	MAX_BEFORE_SCI	; set pointer low byte to 999999.4375 (max before sci note)
   5609 00D135 20 C9 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5610 00D138 68                           	PLA					; get rid of parameter
   5611 00D139 AF 0E A2 FE                  	LDA FP_CMDREG
   5612 00D13D 89 08 00                     	BIT	#$08			; test equals bit
   5613 00D140 D0 28                        	BNE	LAB_29C3		; exit if FAC1 = (AY)
   5614 00D142 89 04 00                     	BIT	#$04			; test greater than bit
   5615 00D145 F0 07                        	BEQ	LOOP_MB10		; go do *10 if FAC1 < (AY)
                                           
   5617 00D147                             LAB_29B9
   5618 00D147 20 01 D3                     	JSR	DivideByTen		; divide by 10
   5619 00D14A E6 C0                        	INC	numexp			; increment number exponent count
   5620 00D14C 80 E4                        	BRA	LOOP_DB10		; go test again (branch always)
                                           
                                           ; This loop multiplies the value by 10 until it's greater than
                                           ; 100,000.
                                           					; FAC1 < (AY)
   5625 00D14E                             LOOP_MB10
   5626 00D14E F4 93 D3                     	PEA CONST_9375		; set pointer to 99999.9375
   5627 00D151 20 C9 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5628 00D154 68                           	PLA					; get rid of parameter
   5629 00D155 AF 0E A2 FE                  	LDA FP_CMDREG
   5630 00D159 89 08 00                     	BIT #$08
   5631 00D15C D0 05                        	BNE	LAB_29B2		; branch if FAC1 = (AY) (allow decimal places)
   5632 00D15E 89 04 00                     	BIT #$04
   5633 00D161 D0 07                        	BNE	LAB_29C0		; branch if FAC1 > (AY) (no decimal places)
                                           					; FAC1 <= (AY)
   5635 00D163                             LAB_29B2
   5636 00D163 20 F4 D2                     	JSR	MultiplyByTen	; multiply by 10
   5637 00D166 C6 C0                        	DEC	numexp		; decrement number exponent count
   5638 00D168 80 E4                        	BRA	LOOP_MB10		; go test again (branch always)
                                           
                                           ; now we have just the digits to do
                                           
   5642 00D16A                             LAB_29C0
                                           ;	JSR	AddPoint5		; add 0.5 to FAC1 (round FAC1)
   5644 00D16A                             LAB_29C3
                                           ;	JSR	FloatToFixed	; convert FAC1 floating-to-fixed
   5646 00D16A A2 01 00                     	LDX	#$01			; set default digits before dp = 1
   5647 00D16D A5 C0                        	LDA	numexp		; get number exponent count
   5648 00D16F 18                           	CLC				; clear carry for add
   5649 00D170 69 07 00                     	ADC	#$07			; up to 6 digits before point
   5650 00D173 30 0A                        	BMI	LAB_29D8		; if -ve then 1 digit before dp
                                           
   5652 00D175 C9 08 00                     	CMP	#$08			; A>=8 if n>=1E6
   5653 00D178 B0 06                        	BCS	LAB_29D9		; branch if >= $08
                                           
                                           					; carry is clear
   5656 00D17A AA                           	TAX				; copy to A
   5657 00D17B CA                           	DEX				; take 1 from digit count
   5658 00D17C A9 02 00                     	LDA	#$02			;.set exponent adjust
                                           
   5660 00D17F                             LAB_29D8
   5661 00D17F 38                           	SEC				; set carry for subtract
   5662 00D180                             LAB_29D9
   5663 00D180 E9 02 00                     	SBC	#$02			; -2
   5664 00D183 85 C2                        	STA	expcnt		;.save exponent adjust
   5665 00D185 86 C0                        	STX	numexp		; save digits before dp count
   5666 00D187 8A                           	TXA				; copy to A
   5667 00D188 F0 02                        	BEQ	LAB_29E4		; branch if no digits before dp
                                           
   5669 00D18A 10 15                        	BPL	LAB_29F7		; branch if digits before dp
                                           
   5671 00D18C                             LAB_29E4
   5672 00D18C A4 C4                        	LDY	Sendl			; get output string index
   5673 00D18E A9 2E 00                     	LDA	#'.'			; character "."
   5674 00D191 C8                           	INY				; increment index
   5675 00D192 99 A0 03                     	STA	Decss,Y		; save to output string
   5676 00D195 8A                           	TXA				;.
   5677 00D196 F0 07                        	BEQ	LAB_29F5		;.
                                           
   5679 00D198 A9 30 00                     	LDA	#'0'			; character "0"
   5680 00D19B C8                           	INY				; increment index
   5681 00D19C 99 A0 03                     	STA	Decss,Y		; save to output string
   5682 00D19F                             LAB_29F5
   5683 00D19F 84 C4                        	STY	Sendl			; save output string index
                                           
   5685 00D1A1                             LAB_29F7
   5686 00D1A1 A2 30 00                     	LDX	#'0'			; holds onto the digit value
                                           
                                           ; Now loop subtracting 100,000 as many times as we can. The value was coerced
                                           ; to be between 100,000 and 1,000,000. Count the number of times subtraction
                                           ; can be done successfully.
                                           ;
   5692 00D1A4                             LAB_29FB
   5693 00D1A4 F4 6F D3                     	PEA CONST_100000
   5694 00D1A7 20 C9 D2                     	JSR LOAD_FAC2	; load FAC2 with 100,000
   5695 00D1AA 68                           	PLA				; get rid of parameter
   5696 00D1AB AF 0E A2 FE                  	LDA FP_STATREG
   5697 00D1AF 89 04 00                     	BIT #$04		; Is FAC1 > 100,000 ?
   5698 00D1B2 F0 0F                        	BEQ	.0005		; branch if not
   5699 00D1B4 A9 11 00                     	LDA #FP_SWAP	; subtract is FAC2-FAC1!
   5700 00D1B7 20 14 D3                     	JSR FPCommandWait;
   5701 00D1BA A9 02 00                     	LDA #FP_SUB		; subtract 100,000 from the mantissa.
   5702 00D1BD 20 14 D3                     	JSR FPCommandWait
   5703 00D1C0 E8                           	INX				; increment the value of the digit
   5704 00D1C1 80 E1                        	BRA	LAB_29FB	; try again
   5705 00D1C3                             .0005:
   5706 00D1C3 8A                           	TXA
   5707 00D1C4 A4 C4                        	LDY	Sendl			; get output string index
   5708 00D1C6 C8                           	INY				; increment output string index
   5709 00D1C7 8A                           	TXA
   5710 00D1C8 99 A0 03                     	STA	Decss,Y		; save to output string
   5711 00D1CB C6 C0                        	DEC	numexp		; decrement # of characters before the dp
   5712 00D1CD D0 07                        	BNE	LAB_2A3B		; branch if still characters to do
                                           				; else output the point
   5714 00D1CF A9 2E 00                     	LDA	#'.'			; character "."
   5715 00D1D2 C8                           	INY				; increment output string index
   5716 00D1D3 99 A0 03                     	STA	Decss,Y		; save to output string
   5717 00D1D6                             LAB_2A3B
   5718 00D1D6 84 C4                        	STY	Sendl		; save output string index
                                           	; We subtracted until the value was < 100,000 so multiply the
                                           	; remainder upwards to get the next digit.
   5721 00D1D8 20 F4 D2                     	JSR	MultiplyByTen	; If not, multiply by 10
   5722 00D1DB C0 1B 00                     	CPY #27			; converted (+/- . incl)
   5723 00D1DE 90 C1                        	BCC	LAB_29F7
                                           					; now remove trailing zeroes
   5725 00D1E0                             .RemoveTrailingZeros
   5726 00D1E0 B9 A0 03                     	LDA	Decss,Y		; get character from output string
   5727 00D1E3 29 FF 00                     	AND	#$FF		; mask to a byte
   5728 00D1E6 88                           	DEY				; decrement output string index
   5729 00D1E7 C9 30 00                     	CMP	#'0'			; compare with "0"
   5730 00D1EA F0 F4                        	BEQ	.RemoveTrailingZeros	; loop until non "0" character found
                                           
   5732 00D1EC C9 2E 00                     	CMP	#'.'			; compare with "."
   5733 00D1EF F0 01                        	BEQ	LAB_2A58		; branch if was dp
                                           
                                           					; restore last character
   5736 00D1F1 C8                           	INY				; increment output string index
   5737 00D1F2                             LAB_2A58
   5738 00D1F2 A9 2B 00                     	LDA	#'+'			; character "+"
   5739 00D1F5 A6 C2                        	LDX	expcnt		; get exponent count
   5740 00D1F7 F0 FF A2 00                  	LBEQ	LAB_2A8C		; if zero go set null terminator and exit
                                           
                                           					; exponent isn't zero so write exponent
   5743 00D1FB 10 0A                        	BPL	LAB_2A68		; branch if exponent count +ve
                                           
   5745 00D1FD A9 00 00                     	LDA	#$00			; clear A
   5746 00D200 38                           	SEC				; set carry for subtract
   5747 00D201 E5 C2                        	SBC	expcnt		; subtract exponent count adjust (convert -ve to +ve)
   5748 00D203 AA                           	TAX				; copy exponent count to X
   5749 00D204 A9 2D 00                     	LDA	#'-'			; character "-"
                                           
                                           ; We must keep moving forwards through the string because the acc is storing
                                           ; two bytes.
                                           
   5754 00D207                             LAB_2A68
   5755 00D207 48                           	PHA
   5756 00D208 A9 45 00                     	LDA	#'E'			; character "E"
   5757 00D20B 99 A1 03                     	STA	Decss+1,Y		; save exponent sign to output string
   5758 00D20E 68                           	PLA
   5759 00D20F 99 A2 03                     	STA	Decss+2,Y		; save to output string
   5760 00D212 8A                           	TXA				; get exponent count back
                                           
                                           ; do highest exponent digit
   5763 00D213 64 C4                        	STZ Sendl
   5764 00D215 A2 2F 00                     	LDX	#'0'-1		; one less than "0" character
   5765 00D218 38                           	SEC				; set carry for subtract
   5766 00D219 E8                          .0001:				
   5767 00D21A E9 10 27                     	SBC	#10000
   5768 00D21D B0 FA                        	BCS .0001
   5769 00D21F 69 10 27                     	ADC #10000
   5770 00D222 E0 30 00                     	CPX #'0'
   5771 00D225 F0 09                        	BEQ .0005
   5772 00D227 E6 C4                        	INC Sendl
   5773 00D229 48                           	PHA
   5774 00D22A 8A                           	TXA
   5775 00D22B 99 A3 03                     	STA Decss+3,Y
   5776 00D22E 68                           	PLA
   5777 00D22F C8                           	INY
                                           ; do the next exponent digit
   5779 00D230                             .0005:
   5780 00D230 A2 2F 00                     	LDX #'0'-1
   5781 00D233 38                           	SEC
   5782 00D234                             .0002:
   5783 00D234 E8                           	INX
   5784 00D235 E9 E8 03                     	SBC #1000
   5785 00D238 B0 FA                        	BCS .0002
   5786 00D23A 69 E8 03                     	ADC #1000
   5787 00D23D 46 C4                        	LSR Sendl
   5788 00D23F B0 05                        	BCS .00010
   5789 00D241 E0 30 00                     	CPX #'0'
   5790 00D244 F0 09                        	BEQ .0006
   5791 00D246                             .00010:
   5792 00D246 E6 C4                        	INC Sendl
   5793 00D248 48                           	PHA
   5794 00D249 8A                           	TXA
   5795 00D24A 99 A3 03                     	STA Decss+3,Y
   5796 00D24D 68                           	PLA
   5797 00D24E C8                           	INY
                                           ; and the next
   5799 00D24F                             .0006:
   5800 00D24F A2 2F 00                     	LDX	#'0'-1
   5801 00D252 38                           	SEC
   5802 00D253                             .0003:
   5803 00D253 E8                           	INX
   5804 00D254 E9 64 00                     	SBC #100
   5805 00D257 B0 FA                        	BCS .0003
   5806 00D259 69 64 00                     	ADC #100
   5807 00D25C 46 C4                        	LSR Sendl
   5808 00D25E B0 05                        	BCS .00011
   5809 00D260 E0 30 00                     	CPX #'0'
   5810 00D263 F0 09                        	BEQ .0007
   5811 00D265                             .00011:
   5812 00D265 E6 C4                        	INC Sendl
   5813 00D267 48                           	PHA
   5814 00D268 8A                           	TXA
   5815 00D269 99 A3 03                     	STA Decss+3,Y
   5816 00D26C 68                           	PLA
   5817 00D26D C8                           	INY
                                           
   5819 00D26E                             .0007:
   5820 00D26E A2 2F 00                     	LDX #'0'-1
   5821 00D271 38                           	SEC
   5822 00D272                             .0004:
   5823 00D272 E8                           	INX
   5824 00D273 E9 0A 00                     	SBC #10
   5825 00D276 B0 FA                        	BCS .0004
   5826 00D278 69 0A 00                     	ADC #10
   5827 00D27B 46 C4                        	LSR Sendl
   5828 00D27D B0 05                        	BCS .00012
   5829 00D27F E0 30 00                     	CPX #'0'
   5830 00D282 F0 09                        	BEQ .0008
   5831 00D284                             .00012:
   5832 00D284 E6 C4                        	INC Sendl
   5833 00D286 48                           	PHA
   5834 00D287 8A                           	TXA
   5835 00D288 99 A3 03                     	STA Decss+3,Y
   5836 00D28B 68                           	PLA
   5837 00D28C C8                           	INY
                                           
   5839 00D28D                             .0008:
   5840 00D28D 69 30 00                     	ADC #'0'
   5841 00D290 99 A3 03                     	STA Decss+3,Y
   5842 00D293 A9 00 00                     	LDA	#$00			; set null terminator
   5843 00D296 99 A4 03                     	STA	Decss+4,Y		; save to output string
   5844 00D299 60                           	RTS					; go set string pointer (AY) and exit (branch always)
                                           
   5846 00D29A                             LAB_2A89
   5847 00D29A 99 A0 03                     	STA	Decss,Y		; save last character to output string
                                           					; set null terminator and exit
   5849 00D29D                             LAB_2A8C
   5850 00D29D A9 00 00                     	LDA	#$00			; set null terminator
   5851 00D2A0 99 A1 03                     	STA	Decss+1,Y		; save after last character
                                           
   5853 00D2A3                             LAB_2A91
                                           ;	LDA	#<Decssp1		; set result string low pointer
                                           ;	LDY	#>Decssp1		; set result string high pointer
   5856 00D2A3 60                           	RTS
                                           
   5858 00D2A4                             LAB_25FB:
   5859 00D2A4 A9 11 00                     	LDA		#FP_SWAP
   5860 00D2A7 20 14 D3                     	JSR		FPCommandWait
   5861 00D2AA A0 00 00                     	LDY		#0
   5862 00D2AD BB                           	TYX
   5863 00D2AE                             .0002:
   5864 00D2AE B3 03                        	LDA		(3,S),Y
   5865 00D2B0 9F 00 A2 FE                  	STA		FAC1,X
   5866 00D2B4 C8                           	INY
   5867 00D2B5 C8                           	INY
   5868 00D2B6 E8                           	INX
   5869 00D2B7 E8                           	INX
   5870 00D2B8 E0 0C 00                     	CPX		#12
   5871 00D2BB D0 F1                        	BNE		.0002
   5872 00D2BD A9 05 00                     	LDA		#FP_FIX2FLT
   5873 00D2C0 20 14 D3                     	JSR		FPCommandWait
   5874 00D2C3                             FMUL:
   5875 00D2C3 A9 03 00                     	LDA		#FP_MUL
   5876 00D2C6 4C 14 D3                     	JMP		FPCommandWait
   5877 00D2C9                             	
   5878 00D2C9 DA                           	PHX
   5879 00D2CA 5A                           	PHY
   5880 00D2CB A0 00 00                     	LDY		#0
   5881 00D2CE BB                           	TYX
   5882 00D2CF                             .0002:
   5883 00D2CF B3 07                        	LDA		(7,s),Y
   5884 00D2D1 9F 10 A2 FE                  	STA		FAC2,X
   5885 00D2D5 C8                           	INY
   5886 00D2D6 C8                           	INY
   5887 00D2D7 E8                           	INX
   5888 00D2D8 E8                           	INX
   5889 00D2D9 E0 0C 00                     	CPX		#12
   5890 00D2DC D0 F1                        	BNE		.0002
   5891 00D2DE 7A                           	PLY
   5892 00D2DF FA                           	PLX
   5893 00D2E0 60                           	RTS
   5894 00D2E1                             	
   5895 00D2E1 A9 06 00                     	LDA		#FP_FLT2FIX
   5896 00D2E4 4C 14 D3                     	JMP		FPCommandWait
   5897 00D2E7                             	
   5898 00D2E7 F4 9F D3                     	PEA		CONST_POINT5
   5899 00D2EA 20 C9 D2                     	JSR		LOAD_FAC2
   5900 00D2ED 68                           	PLA
   5901 00D2EE A9 01 00                     	LDA		#FP_ADD
   5902 00D2F1 4C 14 D3                     	JMP		FPCommandWait
   5903 00D2F4                             	
   5904 00D2F4 F4 87 D3                     	PEA		TEN_AS_FLOAT
   5905 00D2F7 20 C9 D2                     	JSR		LOAD_FAC2
   5906 00D2FA 68                           	PLA
   5907 00D2FB A9 03 00                     	LDA		#FP_MUL
   5908 00D2FE 4C 14 D3                     	JMP		FPCommandWait
                                           	
   5910 00D301 F4 87 D3                     	PEA		TEN_AS_FLOAT
   5911 00D304 20 C9 D2                     	JSR		LOAD_FAC2
   5912 00D307 68                           	PLA
   5913 00D308 20 11 D3                     	JSR		SwapFACs
   5914 00D30B A9 04 00                     	LDA		#FP_DIV
   5915 00D30E 4C 14 D3                     	JMP		FPCommandWait
   5916 00D311                             	
   5917 00D311 A9 11 00                     	LDA		#FP_SWAP
                                           
                                           ; Issue a command to the FP unit and wait for it to complete
                                           ;
                                           public FPCommandWait:
   5922 00D314 48                           	PHA
   5923 00D315 A9 06 00                     	LDA		#6
   5924 00D318 8D 00 70                     	STA		$7000
   5925 00D31B                             .0001:
   5926 00D31B AF 0E A2 FE                  	LDA		FP_STATREG	; get the status register
   5927 00D31F 89 80 00                     	BIT		#$80		; check for busy bit
   5928 00D322 D0 F7                        	BNE		.0001		; if busy go back
   5929 00D324 68                           	PLA					; to pop acc
   5930 00D325 8F 0E A2 FE                  	STA		FP_CMDREG	; store the command
   5931 00D329 48                           	PHA
   5932 00D32A A9 07 00                     	LDA		#7
   5933 00D32D 8D 00 70                     	STA		$7000
   5934 00D330 68                           	PLA
   5935 00D331 60                           	RTS
                                           
                                           ; Display the FAC1 as a hex number
                                           ;
                                           public DispFAC1:
   5940 00D332 AF 0A A2 FE                  	LDA FAC1_e
   5941 00D336 20 9E EB                     	JSR DispWord
   5942 00D339 AF 08 A2 FE                  	LDA	FAC1_1
   5943 00D33D 20 9E EB                     	JSR	DispWord
   5944 00D340 AF 06 A2 FE                  	LDA FAC1_2
   5945 00D344 20 9E EB                     	JSR	DispWord
   5946 00D347 AF 04 A2 FE                  	LDA FAC1_3
   5947 00D34B 20 9E EB                     	JSR DispWord
   5948 00D34E AF 02 A2 FE                  	LDA FAC1_4
   5949 00D352 20 9E EB                     	JSR DispWord
   5950 00D355 AF 00 A2 FE                  	LDA FAC1_5
   5951 00D359 20 9E EB                     	JSR DispWord
   5952 00D35C A9 20 00                     	LDA #' '
   5953 00D35F 20 BE EA                     	JSR OutChar
   5954 00D362 60                           	RTS
                                           ;
                                           ; 1,000,000 as a floating point number
                                           ;
   5958 00D363                             A_MILLION:	; $F4240
   5959 00D363 00 00                        	dw		$0000
   5960 00D365 00 00                        	dw		$0000
   5961 00D367 00 00                        	dw		$0000
   5962 00D369 00 00                        	dW		$0000
   5963 00D36B 12 7A                        	dw		$7A12
   5964 00D36D 13 80                        	dw		$8013
                                           
   5966 00D36F                             CONST_100000:
                                           	;186A0
   5968 00D36F 00 00                        	dw		$0000
   5969 00D371 00 00                        	dw		$0000
   5970 00D373 00 00                        	dw		$0000
   5971 00D375 00 00                        	dw		$0000
   5972 00D377 A8 61                        	dw		$61A8
   5973 00D379 10 80                        	dw		$8010
                                           ; The constant 999999.4375 as hex
                                           ; 01.11_1010_0001_0001_1111_1011_1000_00000000000000000000000000
   5976 00D37B                             MAX_BEFORE_SCI:
   5977 00D37B 00 00                        	dw  $0000
   5978 00D37D 00 00                        	dw  $0000
   5979 00D37F 00 00                        	dw	$0000
   5980 00D381 80 FB                        	dw	$FB80
   5981 00D383 11 7A                        	dw	$7A11
   5982 00D385 13 80                        	dw	$8013
                                           
   5984 00D387                             TEN_AS_FLOAT:
   5985 00D387 00 00                        	dw	$0000
   5986 00D389 00 00                        	dw	$0000
   5987 00D38B 00 00                        	dw	$0000
   5988 00D38D 00 00                        	dw	$0000
   5989 00D38F 00 50                        	dw	$5000
   5990 00D391 03 80                        	dw	$8003
                                           
                                           ; 99999.9375
                                           ; 01.10_0001_1010_0111_1111_1100_000000000000000000000000000000
                                           ;
   5995 00D393                             CONST_9375:
   5996 00D393 00 00                        	dw	$0000
   5997 00D395 00 00                        	dw	$0000
   5998 00D397 00 00                        	dw	$0000
   5999 00D399 00 FC                        	dw	$FC00
   6000 00D39B A7 61                        	dw	$61A7
   6001 00D39D 10 80                        	dw	$8010
                                           
                                           ; 0.5
   6004 00D39F                             CONST_POINT5:
   6005 00D39F 00 00                        	dw	$0000
   6006 00D3A1 00 00                        	dw	$0000
   6007 00D3A3 00 00                        	dw	$0000
   6008 00D3A5 00 00                        	dw	$0000
   6009 00D3A7 00 40                        	dw	$4000
   6010 00D3A9 FF 7F                        	dw	$7FFF
                                           
                                           ; This table is used in converting numbers to ASCII.
                                           
   6014 00D3AB                             LAB_2A9A
   6311 = 0000D3AC                         LAB_2A9B = LAB_2A9A+1
   6312 = 0000D3AD                         LAB_2A9C = LAB_2A9B+1
                                           ;	.word	$FFFF,$F21F,$494C,$589C,$0000
                                           ;	.word	$0000,$0163,$4578,$5D8A,$0000
                                           ;	.word	$FFFF,$FFDC,$790D,$903F,$0000
                                           ;	.word	$0000,$0003,$8D7E,$A4C6,$8000
                                           ;	.word	$FFFF,$FFFF,$A50C,$EF85,$C000
                                           ;	.word	$0000,$0000,$0918,$4E72,$A000
                                           ;	.word	$FFFF,$FFFF,$FF17,$2B5A,$F000
                                           ;	.word	$0000,$0000,$0017,$4876,$E800
                                           ;	.word	$FFFF,$FFFF,$FFFD,$ABF4,$1C00
                                           ;	.word	$0000,$0000,$0000,$3B9A,$CA00
                                           ;	.word	$FFFF,$FFFF,$FFFF,$FF67,$6980
                                           ;	.word	$0000,$0000,$0000,$05F5,$E100		; 100000000
                                           ;	.word	$0000,$0000,$0098,$9680		; 10000000
                                           ;	.word   $4240,$000F,$0000,$0000,$0000,$804E		; 1000000
   6031 00D3AB A0 86 01 00 00 00 00 00      	.word	$86A0,$0001,$0000,$0000,$0000,$804E		; 100000
   6031 00D3B3 00 00 4E 80                
   6032 00D3B7 10 27 00 00 00 00 00 00      	.word	$2710,$0000,$0000,$0000,$0000,$804E		; 10000
   6032 00D3BF 00 00 4E 80                
   6033 00D3C3 E8 03 00 00 00 00 00 00      	.word	$03E8,$0000,$0000,$0000,$0000,$804E		; 1000
   6033 00D3CB 00 00 4E 80                
   6034 00D3CF 64 00 00 00 00 00 00 00      	.word	$0064,$0000,$0000,$0000,$0000,$804E		; 100
   6034 00D3D7 00 00 4E 80                
   6035 00D3DB                             FIXED10:
   6036 00D3DB 0A 00 00 00 00 00 00 00      	.word	$000A,$0000,$0000,$0000,$0000,$804E		; 10
   6036 00D3E3 00 00 4E 80                
   6037 00D3E7 01 00 00 00 00 00 00 00      	.word	$0001,$0000,$0000,$0000,$0000,$804E		; 1
   6037 00D3EF 00 00 4E 80                
                                           
                                           		 MEM	16
                                           		 NDX	16
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
FTBios816.asm


                                           .include "FAC1ToString.asm"
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
invaders.asm

                                           	CPU		FT832
                                           
   6346 = 0000000000FEA100                               PRNG		EQU		$FEA100
   6347 = 0000000000FEA108                               PRNG_NUM	EQU		$FEA108
   6348 = 0000000000FEA10E                               PRNG_ADV	EQU		$FEA10E
   6349 = 0000000000000001                               MAN_EXPLODING	EQU		1
                                           
                                           ; which invaders are still active (not destroyed)
                                           ; These var addresses are segment offsets into seg $7800
   6353 = 0000000000000000                               active				EQU		$00
   6354 = 000000000000005E                               left_right			EQU		$5E
   6355 = 0000000000000060                               rightmost_column	EQU		$60
   6356 = 0000000000000062                               leftmost_column		EQU		$62
   6357 = 0000000000000064                               bottom_row			EQU		$64
   6358 = 0000000000000066                               top_row				EQU		$66
   6359 = 000000000000006A                               inv_tick			EQU		$6A
   6360 = 000000000000006C                               inv_tick2			EQU		$6C
   6361 = 000000000000006E                               manX				EQU		$6E
   6362 = 0000000000000070                               manY				EQU		$70
   6363 = 0000000000000072                               manState			EQU		$72
   6364 = 0000000000000100                               InvadersX			EQU		$100
   6365 = 0000000000000200                               InvadersY			EQU		$200
   6366 = 0000000000000300                               min_right			EQU		$300
   6367 = 0000000000000310                               max_left			EQU		$310
   6368 = 0000000000000320                               bombX				EQU		$320
   6369 = 0000000000000330                               bombY				EQU		$330
   6370 = 0000000000000400                               inv_state			EQU		$400
                                           
                                           ; This var is shared, must be referenced ZS:
   6373 = 0000000000007868                               do_invaders			EQU		$7868
                                           
                                           	; minimum right +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6075 00D3F3                             st_min_right:
   6076 00D3F3 01 00                        	.word	1
   6077 00D3F5 05 00                        	.word	5
   6078 00D3F7 09 00                        	.word	9
   6079 00D3F9 0D 00                        	.word	13
   6080 00D3FB 11 00                        	.word	17
   6081 00D3FD 15 00                        	.word	21
   6082 00D3FF 19 00                        	.word	25
   6083 00D401 1D 00                        	.word	29
                                           
                                           	; maximum left +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6087 00D403 34 00                        	.word	52
   6088 00D405 38 00                        	.word	56
   6089 00D407 3C 00                        	.word	60
   6090 00D409 40 00                        	.word	64
   6091 00D40B 44 00                        	.word	68
   6092 00D40D 48 00                        	.word	72
   6093 00D40F 4C 00                        	.word	76
   6094 00D411 50 00                        	.word	80
                                           
   6096 00D413 00 00                        	.word	0		; rightmost column
   6097 00D415 07 00                        	.word	7		; lefmost column
   6098 00D417 01 00                        	.word	1		; dx
                                           
                                           	MEM		16
                                           	NDX		16
                                           
                                           	code
                                           
   6105 00D419                             InvBomb:
   6106 00D419 A2 00 00                     	LDX		#0
   6107 00D41C                             .0001:
   6108 00D41C B5 00                        	LDA		active,X
   6109 00D41E F0 27                        	BEQ		.0002
   6110 00D420 20 F8 D4                     	JSR		CanDropBomb
   6111 00D423 F0 22                        	BEQ		.0002
   6112 00D425 42 5B AF 08 A1 FE            	LDA		ZS:PRNG_NUM
   6113 00D42B 42 5B 8F 0E A1 FE            	STA		ZS:PRNG_ADV
   6114 00D431 29 63 00                     	AND		#$63
   6115 00D434 D0 11                        	BNE		.0002
   6116 00D436 20 4F D4                     	JSR		FindEmptyBomb
   6117 00D439 30 13                        	BMI		.0003
   6118 00D43B BD 00 01                     	LDA		InvadersX,X
   6119 00D43E 99 20 03                     	STA		bombX,Y
   6120 00D441 BD 00 02                     	LDA		InvadersY,X
   6121 00D444 99 30 03                     	STA		bombY,Y
   6122 00D447                             .0002:
   6123 00D447 E8                           	INX
   6124 00D448 E8                           	INX
   6125 00D449 E0 50 00                     	CPX		#80
   6126 00D44C 30 CE                        	BMI		.0001
   6127 00D44E                             .0003:
   6128 00D44E 60                           	RTS
                                           
   6130 00D44F                             FindEmptyBomb:
   6131 00D44F A0 00 00                     	LDY		#0
   6132 00D452                             .0001:
   6133 00D452 B9 20 03                     	LDA		bombX,Y
   6134 00D455 F0 0A                        	BEQ		.0002
   6135 00D457 C8                           	INY
   6136 00D458 C8                           	INY
   6137 00D459 C0 10 00                     	CPY		#16
   6138 00D45C 30 F4                        	BMI		.0001
   6139 00D45E A0 FF FF                     	LDY		#-1
   6140 00D461                             .0002:
   6141 00D461 60                           	RTS
                                           
   6143 00D462                             MoveBombs:
   6144 00D462 A2 00 00                     	LDX		#0
   6145 00D465                             .0002:
   6146 00D465 BD 20 03                     	LDA		bombX,X
   6147 00D468 F0 14                        	BEQ		.0001
   6148 00D46A BD 30 03                     	LDA		bombY,X
   6149 00D46D C9 1E 00                     	CMP		#30			; has the bomb fallen all the way to the ground ?
   6150 00D470 10 06                        	BPL		.0003		; if yes, reset bomb
   6151 00D472 1A                           	INA
   6152 00D473 9D 30 03                     	STA		bombY,X
   6153 00D476 80 06                        	BRA		.0001
   6154 00D478                             .0003:
   6155 00D478 9E 20 03                     	STZ		bombX,X
   6156 00D47B 9E 30 03                     	STZ		bombY,X
   6157 00D47E                             .0001:
   6158 00D47E E8                           	INX
   6159 00D47F E8                           	INX
   6160 00D480 E0 10 00                     	CPX		#16
   6161 00D483 30 E0                        	BMI		.0002
   6162 00D485 60                           	RTS
                                           
   6164 00D486                             GetBombOffset:
   6165 00D486 B9 30 03                     	LDA		bombY,Y
   6166 00D489 0A                           	ASL
   6167 00D48A AA                           	TAX
   6168 00D48B 42 5B BD F2 F5               	LDA		ZS:LineTbl,X
   6169 00D490 18                           	CLC
   6170 00D491 79 20 03                     	ADC		bombX,Y
   6171 00D494 79 20 03                     	ADC		bombX,Y
   6172 00D497 AA                           	TAX
   6173 00D498 60                           	RTS
                                           
   6175 00D499                             RenderBombs:
   6176 00D499 A0 00 00                     	LDY		#0
   6177 00D49C                             .0001:
   6178 00D49C B9 30 03                     	LDA		bombY,Y
   6179 00D49F F0 0C                        	BEQ		.0002
   6180 00D4A1 20 86 D4                     	JSR		GetBombOffset
   6181 00D4A4 A9 24 00                     	LDA		#'$'
   6182 00D4A7 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6183 00D4AD                             .0002:
   6184 00D4AD C8                           	INY
   6185 00D4AE C8                           	INY
   6186 00D4AF C0 10 00                     	CPY		#16
   6187 00D4B2 30 E8                        	BMI		.0001
   6188 00D4B4 60                           	RTS
                                           
   6190 00D4B5                             TestBombsIntercept:
   6191 00D4B5 A0 00 00                     	LDY		#0
   6192 00D4B8                             .0001:
   6193 00D4B8 20 C3 D4                     	JSR		TestBombIntercept
   6194 00D4BB C8                           	INY
   6195 00D4BC C8                           	INY
   6196 00D4BD C0 10 00                     	CPY		#16
   6197 00D4C0 30 F6                        	BMI		.0001
   6198 00D4C2 60                           	RTS
                                           
   6200 00D4C3                             TestBombIntercept:
   6201 00D4C3 20 86 D4                     	JSR		GetBombOffset
   6202 00D4C6 42 5B BF 00 00 0D            	LDA		ZS:VIDBUF,X
   6203 00D4CC C9 20 00                     	CMP		#' '
   6204 00D4CF F0 1D                        	BEQ		.0001
   6205 00D4D1 B9 30 03                     	LDA		bombY,Y
   6206 00D4D4 C9 1D 00                     	CMP		#29
   6207 00D4D7 D0 16                        	BNE		.0002
   6208 00D4D9 B9 20 03                     	LDA		bombX,Y
   6209 00D4DC D9 6E 00                     	CMP		manX,Y
   6210 00D4DF D0 05                        	BNE		.0003
   6211 00D4E1 A9 01 00                     	LDA		#MAN_EXPLODING
   6212 00D4E4 85 72                        	STA		manState
   6213 00D4E6                             .0003:
   6214 00D4E6 BB                           	TYX
   6215 00D4E7 9E 30 03                     	STZ		bombY,X
   6216 00D4EA 9E 20 03                     	STZ		bombX,X
   6217 00D4ED 60                           	RTS
   6218 00D4EE                             .0001:
   6219 00D4EE 60                           	RTS
   6220 00D4EF                             .0002:
   6221 00D4EF A9 20 00                     	LDA		#' '
   6222 00D4F2 9F 00 00 0D                  	STA		VIDBUF,X
   6223 00D4F6 80 EE                        	BRA		.0003
                                           
                                           ; An invader can drop a bomb only if there are no invaders underneath it.
                                           
   6227 00D4F8                             CanDropBomb:
   6228 00D4F8 E0 0F 00                     	CPX		#15
   6229 00D4FB 10 0C                        	BGE		.0001
   6230 00D4FD B5 10                        	LDA		active+16,X
   6231 00D4FF 15 20                        	ORA		active+32,X
   6232 00D501 15 30                        	ORA		active+48,X
   6233 00D503 15 40                        	ORA		active+64,X
   6234 00D505 49 01 00                     	EOR		#1
   6235 00D508 60                           	RTS
   6236 00D509                             .0001:
   6237 00D509 E0 1F 00                     	CPX		#31
   6238 00D50C 10 0A                        	BGE		.0002
   6239 00D50E B5 10                        	LDA		active+16,X
   6240 00D510 15 20                        	ORA		active+32,X
   6241 00D512 15 30                        	ORA		active+48,X
   6242 00D514 49 01 00                     	EOR		#1
   6243 00D517 60                           	RTS
   6244 00D518                             .0002:
   6245 00D518 E0 2F 00                     	CPX		#47
   6246 00D51B 10 08                        	BGE		.0003
   6247 00D51D B5 10                        	LDA		active+16,X
   6248 00D51F 15 20                        	ORA		active+32,X
   6249 00D521 49 01 00                     	EOR		#1
   6250 00D524 60                           	RTS
   6251 00D525                             .0003:
   6252 00D525 E0 3F 00                     	CPX		#63
   6253 00D528 10 06                        	BGE		.0004
   6254 00D52A B5 10                        	LDA		active+16,X
   6255 00D52C 49 01 00                     	EOR		#1
   6256 00D52F 60                           	RTS
   6257 00D530                             .0004:
   6258 00D530 A9 01 00                     	LDA		#1
   6259 00D533 60                           	RTS
                                           
                                           
                                           ; Test if it's possible to move to the left anymore.
                                           ;
   6264 00D534                             CanMoveLeft:
   6265 00D534 A5 62                        	LDA		leftmost_column
   6266 00D536 0A                           	ASL
   6267 00D537 AA                           	TAX
   6268 00D538 BD 10 03                     	LDA		max_left,X
   6269 00D53B DD 00 01                     	CMP		InvadersX,X
   6270 00D53E 30 04                        	BMI		.0001
   6271 00D540 A9 00 00                     	LDA		#0
   6272 00D543 60                           	RTS
   6273 00D544                             .0001:
   6274 00D544 A9 01 00                     	LDA		#1
   6275 00D547 60                           	RTS
                                           
                                           ; Test if it's possible to move to the right anymore.
                                           ;
   6279 00D548                             CanMoveRight:
   6280 00D548 A5 60                        	LDA		rightmost_column
   6281 00D54A 0A                           	ASL
   6282 00D54B AA                           	TAX
   6283 00D54C BD 00 03                     	LDA		min_right,X
   6284 00D54F DD 00 01                     	CMP		InvadersX,X
   6285 00D552 10 04                        	BPL		.0001
   6286 00D554 A9 00 00                     	LDA		#0
   6287 00D557 60                           	RTS
   6288 00D558                             .0001:
   6289 00D558 A9 01 00                     	LDA		#1
   6290 00D55B 60                           	RTS
                                           
                                           ; Test if it's possible to move down anymore
                                           ;
   6294 00D55C                             CanMoveDown:
   6295 00D55C A5 64                        	LDA		bottom_row
   6296 00D55E 0A                           	ASL
   6297 00D55F 0A                           	ASL
   6298 00D560 0A                           	ASL
   6299 00D561 0A                           	ASL
   6300 00D562 AA                           	TAX
   6301 00D563 BD 00 02                     	LDA		InvadersY,X
   6302 00D566 C9 1E 00                     	CMP		#30
   6303 00D569 30 04                        	BMI		.0001
   6304 00D56B A9 00 00                     	LDA		#0
   6305 00D56E 60                           	RTS
   6306 00D56F                             .0001:
   6307 00D56F A9 01 00                     	LDA		#1
   6308 00D572 60                           	RTS
                                           
                                           ; Move all the invaders to the left
                                           ; Means incrementing the X co-ordinate
                                           ;
   6313 00D573                             MoveLeft:
   6314 00D573 A2 00 00                     	LDX		#00
   6315 00D576                             .0002:
   6316 00D576 FE 00 01                     	INC		InvadersX,X
   6317 00D579 E8                           	INX
   6318 00D57A E8                           	INX
   6319 00D57B E0 50 00                     	CPX		#80
   6320 00D57E D0 F6                        	BNE		.0002
   6321 00D580 60                           	RTS
                                           
                                           ; Move all the invaders to the right.
                                           ; means decrementing the X co-ordinate
                                           ;
   6326 00D581                             MoveRight:
   6327 00D581 A2 00 00                     	LDX		#0
   6328 00D584                             .0002:
   6329 00D584 DE 00 01                     	DEC		InvadersX,X
   6330 00D587 E8                           	INX
   6331 00D588 E8                           	INX
   6332 00D589 E0 50 00                     	CPX		#80
   6333 00D58C D0 F6                        	BNE		.0002
   6334 00D58E 60                           	RTS
                                           
                                           ; Move all the invaders down a row.
                                           ; Means incrementing the Y co-ordinate
                                           ;
   6339 00D58F                             MoveDown:
   6340 00D58F A2 00 00                     	LDX		#00
   6341 00D592                             .0002:
   6342 00D592 FE 00 02                     	INC		InvadersY,X
   6343 00D595 E8                           	INX
   6344 00D596 E8                           	INX
   6345 00D597 E0 50 00                     	CPX		#80
   6346 00D59A D0 F6                        	BNE		.0002
   6347 00D59C 60                           	RTS
                                           
                                           ; Move the invaders
                                           ; Retuns
                                           ; .A = 1 if it was possible to do a move, 0 otherwise
                                           ;
   6353 00D59D                             Move:
   6354 00D59D 24 5E                        	BIT		left_right
   6355 00D59F 30 0A                        	BMI		.0002
   6356 00D5A1 20 34 D5                     	JSR		CanMoveLeft
   6357 00D5A4 F0 0F                        	BEQ		.0001
   6358 00D5A6 20 73 D5                     	JSR		MoveLeft
   6359 00D5A9 80 19                        	BRA		.0003
   6360 00D5AB                             .0002:
   6361 00D5AB 20 48 D5                     	JSR		CanMoveRight
   6362 00D5AE F0 05                        	BEQ		.0001
   6363 00D5B0 20 81 D5                     	JSR		MoveRight
   6364 00D5B3 80 0F                        	BRA		.0003
   6365 00D5B5                             .0001:
   6366 00D5B5 20 5C D5                     	JSR		CanMoveDown
   6367 00D5B8 F0 0E                        	BEQ		.0004
   6368 00D5BA A5 5E                        	LDA		left_right
   6369 00D5BC 49 FF FF                     	EOR		#$FFFF
   6370 00D5BF 85 5E                        	STA		left_right
   6371 00D5C1 20 8F D5                     	JSR		MoveDown
   6372 00D5C4                             .0003:
   6373 00D5C4 A9 01 00                     	LDA		#1
   6374 00D5C7 60                           	RTS
   6375 00D5C8                             .0004:
   6376 00D5C8 A9 00 00                     	LDA		#0
   6377 00D5CB 60                           	RTS
                                           
   6379 00D5CC                             Initialize:
   6380 00D5CC 64 60                        	STZ		rightmost_column
   6381 00D5CE A9 07 00                     	LDA		#7
   6382 00D5D1 85 62                        	STA		leftmost_column
   6383 00D5D3 64 66                        	STZ		top_row
   6384 00D5D5 A9 04 00                     	LDA		#4
   6385 00D5D8 85 64                        	STA		bottom_row
   6386 00D5DA 64 5E                        	STZ		left_right
   6387 00D5DC 20 24 D6                     	JSR		ActivateAllInvaders
   6388 00D5DF A2 00 00                     	LDX		#0
   6389 00D5E2                             .0001:
   6390 00D5E2 42 1B BD 37 DA               	LDA		CS:StartX,X
   6391 00D5E7 9D 00 01                     	STA		InvadersX,X
   6392 00D5EA 42 1B BD E7 D9               	LDA		CS:StartY,X
   6393 00D5EF 9D 00 02                     	STA		InvadersY,X
   6394 00D5F2 E8                           	INX
   6395 00D5F3 E8                           	INX
   6396 00D5F4 E0 50 00                     	CPX		#80
   6397 00D5F7 30 E9                        	BMI		.0001
   6398 00D5F9 A2 00 00                     	LDX		#0
   6399 00D5FC                             .0002:
   6400 00D5FC 42 1B BD F3 D3               	LDA		CS:st_min_right,X
   6401 00D601 9D 00 03                     	STA		min_right,X
   6402 00D604 E8                           	INX
   6403 00D605 E8                           	INX
   6404 00D606 E0 20 00                     	CPX		#32
   6405 00D609 30 F1                        	BMI		.0002
                                           	; Initialize Bombs
   6407 00D60B A2 00 00                     	LDX		#0
   6408 00D60E                             .0003:
   6409 00D60E 9E 20 03                     	STZ		bombX,X
   6410 00D611 9E 30 03                     	STZ		bombY,X
   6411 00D614 E8                           	INX
   6412 00D615 E8                           	INX
   6413 00D616 E0 10 00                     	CPX		#16
   6414 00D619 30 F3                        	BMI		.0003
   6415 00D61B A9 FE FF                     	LDA		#$FFFE
   6416 00D61E 42 5B 8D 68 78               	STA		ZS:do_invaders
   6417 00D623 60                           	RTS
                                           
   6419 00D624                             ActivateAllInvaders:
   6420 00D624 A2 00 00                     	LDX		#0
   6421 00D627 A9 01 00                     	LDA		#1
   6422 00D62A                             .0001:
   6423 00D62A 95 00                        	STA		active,X
   6424 00D62C E8                           	INX
   6425 00D62D E8                           	INX
   6426 00D62E E0 50 00                     	CPX		#80
   6427 00D631 D0 F7                        	BNE		.0001
   6428 00D633 60                           	RTS
                                           
   6430 00D634                             IsAllDestroyed:
   6431 00D634 20 BC D6                     	JSR		IsRightmostColumnDestroyed
   6432 00D637 F0 2C                        	BEQ		.0001
   6433 00D639 E6 60                        	INC		rightmost_column
   6434 00D63B AD 0C 03                     	LDA		min_right+12
   6435 00D63E 8D 0E 03                     	STA		min_right+14
   6436 00D641 AD 0A 03                     	LDA		min_right+10
   6437 00D644 8D 0C 03                     	STA		min_right+12
   6438 00D647 AD 08 03                     	LDA		min_right+8
   6439 00D64A 8D 0A 03                     	STA		min_right+10
   6440 00D64D AD 06 03                     	LDA		min_right+6
   6441 00D650 8D 08 03                     	STA		min_right+8
   6442 00D653 AD 04 03                     	LDA		min_right+4
   6443 00D656 8D 06 03                     	STA		min_right+6
   6444 00D659 AD 02 03                     	LDA		min_right+2
   6445 00D65C 8D 04 03                     	STA		min_right+4
   6446 00D65F AD 00 03                     	LDA		min_right
   6447 00D662 8D 02 03                     	STA		min_right+2
   6448 00D665                             .0001:
   6449 00D665 20 B8 D6                     	JSR		IsLeftmostColumnDestroyed
   6450 00D668 F0 2C                        	BEQ		.0002
   6451 00D66A C6 62                        	DEC		leftmost_column
   6452 00D66C AD 12 03                     	LDA		max_left+2
   6453 00D66F 8D 10 03                     	STA		max_left
   6454 00D672 AD 14 03                     	LDA		max_left+4
   6455 00D675 8D 12 03                     	STA		max_left+2
   6456 00D678 AD 16 03                     	LDA		max_left+6
   6457 00D67B 8D 14 03                     	STA		max_left+4
   6458 00D67E AD 18 03                     	LDA		max_left+8
   6459 00D681 8D 16 03                     	STA		max_left+6
   6460 00D684 AD 1A 03                     	LDA		max_left+10
   6461 00D687 8D 18 03                     	STA		max_left+8
   6462 00D68A AD 1C 03                     	LDA		max_left+12
   6463 00D68D 8D 1A 03                     	STA		max_left+10
   6464 00D690 AD 1E 03                     	LDA		max_left+14
   6465 00D693 8D 1C 03                     	STA		max_left+12
   6466 00D696                             .0002:
   6467 00D696 A5 62                        	LDA		leftmost_column
   6468 00D698 C5 60                        	CMP		rightmost_column
   6469 00D69A 30 18                        	BMI		.allDestroyed
   6470 00D69C 20 D8 D6                     	JSR		IsBottomRowDestroyed
   6471 00D69F F0 02                        	BEQ		.0003
   6472 00D6A1 C6 64                        	DEC		bottom_row
   6473 00D6A3                             .0003:
   6474 00D6A3 20 D4 D6                     	JSR		IsTopRowDestroyed
   6475 00D6A6 F0 02                        	BEQ		.0004
   6476 00D6A8 E6 66                        	INC		top_row
   6477 00D6AA                             .0004:
   6478 00D6AA A5 64                        	LDA		bottom_row
   6479 00D6AC C5 66                        	CMP		top_row
   6480 00D6AE 30 04                        	BMI		.allDestroyed
   6481 00D6B0 A9 00 00                     	LDA		#0
   6482 00D6B3 60                           	RTS
   6483 00D6B4                             .allDestroyed:
   6484 00D6B4 A9 01 00                     	LDA		#1
   6485 00D6B7 60                           	RTS
                                           
                                           
   6488 00D6B8                             IsLeftmostColumnDestroyed:
   6489 00D6B8 A5 62                        	LDA		leftmost_column
   6490 00D6BA 80 02                        	BRA		IsColumnDestroyed
   6491 00D6BC                             IsRightmostColumnDestroyed:
   6492 00D6BC A5 60                        	LDA		rightmost_column
   6493 00D6BE                             IsColumnDestroyed:
   6494 00D6BE 0A                           	ASL
   6495 00D6BF AA                           	TAX
   6496 00D6C0 B5 00                        	LDA		active,X
   6497 00D6C2 15 10                        	ORA		active+16,X
   6498 00D6C4 15 20                        	ORA		active+32,X
   6499 00D6C6 15 30                        	ORA		active+48,X
   6500 00D6C8 15 40                        	ORA		active+64,X
   6501 00D6CA 15 50                        	ORA		active+80,X
   6502 00D6CC 15 60                        	ORA		active+96,X
   6503 00D6CE 15 70                        	ORA		active+112,X
   6504 00D6D0 49 01 00                     	EOR		#1
   6505 00D6D3 60                           	RTS
                                           
   6507 00D6D4                             IsTopRowDestroyed:
   6508 00D6D4 A5 66                        	LDA		top_row
   6509 00D6D6 80 02                        	BRA		IsRowDestroyed
   6510 00D6D8                             IsBottomRowDestroyed:
   6511 00D6D8 A5 64                        	LDA		bottom_row
   6512 00D6DA                             IsRowDestroyed:
   6513 00D6DA 0A                           	ASL
   6514 00D6DB 0A                           	ASL
   6515 00D6DC 0A                           	ASL
   6516 00D6DD 0A                           	ASL
   6517 00D6DE B5 00                        	LDA		active,X
   6518 00D6E0 15 02                        	ORA		active+2,X
   6519 00D6E2 15 04                        	ORA		active+4,X
   6520 00D6E4 15 06                        	ORA		active+6,X
   6521 00D6E6 15 08                        	ORA		active+8,X
   6522 00D6E8 15 0A                        	ORA		active+10,X
   6523 00D6EA 15 0C                        	ORA		active+12,X
   6524 00D6EC 15 0E                        	ORA		active+14,X
   6525 00D6EE 49 01 00                     	EOR		#1
   6526 00D6F1 60                           	RTS
                                           
                                           ; TickCount counts 1/100 of a second. We want to animate the graphics at a much
                                           ; slower rate, so we use bit 6 of the tick count to indicate when to animate.
                                           ;
   6531 00D6F2                             ShiftTick:
   6532 00D6F2 42 5B A5 04                  	LDA		ZS:TickCount
   6533 00D6F6 4A                           	LSR
   6534 00D6F7 4A                           	LSR
   6535 00D6F8 4A                           	LSR
   6536 00D6F9 4A                           	LSR
   6537 00D6FA 4A                           	LSR
   6538 00D6FB 4A                           	LSR
   6539 00D6FC 60                           	RTS
                                           
   6541 00D6FD                             RenderInvaders:
                                           	; First, clear the screen
   6543 00D6FD A2 00 00                     	LDX		#0
   6544 00D700 A9 20 00                     	LDA		#' '
   6545 00D703 09 00 BF                     	ORA		#$BF00
   6546 00D706                             .0003:
   6547 00D706 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6548 00D70C E8                           	INX
   6549 00D70D E8                           	INX
   6550 00D70E E0 58 14                     	CPX		#84*31*2
   6551 00D711 30 F3                        	BMI		.0003
   6552 00D713 A2 00 00                     	LDX		#0
   6553 00D716                             .0002:
   6554 00D716 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   6557 00D718 B5 00                        	LDA		active,X
   6558 00D71A F0 FF BD 01                  	LBEQ	.0001
   6559 00D71E BD 00 04                     	LDA		inv_state,X
   6560 00D721 BD 00 02                     	LDA		InvadersY,X
   6561 00D724 0A                           	ASL
   6562 00D725 A8                           	TAY
   6563 00D726 42 5B B9 F2 F5               	LDA		ZS:LineTbl,Y
   6564 00D72B 18                           	CLC
   6565 00D72C 7D 00 01                     	ADC		InvadersX,X
   6566 00D72F 18                           	CLC
   6567 00D730 7D 00 01                     	ADC		InvadersX,X
   6568 00D733 A8                           	TAY
   6569 00D734 E2 20                        	SEP		#$20			; eight bit acc
                                           	MEM		8
   6571 00D736 42 1B BD 87 DA               	LDA		CS:InvaderType,X
   6572 00D73B C9 01                        	CMP		#1
   6573 00D73D D0 46                        	BNE		.0004
   6574 00D73F A9 E9                        	LDA		#233
   6575 00D741 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6576 00D749 A9 F2                        	LDA		#242
   6577 00D74B 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6578 00D753 A9 DF                        	LDA		#223
   6579 00D755 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6580 00D75D 20 F2 D6                     	JSR		ShiftTick
   6581 00D760 90 04                        	BCC		.0005
   6582 00D762 A9 58                        	LDA		#'X'
   6583 00D764 80 02                        	BRA		.0006
   6584 00D766                             .0005:
   6585 00D766 A9 56                        	LDA		#'V'
   6586 00D768                             .0006:
   6587 00D768 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6588 00D770 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6589 00D778 A9 20                        	LDA		#' '
   6590 00D77A 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6591 00D782 82 E4 00                     	BRL		.0007
   6592 00D785                             .0004:
   6593 00D785 C9 02                        	CMP		#2
   6594 00D787 D0 FF 83 00                  	LBNE	.0008
   6595 00D78B 20 F2 D6                     	JSR		ShiftTick
   6596 00D78E 90 3F                        	BCC		.0009
   6597 00D790 A9 FC                        	LDA		#252
   6598 00D792 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6599 00D79A A9 99                        	LDA		#153
   6600 00D79C 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6601 00D7A4 A9 FE                        	LDA		#254
   6602 00D7A6 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6603 00D7AE A9 E2                        	LDA		#226
   6604 00D7B0 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6605 00D7B8 A9 62                        	LDA		#98
   6606 00D7BA 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6607 00D7C2 A9 E2                        	LDA		#226
   6608 00D7C4 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6609 00D7CC 82 9A 00                     	BRL		.0007
   6610 00D7CF                             .0009:
   6611 00D7CF A9 62                        	LDA		#98
   6612 00D7D1 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6613 00D7D9 A9 99                        	LDA		#153
   6614 00D7DB 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6615 00D7E3 A9 62                        	LDA		#98
   6616 00D7E5 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6617 00D7ED A9 EC                        	LDA		#236
   6618 00D7EF 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6619 00D7F7 A9 62                        	LDA		#98
   6620 00D7F9 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6621 00D801 A9 FB                        	LDA		#251
   6622 00D803 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6623 00D80B 82 5B 00                     	BRL		.0007
   6624 00D80E                             .0008:
   6625 00D80E A9 FF                        	LDA		#255
   6626 00D810 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6627 00D818 A9 F8                        	LDA		#248
   6628 00D81A 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6629 00D822 A9 7F                        	LDA		#127
   6630 00D824 42 5B 99 1D D8               	STA		ZS:VIDBUf+4,Y
   6631 00D829 20 F2 D6                     	JSR		ShiftTick
   6632 00D82C 90 20                        	BCC		.0010
   6633 00D82E A9 FF                        	LDA		#255
   6634 00D830 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6635 00D838 A9 F9                        	LDA		#249
   6636 00D83A 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6637 00D842 A9 7F                        	LDA		#127
   6638 00D844 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6639 00D84C 80 1B                        	BRA		.0007
   6640 00D84E                             .0010:
   6641 00D84E A9 E1                        	LDA		#225
   6642 00D850 42 5B 99 6D D8               	STA		ZS:VIDBUf+84,Y
   6643 00D855 A9 F9                        	LDA		#249
   6644 00D857 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6645 00D85F A9 60                        	LDA		#96
   6646 00D861 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6647 00D869                             .0007:
                                           	; Surround the alien with spaces
   6649 00D869 A9 20                        	LDA		#' '
   6650 00D86B 42 5B 42 99 AA FF 0C 00      	STA		ZS:VIDBUF-86,Y
                                         
   6651 00D873 42 5B 42 99 AC FF 0C 00      	STA		ZS:VIDBUF-84,Y
                                         
   6652 00D87B 42 5B 42 99 AE FF 0C 00      	STA		ZS:VIDBUF-82,Y
                                         
   6653 00D883 42 5B 42 99 B0 FF 0C 00      	STA		ZS:VIDBUF-80,Y
                                         
   6654 00D88B 42 5B 42 99 B2 FF 0C 00      	STA		ZS:VIDBUF-78,Y
                                         
   6655 00D893 42 5B 42 99 FE FF 0C 00      	STA		ZS:VIDBUF-2,Y
                                         
   6656 00D89B 42 5B 42 99 06 00 0D 00      	STA		ZS:VIDBUF+6,Y
                                         
   6657 00D8A3 42 5B 42 99 52 00 0D 00      	STA		ZS:VIDBUF+82,Y
                                         
   6658 00D8AB 42 5B 42 99 5A 00 0D 00      	STA		ZS:VIDBUF+90,Y
                                         
   6659 00D8B3 42 5B 42 99 A6 00 0D 00      	STA		ZS:VIDBUF+166,Y
                                         
   6660 00D8BB 42 5B 42 99 A8 00 0D 00      	STA		ZS:VIDBUF+168,Y
                                         
   6661 00D8C3 42 5B 42 99 AA 00 0D 00      	STA		ZS:VIDBUF+170,Y
                                         
   6662 00D8CB 42 5B 42 99 AC 00 0D 00      	STA		ZS:VIDBUF+172,Y
                                         
   6663 00D8D3 42 5B 42 99 AE 00 0D 00      	STA		ZS:VIDBUF+174,Y
                                         
   6664 00D8DB                             .0001:
   6665 00D8DB E8                           	INX
   6666 00D8DC E8                           	INX
   6667 00D8DD E0 50 00                     	CPX		#80
   6668 00D8E0 D0 FF 32 FE                  	LBNE	.0002
   6669 00D8E4 C2 20                        	REP		#$20
                                           	MEM		16
   6671 00D8E6 60                           	RTS
                                           
                                           public InvadersTask:
   6674 00D8E7                             .0001:
   6675 00D8E7 F4 00 00                     	PEA		0				; set data segment to $7800
   6676 00D8EA F4 00 78                     	PEA		$7800
   6677 00D8ED 42 2B                        	PLDS
   6678 00D8EF A9 FF 2B                     	LDA		#$2BFF			; set stack to $2BFF
   6679 00D8F2 1B                           	TAS
   6680 00D8F3 20 CC D5                     	JSR		Initialize
   6681 00D8F6 42 E2 00 10                  	SEP		#$1000			; turn on single step mode
   6682 00D8FA 20 FD D6                     	JSR		RenderInvaders
   6683 00D8FD                             .0002:
   6684 00D8FD 42 20 12 EE 07               	JCR 	KeybdGetCharNoWaitCtx,7	; check for char at keyboard
   6685 00D902                             .0004:
   6686 00D902 A2 00 00                     	LDX		#0
   6687 00D905                             .0006:
   6688 00D905 E8                           	INX
   6689 00D906 E0 D0 07                     	CPX		#2000
   6690 00D909 D0 FA                        	BNE		.0006
   6691 00D90B 42 5B A5 04                  	LDA		ZS:TickCount
   6692 00D90F 29 03 00                     	AND		#$3
   6693 00D912 D0 E9                        	BNE		.0002
   6694 00D914 20 19 D4                     	JSR		InvBomb
   6695 00D917 20 FD D6                     	JSR		RenderInvaders
   6696 00D91A 20 99 D4                     	JSR		RenderBombs
   6697 00D91D 20 62 D4                     	JSR		MoveBombs
   6698 00D920 42 5B A5 04                  	LDA		ZS:TickCount
   6699 00D924 29 0F 00                     	AND		#$F
   6700 00D927 D0 D4                        	BNE		.0002
   6701 00D929 20 34 D6                     	JSR		IsAllDestroyed
   6702 00D92C D0 B9                        	BNE		.0001
   6703 00D92E 20 9D D5                     	JSR		Move
   6704 00D931 F0 B4                        	BEQ		.0001				; Can't move, re-initialize
   6705 00D933 80 C8                        	BRA		.0002
   6706 00D935                             .0005:
   6707 00D935 85 6A                        	STA		inv_tick
   6708 00D937 80 C4                        	BRA		.0002
   6709 00D939                             .0003:
   6710 00D939 C9 03 00                     	CMP		#3
   6711 00D93C D0 C4                        	BNE		.0004
   6712 00D93E 42 5B 9C 68 78               	STZ		ZS:do_invaders
   6713 00D943 42 60                        	RTT
   6714 00D945 80 A0                        	BRA		.0001
                                           
   6716 00D947                             InvaderRow:
   6717 00D947 00 00                        	.word	0
   6718 00D949 00 00                        	.word	0
   6719 00D94B 00 00                        	.word	0
   6720 00D94D 00 00                        	.word	0
   6721 00D94F 00 00                        	.word	0
   6722 00D951 00 00                        	.word	0
   6723 00D953 00 00                        	.word	0
   6724 00D955 00 00                        	.word	0
                                           
   6726 00D957 01 00                        	.word	1
   6727 00D959 01 00                        	.word	1
   6728 00D95B 01 00                        	.word	1
   6729 00D95D 01 00                        	.word	1
   6730 00D95F 01 00                        	.word	1
   6731 00D961 01 00                        	.word	1
   6732 00D963 01 00                        	.word	1
   6733 00D965 01 00                        	.word	1
                                           
   6735 00D967 02 00                        	.word	2
   6736 00D969 02 00                        	.word	2
   6737 00D96B 02 00                        	.word	2
   6738 00D96D 02 00                        	.word	2
   6739 00D96F 02 00                        	.word	2
   6740 00D971 02 00                        	.word	2
   6741 00D973 02 00                        	.word	2
   6742 00D975 02 00                        	.word	2
                                           
   6744 00D977 03 00                        	.word	3
   6745 00D979 03 00                        	.word	3
   6746 00D97B 03 00                        	.word	3
   6747 00D97D 03 00                        	.word	3
   6748 00D97F 03 00                        	.word	3
   6749 00D981 03 00                        	.word	3
   6750 00D983 03 00                        	.word	3
   6751 00D985 03 00                        	.word	3
                                           
   6753 00D987 04 00                        	.word	4
   6754 00D989 04 00                        	.word	4
   6755 00D98B 04 00                        	.word	4
   6756 00D98D 04 00                        	.word	4
   6757 00D98F 04 00                        	.word	4
   6758 00D991 04 00                        	.word	4
   6759 00D993 04 00                        	.word	4
   6760 00D995 04 00                        	.word	4
                                           
   6762 00D997                             InvaderCol:
   6763 00D997 00 00                        	.word	0
   6764 00D999 01 00                        	.word	1
   6765 00D99B 02 00                        	.word	2
   6766 00D99D 03 00                        	.word	3
   6767 00D99F 04 00                        	.word	4
   6768 00D9A1 05 00                        	.word	5
   6769 00D9A3 06 00                        	.word	6
   6770 00D9A5 07 00                        	.word	7
                                           
   6772 00D9A7 00 00                        	.word	0
   6773 00D9A9 01 00                        	.word	1
   6774 00D9AB 02 00                        	.word	2
   6775 00D9AD 03 00                        	.word	3
   6776 00D9AF 04 00                        	.word	4
   6777 00D9B1 05 00                        	.word	5
   6778 00D9B3 06 00                        	.word	6
   6779 00D9B5 07 00                        	.word	7
                                           
   6781 00D9B7 00 00                        	.word	0
   6782 00D9B9 01 00                        	.word	1
   6783 00D9BB 02 00                        	.word	2
   6784 00D9BD 03 00                        	.word	3
   6785 00D9BF 04 00                        	.word	4
   6786 00D9C1 05 00                        	.word	5
   6787 00D9C3 06 00                        	.word	6
   6788 00D9C5 07 00                        	.word	7
                                           
   6790 00D9C7 00 00                        	.word	0
   6791 00D9C9 01 00                        	.word	1
   6792 00D9CB 02 00                        	.word	2
   6793 00D9CD 03 00                        	.word	3
   6794 00D9CF 04 00                        	.word	4
   6795 00D9D1 05 00                        	.word	5
   6796 00D9D3 06 00                        	.word	6
   6797 00D9D5 07 00                        	.word	7
                                           
   6799 00D9D7 00 00                        	.word	0
   6800 00D9D9 01 00                        	.word	1
   6801 00D9DB 02 00                        	.word	2
   6802 00D9DD 03 00                        	.word	3
   6803 00D9DF 04 00                        	.word	4
   6804 00D9E1 05 00                        	.word	5
   6805 00D9E3 06 00                        	.word	6
   6806 00D9E5 07 00                        	.word	7
                                           
                                           ; Starting Y co-ordinate for each invader
                                           
   6810 00D9E7                             StartY:
   6811 00D9E7 03 00                        	.word	3
   6812 00D9E9 03 00                        	.word	3
   6813 00D9EB 03 00                        	.word	3
   6814 00D9ED 03 00                        	.word	3
   6815 00D9EF 03 00                        	.word	3
   6816 00D9F1 03 00                        	.word	3
   6817 00D9F3 03 00                        	.word	3
   6818 00D9F5 03 00                        	.word	3
                                           
   6820 00D9F7 06 00                        	.word	6
   6821 00D9F9 06 00                        	.word	6
   6822 00D9FB 06 00                        	.word	6
   6823 00D9FD 06 00                        	.word	6
   6824 00D9FF 06 00                        	.word	6
   6825 00DA01 06 00                        	.word	6
   6826 00DA03 06 00                        	.word	6
   6827 00DA05 06 00                        	.word	6
                                           
   6829 00DA07 09 00                        	.word	9
   6830 00DA09 09 00                        	.word	9
   6831 00DA0B 09 00                        	.word	9
   6832 00DA0D 09 00                        	.word	9
   6833 00DA0F 09 00                        	.word	9
   6834 00DA11 09 00                        	.word	9
   6835 00DA13 09 00                        	.word	9
   6836 00DA15 09 00                        	.word	9
                                           
   6838 00DA17 0C 00                        	.word	12
   6839 00DA19 0C 00                        	.word	12
   6840 00DA1B 0C 00                        	.word	12
   6841 00DA1D 0C 00                        	.word	12
   6842 00DA1F 0C 00                        	.word	12
   6843 00DA21 0C 00                        	.word	12
   6844 00DA23 0C 00                        	.word	12
   6845 00DA25 0C 00                        	.word	12
                                           
   6847 00DA27 0F 00                        	.word	15
   6848 00DA29 0F 00                        	.word	15
   6849 00DA2B 0F 00                        	.word	15
   6850 00DA2D 0F 00                        	.word	15
   6851 00DA2F 0F 00                        	.word	15
   6852 00DA31 0F 00                        	.word	15
   6853 00DA33 0F 00                        	.word	15
   6854 00DA35 0F 00                        	.word	15
                                           
                                           ; Starting X co-ordinate for each invader
                                           
   6858 00DA37                             StartX:
   6859 00DA37 01 00                        	.word	1
   6860 00DA39 05 00                        	.word	5
   6861 00DA3B 09 00                        	.word	9
   6862 00DA3D 0D 00                        	.word	13
   6863 00DA3F 11 00                        	.word	17
   6864 00DA41 15 00                        	.word	21
   6865 00DA43 19 00                        	.word	25
   6866 00DA45 1D 00                        	.word	29
                                           
   6868 00DA47 01 00                        	.word	1
   6869 00DA49 05 00                        	.word	5
   6870 00DA4B 09 00                        	.word	9
   6871 00DA4D 0D 00                        	.word	13
   6872 00DA4F 11 00                        	.word	17
   6873 00DA51 15 00                        	.word	21
   6874 00DA53 19 00                        	.word	25
   6875 00DA55 1D 00                        	.word	29
                                           
   6877 00DA57 01 00                        	.word	1
   6878 00DA59 05 00                        	.word	5
   6879 00DA5B 09 00                        	.word	9
   6880 00DA5D 0D 00                        	.word	13
   6881 00DA5F 11 00                        	.word	17
   6882 00DA61 15 00                        	.word	21
   6883 00DA63 19 00                        	.word	25
   6884 00DA65 1D 00                        	.word	29
                                           
   6886 00DA67 01 00                        	.word	1
   6887 00DA69 05 00                        	.word	5
   6888 00DA6B 09 00                        	.word	9
   6889 00DA6D 0D 00                        	.word	13
   6890 00DA6F 11 00                        	.word	17
   6891 00DA71 15 00                        	.word	21
   6892 00DA73 19 00                        	.word	25
   6893 00DA75 1D 00                        	.word	29
                                           
   6895 00DA77 01 00                        	.word	1
   6896 00DA79 05 00                        	.word	5
   6897 00DA7B 09 00                        	.word	9
   6898 00DA7D 0D 00                        	.word	13
   6899 00DA7F 11 00                        	.word	17
   6900 00DA81 15 00                        	.word	21
   6901 00DA83 19 00                        	.word	25
   6902 00DA85 1D 00                        	.word	29
                                           
   6904 00DA87                             InvaderType:
   6905 00DA87 01 00                        	.word	1
   6906 00DA89 01 00                        	.word	1
   6907 00DA8B 01 00                        	.word	1
   6908 00DA8D 01 00                        	.word	1
   6909 00DA8F 01 00                        	.word	1
   6910 00DA91 01 00                        	.word	1
   6911 00DA93 01 00                        	.word	1
   6912 00DA95 01 00                        	.word	1
                                           
   6914 00DA97 02 00                        	.word	2
   6915 00DA99 02 00                        	.word	2
   6916 00DA9B 02 00                        	.word	2
   6917 00DA9D 02 00                        	.word	2
   6918 00DA9F 02 00                        	.word	2
   6919 00DAA1 02 00                        	.word	2
   6920 00DAA3 02 00                        	.word	2
   6921 00DAA5 02 00                        	.word	2
                                           
   6923 00DAA7 02 00                        	.word	2
   6924 00DAA9 02 00                        	.word	2
   6925 00DAAB 02 00                        	.word	2
   6926 00DAAD 02 00                        	.word	2
   6927 00DAAF 02 00                        	.word	2
   6928 00DAB1 02 00                        	.word	2
   6929 00DAB3 02 00                        	.word	2
   6930 00DAB5 02 00                        	.word	2
                                           
   6932 00DAB7 03 00                        	.word	3
   6933 00DAB9 03 00                        	.word	3
   6934 00DABB 03 00                        	.word	3
   6935 00DABD 03 00                        	.word	3
   6936 00DABF 03 00                        	.word	3
   6937 00DAC1 03 00                        	.word	3
   6938 00DAC3 03 00                        	.word	3
   6939 00DAC5 03 00                        	.word	3
                                           
   6941 00DAC7 03 00                        	.word	3
   6942 00DAC9 03 00                        	.word	3
   6943 00DACB 03 00                        	.word	3
   6944 00DACD 03 00                        	.word	3
   6945 00DACF 03 00                        	.word	3
   6946 00DAD1 03 00                        	.word	3
   6947 00DAD3 03 00                        	.word	3
   6948 00DAD5 03 00                        	.word	3
                                           			
Finitron FT832 assembler   version 1.4   Wed May 31 19:15:10 2017     Page 1
FTBios816.asm


                                           .include "invaders.asm"
                                           
                                           ;	cpu		W65C816S
                                           	cpu		FT832
   6953 00DAD7 FF FF FF FF FF FF FF FF      	.org	$E000
   6953 00DADF FF FF FF FF FF FF FF FF    
   6953 00DAE7 FF FF FF FF FF FF FF FF    
   6953 00DAEF FF FF FF FF FF FF FF FF    
   6953 00DAF7 FF FF FF FF FF FF FF FF    
   6953 00DAFF FF FF FF FF FF FF FF FF    
   6953 00DB07 FF FF FF FF FF FF FF FF    
   6953 00DB0F FF FF FF FF FF FF FF FF    
   6953 00DB17 FF FF FF FF FF FF FF FF    
   6953 00DB1F FF FF FF FF FF FF FF FF    
   6953 00DB27 FF FF FF FF FF FF FF FF    
   6953 00DB2F FF FF FF FF FF FF FF FF    
   6953 00DB37 FF FF FF FF FF FF FF FF    
   6953 00DB3F FF FF FF FF FF FF FF FF    
   6953 00DB47 FF FF FF FF FF FF FF FF    
   6953 00DB4F FF FF FF FF FF FF FF FF    
   6953 00DB57 FF FF FF FF FF FF FF FF    
   6953 00DB5F FF FF FF FF FF FF FF FF    
   6953 00DB67 FF FF FF FF FF FF FF FF    
   6953 00DB6F FF FF FF FF FF FF FF FF    
   6953 00DB77 FF FF FF FF FF FF FF FF    
   6953 00DB7F FF FF FF FF FF FF FF FF    
   6953 00DB87 FF FF FF FF FF FF FF FF    
   6953 00DB8F FF FF FF FF FF FF FF FF    
   6953 00DB97 FF FF FF FF FF FF FF FF    
   6953 00DB9F FF FF FF FF FF FF FF FF    
   6953 00DBA7 FF FF FF FF FF FF FF FF    
   6953 00DBAF FF FF FF FF FF FF FF FF    
   6953 00DBB7 FF FF FF FF FF FF FF FF    
   6953 00DBBF FF FF FF FF FF FF FF FF    
   6953 00DBC7 FF FF FF FF FF FF FF FF    
   6953 00DBCF FF FF FF FF FF FF FF FF    
   6953 00DBD7 FF FF FF FF FF FF FF FF    
   6953 00DBDF FF FF FF FF FF FF FF FF    
   6953 00DBE7 FF FF FF FF FF FF FF FF    
   6953 00DBEF FF FF FF FF FF FF FF FF    
   6953 00DBF7 FF FF FF FF FF FF FF FF    
   6953 00DBFF FF FF FF FF FF FF FF FF    
   6953 00DC07 FF FF FF FF FF FF FF FF    
   6953 00DC0F FF FF FF FF FF FF FF FF    
   6953 00DC17 FF FF FF FF FF FF FF FF    
   6953 00DC1F FF FF FF FF FF FF FF FF    
   6953 00DC27 FF FF FF FF FF FF FF FF    
   6953 00DC2F FF FF FF FF FF FF FF FF    
   6953 00DC37 FF FF FF FF FF FF FF FF    
   6953 00DC3F FF FF FF FF FF FF FF FF    
   6953 00DC47 FF FF FF FF FF FF FF FF    
   6953 00DC4F FF FF FF FF FF FF FF FF    
   6953 00DC57 FF FF FF FF FF FF FF FF    
   6953 00DC5F FF FF FF FF FF FF FF FF    
   6953 00DC67 FF FF FF FF FF FF FF FF    
   6953 00DC6F FF FF FF FF FF FF FF FF    
   6953 00DC77 FF FF FF FF FF FF FF FF    
   6953 00DC7F FF FF FF FF FF FF FF FF    
   6953 00DC87 FF FF FF FF FF FF FF FF    
   6953 00DC8F FF FF FF FF FF FF FF FF    
   6953 00DC97 FF FF FF FF FF FF FF FF    
   6953 00DC9F FF FF FF FF FF FF FF FF    
   6953 00DCA7 FF FF FF FF FF FF FF FF    
   6953 00DCAF FF FF FF FF FF FF FF FF    
   6953 00DCB7 FF FF FF FF FF FF FF FF    
   6953 00DCBF FF FF FF FF FF FF FF FF    
   6953 00DCC7 FF FF FF FF FF FF FF FF    
   6953 00DCCF FF FF FF FF FF FF FF FF    
   6953 00DCD7 FF FF FF FF FF FF FF FF    
   6953 00DCDF FF FF FF FF FF FF FF FF    
   6953 00DCE7 FF FF FF FF FF FF FF FF    
   6953 00DCEF FF FF FF FF FF FF FF FF    
   6953 00DCF7 FF FF FF FF FF FF FF FF    
   6953 00DCFF FF FF FF FF FF FF FF FF    
   6953 00DD07 FF FF FF FF FF FF FF FF    
   6953 00DD0F FF FF FF FF FF FF FF FF    
   6953 00DD17 FF FF FF FF FF FF FF FF    
   6953 00DD1F FF FF FF FF FF FF FF FF    
   6953 00DD27 FF FF FF FF FF FF FF FF    
   6953 00DD2F FF FF FF FF FF FF FF FF    
   6953 00DD37 FF FF FF FF FF FF FF FF    
   6953 00DD3F FF FF FF FF FF FF FF FF    
   6953 00DD47 FF FF FF FF FF FF FF FF    
   6953 00DD4F FF FF FF FF FF FF FF FF    
   6953 00DD57 FF FF FF FF FF FF FF FF    
   6953 00DD5F FF FF FF FF FF FF FF FF    
   6953 00DD67 FF FF FF FF FF FF FF FF    
   6953 00DD6F FF FF FF FF FF FF FF FF    
   6953 00DD77 FF FF FF FF FF FF FF FF    
   6953 00DD7F FF FF FF FF FF FF FF FF    
   6953 00DD87 FF FF FF FF FF FF FF FF    
   6953 00DD8F FF FF FF FF FF FF FF FF    
   6953 00DD97 FF FF FF FF FF FF FF FF    
   6953 00DD9F FF FF FF FF FF FF FF FF    
   6953 00DDA7 FF FF FF FF FF FF FF FF    
   6953 00DDAF FF FF FF FF FF FF FF FF    
   6953 00DDB7 FF FF FF FF FF FF FF FF    
   6953 00DDBF FF FF FF FF FF FF FF FF    
   6953 00DDC7 FF FF FF FF FF FF FF FF    
   6953 00DDCF FF FF FF FF FF FF FF FF    
   6953 00DDD7 FF FF FF FF FF FF FF FF    
   6953 00DDDF FF FF FF FF FF FF FF FF    
   6953 00DDE7 FF FF FF FF FF FF FF FF    
   6953 00DDEF FF FF FF FF FF FF FF FF    
   6953 00DDF7 FF FF FF FF FF FF FF FF    
   6953 00DDFF FF FF FF FF FF FF FF FF    
   6953 00DE07 FF FF FF FF FF FF FF FF    
   6953 00DE0F FF FF FF FF FF FF FF FF    
   6953 00DE17 FF FF FF FF FF FF FF FF    
   6953 00DE1F FF FF FF FF FF FF FF FF    
   6953 00DE27 FF FF FF FF FF FF FF FF    
   6953 00DE2F FF FF FF FF FF FF FF FF    
   6953 00DE37 FF FF FF FF FF FF FF FF    
   6953 00DE3F FF FF FF FF FF FF FF FF    
   6953 00DE47 FF FF FF FF FF FF FF FF    
   6953 00DE4F FF FF FF FF FF FF FF FF    
   6953 00DE57 FF FF FF FF FF FF FF FF    
   6953 00DE5F FF FF FF FF FF FF FF FF    
   6953 00DE67 FF FF FF FF FF FF FF FF    
   6953 00DE6F FF FF FF FF FF FF FF FF    
   6953 00DE77 FF FF FF FF FF FF FF FF    
   6953 00DE7F FF FF FF FF FF FF FF FF    
   6953 00DE87 FF FF FF FF FF FF FF FF    
   6953 00DE8F FF FF FF FF FF FF FF FF    
   6953 00DE97 FF FF FF FF FF FF FF FF    
   6953 00DE9F FF FF FF FF FF FF FF FF    
   6953 00DEA7 FF FF FF FF FF FF FF FF    
   6953 00DEAF FF FF FF FF FF FF FF FF    
   6953 00DEB7 FF FF FF FF FF FF FF FF    
   6953 00DEBF FF FF FF FF FF FF FF FF    
   6953 00DEC7 FF FF FF FF FF FF FF FF    
   6953 00DECF FF FF FF FF FF FF FF FF    
   6953 00DED7 FF FF FF FF FF FF FF FF    
   6953 00DEDF FF FF FF FF FF FF FF FF    
   6953 00DEE7 FF FF FF FF FF FF FF FF    
   6953 00DEEF FF FF FF FF FF FF FF FF    
   6953 00DEF7 FF FF FF FF FF FF FF FF    
   6953 00DEFF FF FF FF FF FF FF FF FF    
   6953 00DF07 FF FF FF FF FF FF FF FF    
   6953 00DF0F FF FF FF FF FF FF FF FF    
   6953 00DF17 FF FF FF FF FF FF FF FF    
   6953 00DF1F FF FF FF FF FF FF FF FF    
   6953 00DF27 FF FF FF FF FF FF FF FF    
   6953 00DF2F FF FF FF FF FF FF FF FF    
   6953 00DF37 FF FF FF FF FF FF FF FF    
   6953 00DF3F FF FF FF FF FF FF FF FF    
   6953 00DF47 FF FF FF FF FF FF FF FF    
   6953 00DF4F FF FF FF FF FF FF FF FF    
   6953 00DF57 FF FF FF FF FF FF FF FF    
   6953 00DF5F FF FF FF FF FF FF FF FF    
   6953 00DF67 FF FF FF FF FF FF FF FF    
   6953 00DF6F FF FF FF FF FF FF FF FF    
   6953 00DF77 FF FF FF FF FF FF FF FF    
   6953 00DF7F FF FF FF FF FF FF FF FF    
   6953 00DF87 FF FF FF FF FF FF FF FF    
   6953 00DF8F FF FF FF FF FF FF FF FF    
   6953 00DF97 FF FF FF FF FF FF FF FF    
   6953 00DF9F FF FF FF FF FF FF FF FF    
   6953 00DFA7 FF FF FF FF FF FF FF FF    
   6953 00DFAF FF FF FF FF FF FF FF FF    
   6953 00DFB7 FF FF FF FF FF FF FF FF    
   6953 00DFBF FF FF FF FF FF FF FF FF    
   6953 00DFC7 FF FF FF FF FF FF FF FF    
   6953 00DFCF FF FF FF FF FF FF FF FF    
   6953 00DFD7 FF FF FF FF FF FF FF FF    
   6953 00DFDF FF FF FF FF FF FF FF FF    
   6953 00DFE7 FF FF FF FF FF FF FF FF    
   6953 00DFEF FF FF FF FF FF FF FF FF    
   6953 00DFF7 FF FF FF FF FF FF FF FF    
   6953 00DFFF FF                         
                                           
   6955 00E000                             start:
   6956 00E000 78                           	SEI					; not strictly necessary after power on reset
   6957 00E001 D8                           	CLD
                                           ;	CLV					; overflow low
                                           ;	SEC					; carry high
                                           ;	XCE					; sets 32 bit mode, 32 bit registers
                                           ;	REP		#$30		; 32 bit registers
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$3FFF
                                           ;	TAS
                                           ;
   6967 00E002 18                           	CLC					; switch to '816 mode
   6968 00E003 2C 00 E0                     	BIT		start		; set overflow bit
   6969 00E006 FB                           	XCE
   6970 00E007 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           	; Setup all the segment descriptors
                                           	; This must be done before the stack can be accessed, and
                                           	; before subroutine calls and task switching can be made.
                                           
                                           	; First setup segment #0, the segment the core starts running under.
                                           	; It's setup for flat addressing.
   6980 00E009 A9 00 00                     	LDA		#0
   6981 00E00C 42 EB                        	XBAW
   6982 00E00E A9 00 00                     	LDA		#0
   6983 00E011 A2 8D 09                     	LDX		#$98D		; present, writeable, executable, max size.
   6984 00E014 A8                           	TAY
   6985 00E015 42 BA                        	SDU
   6986 00E017 C8                           	INY
                                           
                                           	; Flag remaining segments as not present 
   6989 00E018 A2 00 00                     	LDX		#$000		; not present, non-executable, non-writeable, min size
   6990 00E01B                             .0003:
   6991 00E01B 42 BA                        	SDU					; update segment descriptor
   6992 00E01D C8                           	INY
   6993 00E01E C0 00 10                     	CPY		#4096
   6994 00E021 D0 F8                        	BNE		.0003
                                           
                                           	; setup code segment #1
   6997 00E023 A2 05 09                     	LDX		#$905		; executable, 64k
   6998 00E026 A8                           	TAY
   6999 00E027 C8                           	INY
   7000 00E028 42 BA                        	SDU
                                           	; setup data segment #2
   7002 00E02A A2 8B 08                     	LDX		#$88B		; writeable, 256M
   7003 00E02D C8                           	INY
   7004 00E02E 42 BA                        	SDU
                                           	; setup stack segment #3 (for 65c02 mode)
   7006 00E030 A2 82 08                     	LDX		#$882		; writeable, 1k (based at zero)
   7007 00E033 C8                           	INY
   7008 00E034 42 BA                        	SDU
                                           	; setup stack segment #4 (for 65c816 mode)
   7010 00E036 A2 85 08                     	LDX		#$885		; writeable, 64k (based at zero)
   7011 00E039 C8                           	INY
   7012 00E03A 42 BA                        	SDU
                                           	; seg #5 is the maxed out segment
   7014 00E03C A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   7015 00E03F C8                           	INY
   7016 00E040 42 BA                        	SDU
                                           
                                           	; I/O segment
   7019 00E042 A9 F0 00                     	LDA		#$00F0
   7020 00E045 42 EB                        	XBAW
   7021 00E047 A9 00 00                     	LDA		#$0000
   7022 00E04A A2 87 08                     	LDX		#$887		; writeable, 1M (based at $F00000)
   7023 00E04D A0 FF 0F                     	LDY		#$FFF
   7024 00E050 42 BA                        	SDU
                                           
                                           	; now set the code segment (test far jump)
   7027 00E052 42 5C 59 E0 00 01 00         	JMF		1:.0004
   7028 00E059                             .0004:
                                           	; set the stack segment
                                           	; (must be before PEA/PLDS)
   7031 00E059 A9 05 00                     	LDA		#5
   7032 00E05C 42 5A                        	TASS
   7033 00E05E A9 FF 6B                     	LDA		#$6BFF		; set top of stack
   7034 00E061 1B                           	TAS
                                           
                                           	; setup the programmable address decodes
   7037 00E062 A9 70 00                     	LDA		#$0070		; program chip selects for I/O
   7038 00E065 8D 00 B0                     	STA		PCS0		; at $007000
   7039 00E068 A9 71 00                     	LDA		#$0071
   7040 00E06B 8D 02 B0                     	STA		PCS1
                                           ;	LDA		#$FEA1		; select $FEA1xx I/O
                                           ;	STA		PCS3
                                           ;	LDA		#$0000		; select zero page ram
                                           ;	STA		PCS5
                                           
                                           	; set the data segment
                                           	; this must be setup after address decoding is setup
   7048 00E06E F4 05 00                     	PEA		5
   7049 00E071 42 2B                        	PLDS
                                           
                                           	; Setup the counters
   7052 00E073 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
                                           	; Counter #0 is setup as a free running tick count
   7056 00E075 A9 FF                        	LDA		#$FF		; set limit to $FFFFFF
   7057 00E077 8D 10 B0                     	STA		CTR0_LMT
   7058 00E07A 8D 11 B0                     	STA		CTR0_LMT+1
   7059 00E07D 8D 12 B0                     	STA		CTR0_LMT+2
   7060 00E080 A9 14                        	LDA		#$14		; count up, on mpu clock
   7061 00E082 8D 13 B0                     	STA		CTR0_CTRL
                                           	; Counter #1 is set to interrupt at a 50Hz rate
   7063 00E085 A9 2A                        	LDA		#$2A	;94		; divide by 95794 (for 50Hz)
   7064 00E087 8D 14 B0                     	STA		CTR1_LMT		; FFFFFE = 2Hz with 33MHz clock
   7065 00E08A A9 2C                        	LDA		#$2C	;57
   7066 00E08C 8D 15 B0                     	STA		CTR1_LMT+1
   7067 00E08F A9 0A                        	LDA		#$0A	;09
   7068 00E091 8D 16 B0                     	STA		CTR1_LMT+2
   7069 00E094 A9 05                        	LDA		#$05		; count down, on mpu clock, irq disenabled
   7070 00E096 8D 17 B0                     	STA		CTR1_CTRL
                                           	; Counter #2 isn't setup
                                           
   7073 00E099 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
   7077 00E09B 20 9C EC                     	JSR		ResetKbd
                                           
                                           ;	FORK	#8			; fork a BIOS context
                                           ;	TTA
                                           ;	CMP		#8
                                           ;	BNE		.0002
                                           ;	RTT
                                           ;.0002:
                                           	; Setup the task registers
   7086 00E09E A0 09 00                     	LDY		#9			; # tasks to setup
   7087 00E0A1 A2 01 00                     	LDX		#1
   7088 00E0A4                             .0001:
   7089 00E0A4 42 4C 30 F6 00 00            	LDT		TaskStartTbl,X
   7090 00E0AA E8                           	INX
   7091 00E0AB 88                           	DEY
   7092 00E0AC D0 F6                        	BNE		.0001
                                           
   7094 00E0AE 42 9C FE FF 02 00            	STZ		running_task
                                           
   7096 00E0B4 A9 C5 F5                     	LDA		#BrkRout1
   7097 00E0B7 8D 02 01                     	STA		$0102
                                           
   7099 00E0BA 64 04                        	STZ		TickCount
   7100 00E0BC 64 06                        	STZ		TickCount+2
   7101 00E0BE                             Task0:
   7102 00E0BE 58                           	CLI
   7103 00E0BF EA                           	NOP
   7104 00E0C0 EA                           	NOP
   7105 00E0C1 EA                           	NOP
                                           	; Start the single stepping task.
   7107 00E0C2 A9 01 00                     	LDA		#$01
   7108 00E0C5 8D 00 70                     	STA		$7000
   7109 00E0C8 42 A2 09 00                  	TSK		#9
   7110 00E0CC                             .0001:
   7111 00E0CC A9 04 00                     	LDA		#$04
   7112 00E0CF 8D 00 70                     	STA		$7000
   7113 00E0D2 A9 FF 0F                     	LDA		#$FFF
   7114 00E0D5 85 44                        	STA		Vidptr+4
   7115 00E0D7 85 4A                        	STA		Vidregs+4
   7116 00E0D9 A9 0D 00                     	LDA		#VIDBUF>>16
   7117 00E0DC 85 42                        	STA		Vidptr+2
   7118 00E0DE 64 40                        	STZ		Vidptr
   7119 00E0E0 A9 0D BF                     	LDA		#$BF0D	; 'm'
   7120 00E0E3 42 DA 42 87 40               	STA		FAR {Vidptr}
   7121 00E0E8 A9 0E 00                     	LDA		#VIDREGS >> 16
   7122 00E0EB 85 48                        	STA		Vidregs+2
   7123 00E0ED A9 00 A0                     	LDA		#VIDREGS
   7124 00E0F0 85 46                        	STA		Vidregs
   7125 00E0F2 A0 07 00                     	LDY		#7	
   7126 00E0F5 A9 21 00                     	LDA		#$21		; divide by 3 vertically, 2 horizontally
   7127 00E0F8 20 17 EB                     	JSR		SetVideoReg	; clear POR state
   7128 00E0FB A9 54 00                     	LDA		#84		; set window left position 84
   7129 00E0FE A0 02 00                     	LDY		#2
   7130 00E101 20 17 EB                     	JSR		SetVideoReg
   7131 00E104 A9 00 00                     	LDA		#0
   7132 00E107 A0 03 00                     	LDY		#3
   7133 00E10A 20 17 EB                     	JSR		SetVideoReg
   7134 00E10D A9 10 00                     	LDA		#16			; set window top position
   7135 00E110 A0 04 00                     	LDY		#4
   7136 00E113 20 17 EB                     	JSR		SetVideoReg
   7137 00E116 20 FC EA                     	JSR		GetTextRowsCols
   7138 00E119 A9 CC E8                     	LDA		#DisplayChar
   7139 00E11C 8D F0 03                     	STA		OutputVec
   7140 00E11F AD F0 03                     	LDA		OutputVec
   7141 00E122 C9 CC E8                     	CMP		#DisplayChar
   7142 00E125 D0 A5                        	BNE		.0001
   7143 00E127 A9 02 00                     	LDA		#$02
   7144 00E12A 8D 00 70                     	STA		$7000
   7145 00E12D A9 00 BF                     	LDA		#$BF00
   7146 00E130 85 36                        	STA		NormAttr
   7147 00E132 20 41 EB                     	JSR		ClearScreen
   7148 00E135 20 91 EA                     	JSR		HomeCursor
                                           ;	JSR		beep
   7150 00E138 A9 03 00                     	LDA		#$03
   7151 00E13B 42 3B 05 00 8D 00 70         	STA		5:$7000
   7152 00E142 F4 05 00                     	PEA		5
   7153 00E145 F4 50 E7                     	PEA		msgStarting
   7154 00E148 20 CD EA                     	JSR		DisplayString
   7155 00E14B 20 F8 F3                     	JSR		rtc_init
   7156 00E14E 20 00 F4                     	JSR		rtc_read
   7157 00E151 C9 00 00                     	CMP		#0
   7158 00E154 D0 09                        	BNE		.0006
   7159 00E156 F4 01 00                     	PEA		1
   7160 00E159 F4 7B F4                     	PEA		msgRtcReadFail
   7161 00E15C 20 CD EA                     	JSR		DisplayString
   7162 00E15F                             .0006:
                                           ;	SEP		#$1000		; turn on single step mode
                                           ;	LDA		#0
                                           ;	STA		$FFF:FAC1
                                           ;	STA		$FFF:FAC1+2
                                           ;	STA		$FFF:FAC1+4
                                           ;	STA		$FFF:FAC1+6
                                           ;	STA		$FFF:FAC1+8
                                           ;	STA		$FFF:FAC1+10
                                           ;	LDA		#3
                                           ;	STA		$7000
                                           ;	LDA		#1234
                                           ;	STA		FAC1
                                           ;	LDA		#5			; FIX2FLT
                                           ;	JSR 	FPCommandWait
                                           ;	LDA		#4
                                           ;	STA		$7000
                                           ;	JSR		DivideByTen
                                           ;	LDA		#5
                                           ;	STA		$7000
                                           ;	JSR		FAC1ToString
                                           ;	PEA		2
                                           ;	PEA		$3A0
                                           ;	JSR		DisplayString
                                           ;	LDA		#' '
                                           ;	JSR		OutChar
                                           ;	JSR		DispFAC1
                                           
                                           ;	FORK	#11
                                           ;	TTA
                                           ;	CMP		#11
                                           ;	LBEQ	KeybdInit
                                           
                                           	; Create a workhorse BIOS context that will allow subroutine calls into
                                           	; the BIOS code from alternate contexts which may not have the same VM
                                           	; settings.
                                           	;
   7199 00E15F 42 A0 FC 00                  	FORK	#$FC
   7200 00E163 42 1A                        	TTA
   7201 00E165 29 FF 01                     	AND		#$01FF
   7202 00E168 C9 FC 00                     	CMP		#$FC
   7203 00E16B D0 11                        	BNE		TaskMon
   7204 00E16D                             TaskFC:
   7205 00E16D                             .0003
   7206 00E16D 78                           	SEI
   7207 00E16E 68                           	PLA
   7208 00E16F A2 FF 23                     	LDX		#$23FF
   7209 00E172 9A                           	TXS
   7210 00E173 48                           	PHA
   7211 00E174 58                           	CLI
   7212 00E175 EA                           	NOP		; allow CLI to take place
   7213 00E176 EA                           	NOP
   7214 00E177 EA                           	NOP
   7215 00E178 EA                           	NOP
   7216 00E179 EA                           	NOP
   7217 00E17A 42 60                        	RTT
   7218 00E17C 80 EF                        	BRA		.0003
   7219 00E17E                             TaskMon:
   7220 00E17E 58                           	CLI
                                           
   7222 00E17F                             Mon1:
   7223 00E17F                             .mon1:
   7224 00E17F A9 FF 6B                     	LDA		#$6BFF
   7225 00E182 1B                           	TAS
   7226 00E183 20 21 EB                     	JSR		CursorOn
   7227 00E186 20 B5 EA                     	JSR		OutCRLF
   7228 00E189 A9 24 00                     	LDA		#'$'
   7229 00E18C                             .mon3:
   7230 00E18C 20 BE EA                     	JSR		OutChar
   7231 00E18F 20 23 EE                     	JSR		KeybdGetCharWait
   7232 00E192 29 FF 00                     	AND		#$FF
                                           ;	CMP		#'.'
                                           ;	BEQ		.mon3
   7235 00E195 C9 0D 00                     	CMP		#CR
   7236 00E198 D0 F2                        	BNE		.mon3
   7237 00E19A A5 32                        	LDA		CursorY
   7238 00E19C 0A                           	ASL
   7239 00E19D AA                           	TAX
   7240 00E19E 42 1B BD F2 F5               	LDA		CS:LineTbl,X
   7241 00E1A3 0A                           	ASL
   7242 00E1A4 AA                           	TAX
   7243 00E1A5                             .mon4:
   7244 00E1A5 20 E8 E6                     	JSR		IgnoreBlanks
   7245 00E1A8 20 36 E2                     	JSR		MonGetch
   7246 00E1AB C9 24 00                     	CMP		#'$'
   7247 00E1AE F0 F5                        	BEQ		.mon4
   7248 00E1B0 C9 53 00                     	CMP		#'S'
   7249 00E1B3 D0 12                        	BNE		.mon2
   7250 00E1B5 20 36 E2                     	JSR		MonGetch
   7251 00E1B8 C9 45 00                     	CMP		#'E'
   7252 00E1BB F0 FF B5 00                  	LBEQ	GetSecnum
   7253 00E1BF 42 CB 42 A2 08 00            	TSK		JMP:#8
   7254 00E1C5 80 B8                        	BRA		.mon1
                                           	;JMP		$C000		; invoke Supermon832
   7256 00E1C7                             .mon2:
   7257 00E1C7 C9 43 00                     	CMP		#'C'
   7258 00E1CA D0 08                        	BNE		.mon5
   7259 00E1CC 20 41 EB                     	JSR		ClearScreen
   7260 00E1CF 20 91 EA                     	JSR		HomeCursor
   7261 00E1D2 80 AB                        	BRA		.mon1
   7262 00E1D4                             .mon5:
   7263 00E1D4 C9 4D 00                     	CMP		#'M'
   7264 00E1D7 D0 05                        	BNE		.mon6
   7265 00E1D9 20 64 E5                     	JSR		doMemoryDump
   7266 00E1DC 80 A1                        	BRA		Mon1
   7267 00E1DE                             .mon6:
   7268 00E1DE C9 44 00                     	CMP		#'D'
   7269 00E1E1 F0 FF 82 04                  	LBEQ	doDisassemble
   7270 00E1E5 C9 3E 00                     	CMP		#'>'
   7271 00E1E8 F0 FF EA 03                  	LBEQ	doMemoryEdit
   7272 00E1EC C9 46 00                     	CMP		#'F'
   7273 00E1EF F0 FF 1E 04                  	LBEQ	doFill
   7274 00E1F3 C9 4A 00                     	CMP		#'J'
   7275 00E1F6 F0 FF BD 04                  	LBEQ	doJump
   7276 00E1FA C9 54 00                     	CMP		#'T'
   7277 00E1FD F0 FF 52 00                  	LBEQ	doTask
   7278 00E201 C9 49 00                     	CMP		#'I'
   7279 00E204 F0 FF E5 00                  	LBEQ	doInvaders
   7280 00E208 C9 52 00                     	CMP		#'R'
   7281 00E20B D0 0F                        	BNE		.mon7
   7282 00E20D 20 36 E2                     	JSR		MonGetch
   7283 00E210 C9 44 00                     	CMP		#'D'
   7284 00E213 F0 FF 72 00                  	LBEQ	doRead
   7285 00E217 CA                           	DEX
   7286 00E218 CA                           	DEX
   7287 00E219 82 DE 00                     	BRL		doRegs
   7288 00E21C                             .mon7:
   7289 00E21C C9 42 00                     	CMP		#'B'
   7290 00E21F F0 FF 3A 00                  	LBEQ	doBasic
   7291 00E223 C9 57 00                     	CMP		#'W'
   7292 00E226 F0 FF 58 00                  	LBEQ	doWrite
   7293 00E22A 82 52 FF                     	BRL		Mon1
                                           
                                           ; Get a character from the screen, skipping over spaces and tabs
                                           ;
   7297 00E22D                             MonGetNonSpace:
   7298 00E22D                             .0001:
   7299 00E22D 20 36 E2                     	JSR		MonGetch
   7300 00E230 C9 20 00                     	CMP		#' '
   7301 00E233 F0 F8                        	BEQ		.0001
   7302 00E235 60                           	RTS
                                           
                                           ; Get a character from the screen.
                                           ;
   7306 00E236                             MonGetch:
   7307 00E236 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7308 00E23E E8                           	INX
   7309 00E23F E8                           	INX
   7310 00E240 29 FF 00                     	AND		#$FF
   7311 00E243 20 C0 E8                     	JSR		ScreenToAscii
   7312 00E246 60                           	RTS
                                           
   7314 00E247                             MonErr:
   7315 00E247 F4 01 00                     	PEA		1
   7316 00E24A F4 EB F7                     	PEA		msgErr
   7317 00E24D 20 CD EA                     	JSR		DisplayString
   7318 00E250 82 2C FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7322 00E253                             doTask:
   7323 00E253 20 F9 EB                     	JSR		GetHexNumber
   7324 00E256 A5 0C                        	LDA		NumWorkArea
   7325 00E258 42 3A                        	TSK
   7326 00E25A 82 22 FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Start the BASIC interpreter.
                                           ;------------------------------------------------------------------------------
                                           
   7332 00E25D                             doBasic:
   7333 00E25D A9 01 00                     	LDA		#$0001
   7334 00E260 42 EB                        	XBAW
   7335 00E262 A9 00 00                     	LDA		#$0000
   7336 00E265 A2 85 09                     	LDX		#$985		; executable, writeable, 64k (based at $10000)
   7337 00E268 A0 FD 0F                     	LDY		#$FFD
   7338 00E26B 42 BA                        	SDU
   7339 00E26D 42 A2 07 00                  	TSK		#7
   7340 00E271 82 0B FF                     	BRL		Mon1
                                           	
                                           ; Get starting sector number for SD Card read/write routines
                                           ;------------------------------------------------------------------------------
                                           
   7345 00E274                             GetSecnum:
   7346 00E274 20 F9 EB                     	JSR		GetHexNumber
   7347 00E277 A5 0C                        	LDA		NumWorkArea
   7348 00E279 85 C4                        	STA		secnum
   7349 00E27B A5 0E                        	LDA		NumWorkArea+2
   7350 00E27D 85 C6                        	STA		secnum+2
   7351 00E27F 82 FD FE                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Read or write a block of memory to SD Card.
                                           ;------------------------------------------------------------------------------
                                           
   7357 00E282                             doWrite:
   7358 00E282 A9 FF FF                     	LDA		#$FFFF
   7359 00E285 85 BA                        	STA		rw_flag
   7360 00E287 80 02                        	BRA		doReadWrite
   7361 00E289                             doRead:
   7362 00E289 64 BA                        	STZ		rw_flag
   7363 00E28B                             doReadWrite:
   7364 00E28B 20 CE EB                     	JSR		GetRange
   7365 00E28E 20 83 F2                     	JSR		spi_master_init
   7366 00E291 C9 00 00                     	CMP		#0
   7367 00E294 F0 03                        	BEQ		.0004
   7368 00E296 82 E6 FE                     	BRL		Mon1
   7369 00E299                             .0004:
   7370 00E299 20 B5 EA                     	JSR		OutCRLF
   7371 00E29C                             .0002:
   7372 00E29C 20 DD E2                     	JSR		DispSecnum
   7373 00E29F A5 22                        	LDA		RangeStart+2
   7374 00E2A1 48                           	PHA
   7375 00E2A2 A5 20                        	LDA		RangeStart
   7376 00E2A4 48                           	PHA
   7377 00E2A5 A5 C6                        	LDA		secnum+2
   7378 00E2A7 48                           	PHA
   7379 00E2A8 A5 C4                        	LDA		secnum
   7380 00E2AA 48                           	PHA
   7381 00E2AB 24 BA                        	BIT		rw_flag
   7382 00E2AD 50 05                        	BVC		.0005
   7383 00E2AF 20 2D F3                     	JSR		spi_master_write
   7384 00E2B2 80 03                        	BRA		.0006
   7385 00E2B4                             .0005:
   7386 00E2B4 20 B6 F2                     	JSR		spi_master_read
   7387 00E2B7                             .0006:
   7388 00E2B7 E6 C4                        	INC		secnum
   7389 00E2B9 D0 02                        	BNE		.0001
   7390 00E2BB E6 C6                        	INC		secnum+2
   7391 00E2BD                             .0001:
   7392 00E2BD 18                           	CLC
   7393 00E2BE A5 20                        	LDA		RangeStart
   7394 00E2C0 69 00 02                     	ADC		#512
   7395 00E2C3 85 20                        	STA		RangeStart
   7396 00E2C5 A5 22                        	LDA		RangeStart+2
   7397 00E2C7 69 00 00                     	ADC		#0
   7398 00E2CA 85 22                        	STA		RangeStart+2
   7399 00E2CC 38                           	SEC
   7400 00E2CD A5 20                        	LDA		RangeStart
   7401 00E2CF E5 24                        	SBC		RangeEnd
   7402 00E2D1 A5 22                        	LDA		RangeStart+2
   7403 00E2D3 E5 26                        	SBC		RangeEnd+2
   7404 00E2D5 30 C5                        	BLT		.0002
   7405 00E2D7 20 B5 EA                     	JSR		OutCRLF
   7406 00E2DA 82 A2 FE                     	BRL		Mon1
                                           
   7408 00E2DD                             DispSecnum:
   7409 00E2DD A5 C6                        	LDA		secnum+2
   7410 00E2DF 20 9E EB                     	JSR		DispWord
   7411 00E2E2 A5 C4                        	LDA		secnum
   7412 00E2E4 20 9E EB                     	JSR		DispWord
   7413 00E2E7 A9 0D 00                     	LDA		#$0D
   7414 00E2EA 4C BE EA                     	JMP		OutChar
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7418 00E2ED                             doInvaders:
   7419 00E2ED A9 FF FF                     	LDA		#$FFFF
   7420 00E2F0 8D 68 78                     	STA		do_invaders
   7421 00E2F3 42 A2 05 00                  	TSK		#5
                                           ;	FORK	#5
                                           ;	TTA
                                           ;	CMP		#5
                                           ;	LBEQ	InvadersTask
   7426 00E2F7 82 85 FE                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display Registers
                                           ; R<xx>		xx = context register to display
                                           ; Update Registers
                                           ; R.<reg> <val>
                                           ;	reg = CS PB PC A X Y SP SR DS DB DP or MP
                                           ;------------------------------------------------------------------------------
                                           
   7436 00E2FA                             doRegs:
   7437 00E2FA 20 36 E2                     	JSR		MonGetch
   7438 00E2FD C9 2E 00                     	CMP		#'.'
   7439 00E300 D0 FF 31 01                  	LBNE	.0004
   7440 00E304 20 36 E2                     	JSR		MonGetch
   7441 00E307 C9 43 00                     	CMP		#'C'
   7442 00E30A D0 26                        	BNE		.0005
   7443 00E30C 20 36 E2                     	JSR		MonGetch
   7444 00E30F C9 53 00                     	CMP		#'S'
   7445 00E312 D0 FF 69 FE                  	LBNE	Mon1
   7446 00E316 20 E8 E6                     	JSR		IgnoreBlanks
   7447 00E319 20 F9 EB                     	JSR		GetHexNumber
   7448 00E31C A5 0C                        	LDA		NumWorkArea
   7449 00E31E 85 80                        	STA		reg_cs
   7450 00E320 A5 0E                        	LDA		NumWorkArea+2
   7451 00E322 85 82                        	STA		reg_cs+2
   7452 00E324                             .buildrec
   7453 00E324 20 F7 E4                     	JSR		BuildRec
   7454 00E327 A6 BE                        	LDX		WorkTR
   7455 00E329 42 6C 00 01 00 00            	LDT		ldtrec
   7456 00E32F 82 4D FE                     	BRL		Mon1
   7457 00E332                             .0005:
   7458 00E332 C9 50 00                     	CMP		#'P'
   7459 00E335 D0 27                        	BNE		.0006
   7460 00E337 20 36 E2                     	JSR		MonGetch
   7461 00E33A C9 42 00                     	CMP		#'B'
   7462 00E33D D0 0C                        	BNE		.0007
   7463 00E33F 20 E8 E6                     	JSR		IgnoreBlanks
   7464 00E342 20 F9 EB                     	JSR		GetHexNumber
   7465 00E345 A5 0E                        	LDA		NumWorkArea+2
   7466 00E347 85 8E                        	STA		reg_pc+2
   7467 00E349 80 D9                        	BRA		.buildrec
   7468 00E34B                             .0007:
   7469 00E34B C9 43 00                     	CMP		#'C'
   7470 00E34E D0 FF 2D FE                  	LBNE	Mon1
   7471 00E352 20 E8 E6                     	JSR		IgnoreBlanks
   7472 00E355 20 F9 EB                     	JSR		GetHexNumber
   7473 00E358 A5 0C                        	LDA		NumWorkArea
   7474 00E35A 85 8C                        	STA		reg_pc
   7475 00E35C 80 C6                        	BRA		.buildrec
   7476 00E35E                             .0006:
   7477 00E35E C9 41 00                     	CMP		#'A'
   7478 00E361 D0 10                        	BNE		.0008
   7479 00E363 20 E8 E6                     	JSR		IgnoreBlanks
   7480 00E366 20 F9 EB                     	JSR		GetHexNumber
   7481 00E369 A5 0C                        	LDA		NumWorkArea
   7482 00E36B 85 90                        	STA		reg_a
   7483 00E36D A5 0E                        	LDA		NumWorkArea+2
   7484 00E36F 85 92                        	STA		reg_a+2
   7485 00E371 80 B1                        	BRA		.buildrec
   7486 00E373                             .0008:
   7487 00E373 C9 58 00                     	CMP		#'X'
   7488 00E376 D0 11                        	BNE		.0009
   7489 00E378 20 E8 E6                     	JSR		IgnoreBlanks
   7490 00E37B 20 F9 EB                     	JSR		GetHexNumber
   7491 00E37E A5 0C                        	LDA		NumWorkArea
   7492 00E380 85 94                        	STA		reg_x
   7493 00E382 A5 0E                        	LDA		NumWorkArea+2
   7494 00E384 85 96                        	STA		reg_x+2
   7495 00E386 82 9B FF                     	BRL		.buildrec
   7496 00E389                             .0009:
   7497 00E389 C9 59 00                     	CMP		#'Y'
   7498 00E38C D0 11                        	BNE		.0010
   7499 00E38E 20 E8 E6                     	JSR		IgnoreBlanks
   7500 00E391 20 F9 EB                     	JSR		GetHexNumber
   7501 00E394 A5 0C                        	LDA		NumWorkArea
   7502 00E396 85 98                        	STA		reg_y
   7503 00E398 A5 0E                        	LDA		NumWorkArea+2
   7504 00E39A 85 9A                        	STA		reg_y+2
   7505 00E39C 82 85 FF                     	BRL		.buildrec
   7506 00E39F                             .0010:
   7507 00E39F C9 53 00                     	CMP		#'S'
   7508 00E3A2 D0 2D                        	BNE		.0011
   7509 00E3A4 20 36 E2                     	JSR		MonGetch
   7510 00E3A7 C9 50 00                     	CMP		#'P'
   7511 00E3AA D0 11                        	BNE		.0015
   7512 00E3AC 20 E8 E6                     	JSR		IgnoreBlanks
   7513 00E3AF 20 F9 EB                     	JSR		GetHexNumber
   7514 00E3B2 A5 0C                        	LDA		NumWorkArea
   7515 00E3B4 85 9C                        	STA		reg_sp
   7516 00E3B6 A5 0E                        	LDA		NumWorkArea+2
   7517 00E3B8 85 9E                        	STA		reg_sp+2
   7518 00E3BA 82 67 FF                     	BRL		.buildrec
   7519 00E3BD                             .0015:
   7520 00E3BD C9 52 00                     	CMP		#'R'
   7521 00E3C0 D0 FF BB FD                  	LBNE	Mon1
   7522 00E3C4 20 E8 E6                     	JSR		IgnoreBlanks
   7523 00E3C7 20 F9 EB                     	JSR		GetHexNumber
   7524 00E3CA A5 0C                        	LDA		NumWorkArea
   7525 00E3CC 85 A0                        	STA		reg_sr
   7526 00E3CE 82 53 FF                     	BRL		.buildrec
   7527 00E3D1                             .0011:
   7528 00E3D1 C9 44 00                     	CMP		#'D'
   7529 00E3D4 D0 FF FC FF                  	LBNE	Mon14
   7530 00E3D8 20 36 E2                     	JSR		MonGetch
   7531 00E3DB C9 53 00                     	CMP		#'S'
   7532 00E3DE D0 11                        	BNE		.0012
   7533 00E3E0 20 E8 E6                     	JSR		IgnoreBlanks
   7534 00E3E3 20 F9 EB                     	JSR		GetHexNumber
   7535 00E3E6 A5 0C                        	LDA		NumWorkArea
   7536 00E3E8 85 84                        	STA		reg_ds
   7537 00E3EA A5 0E                        	LDA		NumWorkArea+2
   7538 00E3EC 85 86                        	STA		reg_ds+2
   7539 00E3EE 82 33 FF                     	BRL		.buildrec
   7540 00E3F1                             .0012:
   7541 00E3F1 C9 42 00                     	CMP		#'B'
   7542 00E3F4 D0 0D                        	BNE		.0013
   7543 00E3F6 20 E8 E6                     	JSR		IgnoreBlanks
   7544 00E3F9 20 F9 EB                     	JSR		GetHexNumber
   7545 00E3FC A5 0C                        	LDA		NumWorkArea
   7546 00E3FE 85 A4                        	STA		reg_db
   7547 00E400 82 21 FF                     	BRL		.buildrec
   7548 00E403                             .0013:
   7549 00E403 C9 50 00                     	CMP		#'P'
   7550 00E406 D0 FF 75 FD                  	LBNE	Mon1
   7551 00E40A 20 E8 E6                     	JSR		IgnoreBlanks
   7552 00E40D 20 F9 EB                     	JSR		GetHexNumber
   7553 00E410 A5 0C                        	LDA		NumWorkArea
   7554 00E412 85 A8                        	STA		reg_dp
   7555 00E414 82 0D FF                     	BRL		.buildrec
   7556 00E417                             .0014:
   7557 00E417 C9 4D 00                     	CMP		#'M'
   7558 00E41A D0 FF 61 FD                  	LBNE	Mon1
   7559 00E41E 20 36 E2                     	JSR		MonGetch
   7560 00E421 C9 50 00                     	CMP		#'P'
   7561 00E424 D0 FF 57 FD                  	LBNE	Mon1
   7562 00E428 20 E8 E6                     	JSR		IgnoreBlanks
   7563 00E42B 20 F9 EB                     	JSR		GetHexNumber
   7564 00E42E A5 0C                        	LDA		NumWorkArea
   7565 00E430 85 B0                        	STA		reg_mp
   7566 00E432 82 EF FE                     	BRL		.buildrec
                                           
   7568 00E435                             .0004:
   7569 00E435 CA                           	DEX
   7570 00E436 CA                           	DEX
                                           ;	JSR		IgnoreBlanks
   7572 00E437 20 F9 EB                     	JSR		GetHexNumber
   7573 00E43A C0 00 00                     	CPY		#0
   7574 00E43D F0 FF 3E FD                  	LBEQ	Mon1
   7575 00E441 A5 0C                        	LDA		NumWorkArea
   7576 00E443 85 BE                        	STA		WorkTR
   7577 00E445 42 28 03 00                  	BSR		DispRegs
   7578 00E449 82 33 FD                     	BRL		Mon1
                                           
   7580 00E44C                             DispRegs:
   7581 00E44C F4 01 00                     	PEA		1
   7582 00E44F F4 70 F7                     	PEA		msgRegs
   7583 00E452 20 CD EA                     	JSR		DisplayString
   7584 00E455 20 C5 EB                     	JSR		space
                                           
   7586 00E458 A5 BE                        	LDA		WorkTR
   7587 00E45A 0A                           	ASL
   7588 00E45B 0A                           	ASL
   7589 00E45C 0A                           	ASL
   7590 00E45D 0A                           	ASL
   7591 00E45E AA                           	TAX
                                           
   7593 00E45F A0 00 00                     	LDY		#0
   7594 00E462                             .0001:
   7595 00E462 42 4A                        	INF
   7596 00E464 E8                           	INX
   7597 00E465 99 80 00                     	STA		reg_cs,Y
   7598 00E468 42 EB                        	XBAW
   7599 00E46A 99 82 00                     	STA		reg_cs+2,Y
   7600 00E46D 42 C8                        	INY4
   7601 00E46F C0 30 00                     	CPY		#48
   7602 00E472 D0 EE                        	BNE		.0001
                                           
                                           	; Display CS
   7605 00E474 A5 80                        	LDA		reg_cs
   7606 00E476 20 9E EB                     	JSR		DispWord
   7607 00E479 A9 3A 00                     	LDA		#':'
   7608 00E47C 20 BE EA                     	JSR		OutChar
                                           
                                           	; Display PB PC
   7611 00E47F A5 8E                        	LDA		reg_pc+2
   7612 00E481 20 A3 EB                     	JSR		DispByte
   7613 00E484 A5 8C                        	LDA		reg_pc
   7614 00E486 20 9E EB                     	JSR		DispWord
   7615 00E489 20 C5 EB                     	JSR		space
                                           
                                           	; Display SRX,SR
   7618 00E48C A5 A0                        	LDA		reg_cs+32
   7619 00E48E A2 10 00                     	LDX		#16
   7620 00E491                             .0003:
   7621 00E491 0A                           	ASL
   7622 00E492 48                           	PHA
   7623 00E493 A9 30 00                     	LDA		#'0'
   7624 00E496 69 00 00                     	ADC		#0
   7625 00E499 20 AC EB                     	JSR		DispNybble
   7626 00E49C 68                           	PLA
   7627 00E49D CA                           	DEX
   7628 00E49E D0 F1                        	BNE		.0003
   7629 00E4A0 20 C5 EB                     	JSR		space
                                           
   7631 00E4A3 A2 10 00                     	LDX		#16
   7632 00E4A6                             .0002
                                           	; display Acc,.X,.Y,.SP
   7634 00E4A6 B5 82                        	LDA		reg_cs+2,X
   7635 00E4A8 20 9E EB                     	JSR		DispWord
   7636 00E4AB B5 80                        	LDA		reg_cs,X
   7637 00E4AD 20 9E EB                     	JSR		DispWord
   7638 00E4B0 20 C5 EB                     	JSR		space
   7639 00E4B3 42 E8                        	INX4
   7640 00E4B5 E0 20 00                     	CPX		#32
   7641 00E4B8 D0 EC                        	BNE		.0002
                                           
   7643 00E4BA F4 01 00                     	PEA		1
   7644 00E4BD F4 CC F7                     	PEA		msgRegs2
   7645 00E4C0 20 CD EA                     	JSR		DisplayString
   7646 00E4C3 20 C5 EB                     	JSR		space
                                           
                                           	; Display SS
   7649 00E4C6 A5 88                        	LDA		reg_ss
   7650 00E4C8 20 9E EB                     	JSR		DispWord
   7651 00E4CB 20 C5 EB                     	JSR		space
                                           
                                           	; Display DS
   7654 00E4CE A5 84                        	LDA		reg_ds
   7655 00E4D0 20 9E EB                     	JSR		DispWord
   7656 00E4D3 20 C5 EB                     	JSR		space
                                           
                                           	; Display DB
   7659 00E4D6 A5 A4                        	LDA		reg_db
   7660 00E4D8 20 A3 EB                     	JSR		DispByte
   7661 00E4DB 20 C5 EB                     	JSR		space
                                           
                                           	; Display DPR
   7664 00E4DE A5 A8                        	LDA		reg_dp
   7665 00E4E0 20 9E EB                     	JSR		DispWord
   7666 00E4E3 20 C5 EB                     	JSR		space
                                           
                                           	; Display back link
   7669 00E4E6 A5 AC                        	LDA		reg_bl
   7670 00E4E8 20 9E EB                     	JSR		DispWord
                                           
                                           	; Display map number
   7673 00E4EB 20 C5 EB                     	JSR		space
   7674 00E4EE A5 B0                        	LDA		reg_mp
   7675 00E4F0 20 A3 EB                     	JSR		DispByte
                                           
   7677 00E4F3 20 B5 EA                     	JSR		OutCRLF
   7678 00E4F6 60                           	RTS
                                           
                                           ; Build a startup record from the register values so that a context reg
                                           ; may be loaded
                                           
   7683 00E4F7                             BuildRec:
   7684 00E4F7 A5 80                        	LDA		reg_cs
   7685 00E4F9 8D 00 01                     	STA		ldtrec
   7686 00E4FC A5 84                        	LDA		reg_ds
   7687 00E4FE 8D 02 01                     	STA		ldtrec+2
   7688 00E501 A5 88                        	LDA		reg_ss
   7689 00E503 8D 04 01                     	STA		ldtrec+4
   7690 00E506 A5 8C                        	LDA		reg_pc
   7691 00E508 8D 06 01                     	STA		ldtrec+6
   7692 00E50B A5 8E                        	LDA		reg_pc+2
   7693 00E50D 29 FF 00                     	AND		#$FF
   7694 00E510 E2 30                        	SEP		#$30		; 8 bit regs
                                           	MEM		8
   7696 00E512 EB                           	XBA
   7697 00E513 A5 90                        	LDA		reg_a
   7698 00E515 EB                           	XBA
   7699 00E516 C2 30                        	REP		#$30
                                           	MEM		16
   7701 00E518 8D 08 01                     	STA		ldtrec+8
   7702 00E51B A5 91                        	LDA		reg_a+1
   7703 00E51D 8D 0A 01                     	STA		ldtrec+10
   7704 00E520 A5 93                        	LDA		reg_a+3
   7705 00E522 8D 0C 01                     	STA		ldtrec+12
   7706 00E525 A5 95                        	LDA		reg_x+1
   7707 00E527 8D 0E 01                     	STA		ldtrec+14
   7708 00E52A A5 97                        	LDA		reg_x+3
   7709 00E52C 8D 10 01                     	STA		ldtrec+16
   7710 00E52F A5 99                        	LDA		reg_y+1
   7711 00E531 8D 12 01                     	STA		ldtrec+18
   7712 00E534 A5 9B                        	LDA		reg_y+3
   7713 00E536 8D 14 01                     	STA		ldtrec+20
   7714 00E539 A5 9D                        	LDA		reg_sp+1
   7715 00E53B 8D 16 01                     	STA		ldtrec+22
   7716 00E53E A5 9F                        	LDA		reg_sp+3
   7717 00E540 8D 18 01                     	STA		ldtrec+24
   7718 00E543 E2 30                        	SEP		#$30
   7719 00E545 A5 A1                        	LDA		reg_sr+1
   7720 00E547 8D 1A 01                     	STA		ldtrec+26
   7721 00E54A A5 A4                        	LDA		reg_db
   7722 00E54C 8D 1B 01                     	STA		ldtrec+27
   7723 00E54F A5 A8                        	LDA		reg_dp
   7724 00E551 8D 1C 01                     	STA		ldtrec+28
   7725 00E554 A5 A9                        	LDA		reg_dp+1
   7726 00E556 8D 1D 01                     	STA		ldtrec+29
   7727 00E559 A5 B0                        	LDA		reg_mp
   7728 00E55B 8D 1E 01                     	STA		ldtrec+30
   7729 00E55E 9C 1F 01                     	STZ		ldtrec+31
   7730 00E561 C2 30                        	REP		#$30
   7731 00E563 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Dump memory.
                                           ;------------------------------------------------------------------------------
                                           
   7737 00E564                             doMemoryDump:
   7738 00E564 20 E8 E6                     	JSR		IgnoreBlanks
   7739 00E567 20 CE EB                     	JSR		GetRange
   7740 00E56A 20 B5 EA                     	JSR		OutCRLF
   7741 00E56D                             .0007:
   7742 00E56D A9 3E 00                     	LDA		#'>'
   7743 00E570 20 BE EA                     	JSR		OutChar
   7744 00E573 20 D8 E6                     	JSR		DispRangeStart
   7745 00E576 A0 00 00                     	LDY		#0
   7746 00E579                             .0001:
   7747 00E579 42 B7 20                     	LDA		{RangeStart},Y
   7748 00E57C 20 A3 EB                     	JSR		DispByte
   7749 00E57F A9 20 00                     	LDA		#' '
   7750 00E582 20 BE EA                     	JSR		OutChar
   7751 00E585 C8                           	INY
   7752 00E586 C0 08 00                     	CPY		#8
   7753 00E589 D0 EE                        	BNE		.0001
   7754 00E58B A0 00 00                     	LDY 	#0
   7755 00E58E                             .0005:
   7756 00E58E 42 B7 20                     	LDA		{RangeStart},Y
   7757 00E591 29 FF 00                     	AND		#$FF
   7758 00E594 C9 20 00                     	CMP		#' '
   7759 00E597 B0 05                        	BCS		.0002
   7760 00E599                             .0004:
   7761 00E599 A9 2E 00                     	LDA		#'.'
   7762 00E59C 80 05                        	BRA		.0003
   7763 00E59E                             .0002:
   7764 00E59E C9 7F 00                     	CMP		#$7f
   7765 00E5A1 B0 F6                        	BCS		.0004
   7766 00E5A3                             .0003:
   7767 00E5A3 20 BE EA                     	JSR		OutChar
   7768 00E5A6 C8                           	INY
   7769 00E5A7 C0 08 00                     	CPY		#8
   7770 00E5AA D0 E2                        	BNE		.0005
   7771 00E5AC 20 B5 EA                     	JSR		OutCRLF
   7772 00E5AF 18                           	CLC
   7773 00E5B0 A5 20                        	LDA		RangeStart
   7774 00E5B2 69 08 00                     	ADC		#8
   7775 00E5B5 85 20                        	STA		RangeStart
   7776 00E5B7 90 02                        	BCC		.0006
   7777 00E5B9 E6 22                        	INC		RangeStart+2
   7778 00E5BB                             .0006:
   7779 00E5BB 38                           	SEC
   7780 00E5BC A5 24                        	LDA		RangeEnd
   7781 00E5BE E5 20                        	SBC		RangeStart
   7782 00E5C0 A5 26                        	LDA		RangeEnd+2
   7783 00E5C2 E5 22                        	SBC		RangeStart+2
   7784 00E5C4 08                           	PHP
   7785 00E5C5 20 18 EE                     	JSR		KeybdGetCharNoWait;Ctx,7
   7786 00E5C8 29 FF 00                     	AND		#$FF
   7787 00E5CB C9 03 00                     	CMP		#CTRLC
   7788 00E5CE F0 04                        	BEQ		.0009
   7789 00E5D0 28                           	PLP
   7790 00E5D1 10 9A                        	BPL		.0007
   7791 00E5D3                             .0008:
   7792 00E5D3 60                           	RTS
   7793 00E5D4                             .0009:
   7794 00E5D4 28                           	PLP
   7795 00E5D5 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Edit memory.
                                           ; ><memory address> <val1> <val2> ... <val8>
                                           ;------------------------------------------------------------------------------
                                           
   7802 00E5D6                             doMemoryEdit:
   7803 00E5D6 20 E8 E6                     	JSR		IgnoreBlanks
   7804 00E5D9 20 F9 EB                     	JSR		GetHexNumber
   7805 00E5DC C0 00 00                     	CPY		#0
   7806 00E5DF F0 FF 9C FB                  	LBEQ	Mon1
   7807 00E5E3 A5 0C                        	LDA		NumWorkArea
   7808 00E5E5 85 20                        	STA		RangeStart
   7809 00E5E7 A5 0E                        	LDA		NumWorkArea+2
   7810 00E5E9 85 22                        	STA		RangeStart+2
   7811 00E5EB A0 00 00                     	LDY		#0
   7812 00E5EE                             .0001:
   7813 00E5EE 5A                           	PHY
   7814 00E5EF 20 E8 E6                     	JSR		IgnoreBlanks
   7815 00E5F2 20 F9 EB                     	JSR		GetHexNumber
   7816 00E5F5 C0 00 00                     	CPY		#0
   7817 00E5F8 F0 13                        	BEQ		.0002
   7818 00E5FA 7A                           	PLY
   7819 00E5FB E2 20                        	SEP		#$20
   7820 00E5FD A5 0C                        	LDA		NumWorkArea
   7821 00E5FF 42 97 20                     	STA		{RangeStart},Y
   7822 00E602 C2 20                        	REP		#$20
   7823 00E604 C8                           	INY
   7824 00E605 C0 08 00                     	CPY		#8
   7825 00E608 D0 E4                        	BNE		.0001
   7826 00E60A 82 72 FB                     	BRL		Mon1
   7827 00E60D                             .0002:
   7828 00E60D 7A                           	PLY
   7829 00E60E 82 6E FB                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Fill memory.
                                           ; $F <start address> <end address> <val1>
                                           ;------------------------------------------------------------------------------
                                           
   7836 00E611                             doFill:
   7837 00E611 20 E8 E6                     	JSR		IgnoreBlanks
   7838 00E614 20 F9 EB                     	JSR		GetHexNumber
   7839 00E617 C0 00 00                     	CPY		#0
   7840 00E61A F0 FF 29 FC                  	LBEQ	MonErr
   7841 00E61E A5 0C                        	LDA		NumWorkArea
   7842 00E620 85 20                        	STA		RangeStart
   7843 00E622 A5 0E                        	LDA		NumWorkArea+2
   7844 00E624 85 22                        	STA		RangeStart+2
   7845 00E626 20 E8 E6                     	JSR		IgnoreBlanks
   7846 00E629 20 F9 EB                     	JSR		GetHexNumber
   7847 00E62C C0 00 00                     	CPY		#0
   7848 00E62F F0 FF 14 FC                  	LBEQ	MonErr
   7849 00E633 A5 0C                        	LDA		NumWorkArea
   7850 00E635 85 24                        	STA		RangeEnd
   7851 00E637 A5 0E                        	LDA		NumWorkArea+2
   7852 00E639 85 26                        	STA		RangeEnd+2
   7853 00E63B 20 E8 E6                     	JSR		IgnoreBlanks
   7854 00E63E 20 F9 EB                     	JSR		GetHexNumber
   7855 00E641 C0 00 00                     	CPY		#0
   7856 00E644 F0 FF FF FB                  	LBEQ	MonErr
   7857 00E648 A6 0C                        	LDX		NumWorkArea
                                           	; Process in 32 bit mode
   7859 00E64A 42 E2 00 02                  	SEP		#$200
   7860 00E64E 42 C2 00 01                  	REP		#$100
   7861 00E652 A5 24                        	LDA		RangeEnd
   7862 00E654 38                           	SEC
   7863 00E655 E5 20                        	SBC		RangeStart
   7864 00E657 A4 20                        	LDY		RangeStart
   7865 00E659 42 44 00                     	FIL		$00
                                           	; Back to 16 bits mode
   7867 00E65C 42 C2 00 02                  	REP		#$200
   7868 00E660 42 E2 00 01                  	SEP		#$100
   7869 00E664 82 18 FB                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Disassemble code
                                           ;------------------------------------------------------------------------------
                                           
   7875 00E667                             doDisassemble:
   7876 00E667 20 36 E2                     	JSR		MonGetch
   7877 00E66A C9 4D 00                     	CMP		#'M'
   7878 00E66D F0 11                        	BEQ		.0002
   7879 00E66F                             .0004:
   7880 00E66F C9 4E 00                     	CMP		#'N'
   7881 00E672 D0 1B                        	BNE		.0003
   7882 00E674 E2 20                        	SEP		#$20
                                           	MEM		8
   7884 00E676 A5 BC                        	LDA		$BC
   7885 00E678 09 40                        	ORA		#$40
   7886 00E67A 85 BC                        	STA		$BC
   7887 00E67C C2 20                        	REP		#$20
   7888 00E67E 80 11                        	BRA		.0005
   7889 00E680                             .0002:
   7890 00E680 E2 20                        	SEP		#$20
   7891 00E682 A5 BC                        	LDA		$BC
   7892 00E684 09 80                        	ORA		#$80
   7893 00E686 85 BC                        	STA		$BC
   7894 00E688 C2 20                        	REP		#$20
   7895 00E68A 20 36 E2                     	JSR		MonGetch
   7896 00E68D 80 E0                        	BRA		.0004
                                           	MEM		16
   7898 00E68F                             .0003:
   7899 00E68F CA                           	DEX
   7900 00E690 CA                           	DEX
   7901 00E691                             .0005:
   7902 00E691 20 E8 E6                     	JSR		IgnoreBlanks
   7903 00E694 20 CE EB                     	JSR		GetRange
   7904 00E697 A5 20                        	LDA		RangeStart
   7905 00E699 85 8F                        	STA		$8F				; addra
   7906 00E69B A5 21                        	LDA		RangeStart+1
   7907 00E69D 85 90                        	STA		$90
   7908 00E69F 20 B5 EA                     	JSR		OutCRLF
   7909 00E6A2 A0 14 00                     	LDY		#20
   7910 00E6A5                             .0001:
   7911 00E6A5 5A                           	PHY
   7912 00E6A6 E2 30                        	SEP		#$30
   7913 00E6A8 20 55 C6                     	JSR		dpycod
   7914 00E6AB C2 30                        	REP		#$30
   7915 00E6AD 20 B5 EA                     	JSR		OutCRLF
   7916 00E6B0 7A                           	PLY
   7917 00E6B1 88                           	DEY
   7918 00E6B2 D0 F1                        	BNE		.0001
   7919 00E6B4 4C 7F E1                     	JMP		Mon1
                                           
                                           ;$BC flimflag
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Jump to subroutine
                                           ;------------------------------------------------------------------------------
                                           
   7927 00E6B7                             doJump:
   7928 00E6B7 20 E8 E6                     	JSR		IgnoreBlanks
   7929 00E6BA 20 F9 EB                     	JSR		GetHexNumber
   7930 00E6BD C0 00 00                     	CPY		#0
   7931 00E6C0 F0 FF BB FA                  	LBEQ	Mon1
   7932 00E6C4 A9 5C 00                     	LDA		#$5C			; JML opcode
   7933 00E6C7 85 23                        	STA		RangeEnd-1
   7934 00E6C9 A5 0C                        	LDA		NumWorkArea
   7935 00E6CB 85 24                        	STA		RangeEnd
   7936 00E6CD A5 0D                        	LDA		NumWorkArea+1
   7937 00E6CF 85 25                        	STA		RangeEnd+1
   7938 00E6D1 22 24 00 00                  	JSL		RangeEnd
   7939 00E6D5 82 A7 FA                     	BRL		Mon1
                                           
   7941 00E6D8                             DispRangeStart:
   7942 00E6D8 A5 21                        	LDA		RangeStart+1
   7943 00E6DA 20 9E EB                     	JSR		DispWord
   7944 00E6DD A5 20                        	LDA		RangeStart
   7945 00E6DF 20 A3 EB                     	JSR		DispByte
   7946 00E6E2 A9 20 00                     	LDA		#' '
   7947 00E6E5 4C BE EA                     	JMP		OutChar
                                           	
                                           ; Skip over blanks in the input
                                           ;------------------------------------------------------------------------------
                                           
   7952 00E6E8                             IgnoreBlanks:
   7953 00E6E8                             .0001:
   7954 00E6E8 20 36 E2                     	JSR		MonGetch
   7955 00E6EB C9 20 00                     	CMP		#' '
   7956 00E6EE F0 F8                        	BEQ		.0001
   7957 00E6F0 CA                           	DEX
   7958 00E6F1 CA                           	DEX
   7959 00E6F2 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; BIOSInput allows full screen editing of text until a carriage return is keyed
                                           ; at which point the line the cursor is on is copied to a buffer. The buffer
                                           ; must be at least TEXTCOLS characters in size.
                                           ;------------------------------------------------------------------------------
                                           ;
   7967 00E6F3                             BIOSInput:
   7968 00E6F3                             .bin1:
   7969 00E6F3 20 23 EE                     	JSR		KeybdGetCharWait
   7970 00E6F6 29 FF 00                     	AND		#$FF
   7971 00E6F9 C9 0D 00                     	CMP		#CR
   7972 00E6FC F0 05                        	BEQ		.bin2
   7973 00E6FE 20 BE EA                     	JSR		OutChar
   7974 00E701 80 F0                        	BRA		.bin1
   7975 00E703                             .bin2:
   7976 00E703 A5 30                        	LDA		CursorX
   7977 00E705 F0 1E                        	BEQ		.bin4
   7978 00E707 A5 34                        	LDA		VideoPos	; get current video position
   7979 00E709 38                           	SEC
   7980 00E70A E5 30                        	SBC		CursorX		; go back to the start of the line
   7981 00E70C 0A                           	ASL
   7982 00E70D AA                           	TAX
   7983 00E70E                             .bin3:
   7984 00E70E 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7985 00E716 29 FF 00                     	AND		#$FF
   7986 00E719 93 03                        	STA		(3,s),Y
   7987 00E71B E8                           	INX
   7988 00E71C E8                           	INX
   7989 00E71D C8                           	INY
   7990 00E71E C6 30                        	DEC		CursorX
   7991 00E720 D0 EC                        	BNE		.bin3
   7992 00E722 A9 00 00                     	LDA		#0
   7993 00E725                             .bin4:
   7994 00E725 93 03                        	STA		(3,s),Y	; NULL terminate buffer
   7995 00E727 60                           	RTS
                                           
   7997 00E728                             .st0003:
   7998 00E728 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD
                                         
   7999 00E730 10 F6                        	BPL		.st0003
   8000 00E732 48                           	PHA						; save off the char (we need to trash acc)
   8001 00E733 42 3B FF 0F AF 14 A1 0E      	LDA		$FFF:KEYBD+4	; clear keyboard strobe (must be a read operation)
                                         
   8002 00E73B 68                           	PLA						; restore char
   8003 00E73C 20 CC E8                     	JSR		DisplayChar
   8004 00E73F 80 E7                        	BRA		.st0003
   8005 00E741 A0 00 00                     	ldy		#$0000
   8006 00E744                             .st0001:
   8007 00E744 A2 00 00                     	ldx		#$0000
   8008 00E747                             .st0002:
   8009 00E747 E8                           	inx
   8010 00E748 D0 FD                        	bne		.st0002
   8011 00E74A 20 6D E7                     	jsr		echo_switch
   8012 00E74D C8                           	iny
   8013 00E74E 80 F4                        	bra		.st0001
                                           
   8015 00E750                             msgStarting:
   8016 00E750 46 54 38 33 32 20 54 65      	.byte	"FT832 Test System Starting",CR,LF,0
   8016 00E758 73 74 20 53 79 73 74 65    
   8016 00E760 6D 20 53 74 61 72 74 69    
   8016 00E768 6E 67 0D 0A 00             
                                           
   8018 00E76D                             echo_switch:
   8019 00E76D AD 00 71                     	lda		$7100
   8020 00E770 8D 00 70                     	sta		$7000
   8021 00E773 60                           	rts
                                           
                                           ;------------------------------------------------------------------------------
                                           ; On entry to the SSM task the .A register will be set to the task number
                                           ; being single stepped. The .X register will contain the address of the
                                           ; next instruction to execute.
                                           ;------------------------------------------------------------------------------
                                           
   8029 00E774                             SSMInit:
                                           	; setup SSM data segment in SDT
   8031 00E774 A0 06 00                     	LDY		#6
   8032 00E777 A9 01 00                     	LDA		#1
   8033 00E77A 42 EB                        	XBAW
   8034 00E77C A9 00 00                     	LDA		#$0000
   8035 00E77F A2 82 08                     	LDX		#$882		; 1k data
   8036 00E782 42 BA                        	SDU
                                           	; Setup SSM stack segment in SDT
   8038 00E784 C8                           	INY
   8039 00E785 A9 00 04                     	LDA		#$0400
   8040 00E788 A2 82 08                     	LDX		#$882		; 1k stack
   8041 00E78B 42 BA                        	SDU
                                           	; Setup SSM code segment in SDT
   8043 00E78D C8                           	INY
   8044 00E78E A9 00 00                     	LDA		#$0000
   8045 00E791 42 EB                        	XBAW
   8046 00E793 A9 00 00                     	LDA		#$0000
   8047 00E796 A2 05 09                     	LDX		#$905
   8048 00E799 42 BA                        	SDU
   8049 00E79B 42 5C A2 E7 00 08 00         	JMF		8:.0001
   8050 00E7A2                             .0001:
                                           	; Initialize data selector and stack selector, pointer
                                           	; The stack is begin switched from the one currently defined by
                                           	; by the task table. So the return task needs to be popped off
                                           	; the current stack and placed on the new one.
   8055 00E7A2 FA                           	PLX					; get the task to return to
   8056 00E7A3 A9 07 00                     	LDA		#7
   8057 00E7A6 78                           	SEI
   8058 00E7A7 42 5A                        	TASS
   8059 00E7A9 A9 FF 03                     	LDA		#$3FF		; setup stack pointer
   8060 00E7AC 1B                           	TAS
   8061 00E7AD 58                           	CLI
   8062 00E7AE DA                           	PHX					; save return task on new stack
   8063 00E7AF F4 06 00                     	PEA		6
   8064 00E7B2 42 2B                        	PLDS
                                           
   8066 00E7B4 A9 00 61                     	LDA		#$6100
   8067 00E7B7 85 36                        	STA		NormAttr
   8068 00E7B9 A9 FF 0F                     	LDA		#4095		; set segment
   8069 00E7BC 85 44                        	STA		Vidptr+4
   8070 00E7BE 85 4A                        	STA		Vidregs+4
   8071 00E7C0 A9 0B 00                     	LDA		#$000B		; screen location is $FB0000
   8072 00E7C3 85 42                        	STA		Vidptr+2
   8073 00E7C5 64 40                        	STZ		Vidptr
   8074 00E7C7 A9 0E 00                     	LDA		#$000E		; regset is at $FEA010
   8075 00E7CA 85 48                        	STA		Vidregs+2
   8076 00E7CC A9 10 A0                     	LDA		#$A010
   8077 00E7CF 85 46                        	STA		Vidregs
   8078 00E7D1 A0 07 00                     	LDY		#7
   8079 00E7D4 A9 10 00                     	LDA		#$10		; divide by 2 vertically, 1 horizontally
   8080 00E7D7 20 17 EB                     	JSR		SetVideoReg
   8081 00E7DA A9 B4 00                     	LDA		#180		; set window left position 672
   8082 00E7DD A0 02 00                     	LDY		#2
   8083 00E7E0 20 17 EB                     	JSR		SetVideoReg
   8084 00E7E3 A9 02 00                     	LDA		#2
   8085 00E7E6 A0 03 00                     	LDY		#3
   8086 00E7E9 20 17 EB                     	JSR		SetVideoReg
   8087 00E7EC A9 20 00                     	LDA		#32			; set window top position
   8088 00E7EF A0 04 00                     	LDY		#4
   8089 00E7F2 20 17 EB                     	JSR		SetVideoReg
   8090 00E7F5 20 FC EA                     	JSR		GetTextRowsCols
   8091 00E7F8 A9 CC E8                     	LDA		#DisplayChar
   8092 00E7FB 8D F0 03                     	STA		OutputVec
   8093 00E7FE 20 41 EB                     	JSR		ClearScreen
   8094 00E801 20 91 EA                     	JSR		HomeCursor
   8095 00E804 F4 08 00                     	PEA		8
   8096 00E807 F4 82 E8                     	PEA		msgSSM
   8097 00E80A 20 CD EA                     	JSR		DisplayString
   8098 00E80D 42 60                        	RTT
   8099 00E80F                             SSMTask:
   8100 00E80F 85 BE                        	STA		WorkTR
   8101 00E811 20 4C E4                     	JSR		DispRegs
   8102 00E814                             .0004:
   8103 00E814 A9 53 00                     	LDA		#'S'
   8104 00E817 20 BE EA                     	JSR		OutChar
   8105 00E81A A9 53 00                     	LDA		#'S'
   8106 00E81D 20 BE EA                     	JSR		OutChar
   8107 00E820 A9 4D 00                     	LDA		#'M'
   8108 00E823 20 BE EA                     	JSR		OutChar
   8109 00E826 A9 3E 00                     	LDA		#'>'
   8110 00E829                             .0005:
   8111 00E829 20 BE EA                     	JSR		OutChar
   8112 00E82C                             .0008:
   8113 00E82C 20 23 EE                     	JSR		KeybdGetCharWait
   8114 00E82F B0 FB                        	BCS		.0008
   8115 00E831 29 FF 00                     	AND		#$FF
   8116 00E834 C9 53 00                     	CMP		#'S'		; step
   8117 00E837 D0 04                        	BNE		.0001
   8118 00E839                             .0002:
   8119 00E839 42 60                        	RTT
   8120 00E83B 80 D2                        	BRA		SSMTask
   8121 00E83D                             .0001:
   8122 00E83D C9 58 00                     	CMP		#'X'
   8123 00E840 D0 16                        	BNE		.0006
   8124 00E842 A5 A0                        	LDA		reg_sr
   8125 00E844 29 FF EF                     	AND		#$EFFF
   8126 00E847 85 A0                        	STA		reg_sr
   8127 00E849 20 F7 E4                     	JSR		BuildRec
   8128 00E84C A6 BE                        	LDX		WorkTR
   8129 00E84E 42 6C 00 01 00 00            	LDT		ldtrec
   8130 00E854 42 60                        	RTT
   8131 00E856 80 B7                        	BRA		SSMTask
   8132 00E858                             .0006:
   8133 00E858 C9 0D 00                     	CMP		#CR
   8134 00E85B D0 CC                        	BNE		.0005
   8135 00E85D A5 32                        	LDA		CursorY
   8136 00E85F 0A                           	ASL
   8137 00E860 AA                           	TAX
   8138 00E861 42 1B BD F2 F5               	LDA		CS:LineTbl,X
   8139 00E866 18                           	CLC
   8140 00E867 69 04 00                     	ADC		#4
   8141 00E86A 0A                           	ASL
   8142 00E86B AA                           	TAX
   8143 00E86C 20 E8 E6                     	JSR		IgnoreBlanks
   8144 00E86F 20 36 E2                     	JSR		MonGetch
   8145 00E872 C9 4D 00                     	CMP		#'M'
   8146 00E875 D0 03                        	BNE		.0007
   8147 00E877 20 64 E5                     	JSR		doMemoryDump
   8148 00E87A                             .0007:
   8149 00E87A 82 AC FF                     	BRL		.0005
   8150 00E87D 42 60                        	RTT
   8151 00E87F 82 8D FF                     	BRL		SSMTask
                                           
   8153 00E882                             msgSSM:
   8154 00E882 53 69 6E 67 6C 65 20 73      	.byte	"Single step mode task starting.",CR,LF,0
   8154 00E88A 74 65 70 20 6D 6F 64 65    
   8154 00E892 20 74 61 73 6B 20 73 74    
   8154 00E89A 61 72 74 69 6E 67 2E 0D    
   8154 00E8A2 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert Ascii character to screen character.
                                           ;------------------------------------------------------------------------------
                                           
   8160 00E8A4                             AsciiToScreen:
   8161 00E8A4 29 FF 00                     	AND		#$FF
   8162 00E8A7 89 20 00                     	BIT		#%00100000	; if bit 5 isn't set
   8163 00E8AA F0 08                        	BEQ		.00001
   8164 00E8AC 89 40 00                     	BIT		#%01000000	; or bit 6 isn't set
   8165 00E8AF F0 03                        	BEQ		.00001
   8166 00E8B1 29 9F 00                     	AND		#%10011111
   8167 00E8B4                             .00001:
   8168 00E8B4 60                           	rts
                                           
                                           	MEM		8
   8171 00E8B5                             AsciiToScreen8:
   8172 00E8B5 89 20                        	BIT		#%00100000	; if bit 5 isn't set
   8173 00E8B7 F0 06                        	BEQ		.00001
   8174 00E8B9 89 40                        	BIT		#%01000000	; or bit 6 isn't set
   8175 00E8BB F0 02                        	BEQ		.00001
   8176 00E8BD 29 9F                        	AND		#%10011111
   8177 00E8BF                             .00001:
   8178 00E8BF 60                           	rts
                                           
                                           	MEM		16
                                           ;------------------------------------------------------------------------------
                                           ; Convert screen character to ascii character
                                           ;------------------------------------------------------------------------------
                                           ;
   8185 00E8C0                             ScreenToAscii:
   8186 00E8C0 29 FF 00                     	AND		#$FF
   8187 00E8C3 C9 1B 00                     	CMP		#26+1
   8188 00E8C6 B0 03                        	BCS		.0001
   8189 00E8C8 69 60 00                     	ADC		#$60
   8190 00E8CB                             .0001:
   8191 00E8CB 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display a character on the screen device
                                           ; Expects the processor to be in 16 bit mode with 16 bit acc and 16 bit indexes
                                           ;------------------------------------------------------------------------------
                                           ;
   8198 00E8CC                             DisplayChar:
   8199 00E8CC 29 FF 00                     	AND		#$0FF
   8200 00E8CF 24 3C                        	BIT		EscState		; check if processing escape sequence
   8201 00E8D1 30 FF 89 00                  	LBMI	processEsc
   8202 00E8D5 C9 08 00                     	CMP		#BS
   8203 00E8D8 F0 FF 33 01                  	LBEQ	doBackSpace
   8204 00E8DC C9 91 00                     	CMP		#$91			; cursor right
   8205 00E8DF F0 FF 89 01                  	LBEQ	doCursorRight
   8206 00E8E3 C9 93 00                     	CMP		#$93			; cursor left
   8207 00E8E6 F0 FF 8D 01                  	LBEQ	doCursorLeft
   8208 00E8EA C9 90 00                     	CMP		#$90			; cursor up
   8209 00E8ED F0 FF 8D 01                  	LBEQ	doCursorUp
   8210 00E8F1 C9 92 00                     	CMP		#$92			; cursor down
   8211 00E8F4 F0 FF 8D 01                  	LBEQ	doCursorDown
   8212 00E8F8 C9 99 00                     	CMP		#$99			; delete
   8213 00E8FB F0 FF 3B 01                  	LBEQ	doDelete
   8214 00E8FF C9 0D 00                     	CMP		#CR
   8215 00E902 F0 47                        	BEQ		doCR
   8216 00E904 C9 0A 00                     	CMP		#LF
   8217 00E907 F0 47                        	BEQ		doLF
   8218 00E909 C9 94 00                     	CMP		#$94
   8219 00E90C F0 FF 54 01                  	LBEQ	doCursorHome	; cursor home
   8220 00E910 C9 1B 00                     	CMP		#ESC
   8221 00E913 D0 05                        	BNE		.0003
   8222 00E915 64 3C                        	STZ		EscState		; put a -1 in the escape state
   8223 00E917 C6 3C                        	DEC		EscState
   8224 00E919 60                           	RTS
   8225 00E91A                             .0003:
   8226 00E91A 20 A4 E8                     	JSR		AsciiToScreen
   8227 00E91D 05 36                        	ORA		NormAttr
   8228 00E91F 48                           	PHA
   8229 00E920 A5 34                        	LDA		VideoPos
   8230 00E922 0A                           	ASL
   8231 00E923 A8                           	TAY
   8232 00E924 68                           	PLA
   8233 00E925 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8234 00E92A A5 30                        	LDA		CursorX
   8235 00E92C 1A                           	INA
   8236 00E92D C5 4C                        	CMP		Textcols
   8237 00E92F D0 15                        	BNE		.0001
   8238 00E931 64 30                        	STZ		CursorX
   8239 00E933 A5 32                        	LDA		CursorY
   8240 00E935 1A                           	INA
   8241 00E936 C5 4E                        	CMP		Textrows
   8242 00E938 F0 05                        	BEQ		.0002
   8243 00E93A 85 32                        	STA		CursorY
   8244 00E93C 82 59 01                     	BRL		SyncVideoPos
   8245 00E93F                             .0002:
   8246 00E93F 3A                           	DEA
   8247 00E940 20 98 EA                     	JSR		SyncVideoPos
   8248 00E943 82 14 02                     	BRL		ScrollUp
   8249 00E946                             .0001:
   8250 00E946 85 30                        	STA		CursorX
   8251 00E948 82 4D 01                     	BRL		SyncVideoPos
   8252 00E94B                             doCR:
   8253 00E94B 64 30                        	STZ		CursorX
   8254 00E94D 82 48 01                     	BRL		SyncVideoPos
   8255 00E950                             doLF:
   8256 00E950 A5 32                        	LDA		CursorY
   8257 00E952 1A                           	INA
   8258 00E953 C5 4E                        	CMP		Textrows
   8259 00E955 10 FF 01 02                  	LBPL	ScrollUp
   8260 00E959 85 32                        	STA		CursorY
   8261 00E95B 82 3A 01                     	BRL		SyncVideoPos
                                           
                                           ; Process escape sequences for WYSE terminal emulation
                                           ; Handles:
                                           ; {esc}T		- clear to end of line
                                           ; {esc}W		- delete character
                                           ; {esc}`1		- cursor on
                                           ; {esc}`0		- cursor off
                                           ; {esc}({esc}G4	- reverse video
                                           ; {esc}({esc}G0	- normal video
                                           ;
                                           ; EscState
                                           ; -1 = first esc char
                                           ; -2 = second esc char
                                           ; ...
                                           ;
   8277 00E95E                             processEsc:
   8278 00E95E A6 3C                        	LDX		EscState
   8279 00E960 E0 FF FF                     	CPX		#-1
   8280 00E963 D0 45                        	BNE		.0006
   8281 00E965 C9 54 00                     	CMP		#'T'	; clear to EOL
   8282 00E968 D0 1D                        	BNE		.0003
   8283 00E96A A5 34                        	LDA		VideoPos
   8284 00E96C 0A                           	ASL
   8285 00E96D A8                           	TAY
   8286 00E96E A6 30                        	LDX		CursorX
   8287 00E970 E8                           	INX
   8288 00E971                             .0001:
   8289 00E971 E4 4C                        	CPX		Textcols
   8290 00E973 10 0F                        	BPL		.0002
   8291 00E975 A9 20 00                     	LDA		#' '
   8292 00E978 05 36                        	ORA		NormAttr
   8293 00E97A 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8294 00E97F E8                           	INX
   8295 00E980 C8                           	INY
   8296 00E981 C8                           	INY
   8297 00E982 D0 ED                        	BNE		.0001
   8298 00E984                             .0002:
   8299 00E984 64 3C                        	STZ		EscState
   8300 00E986 60                           	RTS
   8301 00E987                             .0003:
   8302 00E987 C9 57 00                     	CMP		#'W'
   8303 00E98A D0 05                        	BNE		.0004
   8304 00E98C 64 3C                        	STZ		EscState
   8305 00E98E 82 A9 00                     	BRL		doDelete
   8306 00E991                             .0004:
   8307 00E991 C9 60 00                     	CMP		#'`'
   8308 00E994 D0 06                        	BNE		.0005
   8309 00E996 A9 FE FF                     	LDA		#-2
   8310 00E999 85 3C                        	STA		EscState
   8311 00E99B 60                           	RTS
   8312 00E99C                             .0005:
   8313 00E99C C9 28 00                     	CMP		#'('
   8314 00E99F D0 06                        	BNE		.0008
   8315 00E9A1 A9 FD FF                     	LDA		#-3
   8316 00E9A4 85 3C                        	STA		EscState
   8317 00E9A6 60                           	RTS
   8318 00E9A7                             .0008:
   8319 00E9A7 64 3C                        	STZ		EscState
   8320 00E9A9 60                           	RTS
   8321 00E9AA                             .0006:
   8322 00E9AA E0 FE FF                     	CPX		#-2
   8323 00E9AD D0 11                        	BNE		.0007
   8324 00E9AF 64 3C                        	STZ		EscState
   8325 00E9B1 C9 31 00                     	CMP		#'1'
   8326 00E9B4 F0 FF 69 01                  	LBEQ	CursorOn
   8327 00E9B8 C9 30 00                     	CMP		#'0'
   8328 00E9BB F0 FF 72 01                  	LBEQ	CursorOff
   8329 00E9BF 60                           	RTS
   8330 00E9C0                             .0007:
   8331 00E9C0 E0 FD FF                     	CPX		#-3
   8332 00E9C3 D0 0B                        	BNE		.0009
   8333 00E9C5 C9 1B 00                     	CMP		#ESC
   8334 00E9C8 D0 DD                        	BNE		.0008
   8335 00E9CA A9 FC FF                     	LDA		#-4
   8336 00E9CD 85 3C                        	STA		EscState
   8337 00E9CF 60                           	RTS
   8338 00E9D0                             .0009:
   8339 00E9D0 E0 FC FF                     	CPX		#-4
   8340 00E9D3 D0 0B                        	BNE		.0010
   8341 00E9D5 C9 47 00                     	CMP		#'G'
   8342 00E9D8 D0 CD                        	BNE		.0008
   8343 00E9DA A9 FB FF                     	LDA		#-5
   8344 00E9DD 85 3C                        	STA		EscState
   8345 00E9DF 60                           	RTS
   8346 00E9E0                             .0010:
   8347 00E9E0 E0 FB FF                     	CPX		#-5
   8348 00E9E3 D0 C2                        	BNE		.0008
   8349 00E9E5 64 3C                        	STZ		EscState
   8350 00E9E7 C9 34 00                     	CMP		#'4'
   8351 00E9EA D0 12                        	BNE		.0011
   8352 00E9EC A5 36                        	LDA		NormAttr
                                           	; Swap the high nybbles of the attribute
   8354 00E9EE EB                           	XBA				
   8355 00E9EF E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
   8358 00E9F1 2A                           	ROL
   8359 00E9F2 2A                           	ROL
   8360 00E9F3 2A                           	ROL
   8361 00E9F4 2A                           	ROL
   8362 00E9F5 C2 30                        	REP		#$30		; set 16 bit regs
                                           	NDX		16			; tell the assembler
                                           	MEM		16
   8365 00E9F7 EB                           	XBA
   8366 00E9F8 29 00 FF                     	AND		#$FF00
   8367 00E9FB 85 36                        	STA		NormAttr
   8368 00E9FD 60                           	RTS
   8369 00E9FE                             .0011:
   8370 00E9FE C9 30 00                     	CMP		#'0'
   8371 00EA01 D0 06                        	BNE		.0012
   8372 00EA03 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8373 00EA06 85 36                        	STA		NormAttr
   8374 00EA08 60                           	RTS
   8375 00EA09                             .0012:
   8376 00EA09 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8377 00EA0C 85 36                        	STA		NormAttr
   8378 00EA0E 60                           	RTS
                                           
   8380 00EA0F                             doBackSpace:
   8381 00EA0F A6 30                        	LDX		CursorX
   8382 00EA11 F0 26                        	BEQ		.0001		; Can't backspace anymore
   8383 00EA13 A5 34                        	LDA		VideoPos
   8384 00EA15 0A                           	ASL
   8385 00EA16 A8                           	TAY
   8386 00EA17                             .0002:
   8387 00EA17 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8388 00EA1C 88                           	DEY
   8389 00EA1D 88                           	DEY
   8390 00EA1E 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8391 00EA23 42 C8                        	INY4
   8392 00EA25 E8                           	INX
   8393 00EA26 E4 4C                        	CPX		Textcols
   8394 00EA28 D0 ED                        	BNE		.0002
   8395 00EA2A                             .0003:
   8396 00EA2A A9 20 00                     	LDA		#' '
   8397 00EA2D 05 36                        	ORA		NormAttr
   8398 00EA2F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8399 00EA34 C6 30                        	DEC		CursorX
   8400 00EA36 82 5F 00                     	BRL		SyncVideoPos
   8401 00EA39                             .0001:
   8402 00EA39 60                           	RTS
                                           
                                           ; Deleting a character does not change the video position so there's no need
                                           ; to resynchronize it.
                                           
   8407 00EA3A                             doDelete:
   8408 00EA3A A6 30                        	LDX		CursorX
   8409 00EA3C A5 34                        	LDA		VideoPos
   8410 00EA3E 0A                           	ASL
   8411 00EA3F A8                           	TAY
   8412 00EA40                             .0002:
   8413 00EA40 E8                           	INX
   8414 00EA41 E4 4C                        	CPX		Textcols
   8415 00EA43 10 14                        	BPL		.0001
   8416 00EA45 CA                           	DEX
   8417 00EA46 C8                           	INY
   8418 00EA47 C8                           	INY
   8419 00EA48 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8420 00EA4D 88                           	DEY
   8421 00EA4E 88                           	DEY
   8422 00EA4F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8423 00EA54 C8                           	INY
   8424 00EA55 C8                           	INY
   8425 00EA56 E8                           	INX
   8426 00EA57 80 E7                        	BRA		.0002
   8427 00EA59                             .0001:
   8428 00EA59 A9 20 00                     	LDA		#' '
   8429 00EA5C 05 36                        	ORA		NormAttr
   8430 00EA5E 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8431 00EA63 60                           	RTS
                                           
   8433 00EA64                             doCursorHome:
   8434 00EA64 A5 30                        	LDA		CursorX
   8435 00EA66 F0 24                        	BEQ		doCursor1
   8436 00EA68 64 30                        	STZ		CursorX
   8437 00EA6A 80 2C                        	BRA		SyncVideoPos
   8438 00EA6C                             doCursorRight:
   8439 00EA6C A5 30                        	LDA		CursorX
   8440 00EA6E 1A                           	INA
   8441 00EA6F C5 4C                        	CMP		Textcols
   8442 00EA71 10 1D                        	BPL		doRTS
   8443 00EA73                             doCursor2:
   8444 00EA73 85 30                        	STA		CursorX
   8445 00EA75 80 21                        	BRA		SyncVideoPos
   8446 00EA77                             doCursorLeft:
   8447 00EA77 A5 30                        	LDA		CursorX
   8448 00EA79 F0 15                        	BEQ		doRTS
   8449 00EA7B 3A                           	DEA
   8450 00EA7C 80 F5                        	BRA		doCursor2
   8451 00EA7E                             doCursorUp:
   8452 00EA7E A5 32                        	LDA		CursorY
   8453 00EA80 F0 0E                        	BEQ		doRTS
   8454 00EA82 3A                           	DEA
   8455 00EA83 80 07                        	BRA		doCursor1
   8456 00EA85                             doCursorDown:
   8457 00EA85 A5 32                        	LDA		CursorY
   8458 00EA87 1A                           	INA
   8459 00EA88 C5 4E                        	CMP		Textrows
   8460 00EA8A 10 04                        	BPL		doRTS
   8461 00EA8C                             doCursor1:
   8462 00EA8C 85 32                        	STA		CursorY
   8463 00EA8E 80 08                        	BRA		SyncVideoPos
   8464 00EA90                             doRTS:
   8465 00EA90 60                           	RTS
                                           
   8467 00EA91                             HomeCursor:
   8468 00EA91 A9 00 00                     	LDA		#0
   8469 00EA94 64 30                        	STZ		CursorX
   8470 00EA96 64 32                        	STZ		CursorY
                                           
                                           ; Synchronize the absolute video position with the cursor co-ordinates.
                                           ;
   8474 00EA98                             SyncVideoPos:
   8475 00EA98 48                           	PHA
   8476 00EA99 5A                           	PHY
   8477 00EA9A A5 32                        	LDA		CursorY
   8478 00EA9C 0A                           	ASL
   8479 00EA9D AA                           	TAX
   8480 00EA9E 42 3B 05 00 BD F2 F5         	LDA		5:LineTbl,X
   8481 00EAA5 18                           	CLC
   8482 00EAA6 65 30                        	ADC		CursorX
   8483 00EAA8 85 34                        	STA		VideoPos
   8484 00EAAA A0 0D 00                     	LDY		#13
   8485 00EAAD 42 DA 42 97 46               	STA		FAR {Vidregs},Y		; Update the position in the text controller
   8486 00EAB2 7A                           	PLY
   8487 00EAB3 68                           	PLA
   8488 00EAB4 60                           	RTS
                                           
   8490 00EAB5                             OutCRLF:
   8491 00EAB5 A9 0D 00                     	LDA		#CR
   8492 00EAB8 20 BE EA                     	JSR		OutChar
   8493 00EABB A9 0A 00                     	LDA		#LF
                                           
   8495 00EABE                             OutChar:
   8496 00EABE DA                           	PHX
   8497 00EABF 5A                           	PHY
   8498 00EAC0 08                           	PHP
   8499 00EAC1 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8502 00EAC3 A2 00 00                     	LDX		#0
   8503 00EAC6 FC F0 03                     	JSR		(OutputVec,x)
   8504 00EAC9 28                           	PLP
   8505 00EACA 7A                           	PLY
   8506 00EACB FA                           	PLX
   8507 00EACC 60                           	RTS
                                           
   8509 00EACD                             DisplayString:
                                           ;	PLA							; pop return address
                                           ;	PLX							; get string address parameter
                                           ;	PHA							; push return address
   8513 00EACD 08                           	PHP							; push reg settings
   8514 00EACE E2 20                        	SEP		#$20				; ACC = 8 bit
                                           	MEM		8
                                           ;	STX		StringPos
   8517 00EAD0 A0 00 00                     	LDY		#0
   8518 00EAD3                             .0002:
   8519 00EAD3 42 DA B3 04                  	LDA		FAR (4,S),Y
   8520 00EAD7 F0 06                        	BEQ		.0001
   8521 00EAD9 20 BE EA                     	JSR		OutChar
   8522 00EADC C8                           	INY
   8523 00EADD 80 F4                        	BRA		.0002
   8524 00EADF                             .0001:
   8525 00EADF 28                           	PLP							; restore regs settings
                                           ;	REP		#$20				; ACC 16 bits
                                           	MEM		16
   8528 00EAE0 42 C0 04                     	RTS		#4					; pop stack argument
                                           
   8530 00EAE3                             DisplayString2:
   8531 00EAE3 68                           	PLA							; pop return address
   8532 00EAE4 FA                           	PLX							; get string address parameter
   8533 00EAE5 48                           	PHA							; push return address
   8534 00EAE6 E2 20                        	SEP		#$20				; ACC = 8 bit
   8535 00EAE8 86 38                        	STX		StringPos
   8536 00EAEA A0 00 00                     	LDY		#0
   8537 00EAED A2 32 00                     	LDX		#50
   8538 00EAF0                             .0002:
   8539 00EAF0 B1 38                        	LDA		(StringPos),Y
   8540 00EAF2 20 BE EA                     	JSR		OutChar
   8541 00EAF5 C8                           	INY
   8542 00EAF6 CA                           	DEX
   8543 00EAF7 D0 F7                        	BNE		.0002
   8544 00EAF9                             .0001:
   8545 00EAF9 C2 20                        	REP		#$20				; ACC 16 bits
   8546 00EAFB 60                           	RTS
                                           
   8548 00EAFC                             GetTextRowsCols:
   8549 00EAFC 48                           	PHA
   8550 00EAFD 5A                           	PHY
   8551 00EAFE A0 00 00                     	LDY		#0
   8552 00EB01 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8553 00EB08 85 4C                        	STA		Textcols
   8554 00EB0A C8                           	INY
   8555 00EB0B 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8556 00EB12 85 4E                        	STA		Textrows
   8557 00EB14 7A                           	PLY
   8558 00EB15 68                           	PLA
   8559 00EB16 60                           	RTS
                                           
                                           ; .Y = register number to set
                                           ; Acc = value
                                           ;
   8564 00EB17                             SetVideoReg:
   8565 00EB17 08                           	PHP								; save regs size settings
   8566 00EB18 E2 20                        	SEP		#$20
   8567 00EB1A 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8568 00EB1F 28                           	PLP								; restore reg size settings
   8569 00EB20 60                           	RTS
                                           
   8571 00EB21                             CursorOn:
   8572 00EB21 48                           	PHA
   8573 00EB22 5A                           	PHY
   8574 00EB23 A0 09 00                     	LDY		#9
   8575 00EB26 A9 60 1F                     	LDA		#$1F60
   8576 00EB29 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8577 00EB2E 7A                           	PLY
   8578 00EB2F 68                           	PLA
   8579 00EB30 60                           	RTS
                                           
   8581 00EB31                             CursorOff:
   8582 00EB31 48                           	PHA
   8583 00EB32 5A                           	PHY
   8584 00EB33 A0 09 00                     	LDY		#9
   8585 00EB36 A9 20 00                     	LDA		#$0020
   8586 00EB39 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8587 00EB3E 7A                           	PLY
   8588 00EB3F 68                           	PLA
   8589 00EB40 60                           	RTS
                                           
   8591 00EB41                             ClearScreen:
   8592 00EB41 A2 FF 0F                     	LDX		#4095
   8593 00EB44 A0 00 00                     	LDY		#$00
   8594 00EB47 A9 20 00                     	LDA		#' '
   8595 00EB4A 20 A4 E8                     	JSR		AsciiToScreen
   8596 00EB4D 05 36                        	ORA		NormAttr
   8597 00EB4F                             .0001:
   8598 00EB4F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8599 00EB54 C8                           	INY
   8600 00EB55 C8                           	INY
   8601 00EB56 CA                           	DEX
   8602 00EB57 D0 F6                        	BNE		.0001
   8603 00EB59 60                           	RTS
                                           
   8605 00EB5A                             ScrollUp:
   8606 00EB5A A0 00 00                     	LDY		#0				; .Y used as index to char
   8607 00EB5D A2 2B 0A                     	LDX 	#2603			; number of chars on screen
   8608 00EB60                             .0001:
   8609 00EB60 5A                           	PHY						; save off current .Y
   8610 00EB61 98                           	TYA								
   8611 00EB62 18                           	CLC						; Add double the number of text
   8612 00EB63 65 4C                        	ADC		Textcols		; columns to .Y to find start of next
   8613 00EB65 18                           	CLC						; row 
   8614 00EB66 65 4C                        	ADC		Textcols
   8615 00EB68 A8                           	TAY						
   8616 00EB69 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y	; .A = Load buffer[textcols+Y]
   8617 00EB6E 7A                           	PLY						; .Y = restore current .Y
   8618 00EB6F 42 DA 42 97 40               	STA		FAR {Vidptr},Y	; Store .A in buffer[0+Y]
   8619 00EB74 C8                           	INY						; advance to next character
   8620 00EB75 C8                           	INY						; decrement total char count
   8621 00EB76 CA                           	DEX
   8622 00EB77 D0 E7                        	BNE		.0001
   8623 00EB79 A5 4E                        	LDA		Textrows
   8624 00EB7B 3A                           	DEA
                                           
   8626 00EB7C                             BlankLine:
   8627 00EB7C 0A                           	ASL
   8628 00EB7D A8                           	TAY
   8629 00EB7E 42 1B B9 F2 F5               	LDA		CS:LineTbl,Y
   8630 00EB83 0A                           	ASL
   8631 00EB84 A8                           	TAY
   8632 00EB85 A6 4C                        	LDX		Textcols		; number of chars to clear
   8633 00EB87 A5 36                        	LDA		NormAttr
   8634 00EB89 09 20 00                     	ORA		#$20			; space
   8635 00EB8C                             .0001:
   8636 00EB8C 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8637 00EB91 C8                           	INY						; increment to next char
   8638 00EB92 C8                           	INY
   8639 00EB93 CA                           	DEX						; decrement number of chars
   8640 00EB94 D0 F6                        	BNE		.0001
   8641 00EB96 60                           	RTS
                                           
   8643 00EB97                             DispDWord:
   8644 00EB97 42 EB                        	XBAW
   8645 00EB99 20 9E EB                     	JSR		DispWord
   8646 00EB9C 42 EB                        	XBAW
   8647 00EB9E                             DispWord:
   8648 00EB9E EB                           	XBA
   8649 00EB9F 20 A3 EB                     	JSR		DispByte
   8650 00EBA2 EB                           	XBA
   8651 00EBA3                             DispByte:
   8652 00EBA3 48                           	PHA
   8653 00EBA4 4A                           	LSR
   8654 00EBA5 4A                           	LSR
   8655 00EBA6 4A                           	LSR
   8656 00EBA7 4A                           	LSR
   8657 00EBA8 20 AC EB                     	JSR		DispNybble
   8658 00EBAB 68                           	PLA
   8659 00EBAC                             DispNybble:
   8660 00EBAC 48                           	PHA
   8661 00EBAD 29 0F 00                     	AND		#$0F
   8662 00EBB0 C9 0A 00                     	CMP		#10
   8663 00EBB3 90 08                        	BCC		.0001
   8664 00EBB5 69 36 00                     	ADC		#'A'-11			; -11 cause the carry is set
   8665 00EBB8 20 BE EA                     	JSR		OutChar
   8666 00EBBB 68                           	PLA
   8667 00EBBC 60                           	RTS
   8668 00EBBD                             .0001:
   8669 00EBBD 09 30 00                     	ORA		#'0'
   8670 00EBC0 20 BE EA                     	JSR		OutChar
   8671 00EBC3 68                           	PLA
   8672 00EBC4 60                           	RTS
                                           
   8674 00EBC5                             space:
   8675 00EBC5 48                           	PHA
   8676 00EBC6 A9 20 00                     	LDA		#' '
   8677 00EBC9 20 BE EA                     	JSR		OutChar
   8678 00EBCC 68                           	PLA
   8679 00EBCD 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get a range (two hex numbers)
                                           ;------------------------------------------------------------------------------
                                           
   8685 00EBCE                             GetRange:
   8686 00EBCE 20 E8 E6                     	JSR		IgnoreBlanks
   8687 00EBD1 20 F9 EB                     	JSR		GetHexNumber
   8688 00EBD4 C0 00 00                     	CPY		#0
   8689 00EBD7 F0 1F                        	BEQ		.0001
   8690 00EBD9 A5 0C                        	LDA		NumWorkArea
   8691 00EBDB 85 20                        	STA		RangeStart
   8692 00EBDD 85 24                        	STA		RangeEnd
   8693 00EBDF A5 0E                        	LDA		NumWorkArea+2
   8694 00EBE1 85 22                        	STA		RangeStart+2
   8695 00EBE3 85 26                        	STA		RangeEnd+2
   8696 00EBE5 20 E8 E6                     	JSR		IgnoreBlanks
   8697 00EBE8 20 F9 EB                     	JSR		GetHexNumber
   8698 00EBEB C0 00 00                     	CPY		#0
   8699 00EBEE F0 08                        	BEQ		.0001
   8700 00EBF0 A5 0C                        	LDA		NumWorkArea
   8701 00EBF2 85 24                        	STA		RangeEnd
   8702 00EBF4 A5 0E                        	LDA		NumWorkArea+2
   8703 00EBF6 85 26                        	STA		RangeEnd+2
   8704 00EBF8                             .0001:
   8705 00EBF8 60                           	RTS
                                           	
                                           ; Get a hexidecimal number. Maximum of six digits.
                                           ; .X = text pointer (updated)
                                           ;------------------------------------------------------------------------------
                                           ;
   8711 00EBF9                             GetHexNumber:
   8712 00EBF9 A0 00 00                     	LDY		#0					; maximum of eight digits
   8713 00EBFC 64 0C                        	STZ		NumWorkArea
   8714 00EBFE 64 0E                        	STZ		NumWorkArea+2
   8715 00EC00                             gthxn2:
   8716 00EC00 20 36 E2                     	JSR		MonGetch
   8717 00EC03 20 26 EC                     	JSR		AsciiToHexNybble
   8718 00EC06 30 1B                        	BMI		gthxn1
   8719 00EC08 06 0C                        	ASL		NumWorkArea
   8720 00EC0A 26 0E                        	ROL		NumWorkArea+2
   8721 00EC0C 06 0C                        	ASL		NumWorkArea
   8722 00EC0E 26 0E                        	ROL		NumWorkArea+2
   8723 00EC10 06 0C                        	ASL		NumWorkArea
   8724 00EC12 26 0E                        	ROL		NumWorkArea+2
   8725 00EC14 06 0C                        	ASL		NumWorkArea
   8726 00EC16 26 0E                        	ROL		NumWorkArea+2
   8727 00EC18 05 0C                        	ORA		NumWorkArea
   8728 00EC1A 85 0C                        	STA		NumWorkArea
   8729 00EC1C C8                           	INY
   8730 00EC1D C0 08 00                     	CPY		#8
   8731 00EC20 D0 DE                        	BNE		gthxn2
   8732 00EC22 60                           	RTS
   8733 00EC23                             gthxn1:
   8734 00EC23 CA                           	DEX
   8735 00EC24 CA                           	DEX
   8736 00EC25 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert ASCII character in the range '0' to '9', 'a' to 'f' or 'A' to 'F'
                                           ; to a hex nybble.
                                           ;------------------------------------------------------------------------------
                                           ;
   8743 00EC26                             AsciiToHexNybble:
   8744 00EC26 C9 30 00                     	CMP		#'0'
   8745 00EC29 90 30                        	BCC		gthx3
   8746 00EC2B C9 3A 00                     	CMP		#'9'+1
   8747 00EC2E B0 05                        	BCS		gthx5
   8748 00EC30 38                           	SEC
   8749 00EC31 E9 30 00                     	SBC		#'0'
   8750 00EC34 60                           	RTS
   8751 00EC35                             gthx5:
   8752 00EC35 C9 41 00                     	CMP		#'A'
   8753 00EC38 90 21                        	BCC		gthx3
   8754 00EC3A C9 47 00                     	CMP		#'F'+1
   8755 00EC3D B0 09                        	BCS		gthx6
   8756 00EC3F 38                           	SEC
   8757 00EC40 E9 41 00                     	SBC		#'A'
   8758 00EC43 18                           	CLC
   8759 00EC44 69 0A 00                     	ADC		#10
   8760 00EC47 60                           	RTS
   8761 00EC48                             gthx6:
   8762 00EC48 C9 61 00                     	CMP		#'a'
   8763 00EC4B 90 0E                        	BCC		gthx3
   8764 00EC4D C9 7B 00                     	CMP		#'z'+1
   8765 00EC50 B0 09                        	BCS		gthx3
   8766 00EC52 38                           	SEC
   8767 00EC53 E9 61 00                     	SBC		#'a'
   8768 00EC56 18                           	CLC
   8769 00EC57 69 0A 00                     	ADC		#10
   8770 00EC5A 60                           	RTS
   8771 00EC5B                             gthx3:
   8772 00EC5B A9 FF FF                     	LDA		#-1		; not a hex number
   8773 00EC5E 60                           	RTS
                                           
   8775 00EC5F                             AsciiToDecNybble:
   8776 00EC5F C9 30 00                     	CMP		#'0'
   8777 00EC62 90 0A                        	BCC		gtdc3
   8778 00EC64 C9 3A 00                     	CMP		#'9'+1
   8779 00EC67 B0 05                        	BCS		gtdc3
   8780 00EC69 38                           	SEC
   8781 00EC6A E9 30 00                     	SBC		#'0'
   8782 00EC6D 60                           	RTS
   8783 00EC6E                             gtdc3:
   8784 00EC6E A9 FF FF                     	LDA		#-1
   8785 00EC71 60                           	RTS
                                           
   8787 00EC72                             getcharNoWait:
   8788 00EC72 A9 01 00                     	LDA		#1
   8789 00EC75 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8790 00EC79 42 A2 06 00                  	TSK		#6
   8791 00EC7D 42 5B A5 BA                  	LDA		ZS:keybd_char
   8792 00EC81 10 02                        	BPL		.0001
   8793 00EC83 38                           	SEC
   8794 00EC84 60                           	RTS
   8795 00EC85                             .0001:
   8796 00EC85 18                           	CLC
   8797 00EC86 60                           	RTS
                                           
   8799 00EC87                             getcharWait:
   8800 00EC87 A9 02 00                     	LDA		#2
   8801 00EC8A 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8802 00EC8E 42 A2 06 00                  	TSK		#6
   8803 00EC92 42 5B A5 BA                  	LDA		ZS:keybd_char
   8804 00EC96 10 02                        	BPL		.0001
   8805 00EC98 38                           	SEC
   8806 00EC99 60                           	RTS
   8807 00EC9A                             .0001:
   8808 00EC9A 18                           	CLC
   8809 00EC9B 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; Keyboard processing routines follow.
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   8816 00EC9C                             ResetKbd:
   8817 00EC9C E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8820 00EC9E 64 08                        	STZ		KeyState1
   8821 00ECA0 64 09                        	STZ		KeyState2
   8822 00ECA2 A9 FF                        	LDA		#$FF
   8823 00ECA4 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8824 00ECAC 20 BF ED                     	JSR		KeybdWaitTx
   8825 00ECAF C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8828 00ECB1 60                           	RTS
   8829 00ECB2                             KeybdInit:
   8830 00ECB2 A9 00 20                     	LDA		#$2000
   8831 00ECB5 1B                           	TAS
   8832 00ECB6 A9 05 00                     	LDA		#5
   8833 00ECB9 85 BC                        	STA		keybd_cmd
   8834 00ECBB E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8837 00ECBD 64 08                        	STZ		KeyState1
   8838 00ECBF 64 09                        	STZ		KeyState2
   8839 00ECC1 A0 0C                        	LDY		#12
   8840 00ECC3 42 60                        	RTT
   8841 00ECC5                             .resetAgain:
   8842 00ECC5 A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8843 00ECC7 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8844 00ECCF 20 BF ED                     	JSR		KeybdWaitTx
   8845 00ECD2                             .0001:
   8846 00ECD2 20 9A ED                     	JSR		KeybdRecvByte	; Look for $AA
   8847 00ECD5 90 5A                        	BCC		.tryAgain
   8848 00ECD7 C9 AA                        	CMP		#$AA			;
   8849 00ECD9 F0 37                        	BEQ		.config
   8850 00ECDB                             .0002:
                                           	; wait until keyboard not busy
   8852 00ECDB 20 DD ED                     	JSR		Wait10ms
   8853 00ECDE 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		;
                                         
   8854 00ECE6 89 40                        	BIT		#$40
   8855 00ECE8 D0 47                        	BNE		.tryAgain
   8856 00ECEA A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8857 00ECEC 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8858 00ECF4 20 DD ED                     	JSR		Wait10ms
   8859 00ECF7 20 BF ED                     	JSR		KeybdWaitTx		; wait until no longer busy
   8860 00ECFA 20 9A ED                     	JSR		KeybdRecvByte	; look for an ACK ($FA)
   8861 00ECFD 90 32                        	BCC		.tryAgain
   8862 00ECFF C9 FE                        	CMP		#$FE
   8863 00ED01 F0 2E                        	BEQ		.tryAgain
   8864 00ED03 C9 FA                        	CMP		#$FA
   8865 00ED05 D0 2A                        	BNE		.tryAgain
   8866 00ED07 20 9A ED                     	JSR		KeybdRecvByte
   8867 00ED0A C9 FC                        	CMP		#$FC			; reset error ?
   8868 00ED0C F0 23                        	BEQ		.tryAgain
   8869 00ED0E C9 AA                        	CMP		#$AA			; reset complete okay ?
   8870 00ED10 D0 1F                        	BNE		.tryAgain
   8871 00ED12                             .config:
   8872 00ED12 20 BF ED                     	JSR		KeybdWaitBusy
   8873 00ED15 A9 F0                        	LDA		#$F0			; send scan code select
   8874 00ED17 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8875 00ED1F 20 BF ED                     	JSR		KeybdWaitTx
   8876 00ED22 90 0D                        	BCC		.tryAgain
   8877 00ED24 20 9A ED                     	JSR		KeybdRecvByte	; wait for response from keyboard
   8878 00ED27 90 08                        	BCC		.tryAgain
   8879 00ED29 C9 FE                        	CMP		#$FE
   8880 00ED2B F0 04                        	BEQ		.tryAgain
   8881 00ED2D C9 FA                        	CMP		#$FA
   8882 00ED2F F0 16                        	BEQ		.0004
   8883 00ED31                             .tryAgain:
   8884 00ED31 88                           	DEY
   8885 00ED32 D0 9E                        	BNE		.0001
   8886 00ED34 C6 BC                        	DEC		keybd_cmd
   8887 00ED36 D0 8D                        	BNE		.resetAgain
   8888 00ED38                             .keybdErr:
   8889 00ED38 C2 30                        	REP		#$30
   8890 00ED3A F4 01 00                     	PEA		1
   8891 00ED3D F4 F5 ED                     	PEA		msgKeybdNR
   8892 00ED40 20 CD EA                     	JSR		DisplayString
   8893 00ED43 42 60                        	RTT
   8894 00ED45 80 1A                        	BRA		KeybdService
   8895 00ED47                             .0004:
   8896 00ED47 A9 02                        	LDA		#2				; select scan code set #2
   8897 00ED49 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8898 00ED51 20 BF ED                     	JSR		KeybdWaitTx
   8899 00ED54 90 DB                        	BCC		.tryAgain
   8900 00ED56 20 9A ED                     	JSR		KeybdRecvByte
   8901 00ED59 90 D6                        	BCC		.tryAgain
   8902 00ED5B C2 30                        	REP		#$30
   8903 00ED5D 42 60                        	RTT
   8904 00ED5F 80 00                        	BRA		KeybdService
                                           
   8906 00ED61                             KeybdService:
   8907 00ED61 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8910 00ED63 A9 00 20                     	LDA		#$2000
   8911 00ED66 1B                           	TAS
   8912 00ED67 A5 BC                        	LDA		keybd_cmd
   8913 00ED69 C9 01 00                     	CMP		#1
   8914 00ED6C D0 18                        	BNE		.0001
   8915 00ED6E 20 18 EE                     	JSR		KeybdGetCharNoWait
   8916 00ED71 B0 08                        	BCS		.nokey
   8917 00ED73 64 BC                        	STZ		keybd_cmd
   8918 00ED75 85 BA                        	STA		keybd_char
   8919 00ED77 42 60                        	RTT
   8920 00ED79 80 E6                        	BRA		KeybdService
   8921 00ED7B                             .nokey
   8922 00ED7B A9 FF FF                     	LDA		#-1
   8923 00ED7E 64 BC                        	STZ		keybd_cmd
   8924 00ED80 85 BA                        	STA		keybd_char
   8925 00ED82 42 60                        	RTT
   8926 00ED84 80 DB                        	BRA		KeybdService
   8927 00ED86                             .0001:
   8928 00ED86 C9 02 00                     	CMP		#2
   8929 00ED89 D0 0B                        	BNE		.0002
   8930 00ED8B 20 23 EE                     	JSR		KeybdGetCharWait
   8931 00ED8E 64 BC                        	STZ		keybd_cmd
   8932 00ED90 85 BA                        	STA		keybd_char
   8933 00ED92 42 60                        	RTT
   8934 00ED94 80 CB                        	BRA		KeybdService
   8935 00ED96                             .0002:
   8936 00ED96 42 60                        	RTT
   8937 00ED98 80 C7                        	BRA		KeybdService
                                           
                                           	MEM		8
                                           	NDX		8
                                           
                                           ; Receive a byte from the keyboard, used after a command is sent to the
                                           ; keyboard in order to wait for a response.
                                           ;
   8945 00ED9A                             KeybdRecvByte:
   8946 00ED9A 5A                           	PHY
   8947 00ED9B A0 14                        	LDY		#20				; wait up to .2s
   8948 00ED9D                             .0003:
   8949 00ED9D 20 BF ED                     	JSR		KeybdWaitBusy
   8950 00EDA0 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1	; wait for response from keyboard
                                         
   8951 00EDA8 0A                           	ASL						; is input buffer full ?
   8952 00EDA9 B0 09                        	BCS		.0004			; yes, branch
   8953 00EDAB 20 DD ED                     	JSR		Wait10ms		; wait a bit
   8954 00EDAE 88                           	DEY
   8955 00EDAF D0 EC                        	BNE		.0003			; go back and try again
   8956 00EDB1 7A                           	PLY						; timeout
   8957 00EDB2 18                           	CLC						; carry clear = no code
   8958 00EDB3 60                           	RTS
   8959 00EDB4                             .0004:
   8960 00EDB4 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD		; clear recieve state
                                         
   8961 00EDBC 7A                           	PLY
   8962 00EDBD 38                           	SEC						; carry set = code available
   8963 00EDBE 60                           	RTS
                                           
                                           ; Wait until the keyboard isn't busy anymore
                                           ; Wait until the keyboard transmit is complete
                                           ; Returns .CF = 1 if successful, .CF=0 timeout
                                           ;
   8969 00EDBF                             KeybdWaitBusy:				; alias for KeybdWaitTx
   8970 00EDBF                             KeybdWaitTx:
   8971 00EDBF 48                           	PHA
   8972 00EDC0 5A                           	PHY
   8973 00EDC1 A0 0A                        	LDY		#10				; wait a max of .1s
   8974 00EDC3                             .0001:
   8975 00EDC3 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1
                                         
   8976 00EDCB 89 40                        	BIT		#$40			; check for transmit busy bit
   8977 00EDCD F0 0A                        	BEQ		.0002			; branch if bit clear
   8978 00EDCF 20 DD ED                     	JSR		Wait10ms		; delay a little bit
   8979 00EDD2 88                           	DEY						; go back and try again
   8980 00EDD3 D0 EE                        	BNE		.0001
   8981 00EDD5 7A                           	PLY						; timed out
   8982 00EDD6 68                           	PLA
   8983 00EDD7 18                           	CLC						; return carry clear
   8984 00EDD8 60                           	RTS
   8985 00EDD9                             .0002:
   8986 00EDD9 7A                           	PLY						; wait complete, return 
   8987 00EDDA 68                           	PLA
   8988 00EDDB 38                           	SEC						; carry set
   8989 00EDDC 60                           	RTS
                                           
                                           ; Wait approximately 10ms. Used by keyboard routines. Makes use of the free
                                           ; running counter #0.
                                           ; .A = trashed (=-5)
                                           ;
   8995 00EDDD                             Wait10ms:
   8996 00EDDD 48                           	PHA
   8997 00EDDE DA                           	PHX				; save .X
   8998 00EDDF 42 5B A5 12                  	LDA		ZS:CNT0H	; get starting count
   8999 00EDE3 AA                           	TAX				; save it off in .X
   9000 00EDE4                             .0002:
   9001 00EDE4 38                           	SEC				; compare to current counter value
   9002 00EDE5 42 5B E5 12                  	SBC		ZS:CNT0H
   9003 00EDE9 49 FF                        	EOR		#$FF	; make negative
   9004 00EDEB C9 0A                        	CMP		#10
   9005 00EDED 10 03                        	BPL     .0001
   9006 00EDEF 8A                           	TXA				; prepare for next check, get startcount in .A
   9007 00EDF0 80 F2                        	BRA		.0002	; go back if less than 5 ticks
   9008 00EDF2                             .0001:
   9009 00EDF2 FA                           	PLX				; restore .X
   9010 00EDF3 68                           	PLA
   9011 00EDF4 60                           	RTS
                                           
                                           	MEM		16
                                           	NDX		16
                                           
   9016 00EDF5                             msgKeybdNR:
   9017 00EDF5 0D 0A 4B 65 79 62 6F 61      	.byte	CR,LF,"Keyboard not responding.",CR,LF,0
   9017 00EDFD 72 64 20 6E 6F 74 20 72    
   9017 00EE05 65 73 70 6F 6E 64 69 6E    
   9017 00EE0D 67 2E 0D 0A 00             
                                           
                                           	cpu		FT832
                                           
   9021 00EE12                             KeybdGetCharNoWaitCtx:
   9022 00EE12 20 18 EE                     	JSR		KeybdGetCharNoWait
   9023 00EE15 42 40 00                     	RTC		#0
   9024 00EE18                             	
   9025 00EE18 08                           	PHP
   9026 00EE19 E2 20                        	SEP		#$20
   9027 00EE1B C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9030 00EE1D A9 00                        	LDA		#0
   9031 00EE1F 85 0B                        	STA		KeybdWaitFlag
   9032 00EE21 80 10                        	BRA		KeybdGetChar1
                                           
   9034 00EE23                             KeybdGetCharWait:
   9035 00EE23 08                           	PHP
   9036 00EE24 E2 20                        	SEP		#$20
   9037 00EE26 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9040 00EE28 A9 FF                        	LDA		#$FF
   9041 00EE2A 85 0B                        	STA		KeybdWaitFlag
   9042 00EE2C 80 05                        	BRA		KeybdGetChar1
                                           
                                           ; Wait for a keyboard character to be available
                                           ; Returns (CF=1) if no key available
                                           ; Return key (CF=0) if key is available
                                           ;
                                           ;
   9049 00EE2E                             KeybdGetChar:
   9050 00EE2E 08                           	PHP
   9051 00EE2F E2 20                        	SEP		#$20		; 8 bit acc
   9052 00EE31 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9055 00EE33                             KeybdGetChar1:
   9056 00EE33 DA                           	PHX
   9057 00EE34 EB                           	XBA					; force .B to zero for TAX
   9058 00EE35 A9 00                        	LDA		#0
   9059 00EE37 EB                           	XBA
   9060 00EE38                             .0002:
   9061 00EE38                             .0003:
   9062 00EE38 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		; check MSB of keyboard status reg.
                                         
   9063 00EE40 2A                           	ROL
   9064 00EE41 2A                           	ROL
   9065 00EE42 B0 F4                        	BCS		.0003		; check busy flag, branch if busy
   9066 00EE44 6A                           	ROR
   9067 00EE45 B0 08                        	BCS		.0006		; branch if keystroke ready
   9068 00EE47 24 0B                        	BIT		KeybdWaitFlag
   9069 00EE49 30 ED                        	BMI		.0003
   9070 00EE4B FA                           	PLX
   9071 00EE4C 28                           	PLP
   9072 00EE4D 38                           	SEC
   9073 00EE4E 60                           	RTS
   9074 00EE4F                             .0006:
   9075 00EE4F 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD	; get scan code value
                                         
   9076 00EE57 42 3B FF 0F 42 9C 12 A1      	STZ		$FFF:KEYBD+2	; clear read flag
   9076 00EE5F 0E 00                      
                                           	;REP		#$20
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;SEP		#$20
   9081 00EE61                             .0001:
   9082 00EE61 C9 F0                        	CMP		#SC_KEYUP	; keyup scan code ?
   9083 00EE63 F0 FF 6F 00                  	LBEQ	.doKeyup	; 
   9084 00EE67 C9 E0                        	CMP		#SC_EXTEND	; extended scan code ?
   9085 00EE69 F0 FF 70 00                  	LBEQ	.doExtend
   9086 00EE6D C9 14                        	CMP		#$14		; control ?
   9087 00EE6F F0 FF 73 00                  	LBEQ	.doCtrl
   9088 00EE73 C9 12                        	CMP		#$12		; left shift
   9089 00EE75 F0 FF 7D 00                  	LBEQ	.doShift
   9090 00EE79 C9 59                        	CMP		#$59		; right shift
   9091 00EE7B F0 FF 77 00                  	LBEQ	.doShift
   9092 00EE7F C9 77                        	CMP		#SC_NUMLOCK
   9093 00EE81 F0 FF 81 00                  	LBEQ	.doNumLock
   9094 00EE85 C9 58                        	CMP		#SC_CAPSLOCK
   9095 00EE87 F0 FF 8B 00                  	LBEQ	.doCapsLock
   9096 00EE8B C9 7E                        	CMP		#SC_SCROLLLOCK
   9097 00EE8D F0 FF 95 00                  	LBEQ	.doScrollLock
   9098 00EE91 46 08                        	LSR		KeyState1
   9099 00EE93 B0 A3                        	BCS		.0003
   9100 00EE95 AA                           	TAX
   9101 00EE96 A9 80                        	LDA		#$80
   9102 00EE98 24 09                        	BIT		KeyState2	; Is extended code ?
   9103 00EE9A F0 13                        	BEQ		.0010
   9104 00EE9C A9 7F                        	LDA		#$7F
   9105 00EE9E 25 09                        	AND		KeyState2
   9106 00EEA0 85 09                        	STA		KeyState2
   9107 00EEA2 46 08                        	LSR		KeyState1	; clear keyup
   9108 00EEA4 8A                           	TXA
   9109 00EEA5 29 7F                        	AND		#$7F
   9110 00EEA7 AA                           	TAX
   9111 00EEA8 42 1B BD 03 F2               	LDA		cs:keybdExtendedCodes,X
   9112 00EEAD 80 23                        	BRA		.0008
   9113 00EEAF                             .0010:
   9114 00EEAF A9 04                        	LDA		#4
   9115 00EEB1 24 09                        	BIT		KeyState2	; Is Cntrl down ?
   9116 00EEB3 F0 0B                        	BEQ		.0009
   9117 00EEB5 8A                           	TXA
   9118 00EEB6 29 7F                        	AND		#$7F		; table is 128 chars
   9119 00EEB8 AA                           	TAX
   9120 00EEB9 42 1B BD 83 F1               	LDA		cs:keybdControlCodes,X
   9121 00EEBE 80 12                        	BRA		.0008
   9122 00EEC0                             .0009:
   9123 00EEC0 A9 01                        	LDA		#$1			; Is shift down ?
   9124 00EEC2 24 09                        	BIT		KeyState2
   9125 00EEC4 F0 07                        	BEQ		.0007
   9126 00EEC6 42 1B BD 83 F0               	LDA		cs:shiftedScanCodes,X
   9127 00EECB 80 05                        	BRA		.0008
   9128 00EECD                             .0007:
   9129 00EECD 42 1B BD 83 EF               	LDA		cs:unshiftedScanCodes,X
   9130 00EED2                             .0008:
   9131 00EED2 FA                           	PLX
   9132 00EED3 28                           	PLP
   9133 00EED4 18                           	CLC
   9134 00EED5 60                           	RTS
                                           	MEM		8
   9136 00EED6                             .doKeyup:
   9137 00EED6 A9 01                        	LDA		#1
   9138 00EED8 04 08                        	TSB		KeyState1
   9139 00EEDA 82 5B FF                     	BRL		.0003
   9140 00EEDD                             .doExtend:				; set extended key flag
   9141 00EEDD A5 09                        	LDA		KeyState2
   9142 00EEDF 09 80                        	ORA		#$80
   9143 00EEE1 85 09                        	STA		KeyState2
   9144 00EEE3 82 52 FF                     	BRL		.0003
   9145 00EEE6                             .doCtrl:
   9146 00EEE6 A9 04                        	LDA		#4
   9147 00EEE8 46 08                        	LSR		KeyState1	; check key up/down	
   9148 00EEEA 90 05                        	BCC		.0004		; keydown = carry clear
   9149 00EEEC 14 09                        	TRB		KeyState2
   9150 00EEEE 82 47 FF                     	BRL		.0003
   9151 00EEF1                             .0004:
   9152 00EEF1 04 09                        	TSB		KeyState2	; set control active bit
   9153 00EEF3 82 42 FF                     	BRL		.0003
   9154 00EEF6                             .doShift:
   9155 00EEF6 A9 01                        	LDA		#1
   9156 00EEF8 46 08                        	LSR		KeyState1	; check key up/down	
   9157 00EEFA 90 05                        	BCC		.0005
   9158 00EEFC 14 09                        	TRB		KeyState2
   9159 00EEFE 82 37 FF                     	BRL		.0003
   9160 00EF01                             .0005:
   9161 00EF01 04 09                        	TSB		KeyState2
   9162 00EF03 82 32 FF                     	BRL		.0003
   9163 00EF06                             .doNumLock:
   9164 00EF06 A5 09                        	LDA		KeyState2
   9165 00EF08 49 10                        	EOR		#16
   9166 00EF0A 85 09                        	STA		KeyState2
   9167 00EF0C E2 30                        	SEP		#$30
   9168 00EF0E 20 36 EF                     	JSR		KeybdSetLEDStatus
   9169 00EF11 C2 20                        	REP		#$20
   9170 00EF13 82 22 FF                     	BRL		.0003
   9171 00EF16                             .doCapsLock:
   9172 00EF16 A5 09                        	LDA		KeyState2
   9173 00EF18 49 20                        	EOR		#32
   9174 00EF1A 85 09                        	STA		KeyState2
   9175 00EF1C E2 30                        	SEP		#$30
   9176 00EF1E 20 36 EF                     	JSR		KeybdSetLEDStatus
   9177 00EF21 C2 20                        	REP		#$20
   9178 00EF23 82 12 FF                     	BRL		.0003
   9179 00EF26                             .doScrollLock:
   9180 00EF26 A5 09                        	LDA		KeyState2
   9181 00EF28 49 40                        	EOR		#64
   9182 00EF2A 85 09                        	STA		KeyState2
   9183 00EF2C E2 30                        	SEP		#$30
   9184 00EF2E 20 36 EF                     	JSR		KeybdSetLEDStatus
   9185 00EF31 C2 20                        	REP		#$20
   9186 00EF33 82 02 FF                     	BRL		.0003
                                           
   9188 00EF36                             KeybdSetLEDStatus:
                                           ;	PHDS				; save off DS
                                           ;	PEA		5			; set DS to zero
                                           ;	PLDS
   9192 00EF36 A9 00                        	LDA		#0
   9193 00EF38 85 0A                        	STA		KeybdLEDs
   9194 00EF3A A9 10                        	LDA		#16
   9195 00EF3C 24 09                        	BIT		KeyState2
   9196 00EF3E F0 06                        	BEQ		.0002
   9197 00EF40 A5 0A                        	LDA		KeybdLEDs	; set bit 1 for Num lock, 0 for scrolllock , 2 for caps lock
   9198 00EF42 09 02                        	ORA		#$2
   9199 00EF44 85 0A                        	STA		KeybdLEDs
   9200 00EF46                             .0002:
   9201 00EF46 A9 20                        	LDA		#32
   9202 00EF48 24 09                        	BIT		KeyState2
   9203 00EF4A F0 06                        	BEQ		.0003
   9204 00EF4C A5 0A                        	LDA		KeybdLEDs
   9205 00EF4E 09 04                        	ORA		#$4
   9206 00EF50 85 0A                        	STA		KeybdLEDs
   9207 00EF52                             .0003:
   9208 00EF52 A9 40                        	LDA		#64
   9209 00EF54 24 09                        	BIT		KeyState2
   9210 00EF56 F0 06                        	BEQ		.0004
   9211 00EF58 A5 0A                        	LDA		KeybdLEDs
   9212 00EF5A 09 01                        	ORA		#1
   9213 00EF5C 85 0A                        	STA		KeybdLEDs
   9214 00EF5E                             .0004:
   9215 00EF5E A9 ED                        	LDA		#$ED		; set status LEDs command
   9216 00EF60 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9217 00EF68 20 BF ED                     	JSR		KeybdWaitTx
   9218 00EF6B 20 9A ED                     	JSR		KeybdRecvByte
   9219 00EF6E 90 12                        	BCC		.0001
   9220 00EF70 C9 FA                        	CMP		#$FA
   9221 00EF72 A5 0A                        	LDA		KeybdLEDs
   9222 00EF74 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9223 00EF7C 20 BF ED                     	JSR		KeybdWaitTx
   9224 00EF7F 20 9A ED                     	JSR		KeybdRecvByte	; wait for $FA byte
   9225 00EF82                             .0001:
                                           ;	PLDS				; recover DS
   9227 00EF82 60                           	RTS
                                           
                                           
                                           	;--------------------------------------------------------------------------
                                           	; PS2 scan codes to ascii conversion tables.
                                           	;--------------------------------------------------------------------------
                                           	;
   9234 00EF83                             unshiftedScanCodes:
   9235 00EF83 2E A9 2E A5 A3 A1 A2 AC      	.byte	$2e,$a9,$2e,$a5,$a3,$a1,$a2,$ac
                                         
   9236 00EF8B 2E AA A8 A6 A4 09 60 2E      	.byte	$2e,$aa,$a8,$a6,$a4,$09,$60,$2e
                                         
   9237 00EF93 2E 2E 2E 2E 2E 71 31 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$71,$31,$2e
                                         
   9238 00EF9B 2E 2E 7A 73 61 77 32 2E      	.byte	$2e,$2e,$7a,$73,$61,$77,$32,$2e
                                         
   9239 00EFA3 2E 63 78 64 65 34 33 2E      	.byte	$2e,$63,$78,$64,$65,$34,$33,$2e
                                         
   9240 00EFAB 2E 20 76 66 74 72 35 2E      	.byte	$2e,$20,$76,$66,$74,$72,$35,$2e
                                         
   9241 00EFB3 2E 6E 62 68 67 79 36 2E      	.byte	$2e,$6e,$62,$68,$67,$79,$36,$2e
                                         
   9242 00EFBB 2E 2E 6D 6A 75 37 38 2E      	.byte	$2e,$2e,$6d,$6a,$75,$37,$38,$2e
                                         
   9243 00EFC3 2E 2C 6B 69 6F 30 39 2E      	.byte	$2e,$2c,$6b,$69,$6f,$30,$39,$2e
                                         
   9244 00EFCB 2E 2E 2F 6C 3B 70 2D 2E      	.byte	$2e,$2e,$2f,$6c,$3b,$70,$2d,$2e
                                         
   9245 00EFD3 2E 2E 27 2E 5B 3D 2E 2E      	.byte	$2e,$2e,$27,$2e,$5b,$3d,$2e,$2e
                                         
   9246 00EFDB AD 2E 0D 5D 2E 5C 2E 2E      	.byte	$ad,$2e,$0d,$5d,$2e,$5c,$2e,$2e
                                         
   9247 00EFE3 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9248 00EFEB 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9249 00EFF3 98 7F 92 2E 91 90 1B AF      	.byte	$98,$7f,$92,$2e,$91,$90,$1b,$af
                                         
   9250 00EFFB AB 2E 97 2E 2E 96 AE 2E      	.byte	$ab,$2e,$97,$2e,$2e,$96,$ae,$2e
                                         
                                           
   9252 00F003 2E 2E 2E A7 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$a7,$2e,$2e,$2e,$2e
                                         
   9253 00F00B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9254 00F013 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9255 00F01B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9256 00F023 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9257 00F02B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9258 00F033 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9259 00F03B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9260 00F043 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9261 00F04B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9262 00F053 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9263 00F05B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9264 00F063 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9265 00F06B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9266 00F073 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9267 00F07B 2E 2E FA 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$fa,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9269 00F083                             shiftedScanCodes:
   9270 00F083 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9271 00F08B 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9272 00F093 2E 2E 2E 2E 2E 51 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$51,$21,$2e
                                         
   9273 00F09B 2E 2E 5A 53 41 57 40 2E      	.byte	$2e,$2e,$5a,$53,$41,$57,$40,$2e
                                         
   9274 00F0A3 2E 43 58 44 45 24 23 2E      	.byte	$2e,$43,$58,$44,$45,$24,$23,$2e
                                         
   9275 00F0AB 2E 20 56 46 54 52 25 2E      	.byte	$2e,$20,$56,$46,$54,$52,$25,$2e
                                         
   9276 00F0B3 2E 4E 42 48 47 59 5E 2E      	.byte	$2e,$4e,$42,$48,$47,$59,$5e,$2e
                                         
   9277 00F0BB 2E 2E 4D 4A 55 26 2A 2E      	.byte	$2e,$2e,$4d,$4a,$55,$26,$2a,$2e
                                         
   9278 00F0C3 2E 3C 4B 49 4F 29 28 2E      	.byte	$2e,$3c,$4b,$49,$4f,$29,$28,$2e
                                         
   9279 00F0CB 2E 3E 3F 4C 3A 50 5F 2E      	.byte	$2e,$3e,$3f,$4c,$3a,$50,$5f,$2e
                                         
   9280 00F0D3 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9281 00F0DB 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9282 00F0E3 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9283 00F0EB 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9284 00F0F3 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9285 00F0FB 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9287 00F103 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9288 00F10B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9289 00F113 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9290 00F11B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9291 00F123 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9292 00F12B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9293 00F133 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9294 00F13B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9295 00F143 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9296 00F14B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9297 00F153 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9298 00F15B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9299 00F163 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9300 00F16B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9301 00F173 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9302 00F17B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
                                           ; control
   9305 00F183                             keybdControlCodes:
   9306 00F183 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9307 00F18B 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9308 00F193 2E 2E 2E 2E 2E 11 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$11,$21,$2e
                                         
   9309 00F19B 2E 2E 1A 13 01 17 40 2E      	.byte	$2e,$2e,$1a,$13,$01,$17,$40,$2e
                                         
   9310 00F1A3 2E 03 18 04 05 24 23 2E      	.byte	$2e,$03,$18,$04,$05,$24,$23,$2e
                                         
   9311 00F1AB 2E 20 16 06 14 12 25 2E      	.byte	$2e,$20,$16,$06,$14,$12,$25,$2e
                                         
   9312 00F1B3 2E 0E 02 08 07 19 5E 2E      	.byte	$2e,$0e,$02,$08,$07,$19,$5e,$2e
                                         
   9313 00F1BB 2E 2E 0D 0A 15 26 2A 2E      	.byte	$2e,$2e,$0d,$0a,$15,$26,$2a,$2e
                                         
   9314 00F1C3 2E 3C 0B 09 0F 29 28 2E      	.byte	$2e,$3c,$0b,$09,$0f,$29,$28,$2e
                                         
   9315 00F1CB 2E 3E 3F 0C 3A 10 5F 2E      	.byte	$2e,$3e,$3f,$0c,$3a,$10,$5f,$2e
                                         
   9316 00F1D3 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9317 00F1DB 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9318 00F1E3 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9319 00F1EB 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9320 00F1F3 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9321 00F1FB 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9323 00F203                             keybdExtendedCodes:
   9324 00F203 2E 2E 2E 2E A3 A1 A2 2E      	.byte	$2e,$2e,$2e,$2e,$a3,$a1,$a2,$2e
                                         
   9325 00F20B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9326 00F213 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9327 00F21B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9328 00F223 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9329 00F22B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9330 00F233 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9331 00F23B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9332 00F243 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9333 00F24B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9334 00F253 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9335 00F25B 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9336 00F263 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9337 00F26B 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9338 00F273 98 99 92 2E 91 90 2E 2E      	.byte	$98,$99,$92,$2e,$91,$90,$2e,$2e
                                         
   9339 00F27B 2E 2E 97 2E 2E 96 2E 2E      	.byte	$2e,$2e,$97,$2e,$2e,$96,$2e,$2e
                                         
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; SPI MASTER driver
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ; spi_master_init
                                           ; Initialize the spi master controller
                                           
   9350 00F283                             spi_master_init:
   9351 00F283 08                           	
   9352 00F284 E2 20                        	SEP		#$20
                                           	MEM		8
   9354 00F286 A9 01                        	LDA		#SPI_INIT_SD
   9355 00F288 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9356 00F28C A9 01                        	LDA		#SPI_TRANS_START
   9357 00F28E 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9358 00F292                             .0001:
   9359 00F292 AD 8E F2                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9360 00F295 C9 01                        	CMP		#SPI_TRANS_BUSY
   9361 00F297 F0 F9                        	BEQ		.0001
   9362 00F299 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9363 00F29D 29 03                        	AND		#3	; INIT errors
   9364 00F29F C9 00                        	CMP		#SPI_INIT_NO_ERROR
   9365 00F2A1 F0 0E                        	BEQ		.0004
   9366 00F2A3 28                           	PLP
                                           	MEM		16
                                           	NDX		16
   9369 00F2A4 F4 01 00                     	PEA		1
   9370 00F2A7 F4 A1 F3                     	PEA		msgSpiInitError
   9371 00F2AA 20 CD EA                     	JSR		DisplayString
   9372 00F2AD A9 01 00                     	LDA		#1
   9373 00F2B0 60                           	RTS
   9374 00F2B1                             .0004:
   9375 00F2B1 28                           	PLP
                                           	;PEA		1
                                           	;PEA		msgSpiInited
                                           	;JSR		DisplayString
   9379 00F2B2 A9 00 00                     	LDA		#0
   9380 00F2B5 60                           	RTS
                                           
                                           ; spi_master_read
                                           ; read a block from the SD card
                                           ;
                                           ; Parameters:
                                           ;	32 bit buffer address pushed onto stack
                                           ;	32 bit block number pushed onto stack
                                           ;
   9389 00F2B6                             spi_master_read:
   9390 00F2B6 08                           	PHP
   9391 00F2B7 E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
   9394 00F2B9 BA                           	TSX
   9395 00F2BA B5 04                        	LDA		4,X
   9396 00F2BC 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9397 00F2C0 B5 05                        	LDA		5,X
   9398 00F2C2 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9399 00F2C6 B5 06                        	LDA		6,X
   9400 00F2C8 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9401 00F2CC B5 07                        	LDA		7,X
   9402 00F2CE 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
   9403 00F2D2 B5 08                        	LDA		8,X
   9404 00F2D4 85 C8                        	STA		bufptr
   9405 00F2D6 B5 09                        	LDA		9,X
   9406 00F2D8 85 C9                        	STA		bufptr+1
   9407 00F2DA B5 0A                        	LDA		10,X
   9408 00F2DC 85 CA                        	STA		bufptr+2
   9409 00F2DE B5 0B                        	LDA		11,X
   9410 00F2E0 85 CB                        	STA		bufptr+3
   9411 00F2E2 A9 02                        	LDA		#SPI_RW_READ_SD_BLOCK
   9412 00F2E4 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9413 00F2E8 A9 01                        	LDA		#SPI_TRANS_START
   9414 00F2EA 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9415 00F2EE                             .0001:
   9416 00F2EE AD 8E F2                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9417 00F2F1 C9 01                        	CMP		#SPI_TRANS_BUSY
   9418 00F2F3 F0 F9                        	BEQ		.0001
   9419 00F2F5 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9420 00F2F9 4A                           	LSR
   9421 00F2FA 4A                           	LSR
   9422 00F2FB 29 03                        	AND		#3	; INIT errors
   9423 00F2FD C9 00                        	CMP		#SPI_READ_NO_ERROR
   9424 00F2FF F0 10                        	BEQ		.0004
   9425 00F301 28                           	PLP
                                           	MEM		16
   9427 00F302 F4 01 00                     	PEA		1
   9428 00F305 F4 D5 F3                     	PEA		msgSpiReadError
   9429 00F308 20 CD EA                     	JSR		DisplayString
   9430 00F30B A9 01 00                     	LDA		#1
   9431 00F30E 42 C0 08                     	RTS		#8
   9432 00F311                             .0004:
   9433 00F311 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9436 00F313 A2 00 02                     	LDX		#512
   9437 00F316 A0 00 00                     	LDY		#0
   9438 00F319                             .0003:
                                           	;TXA
                                           	;AND		#$0F
                                           	;BNE		.0002
                                           	;PLP
                                           	;JSR		OutCRLF
                                           	;PHP
                                           	;SEP		#$20
   9446 00F319                             .0002:
   9447 00F319 AF 10 C0 FE                  	LDA		SPI_RX_FIFO_DATA_REG
   9448 00F31D 42 97 C8                     	STA		{bufptr},Y
   9449 00F320 C8                           	INY
                                           	;PLP
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;PHP
   9454 00F321 E2 20                        	SEP		#$20
   9455 00F323 CA                           	DEX
   9456 00F324 D0 F3                        	BNE		.0003
   9457 00F326 28                           	PLP
                                           	;JSR		OutCRLF
                                           	MEM		16
                                           	NDX		16
   9461 00F327 A9 00 00                     	LDA		#0
   9462 00F32A 42 C0 08                     	RTS		#8
                                           
   9464 00F32D                             spi_master_write:
   9465 00F32D 08                           	PHP
   9466 00F32E E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
                                           
   9470 00F330 BA                           	TSX
   9471 00F331 B5 08                        	LDA		8,X
   9472 00F333 85 C8                        	STA		bufptr
   9473 00F335 B5 09                        	LDA		9,X
   9474 00F337 85 C9                        	STA		bufptr+1
   9475 00F339 B5 0A                        	LDA		10,X
   9476 00F33B 85 CA                        	STA		bufptr+2
   9477 00F33D B5 0B                        	LDA		11,X
   9478 00F33F 85 CB                        	STA		bufptr+3
                                           
   9480 00F341 A0 00 00                     	LDY		#0
   9481 00F344                             .0001:
   9482 00F344 42 B7 C8                     	LDA		{bufptr},Y
   9483 00F347 8F 20 C0 FE                  	STA		SPI_TX_FIFO_DATA_REG
   9484 00F34B C8                           	INY
   9485 00F34C C0 00 02                     	CPY		#512
   9486 00F34F D0 F3                        	BNE		.0001
                                           
   9488 00F351 B5 04                        	LDA		4,X
   9489 00F353 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9490 00F357 B5 05                        	LDA		5,X
   9491 00F359 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9492 00F35D B5 06                        	LDA		6,X
   9493 00F35F 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9494 00F363 B5 07                        	LDA		7,X
   9495 00F365 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
                                           
   9497 00F369 A9 03                        	LDA		#SPI_RW_WRITE_SD_BLOCK
   9498 00F36B 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9499 00F36F A9 01                        	LDA		#SPI_TRANS_START
   9500 00F371 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9501 00F375                             .0002:
   9502 00F375 AD 8E F2                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9503 00F378 C9 01                        	CMP		#SPI_TRANS_BUSY
   9504 00F37A F0 F9                        	BEQ		.0002
   9505 00F37C AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9506 00F380 4A                           	LSR
   9507 00F381 4A                           	LSR
   9508 00F382 4A                           	LSR
   9509 00F383 4A                           	LSR
   9510 00F384 29 03                        	AND		#3	; write errors
   9511 00F386 C9 00                        	CMP		#SPI_WRITE_NO_ERROR
   9512 00F388 F0 10                        	BEQ		.0004
   9513 00F38A 28                           	PLP
                                           	MEM		16
   9515 00F38B F4 01 00                     	PEA		1
   9516 00F38E F4 E6 F3                     	PEA		msgSpiWriteError
   9517 00F391 20 CD EA                     	JSR		DisplayString
   9518 00F394 A9 01 00                     	LDA		#1
   9519 00F397 42 C0 08                     	RTS		#8
   9520 00F39A                             .0004:
   9521 00F39A 28                           	PLP
   9522 00F39B A9 00 00                     	LDA		#0
   9523 00F39E 42 C0 08                     	RTS		#8
                                           
   9525 00F3A1                             msgSpiInitError:
   9526 00F3A1 45 72 72 6F 72 20 69 6E      .byte	"Error initializing SPI master",$0D,$0A,$00
   9526 00F3A9 69 74 69 61 6C 69 7A 69    
   9526 00F3B1 6E 67 20 53 50 49 20 6D    
   9526 00F3B9 61 73 74 65 72 0D 0A 00    
                                         
   9527 00F3C1                             msgSpiInited:
   9528 00F3C1 53 50 49 20 6D 61 73 74      .byte	"SPI master inited",$0D,$0A,$00
   9528 00F3C9 65 72 20 69 6E 69 74 65    
   9528 00F3D1 64 0D 0A 00                
   9529 00F3D5                             msgSpiReadError:
   9530 00F3D5 53 50 49 20 72 65 61 64      .byte	"SPI read error",$0D,$0A,$00
   9530 00F3DD 20 65 72 72 6F 72 0D 0A    
   9530 00F3E5 00                         
   9531 00F3E6                             msgSpiWriteError:
   9532 00F3E6 53 50 49 20 77 72 69 74      .byte	"SPI write error",$0D,$0A,$00
   9532 00F3EE 65 20 65 72 72 6F 72 0D    
   9532 00F3F6 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; RTC driver for MCP7941x
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
   9540 00F3F8                             rtc_init:
   9541 00F3F8 A9 43 00                     		LDA		#67					; constant for 100kHz I2C from 33MHz 
   9542 00F3FB 8F 00 C1 FE                  		STA		I2C_PRESCALE_LO
   9543 00F3FF 60                           		RTS
                                           
                                           ; Read all the RTC sram registers into a buffer
                                           
   9547 00F400                             rtc_read:
   9548 00F400 08                           		PHP
   9549 00F401 E2 20                        		SEP		#$20
                                           		MEM		8
   9551 00F403 A9 80                        		LDA		#$80				; enable I2C
   9552 00F405 8F 02 C1 FE                  		STA		I2C_CONTROL
   9553 00F409 A9 DF                        		LDA		#$DF				; read address, read op
   9554 00F40B 8F 03 C1 FE                  		STA		I2C_TX
   9555 00F40F A9 90                        		LDA		#$90				; STA + wr bit
   9556 00F411 8F 04 C1 FE                  		STA		I2C_CMD
   9557 00F415 20 72 F4                     		JSR		rtc_wait_tip
   9558 00F418 AF 04 C1 FE                  		LDA		I2C_STAT
   9559 00F41C 30 4B                        		BMI		.rxerr
   9560 00F41E A9 00                        		LDA		#$00				; address zero
   9561 00F420 8F 03 C1 FE                  		STA		I2C_TX
   9562 00F424 A9 10                        		LDA		#$10				; wr bit
   9563 00F426 8F 04 C1 FE                  		STA		I2C_CMD
   9564 00F42A 20 72 F4                     		JSR		rtc_wait_tip
   9565 00F42D AF 04 C1 FE                  		LDA		I2C_STAT
   9566 00F431 30 36                        		BMI		.rxerr
   9567 00F433 A2 00 00                     		LDX		#0
   9568 00F436                             .0001:
   9569 00F436 A9 20                        		LDA		#$20				; rd bit
   9570 00F438 8F 04 C1 FE                  		STA		I2C_CMD
   9571 00F43C 20 72 F4                     		JSR		rtc_wait_tip
   9572 00F43F AF 04 C1 FE                  		LDA		I2C_STAT
   9573 00F443 30 24                        		BMI		.rxerr
   9574 00F445 AF 03 C1 FE                  		LDA		I2C_RX
   9575 00F449 9D 00 03                     		STA		RTCBuf,X
   9576 00F44C E8                           		INX
   9577 00F44D E0 5F 00                     		CPX		#$5F
   9578 00F450 D0 E4                        		BNE		.0001
   9579 00F452 A9 68                        		LDA		#$68				; STO, rd bit + nack
   9580 00F454 8F 04 C1 FE                  		STA		I2C_CMD
   9581 00F458 20 72 F4                     		JSR		rtc_wait_tip
   9582 00F45B AF 04 C1 FE                  		LDA		I2C_STAT
   9583 00F45F 30 08                        		BMI		.rxerr
   9584 00F461 A9 00                        		LDA		#0					; disable I2C and return 0
   9585 00F463 8F 02 C1 FE                  		STA		I2C_CONTROL
   9586 00F467 28                           		PLP
   9587 00F468 60                           		RTS
   9588 00F469                             .rxerr:
   9589 00F469 A9 00                        		LDA		#0					; disable I2C and return 1
   9590 00F46B 8F 02 C1 FE                  		STA		I2C_CONTROL
   9591 00F46F 1A                           		INA
   9592 00F470 28                           		PLP
   9593 00F471 60                           		RTS
                                           
   9595 00F472                             rtc_wait_tip:
   9596 00F472                             .0001:
   9597 00F472 AF 04 C1 FE                  		LDA		I2C_STAT
   9598 00F476 29 04                        		AND		#$4					; transmit in progress bit
   9599 00F478 D0 F8                        		BNE		.0001
   9600 00F47A 60                           		RTS
                                           
   9602 00F47B                             msgRtcReadFail:
   9603 00F47B 52 54 43 20 72 65 61 64      	.byte	"RTC read failed.",$0D,$0A,$00
   9603 00F483 20 66 61 69 6C 65 64 2E    
   9603 00F48B 0D 0A 00                   
                                           
                                           ; Get char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
                                           	MEM		16
                                           	NDX		16
   9610 00F48E                             SuperGetch:
   9611 00F48E 20 18 EE                     	JSR		KeybdGetCharNoWait
   9612 00F491 29 FF 00                     	AND		#$FF
   9613 00F494 42 40 00                     	RTC		#0
   9614 00F497 82 D3 EC                     	BRL		TaskFC
                                           
                                           ; Put char routine for Supermon
                                           ;
   9618 00F49A                             SuperPutch:
   9619 00F49A 20 BE EA                     	JSR		OutChar
   9620 00F49D 42 40 00                     	RTC		#0
   9621 00F4A0 82 CA EC                     	BRL		TaskFC
                                           
                                           ; Char get routine for BASIC
                                           ; Same thing as for Supermon, except carry flag needs to be inverted
                                           ; This routine should be called from a different context than the BIOS,
                                           ; otherwise the call will be ignored.
                                           ;
   9628 00F4A3                             BasicGetch:
   9629 00F4A3 A9 F1 00                     	LDA		#$F1
   9630 00F4A6 8D 00 70                     	STA		$7000
   9631 00F4A9 20 18 EE                     	JSR		KeybdGetCharNoWait
   9632 00F4AC 29 FF 00                     	AND		#$FF
   9633 00F4AF 42 18                        	CMC
   9634 00F4B1 42 40 00                     	RTC		#0
   9635 00F4B4 82 B6 EC                     	BRL		TaskFC
                                           
   9637 00F4B7                             xitBasic:
   9638 00F4B7 FA                           	PLX					; get rid of task to return to, we won't be returning
   9639 00F4B8 85 C0                        	STA		ExitCode
   9640 00F4BA 42 CB 42 A2 00 00            	TSK		JMP:#0
   9641 00F4C0 82 AA EC                     	BRL		TaskFC
                                           
   9643 00F4C3                             warm_start:
   9644 00F4C3 42 E2 00 01                  	SEP		#$100		; 16 bit mode
   9645 00F4C7 C2 30                        	REP		#$30		; 16 bit MEM,NDX
                                           	MEM		16
                                           	NDX		16
   9648 00F4C9 A9 FF 3F                     	LDA		#$3FFF
   9649 00F4CC 1B                           	TAS
   9650 00F4CD 20 21 EB                     	JSR		CursorOn
   9651 00F4D0 82 AC EC                     	BRL		Mon1
                                           
                                           	cpu		FT832
   9654 00F4D3                             ICacheIL832:
   9655 00F4D3 42 E0 01                     	CACHE	#1			; 1= invalidate instruction line identified by accumulator
   9656 00F4D6 60                           	RTS
                                           
                                           ; IRQ routine for all modes. The interrupted task must of had interrupts
                                           ; enabled and this status should be saved on the stack with the value of
                                           ; the status register. The RTI instruction will pop the status register off
                                           ; the stack and restore the interrupt enable.
                                           ; Note that all this routine does is switch to a task which has a different
                                           ; register set, so there's no need to stack and restore registers. The
                                           ; task switch also allows the routine to be located anywhere in the memory
                                           ; system, so we don't have to worry about using up bank 0 memory.
                                           
   9667 00F4D7                             IRQRout832:
   9668 00F4D7                             IRQRout816:
   9669 00F4D7                             IRQRout02:
   9670 00F4D7 42 A2 01 00                  	TSK		#1			; switch to the interrupt handling task
   9671 00F4DB 40                           	RTI
                                           
                                           ; This task has interrupts masked in it's startup record and therefore runs
                                           ; with interrupts masked as the task never enables interrupts. Note that it's
                                           ; important that interrupts are masked while this is running, otherwise the
                                           ; uncleared interrupt status would cause another interrupt resulting in an
                                           ; infinite interrupt loop.
                                           	MEM		16
   9679 00F4DC                             Task1:
   9680 00F4DC 42 8B AD 1F B0               	LDA.B	MPU_IRQ_STATUS	; check if counter expired
   9681 00F4E1 89 02 00                     	BIT		#2				; counter #1 IRQ active bit
   9682 00F4E4 F0 32                        	BEQ		.0001			; no IRQ ?
   9683 00F4E6 A5 04                        	LDA		TickCount		; increment the tick count
   9684 00F4E8 1A                           	INA						; lower 16 bits
   9685 00F4E9 85 04                        	STA		TickCount
   9686 00F4EB 42 3B FF 0F 42 8B 8F A4      	STA.B	$FFF:$D00A4		; update on-screen IRQ live indicator
   9686 00F4F3 00 0D                      
   9687 00F4F5 D0 02                        	BNE		.0002
   9688 00F4F7 E6 06                        	INC		TickCount+2		; increment upper 16 bits of tick count
   9689 00F4F9                             .0002:
   9690 00F4F9 A9 05 00                     	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9691 00F4FC 42 8B 8D 17 B0               	STA.B	CTR1_CTRL		; set control register clearing interrupt
   9692 00F501 42 3B 00 00 42 8B AF DF      	LDA.B	$0:$100DF		; Set flag for EhBASIC Irq
   9692 00F509 00 01                      
   9693 00F50B 09 20 00                     	ORA		#$20
   9694 00F50E 42 3B 00 00 42 8B 8F DF      	STA.B	$0:$100DF
   9694 00F516 00 01                      
                                           ;	JSR		MusicTimeoutIRQ
   9696 00F518                             .0001:
   9697 00F518 42 50                        	RIT					; return from interrupt task
   9698 00F51A 80 C0                        	BRA		Task1		; the next time task1 is run it will start here
                                           
   9700 00F51C                             BtnuIRQ:
   9701 00F51C 42 3B FF 0F 42 8B AF A0      	LDA.B	$FFF:$D00A0
   9701 00F524 00 0D                      
   9702 00F526 1A                           	INA
   9703 00F527 42 3B FF 0F 42 8B 8F A0      	STA.B	$FFF:$D00A0
   9703 00F52F 00 0D                      
   9704 00F531 20 83 F2                     	JSR		spi_master_init
   9705 00F534 C9 00 00                     	CMP		#0
   9706 00F537 D0 1D                        	BNE		.0001
   9707 00F539 A2 00 00                     	LDX		#0
   9708 00F53C                             .0002:
   9709 00F53C F4 0F 00                     	PEA		$000F
   9710 00F53F 8A                           	TXA
   9711 00F540 EB                           	XBA
   9712 00F541 0A                           	ASL
   9713 00F542 48                           	PHA
   9714 00F543 F4 00 00                     	PEA		0
   9715 00F546 F4 00 00                     	PEA		0
   9716 00F549 86 94                        	STX		reg_x
   9717 00F54B 20 B6 F2                     	JSR		spi_master_read
   9718 00F54E A6 94                        	LDX		reg_x
   9719 00F550 E8                           	INX
   9720 00F551 E0 80 00                     	CPX		#128
   9721 00F554 D0 E6                        	BNE		.0002
   9722 00F556                             .0001:
   9723 00F556 42 50                        	RIT
   9724 00F558 80 C2                        	BRA		BtnuIRQ
                                           
                                           ; IRQ handler task - 32 bit
                                           ;
   9728 00F55A                             IRQTask:
                                           	MEM		8
                                           	NDX		32
   9731 00F55A                             IRQTask1:
   9732 00F55A AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
   9733 00F55D 89 02                        	BIT		#2
   9734 00F55F F0 16                        	BEQ		.0001
   9735 00F561 A6 04                        	LDX		TickCount		; increment the tick count
   9736 00F563 E8                           	INX
   9737 00F564 86 04                        	STX		TickCount
   9738 00F566 42 3B FF 0F 42 8B 42 8E      	STX.B	$FFF:$D00A2			; update on-screen IRQ live indicator
   9738 00F56E A2 00 0D 00                
   9739 00F572 A9 05                        	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9740 00F574 8D 17 B0                     	STA		CTR1_CTRL
   9741 00F577                             .0001:
   9742 00F577 42 60                        	RTT					; go back to interrupted task
   9743 00F579 80 DF                        	BRA		IRQTask1	; the next time task is run it will start here
                                           
                                           ; This little task sample runs in native 32 bit mode and displays
                                           ; "Hello World!" on the screen.
                                           
                                           	CPU		FT832
                                           	MEM		8
                                           	NDX		32
                                           
   9752 00F57B                             Task2:
   9753 00F57B A2 F8 01 00 00               	LDX		#84*2*3
   9754 00F580                             .0003:
   9755 00F580 A0 00 00 00 00               	LDY		#0
   9756 00F585                             .0002:
   9757 00F585 42 1B B9 A0 F5               	LDA		CS:msgHelloWorld,Y
   9758 00F58A F0 10                        	BEQ		.0001
   9759 00F58C 20 B5 E8                     	JSR		AsciiToScreen8
   9760 00F58F 42 3B FF 0F 9F 00 00 0D      	STA		$FFF:VIDBUF,X
                                         
   9761 00F597 E8                           	INX
   9762 00F598 E8                           	INX
   9763 00F599 C8                           	INY
   9764 00F59A 80 E9                        	BRA		.0002
   9765 00F59C                             .0001:
   9766 00F59C 42 60                        	RTT
   9767 00F59E 80 E0                        	BRA		.0003
                                           
   9769 00F5A0                             msgHelloWorld:
   9770 00F5A0 0D 0A 48 65 6C 6C 6F 20      	.byte	CR,LF,"Hello World!",CR,LF,0
   9770 00F5A8 57 6F 72 6C 64 21 0D 0A    
   9770 00F5B0 00                         
                                           
                                           	NDX		16
                                           	MEM		16
                                           
   9775 00F5B1                             BrkTask:
   9776 00F5B1 42 EE 00 00 D0 FF            	INC		$FFD00000
   9777 00F5B7 42 60                        	RTT
   9778 00F5B9 80 F6                        	BRA		BrkTask
                                           
                                           ; The following store sequence for the benefit of Supermon816
                                           ;
   9782 00F5BB                             BrkRout:
   9783 00F5BB 0B                           	PHD
   9784 00F5BC 8B                           	PHB
   9785 00F5BD C2 30                        	REP		#$30
   9786 00F5BF 48                           	PHA
   9787 00F5C0 DA                           	PHX
   9788 00F5C1 5A                           	PHY
   9789 00F5C2 6C 02 01                     	JMP		($0102)		; This jump normally points to BrkRout1
   9790 00F5C5                             BrkRout1:
   9791 00F5C5 C2 30                        	REP		#$30
   9792 00F5C7 7A                           	PLY
   9793 00F5C8 FA                           	PLX
   9794 00F5C9 68                           	PLA
   9795 00F5CA AB                           	PLB
   9796 00F5CB 2B                           	PLD
   9797 00F5CC E2 20                        	SEP		#$20
   9798 00F5CE 68                           	PLA
   9799 00F5CF C2 30                        	REP		#$30
   9800 00F5D1 68                           	PLA
   9801 00F5D2 20 9E EB                     	JSR		DispWord
   9802 00F5D5 A2 00 00                     	LDX		#0
   9803 00F5D8 A0 40 00                     	LDY		#64
   9804 00F5DB                             .0001:
   9805 00F5DB 42 F0                        	.word	$f042		; pchist
   9806 00F5DD 20 9E EB                     	JSR		DispWord
   9807 00F5E0 A9 20 00                     	LDA		#' '
   9808 00F5E3 20 BE EA                     	JSR		OutChar
   9809 00F5E6 E8                           	INX
   9810 00F5E7 88                           	DEY
   9811 00F5E8 D0 F1                        	BNE		.0001
   9812 00F5EA A9 FF FF                     	LDA		#$FFFF
   9813 00F5ED 8D 00 70                     	STA		$7000
   9814 00F5F0                             Hung:
   9815 00F5F0 80 FE                        	BRA		Hung
                                           
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------
                                           	; I/O page is located at $F0xx
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------	
                                           	;org		$F100
                                           
   9824 00F5F2                             LineTbl:
   9825 00F5F2 00 00                        	.WORD	0
   9826 00F5F4 54 00                        	.WORD	TEXTCOLS
   9827 00F5F6 A8 00                        	.WORD	TEXTCOLS*2
   9828 00F5F8 FC 00                        	.WORD	TEXTCOLS*3
   9829 00F5FA 50 01                        	.WORD	TEXTCOLS*4
   9830 00F5FC A4 01                        	.WORD	TEXTCOLS*5
   9831 00F5FE F8 01                        	.WORD	TEXTCOLS*6
   9832 00F600 4C 02                        	.WORD	TEXTCOLS*7
   9833 00F602 A0 02                        	.WORD	TEXTCOLS*8
   9834 00F604 F4 02                        	.WORD	TEXTCOLS*9
   9835 00F606 48 03                        	.WORD	TEXTCOLS*10
   9836 00F608 9C 03                        	.WORD	TEXTCOLS*11
   9837 00F60A F0 03                        	.WORD	TEXTCOLS*12
   9838 00F60C 44 04                        	.WORD	TEXTCOLS*13
   9839 00F60E 98 04                        	.WORD	TEXTCOLS*14
   9840 00F610 EC 04                        	.WORD	TEXTCOLS*15
   9841 00F612 40 05                        	.WORD	TEXTCOLS*16
   9842 00F614 94 05                        	.WORD	TEXTCOLS*17
   9843 00F616 E8 05                        	.WORD	TEXTCOLS*18
   9844 00F618 3C 06                        	.WORD	TEXTCOLS*19
   9845 00F61A 90 06                        	.WORD	TEXTCOLS*20
   9846 00F61C E4 06                        	.WORD	TEXTCOLS*21
   9847 00F61E 38 07                        	.WORD	TEXTCOLS*22
   9848 00F620 8C 07                        	.WORD	TEXTCOLS*23
   9849 00F622 E0 07                        	.WORD	TEXTCOLS*24
   9850 00F624 34 08                        	.WORD	TEXTCOLS*25
   9851 00F626 88 08                        	.WORD	TEXTCOLS*26
   9852 00F628 DC 08                        	.WORD	TEXTCOLS*27
   9853 00F62A 30 09                        	.WORD	TEXTCOLS*28
   9854 00F62C 84 09                        	.WORD	TEXTCOLS*29
   9855 00F62E D8 09                        	.WORD	TEXTCOLS*30
                                           
   9857 00F630                             TaskStartTbl:
   9858 00F630 00 00                        	.WORD	0			; CS
   9859 00F632 00 00                        	.WORD	0			; DS
   9860 00F634 00 00                        	.WORD	0			; SS
   9861 00F636 BE E0                        	.WORD	Task0		; PC
   9862 00F638 00                           	.BYTE	Task0>>16	; PB
   9863 00F639 00 00                        	.WORD	0			; acc
   9864 00F63B 00 00                        	.WORD	0
   9865 00F63D 00 00                        	.WORD	0			; x
   9866 00F63F 00 00                        	.WORD	0
   9867 00F641 00 00                        	.WORD	0			; y
   9868 00F643 00 00                        	.WORD	0
   9869 00F645 FF 3F                        	.WORD	$3FFF		; sp
   9870 00F647 00 00                        	.WORD	0
   9871 00F649 04                           	.BYTE	4			; SR
   9872 00F64A 01                           	.BYTE	1			; SR extension
   9873 00F64B 00                           	.BYTE	0			; DB
   9874 00F64C 00 00                        	.WORD	0			; DPR
   9875 00F64E 00 00                        	.WORD	0
                                           
                                           	; TASK #1
                                           	; Interrupt handler task
   9879 00F650 00 00                        	.WORD	0			; CS
   9880 00F652 05 00                        	.WORD	5			; DS
   9881 00F654 05 00                        	.WORD	5			; SS
   9882 00F656 DC F4                        	.WORD	Task1		; PC
   9883 00F658 00                           	.BYTE	Task1>>16
   9884 00F659 00 00                        	.WORD	0			; acc
   9885 00F65B 00 00                        	.WORD	0
   9886 00F65D 00 00                        	.WORD	0			; x
   9887 00F65F 00 00                        	.WORD	0
   9888 00F661 00 00                        	.WORD	0			; y
   9889 00F663 00 00                        	.WORD	0
   9890 00F665 FF 3B                        	.WORD	$3BFF		; sp
   9891 00F667 00 00                        	.WORD	0
   9892 00F669 04                           	.BYTE	4			; SR
   9893 00F66A 01                           	.BYTE	1			; SR extension
   9894 00F66B 00                           	.BYTE	0			; DB
   9895 00F66C 00 00                        	.WORD	0			; DPR
   9896 00F66E 00 00                        	.WORD	0
                                           
   9898 00F670 00 00                        	.WORD	0			; CS
   9899 00F672 00 00                        	.WORD	0			; DS
   9900 00F674 00 00                        	.WORD	0			; SS
   9901 00F676 7B F5                        	.WORD	Task2		; PC
   9902 00F678 00                           	.BYTE	Task2>>16
   9903 00F679 00 00                        	.WORD	0			; acc
   9904 00F67B 00 00                        	.WORD	0
   9905 00F67D 00 00                        	.WORD	0			; x
   9906 00F67F 00 00                        	.WORD	0
   9907 00F681 00 00                        	.WORD	0			; y
   9908 00F683 00 00                        	.WORD	0
   9909 00F685 FF 37                        	.WORD	$37FF		; sp
   9910 00F687 00 00                        	.WORD	0
   9911 00F689 20                           	.BYTE	$20			; SR			; eight bit mem
   9912 00F68A 02                           	.BYTE	2			; SR extension
   9913 00F68B 00                           	.BYTE	0			; DB
   9914 00F68C 00 00                        	.WORD	0			; DPR
   9915 00F68E 00 00                        	.WORD	0
                                           
                                           	; TASK #3
                                           	; Button Interrupt handler task
   9919 00F690 00 00                        	.WORD	0			; CS
   9920 00F692 05 00                        	.WORD	5			; DS
   9921 00F694 05 00                        	.WORD	5			; SS
   9922 00F696 1C F5                        	.WORD	BtnuIRQ		; PC
   9923 00F698 00                           	.BYTE	BtnuIRQ>>16
   9924 00F699 00 00                        	.WORD	0			; acc
   9925 00F69B 00 00                        	.WORD	0
   9926 00F69D 00 00                        	.WORD	0			; x
   9927 00F69F 00 00                        	.WORD	0
   9928 00F6A1 00 00                        	.WORD	0			; y
   9929 00F6A3 00 00                        	.WORD	0
   9930 00F6A5 FF 3A                        	.WORD	$3AFF		; sp
   9931 00F6A7 00 00                        	.WORD	0
   9932 00F6A9 04                           	.BYTE	4			; SR
   9933 00F6AA 01                           	.BYTE	1			; SR extension
   9934 00F6AB 00                           	.BYTE	0			; DB
   9935 00F6AC 00 00                        	.WORD	0			; DPR
   9936 00F6AE 00 00                        	.WORD	0
                                           
   9938 00F6B0 00 00                        	.WORD	0			; CS
   9939 00F6B2 00 00                        	.WORD	0			; DS
   9940 00F6B4 00 00                        	.WORD	0			; SS
   9941 00F6B6 B1 F5                        	.WORD	BrkTask		; PC
   9942 00F6B8 00                           	.BYTE	BrkTask>>16
   9943 00F6B9 00 00                        	.WORD	0			; acc
   9944 00F6BB 00 00                        	.WORD	0
   9945 00F6BD 00 00                        	.WORD	0			; x
   9946 00F6BF 00 00                        	.WORD	0
   9947 00F6C1 00 00                        	.WORD	0			; y
   9948 00F6C3 00 00                        	.WORD	0
   9949 00F6C5 FF 2F                        	.WORD	$2FFF		; sp
   9950 00F6C7 00 00                        	.WORD	0
   9951 00F6C9 00                           	.BYTE	0			; SR
   9952 00F6CA 01                           	.BYTE	1			; SR extension
   9953 00F6CB 00                           	.BYTE	0			; DB
   9954 00F6CC 00 00                        	.WORD	0			; DPR
   9955 00F6CE 00 00                        	.WORD	0
                                           
                                           	; task #5
                                           	; DS is placed at $7800
   9959 00F6D0 00 00                        	.WORD	0			; CS
   9960 00F6D2 00 00                        	.WORD	0    		; DS
   9961 00F6D4 00 00                        	.WORD	0			; SS
   9962 00F6D6 E7 D8                        	.WORD	InvadersTask	; PC
   9963 00F6D8 00                           	.BYTE	InvadersTask>>16
   9964 00F6D9 00 00                        	.WORD	0			; acc
   9965 00F6DB 00 00                        	.WORD	0
   9966 00F6DD 00 00                        	.WORD	0			; x
   9967 00F6DF 00 00                        	.WORD	0
   9968 00F6E1 00 00                        	.WORD	0			; y
   9969 00F6E3 00 00                        	.WORD	0
   9970 00F6E5 FF 2B                        	.WORD	$2BFF		; sp
   9971 00F6E7 00 00                        	.WORD	0
   9972 00F6E9 00                           	.BYTE	0			; SR
   9973 00F6EA 01                           	.BYTE	1			; SR extension
   9974 00F6EB 00                           	.BYTE	0			; DB
   9975 00F6EC 00 00                        	.WORD	0			; DPR
   9976 00F6EE 00 00                        	.WORD	0
                                           
   9978 00F6F0 00 00                        	.WORD	0			; CS
   9979 00F6F2 00 00                        	.WORD	0			; DS
   9980 00F6F4 00 00                        	.WORD	0			; SS
   9981 00F6F6 5A F5                        	.WORD	IRQTask		; PC
   9982 00F6F8 00                           	.BYTE	IRQTask>>16
   9983 00F6F9 00 00                        	.WORD	0			; acc
   9984 00F6FB 00 00                        	.WORD	0
   9985 00F6FD 00 00                        	.WORD	0			; x
   9986 00F6FF 00 00                        	.WORD	0
   9987 00F701 00 00                        	.WORD	0			; y
   9988 00F703 00 00                        	.WORD	0
   9989 00F705 FF 27                        	.WORD	$27FF		; sp
   9990 00F707 00 00                        	.WORD	0
   9991 00F709 24                           	.BYTE	$24			; SR	8 bit acc, mask interrupts
   9992 00F70A 02                           	.BYTE	2			; SR extension - 832 mode
   9993 00F70B 00                           	.BYTE	0			; DB
   9994 00F70C 00 00                        	.WORD	0			; DPR
   9995 00F70E 00 00                        	.WORD	0
                                           
                                           	; task 7 (Basic)
   9998 00F710 FD 0F                        	.WORD	$FFD		; CS
   9999 00F712 FD 0F                        	.WORD	$FFD		; DS
  10000 00F714 FD 0F                        	.WORD	$FFD		; SS
  10001 00F716 00 C0                        	.WORD	$C000		; PC
  10002 00F718 00                           	.BYTE	$00
  10003 00F719 00 00                        	.WORD	0			; acc
  10004 00F71B 00 00                        	.WORD	0
  10005 00F71D 00 00                        	.WORD	0			; x
  10006 00F71F 00 00                        	.WORD	0
  10007 00F721 00 00                        	.WORD	0			; y
  10008 00F723 00 00                        	.WORD	0
  10009 00F725 FF 01                        	.WORD	$01FF		; sp
  10010 00F727 00 00                        	.WORD	0
  10011 00F729 00                           	.BYTE	0			; SR
  10012 00F72A 00                           	.BYTE	0			; SR extension - 832 mode
  10013 00F72B 00                           	.BYTE	0			; DB
  10014 00F72C 00 00                        	.WORD	0			; DPR
  10015 00F72E 3F 00                        	.WORD	63			; map
                                           
                                           	; task 8 (Supermon)
  10018 00F730 00 00                        	.WORD	$0			; CS
  10019 00F732 05 00                        	.WORD	$5			; DS
  10020 00F734 05 00                        	.WORD	$5			; SS
  10021 00F736 00 C0                        	.WORD	$C000		; PC
  10022 00F738 00                           	.BYTE	$00
  10023 00F739 00 00                        	.WORD	0			; acc
  10024 00F73B 00 00                        	.WORD	0
  10025 00F73D 00 00                        	.WORD	0			; x
  10026 00F73F 00 00                        	.WORD	0
  10027 00F741 00 00                        	.WORD	0			; y
  10028 00F743 00 00                        	.WORD	0
  10029 00F745 FF 2B                        	.WORD	$2BFF		; sp
  10030 00F747 00 00                        	.WORD	0
  10031 00F749 00                           	.BYTE	0			; SR
  10032 00F74A 01                           	.BYTE	1			; SR extension - 832 mode
  10033 00F74B 00                           	.BYTE	0			; DB
  10034 00F74C 00 00                        	.WORD	0			; DPR
  10035 00F74E 00 00                        	.WORD	0			; map
                                           
                                           	; task 9 (single step)
  10038 00F750 00 00                        	.WORD	0			; CS
  10039 00F752 00 00                        	.WORD	0			; DS
  10040 00F754 00 00                        	.WORD	0			; SS
  10041 00F756 74 E7                        	.WORD	SSMInit		; PC
  10042 00F758 00                           	.BYTE	SSMTnit>>16
  10043 00F759 00 00                        	.WORD	0			; acc
  10044 00F75B 00 00                        	.WORD	0
  10045 00F75D 00 00                        	.WORD	0			; x
  10046 00F75F 00 00                        	.WORD	0
  10047 00F761 00 00                        	.WORD	0			; y
  10048 00F763 00 00                        	.WORD	0
  10049 00F765 FF 33                        	.WORD	$33FF		; sp
  10050 00F767 00 00                        	.WORD	0
  10051 00F769 04                           	.BYTE	$4			; SR	16 bit regs, mask interrupts
  10052 00F76A 01                           	.BYTE	1			; SR extension - 816 mode
  10053 00F76B 00                           	.BYTE	0			; DB
  10054 00F76C 00 00                        	.WORD	0			; DPR
  10055 00F76E 00 00                        	.WORD	0
                                           
  10057 00F770                             msgRegs:
  10058 00F770 0D 0A                        	.byte	CR,LF
  10059 00F772 20 20 20 20 20 20 20 20          .byte   "             xxxsxi31",CR,LF
  10059 00F77A 20 20 20 20 20 78 78 78    
  10059 00F782 73 78 69 33 31 0D 0A       
  10060 00F789 20 20 43 53 20 20 50 42          .byte   "  CS  PB PC  xxxsxn26NVmxDIZC    .A       .X       .Y       SP  ",CR,LF,0
  10060 00F791 20 50 43 20 20 78 78 78    
  10060 00F799 73 78 6E 32 36 4E 56 6D    
  10060 00F7A1 78 44 49 5A 43 20 20 20    
  10060 00F7A9 20 2E 41 20 20 20 20 20    
  10060 00F7B1 20 20 2E 58 20 20 20 20    
  10060 00F7B9 20 20 20 2E 59 20 20 20    
  10060 00F7C1 20 20 20 20 53 50 20 20    
  10060 00F7C9 0D 0A 00                   
  10061 00F7CC                             msgRegs2:
  10062 00F7CC 0D 0A                        	.byte	CR,LF
  10063 00F7CE 20 20 53 53 20 20 20 44      	.byte	"  SS   DS  DB  DP   BL  MP",CR,LF,0
  10063 00F7D6 53 20 20 44 42 20 20 44    
  10063 00F7DE 50 20 20 20 42 4C 20 20    
  10063 00F7E6 4D 50 0D 0A 00             
  10064 00F7EB                             msgErr:
  10065 00F7EB 2A 2A 2A 45 72 72 0D 0A      	.byte	"***Err",CR,LF,0
  10065 00F7F3 00                         
                                           
                                           	cpu		FT832
                                           	MEM		32
                                           	NDX		32
  10070 00F7F4 A9 78 56 34 12               	LDA		#$12345678
  10071 00F7F9 A2 32 54 76 98               	LDX		#$98765432
  10072 00F7FE 42 8B 42 97 23               	STA.B	{$23},Y
  10073 00F803 42 BB 42 BC 56 55 45 44      	LDY.UH	$44455556,X
                                         
  10074 00F80B 42 1B 42 AB 42 BD 56 55      	LDA.H	CS:$44455556,X
  10074 00F813 45 44                      
  10075 00F815 42 3B 88 88 42 9B B9 34      	LDA.UB	SEG $8888:$1234,Y
  10075 00F81D 12                         
  10076 00F81E 42 22 00 E0 00 00 00         	JSF	    $0000:start
                                           	RTF
  10078 00F825 42 3B 21 98 7D 00 12         	ADC     SEG $9821:$1200,X
  10079 00F82C 42 3B 21 08 5D 00 12         	EOR     $821:$1200,X
  10080 00F833 42 3B 41 08 45 12            	EOR     $841:$12
  10081 00F839 42 DA 42 F7 24               	SBC     FAR {$24},Y
  10082 00F83E 42 DA 32 25                  	AND     FAR($25)
  10083 00F842 42 DA 01 26                  	ORA     FAR ($26,x)
  10084 00F846 42 A2 02 00                  	TSK		#2
  10085 00F84A 42 3A                        	TSK
  10086 00F84C 42 4C 00 00 01 00            	LDT		$10000,X
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; +---------------------------+
                                           ; | block status / ptr to free|
                                           ; +---------------------------+
                                           ; | pointer to previous block |
                                           ; +---------------------------+
                                           ; | pointer to next block     |
                                           ; +---------------------------+
                                           ;
                                           	MEM		32
                                           	NDX		32
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
  10105 00F852                             FreeSysMem:
  10106 00F852 38                           	SEC
  10107 00F853 E9 0C 00 00 00               	SBC		#12		;	backup to block header
  10108 00F858 A8                           	TAY				;	.Y = pointer to block to free (this)
  10109 00F859 08                           	PHP				; save interrupt mask
  10110 00F85A 78                           	SEI				; no interrupts
                                           	STZ		$0,Y	; set status as free
  10112 00F85B B6 08                        	LDX		$8,Y	;	.X = pointer to next block
  10113 00F85D B5 00                        	LDA		$0,X	;	.A = next->status
  10114 00F85F F0 39                        	BEQ		.0001	;	branch if not free
                                           	; merge block with next free block
  10116 00F861 B5 08                        	LDA		$8,X	;   .A = pointer to next next block
  10117 00F863 99 08 00                     	STA		$8,Y	;
  10118 00F866 AA                           	TAX
  10119 00F867 94 04                        	STY		$4,X	;	next->next->prev = this
  10120 00F869                             .0001:
                                           	; merge block with a previous free block
  10122 00F869 B6 04                        	LDX		$4,Y	;	.X = pointer to prev block
  10123 00F86B B5 00                        	LDA		$0,X	;	.A = prev->status
  10124 00F86D F0 1F                        	BEQ		.0002	;	branch if not free
  10125 00F86F B9 08 00                     	LDA		$8,Y	;   prev->next = this->next
  10126 00F872 95 08                        	STA		$8,X
  10127 00F874 A8                           	TAY				;	.Y = this->next
  10128 00F875 96 04                        	STX		$4,Y	;	this->next->prev = this->prev
  10129 00F877 9B                           	TXY
  10130 00F878                             .0002:
  10131 00F878 AD 73 F8                     	LDA		heap_free_ptr
  10132 00F87B 99 00 00                     	STA		$0,Y
  10133 00F87E 8C 73 F8                     	STY		heap_free_ptr
  10134 00F881 28                           	PLP
  10135 00F882 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	; round allocation size to mmu available sizes
                                           
  10141 00F883 A2 00 00 00 00               	LDX		#0
  10142 00F888 18                           	CLC				; add room for header
  10143 00F889 69 0C 00 00 00               	ADC		#12
  10144 00F88E                             .0002:
  10145 00F88E DD C3 F8                     	CMP		mmas,X
  10146 00F891 42 B0 D5                     	BLE		.0001
  10147 00F894 E8                           	INX
  10148 00F895 E8                           	INX
  10149 00F896 E8                           	INX
  10150 00F897 E8                           	INX
  10151 00F898 80 F4                        	BRA		.0002
  10152 00F89A                             .0001:
  10153 00F89A BD C3 F8                     	LDA		mmas,X
  10154 00F89D AA                           	TAX
  10155 00F89E AC 97 F8                     	LDY		free_heap_ptr
                                           	; subtract .Y from .A
  10157 00F8A1 38                           	SEC
  10158 00F8A2 B9 08 00                     	LDA		$8,Y
  10159 00F8A5 8C 9D F8                     	STY		tmpy
  10160 00F8A8 ED 9D F8                     	SBC		tmpy
  10161 00F8AB DD C3 F8                     	CMP		mmas,X
  10162 00F8AE 30 F5                        	BLT		.0003
                                           	; here block is big enough
  10164 00F8B0 48                           	PHA
  10165 00F8B1 B9 00 00                     	LDA		$0,Y
  10166 00F8B4 8D 97 F8                     	STA		free_heap_ptr
                                           	STZ		$0,Y
  10168 00F8B7 68                           	PLA
  10169 00F8B8 38                           	SEC
  10170 00F8B9 FD C3 F8                     	SBC		mmas,X
  10171 00F8BC C9 FF 00 00 00               	CMP		#$0FF
  10172 00F8C1 30 00                        	BLT		.0004
                                           
  10174 00F8C3                             .0004:
                                           	
                                           
                                           ; Memory management allocation sizes
                                           ;
  10179 00F8C3                             mmas:
  10180 00F8C3 00 00 00 00                  	WORD	$0000,$0000
  10181 00F8C7 FF 00 00 00                  	WORD	$00FF,$0000
  10182 00F8CB FF 03 00 00                  	WORD	$03FF,$0000
  10183 00F8CF FF 0F 00 00                  	WORD	$0FFF,$0000
  10184 00F8D3 FF 3F 00 00                  	WORD	$3FFF,$0000
  10185 00F8D7 FF FF 00 00                  	WORD	$FFFF,$0000
  10186 00F8DB FF FF 03 00                  	WORD	$FFFF,$0003
  10187 00F8DF FF FF 0F 00                  	WORD	$FFFF,$000F
  10188 00F8E3 FF FF 3F 00                  	WORD	$FFFF,$003F
  10189 00F8E7 FF FF FF 00                  	WORD	$FFFF,$00FF
  10190 00F8EB FF FF FF 03                  	WORD	$FFFF,$03FF
  10191 00F8EF FF FF FF 0F                  	WORD	$FFFF,$0FFF
  10192 00F8F3 FF FF FF 3F                  	WORD	$FFFF,$3FFF
  10193 00F8F7 FF FF FF FF                  	WORD	$FFFF,$FFFF
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	MEM		16
                                           	NDX		16
  10201 00F8FB 4C C3 F9                     	JMP		MusicPlay
  10202 00F8FE                             beep:
  10203 00F8FE A9 0F 00                     	LDA		#15					; set volume to max
  10204 00F901 42 3B FF 0F 8F B0 B0 0E      	STA		$FFF:SID+SID_VOLUME		
                                         
  10205 00F909 A9 6F 0C                     	LDA		#$0C6F				; 10C6F = 800 Hz
  10206 00F90C 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  10207 00F914 A9 01 00                     	LDA		#1
  10208 00F917 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  10209 00F91F A9 C3 00                     	LDA		#195				; 2ms
  10210 00F922 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  10211 00F92A 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  10211 00F932 0E 00                      
  10212 00F934 A9 28 09                     	LDA		#2344				; 24 ms decay
  10213 00F937 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  10214 00F93F 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  10214 00F947 0E 00                      
  10215 00F949 A9 80 00                     	LDA		#$80				; 50% sustain level
  10216 00F94C 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  10217 00F954 A9 BC BE                     	LDA		#48828				; 500 ms release
  10218 00F957 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  10219 00F95F 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  10219 00F967 0E 00                      
  10220 00F969 A9 01 00                     	LDA		#1					; reset envelope generator
  10221 00F96C 42 3B FF 0F 8F 0A B0 0E      	STA		$FFF:SID+SID_CTRL0+2
                                         
  10222 00F974 EA                           	NOP
  10223 00F975 EA                           	NOP
  10224 00F976 42 3B FF 0F 42 9C 0A B0      	STZ		$FFF:SID+SID_CTRL0+2
  10224 00F97E 0E 00                      
  10225 00F980 A9 04 15                     	LDA		#$1504				; gate on
  10226 00F983 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
                                           	; delay for about 1s
  10228 00F98B A0 27 00                     	LDY		#39
  10229 00F98E                             .0002:
  10230 00F98E A2 FF FF                     	LDX		#65535
  10231 00F991                             .0001:
  10232 00F991 CA                           	DEX
  10233 00F992 D0 FD                        	BNE		.0001
  10234 00F994 88                           	DEY
  10235 00F995 D0 F7                        	BNE		.0002
  10236 00F997 A9 04 05                     	LDA		#$0504				; gate off
  10237 00F99A 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10238 00F9A2 60                           	RTS
  10239 00F9A3                             	
  10240 00F9A3 01 00                        	dh	1
  10241 00F9A5 89 83                        	dw	33673		; G4
  10242 00F9A7 0C 00                        	dw	12			; 1/8 sec
  10243 00F9A9 04 00                        	dw	4			; space
                                           
  10245 00F9AB 01 00                        	dh	1
  10246 00F9AD 89 83                        	dw	33673		; G4
  10247 00F9AF 0C 00                        	dw	12			; 1/8
  10248 00F9B1 04 00                        	dw	4			; space
                                           
  10250 00F9B3 01 00                        	dh	1
  10251 00F9B5 89 83                        	dw	33673		; G4
  10252 00F9B7 0C 00                        	dw	12			; 1/8
  10253 00F9B9 04 00                        	dw	4			; space
                                           
  10255 00F9BB 00 00                        	dh	0
  10256 00F9BD 00 00                        	dw	0			; G4
  10257 00F9BF 00 00                        	dw	0			; 1/8
  10258 00F9C1 00 00                        	dw	0			; space
                                           
  10260 00F9C3                             MusicPlay:
  10261 00F9C3 A2 00 00                     	LDX		#0
  10262 00F9C6 A9 C3 00                     	LDA		#195				; 2ms
  10263 00F9C9 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  10264 00F9D1 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  10264 00F9D9 0E 00                      
  10265 00F9DB A9 28 09                     	LDA		#2344				; 24 ms decay
  10266 00F9DE 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  10267 00F9E6 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  10267 00F9EE 0E 00                      
  10268 00F9F0 A9 D0 00                     	LDA		#$D0				; sustain level
  10269 00F9F3 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  10270 00F9FB A9 F8 11                     	LDA		#4600				; ??? ms release
  10271 00F9FE 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  10272 00FA06 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  10272 00FA0E 0E 00                      
  10273 00FA10                             .0001:
  10274 00FA10 BD A3 F9                     	LDA		music_tbl,x			; check for last note
  10275 00FA13 F0 56                        	BEQ		.xit
  10276 00FA15 BD A5 F9                     	LDA		music_tbl+2,x			; set the frequency
  10277 00FA18 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  10278 00FA20 BD A7 F9                     	LDA		music_tbl+4,x
  10279 00FA23 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  10280 00FA2B A9 04 15                     	LDA		#$1504				; gate on
  10281 00FA2E 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10282 00FA36 78                           	SEI
  10283 00FA37 BD A9 F9                     	LDA		music_tbl+6,x
  10284 00FA3A 8D 04 01                     	STA		timeout1
  10285 00FA3D BD AB F9                     	LDA		music_tbl+8,x
  10286 00FA40 8D 06 01                     	STA		timeout1+2
  10287 00FA43 20 6C FA                     	JSR		MusicWaitTimeout
  10288 00FA46 A9 04 05                     	LDA		#$0504				; gate off
  10289 00FA49 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10290 00FA51 78                           	SEI
  10291 00FA52 BD AD F9                     	LDA		music_tbl+10,x		; note release delay
  10292 00FA55 8D 04 01                     	STA		timeout1
  10293 00FA58 BD AF F9                     	LDA		music_tbl+12,x
  10294 00FA5B 8D 06 01                     	STA		timeout1+2
  10295 00FA5E 20 6C FA                     	JSR		MusicWaitTimeout
  10296 00FA61 E8                           	INX
  10297 00FA62 E8                           	INX
  10298 00FA63 42 E8                        	INX4
  10299 00FA65 42 E8                        	INX4
  10300 00FA67 42 E8                        	INX4
  10301 00FA69 80 A5                        	BRA		.0001
  10302 00FA6B                             .xit:
  10303 00FA6B 60                           	RTS
                                           
  10305 00FA6C                             MusicWaitTimeout:
  10306 00FA6C                             .0001:
  10307 00FA6C 58                           	CLI
  10308 00FA6D EA                           	NOP
  10309 00FA6E EA                           	NOP
  10310 00FA6F 78                           	SEI
  10311 00FA70 AD 04 01                     	LDA		timeout1
  10312 00FA73 0D 06 01                     	ORA		timeout1+2
  10313 00FA76 D0 F4                        	BNE		.0001
  10314 00FA78 58                           	CLI
  10315 00FA79 60                           	RTS
                                           
  10317 00FA7A                             MusicTimeoutIRQ:
  10318 00FA7A C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
  10321 00FA7C AD 04 01                     	LDA		timeout1
  10322 00FA7F 0D 06 01                     	ORA		timeout1+2
  10323 00FA82 F0 13                        	BEQ		.0001
  10324 00FA84 38                           	SEC
  10325 00FA85 AD 04 01                     	LDA		timeout1
  10326 00FA88 E9 01 00                     	SBC		#1
  10327 00FA8B 8D 04 01                     	STA		timeout1
  10328 00FA8E AD 06 01                     	LDA		timeout1+2
  10329 00FA91 E9 00 00                     	SBC		#0
  10330 00FA94 8D 06 01                     	STA		timeout1+2
  10331 00FA97                             .0001:
  10332 00FA97 60                           	RTS
                                           
  10334 00FA98 FF FF FF FF FF FF FF FF      	.org	$FE00
  10334 00FAA0 FF FF FF FF FF FF FF FF    
  10334 00FAA8 FF FF FF FF FF FF FF FF    
  10334 00FAB0 FF FF FF FF FF FF FF FF    
  10334 00FAB8 FF FF FF FF FF FF FF FF    
  10334 00FAC0 FF FF FF FF FF FF FF FF    
  10334 00FAC8 FF FF FF FF FF FF FF FF    
  10334 00FAD0 FF FF FF FF FF FF FF FF    
  10334 00FAD8 FF FF FF FF FF FF FF FF    
  10334 00FAE0 FF FF FF FF FF FF FF FF    
  10334 00FAE8 FF FF FF FF FF FF FF FF    
  10334 00FAF0 FF FF FF FF FF FF FF FF    
  10334 00FAF8 FF FF FF FF FF FF FF FF    
  10334 00FB00 FF FF FF FF FF FF FF FF    
  10334 00FB08 FF FF FF FF FF FF FF FF    
  10334 00FB10 FF FF FF FF FF FF FF FF    
  10334 00FB18 FF FF FF FF FF FF FF FF    
  10334 00FB20 FF FF FF FF FF FF FF FF    
  10334 00FB28 FF FF FF FF FF FF FF FF    
  10334 00FB30 FF FF FF FF FF FF FF FF    
  10334 00FB38 FF FF FF FF FF FF FF FF    
  10334 00FB40 FF FF FF FF FF FF FF FF    
  10334 00FB48 FF FF FF FF FF FF FF FF    
  10334 00FB50 FF FF FF FF FF FF FF FF    
  10334 00FB58 FF FF FF FF FF FF FF FF    
  10334 00FB60 FF FF FF FF FF FF FF FF    
  10334 00FB68 FF FF FF FF FF FF FF FF    
  10334 00FB70 FF FF FF FF FF FF FF FF    
  10334 00FB78 FF FF FF FF FF FF FF FF    
  10334 00FB80 FF FF FF FF FF FF FF FF    
  10334 00FB88 FF FF FF FF FF FF FF FF    
  10334 00FB90 FF FF FF FF FF FF FF FF    
  10334 00FB98 FF FF FF FF FF FF FF FF    
  10334 00FBA0 FF FF FF FF FF FF FF FF    
  10334 00FBA8 FF FF FF FF FF FF FF FF    
  10334 00FBB0 FF FF FF FF FF FF FF FF    
  10334 00FBB8 FF FF FF FF FF FF FF FF    
  10334 00FBC0 FF FF FF FF FF FF FF FF    
  10334 00FBC8 FF FF FF FF FF FF FF FF    
  10334 00FBD0 FF FF FF FF FF FF FF FF    
  10334 00FBD8 FF FF FF FF FF FF FF FF    
  10334 00FBE0 FF FF FF FF FF FF FF FF    
  10334 00FBE8 FF FF FF FF FF FF FF FF    
  10334 00FBF0 FF FF FF FF FF FF FF FF    
  10334 00FBF8 FF FF FF FF FF FF FF FF    
  10334 00FC00 FF FF FF FF FF FF FF FF    
  10334 00FC08 FF FF FF FF FF FF FF FF    
  10334 00FC10 FF FF FF FF FF FF FF FF    
  10334 00FC18 FF FF FF FF FF FF FF FF    
  10334 00FC20 FF FF FF FF FF FF FF FF    
  10334 00FC28 FF FF FF FF FF FF FF FF    
  10334 00FC30 FF FF FF FF FF FF FF FF    
  10334 00FC38 FF FF FF FF FF FF FF FF    
  10334 00FC40 FF FF FF FF FF FF FF FF    
  10334 00FC48 FF FF FF FF FF FF FF FF    
  10334 00FC50 FF FF FF FF FF FF FF FF    
  10334 00FC58 FF FF FF FF FF FF FF FF    
  10334 00FC60 FF FF FF FF FF FF FF FF    
  10334 00FC68 FF FF FF FF FF FF FF FF    
  10334 00FC70 FF FF FF FF FF FF FF FF    
  10334 00FC78 FF FF FF FF FF FF FF FF    
  10334 00FC80 FF FF FF FF FF FF FF FF    
  10334 00FC88 FF FF FF FF FF FF FF FF    
  10334 00FC90 FF FF FF FF FF FF FF FF    
  10334 00FC98 FF FF FF FF FF FF FF FF    
  10334 00FCA0 FF FF FF FF FF FF FF FF    
  10334 00FCA8 FF FF FF FF FF FF FF FF    
  10334 00FCB0 FF FF FF FF FF FF FF FF    
  10334 00FCB8 FF FF FF FF FF FF FF FF    
  10334 00FCC0 FF FF FF FF FF FF FF FF    
  10334 00FCC8 FF FF FF FF FF FF FF FF    
  10334 00FCD0 FF FF FF FF FF FF FF FF    
  10334 00FCD8 FF FF FF FF FF FF FF FF    
  10334 00FCE0 FF FF FF FF FF FF FF FF    
  10334 00FCE8 FF FF FF FF FF FF FF FF    
  10334 00FCF0 FF FF FF FF FF FF FF FF    
  10334 00FCF8 FF FF FF FF FF FF FF FF    
  10334 00FD00 FF FF FF FF FF FF FF FF    
  10334 00FD08 FF FF FF FF FF FF FF FF    
  10334 00FD10 FF FF FF FF FF FF FF FF    
  10334 00FD18 FF FF FF FF FF FF FF FF    
  10334 00FD20 FF FF FF FF FF FF FF FF    
  10334 00FD28 FF FF FF FF FF FF FF FF    
  10334 00FD30 FF FF FF FF FF FF FF FF    
  10334 00FD38 FF FF FF FF FF FF FF FF    
  10334 00FD40 FF FF FF FF FF FF FF FF    
  10334 00FD48 FF FF FF FF FF FF FF FF    
  10334 00FD50 FF FF FF FF FF FF FF FF    
  10334 00FD58 FF FF FF FF FF FF FF FF    
  10334 00FD60 FF FF FF FF FF FF FF FF    
  10334 00FD68 FF FF FF FF FF FF FF FF    
  10334 00FD70 FF FF FF FF FF FF FF FF    
  10334 00FD78 FF FF FF FF FF FF FF FF    
  10334 00FD80 FF FF FF FF FF FF FF FF    
  10334 00FD88 FF FF FF FF FF FF FF FF    
  10334 00FD90 FF FF FF FF FF FF FF FF    
  10334 00FD98 FF FF FF FF FF FF FF FF    
  10334 00FDA0 FF FF FF FF FF FF FF FF    
  10334 00FDA8 FF FF FF FF FF FF FF FF    
  10334 00FDB0 FF FF FF FF FF FF FF FF    
  10334 00FDB8 FF FF FF FF FF FF FF FF    
  10334 00FDC0 FF FF FF FF FF FF FF FF    
  10334 00FDC8 FF FF FF FF FF FF FF FF    
  10334 00FDD0 FF FF FF FF FF FF FF FF    
  10334 00FDD8 FF FF FF FF FF FF FF FF    
  10334 00FDE0 FF FF FF FF FF FF FF FF    
  10334 00FDE8 FF FF FF FF FF FF FF FF    
  10334 00FDF0 FF FF FF FF FF FF FF FF    
  10334 00FDF8 FF FF FF FF FF FF FF FF    
                                         
  10335 00FE00 4C 8E F4                     	JMP		SuperGetch
  10336 00FE03 4C C3 F4                     	JMP		warm_start
  10337 00FE06 4C 9A F4                     	JMP		SuperPutch
  10338 00FE09 4C F3 E6                     	JMP		BIOSInput
  10339 00FE0C 4C A3 F4                     	JMP		BasicGetch
  10340 00FE0F 4C B7 F4                     	JMP		xitBasic
                                           
  10342 00FE12 FF FF FF FF FF FF FF FF      	.org 	$FFD6
  10342 00FE1A FF FF FF FF FF FF FF FF    
  10342 00FE22 FF FF FF FF FF FF FF FF    
  10342 00FE2A FF FF FF FF FF FF FF FF    
  10342 00FE32 FF FF FF FF FF FF FF FF    
  10342 00FE3A FF FF FF FF FF FF FF FF    
  10342 00FE42 FF FF FF FF FF FF FF FF    
  10342 00FE4A FF FF FF FF FF FF FF FF    
  10342 00FE52 FF FF FF FF FF FF FF FF    
  10342 00FE5A FF FF FF FF FF FF FF FF    
  10342 00FE62 FF FF FF FF FF FF FF FF    
  10342 00FE6A FF FF FF FF FF FF FF FF    
  10342 00FE72 FF FF FF FF FF FF FF FF    
  10342 00FE7A FF FF FF FF FF FF FF FF    
  10342 00FE82 FF FF FF FF FF FF FF FF    
  10342 00FE8A FF FF FF FF FF FF FF FF    
  10342 00FE92 FF FF FF FF FF FF FF FF    
  10342 00FE9A FF FF FF FF FF FF FF FF    
  10342 00FEA2 FF FF FF FF FF FF FF FF    
  10342 00FEAA FF FF FF FF FF FF FF FF    
  10342 00FEB2 FF FF FF FF FF FF FF FF    
  10342 00FEBA FF FF FF FF FF FF FF FF    
  10342 00FEC2 FF FF FF FF FF FF FF FF    
  10342 00FECA FF FF FF FF FF FF FF FF    
  10342 00FED2 FF FF FF FF FF FF FF FF    
  10342 00FEDA FF FF FF FF FF FF FF FF    
  10342 00FEE2 FF FF FF FF FF FF FF FF    
  10342 00FEEA FF FF FF FF FF FF FF FF    
  10342 00FEF2 FF FF FF FF FF FF FF FF    
  10342 00FEFA FF FF FF FF FF FF FF FF    
  10342 00FF02 FF FF FF FF FF FF FF FF    
  10342 00FF0A FF FF FF FF FF FF FF FF    
  10342 00FF12 FF FF FF FF FF FF FF FF    
  10342 00FF1A FF FF FF FF FF FF FF FF    
  10342 00FF22 FF FF FF FF FF FF FF FF    
  10342 00FF2A FF FF FF FF FF FF FF FF    
  10342 00FF32 FF FF FF FF FF FF FF FF    
  10342 00FF3A FF FF FF FF FF FF FF FF    
  10342 00FF42 FF FF FF FF FF FF FF FF    
  10342 00FF4A FF FF FF FF FF FF FF FF    
  10342 00FF52 FF FF FF FF FF FF FF FF    
  10342 00FF5A FF FF FF FF FF FF FF FF    
  10342 00FF62 FF FF FF FF FF FF FF FF    
  10342 00FF6A FF FF FF FF FF FF FF FF    
  10342 00FF72 FF FF FF FF FF FF FF FF    
  10342 00FF7A FF FF FF FF FF FF FF FF    
  10342 00FF82 FF FF FF FF FF FF FF FF    
  10342 00FF8A FF FF FF FF FF FF FF FF    
  10342 00FF92 FF FF FF FF FF FF FF FF    
  10342 00FF9A FF FF FF FF FF FF FF FF    
  10342 00FFA2 FF FF FF FF FF FF FF FF    
  10342 00FFAA FF FF FF FF FF FF FF FF    
  10342 00FFB2 FF FF FF FF FF FF FF FF    
  10342 00FFBA FF FF FF FF FF FF FF FF    
  10342 00FFC2 FF FF FF FF FF FF FF FF    
  10342 00FFCA FF FF FF FF FF FF FF FF    
  10342 00FFD2 FF FF FF FF                
  10343 00FFD6 04 00                        	dw		4			; task #4
                                           
  10345 00FFD8 FF FF FF FF FF FF            	.org	$FFDE
  10346 00FFDE 06 00                        	dw		6			; task #6
                                           
                                           	.org	$FFE0
  10349 00FFE0 03 00                        	dw		3
                                           
  10351 00FFE2 FF FF FF FF                  	.org 	$FFE6
  10352 00FFE6 BB F5                        	dw		BrkRout
                                           
  10354 00FFE8 FF FF FF FF FF FF            	.org	$FFEE		; '816 IRQ vector
  10355 00FFEE 01 00                        	dw		1			; IRQRout816
                                           
  10357 00FFF0 FF FF FF FF FF FF FF FF      	.org	$FFFC
  10357 00FFF8 FF FF FF FF                
  10358 00FFFC 00 E0                        	dw		$E000
                                           
                                           	.org	$FFFE
  10361 00FFFE 01 00                        	dw		1			; IRQRout02

Checksum=F7026D4E

Number of instructions processed: 4395
Number of opcode bytes: 10103
Bytes per instruction: 2.298749 (18.389989 bits)
Clock cycle count: 5417
Clocks per instruction: 1.232537

The above statistics are only estimates.

	The CPI assumes data memory access requires two clock cycles and instruction
	access is single cycle. The actual CPI may be higher if there are memory wait 
	states, or lower if data is found in the cache.
