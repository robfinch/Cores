Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
FTBios816.asm

                                        ; ============================================================================
                                        ; FTBios816.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014-2017  Robert Finch, Waterloo
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
     25 = 000000000000000D                            CR			EQU		13
     26 = 000000000000000A                            LF			EQU		10
     27 = 000000000000001B                            ESC			EQU		$1B
     28 = 0000000000000008                            BS			EQU		8
     29 = 0000000000000003                            CTRLC		EQU		3
                                        
     31 = 0000000000000012                            SC_LSHIFT	EQU		$12
     32 = 0000000000000059                            SC_RSHIFT	EQU		$59
     33 = 00000000000000F0                            SC_KEYUP	EQU		$F0
     34 = 00000000000000E0                            SC_EXTEND	EQU		$E0
     35 = 0000000000000014                            SC_CTRL		EQU		$14
     36 = 0000000000000011                            SC_ALT		EQU		$11
     37 = 0000000000000071                            SC_DEL		EQU		$71		; extend
     38 = 0000000000000058                            SC_LCTRL	EQU		$58
     39 = 0000000000000077                            SC_NUMLOCK	EQU		$77
     40 = 000000000000007E                            SC_SCROLLLOCK	EQU	$7E
     41 = 0000000000000058                            SC_CAPSLOCK	EQU		$58
                                        
     43 = 000000000000001F                            TEXTROWS	EQU		31
     44 = 0000000000000054                            TEXTCOLS	EQU		84
                                        
     46 = 0000000000000004                            TickCount	EQU		$4
     47 = 0000000000000008                            KeyState1	EQU		$8
     48 = 0000000000000009                            KeyState2	EQU		$9
     49 = 000000000000000A                            KeybdLEDs	EQU		$A
     50 = 000000000000000B                            KeybdWaitFlag	EQU	$B
     51 = 000000000000000C                            NumWorkArea	EQU		$C
                                        
                                        ; Range $10 to $1F reserved for hardware counters
     54 = 0000000000000010                            CNT0L		EQU		$10
     55 = 0000000000000011                            CNT0M		EQU		$11
     56 = 0000000000000012                            CNT0H		EQU		$12
     57 = 0000000000000020                            RangeStart	EQU		$20
     58 = 0000000000000024                            RangeEnd	EQU		$24
     59 = 0000000000000030                            CursorX		EQU		$30
     60 = 0000000000000032                            CursorY		EQU		$32
     61 = 0000000000000034                            VideoPos	EQU		$34
     62 = 0000000000000036                            NormAttr	EQU		$36
     63 = 0000000000000038                            StringPos	EQU		$38
     64 = 000000000000003C                            EscState	EQU		$3C
     65 = 0000000000000040                            Vidptr		EQU		$40
     66 = 0000000000000046                            Vidregs		EQU		$46
     67 = 000000000000004C                            Textcols	EQU		$4C
     68 = 000000000000004E                            Textrows	EQU		$4E
                                        
     70 = 0000000000000080                            reg_cs		EQU		$80
     71 = 00000084                      reg_ds		EQU		reg_cs + 4
     72 = 00000088                      reg_ss		EQU		reg_ds + 4
     73 = 0000008C                      reg_pc		EQU		reg_ss + 4
     74 = 00000090                      reg_a		EQU		reg_pc + 4
     75 = 00000094                      reg_x		EQU		reg_a + 4
     76 = 00000098                      reg_y		EQU		reg_x + 4
     77 = 0000009C                      reg_sp		EQU		reg_y + 4
     78 = 000000A0                      reg_sr		EQU		reg_sp + 4
     79 = 000000A4                      reg_db		EQU		reg_sr + 4
     80 = 000000A8                      reg_dp		EQU		reg_db + 4
     81 = 000000AC                      reg_bl		EQU		reg_dp + 4
     82 = 000000B0                      reg_mp		EQU		reg_bl + 4
                                        
     84 = 0000000000000080                            cs_save		EQU		$80
     85 = 0000000000000084                            ds_save		EQU		$84
     86 = 0000000000000088                            pc_save		EQU		$88
     87 = 000000000000008C                            pb_save		EQU		$8C
     88 = 0000000000000090                            acc_save	EQU		$90
     89 = 0000000000000094                            x_save		EQU		$94
     90 = 0000000000000098                            y_save		EQU		$98
     91 = 000000000000009C                            sp_save		EQU		$9C
     92 = 00000000000000A0                            sr_save		EQU		$A0
     93 = 00000000000000A4                            srx_save	EQU		$A4
     94 = 00000000000000A8                            db_save		EQU		$A8
     95 = 00000000000000AC                            dpr_save	EQU		$AC
                                        
                                        ;running_task	EQU		$B8
                                        
     99 = 00000000000000BA                            keybd_char	EQU		$BA
    100 = 00000000000000BA                            rw_flag		EQU		$BA
    101 = 00000000000000BC                            keybd_cmd	EQU		$BC
    102 = 00000000000000BE                            WorkTR		EQU		$BE
    103 = 00000000000000C0                            ExitCode	EQU		$C0
    104 = 00000000000000C4                            secnum		EQU		$C4
    105 = 00000000000000C8                            bufptr		EQU		$C8
    106 = 00000000000000CC                            qcnt		EQU		$CC
    107 = 00000000000000CE                            IOFocusTask	EQU		$CE
    108 = 00000000000000D0                            TaskSwitchEn	EQU	$D0
    109 = 00000000000000D2                            TimeoutList	EQU		$D2
    110 = 0000000000000100                            ldtrec		EQU		$100
    111 = 0000000000000104                            timeout1	EQU		$104
                                        
    113 = 0000000000000300                            RTCBuf		EQU		$300
    114 = 00000000000003F0                            OutputVec	EQU		$03F0
                                        
    116 = 000000000000B000                            PCS0		EQU		$B000
    117 = 0000B002                      PCS1		EQU		PCS0 + 2
    118 = 0000B004                      PCS2		EQU		PCS1 + 2
    119 = 0000B006                      PCS3		EQU		PCS2 + 2
    120 = 0000B008                      PCS4	    EQU		PCS3 + 2
    121 = 0000B00A                      PCS5		EQU		PCS4 + 2
    122 = 0000B010                      CTR0_LMT	EQU		PCS0 + 16
    123 = 0000B013                      CTR0_CTRL	EQU		CTR0_LMT + 3
    124 = 0000B014                      CTR1_LMT	EQU		CTR0_CTRL + 1
    125 = 0000B017                      CTR1_CTRL	EQU		CTR1_LMT + 3
    126 = 000000000000B01F                            MPU_IRQ_STATUS	EQU		$B01F
                                        
    128 = 00000000000D0000                            VIDBUF		EQU		$D0000		; FD0000
    129 = 00000000000EA000                            VIDREGS		EQU		$EA000
    130 = 00000000000EA100                            PRNG		EQU		$EA100
    131 = 00000000000EA110                            KEYBD		EQU		$EA110
    132 = 00000000000EA200                            FAC1		EQU		$EA200
                                        
    134 = 0000000000FEC000                            SPIMASTER	EQU		$00FEC000
    135 = 00FEC000                      SPI_MASTER_VERSION_REG	EQU	SPIMASTER+$00
    136 = 00FEC001                      SPI_MASTER_CONTROL_REG	EQU	SPIMASTER+$01
    137 = 00FEC002                      SPI_TRANS_TYPE_REG	EQU		SPIMASTER+$02
    138 = 00FEC003                      SPI_TRANS_CTRL_REG	EQU		SPIMASTER+$03
    139 = 00FEC004                      SPI_TRANS_STATUS_REG	EQU	SPIMASTER+$04
    140 = 00FEC005                      SPI_TRANS_ERROR_REG		EQU	SPIMASTER+$05
    141 = 00FEC006                      SPI_DIRECT_ACCESS_DATA_REG		EQU	SPIMASTER+$06
    142 = 00FEC007                      SPI_SD_SECT_7_0_REG		EQU	SPIMASTER+$07
    143 = 00FEC008                      SPI_SD_SECT_15_8_REG	EQU	SPIMASTER+$08
    144 = 00FEC009                      SPI_SD_SECT_23_16_REG	EQU	SPIMASTER+$09
    145 = 00FEC00A                      SPI_SD_SECT_31_24_REG	EQU	SPIMASTER+$0A
    146 = 00FEC010                      SPI_RX_FIFO_DATA_REG	EQU	SPIMASTER+$10
    147 = 00FEC011                      SPI_RX_FIFO_DATA_COUNT_MSB	EQU	SPIMASTER+$11
    148 = 00FEC012                      SPI_RX_FIFO_DATA_COUNT_LSB  EQU SPIMASTER+$12
    149 = 00FEC014                      SPI_RX_FIFO_CTRL_REG		EQU	SPIMASTER+$14
    150 = 00FEC020                      SPI_TX_FIFO_DATA_REG	EQU	SPIMASTER+$20
    151 = 00FEC024                      SPI_TX_FIFO_CTRL_REG	EQU	SPIMASTER+$24
    152 = 00FEC030                      SPI_RESP_BYTE1			EQU	SPIMASTER+$30
    153 = 00FEC031                      SPI_RESP_BYTE2			EQU	SPIMASTER+$31
    154 = 00FEC032                      SPI_RESP_BYTE3			EQU	SPIMASTER+$32
    155 = 00FEC033                      SPI_RESP_BYTE4			EQU	SPIMASTER+$33
                                        
    157 = 0000000000000001                            SPI_INIT_SD			EQU		$01
    158 = 0000000000000001                            SPI_TRANS_START		EQU		$01
    159 = 0000000000000001                            SPI_TRANS_BUSY		EQU		$01
    160 = 0000000000000000                            SPI_INIT_NO_ERROR	EQU		$00
    161 = 0000000000000000                            SPI_READ_NO_ERROR	EQU		$00
    162 = 0000000000000000                            SPI_WRITE_NO_ERROR	EQU		$00
    163 = 0000000000000002                            SPI_RW_READ_SD_BLOCK	EQU		$02
    164 = 0000000000000003                            SPI_RW_WRITE_SD_BLOCK	EQU		$03
                                        
    166 = 0000000000FEC100                            I2C_MASTER		EQU		$00FEC100
    167 = 00FEC100                      I2C_PRESCALE_LO	EQU		I2C_MASTER+$00
    168 = 00FEC101                      I2C_PRESCALE_HI	EQU		I2C_MASTER+$01
    169 = 00FEC102                      I2C_CONTROL		EQU		I2C_MASTER+$02
    170 = 00FEC103                      I2C_TX			EQU		I2C_MASTER+$03
    171 = 00FEC103                      I2C_RX			EQU		I2C_MASTER+$03
    172 = 00FEC104                      I2C_CMD			EQU		I2C_MASTER+$04
    173 = 00FEC104                      I2C_STAT		EQU		I2C_MASTER+$04
                                        
    175 = 0000000000FEC200                            READY_FIFO		EQU		$00FEC200
    176 = 0000000000FEC210                            READY_FIFO_CNT	EQU		$00FEC210
    177 = 0000000000FEC300                            TIMEOUT_LIST	EQU		$00FEC300
                                        
    179 = 00000000000EB000                            SID			EQU		$EB000		; FEB000
    180 = 0000000000000000                            SID_FREQ0		EQU		$00
    181 = 0000000000000004                            SID_PW0			EQU		$04
    182 = 0000000000000008                            SID_CTRL0		EQU		$08
    183 = 000000000000000C                            SID_ATTACK0		EQU		$0C
    184 = 0000000000000010                            SID_DECAY0		EQU		$10
    185 = 0000000000000014                            SID_SUSTAIN0	EQU		$14
    186 = 0000000000000018                            SID_RELEASE0	EQU		$18
    187 = 000000000000001C                            SID_WADR0		EQU		$1C
    188 = 00000000000000B0                            SID_VOLUME		EQU		$B0
                                        
    190 = 0000000000007868                            do_invaders			EQU		$7868
                                        
    192 = 0000000000000001                            TS_READY		EQU		1
                                        
    194 = 0000000000020000                            TCB_Next		EQU		$20000	; 2 byte handles
    195 = 0000000000020400                            TCB_Prev		EQU		$20400	; 2 byte handles
    196 = 0000000000020800                            TCB_Timeout		EQU		$20800	; 4 byte value
    197 = 0000000000021000                            TCB_mbq_next	EQU		$21000	; 2 byte handles
    198 = 0000000000021400                            TCB_mbq_prev	EQU		$21400	; 2 byte handles
    199 = 0000000000021800                            TCB_msg_d1		EQU		$21800	; 4 byte value
    200 = 0000000000022000                            TCB_msg_d2		EQU		$22000	; 4 byte value
    201 = 0000000000022800                            TCB_msg_d3		EQU		$22800	; 4 byte value
    202 = 0000000000023000                            TCB_msg_tgtadr	EQU		$23000	; 2 byte handle
    203 = 0000000000023400                            TCB_msg_retadr	EQU		$23400	; 2 byte handle
    204 = 0000000000023800                            TCB_msg_link	EQU		$23800	; 2 byte handle
    205 = 0000000000023C00                            TCB_msg_type	EQU		$23C00	; 2 byte value
    206 = 0000000000024000                            TCB_hMbx1		EQU		$24000	; 2 byte handle
    207 = 0000000000024400                            TCB_hMbx2		EQU		$24400	; 2 byte handle
    208 = 0000000000024800                            TCB_hMbx3		EQU		$24800	; 2 byte handle
    209 = 0000000000024C00                            TCB_hMbx4		EQU		$24C00	; 2 byte handle
    210 = 0000000000025000                            TCB_hWaitMbx	EQU		$25000	; 2 byte handle
    211 = 0000000000025400                            TCB_number		EQU		$25400	; 2 byte value
    212 = 0000000000025800                            TCB_priority	EQU		$25800	; 1 byte value
    213 = 0000000000025A00                            TCB_status		EQU		$25A00	; 1 byte value
    214 = 0000000000025C00                            TCB_affinity	EQU		$25C00	; 1 byte value
    215 = 0000000000025E00                            TCB_hJob		EQU		$25E00	; 1 byte handle
    216 = 0000000000026000                            TCB_start_tick	EQU		$26000	; 4 byte value
    217 = 0000000000026800                            TCB_end_tick	EQU		$26800	; 4 byte value
    218 = 0000000000027000                            TCB_ticks		EQU		$27000	; 4 byte value
    219 = 0000000000027800                            TCB_exception	EQU		$27800	; 4 byte value
                                        
    221 = 000000000002FFFE                            running_task	EQU		$2FFFE
                                        
    223 = 000000000002C000                            MSG_d1		EQU		$2C000	; 4 byte value	( 4096 messages )
    224 = 0000000000030000                            MSG_d2		EQU		$30000	; 4 byte value
    225 = 0000000000034000                            MSG_d3		EQU		$34000	; 4 byte value
    226 = 0000000000038000                            MSG_tgtadr	EQU		$38000	; 2 byte handle
    227 = 000000000003A000                            MSG_retadr	EQU		$3A000	; 2 byte handle
    228 = 000000000003C000                            MSG_link	EQU		$3C000	; 2 byte handle
    229 = 000000000003E000                            MSG_type	EQU		$3E000	; 2 byte value
                                        
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
supermon832.asm

                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;	.opt proc65c02,caseinsensitive
                                        	cpu	W65C02
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;*                                                                                 *
                                        ;*      SUPERMON 816 MACHINE LANGUAGE MONITOR FOR THE W65C816S MICROPROCESSOR      *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;*      Copyright ©1991-2014 by BCS Technology Limited.  All rights reserved.      *
                                        ;*                                                                                 *
                                        ;* Permission is hereby granted to use, copy, modify and distribute this software, *
                                        ;* provided this copyright notice remains in the source code and  proper  attribu- *
                                        ;* tion is given.  Redistribution, regardless of form, must be at no charge to the *
                                        ;* end  user.  This code or any part thereof, including any derivation, MAY NOT be *
                                        ;* incorporated into any package intended for sale,  unless written permission has * 
                                        ;* been given by the copyright holder.                                             *
                                        ;*                                                                                 *
                                        ;* THERE IS NO WARRANTY OF ANY KIND WITH THIS SOFTWARE.  The user assumes all risk *
                                        ;* in connection with the incorporation of this software into any system.          *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a salute to Jim Butterfield, who passed away on June 29, 2007.  *
                                        ;*                                                                                 *
                                        ;* Jim, who was the unofficial  spokesman for  Commodore  International during the *  
                                        ;* heyday of the company's 8 bit supremacy, scratch-developed the Supermon machine *
                                        ;* language monitor for the PET & CBM computers.   When the best-selling Commodore *
                                        ;* 64 was introduced, Jim adapted his software to the new machine & gave the adap- *
                                        ;* tation the name Supermon 64.   Commodore  subsequently  integrated a customized *
                                        ;* version of Supermon 64 into the C-128 to act as the resident M/L monitor.       *
                                        ;*                                                                                 *
                                        ;* Although Supermon 816 is not an adaptation of Supermon 64,  it was  decided  to *
                                        ;* keep the Supermon name alive, since Supermon 816's general operation & user in- *
                                        ;* terface is similar to that of Supermon 64.   Supermon 816 is 100 percent native *
                                        ;* mode 65C816 code & was developed from a blank canvas.                           *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* This version customized for the RTF65002 test system                            *
                                        ;* Finitron.ca                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a full featured monitor and supports the following operations:  *
                                        ;*                                                                                 *
                                        ;*     A — Assemble code                                                           *
                                        ;*     C — Compare memory regions                                                  *
                                        ;*     D — Disassemble code                                                        *
                                        ;*     F — Fill memory region (cannot span banks)                                  *
                                        ;*     G — Execute code (stops at BRK)                                             *
                                        ;*     H — Search (hunt) memory region                                             *
                                        ;*     J — Execute code as a subroutine (stops at BRK or RTS)                      *
                                        ;*     M — Dump & display memory range                                             *
                                        ;*     R — Dump & display 65C816 registers                                         *
                                        ;*     T — Copy (transfer) memory region                                           *
                                        ;*     X — Exit Supermon 816 & return to operating environment                     *
                                        ;*     > — Modify up to 32 bytes of memory                                         *
                                        ;*     ; — Modify 65C816 registers                                                 *
                                        ;*                                                                                 *
                                        ;* Supermon 816 accepts binary (%), octal (@), decimal (+) and hexadecimal ($) as  *
                                        ;* input for numeric parameters.  Additionally, the H and > operations accept an   *
                                        ;* ASCII string in place of numeric values by preceding the string with ', e.g.:   *
                                        ;*                                                                                 *
                                        ;*     h 042000 042FFF 'BCS Technology Limited                                     *
                                        ;*                                                                                 *
                                        ;* If no radix symbol is entered hex is assumed.                                   *
                                        ;*                                                                                 *
                                        ;* Numeric conversion is also available.  For example, typing:                     *
                                        ;*                                                                                 *
                                        ;*     +1234567 <CR>                                                               *
                                        ;*                                                                                 *
                                        ;* will display:                                                                   *
                                        ;*                                                                                 *
                                        ;*         $12D687                                                                 *
                                        ;*         +1234567                                                                *
                                        ;*         @04553207                                                               *
                                        ;*         %100101101011010000111                                                  *
                                        ;*                                                                                 *
                                        ;* In the above example, <CR> means the console keyboard's return or enter key.    *
                                        ;*                                                                                 *
                                        ;* All numeric values are internally processed as 32 bit unsigned integers.  Addr- *
                                        ;* esses may be entered as 8, 16 or 24 bit values.  During instruction assembly,   *
                                        ;* immediate mode operands may be forced to 16 bits by preceding the operand with  *
                                        ;* an exclamation point if the instruction can accept a 16 bit operand, e.g.:      *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 lda !#4                                                            *
                                        ;*                                                                                 *
                                        ;* The above will assemble as:                                                     *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A9 04 00     LDA #$0004                                           *
                                        ;*                                                                                 *
                                        ;* Entering:                                                                       *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 ldx !#+157                                                         *
                                        ;*                                                                                 *
                                        ;* will assemble as:                                                               *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D 00     LDX #$009D                                           *
                                        ;*                                                                                 *
                                        ;* Absent the ! in the operand field, the above would have been assembled as:      *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D        LDX #$9D                                             *
                                        ;*                                                                                 *
                                        ;* If an immediate mode operand is greater than $FF assembly of a 16 bit operand   *
                                        ;* is implied.                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* A Note on the PEA & PEI Instructions                                            *
                                        ;* ————————————————————————————————————                                            *
                                        ;*                                                                                 *
                                        ;* The Eyes and Lichty programming manual uses the following syntax for the PEA    *
                                        ;* and PEI instructions:                                                           *
                                        ;*                                                                                 *
                                        ;*     PEA <operand>                                                               *
                                        ;*     PEI (<operand>)                                                             *
                                        ;*                                                                                 *
                                        ;* The WDC data sheet that was published at the time of the 65C816's release in    *
                                        ;* 1984 does not indicate a recommended or preferred syntax for any of the above   *
                                        ;* instructions.  PEA pushes its operand to the stack and hence operates like any  *
                                        ;* other immediate mode instruction, in that the operand is the data (however, PEA *
                                        ;* doesn't affect the status register).  Similarly, PEI pushes the 16 bit value    *
                                        ;* stored at <operand> and <operand>+1, and hence operates like any other direct   *
                                        ;* (zero) page instruction, again without affecting the status register.           *
                                        ;*                                                                                 *
                                        ;* BCS Technology Limited is of the opinion that the developer of the ORCA/M as-   *
                                        ;* sembler, which is the assembler referred to in the Eyes and Lichty manual, mis- *
                                        ;* understood how PEA and PEI behave during runtime, and hence chose an incorrect  *
                                        ;* syntax for these two instructions.  This error was subsequently carried forward *
                                        ;* by Eyes and Lichty.                                                             *
                                        ;*                                                                                 *
                                        ;* Supermon 816's assembler uses the following syntax for PEA and PEI:             *
                                        ;*                                                                                 *
                                        ;*     PEA #<operand>                                                              *
                                        ;*     PEI <operand>                                                               *
                                        ;*                                                                                 *
                                        ;* The operand for PEA is treated as a 16 bit value, even if entered as an 8 bit   *
                                        ;* value.  The operand for PEI must be 8 bits.                                     *
                                        ;*                                                                                 *
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;	* * * * * * * * * * * *
                                        ;	* VERSION INFORMATION *
                                        ;	* * * * * * * * * * * *
                                        ;
                                        softvers .macro                ;software version — change with each revision...
                                                 .byte "1"             ;major
                                                 .byte "."
                                                 .byte "0"             ;minor
                                                 .byte "."
                                                 .byte "0"             ;revision
                                                 .endm
                                        ;
                                        ;REVISION TABLE
                                        ;
                                        ;Ver  Rev Date    Description
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;1.0  2013/11/01  A) Original derived from the POC V1.1 single-board computer
                                        ;                    firmware.
                                        ;     2013/11/04  A) Fixed a problem where the B-accumulator wasn't always being
                                        ;                    be copied to shadow storage after return from execution of
                                        ;                    a J command.
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	        COMMENT ABBREVIATIONS
                                        ;	————————————————————————————————————————————————————
                                        ;	  BCD   binary-coded decimal
                                        ;	   DP   direct page or page zero
                                        ;	  EOF   end-of-field
                                        ;	  EOI   end-of-input
                                        ;	  LSB   least significant byte/bit
                                        ;	  LSD   least significant digit
                                        ;	  LSN   least significant nybble
                                        ;	  LSW   least significant word
                                        ;	  MPU   microprocessor
                                        ;	  MSB   most significant byte/bit
                                        ;	  MSD   most significant digit
                                        ;	  MSN   most significant nybble
                                        ;	  MSW   most-significant word
                                        ;	  RAM   random access memory
                                        ;	   WS   whitespace, i.e., blanks & horizontal tabs
                                        ;	————————————————————————————————————————————————————
                                        ;	A word is defined as 16 bits.
                                        ;
                                        ;	   MPU REGISTER SYMBOLS
                                        ;	——————————————————————————
                                        ;	   .A   accumulator LSB
                                        ;	   .B   accumulator MSB
                                        ;	   .C   16 bit accumulator
                                        ;	   .X   X-index
                                        ;	   .Y   Y-index
                                        ;      DS   data segment
                                        ;	   DB   data bank
                                        ;	   DP   direct page
                                        ;      CS   code segment
                                        ;	   PB   program bank
                                        ;	   PC   program counter
                                        ;	   SP   stack pointer
                                        ;	   SR   MPU status
                                        ;      SRX  status extension
                                        ;	————————————————————————————
                                        ;
                                        ;	  MPU STATUS REGISTER SYMBOLS
                                        ;	———————————————————————————————
                                        ;	    C   carry
                                        ;	    D   decimal mode
                                        ;	    I   maskable interrupts
                                        ;	    m   accumulator/memory size
                                        ;	    N   result negative
                                        ;	    V   sign overflow
                                        ;	    x   index registers size
                                        ;	    Z   result zero
                                        ;
                                        ;      16   16 bit emulation flag
                                        ;      32   32 bit emulation flag
                                        ;	———————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SYSTEM INTERFACE DEFINITIONS
                                        ;
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;	This section defines the interface between Supermon 816 & the host
                                        ;	system.   Change these definitions to suit your system, but do not
                                        ;	change any label names.  All definitions must have valid values in
                                        ;	order to assemble Supermon 816.
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————
    452 = 000000000000C000                            _origin_ =$00C000              ;assembly address...
                                        ;
                                        ;	Set _ORIGIN_ to Supermon 816's desired assembly address.
                                        ;	————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    458 = 000000000000FE03                            vecexit  =$00FE03              ;exit to environment address...
                                        ;
                                        ;	Set VECEXIT to where Supermon 816 should go when it exits.  Supermon 816
                                        ;	will do a JML (long jump) to this address, which means VECEXIT must be a
                                        ;	24 bit address.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    466 = 0000000000000102                            vecbrki  =$0102                ;BRK handler indirect vector...
    467 = 0000000000000105                            vecbrkia =$0105                ;system indirect BRK vector
                                        ;
                                        ;	Supermon 816 will modify this vector so that execution of a BRK instruc-
                                        ;	tion is intercepted & the registers  are  captured.   Your BRK front end
                                        ;	should jump through this vector after pushing the registers as follows:
                                        ;
                                        ;	         phb                   ;save DB
                                        ;	         phd                   ;save DP
                                        ;	         rep #%00110000        ;16 bit registers
                                        ;	         pha
                                        ;	         phx
                                        ;	         phy
                                        ;	         jmp (vecbrki)         ;indirect vector
                                        ;
                                        ;	When a G or J command is issued, the above sequence will be reversed be-
                                        ;	fore a jump is made to the code to be executed.  Upon exit from Supermon
                                        ;	816, the original address at VECBRKI will be restored.
                                        ;
                                        ;	If your BRK front end doesn't conform to the above you will have to mod-
                                        ;	ify Supermon 816 to accommodate the differences.  The most likely needed
                                        ;	changes will be in the order in which registers are pushed to the stack.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    491 = 0000000000003FFF                            hwstack  =$3fff                ;top of hardware stack...
                                        ;
                                        ;	Supermon 816 initializes the stack pointer to this address when the cold
                                        ;	start at MONCOLD is called to enter the monitor.  The stack pointer will
                                        ;	be undisturbed when entry into Supermon 816 is through JMONBRK (see jump
                                        ;	table definitions).
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    500 = 0000000000000080                            zeropage =$80                  ;Supermon 816's direct page...
                                        ;
                                        ;	Supermon 816 uses direct page starting at this address.  Be sure that no
                                        ;	conflict occurs with other software.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    506 = 00000000000000FC                            biosctx	 =$FC
                                        ;	————————————————————————————————————————————————————————————————————————
    508 = 000000000000FE00                            getcha   =$FE00                ;get keystroke from console...
                                        ;
                                        ;	GETCHA refers to an operating system API call that returns a keystroke
                                        ;	in the 8 bit accumulator.  Supermon 816  assumes that GETCHA is a non-
                                        ;	blocking subroutine & returns with carry clear to indicate that a key-
                                        ;	stroke is in .A, or with carry set to indicate that no keystroke was
                                        ;	available.  GETCHA will be called with a JSR instruction.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from GETCHA.
                                        ;	You may have to modify Supermon 816 at all calls to GETCHA if your "get
                                        ;	keystroke" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    522 = 000000000000FE06                            putcha   =$FE06                ;print character on console...
                                        ;
                                        ;	PUTCHA refers to an operating system API call that prints a character to
                                        ;	the console screen.  The character to be printed will be in .A, which
                                        ;	will be set to 8-bit width.  Supermon 816 assumes that PUTCHA will block
                                        ;	until the character can be processed.  PUTCHA will be called with a JSR
                                        ;	instructions.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from PUTCHA.
                                        ;	You may have to modify Supermon 816 at all calls to PUTCHA if your "put
                                        ;	character" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    536 = 0000000000000003                            stopkey  =$03                  ;display abort key...
                                        ;
                                        ;	Supermon 816 will poll for a "stop key" during display operations, such
                                        ;	as code disassembly & memory dumps, so as to abort further processing &
                                        ;	return to the command prompt.  STOPKEY must be defined with the ASCII
                                        ;	value that the "stop key" will emit when typed.  The polling is via a
                                        ;	call to GETCHA (described above).  The default STOPKEY definition of $03
                                        ;	is for ASCII <ETX> or [Ctrl-C].
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    546 = 0000000000000200                            ibuffer  =$000200               ;input buffer &...
    547 = 00000251                      auxbuf   =ibuffer+s_ibuf+1 ;auxiliary buffer...
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	Supermon 816 will use the above definitions for input buffers.  These
                                        ;	buffers may be located anywhere in RAM that is convenient.  The buffers
                                        ;	are stateless, which means that unless Supermon 816 has control of your
                                        ;	system, they may be overwritten without consequence.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S INSTRUCTION SYNTHESIS MACROS —— !!!!! DO NOT EDIT !!!!!
                                        ;
                                        _asm24_  .macro .ad
                                                 .byte <.ad,>.ad,.ad >> 16
                                                 .endm
                                        ;
                                        brl      .macro .ad
                                        .ba      =*+3
                                                 .byte $82
                                                 .word .ad-.ba
                                                 .endm
                                        ;
                                        ; jml is supported for the RTF65002 in 65c02 mode. And the opcode is supported
                                        ; by the assembler.
                                        ;jml      .macro .ad
                                        ; ;        .byte $5c
                                        ;         _asm24_ .ad
                                        ;         .endm
                                        ;
                                        mvn      .macro .s,.d
                                                 .byte $54,.d,.s
                                                 .endm
                                        ;
                                        mvp      .macro .s,.d
                                                 .byte $44,.d,.s
                                                 .endm
                                        ;
                                        pea      .macro .op
                                                 .byte $f4
                                                 .word .op
                                                 .endm
                                        ;
                                        phb      .macro
                                                 .byte $8b
                                                 .endm
                                        ;
                                        phk      .macro
                                                 .byte $4b
                                                 .endm
                                        ;
                                        plb      .macro
                                                 .byte $ab
                                                 .endm
                                        ;
                                        rep      .macro .op
                                                 .byte $c2,.op
                                                 .endm
                                        ;
                                        sep      .macro .op
                                                 .byte $e2,.op
                                                 .endm
                                        ;
                                        tcd      .macro
                                                 .byte $5b
                                                 .endm
                                        ;
                                        tcs      .macro
                                                 .byte $1b
                                                 .endm
                                        ;
                                        tdc      .macro
                                                 .byte $7b
                                                 .endm
                                        ;
                                        tsc      .macro
                                                 .byte $3b
                                                 .endm
                                        ;
                                        txy      .macro
                                                 .byte $9b
                                                 .endm
                                        ;
                                        tyx      .macro
                                                 .byte $bb
                                                 .endm
                                        ;
                                        wai      .macro
                                                 .byte $cb
                                                 .endm
                                        ;
                                        xba      .macro
                                                 .byte $eb
                                                 .endm
                                        ;
                                        adcw     .macro .op
                                                 adc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        andw     .macro .op
                                                 and #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        bitw     .macro .op
                                                 bit #<.op
                                                 .byte >.op
                                                 .endm
                                        ;         
                                        cmpw     .macro .op
                                                 cmp #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpxw     .macro .op
                                                 cpx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpyw     .macro .op
                                                 cpy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        eorw     .macro .op
                                                 eor #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldaw     .macro .op
                                                 lda #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldxw     .macro .op
                                                 ldx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldyw     .macro .op
                                                 ldy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        oraw     .macro .op
                                                 ora #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        sbcw     .macro .op
                                                 sbc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldalx    .macro .ad
                                                 .byte $+         .byte a_esc,"("
                                     +            .byte a_esc,"G4"
                                        
                                     +            .byte <.ad,>.ad,.ad >> 16
                                        
                                                 .endm
                                        ;
                                        adcil    .macro .ad
                                                 .byte $67,.ad
                                                 .endm
                                        ;
                                        adcily   .macro .ad
                                                 .byte $77,.ad
                                                 .endm
                                        ;
                                        andil    .macro .ad
                                                 .byte $27,.ad
                                                 .endm
                                        ;
                                        andily   .macro .ad
                                                 .byte $37,.ad
                                                 .endm
                                        ;
                                        cmpil    .macro .ad
                                                 .byte $c7,.ad
                                                 .endm
                                        ;
                                        cmpily   .macro .ad
                                                 .byte $d7,.ad
                                                 .endm
                                        ;
                                        eoril    .macro .ad
                                                 .byte $47,.ad
                                                 .endm
                                        ;
                                        eorily   .macro .ad
                                                 .byte $57,.ad
                                                 .endm
                                        ;
                                        ldail    .macro .ad
                                                 .byte $a7,.ad
                                                 .endm
                                        ;
                                        ldaily   .macro .ad
                                                 .byte $b7,.ad
                                                 .endm
                                        ;
                                        orail    .macro .ad
                                                 .byte $07,.ad
                                                 .endm
                                        ;
                                        oraily   .macro .ad
                                                 .byte $17,.ad
                                                 .endm
                                        ;
                                        sbcil    .macro .ad
                                                 .byte $e7,.ad
                                                 .endm
                                        ;
                                        sbcily   .macro .ad
                                                 .byte $f7,.ad
                                                 .endm
                                        ;
                                        stail    .macro .ad
                                                 .byte $87,.ad
                                                 .endm
                                        ;
                                        staily   .macro .ad
                                                 .byte $97,.ad
                                                 .endm
                                        ;
                                        adcs     .macro .of
                                                 .byte $63,.of
                                                 .endm
                                        ;
                                        adcsi    .macro .of
                                                 .byte $73,.of
                                                 .endm
                                        ;
                                        ands     .macro .of
                                                 .byte $23,.of
                                                 .endm
                                        ;
                                        andsi    .macro .of
                                                 .byte $33,.of
                                                 .endm
                                        ;
                                        cmps     .macro .of
                                                 .byte $c3,.of
                                                 .endm
                                        ;
                                        cmpsi    .macro .of
                                                 .byte $d3,.of
                                                 .endm
                                        ;
                                        eors     .macro .of
                                                 .byte $43,.of
                                                 .endm
                                        ;
                                        eorsi    .macro .of
                                                 .byte $53,.of
                                                 .endm
                                        ;
                                        ldas     .macro .of
                                                 .byte $a3,.of
                                                 .endm
                                        ;
                                        ldasi    .macro .of
                                                 .byte $b3,.of
                                                 .endm
                                        ;
                                        oras     .macro .of
                                                 .byte $03,.of
                                                 .endm
                                        ;
                                        orasi    .macro .of
                                                 .byte $13,.of
                                                 .endm
                                        ;
                                        sbcs     .macro .of
                                                 .byte $e3,.of
                                                 .endm
                                        ;
                                        sbcsi    .macro .of
                                                 .byte $f3,.of
                                                 .endm
                                        ;
                                        stas     .macro .of
                                                 .byte $83,.of
                                                 .endm
                                        ;
                                        stasi    .macro .of
                                                 .byte $93,.of
                                                 .endm
                                        ;
                                        longa    .macro
                                                 .byte $c2,$20
                                                 .endm
                                        ;
                                        longr    .macro
                                                 .byte $c2,$30
                                                 .endm
                                        ;
                                        longx    .macro
                                                 .byte $c2,$10
                                                 .endm
                                        ;
                                        shorta   .macro
                                                 .byte $e2,$20
                                                 .endm
                                        ;
                                        shorti   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        shortr   .macro
                                                 .byte $e2,$30
                                                 .endm
                                        ;
                                        shortx   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL MACROS
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The following macros execute terminal  control procedures  that  perform
                                        ;	such tasks as clearing the screen,  switching  between  normal & reverse
                                        ;	video, etc.  These macros are for WYSE 60 & compatible displays, such as
                                        ;	the WYSE 150, WYSE 160, WYSE 325 & WYSE GPT.   Only the functions needed
                                        ;	by Supermon 816 are included.
                                        ;
                                        ;	If your console is not WYSE 60 compatible, you will need to  edit  these
                                        ;	macros as required to control your particular console or terminal.  Note
                                        ;	that in some cases one macro may call another.  Exercise caution in your
                                        ;	edits to avoid introducing display bugs.
                                        ;
                                        ;	If your console display cannot execute one of these procedures,  such as
                                        ;	'CL' (clear to end of line), you will have to develop an alternative.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	clearing data...
                                        ;
                                        bs       .macro                ;destructive backspace
                                                 .byte a_bs
                                     +            .byte a_esc,"W"
                                        
                                                 .endm
                                        ;
                                        cl       .macro                ;clear to end of line 
                                                 .byte a_esc,"T"
                                                 .endm
                                        ;
                                        ;
                                        ;	cursor control...
                                        ;
                                        cn       .macro                ;cursor on
                                                 .byte a_esc,"`1"
                                                 .endm
                                        ;
                                        co       .macro                ;cursor off
                                                 .byte a_esc,"`0"
                                                 .endm
                                        ;
                                        cr       .macro                ;carriage return
                                                 .byte a_cr
                                                 .endm
                                        ;
                                        lf       .macro                ;carriage return/line feed
                                     +            .byte a_cr
                                        
                                                 .byte a_lf
                                                 .endm
                                        ;
                                        ;
                                        ;	display attributes...
                                        ;
                                        bf       .macro                ;reverse foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G4"
                                                 .endm
                                        ;
                                        er       .macro                ;enable normal foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        sf       .macro                ;set foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        ;
                                        ;	display editing...
                                        ;
                                        dcuc     .macro                ;delete char under cursor
                                                 .byte a_esc,"W"
                                                 .endm
                                        ;
                                        ;
                                        ;	miscellaneous control...
                                        ;
                                        rb       .macro                ;ring "bell"
                                                 .byte a_bel
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASCII CONTROL DEFINITIONS (menmonic order)
                                        ;
    956 = 0000000000000007                            a_bel    =$07                  ;<BEL> alert/ring bell
    957 = 0000000000000008                            a_bs     =$08                  ;<BS>  backspace
    958 = 000000000000000D                            a_cr     =$0d                  ;<CR>  carriage return
    959 = 000000000000007F                            a_del    =$7f                  ;<DEL> delete
    960 = 000000000000001B                            a_esc    =$1b                  ;<ESC> escape
    961 = 0000000000000009                            a_ht     =$09                  ;<HT>  horizontal tabulation
    962 = 000000000000000A                            a_lf     =$0a                  ;<LF>  linefeed
                                        ;
                                        ;
                                        ;	miscellaneous (description order)...
                                        ;
    967 = 20                            a_blank  =' '                  ;blank (whitespace)
    968 = 7A                            a_asclch ='z'                  ;end of lowercase ASCII
    969 = 000000000000005F                            a_lctouc =$5f                  ;LC to UC conversion mask
    970 = 61                            a_asclcl ='a'                  ;start of lowercase ASCII
    971 = 3A                            a_colon  =':'
                                        ;
                                        ;================================================================================
                                        ;
                                        ;GLOBAL ATOMIC CONSTANTS
                                        ;
                                        ;
                                        ;	data type sizes...
                                        ;
    980 = 0000000000000001                            s_byte   =1                    ;byte
    981 = 0000000000000002                            s_word   =2                    ;word (16 bits)
    982 = 0000000000000003                            s_xword  =3                    ;extended word (24 bits)
    983 = 0000000000000004                            s_dword  =4                    ;double word (32 bits)
    984 = 0000000000000100                            s_rampag =$0100                ;65xx RAM page
                                        ;
                                        ;
                                        ;	data type sizes in bits...
                                        ;
    989 = 0000000000000008                            s_bibyte =8                    ;byte
    990 = 0000000000000004                            s_bnybbl =4                    ;nybble
                                        ;
                                        ;
                                        ;	miscellaneous...
                                        ;
    995 = 000000000000002C                            bitabs   =$2c                  ;absolute BIT opcode
    996 = 0000000000000024                            bitzp    =$24                  ;zero page BIT opcode
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S NATIVE MODE STATUS REGISTER DEFINITIONS
                                        ;
   1002 = 00000001                      s_mpudbx =s_byte               ;data bank size
   1003 = 00000002                      s_mpudpx =s_word               ;direct page size
   1004 = 00000001                      s_mpupbx =s_byte               ;program bank size
   1005 = 00000002                      s_mpupcx =s_word               ;program counter size
   1006 = 00000002                      s_mpuspx =s_word               ;stack pointer size
   1007 = 00000001                      s_mpusrx =s_byte               ;status size
                                        ;
                                        ;
                                        ;	status register flags...
                                        ;
   1012 = 0000000000000001                            sr_car   =%00000001            ;C
   1013 = 00000002                      sr_zer   =sr_car << 1          ;Z
   1014 = 00000004                      sr_irq   =sr_zer << 1          ;I
   1015 = 00000008                      sr_bdm   =sr_irq << 1          ;D
   1016 = 00000010                      sr_ixw   =sr_bdm << 1          ;x
   1017 = 00000020                      sr_amw   =sr_ixw << 1          ;m
   1018 = 00000040                      sr_ovl   =sr_amw << 1          ;V
   1019 = 00000080                      sr_neg   =sr_ovl << 1          ;N
   1020 = 00000100                      sr_16	 =sr_neg << 1
   1021 = 00000200                      sr_32    =sr_16 << 1
                                        ;
                                        ;	NVmxDIZC
                                        ;	xxxxxxxx
                                        ;	||||||||
                                        ;	|||||||+———> 1 = carry set/generated
                                        ;	||||||+————> 1 = result = zero
                                        ;	|||||+—————> 1 = IRQs ignored
                                        ;	||||+——————> 0 = binary arithmetic mode
                                        ;	||||         1 = decimal arithmetic mode
                                        ;	|||+———————> 0 = 16 bit index
                                        ;	|||          1 = 8 bit index
                                        ;	||+————————> 0 = 16 bit .A & memory
                                        ;	||           1 = 8 bit .A & memory
                                        ;	|+—————————> 1 = sign overflow
                                        ;	+——————————> 1 = result = negative
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"SIZE-OF" CONSTANTS
                                        ;
   1042 = 00000003                      s_addr   =s_xword              ;24 bit address
   1043 = 0000000000000020                            s_auxbuf =32                   ;auxiliary buffer
   1044 = 0000000000000050                            s_ibuf   =80                   ;input buffer
   1045 = 0000000000000003                            s_mnemon =3                    ;MPU ASCII mnemonic
   1046 = 0000000000000002                            s_mnepck =2                    ;MPU encoded mnemonic
   1047 = 0000000000000003                            s_mvinst =3                    ;MVN/MVP instruction
   1048 = 00000001                      s_opcode =s_byte               ;MPU opcode
   1049 = 00000003                      s_oper   =s_xword              ;operand
   1050 = 00000004                      s_pfac   =s_dword              ;primary math accumulator
   1051 = 00000006                      s_sfac   =s_dword+s_word       ;secondary math accumulators
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"NUMBER-OF" CONSTANTS
                                        ;
   1057 = 0000000000000015                            n_dbytes =21                   ;default disassembly bytes
   1058 = 0000000000000008                            n_dump   =8                    ;bytes per memory dump line
   1059 = 000000FF                      n_mbytes =s_rampag-1           ;default memory dump bytes
   1060 = 0000000000000008                            n_hccols =8                    ;compare/hunt display columns
   1061 = 00000009                      n_opcols =3*s_oper             ;disassembly operand columns
   1062 = 0000000000000004                            n_opslsr =4                    ;LSRs to extract instruction size
   1063 = 0000000000000005                            n_shfenc =5                    ;shifts to encode/decode mnemonic
                                        ;
                                        ;================================================================================
                                        ;
                                        ;NUMERIC CONVERSION CONSTANTS
                                        ;
   1069 = 0000000000000006                            a_hexdec ='A'-'9'-2            ;hex to decimal difference
   1070 = 25                            c_bin    ='%'                  ;binary prefix
   1071 = 2B                            c_dec    ='+'                  ;decimal prefix
   1072 = 24                            c_hex    ='$'                  ;hexadecimal prefix
   1073 = 40                            c_oct    ='@'                  ;octal prefix
   1074 = 66                            k_hex    ='f'                  ;hex ASCII conversion
   1075 = 00000020                      m_bits   =s_pfac*s_bibyte      ;operand bit size
   1076 = 00000030                      m_cbits  =s_sfac*s_bibyte      ;workspace bit size
   1077 = 000000000000000F                            bcdumask =%00001111            ;isolate BCD units mask
   1078 = 0000000000000030                            btoamask =%00110000            ;binary to ASCII mask
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER CONSTANTS
                                        ;
   1084 = 3F                            a_mnecvt ='?'                  ;encoded mnemonic conversion base
   1085 = 000000000000001F                            aimmaska =%00011111            ;.A immediate opcode test #1
   1086 = 0000000000000009                            aimmaskb =%00001001            ;.A immediate opcode test #2
   1087 = 41                            asmprfx  ='A'                  ;assemble code prefix
   1088 = 0000000000000009                            ascprmct =9                    ;assembler prompt "size-of"
   1089 = 2E                            disprfx  ='.'                  ;disassemble code prefix
   1090 = 00000000000000C0                            flimmask =%11000000            ;force long immediate flag
   1091 = 0000000000000054                            opc_mvn  =$54                  ;MVN opcode
   1092 = 0000000000000044                            opc_mvp  =$44                  ;MVP opcode
   1093 = 00000000000000C2                            opc_rep  =$c2                  ;REP opcode
   1094 = 00000000000000E2                            opc_sep  =$e2                  ;SEP opcode
   1095 = 00000030                      pfmxmask =sr_amw | sr_ixw      ;MPU m & x flag bits mask
                                        ;
                                        ;
                                        ;	assembler prompt buffer offsets...
                                        ;
   1100 = 00000002                      apadrbkh =s_word               ;instruction address bank MSN
   1101 = 00000003                      apadrbkl =apadrbkh+s_byte      ;instruction address bank LSN
   1102 = 00000004                      apadrmbh =apadrbkl+s_byte      ;instruction address MSB MSN
   1103 = 00000005                      apadrmbl =apadrmbh+s_byte      ;instruction address MSB LSN
   1104 = 00000006                      apadrlbh =apadrmbl+s_byte      ;instruction address LSB MSN
   1105 = 00000007                      apadrlbl =apadrlbh+s_byte      ;instruction address LSB LSN
                                        ;
                                        ;
                                        ;	addressing mode preamble symbols...
                                        ;
   1110 = 21                            amp_flim ='!'                  ;force long immediate
   1111 = 23                            amp_imm  ='#'                  ;immediate
   1112 = 28                            amp_ind  ='('                  ;indirect
   1113 = 5B                            amp_indl ='['                  ;indirect long
   1114 = 7B                            amp_indxl = '{'				   ;indirect extra long
                                        ;
                                        ;
                                        ;	addressing mode symbolic translation indices...
                                        ;
   1119 = 0000000000000000                            am_nam   =%0000                ;(0)  no symbol
   1120 = 0000000000000001                            am_imm   =%0001                ;(1)  #
   1121 = 0000000000000002                            am_adrx  =%0010                ;(2)  dp,X or addr,X
   1122 = 0000000000000003                            am_adry  =%0011                ;(3)  dp,Y or addr,Y
   1123 = 0000000000000004                            am_ind   =%0100                ;(4)  (dp) or (addr)
   1124 = 0000000000000005                            am_indl  =%0101                ;(5)  [dp] or [addr]
   1125 = 0000000000000006                            am_indly =%0110                ;(6)  [dp],Y
   1126 = 0000000000000007                            am_indx  =%0111                ;(7)  (dp,X) or (addr,X)
   1127 = 0000000000000008                            am_indy  =%1000                ;(8)  (dp),Y
   1128 = 0000000000000009                            am_stk   =%1001                ;(9)  offset,S
   1129 = 000000000000000A                            am_stky  =%1010                ;(10) (offset,S),Y
   1130 = 000000000000000B                            am_move  =%1011                ;(11) MVN/MVP sbnk,dbnk
   1131 = 000000000000000C                            am_indxly=%1100				   ;(12) {dp},Y
                                        ;
                                        ;
                                        ;	operand size translation indices...
                                        ;
   1136 = 0000000000000000                            ops0     =%0000 << 4           ;no operand
   1137 = 0000000000000010                            ops1     =%0001 << 4           ;8 bit operand
   1138 = 0000000000000020                            ops2     =%0010 << 4           ;16 bit operand
   1139 = 0000000000000030                            ops3     =%0011 << 4           ;24 bit operand
   1140 = 0000000000000050                            bop1     =%0101 << 4           ;8 bit relative branch
   1141 = 0000000000000060                            bop2     =%0110 << 4           ;16 bit relative branch
   1142 = 0000000000000090                            vops     =%1001 << 4           ;8, 16, or 32 bit operand
   1143 = 0000000000010100                            ops5	 =$1010 << 4		   ;32 bit operand
                                        ;
                                        ;
                                        ;	operand size & addressing mode extraction masks...
                                        ;
   1148 = 000000000000000F                            amodmask =%00001111            ;addressing mode index
   1149 = 0000000000000030                            opsmask  =%00110000            ;operand size
   1150 = 00000000000000C0                            vopsmask =%11000000            ;BOPx & VOPS flag bits
                                        ;
                                        ;
                                        ;	instruction mnemonic encoding...
                                        ;
   1155 = 0000000000002144                            mne_adc  =$2144                ;ADC
   1156 = 0000000000002BC4                            mne_and  =$2bc4                ;AND
   1157 = 0000000000006D04                            mne_asl  =$6d04                ;ASL
   1158 = 0000000000002106                            mne_bcc  =$2106                ;BCC
   1159 = 000000000000A106                            mne_bcs  =$a106                ;BCS
   1160 = 0000000000009186                            mne_beq  =$9186                ;BEQ
   1161 = 000000000000AA86                            mne_bit  =$aa86                ;BIT
   1162 = 0000000000005386                            mne_bmi  =$5386                ;BMI
   1163 = 00000000000033C6                            mne_bne  =$33c6                ;BNE
   1164 = 0000000000006C46                            mne_bpl  =$6c46                ;BPL
   1165 = 00000000000014C6                            mne_bra  =$14c6                ;BRA
   1166 = 00000000000064C6                            mne_brk  =$64c6                ;BRK
   1167 = 0000000000006CC6                            mne_brl  =$6cc6                ;BRL
   1168 = 00000000000025C6                            mne_bvc  =$25c6                ;BVC
   1169 = 000000000000A5C6                            mne_bvs  =$a5c6                ;BVS
   1170 = 0000000000002348                            mne_clc  =$2348                ;CLC
   1171 = 0000000000002B48                            mne_cld  =$2b48                ;CLD
   1172 = 0000000000005348                            mne_cli  =$5348                ;CLI
   1173 = 000000000000BB48                            mne_clv  =$bb48                ;CLV
   1174 = 0000000000008B88                            mne_cmp  =$8b88                ;CMP
   1175 = 0000000000008C08                            mne_cop  =$8c08                ;COP
   1176 = 000000000000CC48                            mne_cpx  =$cc48                ;CPX
   1177 = 000000000000D448                            mne_cpy  =$d448                ;CPY
   1178 = 000000000000218A                            mne_dec  =$218a                ;DEC
   1179 = 000000000000C98A                            mne_dex  =$c98a                ;DEX
   1180 = 000000000000D18A                            mne_dey  =$d18a                ;DEY
   1181 = 0000000000009C0C                            mne_eor  =$9c0c                ;EOR
   1182 = 00000000000023D4                            mne_inc  =$23d4                ;INC
   1183 = 000000000000CBD4                            mne_inx  =$cbd4                ;INX
   1184 = 000000000000D3D4                            mne_iny  =$d3d4                ;INY
   1185 = 0000000000006B96                            mne_jml  =$6b96                ;JML
   1186 = 0000000000008B96                            mne_jmp  =$8b96                ;JMP
   1187 = 0000000000006D16                            mne_jsl  =$6d16                ;JSL
   1188 = 0000000000009D16                            mne_jsr  =$9d16                ;JSR
   1189 = 000000000000115A                            mne_lda  =$115a                ;LDA
   1190 = 000000000000C95A                            mne_ldx  =$c95a                ;LDX
   1191 = 000000000000D15A                            mne_ldy  =$d15a                ;LDY
   1192 = 0000000000009D1A                            mne_lsr  =$9d1a                ;LSR
   1193 = 0000000000007DDC                            mne_mvn  =$7ddc                ;MVN
   1194 = 0000000000008DDC                            mne_mvp  =$8ddc                ;MVP
   1195 = 0000000000008C1E                            mne_nop  =$8c1e                ;NOP
   1196 = 00000000000014E0                            mne_ora  =$14e0                ;ORA
   1197 = 00000000000011A2                            mne_pea  =$11a2                ;PEA
   1198 = 00000000000051A2                            mne_pei  =$51a2                ;PEI
   1199 = 00000000000099A2                            mne_per  =$99a2                ;PER
   1200 = 0000000000001262                            mne_pha  =$1262                ;PHA
   1201 = 0000000000001A62                            mne_phb  =$1a62                ;PHB
   1202 = 0000000000002A62                            mne_phd  =$2a62                ;PHD
   1203 = 0000000000006262                            mne_phk  =$6262                ;PHK
   1204 = 0000000000008A62                            mne_php  =$8a62                ;PHP
   1205 = 000000000000CA62                            mne_phx  =$ca62                ;PHX
   1206 = 000000000000D262                            mne_phy  =$d262                ;PHY
   1207 = 0000000000001362                            mne_pla  =$1362                ;PLA
   1208 = 0000000000001B62                            mne_plb  =$1b62                ;PLB
   1209 = 0000000000002B62                            mne_pld  =$2b62                ;PLD
   1210 = 0000000000008B62                            mne_plp  =$8b62                ;PLP
   1211 = 000000000000CB62                            mne_plx  =$cb62                ;PLX
   1212 = 000000000000D362                            mne_ply  =$d362                ;PLY
   1213 = 00000000000089A6                            mne_rep  =$89a6                ;REP
   1214 = 0000000000006C26                            mne_rol  =$6c26                ;ROL
   1215 = 0000000000009C26                            mne_ror  =$9c26                ;ROR
   1216 = 0000000000005566                            mne_rti  =$5566                ;RTI
   1217 = 0000000000006D66                            mne_rtl  =$6d66                ;RTL
   1218 = 000000000000A566                            mne_rts  =$a566                ;RTS
   1219 = 00000000000020E8                            mne_sbc  =$20e8                ;SBC
   1220 = 00000000000021A8                            mne_sec  =$21a8                ;SEC
   1221 = 00000000000029A8                            mne_sed  =$29a8                ;SED
   1222 = 00000000000051A8                            mne_sei  =$51a8                ;SEI
   1223 = 00000000000089A8                            mne_sep  =$89a8                ;SEP
   1224 = 0000000000001568                            mne_sta  =$1568                ;STA
   1225 = 0000000000008D68                            mne_stp  =$8d68                ;STP
   1226 = 000000000000CD68                            mne_stx  =$cd68                ;STX
   1227 = 000000000000D568                            mne_sty  =$d568                ;STY
   1228 = 000000000000DD68                            mne_stz  =$dd68                ;STZ
   1229 = 000000000000C8AA                            mne_tax  =$c8aa                ;TAX
   1230 = 000000000000D0AA                            mne_tay  =$d0aa                ;TAY
   1231 = 000000000000292A                            mne_tcd  =$292a                ;TCD
   1232 = 000000000000A12A                            mne_tcs  =$a12a                ;TCS
   1233 = 000000000000216A                            mne_tdc  =$216a                ;TDC
   1234 = 0000000000001CEA                            mne_trb  =$1cea                ;TRB
   1235 = 0000000000001D2A                            mne_tsb  =$1d2a                ;TSB
   1236 = 000000000000252A                            mne_tsc  =$252a                ;TSC
   1237 = 000000000000CD2A                            mne_tsx  =$cd2a                ;TSX
   1238 = 000000000000166A                            mne_txa  =$166a                ;TXA
   1239 = 000000000000A66A                            mne_txs  =$a66a                ;TXS
   1240 = 000000000000D66A                            mne_txy  =$d66a                ;TXY
   1241 = 00000000000016AA                            mne_tya  =$16aa                ;TYA
   1242 = 000000000000CEAA                            mne_tyx  =$ceaa                ;TYX
   1243 = 00000000000050B0                            mne_wai  =$50b0                ;WAI
   1244 = 0000000000007170                            mne_wdm  =$7170                ;WDM
   1245 = 00000000000010F2                            mne_xba  =$10f2                ;XBA
   1246 = 0000000000003132                            mne_xce  =$3132                ;XCE
                                        ;
                                        ;
                                        ;	encoded instruction mnemonic indices...
                                        ;
   1251 = 0000000000000010                            mne_adcx =16                   ;ADC
   1252 = 000000000000001D                            mne_andx =29                   ;AND
   1253 = 000000000000002C                            mne_aslx =44                   ;ASL
   1254 = 000000000000000F                            mne_bccx =15                   ;BCC
   1255 = 0000000000000041                            mne_bcsx =65                   ;BCS
   1256 = 000000000000003B                            mne_beqx =59                   ;BEQ
   1257 = 0000000000000046                            mne_bitx =70                   ;BIT
   1258 = 0000000000000024                            mne_bmix =36                   ;BMI
   1259 = 000000000000001F                            mne_bnex =31                   ;BNE
   1260 = 000000000000002A                            mne_bplx =42                   ;BPL
   1261 = 0000000000000005                            mne_brax =5                    ;BRA
   1262 = 0000000000000027                            mne_brkx =39                   ;BRK
   1263 = 000000000000002B                            mne_brlx =43                   ;BRL
   1264 = 0000000000000017                            mne_bvcx =23                   ;BVC
   1265 = 0000000000000044                            mne_bvsx =68                   ;BVS
   1266 = 0000000000000014                            mne_clcx =20                   ;CLC
   1267 = 000000000000001B                            mne_cldx =27                   ;CLD
   1268 = 0000000000000023                            mne_clix =35                   ;CLI
   1269 = 0000000000000047                            mne_clvx =71                   ;CLV
   1270 = 0000000000000035                            mne_cmpx =53                   ;CMP
   1271 = 0000000000000037                            mne_copx =55                   ;COP
   1272 = 000000000000004E                            mne_cpxx =78                   ;CPX
   1273 = 0000000000000058                            mne_cpyx =88                   ;CPY
   1274 = 0000000000000012                            mne_decx =18                   ;DEC
   1275 = 000000000000004A                            mne_dexx =74                   ;DEX
   1276 = 0000000000000054                            mne_deyx =84                   ;DEY
   1277 = 000000000000003D                            mne_eorx =61                   ;EOR
   1278 = 0000000000000015                            mne_incx =21                   ;INC
   1279 = 000000000000004D                            mne_inxx =77                   ;INX
   1280 = 0000000000000057                            mne_inyx =87                   ;INY
   1281 = 0000000000000028                            mne_jmlx =40                   ;JML
   1282 = 0000000000000036                            mne_jmpx =54                   ;JMP
   1283 = 000000000000002D                            mne_jslx =45                   ;JSL
   1284 = 000000000000003F                            mne_jsrx =63                   ;JSR
   1285 = 0000000000000001                            mne_ldax =1                    ;LDA
   1286 = 0000000000000049                            mne_ldxx =73                   ;LDX
   1287 = 0000000000000053                            mne_ldyx =83                   ;LDY
   1288 = 0000000000000040                            mne_lsrx =64                   ;LSR
   1289 = 0000000000000030                            mne_mvnx =48                   ;MVN
   1290 = 000000000000003A                            mne_mvpx =58                   ;MVP
   1291 = 0000000000000038                            mne_nopx =56                   ;NOP
   1292 = 0000000000000006                            mne_orax =6                    ;ORA
   1293 = 0000000000000002                            mne_peax =2                    ;PEA
   1294 = 0000000000000021                            mne_peix =33                   ;PEI
   1295 = 000000000000003C                            mne_perx =60                   ;PER
   1296 = 0000000000000003                            mne_phax =3                    ;PHA
   1297 = 000000000000000A                            mne_phbx =10                   ;PHB
   1298 = 000000000000001A                            mne_phdx =26                   ;PHD
   1299 = 0000000000000026                            mne_phkx =38                   ;PHK
   1300 = 0000000000000033                            mne_phpx =51                   ;PHP
   1301 = 000000000000004B                            mne_phxx =75                   ;PHX
   1302 = 0000000000000055                            mne_phyx =85                   ;PHY
   1303 = 0000000000000004                            mne_plax =4                    ;PLA
   1304 = 000000000000000B                            mne_plbx =11                   ;PLB
   1305 = 000000000000001C                            mne_pldx =28                   ;PLD
   1306 = 0000000000000034                            mne_plpx =52                   ;PLP
   1307 = 000000000000004C                            mne_plxx =76                   ;PLX
   1308 = 0000000000000056                            mne_plyx =86                   ;PLY
   1309 = 0000000000000031                            mne_repx =49                   ;REP
   1310 = 0000000000000029                            mne_rolx =41                   ;ROL
   1311 = 000000000000003E                            mne_rorx =62                   ;ROR
   1312 = 0000000000000025                            mne_rtix =37                   ;RTI
   1313 = 000000000000002E                            mne_rtlx =46                   ;RTL
   1314 = 0000000000000043                            mne_rtsx =67                   ;RTS
   1315 = 000000000000000E                            mne_sbcx =14                   ;SBC
   1316 = 0000000000000013                            mne_secx =19                   ;SEC
   1317 = 0000000000000019                            mne_sedx =25                   ;SED
   1318 = 0000000000000022                            mne_seix =34                   ;SEI
   1319 = 0000000000000032                            mne_sepx =50                   ;SEP
   1320 = 0000000000000007                            mne_stax =7                    ;STA
   1321 = 0000000000000039                            mne_stpx =57                   ;STP
   1322 = 0000000000000050                            mne_stxx =80                   ;STX
   1323 = 0000000000000059                            mne_styx =89                   ;STY
   1324 = 000000000000005B                            mne_stzx =91                   ;STZ
   1325 = 0000000000000048                            mne_taxx =72                   ;TAX
   1326 = 0000000000000052                            mne_tayx =82                   ;TAY
   1327 = 0000000000000018                            mne_tcdx =24                   ;TCD
   1328 = 0000000000000042                            mne_tcsx =66                   ;TCS
   1329 = 0000000000000011                            mne_tdcx =17                   ;TDC
   1330 = 000000000000000C                            mne_trbx =12                   ;TRB
   1331 = 000000000000000D                            mne_tsbx =13                   ;TSB
   1332 = 0000000000000016                            mne_tscx =22                   ;TSC
   1333 = 000000000000004F                            mne_tsxx =79                   ;TSX
   1334 = 0000000000000008                            mne_txax =8                    ;TXA
   1335 = 0000000000000045                            mne_txsx =69                   ;TXS
   1336 = 000000000000005A                            mne_txyx =90                   ;TXY
   1337 = 0000000000000009                            mne_tyax =9                    ;TYA
   1338 = 0000000000000051                            mne_tyxx =81                   ;TYX
   1339 = 0000000000000020                            mne_waix =32                   ;WAI
   1340 = 000000000000002F                            mne_wdmx =47                   ;WDM
   1341 = 0000000000000000                            mne_xbax =0                    ;XBA
   1342 = 000000000000001E                            mne_xcex =30                   ;XCE
                                        ;
                                        ;================================================================================
                                        ;
                                        ;MISCELLANEOUS CONSTANTS
                                        ;
   1348 = 0000000000000004                            halftab  =4                    ;1/2 tabulation spacing
   1349 = 3E                            memprfx  ='>'                  ;memory dump prefix
   1350 = 3A                            memsepch =':'                  ;memory dump separator
   1351 = 2E                            memsubch ='.'                  ;memory dump non-print char
   1352 = 0000000000000030                            srinit   =%00110000            ;SR initialization value
                                        ;
                                        ;================================================================================
                                        ;
                                        ;DIRECT PAGE STORAGE
                                        ;
   1358 = 00000080                      reg_csx  =zeropage			;CS
   1359 = 00000082                      reg_dsx  =reg_csx + 2		;DS
   1360 = 00000084                      reg_ssx  =reg_dsx + 2		;SS
   1361 = 00000086                      reg_pcx  =reg_ssx + 2	    ;PC
   1362 = 00000088                      reg_pbx  =reg_pcx + 2       ;PB
   1363 = 00000089                      reg_ax   =reg_pbx + 1       ;.C
   1364 = 0000008D                      reg_xx   =reg_ax + 4        ;.X
   1365 = 00000091                      reg_yx   =reg_xx + 4        ;.Y
   1366 = 00000095                      reg_spx  =reg_yx + 4        ;SP
   1367 = 00000099                      reg_srx  =reg_spx + 4       ;SR
   1368 = 0000009A                      reg_srxx =reg_srx + 1       ;SRX
   1369 = 0000009B                      reg_dbx  =reg_srxx + 1      ;DB
   1370 = 0000009C                      reg_dpx  =reg_dbx + 1       ;DP
                                        ;
                                        ;
                                        ;	general workspace...
                                        ;
   1375 = 000000A0                      addra    =reg_dpx+4            ;address #1
   1376 = 000000A4                      addrb    =addra+4              ;address #2
   1377 = 000000A7                      faca     =addrb+s_addr         ;primary accumulator
   1378 = 000000AB                      facax    =faca+s_pfac          ;extended primary accumulator
   1379 = 000000AF                      facb     =facax+s_pfac         ;secondary accumulator
   1380 = 000000B5                      facc     =facb+s_sfac          ;tertiary accumulator
   1381 = 000000BB                      operand  =facc+s_sfac          ;instruction operand
   1382 = 000000BE                      auxbufix =operand+s_oper       ;auxiliary buffer index
   1383 = 000000BF                      ibufidx  =auxbufix+s_byte      ;input buffer index
   1384 = 000000C0                      bitsdig  =ibufidx+s_byte       ;bits per numeral
   1385 = 000000C1                      numeral  =bitsdig+s_byte       ;numeral buffer
   1386 = 000000C2                      radix    =numeral+s_byte       ;radix index
   1387 = 000000C3                      admodidx =radix+s_byte         ;addressing mode index
   1388 = 000000C4                      charcnt  =admodidx+s_byte      ;character counter
   1389 = 000000C6                      instsize =charcnt+s_word       ;instruction size
   1390 = 000000C8                      mnepck   =instsize+s_word      ;encoded mnemonic
   1391 = 000000CA                      opcode   =mnepck+s_mnepck      ;current opcode
   1392 = 000000CB                      status   =opcode+s_byte        ;I/O status flag
   1393 = 000000CC                      xrtemp   =status+s_byte        ;temp .X storage
   1394 = 000000CD                      eopsize  =xrtemp+s_byte        ;entered operand size
   1395 = 000000CE                      flimflag =eopsize+s_byte       ;forced long immediate...
                                        ;
                                        ;	xx000000
                                        ;	||
                                        ;	|+—————————> 0: .X/.Y = 8 bits
                                        ;	|            1: .X/.Y = 16 bits
                                        ;	+——————————> 0: .A = 8 bits
                                        ;	             1: .A = 16 bits
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	During assembly, FLIMFLAG indicates the operand size used with an immed-
                                        ;	iate mode instruction, thus causing the following disassembly to display
                                        ;	the assembled  operand size.   During disassembly,  FLIMFLAG will mirror
                                        ;	the effect of the most recent REP or SEP instruction.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1411 = 000000CF                      iopsize  =flimflag+s_byte      ;operand size
   1412 = 000000D0                      range    =iopsize+s_byte       ;allowable radix range
   1413 = 000000D1                      vopsflag =range+s_byte         ;VOPS & ROPS mode bits
                                        ;
                                        ;
                                        ;	copy/fill workspace (overlaps some of the above)...
                                        ;
   1418 = 000000D2                      mcftwork =vopsflag+s_byte	;faca                 ;start of copy/fill code
   1419 = 000000D3                      mcftopc  =mcftwork+s_byte      ;instruction opcode
   1420 = 000000D4                      mcftbnk  =mcftopc+s_byte       ;banks
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SUPERMON 816 JUMP TABLE
                                        ;
                                                 org	_origin_
                                        ;
   1429 C000                            		 MEM	8
   1430 C000                            		 NDX	8
                                        		 CPU	W65C02
   1432 C000 80 02                      JMON     bra mon               ;cold start entry
   1433 C002 80 3E                      JMONBRK  bra monbrk            ;software interrupt intercept
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mon: SUPERMON 816 COLD START
                                        ;
   1439 C004 C2 20                      mon +         .byte $c2,$20
                                        
   1440 C006 AD 02 01                             lda vecbrki           ;BRK vector
   1441 C009 C9 42                    +            cmp #<monbrk
   1441 C00B C0                       +            .byte >monbrk
                                        ;pointing at monitor?
   1442 C00C D0 03                                bne .2            ;yes, ignore cold start
   1443 C00E 4C 7F C0                             jmp	monreg			; got a branch out of range here when debugging code
                                        								; was included
   1445 C011                            .2
                                        ;
   1447 C011 8D 05 01                             sta vecbrkia          ;save vector for exit
   1448 C014 A9 42                    +            lda #<monbrk
   1448 C016 C0                       +            .byte >monbrk
                                        ;Supermon 816 intercepts...
   1449 C017 8D 02 01                             sta vecbrki           ;BRK handler
   1450 C01A E2 30                    +            .byte $e2,$30
                                                        ;8 bit registers
   1451 C01C A2 49                                ldx #vopsflag-reg_pbx
                                        ;
   1453 C01E 74 88                      .0000010 stz reg_pbx,x         ;clear DP storage
   1454 C020 CA                                   dex
   1455 C021 10 FB                                bpl .0000010
                                        ;
   1457 C023 A9 30                                lda #srinit
   1458 C025 85 99                                sta reg_srx           ;status register
   1459 C027 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   1460 C029 A9 FF                    +            lda #<hwstack
   1460 C02B 3F                       +            .byte >hwstack
                                        ;top of hardware stack
   1461 C02C 1B                       +            .byte $1b
                                                           ;set SP
   1462 C02D 7B                       +            .byte $7b
                                                           ;get & save...
   1463 C02E 85 9C                                sta reg_dpx           ;DP register
   1464 C030 A9 00                    +            lda #<0
   1464 C032 00                       +            .byte >0
                                        
   1465 C033 E2 20                    +            .byte $e2,$20
                                        
   1466 C035 4B                       +            .byte $4b
                                        
   1467 C036 68                                   pla                   ;capture PB &...
   1468 C037 85 88                                sta reg_pbx           ;set
   1469 C039 8B                       +            .byte $8b
                                        
   1470 C03A 68                                   pla                   ;capture DB &...
   1471 C03B 85 9B                                sta reg_dbx           ;set
   1472 C03D F4                       +            .byte $f4
   1472 C03E 34 D0                    +            .word mm_entry
                                        ;"...ready..."
   1473 C040 80 30                                bra moncom
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monbrk: SOFTWARE INTERRUPT INTERCEPT
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This is the entry point taken when a BRK instruction is executed.  It is
                                        ;	assumed that the BRK  handler has pushed the registers to the stack that
                                        ;	are not automatically pushed by the MPU in response to BRK.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1485 C042 58                         monbrk   cli                   ;reenable IRQs
   1486 C043                            		 phds
   1487 C043 68                          		 pla
   1488 C044 85 82                       		 sta reg_dsx
                                           		 CPU	FT832
   1490 00C046 42 7A                        		 tssa
   1491 00C048 85 84                        		 sta	reg_ssx
                                        		 CPU	W65C02
   1493 C04A 7A                                   ply                   ;recover registers
   1494 C04B FA                                   plx
   1495 C04C 68                                   pla
   1496 C04D C2 30                    +            .byte $c2,$30
                                                         ;store 16 bit registers
   1497 C04F 85 89                                sta reg_ax            ;.A
   1498 C051 86 8D                                stx reg_xx            ;.X
   1499 C053 84 91                                sty reg_yx            ;.Y
   1500 C055 E2 10                    +            .byte $e2,$10
                                                        ;8 bit index registers
   1501 C057 68                                   pla                   ;get DP &...
   1502 C058 85 9C                                sta reg_dpx           ;store
   1503 C05A FA                                   plx                   ;get DB &...
   1504 C05B 86 9B                                stx reg_dbx           ;store
   1505 C05D FA                                   plx                   ;get SR &...
   1506 C05E 86 99                                stx reg_srx           ;store
   1507 C060 68                                   pla                   ;get PC &...
   1508 C061 85 86                                sta reg_pcx           ;store
   1509 C063 E2 20                    +            .byte $e2,$20
                                        
   1510 C065 68                                   pla                   ;get PB &...
   1511 C066 85 88                                sta reg_pbx           ;store
   1512 C068 C2 20                    +            .byte $c2,$20
                                        
   1513 C06A 68                          		 pla				   ; get CS &...
   1514 C06B 85 80                       		 sta	reg_csx		   ; store
   1515 C06D E2 20                    +            .byte $e2,$20
                                        
   1516 C06F F4                       +            .byte $f4
   1516 C070 29 D0                    +            .word mm_brk
                                        ;"*BRK"
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncom: COMMON ENTRY POINT
                                        ;
                                        ;	——————————————————————————————————————
                                        ;	DO NOT directly call this entry point!
                                        ;	——————————————————————————————————————
                                        ;
   1526 C072                            moncom   
   1527 C072 20 1D C8                    		 jsr sprint            ;print heading
   1528 C075 C2 20                    +            .byte $c2,$20
                                        
   1529 C077 3B                       +            .byte $3b
                                                           ;get SP &...
   1530 C078 85 95                                sta reg_spx           ;store
   1531 C07A C2 FF                    +            .byte $c2,%11111111
                                        ;clear SR &...
   1532 C07C E2 30                    +            .byte $e2,srinit
                                        ;set default state
   1533 C07E 38                                   sec                   ;see next
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monreg: DISPLAY MPU REGISTERS
                                        ;
                                        ;	—————————
                                        ;	syntax: R
                                        ;	—————————
                                        ;
   1543 C07F B0 03                      monreg   bcs .0000010          ;okay to proceed
                                        ;
   1545 C081 4C 65 C1                             jmp monerr            ;error if called with a parm
                                        ;
   1547 C084 F4                         .0000010 +         .byte $f4
   1547 C085 5F D0                    +            .word mm_regs
                                        
   1548 C087 20 1D C8                             jsr sprint            ;display heading
                                        ;
                                        ;
                                        ;	display code selector & program bank & counter...
                                        ;
   1553 C08A C2 20                    +            .byte $c2,$20
                                        
   1554 C08C A5 80                       		 lda	reg_csx
   1555 C08E E2 20                    +            .byte $e2,$20
                                        
   1556 C090 20 D7 C7                    		 jsr    dpyhexw
   1557 C093 E2 20                    +            .byte $e2,$20
                                        
   1558 C095 A9 3A                       		 lda #a_colon
   1559 C097 20 17 C8                             jsr printcmn          ;':'
   1560 C09A A5 88                                lda reg_pbx           ;PB
   1561 C09C 20 E7 C7                             jsr dpyhex            ;display as hex ASCII
   1562 C09F 20 15 C8                             jsr printspc          ;inter-field space
   1563 C0A2 C2 20                    +            .byte $c2,$20
                                        
   1564 C0A4 A5 86                                lda reg_pcx
   1565 C0A6 E2 20                    +            .byte $e2,$20
                                        
   1566 C0A8 20 D7 C7                             jsr dpyhexw           ;display PC
   1567 C0AB A2 02                                ldx #2
   1568 C0AD 20 F6 C7                             jsr multspc           ;inter-field spacing
                                        ;
                                        ;
                                        ;	display SR in bitwise fashion...
                                        ;
   1573 C0B0 A5 9A                       		 lda reg_srxx
   1574 C0B2 4A                          		 lsr
   1575 C0B3 4A                          		 lsr
   1576 C0B4 69 30                       		 adc #'0'
                                           		 cpu FT832
   1578 00C0B6 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1580 C0BB A5 9A                       		 lda reg_srxx
   1581 C0BD 4A                          		 lsr
   1582 C0BE 69 30                       		 adc #'0'
                                           		 cpu FT832
   1584 00C0C0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        
   1587 C0C5 A6 99                                ldx reg_srx           ;SR
   1588 C0C7 A0 08                                ldy #s_bibyte         ;bits in a byte
                                        ;
   1590 C0C9 8A                         .0000020 txa                   ;remaining SR bits
   1591 C0CA 0A                                   asl                   ;grab one of them
   1592 C0CB AA                                   tax                   ;save remainder
   1593 C0CC A9 30                                lda #'0'              ;a clear bit but...
   1594 C0CE 69 00                                adc #0                ;adjust if set &...
                                           		 cpu FT832
   1596 00C0D0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1598 C0D5 88                                   dey                   ;bit processed
   1599 C0D6 D0 F1                                bne .0000020          ;do another
                                        ;
                                        ;
                                        ;	display .C, .X, .Y, SP & DP...
                                        ;
   1604 C0D8 20 15 C8                   .0000030 jsr printspc          ;spacing
   1605 C0DB C2 20                    +            .byte $c2,$20
                                        
   1606 C0DD B9 8B 00                             lda reg_ax+2,y        ;get register value
   1607 C0E0 E2 20                    +            .byte $e2,$20
                                        
   1608 C0E2 20 D7 C7                             jsr dpyhexw           ;convert & display
   1609 C0E5 C2 20                    +            .byte $c2,$20
                                        
   1610 C0E7 B9 89 00                             lda reg_ax,y          ;get register value
   1611 C0EA E2 20                    +            .byte $e2,$20
                                        
   1612 C0EC 20 D7 C7                             jsr dpyhexw           ;convert & display
                                        ;         .rept s_word
   1614 C0EF C8                                     iny
   1615 C0F0 C8                                     iny
                                        ;         .endr
                                        ;         .rept s_word
   1618 C0F1 C8                                     iny
   1619 C0F2 C8                                     iny
                                        ;         .endr
   1621 C0F3 C0 0F                                cpy #reg_spx-reg_ax+3
   1622 C0F5 90 E1                                bcc .0000030          ;next
                                        ;
                                        ;
                                        ;	display DS SS DB...
                                        ;
   1627 C0F7 F4                       +            .byte $f4
   1627 C0F8 BB D0                    +            .word mm_regs2
                                        
   1628 C0FA 20 1D C8                    		 jsr sprint
   1629 C0FD C2 20                    +            .byte $c2,$20
                                        
   1630 C0FF A5 82                                lda reg_dsx          ;get DS &...
   1631 C101 E2 20                    +            .byte $e2,$20
                                        
   1632 C103 20 D7 C7                             jsr dpyhexw           ;convert & display
   1633 C106 20 15 C8                             jsr printspc          ;more spacing
   1634 C109 C2 20                    +            .byte $c2,$20
                                        
   1635 C10B A5 84                                lda reg_ssx           ;get SS &...
   1636 C10D E2 20                    +            .byte $e2,$20
                                        
   1637 C10F 20 D7 C7                             jsr dpyhexw           ;convert & display
   1638 C112 20 15 C8                             jsr printspc          ;more spacing
   1639 C115 A5 9B                                lda reg_dbx           ;get DB &...
   1640 C117 20 E7 C7                             jsr dpyhex            ;display it
   1641 C11A 20 15 C8                             jsr printspc          ;more spacing
   1642 C11D C2 20                    +            .byte $c2,$20
                                        
   1643 C11F A5 9C                                lda reg_dpx           ;get DPR &...
   1644 C121 E2 20                    +            .byte $e2,$20
                                        
   1645 C123 20 D7 C7                             jsr dpyhexw           ;convert & display
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monce: COMMAND EXECUTIVE
                                        ;	
   1651 C126 E2 20                      monce +         .byte $e2,$20
                                        
   1652 C128 A9 00                                lda #0                ;default buffer index
                                        ;
   1654 C12A E2 30                      moncea +         .byte $e2,$30
                                                        ;alternate entry point
   1655 C12C 85 BF                                sta ibufidx           ;(re)set buffer index
   1656 C12E F4                       +            .byte $f4
   1656 C12F 56 D0                    +            .word mm_prmpt
                                        
   1657 C131 20 1D C8                             jsr sprint            ;display input prompt
   1658 C134 20 3F CC                             jsr input             ;await some input
                                        ;
   1660 C137                            .0000010:
   1661 C137 20 A1 CC                    		jsr getcharc          ;read from buffer
   1662 C13A F0 EA                                beq monce             ;terminator, just loop
                                        ;
   1664 C13C C9 20                                cmp #a_blank
   1665 C13E F0 F7                                beq .0000010          ;strip leading blanks
                                        ;
   1667 C140 A2 0C                                ldx #n_mpctab-1       ;number of primary commands
                                        ;
   1669 C142 DD BB CC                   .0000020 cmp mpctab,x          ;search primary command list
   1670 C145 D0 0E                                bne .0000030
                                        ;
   1672 C147 8A                                   txa                   ;get index
   1673 C148 0A                                   asl                   ;double for offset
   1674 C149 AA                                   tax
   1675 C14A C2 20                    +            .byte $c2,$20
                                        
   1676 C14C BD C8 CC                             lda mpcextab,x        ;command address -1
   1677 C14F 48                                   pha                   ;prime the stack
   1678 C150 E2 20                    +            .byte $e2,$20
                                        
   1679 C152 4C E3 CA                             jmp getparm           ;evaluate parm & execute command
                                        ;
   1681 C155 CA                         .0000030 dex
   1682 C156 10 EA                                bpl .0000020          ;continue searching primary commands
                                        ;
   1684 C158 A2 03                                ldx #n_radix-1        ;number of radices
                                        ;
   1686 C15A DD F6 CC                   .0000040 cmp radxtab,x         ;search conversion command list
   1687 C15D D0 03                                bne .0000050
                                        ;
   1689 C15F 4C AF C5                             jmp monenv            ;convert & display parameter
                                        ;
   1691 C162 CA                         .0000050 dex
   1692 C163 10 F5                                bpl .0000040
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monerr: COMMON ERROR HANDLER
                                        ;
   1698 C165 E2 30                      monerr +         .byte $e2,$30
                                                        ;8 bit registers
                                        ;
   1700 C167 20 BE C7                   monerraa jsr dpyerr            ;indicate an error &...
   1701 C16A 80 BA                                bra monce             ;return to input loop
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monasc: ASSEMBLE CODE
                                        ;
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;	syntax: A <addr> <mnemonic> [<argument>]
                                        ;
                                        ;	After a line of code has been successfully assembled it will be disass-
                                        ;	embled & displayed,  & the monitor will prompt with the next address to
                                        ;	which code may be assembled.
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;
   1715 C16C 90 03                      monasc   bcc .0000020          ;assembly address entered
                                        ;
   1717 C16E 4C 65 C1                   .0000010 jmp monerr            ;terminate w/error
                                        ;
                                        ;
                                        ;	evaluate assembly address...
                                        ;
   1722 C171 20 CF CA                   .0000020 jsr facasize          ;check address...
   1723 C174 C9 04                                cmp #s_dword          ;range
   1724 C176 B0 F6                                bcs .0000010          ;out of range — error
                                        ;
   1726 C178 20 B1 CA                             jsr facaddra          ;store assembly address
                                        ;
                                        ;
                                        ;	initialize workspace...
                                        ;
   1731 C17B A2 1F                                ldx #s_auxbuf-s_byte
                                        ;
   1733 C17D 9E 51 02                   .0000030 stz auxbuf,x          ;clear addressing mode buffer
   1734 C180 CA                                   dex
   1735 C181 D0 FA                                bne .0000030
                                        ;
   1737 C183 A9 20                                lda #a_blank
   1738 C185 8D 51 02                             sta auxbuf            ;preamble placeholder
   1739 C188 20 1E CA                             jsr clroper           ;clear operand
   1740 C18B 64 BE                                stz auxbufix          ;reset addressing mode index
   1741 C18D 64 CE                                stz flimflag          ;clear forced long immediate
   1742 C18F 64 C8                                stz mnepck            ;clear encoded...
   1743 C191 64 C9                                stz mnepck+s_byte     ;mnemonic workspace
   1744 C193 64 D1                                stz vopsflag          ;clear 8/16 or relative flag
                                        ;
                                        ;
                                        ;	encode mnemonic...
                                        ;
   1749 C195 A0 03                                ldy #s_mnemon         ;expected mnemonic size
                                        ;
   1751 C197 20 30 CC                   .0000040 jsr getcharw          ;get from buffer wo/whitespace
   1752 C19A D0 0A                                bne .0000060          ;gotten
                                        ;
   1754 C19C C0 03                                cpy #s_mnemon         ;any input at all?
   1755 C19E 90 03                                bcc .0000050          ;yes
                                        ;
   1757 C1A0 4C 26 C1                             jmp monce             ;no, abort further assembly
                                        ;
   1759 C1A3 4C 45 C3                   .0000050 jmp monasc10          ;incomplete mnemonic — error
                                        ;
   1761 C1A6 38                         .0000060 sec
   1762 C1A7 E9 3F                                sbc #a_mnecvt         ;ASCII to binary factor
   1763 C1A9 A2 05                                ldx #n_shfenc         ;shifts required to encode
                                        ;
   1765 C1AB 4A                         .0000070 lsr                   ;shift out a bit...
   1766 C1AC 66 C9                                ror mnepck+s_byte     ;into...
   1767 C1AE 66 C8                                ror mnepck            ;encoded mnemonic
   1768 C1B0 CA                                   dex
   1769 C1B1 D0 F8                                bne .0000070          ;next bit
                                        ;
   1771 C1B3 88                                   dey
   1772 C1B4 D0 E1                                bne .0000040          ;get next char
                                        ;
                                        ;
                                        ;	test for copy instruction...
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The MVN & MVP instructions accept two operands & hence have an irregular
                                        ;	syntax.  Therefore, special handling is necessary to assemble either of
                                        ;	these instructions.
                                        ;
                                        ;	The official WDC syntax has the programmer entering a pair of 24 bit ad-
                                        ;	dresses as operands, with the assembler isolating bits 16-23 to	use as
                                        ;	operands.  This formality has been dispensed with in this monitor & the
                                        ;	operands are expected to be 8 bit bank values.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1787 C1B6 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   1788 C1B8 A5 C8                                lda mnepck            ;packed menmonic
   1789 C1BA A2 54                                ldx #opc_mvn          ;MVN opcode
   1790 C1BC C9 DC                    +            cmp #<mne_mvn
   1790 C1BE 7D                       +            .byte >mne_mvn
                                        ;is it MVN?
   1791 C1BF F0 07                                beq monasc01          ;yes
                                        ;
   1793 C1C1 A2 44                                ldx #opc_mvp          ;MVP opcode
   1794 C1C3 C9 DC                    +            cmp #<mne_mvp
   1794 C1C5 8D                       +            .byte >mne_mvp
                                        ;is it MVP?
   1795 C1C6 D0 30                                bne monasc02          ;no
                                        ;
                                        ;
                                        ;	assemble copy instruction...
                                        ;
   1800 C1C8 86 CA                      monasc01 stx opcode            ;store relevant opcode
   1801 C1CA E2 20                    +            .byte $e2,$20
                                        
   1802 C1CC 20 3F CB                             jsr instdata          ;get instruction data
   1803 C1CF 86 CD                                stx eopsize           ;effective operand size
   1804 C1D1 E8                                   inx
   1805 C1D2 86 C6                                stx instsize          ;instruction size
   1806 C1D4 A2 01                                ldx #s_oper-s_word    ;operand index
   1807 C1D6 86 CC                                stx xrtemp            ;set it
                                        ;
   1809 C1D8 20 38 C8                   .0000010 jsr ascbin            ;evaluate bank number
   1810 C1DB B0 50                                bcs monasc04          ;conversion error
                                        ;
   1812 C1DD F0 4E                                beq monasc04          ;nothing returned — error
                                        ;
   1814 C1DF 20 CF CA                             jsr facasize          ;bank must be...
   1815 C1E2 C9 02                                cmp #s_word           ;8 bits
   1816 C1E4 B0 47                                bcs monasc04          ;it isn't — error
                                        ;
   1818 C1E6 A5 A7                                lda faca              ;bank
   1819 C1E8 A6 CC                                ldx xrtemp            ;operand index
   1820 C1EA 95 BB                                sta operand,x         ;store
   1821 C1EC C6 CC                                dec xrtemp            ;index=index-1
   1822 C1EE 10 E8                                bpl .0000010          ;get destination bank
                                        ;
   1824 C1F0 20 D0 CB                             jsr getcharr          ;should be no more input
   1825 C1F3 D0 38                                bne monasc04          ;there is — error
                                        ;
   1827 C1F5 4C F3 C2                             jmp monasc08          ;finish MVN/MVP assembly 
                                        ;
                                        ;
                                        ;	continue with normal assembly...
                                        ;
   1832 C1F8 E2 20                      monasc02 +         .byte $e2,$20
                                                        ;back to 8 bits
                                        ;
   1834 C1FA 20 30 CC                   monasc03 jsr getcharw          ;get next char
   1835 C1FD F0 3D                                beq monasc06          ;EOI, no argument
                                        ;
   1837 C1FF C9 21                                cmp #amp_flim
   1838 C201 D0 0A                                bne .0000010          ;no forced long immediate
                                        ;
   1840 C203 A5 CE                                lda flimflag          ;FLIM already set?
   1841 C205 D0 26                                bne monasc04          ;yes — error
                                        ;
   1843 C207 A9 C0                                lda #flimmask
   1844 C209 85 CE                                sta flimflag          ;set flag &...
   1845 C20B 80 ED                                bra monasc03          ;get next char
                                        ;
   1847 C20D C9 23                      .0000010 cmp #amp_imm          ;immediate mode?
   1848 C20F F0 08                                beq .0000020          ;yes
                                        ;
   1850 C211 C9 28                                cmp #amp_ind          ;indirect mode?
   1851 C213 F0 04                                beq .0000020          ;yes
                                        ;
   1853 C215 C9 5B                                cmp #amp_indl         ;indirect long mode?
   1854 C217 D0 07                                bne .0000030          ;no
                                        ;
   1856 C219 8D 51 02                   .0000020 sta auxbuf            ;set addressing mode preamble
   1857 C21C E6 BE                                inc auxbufix          ;bump aux buffer index &...
   1858 C21E 80 02                                bra .0000040          ;evaluate operand
                                        ;
   1860 C220 C6 BF                      .0000030 dec ibufidx           ;position back to char
                                        ;
   1862 C222 20 38 C8                   .0000040 jsr ascbin            ;evaluate operand
   1863 C225 D0 09                                bne monasc05          ;evaluated
                                        ;
   1865 C227 B0 04                                bcs monasc04          ;conversion error
                                        ;
   1867 C229 A5 BE                                lda auxbufix          ;no operand...any preamble?
   1868 C22B F0 0F                                beq monasc06          ;no, syntax is okay so far
                                        ;
   1870 C22D 4C 45 C3                   monasc04 jmp monasc10          ;abort w/error
                                        ;
   1872 C230 20 CF CA                   monasc05 jsr facasize          ;size operand
   1873 C233 C9 04                                cmp #s_dword          ;max is 24 bits
   1874 C235 B0 F6                                bcs monasc04          ;too big
                                        ;
   1876 C237 85 CD                                sta eopsize           ;save operand size
   1877 C239 20 C5 CA                             jsr facaoper          ;store operand
                                        ;
   1879 C23C C6 BF                      monasc06 dec ibufidx           ;back to last char
   1880 C23E A6 BE                                ldx auxbufix          ;mode buffer index
   1881 C240 D0 01                                bne .0000010          ;preamble in buffer
                                        ;
   1883 C242 E8                                   inx                   ;step past preamble position
                                        ;
   1885 C243 20 A1 CC                   .0000010 jsr getcharc          ;get a char w/forced UC
   1886 C246 F0 0A                                beq .0000030          ;EOI
                                        ;
   1888 C248 E0 20                                cpx #s_auxbuf         ;mode buffer full?
   1889 C24A B0 E1                                bcs monasc04          ;yes, too much input
                                        ;
   1891 C24C 9D 51 02                   .0000020 sta auxbuf,x          ;store for comparison
   1892 C24F E8                                   inx
   1893 C250 D0 F1                                bne .0000010
                                        ;
                                        ;
                                        ;	evaluate mnemonic...
                                        ;
   1898 C252 A2 5B                      .0000030 ldx #n_mnemon-1       ;starting mnemonic index
                                        ;
   1900 C254 8A                         monasc07 txa                   ;convert index...
   1901 C255 0A                                   asl                   ;to offset
   1902 C256 A8                                   tay                   ;now mnemonic table index
   1903 C257 C2 20                    +            .byte $c2,$20
                                                         ;16 bit compare
   1904 C259 B9 03 CD                             lda mnetab,y          ;get mnemonic from table
   1905 C25C C5 C8                                cmp mnepck            ;compare to entered mnemonic
   1906 C25E E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   1907 C260 F0 05                                beq .0000020          ;match
                                        ;
   1909 C262 CA                         .0000010 dex                   ;try next mnemonic
   1910 C263 30 C8                                bmi monasc04          ;unknown mnemonic — error
                                        ;
   1912 C265 80 ED                                bra monasc07          ;keep going
                                        ;
   1914 C267 86 C8                      .0000020 stx mnepck            ;save mnemonic index
   1915 C269 8A                                   txa
   1916 C26A A2 00                                ldx #0                ;trial opcode
                                        ;
   1918 C26C DD BB CD                   .0000030 cmp mnetabix,x        ;search index table...
   1919 C26F F0 05                                beq .0000050          ;for a match
                                        ;
   1921 C271 E8                         .0000040 inx                   ;keep going until we...
   1922 C272 D0 F8                                bne .0000030          ;search entire table
                                        ;
   1924 C274 80 B7                                bra monasc04          ;this shouldn't happen!
                                        ;
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;	If the mnemonic index table search fails then there is a coding error
                                        ;	somewhere, as every entry in the mnemonic table is supposed to have a
                                        ;	matching cardinal index.
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	evaluate addressing mode...
                                        ;
   1935 C276 86 CA                      .0000050 stx opcode            ;save trial opcode
   1936 C278 20 3F CB                             jsr instdata          ;get related instruction data
   1937 C27B 85 D1                                sta vopsflag          ;save 8/16 or relative flag
   1938 C27D 86 CF                                stx iopsize           ;operand size
   1939 C27F E8                                   inx
   1940 C280 86 C6                                stx instsize          ;instruction size
   1941 C282 A6 CA                                ldx opcode            ;recover trial opcode
   1942 C284 98                                   tya                   ;addressing mode
   1943 C285 0A                                   asl                   ;create table index
   1944 C286 A8                                   tay
   1945 C287 C2 20                    +            .byte $c2,$20
                                        
   1946 C289 B9 BF CF                             lda ms_lutab,y        ;mode lookup table
   1947 C28C 85 A4                                sta addrb             ;set pointer
   1948 C28E E2 20                    +            .byte $e2,$20
                                        
   1949 C290 A0 00                                ldy #0
                                        ;
   1951 C292 B1 A4                      .0000060 lda (addrb),y         ;table addressing mode
   1952 C294 D9 51 02                             cmp auxbuf,y          ;entered addressing mode
   1953 C297 F0 04                                beq .0000080          ;okay so far
                                        ;
   1955 C299 A5 C8                      .0000070 lda mnepck            ;reload mnemonic index        
   1956 C29B 80 D4                                bra .0000040          ;wrong opcode for addresing mode
                                        ;
   1958 C29D 09 00                      .0000080 ora #0                ;last char the terminator?
   1959 C29F F0 03                                beq .0000090          ;yes, evaluate operand
                                        ;
   1961 C2A1 C8                                   iny
   1962 C2A2 80 EE                                bra .0000060          ;keep testing
                                        ;
                                        ;
                                        ;	evaluate operand...
                                        ;
   1967 C2A4 A5 CD                      .0000090 lda eopsize           ;entered operand size
   1968 C2A6 D0 06                                bne .0000100          ;non-zero
                                        ;
   1970 C2A8 05 CF                                ora iopsize           ;instruction operand size
   1971 C2AA D0 ED                                bne .0000070          ;wrong opcode — keep trying
                                        ;
   1973 C2AC 80 45                                bra monasc08          ;assemble instruction
                                        ;
   1975 C2AE 24 D1                      .0000100 bit vopsflag          ;is this a branch?
   1976 C2B0 70 3A                                bvs .0000160          ;yes, evaluate
                                        ;
   1978 C2B2 A5 CF                                lda iopsize           ;instruction operand size
   1979 C2B4 24 D1                                bit vopsflag          ;variable size operand allowed?
   1980 C2B6 30 15                                bmi .0000130          ;yes
                                        ;
   1982 C2B8 24 CE                                bit flimflag          ;was forced immediate set?
   1983 C2BA 10 03                                bpl .0000110          ;no
                                        ;         
   1985 C2BC 4C 45 C3                             jmp monasc10          ;yes — error
                                        ;
   1987 C2BF C5 CD                      .0000110 cmp eopsize           ;entered operand size
   1988 C2C1 90 D6                                bcc .0000070          ;operand too big
                                        ;
   1990 C2C3 85 CD                                sta eopsize           ;new operand size
   1991 C2C5 80 2C                                bra monasc08          ;assemble, otherwise...
                                        ;
   1993 C2C7 C5 CD                      .0000120 cmp eopsize           ;exact size match required
   1994 C2C9 D0 CE                                bne .0000070          ;mismatch — wrong opcode
                                        ;
   1996 C2CB 80 26                                bra monasc08          ;assemble
                                        ;
                                        ;
                                        ;	process variable size immediate mode operand...
                                        ;
   2001 C2CD A6 CD                      .0000130 ldx eopsize           ;entered operand size
   2002 C2CF E0 03                                cpx #s_xword          ;check size
   2003 C2D1 B0 72                                bcs monasc10          ;too big — error
                                        ;
   2005 C2D3 24 CE                                bit flimflag          ;forced long immediate?
   2006 C2D5 10 06                                bpl .0000140          ;no
                                        ;
   2008 C2D7 A2 02                                ldx #s_word           ;promote operand size to...
   2009 C2D9 86 CD                                stx eopsize           ;16 bits
   2010 C2DB 80 08                                bra .0000150
                                        ;
   2012 C2DD E0 02                      .0000140 cpx #s_word           ;16 bits?
   2013 C2DF D0 04                                bne .0000150          ;no
                                        ;
   2015 C2E1 A0 C0                                ldy #flimmask         ;yes so force long...
   2016 C2E3 84 CE                                sty flimflag          ;immediate disassembly
                                        ;
   2018 C2E5 1A                         .0000150 ina                   ;new instruction operand size
   2019 C2E6 C5 CD                                cmp eopsize           ;compare against operand size
   2020 C2E8 90 AF                                bcc .0000070          ;mismatch — can't assemble
                                        ;
   2022 C2EA 80 07                                bra monasc08          ;okay, assemble
                                        ;
                                        ;
                                        ;	process relative branch...
                                        ;
   2027 C2EC 20 8B CB                   .0000160 jsr targoff           ;compute branch offset
   2028 C2EF B0 54                                bcs monasc10          ;branch out of range
                                        ;
   2030 C2F1 85 CD                                sta eopsize           ;effective operand size
                                        ;
                                        ;
                                        ;	assemble instruction...
                                        ;
   2035 C2F3 A5 CA                      monasc08 lda opcode            ;opcode
   2036 C2F5 87 A0                    +            .byte $87,addra
                                        ;store at assembly address
   2037 C2F7 A6 CD                                ldx eopsize           ;any operand to process?
   2038 C2F9 F0 09                                beq .0000020          ;no
                                        ;
   2040 C2FB 9B                       +            .byte $9b
                                                           ;also storage offset
                                        ;
   2042 C2FC CA                         .0000010 dex
   2043 C2FD B5 BB                                lda operand,x         ;get operand byte &...
   2044 C2FF 97 A0                    +            .byte $97,addra
                                        ;poke into memory
   2045 C301 88                                   dey
   2046 C302 D0 F8                                bne .0000010          ;next
                                        ;
   2048 C304 A9 0D                      .0000020 lda #a_cr
                                           		 cpu FT832
   2050 00C306 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2052 C30B A9 41                                lda #asmprfx          ;assembly prefix
   2053 C30D 20 5B C6                             jsr dpycodaa          ;disassemble & display
                                        ;
                                        ;
                                        ;	prompt for next instruction...
                                        ;
   2058 C310 A9 20                      monasc09 lda #a_blank
   2059 C312 A2 08                                ldx #ascprmct-1
                                        ;
   2061 C314 9D 00 02                   .0000010 sta ibuffer,x         ;prepare buffer for...
   2062 C317 CA                                   dex                   ;next instruction
   2063 C318 10 FA                                bpl .0000010
                                        ;
   2065 C31A A9 41                                lda #asmprfx          ;assemble code...
   2066 C31C 8D 00 02                             sta ibuffer           ;prompt prefix
   2067 C31F A5 A2                                lda addra+s_word      ;next instruction address bank
   2068 C321 20 8A C9                             jsr binhex            ;convert to ASCII
   2069 C324 8D 02 02                             sta ibuffer+apadrbkh  ;store MSN in buffer
   2070 C327 8E 03 02                             stx ibuffer+apadrbkl  ;store LSN in buffer
   2071 C32A A5 A1                                lda addra+s_byte      ;next instruction address MSB
   2072 C32C 20 8A C9                             jsr binhex
   2073 C32F 8D 04 02                             sta ibuffer+apadrmbh
   2074 C332 8E 05 02                             stx ibuffer+apadrmbl
   2075 C335 A5 A0                                lda addra             ;next instruction address LSB
   2076 C337 20 8A C9                             jsr binhex
   2077 C33A 8D 06 02                             sta ibuffer+apadrlbh
   2078 C33D 8E 07 02                             stx ibuffer+apadrlbl
   2079 C340 A9 09                                lda #ascprmct         ;effective input count
   2080 C342 4C 2A C1                             jmp moncea            ;reenter input loop
                                        ;
                                        ;
                                        ;	process assembly error...
                                        ;
   2085 C345 20 BE C7                   monasc10 jsr dpyerr            ;indicate error &...
   2086 C348 80 C6                                bra monasc09          ;prompt w/same assembly address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondsc: DISASSEMBLE CODE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: D [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2096 C34A B0 11                      mondsc   bcs .0000010          ;no parameters
                                        ;
   2098 C34C 64 CE                                stz flimflag          ;reset to 8 bit mode
   2099 C34E 20 CF CA                             jsr facasize          ;check starting...
   2100 C351 C9 04                                cmp #s_dword          ;address
   2101 C353 B0 46                                bcs .0000050          ;out of range — error
                                        ;
   2103 C355 20 B1 CA                             jsr facaddra          ;copy starting address
   2104 C358 20 E3 CA                             jsr getparm           ;get ending address
   2105 C35B 90 17                                bcc .0000020          ;gotten
                                        ;
   2107 C35D 20 9D C9                   .0000010 jsr clrfaca           ;clear accumulator
   2108 C360 C2 20                    +            .byte $c2,$20
                                        
   2109 C362 18                                   clc
   2110 C363 A5 A0                                lda addra             ;starting address
   2111 C365 69 15                    +            adc #<n_dbytes
   2111 C367 00                       +            .byte >n_dbytes
                                        ;default bytes
   2112 C368 85 A7                                sta faca              ;effective ending address
   2113 C36A E2 20                    +            .byte $e2,$20
                                        
   2114 C36C A5 A2                                lda addra+s_word      ;starting bank
   2115 C36E 69 00                                adc #0
   2116 C370 85 A9                                sta faca+s_word       ;effective ending bank
   2117 C372 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2119 C374 20 CF CA                   .0000020 jsr facasize          ;check ending...
   2120 C377 C9 04                                cmp #s_dword          ;address
   2121 C379 B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2123 C37B 20 BB CA                             jsr facaddrb          ;set ending address
   2124 C37E 20 E3 CA                             jsr getparm           ;check for excess input
   2125 C381 90 18                                bcc .0000050          ;present — error
                                        ;
   2127 C383 20 09 CA                             jsr calccnt           ;calculate bytes
   2128 C386 90 13                                bcc .0000050          ;end < start
                                        ;
   2130 C388 20 B3 CC                   .0000030 jsr teststop          ;test for display stop
   2131 C38B B0 0B                                bcs .0000040          ;stopped
                                        ;
   2133 C38D 20 05 C8                             jsr newline           ;next line
   2134 C390 20 59 C6                             jsr dpycod            ;disassemble & display
   2135 C393 20 67 CA                             jsr decdcnt           ;decrement byte count
   2136 C396 90 F0                                bcc .0000030          ;not done
                                        ;
   2138 C398 4C 26 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2140 C39B 4C 65 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjmp: EXECUTE CODE
                                        ;
                                        ;	—————————————————————————————————————————————————————————————
                                        ;	syntax: G [<addr>]
                                        ;
                                        ;	If no address is specified, the current values in the PB & PC
                                        ;	shadow registers are used.
                                        ;	—————————————————————————————————————————————————————————————
                                        ;
   2153 C39E 20 74 CB                   monjmp   jsr setxaddr          ;set execution address
   2154 C3A1 B0 29                                bcs monjmpab          ;out of range — error
                                        ;
   2156 C3A3 20 E3 CA                             jsr getparm           ;check for excess input
   2157 C3A6 90 24                                bcc monjmpab          ;too much input — error
                                        ;
   2159 C3A8 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   2160 C3AA A5 95                                lda reg_spx
   2161 C3AC 1B                       +            .byte $1b
                                                           ;restore SP
                                        ;
   2163 C3AD E2 20                      monjmpaa +         .byte $e2,$20
                                        
   2164 C3AF A5 88                                lda reg_pbx
   2165 C3B1 48                                   pha                   ;restore PB
   2166 C3B2 C2 20                    +            .byte $c2,$20
                                        
   2167 C3B4 A5 86                                lda reg_pcx
   2168 C3B6 48                                   pha                   ;restore PC
   2169 C3B7 E2 20                    +            .byte $e2,$20
                                        
   2170 C3B9 A5 99                                lda reg_srx
   2171 C3BB 48                                   pha                   ;restore SR
   2172 C3BC A5 9B                                lda reg_dbx
   2173 C3BE 48                                   pha
   2174 C3BF AB                       +            .byte $ab
                                                           ;restore DB
   2175 C3C0 C2 30                    +            .byte $c2,$30
                                        
   2176 C3C2 A5 9C                                lda reg_dpx
   2177 C3C4 5B                       +            .byte $5b
                                                           ;restore DP
   2178 C3C5 A5 89                                lda reg_ax            ;restore .C
   2179 C3C7 A6 8D                                ldx reg_xx            ;restore .X
   2180 C3C9 A4 91                                ldy reg_yx            ;restore .Y
   2181 C3CB 40                                   rti                   ;execute code
                                        ;
   2183 C3CC 4C 65 C1                   monjmpab jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjsr: EXECUTE CODE AS SUBROUTINE
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	syntax: J [<addr>]
                                        ;
                                        ;	If no address is specified the current values in the PB & PC
                                        ;	shadow registers are used.   An RTS at the end of the called
                                        ;	subroutine will return control to the monitor  provided  the
                                        ;	stack remains in balance.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2198 C3CF 20 74 CB                   monjsr   jsr setxaddr          ;set execution address
   2199 C3D2 B0 F8                                bcs monjmpab          ;out of range — error
                                        ;
   2201 C3D4 20 E3 CA                             jsr getparm           ;check for excess input
   2202 C3D7 90 F3                                bcc monjmpab          ;too much input — error
                                        ;
   2204 C3D9 C2 20                    +            .byte $c2,$20
                                        
   2205 C3DB A5 95                                lda reg_spx
   2206 C3DD 1B                       +            .byte $1b
                                                           ;restore SP &...
   2207 C3DE 20 AD C3                             jsr monjmpaa          ;call subroutine
   2208 C3E1 08                                   php                   ;push SR
   2209 C3E2 C2 30                    +            .byte $c2,$30
                                        
   2210 C3E4 85 89                                sta reg_ax            ;save...
   2211 C3E6 86 8D                                stx reg_xx            ;register...
   2212 C3E8 84 91                                sty reg_yx            ;returns
   2213 C3EA E2 10                    +            .byte $e2,$10
                                                        ;8 bit .X & .Y
   2214 C3EC FA                                   plx                   ;get & save...
   2215 C3ED 86 99                                stx reg_srx           ;return SR
   2216 C3EF 3B                       +            .byte $3b
                                                           ;get & save...
   2217 C3F0 85 95                                sta reg_spx           ;return SP
   2218 C3F2 7B                       +            .byte $7b
                                                           ;get & save...
   2219 C3F3 85 9C                                sta reg_dpx           ;DP pointer
   2220 C3F5 E2 20                    +            .byte $e2,$20
                                                        ;8 bit .A
   2221 C3F7 4B                       +            .byte $4b
                                                           ;get &...
   2222 C3F8 68                                   pla                   ;save...
   2223 C3F9 85 88                                sta reg_pbx           ;return PB
   2224 C3FB 8B                       +            .byte $8b
                                                           ;get &...
   2225 C3FC 68                                   pla                   ;save...
   2226 C3FD 85 9B                                sta reg_dbx           ;return DB
   2227 C3FF F4                       +            .byte $f4
   2227 C400 D4 D0                    +            .word mm_rts
                                        ;"*RET"
   2228 C402 4C 72 C0                             jmp moncom            ;return to monitor
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchm: CHANGE and/or DUMP MEMORY
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	syntax: > [<addr> <operand> [<operand>]...]
                                        ;
                                        ;	> <addr> without operands will dump 16 bytes
                                        ;	of memory, starting at <addr>.
                                        ;	————————————————————————————————————————————
                                        ;
   2241 C405 B0 23                      monchm   bcs .0000030          ;no address given — quit
                                        ;
   2243 C407 20 CF CA                             jsr facasize          ;size address
   2244 C40A C9 04                                cmp #s_dword
   2245 C40C B0 1F                                bcs .0000040          ;address out of range — error
                                        ;
   2247 C40E 20 B1 CA                             jsr facaddra          ;set starting address
   2248 C411 20 E4 CB                             jsr getpat            ;evaluate change pattern
   2249 C414 90 04                                bcc .0000010          ;entered
                                        ;
   2251 C416 10 0C                                bpl .0000020          ;not entered
                                        ;
   2253 C418 80 13                                bra .0000040          ;evaluation error
                                        ;
   2255 C41A 88                         .0000010 dey                   ;next byte
   2256 C41B 30 07                                bmi .0000020          ;done
                                        ;
   2258 C41D B9 51 02                             lda auxbuf,y          ;write pattern...
   2259 C420 97 A0                    +            .byte $97,addra
                                        ;to memory
   2260 C422 80 F6                                bra .0000010          ;next
                                        ;
   2262 C424 20 05 C8                   .0000020 jsr newline           ;next line
   2263 C427 20 77 C7                             jsr dpymem            ;regurgitate changes
                                        ;
   2265 C42A 4C 26 C1                   .0000030 jmp monce             ;back to command loop
                                        ;
   2267 C42D 4C 65 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncmp: COMPARE MEMORY
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: C <start> <end> <ref>
                                        ;	—————————————————————————————
                                        ;
   2277 C430 B0 26                      moncmp   bcs .0000030          ;start not given — quit
                                        ;
   2279 C432 20 8B CA                             jsr enddest           ;get end & reference addresses
   2280 C435 B0 24                                bcs .0000040          ;range or other error
                                        ;
   2282 C437 64 CC                                stz xrtemp            ;column counter
                                        ;
   2284 C439 20 B3 CC                   .0000010 jsr teststop          ;check for stop
   2285 C43C B0 1A                                bcs .0000030          ;abort
                                        ;
   2287 C43E A7 A0                    +            .byte $a7,addra
                                        ;get from reference location
   2288 C440 C7 BB                    +            .byte $c7,operand
                                        ;test against compare location
   2289 C442 F0 03                                beq .0000020          ;match, don't display address
                                        ;
   2291 C444 20 3F C6                             jsr dpycaddr          ;display current location
                                        ;
   2293 C447 20 0B CB                   .0000020 jsr nxtaddra          ;next reference location
   2294 C44A B0 0C                                bcs .0000030          ;done
                                        ;
   2296 C44C C2 20                    +            .byte $c2,$20
                                        
   2297 C44E E6 BB                                inc operand           ;bump bits 0-15
   2298 C450 E2 20                    +            .byte $e2,$20
                                        
   2299 C452 D0 E5                                bne .0000010
                                        ;
   2301 C454 E6 BD                                inc operand+s_word    ;bump bits 16-23
   2302 C456 80 E1                                bra .0000010
                                        ;
   2304 C458 4C 26 C1                   .0000030 jmp monce             ;return to command exec
                                        ;
   2306 C45B 4C 65 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncpy: COPY (transfer) MEMORY
                                        ;
                                        ;	————————————————————————————————
                                        ;	syntax: T <start> <end> <target>
                                        ;	————————————————————————————————
                                        ;
   2316 C45E B0 49                      moncpy   bcs .0000040          ;start not given — quit
                                        ;
   2318 C460 20 8B CA                             jsr enddest           ;get end & target addresses
   2319 C463 B0 47                                bcs .0000050          ;range or other error
                                        ;
   2321 C465 C2 20                    +            .byte $c2,$20
                                        
   2322 C467 38                                   sec
   2323 C468 A5 A4                                lda addrb             ;ending address
   2324 C46A E5 A0                                sbc addra             ;starting address
   2325 C46C 90 3E                                bcc .0000050          ;start > end — error
                                        ;
   2327 C46E 85 AF                                sta facb              ;bytes to copy
   2328 C470 E2 20                    +            .byte $e2,$20
                                        
   2329 C472 C2 10                    +            .byte $c2,$10
                                        
   2330 C474 A5 BD                                lda operand+s_word    ;target bank
   2331 C476 A4 BB                                ldy operand           ;target address
   2332 C478 C5 A2                                cmp addra+s_word      ;source bank
   2333 C47A C2 20                    +            .byte $c2,$20
                                        
   2334 C47C D0 1C                                bne .0000020          ;can use forward copy
                                        ;
   2336 C47E C4 A0                                cpy addra             ;source address
   2337 C480 90 18                                bcc .0000020          ;can use forward copy
                                        ;
   2339 C482 D0 02                                bne .0000010          ;must use reverse copy
                                        ;
   2341 C484 80 26                                bra .0000050          ;copy in place — error
                                        ;
   2343 C486 A5 AF                      .0000010 lda facb              ;get bytes to copy
   2344 C488 48                                   pha                   ;protect
   2345 C489 20 99 CC                             jsr lodbnk            ;load banks
   2346 C48C 20 31 CA                             jsr cprvsup           ;do reverse copy setup
   2347 C48F 68                                   pla                   ;get bytes to copy
   2348 C490 AA                                   tax                   ;save a copy
   2349 C491 18                                   clc
   2350 C492 65 BB                                adc operand           ;change target to...
   2351 C494 A8                                   tay                   ;target end
   2352 C495 8A                                   txa                   ;recover bytes to copy
   2353 C496 A6 A4                                ldx addrb             ;source end
   2354 C498 80 0C                                bra .0000030
                                        ;
   2356 C49A A5 AF                      .0000020 lda facb              ;get bytes to copy
   2357 C49C 48                                   pha                   ;protect
   2358 C49D 20 99 CC                             jsr lodbnk            ;load banks
   2359 C4A0 20 2A CA                             jsr cpfwsup           ;do forward copy setup
   2360 C4A3 68                                   pla                   ;get bytes to copy
   2361 C4A4 A6 A0                                ldx addra             ;source start
                                        ;
   2363 C4A6 4C D2 00                   .0000030 jmp mcftwork          ;copy memory
                                        ;
   2365 C4A9 4C 26 C1                   .0000040 jmp monce             ;back to executive
                                        ;
   2367 C4AC 4C 65 C1                   .0000050 jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondmp: DISPLAY MEMORY RANGE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: M [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2377 C4AF B0 0F                      mondmp   bcs .0000010          ;no parameters
                                        ;
   2379 C4B1 20 CF CA                             jsr facasize          ;check address...
   2380 C4B4 C9 04                                cmp #s_dword          ;range
   2381 C4B6 B0 46                                bcs .0000050          ;address out of range
                                        ;
   2383 C4B8 20 B1 CA                             jsr facaddra          ;copy starting address
   2384 C4BB 20 E3 CA                             jsr getparm           ;get ending address
   2385 C4BE 90 17                                bcc .0000020          ;gotten
                                        ;
   2387 C4C0 20 9D C9                   .0000010 jsr clrfaca           ;clear accumulator
   2388 C4C3 C2 20                    +            .byte $c2,$20
                                        
   2389 C4C5 18                                   clc
   2390 C4C6 A5 A0                                lda addra             ;starting address
   2391 C4C8 69 FF                    +            adc #<n_mbytes
   2391 C4CA 00                       +            .byte >n_mbytes
                                        ;default bytes
   2392 C4CB 85 A7                                sta faca              ;effective ending address
   2393 C4CD E2 20                    +            .byte $e2,$20
                                        
   2394 C4CF A5 A2                                lda addra+s_word      ;starting bank
   2395 C4D1 69 00                                adc #0
   2396 C4D3 85 A9                                sta faca+s_word       ;effective ending bank
   2397 C4D5 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2399 C4D7 20 CF CA                   .0000020 jsr facasize          ;check ending address...
   2400 C4DA C9 04                                cmp #s_dword          ;range
   2401 C4DC B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2403 C4DE 20 BB CA                             jsr facaddrb          ;copy ending address
   2404 C4E1 20 E3 CA                             jsr getparm           ;check for excess input
   2405 C4E4 90 18                                bcc .0000050          ;error
                                        ;
   2407 C4E6 20 09 CA                             jsr calccnt           ;calculate bytes to dump
   2408 C4E9 90 13                                bcc .0000050          ;end < start
                                        ;
   2410 C4EB 20 B3 CC                   .0000030 jsr teststop          ;test for display stop
   2411 C4EE B0 0B                                bcs .0000040          ;stopped
                                        ;
   2413 C4F0 20 05 C8                             jsr newline           ;next line
   2414 C4F3 20 77 C7                             jsr dpymem            ;display
   2415 C4F6 20 67 CA                             jsr decdcnt           ;decrement byte count
   2416 C4F9 90 F0                                bcc .0000030          ;not done
                                        ;
   2418 C4FB 4C 26 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2420 C4FE 4C 65 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monfil: FILL MEMORY
                                        ;
                                        ;	—————————————————————————————————————————
                                        ;	syntax: F <start> <end> <fill>
                                        ;
                                        ;	<start> & <end> must be in the same bank.
                                        ;	—————————————————————————————————————————
                                        ;
   2432 C501 B0 5E                      monfil   bcs .0000010          ;start not given — quit
                                        ;
   2434 C503 20 CF CA                             jsr facasize          ;check size
   2435 C506 C9 04                                cmp #s_dword
   2436 C508 B0 5A                                bcs .0000020          ;out of range — error...
                                        ;
   2438 C50A 20 B1 CA                             jsr facaddra          ;store start
   2439 C50D 20 E3 CA                             jsr getparm           ;evaluate end
   2440 C510 B0 52                                bcs .0000020          ;not entered — error
                                        ;
   2442 C512 20 CF CA                             jsr facasize          ;check size
   2443 C515 C9 04                                cmp #s_dword
   2444 C517 B0 4B                                bcs .0000020          ;out of range — error
                                        ;
   2446 C519 A5 A9                                lda faca+s_word       ;end bank
   2447 C51B C5 A2                                cmp addra+s_word      ;start bank
   2448 C51D D0 45                                bne .0000020          ;not same — error
                                        ;
   2450 C51F 20 BB CA                             jsr facaddrb          ;store <end>
   2451 C522 C2 20                    +            .byte $c2,$20
                                        
   2452 C524 38                                   sec
   2453 C525 A5 A4                                lda addrb             ;ending address
   2454 C527 E5 A0                                sbc addra             ;starting address
   2455 C529 90 39                                bcc .0000020          ;start > end — error
                                        ;
   2457 C52B 85 AF                                sta facb              ;bytes to copy
   2458 C52D E2 20                    +            .byte $e2,$20
                                        
   2459 C52F 20 E3 CA                             jsr getparm           ;evaluate <fill>
   2460 C532 B0 30                                bcs .0000020          ;not entered — error
                                        ;
   2462 C534 20 CF CA                             jsr facasize          ;<fill> should be...
   2463 C537 C9 02                                cmp #s_word           ;8 bits
   2464 C539 B0 29                                bcs .0000020          ;it isn't — error
                                        ;
   2466 C53B 20 C5 CA                             jsr facaoper          ;store <fill>
   2467 C53E 20 E3 CA                             jsr getparm           ;should be no more parameters
   2468 C541 90 21                                bcc .0000020          ;there are — error
                                        ;
   2470 C543 A5 BB                                lda operand           ;<fill>
   2471 C545 87 A0                    +            .byte $87,addra
                                        ;fill 1st location
   2472 C547 C2 30                    +            .byte $c2,$30
                                                         ;16 bit operations
   2473 C549 A5 AF                                lda facb              ;
   2474 C54B F0 14                                beq .0000010          ;only 1 location — finished
                                        ;
   2476 C54D 3A                                   dea                   ;zero align &...
   2477 C54E 48                                   pha                   ;protect
   2478 C54F E2 20                    +            .byte $e2,$20
                                        
   2479 C551 A5 A2                                lda addra+s_word      ;start bank
   2480 C553 EB                       +            .byte $eb
                                        
   2481 C554 A5 A6                                lda addrb+s_word      ;end bank
   2482 C556 20 2A CA                             jsr cpfwsup           ;do forward copy setup
   2483 C559 68                                   pla                   ;recover fill count
   2484 C55A A6 A0                                ldx addra             ;fill-from starting location
   2485 C55C 9B                       +            .byte $9b
                                        
   2486 C55D C8                                   iny                   ;fill-to starting location
   2487 C55E 4C D2 00                             jmp mcftwork          ;fill memory
                                        ;
   2489 C561 4C 26 C1                   .0000010 jmp monce             ;goto command executive
                                        ;
   2491 C564 4C 65 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monhnt: SEARCH (hunt) MEMORY
                                        ;
                                        ;	———————————————————————————————————
                                        ;	syntax: H <addr1> <addr2> <pattern>
                                        ;	———————————————————————————————————
                                        ;
   2501 C567 B0 40                      monhnt   bcs .0000050          ;no start address
                                        ;
   2503 C569 20 CF CA                             jsr facasize          ;size starting address
   2504 C56C C9 04                                cmp #s_dword
   2505 C56E B0 3C                                bcs .0000060          ;address out of range — error
                                        ;
   2507 C570 20 B1 CA                             jsr facaddra          ;store starting address
   2508 C573 20 E3 CA                             jsr getparm           ;evaluate ending address
   2509 C576 B0 34                                bcs .0000060          ;no address — error
                                        ;
   2511 C578 20 CF CA                             jsr facasize          ;size ending address
   2512 C57B C9 04                                cmp #s_dword
   2513 C57D B0 2D                                bcs .0000060          ;address out of range — error
                                        ;
   2515 C57F 20 BB CA                             jsr facaddrb          ;store ending address
   2516 C582 20 09 CA                             jsr calccnt           ;calculate byte range
   2517 C585 90 25                                bcc .0000060          ;end < start
                                        ;
   2519 C587 20 E4 CB                             jsr getpat            ;evaluate search pattern
   2520 C58A B0 20                                bcs .0000060          ;error
                                        ;
   2522 C58C 64 CC                                stz xrtemp            ;clear column counter
                                        ;
   2524 C58E 20 B3 CC                   .0000010 jsr teststop          ;check for stop
   2525 C591 B0 16                                bcs .0000050          ;abort
                                        ;
   2527 C593 A4 BE                                ldy auxbufix          ;pattern index
                                        ;
   2529 C595 88                         .0000020 dey
   2530 C596 30 09                                bmi .0000030          ;pattern match
                                        ;
   2532 C598 B7 A0                    +            .byte $b7,addra
                                        ;get from memory
   2533 C59A D9 51 02                             cmp auxbuf,y          ;test against pattern
   2534 C59D D0 05                                bne .0000040          ;mismatch, next location
                                        ;
   2536 C59F F0 F4                                beq .0000020          ;match, keep testing
                                        ;
   2538 C5A1 20 3F C6                   .0000030 jsr dpycaddr          ;display current location
                                        ;
   2540 C5A4 20 0B CB                   .0000040 jsr nxtaddra          ;next location
   2541 C5A7 90 E5                                bcc .0000010          ;not done
                                        ;
   2543 C5A9 4C 26 C1                   .0000050 jmp monce             ;back to executive
                                        ;
   2545 C5AC 4C 65 C1                   .0000060 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monenv: CONVERT NUMERIC VALUE
                                        ;
                                        ;	——————————————————————
                                        ;	syntax: <radix><value>
                                        ;	——————————————————————
                                        ;
   2555 C5AF 20 E1 CA                   monenv   jsr getparmr          ;reread & evaluate parameter
   2556 C5B2 B0 26                                bcs .0000020          ;none entered
                                        ;
   2558 C5B4 A2 00                                ldx #0                ;radix index
   2559 C5B6 A0 04                                ldy #n_radix          ;number of radices
                                        ;
   2561 C5B8 5A                         .0000010 phy                   ;save counter
   2562 C5B9 DA                                   phx                   ;save radix index
   2563 C5BA 20 05 C8                             jsr newline           ;next line &...
   2564 C5BD 20 6D C7                             jsr clearlin          ;clear it
   2565 C5C0 A9 20                                lda #a_blank
   2566 C5C2 A2 04                                ldx #halftab
   2567 C5C4 20 F6 C7                             jsr multspc           ;indent 1/2 tab
   2568 C5C7 FA                                   plx                   ;get radix index but...
   2569 C5C8 DA                                   phx                   ;put it back
   2570 C5C9 BD F6 CC                             lda radxtab,x         ;get radix
   2571 C5CC 20 F6 C8                             jsr binasc            ;convert to ASCII
   2572 C5CF 5A                                   phy                   ;string address MSB
   2573 C5D0 DA                                   phx                   ;string address LSB
   2574 C5D1 20 1D C8                             jsr sprint            ;print
   2575 C5D4 FA                                   plx                   ;get index again
   2576 C5D5 7A                                   ply                   ;get counter
   2577 C5D6 E8                                   inx
   2578 C5D7 88                                   dey
   2579 C5D8 D0 DE                                bne .0000010          ;no
                                        
   2581 C5DA 4C 26 C1                   .0000020 jmp monce             ;back to command exec
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchr: CHANGE REGISTERS
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	syntax: ; [PB [PC [.S [.C [.X [.Y [SP [DP [DB]]]]]]]]]
                                        ;
                                        ;	; with no parameters is the same as the R command.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   2593 C5DD B0 33                      monchr   bcs .0000040          ;dump registers & quit
                                        ;
   2595 C5DF A0 00                                ldy #0                ;register counter
   2596 C5E1 84 B5                                sty facc              ;initialize register index
                                        ;
   2598 C5E3 20 CF CA                   .0000010 jsr facasize          ;get parameter size
   2599 C5E6 D9 FA CC                             cmp rcvltab,y         ;check against size table
   2600 C5E9 B0 2A                                bcs .0000050          ;out of range
                                        ;
   2602 C5EB B9 FA CC                             lda rcvltab,y         ;determine number of bytes...
   2603 C5EE C9 03                                cmp #s_word+1         ;to store
   2604 C5F0 66 B6                                ror facc+s_byte       ;condition flag
   2605 C5F2 10 02                                bpl .0000020          ;8 bit register size
                                        ;
   2607 C5F4 C2 20                    +            .byte $c2,$20
                                                         ;16 bit register size
                                        ;
   2609 C5F6 A6 B5                      .0000020 ldx facc              ;get register index
   2610 C5F8 A5 A7                                lda faca              ;get parm
   2611 C5FA 95 88                                sta reg_pbx,x         ;put in shadow storage
   2612 C5FC E2 20                    +            .byte $e2,$20
                                        
   2613 C5FE 06 B6                                asl facc+s_byte       ;mode flag to carry
   2614 C600 8A                                   txa                   ;register index
   2615 C601 69 01                                adc #s_byte           ;at least 1 byte stored
   2616 C603 85 B5                                sta facc              ;save new index
   2617 C605 20 E3 CA                             jsr getparm           ;get a parameter
   2618 C608 B0 08                                bcs .0000040          ;EOI
                                        ;
   2620 C60A C8                                   iny                   ;bump register count
   2621 C60B C0 09                                cpy #n_regchv         ;all registers processed?
   2622 C60D D0 D4                                bne .0000010          ;no, keep going
                                        ;
   2624 C60F 20 11 C8                   .0000030 jsr alert             ;excessive input
                                        ;
   2626 C612 4C 7F C0                   .0000040 jmp monreg            ;display changes
                                        ;
   2628 C615 4C 65 C1                   .0000050 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monxit: EXIT TO OPERATING ENVIRONMENT
                                        ;
                                        ;	—————————
                                        ;	syntax: X
                                        ;	—————————
                                        ;
   2638 C618 90 22                      monxit   bcc .0000020          ;no parameters allowed
                                        ;
   2640 C61A C2 20                    +            .byte $c2,$20
                                        
   2641 C61C AD 02 01                             lda vecbrki           ;BRK indirect vector
   2642 C61F C9 42                    +            cmp #<monbrk
   2642 C621 C0                       +            .byte >monbrk
                                        ;we intercept it?
   2643 C622 D0 09                                bne .0000010          ;no, don't change it
                                        ;
   2645 C624 AD 05 01                             lda vecbrkia          ;old vector
   2646 C627 8D 02 01                             sta vecbrki           ;restore it
   2647 C62A 9C 05 01                             stz vecbrkia          ;invalidate old vector
                                        ;         
   2649 C62D E2 30                      .0000010 +         .byte $e2,$30
                                        
                                           		 CPU FT832
   2651 00C62F 64 CE                        		 STZ	$CE
   2652 00C631 64 CF                        		 STZ	$CF
   2653 00C633 42 CB 42 A2 00 00            		 TSK	JMP:#0
   2654 00C639 4C 00 C0                     		 JMP	$C000
                                        		 CPU	W65C02
                                        ;         jml vecexit           ;long jump to exit
                                        ;
   2658 C63C 4C 65 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * *                                         * *
                                        ; * * S T A R T   o f   S U B R O U T I N E S * *
                                        ; * *                                         * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;dpycaddr: DISPLAY CURRENT ADDRESS IN COLUMNS
                                        ;
   2670 C63F A6 CC                      dpycaddr ldx xrtemp            ;column count
   2671 C641 D0 05                                bne .0000010          ;not at right side
                                        ;
   2673 C643 20 05 C8                             jsr newline           ;next row
   2674 C646 A2 08                                ldx #n_hccols         ;max columns
                                        ;
   2676 C648 E0 08                      .0000010 cpx #n_hccols         ;max columns
   2677 C64A F0 07                                beq .0000020          ;at left margin
                                        ;
   2679 C64C A9 09                                lda #a_ht
                                           		 cpu FT832
   2681 00C64E 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2684 C653 CA                         .0000020 dex                   ;one less column
   2685 C654 86 CC                                stx xrtemp            ;save column counter
   2686 C656 4C CA C7                             jmp prntladr          ;print reference address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpycod: DISASSEMBLE & DISPLAY CODE
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This function disassembles & displays the machine code at  the  location
                                        ;	pointed to by ADDRA.  Upon return, ADDRA will point to the opcode of the
                                        ;	next instruction.   The entry point at DPYCODAA  should be called with a
                                        ;	disassembly prefix character loaded in .A.   If entered  at  DPYCOD, the
                                        ;	default character will be display at the beginning of each  disassembled
                                        ;	instruction.
                                        ;
                                        ;	The disassembly of immediate mode instructions that can take an 8 or  16
                                        ;	bit operand is affected by the bit pattern that is  stored  in  FLIMFLAG
                                        ;	upon entry to this function:
                                        ;
                                        ;	    FLIMFLAG: xx000000
                                        ;	              ||
                                        ;	              |+—————————> 0:  8 bit .X or .Y operand
                                        ;	              |            1: 16 bit .X or .Y operand
                                        ;	              +——————————> 0:  8 bit .A or BIT # operand
                                        ;	                           1: 16 bit .A or BIT # operand
                                        ;
                                        ;	FLIMFLAG is conditioned according to the operand of  the  most  recently
                                        ;	disassembled REP or SEP instruction.   Hence repetitive  calls  to  this
                                        ;	subroutine will usually result in the correct disassembly of 16 bit imm-
                                        ;	ediate mode instructions.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   2717 C659 A9 2E                       public dpycod   lda #disprfx          ;default prefix
                                        ;
                                        ;
                                        ;	alternate prefix display entry point...
                                        ;
   2722 C65B                            dpycodaa 
                                           		 cpu FT832
   2724 00C65B 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2726 C660 20 15 C8                             jsr printspc          ;space
   2727 C663 20 CA C7                             jsr prntladr          ;print long address
   2728 C666 20 15 C8                             jsr printspc          ;space to opcode field
   2729 C669 20 DD CA                             jsr getbyte           ;get opcode
   2730 C66C 85 CA                                sta opcode            ;save &...
   2731 C66E 20 0A C8                             jsr printbyt          ;display as hex
                                        ;
                                        ;
                                        ;	decode menmonic & addressing info...
                                        ;
   2736 C671 A6 CA                                ldx opcode            ;current mnemonic
   2737 C673 BD BB CD                             lda mnetabix,x        ;get mnemonic index
   2738 C676 0A                                   asl                   ;double for...
   2739 C677 A8                                   tay                   ;mnemonic table offset
   2740 C678 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   2741 C67A B9 03 CD                             lda mnetab,y          ;copy encoded mnemonic to...
   2742 C67D 85 C8                                sta mnepck            ;working storage
   2743 C67F E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   2744 C681 20 3F CB                             jsr instdata          ;extract mode & size data
   2745 C684 85 D1                                sta vopsflag          ;save mode flags
   2746 C686 84 C3                                sty admodidx          ;save mode index
   2747 C688 0A                                   asl                   ;variable immediate instruction?
   2748 C689 90 1F                                bcc dpycod01          ;no, effective operand size in .X
                                        ;
                                        ;
                                        ;	determine immediate mode operand size...
                                        ;
   2753 C68B A5 CA                                lda opcode            ;current opcode
   2754 C68D 24 CE                                bit flimflag          ;operand display mode
   2755 C68F 10 08                                bpl .0000010          ;8 bit .A & BIT immediate mode
                                        ;
   2757 C691 29 1F                                and #aimmaska         ;determine if...
   2758 C693 C9 09                                cmp #aimmaskb         ;.A or BIT immediate
   2759 C695 F0 10                                beq .0000030          ;display 16 bit operand
                                        ;
   2761 C697 A5 CA                                lda opcode            ;not .A or BIT immediate
                                        ;
   2763 C699 50 0F                      .0000010 bvc dpycod01          ;8 bit .X/.Y immediate mode
                                        ;
   2765 C69B A0 03                                ldy #n_vopidx-1       ;opcodes to test
                                        ;
   2767 C69D D9 BB CF                   .0000020 cmp vopidx,y          ;looking for LDX #, CPY #, etc.
   2768 C6A0 F0 07                                beq .0000040          ;disassemble a 16 bit operand
                                        ;
   2770 C6A2 88                                   dey
   2771 C6A3 10 F8                                bpl .0000020          ;keep trying
                                        ;
   2773 C6A5 80 03                                bra dpycod01          ;not .X or .Y immediate
                                        ;
   2775 C6A7 A5 CA                      .0000030 lda opcode            ;reload
                                        ;
   2777 C6A9 E8                         .0000040 inx                   ;16 bit operand
                                        ;
                                        ;
                                        ;	get & display operand bytes...
                                        ;
   2782 C6AA 86 CF                      dpycod01 stx iopsize           ;operand size...
   2783 C6AC E8                                   inx                   ;plus opcode becomes...
   2784 C6AD 86 C6                                stx instsize          ;instruction size
   2785 C6AF 86 C4                                stx charcnt           ;total bytes to process
   2786 C6B1 A9 0B                                lda #n_opcols+2       ;total operand columns plus WS
   2787 C6B3 85 CC                                sta xrtemp            ;initialize counter
   2788 C6B5 20 1E CA                             jsr clroper           ;clear operand
   2789 C6B8 A4 CF                                ldy iopsize           ;operand size
   2790 C6BA F0 16                                beq .0000020          ;no operand
                                        ;
   2792 C6BC A2 00                                ldx #0                ;operand index
                                        ;
   2794 C6BE 20 DD CA                   .0000010 jsr getbyte           ;get operand byte
   2795 C6C1 95 BB                                sta operand,x         ;save
   2796 C6C3 DA                                   phx                   ;protect operand index
   2797 C6C4 20 0A C8                             jsr printbyt          ;print operand byte
   2798 C6C7 C6 CC                                dec xrtemp            ;3 columns used, 2 for...
   2799 C6C9 C6 CC                                dec xrtemp            ;operand nybbles &...
   2800 C6CB C6 CC                                dec xrtemp            ;1 for whitespace
   2801 C6CD FA                                   plx                   ;get operand index
   2802 C6CE E8                                   inx                   ;bump it
   2803 C6CF 88                                   dey
   2804 C6D0 D0 EC                                bne .0000010          ;next
                                        ;
   2806 C6D2 A6 CC                      .0000020 ldx xrtemp            ;operand columns remaining
   2807 C6D4 20 F6 C7                             jsr multspc           ;space to mnemonic field
                                        ;
                                        ;
                                        ;	display mnemonic...
                                        ;
   2812 C6D7 A0 03                                ldy #s_mnemon         ;size of ASCII mnemonic
                                        ;
   2814 C6D9 A9 00                      .0000030 lda #0                ;initialize char
   2815 C6DB A2 05                                ldx #n_shfenc         ;shifts to execute
                                        ;
   2817 C6DD 06 C8                      .0000040 asl mnepck            ;shift encoded mnemonic
   2818 C6DF 26 C9                                rol mnepck+s_byte
   2819 C6E1 2A                                   rol
   2820 C6E2 CA                                   dex
   2821 C6E3 D0 F8                                bne .0000040
                                        ;
   2823 C6E5 69 3F                                adc #a_mnecvt         ;convert to ASCII &...
   2824 C6E7 48                                   pha                   ;stash
   2825 C6E8 88                                   dey
   2826 C6E9 D0 EE                                bne .0000030          ;continue with mnemonic
                                        ;
   2828 C6EB A0 03                                ldy #s_mnemon
                                        ;
   2830 C6ED 68                         .0000050 pla                   ;get mnenmonic byte
                                           		 cpu FT832
   2832 00C6EE 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2834 C6F3 88                                   dey
   2835 C6F4 D0 F7                                bne .0000050
                                        ;
                                        ;
                                        ;	display operand...
                                        ;
   2840 C6F6 A5 CF                                lda iopsize           ;operand size
   2841 C6F8 F0 73                                beq clearlin          ;zero, disassembly finished
                                        ;
   2843 C6FA 20 15 C8                             jsr printspc          ;space to operand field
   2844 C6FD 24 D1                                bit vopsflag          ;check mode flags
   2845 C6FF 50 08                                bvc dpycod02          ;not a branch
                                        ;
   2847 C701 20 55 CB                             jsr offtarg           ;compute branch target
   2848 C704 A6 C6                                ldx instsize          ;effective instruction size
   2849 C706 CA                                   dex
   2850 C707 86 CF                                stx iopsize           ;effective operand size
                                        ;
   2852 C709 64 D1                      dpycod02 stz vopsflag          ;clear
   2853 C70B A5 C3                                lda admodidx          ;instruction addressing mode
   2854 C70D C9 0B                                cmp #am_move          ;block move instruction?
   2855 C70F D0 02                                bne .0000010          ;no
                                        ;
   2857 C711 66 D1                                ror vopsflag          ;yes
                                        ;
   2859 C713 0A                         .0000010 asl                   ;convert addressing mode to...
   2860 C714 AA                                   tax                   ;symbology table index
   2861 C715 C2 20                    +            .byte $c2,$20
                                                         ;do a 16 bit load
   2862 C717 BD BF CF                             lda ms_lutab,x        ;addressing symbol pointer
   2863 C71A 48                                   pha
   2864 C71B E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bit loads
   2865 C71D A0 00                                ldy #0
   2866 C71F B3 01                    +            .byte $b3,1
                                        ;get 1st char
   2867 C721 C9 20                                cmp #a_blank
   2868 C723 F0 05                                beq .0000020          ;no addresing mode preamble
                                        ;
                                           		 cpu FT832
   2871 00C725 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2874 C72A A9 24                      .0000020 lda #c_hex
                                           		 cpu FT832
   2876 00C72C 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2878 C731 A4 CF                                ldy iopsize           ;operand size = index
                                        ;
   2880 C733 88                         .0000030 dey
   2881 C734 30 16                                bmi .0000040          ;done with operand
                                        ;
   2883 C736 B9 BB 00                             lda operand,y         ;get operand byte
   2884 C739 20 E7 C7                             jsr dpyhex            ;print operand byte
   2885 C73C 24 D1                                bit vopsflag          ;block move?
   2886 C73E 10 F3                                bpl .0000030          ;no
                                        ;
   2888 C740 64 D1                                stz vopsflag          ;reset
   2889 C742 5A                                   phy                   ;protect operand index
   2890 C743 F4                       +            .byte $f4
   2890 C744 F8 CF                    +            .word ms_move
                                        
   2891 C746 20 1D C8                             jsr sprint            ;display MVN/MVP operand separator
   2892 C749 7A                                   ply                   ;recover operand index again
   2893 C74A 80 E7                                bra .0000030          ;continue
                                        ;
   2895 C74C FA                         .0000040 plx                   ;symbology LSB
   2896 C74D 7A                                   ply                   ;symbology MSB
   2897 C74E E8                                   inx                   ;move past preamble
   2898 C74F D0 01                                bne .0000050
                                        ;
   2900 C751 C8                                   iny
                                        ;
   2902 C752 5A                         .0000050 phy
   2903 C753 DA                                   phx
   2904 C754 20 1D C8                             jsr sprint            ;print postamble, if any
                                        ;
                                        ;
                                        ;	condition immediate mode display format...
                                        ;
   2909 C757 A5 BB                      dpycod03 lda operand           ;operand LSB
   2910 C759 29 30                                and #pfmxmask         ;isolate M & X bits
   2911 C75B 0A                                   asl                   ;shift to match...
   2912 C75C 0A                                   asl                   ;FLIMFLAG alignment
   2913 C75D A6 CA                                ldx opcode            ;current instruction
   2914 C75F E0 C2                                cpx #opc_rep          ;was it REP?
   2915 C761 D0 04                                bne .0000010          ;no
                                        ;
   2917 C763 04 CE                                tsb flimflag          ;set flag bits as required
   2918 C765 80 06                                bra clearlin
                                        ;
   2920 C767 E0 E2                      .0000010 cpx #opc_sep          ;was it SEP?
   2921 C769 D0 02                                bne clearlin          ;no, just exit
                                        ;
   2923 C76B 14 CE                                trb flimflag          ;clear flag bits as required
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clearlin: CLEAR DISPLAY LINE
                                        ;
   2929 C76D F4                         clearlin +         .byte $f4
   2929 C76E 15 D0                    +            .word dc_cl
                                        
   2930 C770 80 4F                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyibuf: DISPLAY MONITOR INPUT BUFFER CONTENTS
                                        ;
   2936 C772 F4                         dpyibuf +         .byte $f4
   2936 C773 00 02                    +            .word ibuffer
                                        
   2937 C775 80 4A                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpymem: DISPLAY MEMORY
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	This function displays 16 bytes of memory as hex values & as
                                        ;	ASCII equivalents.  The starting address for the display is
                                        ;	in ADDRA & is expected to be a 24 bit address.  Upon return,
                                        ;	ADDRA will point to the start of the next 16 bytes.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2950 C777 E2 30                      dpymem +         .byte $e2,$30
                                        
   2951 C779 64 C4                                stz charcnt           ;reset
   2952 C77B A9 3E                                lda #memprfx
                                           		 cpu FT832
   2954 00C77D 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2956 C782 20 CA C7                             jsr prntladr          ;print 24 bit address
   2957 C785 A2 00                                ldx #0                ;string buffer index
   2958 C787 A0 08                                ldy #n_dump           ;bytes per line
                                        ;
   2960 C789 20 DD CA                   .0000010 jsr getbyte           ;get from RAM, also...
   2961 C78C 48                                   pha                   ;save for decoding
   2962 C78D DA                                   phx                   ;save string index
   2963 C78E 20 0A C8                             jsr printbyt          ;display as hex ASCII
   2964 C791 E6 C4                                inc charcnt           ;bytes displayed +1
   2965 C793 FA                                   plx                   ;recover string index &...
   2966 C794 68                                   pla                   ;byte
   2967 C795 C9 20                                cmp #a_blank          ;printable?
   2968 C797 90 04                                bcc .0000020          ;no
                                        ;
   2970 C799 C9 7F                                cmp #a_del
   2971 C79B 90 02                                bcc .0000030          ;is printable
                                        ;
   2973 C79D A9 2E                      .0000020 lda #memsubch         ;substitute character
                                        ;
   2975 C79F 9D 00 02                   .0000030 sta ibuffer,x         ;save char
   2976 C7A2 E8                                   inx                   ;bump index
   2977 C7A3 88                                   dey                   ;byte count -= 1
   2978 C7A4 D0 E3                                bne .0000010          ;not done
                                        ;
   2980 C7A6 9E 00 02                             stz ibuffer,x         ;terminate ASCII string
   2981 C7A9 A9 3A                                lda #memsepch
                                           		 cpu FT832
   2983 00C7AB 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2985 C7B0 F4                       +            .byte $f4
   2985 C7B1 0B D0                    +            .word dc_bf
                                        
   2986 C7B3 20 1D C8                             jsr sprint            ;select reverse video
   2987 C7B6 20 72 C7                             jsr dpyibuf           ;display ASCII equivalents
   2988 C7B9 F4                       +            .byte $f4
   2988 C7BA 20 D0                    +            .word dc_er
                                        ;normal video
   2989 C7BC 80 03                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyerr: DISPLAY ERROR SIGNAL
                                        ;
   2995 C7BE F4                         dpyerr +         .byte $f4
   2995 C7BF 4D D0                    +            .word mm_err
                                        ;"*ERR"
                                        ;
   2997 C7C1 20 1D C8                   dpyerraa jsr sprint
   2998 C7C4 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;gendbs: GENERATE DESTRUCTIVE BACKSPACE
                                        ;
   3004 C7C5 F4                         gendbs +         .byte $f4
   3004 C7C6 11 D0                    +            .word dc_bs
                                        ;destructive backspace
   3005 C7C8 80 F7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;prntladr: PRINT 24 BIT CURRENT ADDRESS
                                        ;
   3011 C7CA 08                         prntladr php                   ;protect register sizes
   3012 C7CB E2 20                    +            .byte $e2,$20
                                        
   3013 C7CD A5 A2                                lda addra+s_word      ;get bank byte &...
   3014 C7CF 20 E7 C7                             jsr dpyhex            ;display it
   3015 C7D2 C2 20                    +            .byte $c2,$20
                                        
   3016 C7D4 A5 A0                                lda addra             ;get 16 bit address
   3017 C7D6 28                                   plp                   ;restore register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhexw: DISPLAY BINARY WORD AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .C: word to display
                                        ;
                                        ;	Returned Values: .C: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3031 C7D7 08                         dpyhexw  php                   ;save register sizes
   3032 C7D8 C2 20                    +            .byte $c2,$20
                                        
   3033 C7DA 48                                   pha                   ;protect value
   3034 C7DB E2 20                    +            .byte $e2,$20
                                        
   3035 C7DD EB                       +            .byte $eb
                                                           ;get MSB &...
   3036 C7DE 20 E7 C7                             jsr dpyhex            ;display
   3037 C7E1 C2 20                    +            .byte $c2,$20
                                        
   3038 C7E3 68                                   pla                   ;recover value
   3039 C7E4 E2 20                    +            .byte $e2,$20
                                                        ;only LSB visible
   3040 C7E6 28                                   plp                   ;reset register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhex: DISPLAY BINARY BYTE AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to display
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   3054 C7E7 20 8A C9                   dpyhex   jsr binhex            ;convert to hex ASCII
                                           		 cpu FT832
   3056 00C7EA 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3058 C7EF 8A                                   txa
                                           		 cpu FT832
   3060 00C7F0 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3062 C7F5 60                          		 rts
                                                 ;jmp putcha            ;print LSN
                                        ;
                                        ;================================================================================
                                        ;
                                        ;multspc: PRINT MULTIPLE BLANKS
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .X: number of blanks to print
                                        ;
                                        ;	Register Returns: none
                                        ;
                                        ;	Calling Example : ldx #3
                                        ;	                  jsr multspc    ;print 3 spaces
                                        ;
                                        ;	Notes: This sub will print 1 blank if .X=0.
                                        ;	————————————————————————————————————————————————
                                        ;
   3080 C7F6 8A                         multspc  txa
   3081 C7F7 D0 01                                bne .0000010          ;blank count specified
                                        ;
   3083 C7F9 E8                                   inx                   ;default to 1 blank
                                        ;
   3085 C7FA A9 20                      .0000010 lda #a_blank
                                        ;
   3087 C7FC                            .0000020 
                                           		 cpu FT832
   3089 00C7FC 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3091 C801 CA                                   dex
   3092 C802 D0 F8                                bne .0000020
                                        ;
   3094 C804 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;newline: PRINT NEWLINE (CRLF)
                                        ;
   3100 C805 F4                         newline +         .byte $f4
   3100 C806 26 D0                    +            .word dc_lf
                                        
   3101 C808 80 B7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printbyt: PRINT A BYTE WITH LEADING SPACE
                                        ;
   3107 C80A 48                         printbyt pha                   ;protect byte
   3108 C80B 20 15 C8                             jsr printspc          ;print leading space
   3109 C80E 68                                   pla                   ;restore &...
   3110 C80F 80 D6                                bra dpyhex            ;print byte
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;alert: ALERT USER w/TERMINAL BELL
                                        ;
   3116 C811 A9 07                      alert    lda #a_bel
   3117 C813 80 02                                bra printcmn
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printspc: PRINT A SPACE
                                        ;
   3123 C815 A9 20                      printspc lda #a_blank
                                        ;
   3125 C817                            printcmn 
                                           		 cpu FT832
   3127 00C817 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3129 C81C 60                          		 rts
                                        ;jmp putcha
                                        ;
                                        ;================================================================================
                                        ;
                                        ;sprint: PRINT NULL-TERMINATED CHARACTER STRING
                                        ;
                                        ;	—————————————————————————————————————————————————————————
                                        ;	Preparatory Ops : SP+1: string address LSB
                                        ;	                  SP+2: string address MSB
                                        ;
                                        ;	Register Returns: .A: used
                                        ;	                  .B: entry value
                                        ;	                  .X: used
                                        ;	                  .Y: used
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: okay
                                        ;	           |||||||      1: string too long (1)
                                        ;	           ||||+++————> not defined
                                        ;	           |||+———————> 1
                                        ;	           ||+————————> 1
                                        ;	           ++—————————> not defined
                                        ;
                                        ;	Example: PER STRING
                                        ;	         JSR SPRINT
                                        ;	         BCS TOOLONG
                                        ;
                                        ;	Notes: 1) Maximum permissible string length including the
                                        ;	          terminator is 32,767 bytes.
                                        ;	       2) All registers are forced to 8 bits.
                                        ;	       3) DO NOT JUMP OR BRANCH INTO THIS FUNCTION!
                                        ;	—————————————————————————————————————————————————————————
                                        ;
   3164 C81D E2 20                      sprint +         .byte $e2,$20
                                                        ;8 bit accumulator
   3165 C81F C2 10                    +            .byte $c2,$10
                                                         ;16 bit index
                                        ;
                                        ;—————————————————————————————————————————————————————————
   3317 = 0000000000000001                            .reetaddr =1                    ;return address
                                        
   3319 = 00000003                      .src     =.reetaddr+s_word      ;string address stack offset
                                        
                                        ;—————————————————————————————————————————————————————————
                                        ;
   3174 C821 A0 00                    +            ldy #<0
   3174 C823 00                       +            .byte >0
                                        
   3175 C824 18                                   clc                   ;no initial error
                                        ;
   3177 C825 B3 03                      .0000010 +         .byte $b3,.src
                                        ;get a byte
   3178 C827 F0 09                                beq .0000020          ;done
                                        ;
                                           		 cpu FT832
   3181 00C829 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3183 C82E C8                                   iny
   3184 C82F 10 F4                                bpl .0000010          ;next
                                        ;
   3186 C831 38                                   sec                   ;string too long
                                        ;
   3188 C832 FA                         .0000020 plx                   ;pull RTS address
   3189 C833 7A                                   ply                   ;clear string pointer
   3190 C834 DA                                   phx                   ;replace RTS
   3191 C835 E2 10                    +            .byte $e2,$10
                                        
   3192 C837 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ascbin: CONVERT NULL-TERMINATED ASCII NUMBER STRING TO BINARY
                                        ;
                                        ;	———————————————————————————————————————————————————
                                        ;	Preparatory Ops: ASCII number string in IBUFFER
                                        ;
                                        ;	Returned Values: FACA: converted parameter
                                        ;	                   .A: used
                                        ;	                   .X: used
                                        ;	                   .Y: used
                                        ;	                   .C: 1 = conversion error
                                        ;	                   .Z: 1 = nothing to convert
                                        ;
                                        ;	Notes: 1) Conversion stops when a non-numeric char-
                                        ;	          acter is encountered.
                                        ;	       2) Radix symbols are as follows:
                                        ;
                                        ;	          % binary
                                        ;	          @ octal
                                        ;	          + decimal
                                        ;	          $ hexadecimal
                                        ;
                                        ;	          Hex is the default if no radix is speci-
                                        ;	          fied in the 1st character of the string.
                                        ;	———————————————————————————————————————————————————
                                        ;
   3221 C838 E2 30                      ascbin +         .byte $e2,$30
                                        
   3222 C83A 20 9D C9                             jsr clrfaca           ;clear accumulator
   3223 C83D 64 C4                                stz charcnt           ;zero char count
   3224 C83F 64 C2                                stz radix             ;initialize
                                        ;
                                        ;
                                        ;	process radix if present...
                                        ;
   3229 C841 20 30 CC                             jsr getcharw          ;get next non-WS char
   3230 C844 D0 02                                bne .0000010          ;got something
                                        ;
   3232 C846 18                                   clc                   ;no more input
   3233 C847 60                                   rts
                                        ;
   3235 C848 A2 03                      .0000010 ldx #n_radix-1        ;number of radices
                                        ;
   3237 C84A DD F6 CC                   .0000020 cmp radxtab,x         ;recognized radix?
   3238 C84D F0 06                                beq .0000030          ;yes
                                        ;
   3240 C84F CA                                   dex
   3241 C850 10 F8                                bpl .0000020          ;try next
                                        ;
   3243 C852 C6 BF                                dec ibufidx           ;reposition to previous char
   3244 C854 E8                                   inx                   ;not recognized, assume hex
                                        ;
   3246 C855 C9 2B                      .0000030 cmp #c_dec            ;decimal radix?
   3247 C857 D0 02                                bne .0000040          ;not decimal
                                        ;
   3249 C859 66 C2                                ror radix             ;flag decimal conversion
                                        ;
   3251 C85B BD E2 CC                   .0000040 lda basetab,x         ;number bases table
   3252 C85E 85 D0                                sta range             ;set valid numeral range
   3253 C860 BD E6 CC                             lda bitsdtab,x        ;get bits per digit
   3254 C863 85 C0                                sta bitsdig           ;store
                                        ;
                                        ;
                                        ;	process numerals...
                                        ;
   3259 C865 20 D2 CB                   ascbin01 jsr getchar           ;get next char
   3260 C868 F0 70                                beq ascbin03          ;EOI
                                        ;
   3262 C86A C9 20                                cmp #' '
   3263 C86C F0 6C                                beq ascbin03          ;blank — EOF
                                        ;
   3265 C86E C9 2C                                cmp #','
   3266 C870 F0 68                                beq ascbin03          ;comma — EOF
                                        ;
   3268 C872 C9 09                                cmp #a_ht
   3269 C874 F0 64                                beq ascbin03          ;tab — EOF
                                        ;
   3271 C876 20 F7 C9                             jsr nybtobin          ;change to binary
   3272 C879 B0 60                                bcs ascbin04          ;not a recognized numeral
                                        ;
   3274 C87B C5 D0                                cmp range             ;check range
   3275 C87D B0 5C                                bcs ascbin04          ;not valid for base
                                        ;
   3277 C87F 85 C1                                sta numeral           ;save processed numeral
   3278 C881 E6 C4                                inc charcnt           ;bump numeral count
   3279 C883 24 C2                                bit radix             ;working in base 10?
   3280 C885 10 15                                bpl .0000030          ;no
                                        ;
                                        ;
                                        ;	compute N*2 for decimal conversion...
                                        ;
   3285 C887 A2 00                                ldx #0                ;accumulator index
   3286 C889 A0 02                                ldy #s_pfac/2         ;iterations
   3287 C88B C2 20                    +            .byte $c2,$20
                                        
   3288 C88D 18                                   clc
                                        ;
   3290 C88E B5 A7                      .0000020 lda faca,x            ;N
   3291 C890 2A                                   rol                   ;N=N*2
   3292 C891 95 AF                                sta facb,x
   3293 C893 E8                                   inx
   3294 C894 E8                                   inx
   3295 C895 88                                   dey
   3296 C896 D0 F6                                bne .0000020
                                        ;
   3298 C898 B0 41                                bcs ascbin04          ;overflow — error
                                        ;
   3300 C89A E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	compute N*base for binary, octal or hex...
                                        ;	or N*8 for decimal...
                                        ;
   3306 C89C A6 C0                      .0000030 ldx bitsdig           ;bits per digit
   3307 C89E C2 20                    +            .byte $c2,$20
                                                         ;16 bit shifts
                                        ;
   3309 C8A0 06 A7                      .0000040 asl faca
   3310 C8A2 26 A9                                rol faca+s_word
   3311 C8A4 B0 35                                bcs ascbin04          ;overflow — error
                                        ;
   3313 C8A6 CA                                   dex
   3314 C8A7 D0 F7                                bne .0000040          ;next shift
                                        ;
   3316 C8A9 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   3317 C8AB 24 C2                                bit radix             ;check base
   3318 C8AD 10 13                                bpl ascbin02          ;not decimal
                                        ;
                                        ;
                                        ;	compute N*10 for decimal (N*8 + N*2)...
                                        ;
   3323 C8AF A0 04                                ldy #s_pfac
   3324 C8B1 C2 20                    +            .byte $c2,$20
                                        
                                        ;
   3326 C8B3 B5 A7                      .0000050 lda faca,x            ;N*8
   3327 C8B5 75 AF                                adc facb,x            ;N*2
   3328 C8B7 95 A7                                sta faca,x            ;now N*10
   3329 C8B9 E8                                   inx
   3330 C8BA E8                                   inx
   3331 C8BB 88                                   dey
   3332 C8BC D0 F5                                bne .0000050
                                        ;
   3334 C8BE B0 1B                                bcs ascbin04          ;overflow — error
                                        ;
   3336 C8C0 E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	add current numeral to partial result...
                                        ;
   3341 C8C2 A5 A7                      ascbin02 lda faca              ;N
   3342 C8C4 65 C1                                adc numeral           ;N=N+D
   3343 C8C6 85 A7                                sta faca
   3344 C8C8 A2 01                                ldx #1
   3345 C8CA A0 03                                ldy #s_pfac-1
                                        ;
   3347 C8CC B5 A7                      .0000010 lda faca,x
   3348 C8CE 69 00                                adc #0                ;account for carry
   3349 C8D0 95 A7                                sta faca,x
   3350 C8D2 E8                                   inx
   3351 C8D3 88                                   dey
   3352 C8D4 D0 F6                                bne .0000010
                                        ;
   3354 C8D6 90 8D                                bcc ascbin01          ;next if no overflow
                                        ;
   3356 C8D8 B0 01                                bcs ascbin04          ;overflow — error
                                        ;
                                        ;
                                        ;	finish up...
                                        ;
   3361 C8DA 18                         ascbin03 clc                   ;no error
                                        ;
   3363 C8DB E2 20                      ascbin04 +         .byte $e2,$20
                                                        ;reset if necessary
   3364 C8DD A5 C4                                lda charcnt           ;load char count
   3365 C8DF 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bcdasc: CONVERT BCD DIGIT TO ASCII
                                        ;
                                        ;	———————————————————————————————————————
                                        ;	Preparatory Ops: .A: BCD digit, $00-$99
                                        ;
                                        ;	Returned Values: .A: ASCII MSD
                                        ;	                 .X: ASCII LSD
                                        ;	                 .Y: entry value
                                        ;	———————————————————————————————————————
                                        ;
   3379 C8E0 20 EC C8                   bcdasc   jsr bintonyb          ;extract nybbles
   3380 C8E3 48                                   pha                   ;save tens
   3381 C8E4 8A                                   txa                 
   3382 C8E5 09 30                                ora #btoamask         ;change units to ASCII
   3383 C8E7 AA                                   tax                   ;store
   3384 C8E8 68                                   pla                   ;get tens
   3385 C8E9 09 30                                ora #btoamask         ;change to ASCII
   3386 C8EB 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bintonyb: EXTRACT BINARY NYBBLES
                                        ;
                                        ;	—————————————————————————————————
                                        ;	Preparatory Ops: .A: binary value
                                        ;
                                        ;	Returned Values: .A: MSN
                                        ;	                 .X: LSN
                                        ;	                 .Y: entry value
                                        ;	—————————————————————————————————
                                        ;
   3400 C8EC 48                         bintonyb pha                   ;save
   3401 C8ED 29 0F                                and #bcdumask         ;extract LSN
   3402 C8EF AA                                   tax                   ;save it
   3403 C8F0 68                                   pla
                                        ;         .rept s_bnybbl        ;extract MSN
   3405 C8F1 4A                                     lsr
   3406 C8F2 4A                                     lsr
   3407 C8F3 4A                                     lsr
   3408 C8F4 4A                                     lsr
                                        ;         .endr
   3410 C8F5 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binasc: CONVERT 32-BIT BINARY TO NULL-TERMINATED ASCII NUMBER STRING
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	Preparatory Ops: FACA: 32-bit operand
                                        ;	                   .A: radix character, w/bit 7 set to
                                        ;	                       suppress radix symbol in the
                                        ;	                       conversion string
                                        ;
                                        ;	Returned Values: ibuffer: conversion string
                                        ;	                      .A: string length
                                        ;	                      .X: string address LSB
                                        ;	                      .Y: string address MSB
                                        ;
                                        ;	Execution Notes: ibufidx & instsize are overwritten.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   3430 C8F6 64 BF                      binasc   stz ibufidx           ;initialize string index
   3431 C8F8 64 C6                                stz instsize          ;clear format flag
                                        ;
                                        ;
                                        ;	evaluate radix...
                                        ;
   3436 C8FA 0A                                   asl                   ;extract format flag &...
   3437 C8FB 66 C6                                ror instsize          ;save it
   3438 C8FD 4A                                   lsr                   ;extract radix character
   3439 C8FE A2 03                                ldx #n_radix-1        ;total radices
                                        ;
   3441 C900 DD F6 CC                   .0000010 cmp radxtab,x         ;recognized radix?
   3442 C903 F0 04                                beq .0000020          ;yes
                                        ;
   3444 C905 CA                                   dex
   3445 C906 10 F8                                bpl .0000010          ;try next
                                        ;
   3447 C908 E8                                   inx                   ;assume hex
                                        ;
   3449 C909 86 C2                      .0000020 stx radix             ;save radix index for later
   3450 C90B 24 C6                                bit instsize
   3451 C90D 30 08                                bmi .0000030          ;no radix symbol wanted
                                        ;
   3453 C90F BD F6 CC                             lda radxtab,x         ;radix table
   3454 C912 8D 00 02                             sta ibuffer           ;prepend to string
   3455 C915 E6 BF                                inc ibufidx           ;bump string index
                                        ;
   3457 C917 C9 2B                      .0000030 cmp #c_dec            ;converting to decimal?
   3458 C919 D0 07                                bne .0000040          ;no
                                        ;
   3460 C91B 20 AF C9                             jsr facabcd           ;convert operand to BCD
   3461 C91E A9 00                                lda #0
   3462 C920 80 17                                bra .0000070          ;skip binary stuff
                                        ;
                                        ;
                                        ;	prepare for binary, octal or hex conversion...
                                        ;
   3467 C922 A2 00                      .0000040 ldx #0                ;operand index
   3468 C924 A0 05                                ldy #s_sfac-1         ;workspace index
                                        ;
   3470 C926 B5 A7                      .0000050 lda faca,x            ;copy operand to...
   3471 C928 99 AF 00                             sta facb,y            ;workspace in...
   3472 C92B 88                                   dey                   ;big-endian order
   3473 C92C E8                                   inx
   3474 C92D E0 04                                cpx #s_pfac
   3475 C92F D0 F5                                bne .0000050
                                        ;
   3477 C931 A9 00                                lda #0
   3478 C933 BB                       +            .byte $bb
                                        
                                        ;
   3480 C934 95 AF                      .0000060 sta facb,x            ;pad workspace
   3481 C936 CA                                   dex
   3482 C937 10 FB                                bpl .0000060
                                        ;
                                        ;
                                        ;	set up conversion parameters...
                                        ;
   3487 C939 85 B5                      .0000070 sta facc              ;initialize byte counter
   3488 C93B A4 C2                                ldy radix             ;radix index
   3489 C93D B9 F2 CC                             lda numstab,y         ;numerals in string
   3490 C940 85 B6                                sta facc+s_byte       ;set remaining numeral count
   3491 C942 B9 EA CC                             lda bitsntab,y        ;bits per numeral
   3492 C945 85 B7                                sta facc+s_word       ;set
   3493 C947 B9 EE CC                             lda lzsttab,y         ;leading zero threshold
   3494 C94A 85 B8                                sta facc+s_xword      ;set
                                        ;
                                        ;
                                        ;	generate conversion string...
                                        ;
   3499 C94C A9 00                      .0000080 lda #0
   3500 C94E A4 B7                                ldy facc+s_word       ;bits per numeral
                                        ;
   3502 C950 A2 05                      .0000090 ldx #s_sfac-1         ;workspace size
   3503 C952 18                                   clc                   ;avoid starting carry
                                        ;
   3505 C953 36 AF                      .0000100 rol facb,x            ;shift out a bit...
   3506 C955 CA                                   dex                   ;from the operand or...
   3507 C956 10 FB                                bpl .0000100          ;BCD conversion result
                                        ;
   3509 C958 2A                                   rol                   ;bit to .A
   3510 C959 88                                   dey
   3511 C95A D0 F4                                bne .0000090          ;more bits to grab
                                        ;
   3513 C95C A8                                   tay                   ;if numeral isn't zero...
   3514 C95D D0 0A                                bne .0000110          ;skip leading zero tests
                                        ;
   3516 C95F A6 B6                                ldx facc+s_byte       ;remaining numerals
   3517 C961 E4 B8                                cpx facc+s_xword      ;leading zero threshold
   3518 C963 90 04                                bcc .0000110          ;below it, must convert
                                        ;
   3520 C965 A6 B5                                ldx facc              ;processed byte count
   3521 C967 F0 11                                beq .0000130          ;discard leading zero
                                        ;
   3523 C969 C9 0A                      .0000110 cmp #10               ;check range
   3524 C96B 90 02                                bcc .0000120          ;is 0-9
                                        ;
   3526 C96D 69 06                                adc #a_hexdec         ;apply hex adjust
                                        ;
   3528 C96F 69 30                      .0000120 adc #'0'              ;change to ASCII
   3529 C971 A4 BF                                ldy ibufidx           ;string index
   3530 C973 99 00 02                             sta ibuffer,y         ;save numeral in buffer
   3531 C976 E6 BF                                inc ibufidx           ;next buffer position
   3532 C978 E6 B5                                inc facc              ;bytes=bytes+1
                                        ;
   3534 C97A C6 B6                      .0000130 dec facc+s_byte       ;numerals=numerals-1
   3535 C97C D0 CE                                bne .0000080          ;not done
                                        ;
                                        ;
                                        ;	terminate string & exit...
                                        ;
   3540 C97E A6 BF                                ldx ibufidx           ;printable string length
   3541 C980 9E 00 02                             stz ibuffer,x         ;terminate string
   3542 C983 8A                                   txa
   3543 C984 A2 00                                ldx #<ibuffer         ;converted string
   3544 C986 A0 02                                ldy #>ibuffer
   3545 C988 18                                   clc                   ;all okay
   3546 C989 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binhex: CONVERT BINARY BYTE TO HEX ASCII CHARS
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to convert
                                        ;
                                        ;	Returned Values: .A: MSN ASCII char
                                        ;	                 .X: LSN ASCII char
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————————————
                                        ;
   3560 C98A 20 EC C8                   binhex   jsr bintonyb          ;generate binary values
   3561 C98D 48                                   pha                   ;save MSN
   3562 C98E 8A                                   txa
   3563 C98F 20 94 C9                             jsr .0000010          ;generate ASCII LSN
   3564 C992 AA                                   tax                   ;save
   3565 C993 68                                   pla                   ;get input
                                        ;
                                        ;
                                        ;	convert nybble to hex ASCII equivalent...
                                        ;
   3570 C994 C9 0A                      .0000010 cmp #10
   3571 C996 90 02                                bcc .0000020          ;in decimal range
                                        ;
   3573 C998 69 66                                adc #k_hex            ;hex compensate
                                        ;         
   3575 C99A 49 30                      .0000020 eor #'0'              ;finalize nybble
   3576 C99C 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfaca: CLEAR FLOATING ACCUMULATOR A
                                        ;
   3582 C99D 08                         clrfaca  php
   3583 C99E C2 20                    +            .byte $c2,$20
                                        
   3584 C9A0 64 A7                                stz faca
   3585 C9A2 64 A9                                stz faca+s_word
   3586 C9A4 28                                   plp
   3587 C9A5 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfacb: CLEAR FLOATING ACCUMULATOR B
                                        ;
   3593 C9A6 08                         clrfacb  php
   3594 C9A7 C2 20                    +            .byte $c2,$20
                                        
   3595 C9A9 64 AF                                stz facb
   3596 C9AB 64 B1                                stz facb+s_word
   3597 C9AD 28                                   plp
   3598 C9AE 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facabcd: CONVERT FACA INTO BCD
                                        ;
   3604 C9AF A2 03                      facabcd  ldx #s_pfac-1         ;primary accumulator size -1
                                        ;
   3606 C9B1 B5 A7                      .0000010 lda faca,x            ;value to be converted
   3607 C9B3 48                                   pha                   ;preserve
   3608 C9B4 CA                                   dex
   3609 C9B5 10 FA                                bpl .0000010          ;next
                                        ;
   3611 C9B7 A2 05                                ldx #s_sfac-1         ;workspace size
                                        ;
   3613 C9B9 74 AF                      .0000020 stz facb,x            ;clear final result
   3614 C9BB 74 B5                                stz facc,x            ;clear scratchpad
   3615 C9BD CA                                   dex
   3616 C9BE 10 F9                                bpl .0000020
                                        ;
   3618 C9C0 E6 BA                                inc facc+s_sfac-s_byte
   3619 C9C2 F8                                   sed                   ;select decimal mode
   3620 C9C3 A0 1F                                ldy #m_bits-1         ;bits to convert -1
                                        ;
   3622 C9C5 A2 03                      .0000030 ldx #s_pfac-1         ;operand size
   3623 C9C7 18                                   clc                   ;no carry at start
                                        ;
   3625 C9C8 76 A7                      .0000040 ror faca,x            ;grab LS bit in operand
   3626 C9CA CA                                   dex
   3627 C9CB 10 FB                                bpl .0000040
                                        ;
   3629 C9CD 90 0D                                bcc .0000060          ;LS bit clear
                                        ;
   3631 C9CF 18                                   clc
   3632 C9D0 A2 05                                ldx #s_sfac-1
                                        ;
   3634 C9D2 B5 AF                      .0000050 lda facb,x            ;partial result
   3635 C9D4 75 B5                                adc facc,x            ;scratchpad
   3636 C9D6 95 AF                                sta facb,x            ;new partial result
   3637 C9D8 CA                                   dex
   3638 C9D9 10 F7                                bpl .0000050
                                        ;
   3640 C9DB 18                                   clc
                                        ;
   3642 C9DC A2 05                      .0000060 ldx #s_sfac-1
                                        ;
   3644 C9DE B5 B5                      .0000070 lda facc,x            ;scratchpad
   3645 C9E0 75 B5                                adc facc,x            ;double &...
   3646 C9E2 95 B5                                sta facc,x            ;save
   3647 C9E4 CA                                   dex
   3648 C9E5 10 F7                                bpl .0000070
                                        ;
   3650 C9E7 88                                   dey
   3651 C9E8 10 DB                                bpl .0000030          ;next operand bit
                                        ;
   3653 C9EA D8                                   cld
   3654 C9EB A2 00                                ldx #0
   3655 C9ED A0 04                                ldy #s_pfac
                                        ;
   3657 C9EF 68                         .0000080 pla                   ;operand
   3658 C9F0 95 A7                                sta faca,x            ;restore
   3659 C9F2 E8                                   inx
   3660 C9F3 88                                   dey
   3661 C9F4 D0 F9                                bne .0000080          ;next
                                        ;
   3663 C9F6 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nybtobin: CONVERT ASCII NYBBLE TO BINARY
                                        ;
   3669 C9F7 20 A6 CC                   nybtobin jsr toupper           ;convert case if necessary
   3670 C9FA 38                                   sec
   3671 C9FB E9 30                                sbc #'0'              ;change to binary
   3672 C9FD 90 08                                bcc .0000020          ;not a numeral — error
                                        ;
   3674 C9FF C9 0A                                cmp #10
   3675 CA01 90 03                                bcc .0000010          ;numeral is 0-9
                                        ;
   3677 CA03 E9 07                                sbc #a_hexdec+1       ;10-15 ——> A-F
   3678 CA05 18                                   clc                   ;no conversion error
                                        ;
   3680 CA06 60                         .0000010 rts
                                        ;
   3682 CA07 38                         .0000020 sec                   ;conversion error
   3683 CA08 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;calccnt: COMPUTE BYTE COUNT FROM ADDRESS RANGE
                                        ;
   3689 CA09 20 A6 C9                   calccnt  jsr clrfacb           ;clear accumulator
   3690 CA0C C2 20                    +            .byte $c2,$20
                                        
   3691 CA0E 38                                   sec
   3692 CA0F A5 A4                                lda addrb             ;ending address
   3693 CA11 E5 A0                                sbc addra             ;starting address
   3694 CA13 85 AF                                sta facb              ;byte count
   3695 CA15 E2 20                    +            .byte $e2,$20
                                        
   3696 CA17 A5 A6                                lda addrb+s_word      ;handle banks
   3697 CA19 E5 A2                                sbc addra+s_word
   3698 CA1B 85 B1                                sta facb+s_word
   3699 CA1D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clroper: CLEAR OPERAND
                                        ;
   3705 CA1E DA                         clroper  phx
   3706 CA1F A2 02                                ldx #s_oper-1
                                        ;
   3708 CA21 74 BB                      .0000010 stz operand,x
   3709 CA23 CA                                   dex
   3710 CA24 10 FB                                bpl .0000010
                                        ;
   3712 CA26 64 CD                                stz eopsize
   3713 CA28 FA                                   plx
   3714 CA29 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpfwsup: FOWARD COPY MEMORY SETUP
                                        ;
   3720 CA2A C2 30                      cpfwsup +         .byte $c2,$30
                                        
   3721 CA2C A2 54                    +            ldx #<opc_mvn
   3721 CA2E 00                       +            .byte >opc_mvn
                                        ;"move next" opcode
   3722 CA2F 80 05                                bra cpsup
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cprvsup: REVERSE COPY MEMORY SETUP
                                        ;
   3728 CA31 C2 30                      cprvsup +         .byte $c2,$30
                                        
   3729 CA33 A2 44                    +            ldx #<opc_mvp
   3729 CA35 00                       +            .byte >opc_mvp
                                        ;"move previous" opcode
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cpsup: COPY MEMORY SETUP
                                        ;
   3735 CA36 48                         cpsup    pha                   ;save banks
   3736 CA37 8A                                   txa                   ;protect...
   3737 CA38 EB                       +            .byte $eb
                                                           ;opcode
   3738 CA39 E2 20                    +            .byte $e2,$20
                                        
   3739 CA3B A2 08                    +            ldx #<(cpcodeee-cpcode-1)
   3739 CA3D 00                       +            .byte >(cpcodeee-cpcode-1)
                                        
                                        ;
   3741 CA3E BF                         .0000010 +         .byte $bf
   3741 CA3F 5E CA 00                 +   +         .byte <cpcode,>cpcode,cpcode >> 16
                                     +   
                                        ;transfer copy code to...
   3742 CA42 95 D2                                sta mcftwork,x        ;to workspace
   3743 CA44 CA                                   dex
   3744 CA45 10 F7                                bpl .0000010
                                        ;
   3746 CA47 EB                       +            .byte $eb
                                                           ;recover opcode &...
   3747 CA48 85 D3                                sta mcftopc           ;set it
   3748 CA4A C2 20                    +            .byte $c2,$20
                                        
   3749 CA4C 68                                   pla                   ;get banks &...
   3750 CA4D 85 D4                                sta mcftbnk           ;set them
                                         
                                        ; We just dynamically created a routine, so the cache (if one is present) has
                                        ; to be invalidated. Otherwise the processor could execute dead code from the
                                        ; cache. Two lines are invalidated in case the code crosses a line boundary.
                                        ;
                                        ;	acc = 16 bit address to invalidate
                                        ;
                                        ; If there is no cache in the processor then these lines can be deleted.
                                        ;-------------------------------------------------------------------------------
                                           		 CPU	FT832
                                           		 MEM	16
   3762 00CA4F 48                                    pha
   3763 00CA50 A9 D2 00                              lda	#mcftwork
   3764 00CA53 42 E0 01                     		 cache	#1				; 1= invalidate line identified by address in acc
   3765 00CA56 A9 E2 00                              lda	#mcftwork+16
   3766 00CA59 42 E0 01                     		 cache	#1
   3767 00CA5C 68                                    pla
                                        		 CPU	W65C02
   3769 CA5D                            		 MEM	8
                                        ;---------------------------------------------
   3771 CA5D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpcode: COPY MEMORY CODE
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	This code is transfered to workspace when a
                                        ;	copy or fill operation is to be performed.
                                        ;	———————————————————————————————————————————
                                        ;
   3782 CA5E 8B                         cpcode +         .byte $8b
                                                           ;must preserve data bank
                                        ;         .rept s_mvinst
   3784 CA5F EA                                     nop                 ;placeholder
   3785 CA60 EA                                     nop
   3786 CA61 EA                                     nop
                                        ;         .endr
   3788 CA62 AB                       +            .byte $ab
                                                           ;restore data bank
   3789 CA63 5C 26 C1 00                          jml monce             ;return to command executive
   3973 = 0000CA67                      cpcodeee =*                    ;placeholder — do not delete
                                        ;
                                        ;================================================================================
                                        ;
                                        ;decdcnt: DECREMENT DUMP COUNT
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	Preparatory Ops: bytes to process in FACB
                                        ;	                 bytes processed in CHARCNT
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = count = zero
                                        ;	———————————————————————————————————————————
                                        ;
   3806 CA67 E2 20                      decdcnt +         .byte $e2,$20
                                        
   3807 CA69 A9 00                                lda #0
   3808 CA6B EB                       +            .byte $eb
                                                           ;clear .B
   3809 CA6C A5 B1                                lda facb+s_word       ;count MSW
   3810 CA6E C2 20                    +            .byte $c2,$20
                                        
   3811 CA70 38                                   sec
   3812 CA71 05 AF                                ora facb              ;count LSW
   3813 CA73 F0 13                                beq .0000020          ;zero, just exit
                                        ;
   3815 CA75 A5 AF                                lda facb
   3816 CA77 E5 C4                                sbc charcnt           ;bytes processed
   3817 CA79 85 AF                                sta facb
   3818 CA7B E2 20                    +            .byte $e2,$20
                                        
   3819 CA7D A5 B1                                lda facb+s_word
   3820 CA7F E9 00                                sbc #0                ;handle borrow
   3821 CA81 90 04                                bcc .0000010          ;underflow
                                        ;
   3823 CA83 85 B1                                sta facb+s_word
   3824 CA85 18                                   clc                   ;count > 0
   3825 CA86 60                                   rts
                                        ;
   3827 CA87 38                         .0000010 sec
                                        ;
   3829 CA88 E2 20                      .0000020 +         .byte $e2,$20
                                        
   3830 CA8A 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;enddest: GET 2ND & 3RD ADDRESSES FOR COMPARE & TRANSFER
                                        ;
   3836 CA8B 20 CF CA                   enddest  jsr facasize          ;check start...
   3837 CA8E C9 04                                cmp #s_dword          ;for range
   3838 CA90 B0 1E                                bcs .0000010          ;out of range — error
                                        ;
   3840 CA92 20 B1 CA                             jsr facaddra          ;store start
   3841 CA95 20 E3 CA                             jsr getparm           ;get end
   3842 CA98 B0 16                                bcs .0000010          ;not entered — error
                                        ;
   3844 CA9A 20 CF CA                             jsr facasize          ;check end...
   3845 CA9D C9 04                                cmp #s_dword          ;for range
   3846 CA9F B0 0F                                bcs .0000010          ;out of range — error
                                        ;
   3848 CAA1 20 BB CA                             jsr facaddrb          ;store end
   3849 CAA4 20 E3 CA                             jsr getparm           ;get destination
   3850 CAA7 B0 07                                bcs .0000010          ;not entered — error
                                        ;
   3852 CAA9 20 CF CA                             jsr facasize          ;check destination...
   3853 CAAC C9 04                                cmp #s_dword          ;for range
   3854 CAAE 90 15                                bcc facaoper          ;store dest address
                                        ;
   3856 CAB0 60                         .0000010 rts                   ;exit w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddra: COPY FACA TO ADDRA
                                        ;
   3862 CAB1 A2 02                      facaddra ldx #s_xword-1
                                        ;
   3864 CAB3 B5 A7                      .0000010 lda faca,x
   3865 CAB5 95 A0                                sta addra,x
   3866 CAB7 CA                                   dex
   3867 CAB8 10 F9                                bpl .0000010
                                        ;
   3869 CABA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddrb: COPY FACA TO ADDRB
                                        ;
   3875 CABB A2 02                      facaddrb ldx #s_xword-1
                                        ;
   3877 CABD B5 A7                      .0000010 lda faca,x
   3878 CABF 95 A4                                sta addrb,x
   3879 CAC1 CA                                   dex
   3880 CAC2 10 F9                                bpl .0000010
                                        ;
   3882 CAC4 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaoper: COPY FACA TO OPERAND
                                        ;
   3888 CAC5 A2 02                      facaoper ldx #s_oper-1
                                        ;
   3890 CAC7 B5 A7                      .0000010 lda faca,x
   3891 CAC9 95 BB                                sta operand,x
   3892 CACB CA                                   dex
   3893 CACC 10 F9                                bpl .0000010
                                        ;
   3895 CACE 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facasize: REPORT OPERAND SIZE IN FACA
                                        ;
                                        ;	——————————————————————————————————————————
                                        ;	Preparatory Ops: operand in FACA
                                        ;
                                        ;	Returned Values: .A: s_byte  (1)
                                        ;	                     s_word  (2)
                                        ;	                     s_xword (3)
                                        ;	                     s_dword (4)
                                        ;
                                        ;	Notes: 1) This function will always report
                                        ;	          a non-zero result.
                                        ;	——————————————————————————————————————————
                                        ;
   3913 CACF E2 30                      facasize +         .byte $e2,$30
                                        
   3914 CAD1 A2 03                                ldx #s_dword-1
                                        ;
   3916 CAD3 B5 A7                      .0000010 lda faca,x            ;get byte
   3917 CAD5 D0 03                                bne .0000020          ;done
                                        ;
   3919 CAD7 CA                                   dex
   3920 CAD8 D0 F9                                bne .0000010          ;next byte
                                        ;
   3922 CADA E8                         .0000020 inx                   ;count=index+1
   3923 CADB 8A                                   txa
   3924 CADC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getbyte: GET A BYTE FROM MEMORY
                                        ;
   3930 CADD A7 A0                      getbyte +         .byte $a7,addra
                                        ;get a byte
   3931 CADF 80 3F                                bra incaddra          ;bump address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getparm: GET A PARAMETER
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops: null-terminated input in IBUFFER
                                        ;
                                        ;	Returned Values: .A: chars in converted parameter
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = no parameter entered
                                        ;	—————————————————————————————————————————————————
                                        ;
   3946 CAE1 C6 BF                      getparmr dec ibufidx           ;reread previous char
                                        ;
   3948 CAE3 5A                         getparm  phy                   ;preserve
   3949 CAE4 20 38 C8                             jsr ascbin            ;convert parameter to binary
   3950 CAE7 B0 1C                                bcs .0000040          ;conversion error
                                        ;
   3952 CAE9 20 D0 CB                             jsr getcharr          ;reread last char
   3953 CAEC D0 08                                bne .0000010          ;not end-of-input
                                        ;
   3955 CAEE C6 BF                                dec ibufidx           ;reindex to terminator
   3956 CAF0 A5 C4                                lda charcnt           ;get chars processed so far
   3957 CAF2 F0 0C                                beq .0000030          ;none
                                        ;
   3959 CAF4 D0 08                                bne .0000020          ;some
                                        ;
   3961 CAF6 C9 20                      .0000010 cmp #a_blank          ;recognized delimiter
   3962 CAF8 F0 04                                beq .0000020          ;end of parameter
                                        ;
   3964 CAFA C9 2C                                cmp #','              ;recognized delimiter
   3965 CAFC D0 07                                bne .0000040          ;unknown delimter
                                        ;
   3967 CAFE 18                         .0000020 clc
   3968 CAFF 24                                   .byte bitzp           ;skip SEC below
                                        ;
   3970 CB00 38                         .0000030 sec
   3971 CB01 7A                                   ply                   ;restore
   3972 CB02 A5 C4                                lda charcnt           ;get count
   3973 CB04 60                                   rts                   ;done
                                        ;
   3975 CB05                            .0000040 
                                        ;.rept 3               ;clean up stack
   3977 CB05 68                          			pla
   3978 CB06 68                          			pla
   3979 CB07 68                                     pla
                                        ;        .endr
   3981 CB08 4C 65 C1                             jmp monerr            ;abort w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nxtaddra: TEST & INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR NXTADDRA
                                        ;
                                        ;	Exit registers: .A: used
                                        ;	                .B: used
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    |||||||+———> 0: ADDRA < ADDRB
                                        ;	                    |||||||      1: ADDRA >= ADDRB
                                        ;	                    ||||||+————> undefined
                                        ;	                    |||+++—————> entry value
                                        ;	                    ||+————————> 1
                                        ;	                    ++—————————> undefined
                                        ;	——————————————————————————————————————————————————
                                        ;
   4007 CB0B E2 20                      nxtaddra +         .byte $e2,$20
                                        
   4008 CB0D A5 A2                                lda addra+s_word      ;bits 16-23
   4009 CB0F C5 A6                                cmp addrb+s_word
   4010 CB11 90 0D                                bcc incaddra          ;increment
                                        ;
   4012 CB13 D0 0A                                bne .0000010          ;don't increment
                                        ;
   4014 CB15 C2 20                    +            .byte $c2,$20
                                        
   4015 CB17 A5 A0                                lda addra             ;bits 0-15
   4016 CB19 C5 A4                                cmp addrb             ;condition flags
   4017 CB1B E2 20                    +            .byte $e2,$20
                                        
   4018 CB1D 90 01                                bcc incaddra          ;increment
                                        ;
   4020 CB1F 60                         .0000010 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incaddra: INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR INCADDRA
                                        ;
                                        ;	Exit registers: .A: entry value
                                        ;	                .B: entry value
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    ++++++++———> entry value
                                        ;	——————————————————————————————————————————————————
                                        ;
   4041 CB20 08                         incaddra php
   4042 CB21 C2 20                    +            .byte $c2,$20
                                        
   4043 CB23 E6 A0                                inc addra             ;bump bits 0-15
   4044 CB25 D0 04                                bne .0000010
                                        ;
   4046 CB27 E2 20                    +            .byte $e2,$20
                                        
   4047 CB29 E6 A2                                inc addra+s_word      ;bump bits 16-23
                                        ;
   4049 CB2B 28                         .0000010 plp
   4050 CB2C 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incoper: INCREMENT OPERAND ADDRESS
                                        ;
   4056 CB2D 18                         incoper  clc
   4057 CB2E 08                                   php
   4058 CB2F C2 30                    +            .byte $c2,$30
                                        
   4059 CB31 48                                   pha
   4060 CB32 E6 BB                                inc operand           ;handle base address
   4061 CB34 D0 06                                bne .0000010
                                        ;              
   4063 CB36 E2 20                    +            .byte $e2,$20
                                        
   4064 CB38 E6 BD                                inc operand+s_word    ;handle bank
   4065 CB3A C2 20                    +            .byte $c2,$20
                                        
                                        ;
   4067 CB3C 68                         .0000010 pla
   4068 CB3D 28                                   plp
   4069 CB3E 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;instdata: GET INSTRUCTION SIZE & ADDRESSING MODE DATA
                                        ;
                                        ;	——————————————————————————————————
                                        ;	Preparatory Ops: .X: 65C816 opcode
                                        ;
                                        ;	Returned Values: .A: mode flags
                                        ;	                 .X: operand size
                                        ;	                 .Y: mode index
                                        ;	——————————————————————————————————
                                        ;
   4083 CB3F E2 30                      instdata +         .byte $e2,$30
                                        
   4084 CB41 BD BB CE                             lda mnetabam,x        ;addressing mode data
   4085 CB44 48                                   pha                   ;save mode flag bits
   4086 CB45 48                                   pha                   ;save size data
   4087 CB46 29 0F                                and #amodmask         ;extract mode index &...
   4088 CB48 A8                                   tay                   ;save
   4089 CB49 68                                   pla                   ;recover data
   4090 CB4A 29 30                                and #opsmask          ;mask mode fields &...
                                        ;         .rept n_opslsr        ;extract operand size
   4092 CB4C 4A                                     lsr
   4093 CB4D 4A                                     lsr
   4094 CB4E 4A                                     lsr
   4095 CB4F 4A                                     lsr
                                        ;         .endr
   4097 CB50 AA                                   tax                   ;operand size
   4098 CB51 68                                   pla                   ;recover mode flags
   4099 CB52 29 C0                                and #vopsmask         ;discard mode & size fields
   4100 CB54 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;offtarg: CONVERT BRANCH OFFSET TO TARGET ADDRESS
                                        ;
                                        ;	———————————————————————————————————————————————
                                        ;	Preparatory Ops:    ADDRA: base address
                                        ;	                 INSTSIZE: instruction size
                                        ;	                  OPERAND: offset
                                        ;
                                        ;	Returned Values:  OPERAND: target address (L/H)
                                        ;	                       .A: used
                                        ;	                       .X: entry value
                                        ;                              .Y: entry value
                                        ;	———————————————————————————————————————————————
                                        ;
   4117 CB55 C2 20                      offtarg +         .byte $c2,$20
                                        
   4118 CB57 A5 A0                                lda addra             ;base address
   4119 CB59 E2 20                    +            .byte $e2,$20
                                        
   4120 CB5B 46 C6                                lsr instsize          ;bit 0 will be set if...
   4121 CB5D B0 07                                bcs .0000010          ;a long branch
                                        ;
   4123 CB5F 24 BB                                bit operand           ;short forward or backward?
   4124 CB61 10 03                                bpl .0000010          ;forward
                                        ;
   4126 CB63 EB                       +            .byte $eb
                                                           ;expose address MSB
   4127 CB64 3A                                   dea                   ;back a page
   4128 CB65 EB                       +            .byte $eb
                                                           ;expose address LSB
                                        ;
   4130 CB66 C2 20                      .0000010 +         .byte $c2,$20
                                        
   4131 CB68 18                                   clc
   4132 CB69 65 BB                                adc operand           ;calculate target address
   4133 CB6B 85 BB                                sta operand           ;new operand
   4134 CB6D E2 20                    +            .byte $e2,$20
                                        
   4135 CB6F A9 03                                lda #s_xword
   4136 CB71 85 C6                                sta instsize          ;effective instruction size
   4137 CB73 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;setxaddr: SET EXECUTION ADDRESS
                                        ;
   4143 CB74 B0 13                      setxaddr bcs .0000010          ;no address given
                                        ;
   4145 CB76 20 CF CA                             jsr facasize          ;check address...
   4146 CB79 C9 04                                cmp #s_dword          ;range
   4147 CB7B B0 0D                                bcs .0000020          ;out of range
                                        ;
   4149 CB7D C2 20                    +            .byte $c2,$20
                                        
   4150 CB7F A5 A7                                lda faca              ;execution address
   4151 CB81 85 86                                sta reg_pcx           ;set new PC value
   4152 CB83 E2 20                    +            .byte $e2,$20
                                        
   4153 CB85 A5 A9                                lda faca+s_word
   4154 CB87 85 88                                sta reg_pbx           ;set new PB value
                                        ;
   4156 CB89 18                         .0000010 clc                   ;no error
                                        ;
   4158 CB8A 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;targoff: CONVERT BRANCH TARGET ADDRESS TO BRANCH OFFSET                   
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops:   ADDRA: instruction address
                                        ;	                 OPERAND: target address
                                        ;
                                        ;	Returned Values: OPERAND: computed offset
                                        ;	                      .A: effective operand size
                                        ;	                      .X: entry value
                                        ;                             .Y: entry value
                                        ;	                      .C: 1 = branch out of range
                                        ;
                                        ;	Execution notes: ADDRB is set to the branch base
                                        ;	                 address.
                                        ;	—————————————————————————————————————————————————
                                        ;
   4178 CB8B 64 C7                      targoff  stz instsize+s_byte   ;always zero
   4179 CB8D A5 C6                                lda instsize          ;instruction size will tell...
   4180 CB8F 4A                                   lsr                   ;if long or short branch
                                        ;
                                        ;—————————————————————————————————————————————————
   4390 = 000000BA                      .btype   =facc+5               ;branch type flag
                                        ;—————————————————————————————————————————————————
                                        ;
   4186 CB90 66 BA                                ror .btype            ;set branch type...
                                        ;
                                        ;	x0000000
                                        ;	|
                                        ;	+——————————> 0: short
                                        ;	             1: long
                                        ;
   4193 CB92 C2 20                    +            .byte $c2,$20
                                        
   4194 CB94 18                                   clc
   4195 CB95 A5 A0                                lda addra             ;instruction address
   4196 CB97 65 C6                                adc instsize          ;instruction size
   4197 CB99 85 A4                                sta addrb             ;base address
   4198 CB9B 38                                   sec
   4199 CB9C A5 BB                                lda operand           ;target address
   4200 CB9E E5 A4                                sbc addrb             ;base address
   4201 CBA0 85 BB                                sta operand           ;offset
   4202 CBA2 E2 20                    +            .byte $e2,$20
                                        
   4203 CBA4 90 15                                bcc .0000040          ;backward branch
                                        ;
   4205 CBA6 24 BA                                bit .btype            ;check branch range
   4206 CBA8 30 0A                                bmi .0000020          ;long
                                        ;
                                        ;
                                        ;	process short forward branch...
                                        ;
   4211 CBAA EB                       +            .byte $eb
                                                           ;offset MSB should be zero
   4212 CBAB D0 21                                bne .0000060          ;it isn't — out of range
                                        ;
   4214 CBAD EB                       +            .byte $eb
                                                           ;offset LSB should be $00-$7F
   4215 CBAE 30 1E                                bmi .0000060          ;it isn't — out of range
                                        ;
   4217 CBB0 A9 01                      .0000010 lda #s_byte           ;final instruction size
   4218 CBB2 18                                   clc                   ;branch in range
   4219 CBB3 60                                   rts
                                        ;
                                        ;
                                        ;	process long forward branch...
                                        ;
   4224 CBB4 EB                         .0000020 +         .byte $eb
                                                           ;offset MSB should be positive
   4225 CBB5 30 17                                bmi .0000060          ;it isn't — branch out of range
                                        ;
   4227 CBB7 A9 02                      .0000030 lda #s_word
   4228 CBB9 18                                   clc
   4229 CBBA 60                                   rts
                                        ;
                                        ;
                                        ;	process backward branch...
                                        ;
   4234 CBBB 24 BA                      .0000040 bit .btype            ;long or short?
   4235 CBBD 30 0C                                bmi .0000050          ;long
                                        ;
                                        ;
                                        ;	process short backward branch...
                                        ;
   4240 CBBF EB                       +            .byte $eb
                                                           ;offset MSB should be negative
   4241 CBC0 10 0C                                bpl .0000060          ;it isn't — out of range
                                        ;
   4243 CBC2 49 FF                                eor #%11111111        ;complement offset MSB 2s 
   4244 CBC4 D0 08                                bne .0000060          ;out of range
                                        ;
   4246 CBC6 EB                       +            .byte $eb
                                                           ;offset LSB should be $80-$FF
   4247 CBC7 30 E7                                bmi .0000010          ;it is — branch in range
                                        ;
   4249 CBC9 80 03                                bra .0000060          ;branch out of range
                                        ;
                                        ;
                                        ;	process long backward branch...
                                        ;
   4254 CBCB EB                         .0000050 +         .byte $eb
                                                           ;offset MSB should be negative
   4255 CBCC 30 E9                                bmi .0000030          ;it is — branch in range
                                        ;
   4257 CBCE 38                         .0000060 sec                   ;range error
   4258 CBCF 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharr: GET PREVIOUS INPUT BUFFER CHARACTER
                                        ;
   4264 CBD0 C6 BF                      getcharr dec ibufidx           ;move back a char
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getchar: GET A CHARACTER FROM INPUT BUFFER
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops : none
                                        ;
                                        ;	Register Returns: .A: character or <NUL>
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> entry value
                                        ;	           ||||||+————> 1: <NUL> gotten
                                        ;	           |||||+—————> entry value
                                        ;	           ||||+——————> entry value
                                        ;	           |||+———————> entry value
                                        ;	           ||+————————> entry value
                                        ;	           |+—————————> not defined
                                        ;	           +——————————> not defined
                                        ;	——————————————————————————————————————————————
                                        ;
   4290 CBD2 DA                         getchar  phx
   4291 CBD3 5A                                   phy
   4292 CBD4 08                                   php                   ;save register sizes
   4293 CBD5 E2 30                    +            .byte $e2,$30
                                                        ;force 8 bits
   4294 CBD7 A6 BF                                ldx ibufidx           ;buffer index
   4295 CBD9 BD 00 02                             lda ibuffer,x         ;get char
   4296 CBDC E6 BF                                inc ibufidx           ;bump index
   4297 CBDE 28                                   plp                   ;restore register widths
   4298 CBDF 7A                                   ply
   4299 CBE0 FA                                   plx
                                        ; Changed the following to XBA instruction which seems to work as well.
                                        ; XBA doesn't access the stack memory saving a data memory access,
                                        ; and hence is faster.
   4303 CBE1 EB                       +            .byte $eb
                                        		;	pha                   ;condition...
   4304 CBE2 EB                       +            .byte $eb
                                        		;   pla                   ;.Z
   4305 CBE3 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getpat: GET PATTERN FOR MEMORY CHANGE or SEARCH
                                        ;
                                        ;	—————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated pattern in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: pattern length if entered
                                        ;	                 .C: 0 = pattern valid
                                        ;	                     1 = exception:
                                        ;	                 .N  0 = no pattern entered
                                        ;	                     1 = evaluation error
                                        ;
                                        ;	Notes: 1) If pattern is preceded by "'" the following
                                        ;	          characters are interpreted as ASCII.
                                        ;	       2) A maximum of 32 bytes or characters is
                                        ;	          accepted.  Excess input will be discarded.
                                        ;	—————————————————————————————————————————————————————
                                        ;
   4328 CBE4 64 CB                      getpat   stz status            ;clear pattern type indicator
   4329 CBE6 A0 00                                ldy #0                ;pattern index
   4330 CBE8 20 D0 CB                             jsr getcharr          ;get last char
   4331 CBEB F0 3C                                beq .0000070          ;EOS
                                        ;
   4333 CBED A6 BF                                ldx ibufidx           ;current buffer index
   4334 CBEF 20 30 CC                             jsr getcharw          ;get next
   4335 CBF2 F0 35                                beq .0000070          ;EOS
                                        ;
   4337 CBF4 C9 27                                cmp #''''			; *** watch syntax here, the following line of code was omitted when only ''' was present
   4338 CBF6 D0 04                                bne .0000010          ;not ASCII input
                                        ;
   4340 CBF8 66 CB                                ror status            ;condition flag
   4341 CBFA 80 12                                bra .0000030          ;balance of input is ASCII
                                        ;
   4343 CBFC 86 BF                      .0000010 stx ibufidx           ;restore buffer index
                                        ;
   4345 CBFE 20 E3 CA                   .0000020 jsr getparm           ;evaluate numeric pattern
   4346 CC01 B0 21                                bcs .0000060          ;done w/pattern
                                        ;
   4348 CC03 20 CF CA                             jsr facasize          ;size
   4349 CC06 C9 02                                cmp #s_word
   4350 CC08 B0 1F                                bcs .0000070          ;not a byte — error
                                        ;
   4352 CC0A A5 A7                                lda faca              ;get byte &...
   4353 CC0C 80 05                                bra .0000040          ;store
                                        ;
   4355 CC0E 20 D2 CB                   .0000030 jsr getchar           ;get ASCII char
   4356 CC11 F0 11                                beq .0000060          ;done w/pattern
                                        ;
   4358 CC13 C0 20                      .0000040 cpy #s_auxbuf         ;pattern buffer full?
   4359 CC15 F0 0A                                beq .0000050          ;yes
                                        ;
   4361 CC17 99 51 02                             sta auxbuf,y          ;store pattern
   4362 CC1A C8                                   iny
   4363 CC1B 24 CB                                bit status
   4364 CC1D 10 DF                                bpl .0000020          ;get next numeric value
                                        ;
   4366 CC1F 80 ED                                bra .0000030          ;get next ASCII char
                                        ;
   4368 CC21 20 11 C8                   .0000050 jsr alert             ;excess input
                                        ;
   4370 CC24 84 BE                      .0000060 sty auxbufix          ;save pattern size
   4371 CC26 98                                   tya                   ;condition .Z
   4372 CC27 18                                   clc                   ;pattern valid
   4373 CC28 60                                   rts
                                        ;
                                        ;
                                        ;	no pattern entered...
                                        ;
   4378 CC29 C2 80                      .0000070 +         .byte $c2,%10000000
                                        
   4379 CC2B 38                                   sec
   4380 CC2C 60                                   rts
                                        ;
                                        ;
                                        ;	evaluation error...
                                        ;
   4385 CC2D E2 81                      .0000080 +         .byte $e2,%10000001
                                        
   4386 CC2F 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharw: GET FROM INPUT BUFFER, DISCARDING WHITESPACE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;
                                        ;	Notes: Whitespace is defined as a blank ($20) or a
                                        ;	       horizontal tab ($09).
                                        ;	——————————————————————————————————————————————————
                                        ;
   4404 CC30 20 D2 CB                   getcharw jsr getchar           ;get from buffer
   4405 CC33 F0 08                                beq .0000010          ;EOI
                                        ;
   4407 CC35 C9 20                                cmp #' '
   4408 CC37 F0 F7                                beq getcharw          ;discard whitespace
                                        ;
   4410 CC39 C9 09                                cmp #a_ht             ;also whitespace
   4411 CC3B F0 F3                                beq getcharw
                                        ;
   4413 CC3D 18                         .0000010 clc
   4414 CC3E 60                                   rts  
                                        ;
                                        ;================================================================================
                                        ;
                                        ;input: INTERACTIVE INPUT FROM CONSOLE CHANNEL
                                        ;
                                        ;	———————————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Zero IBUFIDX or load IBUFFER with default
                                        ;	                 input & set IBUFIDX to the number of chars
                                        ;	                 loaded into the buffer.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: characters entered
                                        ;	                 .Y: used
                                        ;
                                        ;	Example: STZ IBUFIDX
                                        ;	         JSR INPUT
                                        ;
                                        ;	Notes: Input is collected in IBUFFER & is null-terminated.
                                        ;	       IBUFIDX is reset to zero upon exit.
                                        ;	———————————————————————————————————————————————————————————
                                        ;
   4436 CC3F                            input:
   4437 CC3F A6 BF                       	    ldx ibufidx
   4438 CC41 9E 00 02                             stz ibuffer,x         ;be sure buffer is terminated
   4439 CC44 20 72 C7                             jsr dpyibuf           ;print default input if any
   4440 CC47 F4                       +            .byte $f4
   4440 CC48 18 D0                    +            .word dc_cn
                                        
   4441 CC4A 20 1D C8                             jsr sprint            ;enable cursor
   4442 CC4D A6 BF                                ldx ibufidx           ;starting buffer index
                                        ;
                                        ;
                                        ;	main input loop...
                                        ;
   4447 CC4F                               .0000010 CPU FT832
   4448 00CC4F 42 20 00 FE FC               		 jcr getcha,biosctx            ;poll for input
                                        		 CPU	W65C02
   4450 CC54 90 02                                bcc .0000020          ;got something
                                        ;
                                        ;         jsr	$F409          ;wait 'til any IRQ &... (Reschedule tasks)
   4453 CC56 80 F7                                bra .0000010          ;try again
                                        ;
   4455 CC58                            .0000020
   4456 CC58 C9 7F                       		cmp #a_del            ;above ASCII range?
   4457 CC5A B0 F3                                bcs .0000010          ;yes, ignore
                                        ;
   4459 CC5C C9 09                                cmp #a_ht             ;horizontal tab?
   4460 CC5E D0 02                                bne .0000030          ;no
                                        ;
   4462 CC60 A9 20                                lda #a_blank          ;replace <HT> w/blank
                                        ;
   4464 CC62 C9 20                      .0000030 cmp #a_blank          ;control char?
   4465 CC64 90 12                                bcc .0000050          ;yes
                                        ;
                                        ;
                                        ;	process QWERTY character...
                                        ;
   4470 CC66 E0 50                                cpx #s_ibuf           ;room in buffer?
   4471 CC68 B0 05                                bcs .0000040          ;no
                                        ;
   4473 CC6A 9D 00 02                             sta ibuffer,x         ;store char
   4474 CC6D E8                                   inx                   ;bump index
   4475 CC6E 2C                                   .byte bitabs          ;echo char
                                        ;
   4477 CC6F A9 07                      .0000040 lda #a_bel            ;alert user
                                           		 cpu FT832
   4479 00CC71 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   4481 CC76 80 D7                                bra .0000010          ;get some more
                                        ;
                                        ;
                                        ;	process carriage return...
                                        ;
   4486 CC78 C9 0D                      .0000050 cmp #a_cr             ;carriage return?
   4487 CC7A D0 0E                                bne .0000060          ;no
                                        ;
   4489 CC7C DA                                   phx                   ;protect input count
   4490 CC7D F4                       +            .byte $f4
   4490 CC7E 1C D0                    +            .word dc_co
                                        
   4491 CC80 20 1D C8                             jsr sprint            ;cursor off
   4492 CC83 FA                                   plx                   ;recover input count
   4493 CC84 9E 00 02                             stz ibuffer,x         ;terminate input &...
   4494 CC87 64 BF                                stz ibufidx           ;reset buffer index
   4495 CC89 60                                   rts                   ;done
                                        ;
                                        ;
                                        ;	process backspace...
                                        ;
   4500 CC8A C9 08                      .0000060 cmp #a_bs             ;backspace?
   4501 CC8C D0 C1                                bne .0000010          ;no
                                        ;
   4503 CC8E 8A                                   txa
   4504 CC8F F0 BE                                beq .0000010          ;no input, ignore <BS>
                                        ;
   4506 CC91 CA                                   dex                   ;1 less char
   4507 CC92 DA                                   phx                   ;preserve count
   4508 CC93 20 C5 C7                             jsr gendbs            ;destructive backspace
   4509 CC96 FA                                   plx                   ;restore count
   4510 CC97 80 B6                                bra .0000010          ;get more input
                                        ;
                                        ;================================================================================
                                        ;
                                        ;lodbnk: LOAD SOURCE & DESTINATION BANKS
                                        ;
   4516 CC99 E2 20                      lodbnk +         .byte $e2,$20
                                        
   4517 CC9B A5 BD                                lda operand+s_word    ;destination bank
   4518 CC9D EB                       +            .byte $eb
                                                           ;make it MSB
   4519 CC9E A5 A2                                lda addra+s_word      ;source bank is LSB
   4520 CCA0 60                                   rts
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;getcharc: GET A CHARACTER FROM INPUT BUFFER & CONVERT CASE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;	——————————————————————————————————————————————————
                                        ;
   4535 CCA1 20 D2 CB                   getcharc jsr getchar           ;get from buffer
   4536 CCA4 F0 0C                                beq touppera          ;just return
                                        ;
                                        ;================================================================================
                                        ;
                                        ;toupper: FORCE CHARACTER TO UPPER CASE
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .A: character to convert
                                        ;
                                        ;	Register Returns: .A: converted character
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: no change
                                        ;
                                        ;	Notes: 1) This subroutine has no effect on char-
                                        ;	          acters that are not alpha.
                                        ;	————————————————————————————————————————————————
                                        ;
   4556 CCA6 08                         toupper  php                   ;protect flags
   4557 CCA7 C9 61                                cmp #a_asclcl         ;check char range
   4558 CCA9 90 06                                bcc .0000010          ;not LC alpha
                                        ;
   4560 CCAB C9 7B                                cmp #a_asclch+s_byte
   4561 CCAD B0 02                                bcs .0000010          ;not LC alpha
                                        ;
   4563 CCAF 29 5F                                and #a_lctouc         ;force to UC
                                        ;
   4565 CCB1 28                         .0000010 plp                   ;restore flags
                                        ;
   4567 CCB2 60                         touppera rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;teststop: TEST FOR STOP KEY
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops: none
                                        ;
                                        ;	Returned Values: .A: detected keypress, if any
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: normal key detected
                                        ;	           |||||||      1: <STOP> detected
                                        ;	           +++++++————> not defined
                                        ;
                                        ;	Example: jsr teststop
                                        ;	         bcs stopped
                                        ;
                                        ;	Notes: The symbol STOPKEY defines the ASCII
                                        ;	       value of the "stop key."
                                        ;	——————————————————————————————————————————————
                                        ;
   4593 CCB3                            teststop 
                                            		CPU	TF832
   4595 00000CCB3                           		jcr getcha,biosctx            ;poll console
                                        		CPU	W65C02
   4597 CCB3 B0 04                                bcs .0000010          ;no input
                                        ;
   4599 CCB5 C9 03                                cmp #stopkey          ;stop key pressed?
   4600 CCB7 F0 01                                beq .0000020          ;yes
                                        ;
   4602 CCB9 18                         .0000010 clc
                                        ;
   4604 CCBA 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;COMMAND PROCESSING DATA TABLES
                                        ;
                                        ;
                                        ;	monitor commands...
                                        ;
   4613 CCBB 41                         mpctab   .byte "A"             ;assemble code
   4614 CCBC 43                                   .byte "C"             ;compare memory ranges
   4615 CCBD 44                                   .byte "D"             ;disassemble code
   4616 CCBE 46                                   .byte "F"             ;fill memory
   4617 CCBF 47                                   .byte "G"             ;execute code
   4618 CCC0 48                                   .byte "H"             ;search memory
   4619 CCC1 4A                                   .byte "J"             ;execute code as subroutine
   4620 CCC2 4D                                   .byte "M"             ;dump memory range
   4621 CCC3 52                                   .byte "R"             ;dump registers
   4622 CCC4 54                                   .byte "T"             ;copy memory range
   4623 CCC5 58                                   .byte "X"             ;exit from monitor
   4624 CCC6 3E                                   .byte ">"             ;change memory
   4625 CCC7 3B                                   .byte ";"             ;change registers
   4852 = 0000000D                      n_mpctab =*-mpctab             ;entries in above table
                                        ;
                                        ;
                                        ;	monitor command jump table...
                                        ;
   4631 CCC8 6B C1                      mpcextab .word monasc-s_byte   ; A  assemble code
   4632 CCCA 2F C4                                .word moncmp-s_byte   ; C  compare memory ranges
   4633 CCCC 49 C3                                .word mondsc-s_byte   ; D  disassemble code
   4634 CCCE 00 C5                                .word monfil-s_byte   ; F  fill memory
   4635 CCD0 9D C3                                .word monjmp-s_byte   ; G  execute code
   4636 CCD2 66 C5                                .word monhnt-s_byte   ; H  search memory
   4637 CCD4 CE C3                                .word monjsr-s_byte   ; J  execute code as subroutine
   4638 CCD6 AE C4                                .word mondmp-s_byte   ; M  dump memory range
   4639 CCD8 7E C0                                .word monreg-s_byte   ; R  dump registers
   4640 CCDA 5D C4                                .word moncpy-s_byte   ; T  copy memory range
   4641 CCDC 17 C6                                .word monxit-s_byte   ; X  exit from monitor
   4642 CCDE 04 C4                                .word monchm-s_byte   ; >  change memory
   4643 CCE0 DC C5                                .word monchr-s_byte   ; ;  change registers
                                        ;
                                        ;
                                        ;	number conversion...
                                        ;        
   4648 CCE2 10 0A 08 02                basetab  .byte 16,10,8,2       ;supported number bases
   4649 CCE6 04 03 03 01                bitsdtab .byte 4,3,3,1         ;bits per binary digit
   4650 CCEA 04 04 03 01                bitsntab .byte 4,4,3,1         ;bits per ASCII character
   4651 CCEE 03 02 09 02                lzsttab  .byte 3,2,9,2         ;leading zero suppression thresholds
   4652 CCF2 0C 0C 10 30                numstab  .byte 12,12,16,48     ;bin to ASCII conversion numerals
   4653 CCF6 24                         radxtab  .byte c_hex           ;hexadecimal radix
   4654 CCF7 2B                                   .byte c_dec           ;decimal radix
   4655 CCF8 40                                   .byte c_oct           ;octal radix
   4656 CCF9 25                                   .byte c_bin           ;binary radix
   4883 = 00000004                      n_radix  =*-radxtab            ;number of recognized radices
                                        ;
                                        ;
                                        ;	shadow MPU register sizes...
                                        ;
   4662 CCFA 02                         rcvltab  .byte s_mpupbx+s_byte ; PB
   4663 CCFB 03                                   .byte s_mpupcx+s_byte ; PC
   4664 CCFC 02                                   .byte s_mpusrx+s_byte ; SR
   4665 CCFD 03                                   .byte s_word+s_byte   ; .C
   4666 CCFE 03                                   .byte s_word+s_byte   ; .X
   4667 CCFF 03                                   .byte s_word+s_byte   ; .Y
   4668 CD00 03                                   .byte s_mpuspx+s_byte ; SP
   4669 CD01 03                                   .byte s_mpudpx+s_byte ; DP
   4670 CD02 02                                   .byte s_mpudbx+s_byte ; DB
   4897 = 00000009                      n_regchv =*-rcvltab            ;total shadow registers
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER DATA TABLES
                                        ;
                                        ;
                                        ;	numerically sorted & encoded W65C816S mnemonics...
                                        ;
   4680 CD03 F2 10                      mnetab   .word mne_xba         ;  0 — XBA
   4681 CD05 5A 11                                .word mne_lda         ;  1 — LDA
   4682 CD07 A2 11                                .word mne_pea         ;  2 — PEA
   4683 CD09 62 12                                .word mne_pha         ;  3 — PHA
   4684 CD0B 62 13                                .word mne_pla         ;  4 — PLA
   4685 CD0D C6 14                                .word mne_bra         ;  5 — BRA
   4686 CD0F E0 14                                .word mne_ora         ;  6 — ORA
   4687 CD11 68 15                                .word mne_sta         ;  7 — STA
   4688 CD13 6A 16                                .word mne_txa         ;  8 — TXA
   4689 CD15 AA 16                                .word mne_tya         ;  9 — TYA
   4690 CD17 62 1A                                .word mne_phb         ; 10 — PHB
   4691 CD19 62 1B                                .word mne_plb         ; 11 — PLB
   4692 CD1B EA 1C                                .word mne_trb         ; 12 — TRB
   4693 CD1D 2A 1D                                .word mne_tsb         ; 13 — TSB
   4694 CD1F E8 20                                .word mne_sbc         ; 14 — SBC
   4695 CD21 06 21                                .word mne_bcc         ; 15 — BCC
   4696 CD23 44 21                                .word mne_adc         ; 16 — ADC
   4697 CD25 6A 21                                .word mne_tdc         ; 17 — TDC
   4698 CD27 8A 21                                .word mne_dec         ; 18 — DEC
   4699 CD29 A8 21                                .word mne_sec         ; 19 — SEC
   4700 CD2B 48 23                                .word mne_clc         ; 20 — CLC
   4701 CD2D D4 23                                .word mne_inc         ; 21 — INC
   4702 CD2F 2A 25                                .word mne_tsc         ; 22 — TSC
   4703 CD31 C6 25                                .word mne_bvc         ; 23 — BVC
   4704 CD33 2A 29                                .word mne_tcd         ; 24 — TCD
   4705 CD35 A8 29                                .word mne_sed         ; 25 — SED
   4706 CD37 62 2A                                .word mne_phd         ; 26 — PHD
   4707 CD39 48 2B                                .word mne_cld         ; 27 — CLD
   4708 CD3B 62 2B                                .word mne_pld         ; 28 — PLD
   4709 CD3D C4 2B                                .word mne_and         ; 29 — AND
   4710 CD3F 32 31                                .word mne_xce         ; 30 — XCE
   4711 CD41 C6 33                                .word mne_bne         ; 31 — BNE
   4712 CD43 B0 50                                .word mne_wai         ; 32 — WAI
   4713 CD45 A2 51                                .word mne_pei         ; 33 — PEI
   4714 CD47 A8 51                                .word mne_sei         ; 34 — SEI
   4715 CD49 48 53                                .word mne_cli         ; 35 — CLI
   4716 CD4B 86 53                                .word mne_bmi         ; 36 — BMI
   4717 CD4D 66 55                                .word mne_rti         ; 37 — RTI
   4718 CD4F 62 62                                .word mne_phk         ; 38 — PHK
   4719 CD51 C6 64                                .word mne_brk         ; 39 — BRK
   4720 CD53 96 6B                                .word mne_jml         ; 40 — JML
   4721 CD55 26 6C                                .word mne_rol         ; 41 — ROL
   4722 CD57 46 6C                                .word mne_bpl         ; 42 — BPL
   4723 CD59 C6 6C                                .word mne_brl         ; 43 — BRL
   4724 CD5B 04 6D                                .word mne_asl         ; 44 — ASL
   4725 CD5D 16 6D                                .word mne_jsl         ; 45 — JSL
   4726 CD5F 66 6D                                .word mne_rtl         ; 46 — RTL
   4727 CD61 70 71                                .word mne_wdm         ; 47 — WDM
   4728 CD63 DC 7D                                .word mne_mvn         ; 48 — MVN
   4729 CD65 A6 89                                .word mne_rep         ; 49 — REP
   4730 CD67 A8 89                                .word mne_sep         ; 50 — SEP
   4731 CD69 62 8A                                .word mne_php         ; 51 — PHP
   4732 CD6B 62 8B                                .word mne_plp         ; 52 — PLP
   4733 CD6D 88 8B                                .word mne_cmp         ; 53 — CMP
   4734 CD6F 96 8B                                .word mne_jmp         ; 54 — JMP
   4735 CD71 08 8C                                .word mne_cop         ; 55 — COP
   4736 CD73 1E 8C                                .word mne_nop         ; 56 — NOP
   4737 CD75 68 8D                                .word mne_stp         ; 57 — STP
   4738 CD77 DC 8D                                .word mne_mvp         ; 58 — MVP
   4739 CD79 86 91                                .word mne_beq         ; 59 — BEQ
   4740 CD7B A2 99                                .word mne_per         ; 60 — PER
   4741 CD7D 0C 9C                                .word mne_eor         ; 61 — EOR
   4742 CD7F 26 9C                                .word mne_ror         ; 62 — ROR
   4743 CD81 16 9D                                .word mne_jsr         ; 63 — JSR
   4744 CD83 1A 9D                                .word mne_lsr         ; 64 — LSR
   4745 CD85 06 A1                                .word mne_bcs         ; 65 — BCS
   4746 CD87 2A A1                                .word mne_tcs         ; 66 — TCS
   4747 CD89 66 A5                                .word mne_rts         ; 67 — RTS
   4748 CD8B C6 A5                                .word mne_bvs         ; 68 — BVS
   4749 CD8D 6A A6                                .word mne_txs         ; 69 — TXS
   4750 CD8F 86 AA                                .word mne_bit         ; 70 — BIT
   4751 CD91 48 BB                                .word mne_clv         ; 71 — CLV
   4752 CD93 AA C8                                .word mne_tax         ; 72 — TAX
   4753 CD95 5A C9                                .word mne_ldx         ; 73 — LDX
   4754 CD97 8A C9                                .word mne_dex         ; 74 — DEX
   4755 CD99 62 CA                                .word mne_phx         ; 75 — PHX
   4756 CD9B 62 CB                                .word mne_plx         ; 76 — PLX
   4757 CD9D D4 CB                                .word mne_inx         ; 77 — INX
   4758 CD9F 48 CC                                .word mne_cpx         ; 78 — CPX
   4759 CDA1 2A CD                                .word mne_tsx         ; 79 — TSX
   4760 CDA3 68 CD                                .word mne_stx         ; 80 — STX
   4761 CDA5 AA CE                                .word mne_tyx         ; 81 — TYX
   4762 CDA7 AA D0                                .word mne_tay         ; 82 — TAY
   4763 CDA9 5A D1                                .word mne_ldy         ; 83 — LDY
   4764 CDAB 8A D1                                .word mne_dey         ; 84 — DEY
   4765 CDAD 62 D2                                .word mne_phy         ; 85 — PHY
   4766 CDAF 62 D3                                .word mne_ply         ; 86 — PLY
   4767 CDB1 D4 D3                                .word mne_iny         ; 87 — INY
   4768 CDB3 48 D4                                .word mne_cpy         ; 88 — CPY
   4769 CDB5 68 D5                                .word mne_sty         ; 89 — STY
   4770 CDB7 6A D6                                .word mne_txy         ; 90 — TXY
   4771 CDB9 68 DD                                .word mne_stz         ; 91 — STZ
                                        ;
   4999 = 000000B8                      s_mnetab =*-mnetab             ;mnemonic table size
   5000 = 0000005C                      n_mnemon =s_mnetab/s_word      ;total mnemonics
                                        ;
                                        ;
                                        ;	mnemonic lookup indices in opcode order...
                                        ;
   4779 CDBB 27                         mnetabix .byte mne_brkx        ; $00  BRK
   4780 CDBC 06                                   .byte mne_orax        ; $01  ORA (dp,X)
   4781 CDBD 37                                   .byte mne_copx        ; $02  COP
   4782 CDBE 06                                   .byte mne_orax        ; $03  ORA offset,S
   4783 CDBF 0D                                   .byte mne_tsbx        ; $04  TSB dp
   4784 CDC0 06                                   .byte mne_orax        ; $05  ORA dp
   4785 CDC1 2C                                   .byte mne_aslx        ; $06  ASL dp
   4786 CDC2 06                                   .byte mne_orax        ; $07  ORA [dp]
   4787 CDC3 33                                   .byte mne_phpx        ; $08  PHP
   4788 CDC4 06                                   .byte mne_orax        ; $09  ORA #
   4789 CDC5 2C                                   .byte mne_aslx        ; $0A  ASL A
   4790 CDC6 1A                                   .byte mne_phdx        ; $0B  PHD
   4791 CDC7 0D                                   .byte mne_tsbx        ; $0C  TSB abs
   4792 CDC8 06                                   .byte mne_orax        ; $0D  ORA abs
   4793 CDC9 2C                                   .byte mne_aslx        ; $0E  ASL abs
   4794 CDCA 06                                   .byte mne_orax        ; $0F  ORA absl
                                        ;
   4796 CDCB 2A                                   .byte mne_bplx        ; $10  BPL abs
   4797 CDCC 06                                   .byte mne_orax        ; $11  ORA (dp),Y
   4798 CDCD 06                                   .byte mne_orax        ; $12  ORA (dp)
   4799 CDCE 06                                   .byte mne_orax        ; $13  ORA (offset,S),Y
   4800 CDCF 0C                                   .byte mne_trbx        ; $14  TRB dp
   4801 CDD0 06                                   .byte mne_orax        ; $15  ORA dp,X
   4802 CDD1 2C                                   .byte mne_aslx        ; $16  ASL dp,X
   4803 CDD2 06                                   .byte mne_orax        ; $17  ORA [dp],Y
   4804 CDD3 14                                   .byte mne_clcx        ; $18  CLC
   4805 CDD4 06                                   .byte mne_orax        ; $19  ORA abs
   4806 CDD5 15                                   .byte mne_incx        ; $1A  INC A
   4807 CDD6 42                                   .byte mne_tcsx        ; $1B  TCS
   4808 CDD7 0C                                   .byte mne_trbx        ; $1C  TRB abs
   4809 CDD8 06                                   .byte mne_orax        ; $1D  ORA abs,X
   4810 CDD9 2C                                   .byte mne_aslx        ; $1E  ASL abs,X
   4811 CDDA 06                                   .byte mne_orax        ; $1F  ORA absl,X
                                        ;
   4813 CDDB 3F                                   .byte mne_jsrx        ; $20  JSR abs
   4814 CDDC 1D                                   .byte mne_andx        ; $21  AND (dp,X)
   4815 CDDD 2D                                   .byte mne_jslx        ; $22  JSL absl
   4816 CDDE 1D                                   .byte mne_andx        ; $23  AND offset,S
   4817 CDDF 46                                   .byte mne_bitx        ; $24  BIT dp
   4818 CDE0 1D                                   .byte mne_andx        ; $25  AND dp
   4819 CDE1 29                                   .byte mne_rolx        ; $26  ROL dp
   4820 CDE2 1D                                   .byte mne_andx        ; $27  AND [dp]
   4821 CDE3 34                                   .byte mne_plpx        ; $28  PLP
   4822 CDE4 1D                                   .byte mne_andx        ; $29  AND #
   4823 CDE5 29                                   .byte mne_rolx        ; $2A  ROL A
   4824 CDE6 1C                                   .byte mne_pldx        ; $2B  PLD
   4825 CDE7 46                                   .byte mne_bitx        ; $2C  BIT abs
   4826 CDE8 1D                                   .byte mne_andx        ; $2D  AND abs
   4827 CDE9 29                                   .byte mne_rolx        ; $2E  ROL abs
   4828 CDEA 1D                                   .byte mne_andx        ; $2F  AND absl
                                        ;
   4830 CDEB 24                                   .byte mne_bmix        ; $30  BMI abs
   4831 CDEC 1D                                   .byte mne_andx        ; $31  AND (dp),Y
   4832 CDED 1D                                   .byte mne_andx        ; $32  AND (dp)
   4833 CDEE 1D                                   .byte mne_andx        ; $33  AND (offset,S),Y
   4834 CDEF 46                                   .byte mne_bitx        ; $34  BIT dp,X
   4835 CDF0 1D                                   .byte mne_andx        ; $35  AND dp,X
   4836 CDF1 29                                   .byte mne_rolx        ; $36  ROL dp,X
   4837 CDF2 1D                                   .byte mne_andx        ; $37  AND [dp],Y
   4838 CDF3 13                                   .byte mne_secx        ; $38  SEC
   4839 CDF4 1D                                   .byte mne_andx        ; $39  AND abs,Y
   4840 CDF5 12                                   .byte mne_decx        ; $3A  DEC A
   4841 CDF6 16                                   .byte mne_tscx        ; $3B  TSC
   4842 CDF7 46                                   .byte mne_bitx        ; $3C  BIT abs,X
   4843 CDF8 1D                                   .byte mne_andx        ; $3D  AND abs,X
   4844 CDF9 29                                   .byte mne_rolx        ; $3E  ROL abs,X
   4845 CDFA 1D                                   .byte mne_andx        ; $3F  AND absl,X
                                        ;
   4847 CDFB 25                                   .byte mne_rtix        ; $40  RTI
   4848 CDFC 3D                                   .byte mne_eorx        ; $41  EOR (dp,X)
   4849 CDFD 2F                                   .byte mne_wdmx        ; $42  WDM
   4850 CDFE 3D                                   .byte mne_eorx        ; $43  EOR offset,S
   4851 CDFF 3A                                   .byte mne_mvpx        ; $44  MVP sb,db
   4852 CE00 3D                                   .byte mne_eorx        ; $45  EOR dp
   4853 CE01 40                                   .byte mne_lsrx        ; $46  LSR dp
   4854 CE02 3D                                   .byte mne_eorx        ; $47  EOR [dp]
   4855 CE03 03                                   .byte mne_phax        ; $48  PHA
   4856 CE04 3D                                   .byte mne_eorx        ; $49  EOR #
   4857 CE05 40                                   .byte mne_lsrx        ; $4A  LSR A
   4858 CE06 26                                   .byte mne_phkx        ; $4B  PHK
   4859 CE07 36                                   .byte mne_jmpx        ; $4C  JMP abs
   4860 CE08 3D                                   .byte mne_eorx        ; $4D  EOR abs
   4861 CE09 40                                   .byte mne_lsrx        ; $4E  LSR abs
   4862 CE0A 3D                                   .byte mne_eorx        ; $4F  EOR absl
                                        ;
   4864 CE0B 17                                   .byte mne_bvcx        ; $50  BVC abs
   4865 CE0C 3D                                   .byte mne_eorx        ; $51  EOR (dp),Y
   4866 CE0D 3D                                   .byte mne_eorx        ; $52  EOR (dp)
   4867 CE0E 3D                                   .byte mne_eorx        ; $53  EOR (offset,S),Y
   4868 CE0F 30                                   .byte mne_mvnx        ; $54  MVN sb,db
   4869 CE10 3D                                   .byte mne_eorx        ; $55  EOR dp,X
   4870 CE11 40                                   .byte mne_lsrx        ; $56  LSR dp,X
   4871 CE12 3D                                   .byte mne_eorx        ; $57  EOR [dp],Y
   4872 CE13 23                                   .byte mne_clix        ; $58  CLI
   4873 CE14 3D                                   .byte mne_eorx        ; $59  EOR abs,Y
   4874 CE15 55                                   .byte mne_phyx        ; $5A  PHY
   4875 CE16 18                                   .byte mne_tcdx        ; $5B  TCD
   4876 CE17 28                                   .byte mne_jmlx        ; $5C  JML absl
   4877 CE18 3D                                   .byte mne_eorx        ; $5D  EOR abs,X
   4878 CE19 40                                   .byte mne_lsrx        ; $5E  LSR abs,X
   4879 CE1A 3D                                   .byte mne_eorx        ; $5F  EOR absl,X
                                        ;
   4881 CE1B 43                                   .byte mne_rtsx        ; $60  RTS
   4882 CE1C 10                                   .byte mne_adcx        ; $61  ADC (dp,X)
   4883 CE1D 3C                                   .byte mne_perx        ; $62  PER
   4884 CE1E 10                                   .byte mne_adcx        ; $63  ADC offset,S
   4885 CE1F 5B                                   .byte mne_stzx        ; $64  STZ dp
   4886 CE20 10                                   .byte mne_adcx        ; $65  ADC dp
   4887 CE21 3E                                   .byte mne_rorx        ; $66  ROR dp
   4888 CE22 10                                   .byte mne_adcx        ; $67  ADC [dp]
   4889 CE23 04                                   .byte mne_plax        ; $68  PLA
   4890 CE24 10                                   .byte mne_adcx        ; $69  ADC #
   4891 CE25 3E                                   .byte mne_rorx        ; $6A  ROR A
   4892 CE26 2E                                   .byte mne_rtlx        ; $6B  RTL
   4893 CE27 36                                   .byte mne_jmpx        ; $6C  JMP (abs)
   4894 CE28 10                                   .byte mne_adcx        ; $6D  ADC abs
   4895 CE29 3E                                   .byte mne_rorx        ; $6E  ROR abs
   4896 CE2A 10                                   .byte mne_adcx        ; $6F  ADC absl
                                        ;
   4898 CE2B 44                                   .byte mne_bvsx        ; $70  BVS abs
   4899 CE2C 10                                   .byte mne_adcx        ; $71  ADC (dp),Y
   4900 CE2D 10                                   .byte mne_adcx        ; $72  ADC (dp)
   4901 CE2E 10                                   .byte mne_adcx        ; $73  ADC (offset,S),Y
   4902 CE2F 5B                                   .byte mne_stzx        ; $74  STZ dp,X
   4903 CE30 10                                   .byte mne_adcx        ; $75  ADC dp,X
   4904 CE31 3E                                   .byte mne_rorx        ; $76  ROR dp,X
   4905 CE32 10                                   .byte mne_adcx        ; $77  ADC [dp],Y
   4906 CE33 22                                   .byte mne_seix        ; $78  SEI
   4907 CE34 10                                   .byte mne_adcx        ; $79  ADC abs,Y
   4908 CE35 56                                   .byte mne_plyx        ; $7A  PLY
   4909 CE36 11                                   .byte mne_tdcx        ; $7B  TDC
   4910 CE37 36                                   .byte mne_jmpx        ; $7C  JMP (abs,X)
   4911 CE38 10                                   .byte mne_adcx        ; $7D  ADC abs,X
   4912 CE39 3E                                   .byte mne_rorx        ; $7E  ROR abs,X
   4913 CE3A 10                                   .byte mne_adcx        ; $7F  ADC absl,X
                                        ;
   4915 CE3B 05                                   .byte mne_brax        ; $80  BRA abs
   4916 CE3C 07                                   .byte mne_stax        ; $81  STA (dp,X)
   4917 CE3D 2B                                   .byte mne_brlx        ; $82  BRL abs
   4918 CE3E 07                                   .byte mne_stax        ; $83  STA offset,S
   4919 CE3F 59                                   .byte mne_styx        ; $84  STY dp
   4920 CE40 07                                   .byte mne_stax        ; $85  STA dp
   4921 CE41 50                                   .byte mne_stxx        ; $86  STX dp
   4922 CE42 07                                   .byte mne_stax        ; $87  STA [dp]
   4923 CE43 54                                   .byte mne_deyx        ; $88  DEY
   4924 CE44 46                                   .byte mne_bitx        ; $89  BIT #
   4925 CE45 08                                   .byte mne_txax        ; $8A  TXA
   4926 CE46 0A                                   .byte mne_phbx        ; $8B  PHB
   4927 CE47 59                                   .byte mne_styx        ; $8C  STY abs
   4928 CE48 07                                   .byte mne_stax        ; $8D  STA abs
   4929 CE49 50                                   .byte mne_stxx        ; $8E  STX abs
   4930 CE4A 07                                   .byte mne_stax        ; $8F  STA absl
                                        ;
   4932 CE4B 0F                                   .byte mne_bccx        ; $90  BCC abs
   4933 CE4C 07                                   .byte mne_stax        ; $91  STA (dp),Y
   4934 CE4D 07                                   .byte mne_stax        ; $92  STA (dp)
   4935 CE4E 07                                   .byte mne_stax        ; $93  STA (offset,S),Y
   4936 CE4F 59                                   .byte mne_styx        ; $94  STY dp,X
   4937 CE50 07                                   .byte mne_stax        ; $95  STA dp,X
   4938 CE51 50                                   .byte mne_stxx        ; $96  STX dp,Y
   4939 CE52 07                                   .byte mne_stax        ; $97  STA [dp],Y
   4940 CE53 09                                   .byte mne_tyax        ; $98  TYA
   4941 CE54 07                                   .byte mne_stax        ; $99  STA abs,Y
   4942 CE55 45                                   .byte mne_txsx        ; $9A  TXS
   4943 CE56 5A                                   .byte mne_txyx        ; $9B  TXY
   4944 CE57 5B                                   .byte mne_stzx        ; $9C  STZ abs
   4945 CE58 07                                   .byte mne_stax        ; $9D  STA abs,X
   4946 CE59 5B                                   .byte mne_stzx        ; $9E  STZ abs,X
   4947 CE5A 07                                   .byte mne_stax        ; $9F  STA absl,X
                                        ;
   4949 CE5B 53                                   .byte mne_ldyx        ; $A0  LDY #
   4950 CE5C 01                                   .byte mne_ldax        ; $A1  LDA (dp,X)
   4951 CE5D 49                                   .byte mne_ldxx        ; $A2  LDX #
   4952 CE5E 01                                   .byte mne_ldax        ; $A3  LDA offset,S
   4953 CE5F 53                                   .byte mne_ldyx        ; $A4  LDY dp
   4954 CE60 01                                   .byte mne_ldax        ; $A5  LDA dp
   4955 CE61 49                                   .byte mne_ldxx        ; $A6  LDX dp
   4956 CE62 01                                   .byte mne_ldax        ; $A7  LDA [dp]
   4957 CE63 52                                   .byte mne_tayx        ; $A8  TAY
   4958 CE64 01                                   .byte mne_ldax        ; $A9  LDA #
   4959 CE65 48                                   .byte mne_taxx        ; $AA  TAX
   4960 CE66 0B                                   .byte mne_plbx        ; $AB  PLB
   4961 CE67 53                                   .byte mne_ldyx        ; $AC  LDY abs
   4962 CE68 01                                   .byte mne_ldax        ; $AD  LDA abs
   4963 CE69 49                                   .byte mne_ldxx        ; $AE  LDX abs
   4964 CE6A 01                                   .byte mne_ldax        ; $AF  LDA absl
                                        ;
   4966 CE6B 41                                   .byte mne_bcsx        ; $B0  BCS abs
   4967 CE6C 01                                   .byte mne_ldax        ; $B1  LDA (dp),Y
   4968 CE6D 01                                   .byte mne_ldax        ; $B2  LDA (dp)
   4969 CE6E 01                                   .byte mne_ldax        ; $B3  LDA (offset,S),Y
   4970 CE6F 53                                   .byte mne_ldyx        ; $B4  LDY dp,X
   4971 CE70 01                                   .byte mne_ldax        ; $B5  LDA dp,X
   4972 CE71 49                                   .byte mne_ldxx        ; $B6  LDX dp,Y
   4973 CE72 01                                   .byte mne_ldax        ; $B7  LDA [dp],Y
   4974 CE73 47                                   .byte mne_clvx        ; $B8  CLV
   4975 CE74 01                                   .byte mne_ldax        ; $B9  LDA abs,Y
   4976 CE75 4F                                   .byte mne_tsxx        ; $BA  TSX
   4977 CE76 51                                   .byte mne_tyxx        ; $BB  TYX
   4978 CE77 53                                   .byte mne_ldyx        ; $BC  LDY abs,X
   4979 CE78 01                                   .byte mne_ldax        ; $BD  LDA abs,X
   4980 CE79 49                                   .byte mne_ldxx        ; $BE  LDX abs,Y
   4981 CE7A 01                                   .byte mne_ldax        ; $BF  LDA absl,X
                                        ;
   4983 CE7B 58                                   .byte mne_cpyx        ; $C0  CPY #
   4984 CE7C 35                                   .byte mne_cmpx        ; $C1  CMP (dp,X)
   4985 CE7D 31                                   .byte mne_repx        ; $C2  REP #
   4986 CE7E 35                                   .byte mne_cmpx        ; $C3  CMP offset,S
   4987 CE7F 58                                   .byte mne_cpyx        ; $C4  CPY dp
   4988 CE80 35                                   .byte mne_cmpx        ; $C5  CMP dp
   4989 CE81 12                                   .byte mne_decx        ; $C6  DEC dp
   4990 CE82 35                                   .byte mne_cmpx        ; $C7  CMP [dp]
   4991 CE83 57                                   .byte mne_inyx        ; $C8  INY
   4992 CE84 35                                   .byte mne_cmpx        ; $C9  CMP #
   4993 CE85 4A                                   .byte mne_dexx        ; $CA  DEX
   4994 CE86 20                                   .byte mne_waix        ; $CB  WAI
   4995 CE87 58                                   .byte mne_cpyx        ; $CC  CPY abs
   4996 CE88 35                                   .byte mne_cmpx        ; $CD  CMP abs
   4997 CE89 12                                   .byte mne_decx        ; $CE  DEC abs
   4998 CE8A 35                                   .byte mne_cmpx        ; $CF  CMP absl
                                        ;
   5000 CE8B 1F                                   .byte mne_bnex        ; $D0  BNE abs
   5001 CE8C 35                                   .byte mne_cmpx        ; $D1  CMP (dp),Y
   5002 CE8D 35                                   .byte mne_cmpx        ; $D2  CMP (dp)
   5003 CE8E 35                                   .byte mne_cmpx        ; $D3  CMP (offset,S),Y
   5004 CE8F 21                                   .byte mne_peix        ; $D4  PEI dp
   5005 CE90 35                                   .byte mne_cmpx        ; $D5  CMP dp,X
   5006 CE91 12                                   .byte mne_decx        ; $D6  DEC dp,X
   5007 CE92 35                                   .byte mne_cmpx        ; $D7  CMP [dp],Y
   5008 CE93 1B                                   .byte mne_cldx        ; $D8  CLD
   5009 CE94 35                                   .byte mne_cmpx        ; $D9  CMP abs,Y
   5010 CE95 4B                                   .byte mne_phxx        ; $DA  PHX
   5011 CE96 39                                   .byte mne_stpx        ; $DB  STP
   5012 CE97 36                                   .byte mne_jmpx        ; $DC  JMP [abs]
   5013 CE98 35                                   .byte mne_cmpx        ; $DD  CMP abs,X
   5014 CE99 12                                   .byte mne_decx        ; $DE  DEC abs,X
   5015 CE9A 35                                   .byte mne_cmpx        ; $DF  CMP absl,X
                                        ;
   5017 CE9B 4E                                   .byte mne_cpxx        ; $E0  CPX #
   5018 CE9C 0E                                   .byte mne_sbcx        ; $E1  SBC (dp,X)
   5019 CE9D 32                                   .byte mne_sepx        ; $E2  SEP #
   5020 CE9E 0E                                   .byte mne_sbcx        ; $E3  SBC offset,S
   5021 CE9F 4E                                   .byte mne_cpxx        ; $E4  CPX dp
   5022 CEA0 0E                                   .byte mne_sbcx        ; $E5  SBC dp
   5023 CEA1 15                                   .byte mne_incx        ; $E6  INC dp
   5024 CEA2 0E                                   .byte mne_sbcx        ; $E7  SBC [dp]
   5025 CEA3 4D                                   .byte mne_inxx        ; $E8  INX
   5026 CEA4 0E                                   .byte mne_sbcx        ; $E9  SBC #
   5027 CEA5 38                                   .byte mne_nopx        ; $EA  NOP
   5028 CEA6 00                                   .byte mne_xbax        ; $EB  XBA
   5029 CEA7 4E                                   .byte mne_cpxx        ; $EC  CPX abs
   5030 CEA8 0E                                   .byte mne_sbcx        ; $ED  SBC abs
   5031 CEA9 15                                   .byte mne_incx        ; $EE  INC abs
   5032 CEAA 0E                                   .byte mne_sbcx        ; $EF  SBC absl
                                        ;
   5034 CEAB 3B                                   .byte mne_beqx        ; $F0  BEQ abs
   5035 CEAC 0E                                   .byte mne_sbcx        ; $F1  SBC (dp),Y
   5036 CEAD 0E                                   .byte mne_sbcx        ; $F2  SBC (dp)
   5037 CEAE 0E                                   .byte mne_sbcx        ; $F3  SBC (offset,S),Y
   5038 CEAF 02                                   .byte mne_peax        ; $F4  PEA #
   5039 CEB0 0E                                   .byte mne_sbcx        ; $F5  SBC dp,X
   5040 CEB1 15                                   .byte mne_incx        ; $F6  INC dp,X
   5041 CEB2 0E                                   .byte mne_sbcx        ; $F7  SBC [dp],Y
   5042 CEB3 19                                   .byte mne_sedx        ; $F8  SED
   5043 CEB4 0E                                   .byte mne_sbcx        ; $F9  SBC abs,Y
   5044 CEB5 4C                                   .byte mne_plxx        ; $FA  PLX
   5045 CEB6 1E                                   .byte mne_xcex        ; $FB  XCE
   5046 CEB7 3F                                   .byte mne_jsrx        ; $FC  JSR (abs,X)
   5047 CEB8 0E                                   .byte mne_sbcx        ; $FD  SBC abs,X
   5048 CEB9 15                                   .byte mne_incx        ; $FE  INC abs,X
   5049 CEBA 0E                                   .byte mne_sbcx        ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	instruction addressing modes & sizes in opcode order...
                                        ;
                                        ;	    xxxxxxxx
                                        ;	    ||||||||
                                        ;	    ||||++++———> Addressing Mode
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||          0000  dp, abs, absl, implied or A
                                        ;	    ||||          0001  #
                                        ;	    ||||          0010  dp,X, abs,X or absl,X
                                        ;	    ||||          0011  dp,Y or abs,Y
                                        ;	    ||||          0100  (dp) or (abs)
                                        ;	    ||||          0101  [dp] or [abs]
                                        ;	    ||||          0110  [dp],Y
                                        ;	    ||||          0111  (dp,X) or (abs,X)
                                        ;	    ||||          1000  (dp),Y
                                        ;	    ||||          1001  offset,S
                                        ;	    ||||          1010  (offset,S),Y
                                        ;	    ||||          1011  sbnk,dbnk (MVN or MVP)
                                        ;	    ||||          —-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—
                                        ;	    ||||           #    = immediate
                                        ;	    ||||           A    = accumulator
                                        ;	    ||||           abs  = absolute
                                        ;	    ||||           absl = absolute long
                                        ;	    ||||           dbnk = destination bank
                                        ;	    ||||           dp   = direct (zero) page
                                        ;	    ||||           S    = stack relative
                                        ;	    ||||           sbnk = source bank
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||
                                        ;	    ||++———————> binary-encoded operand size
                                        ;	    |+—————————> 1: relative branch instruction
                                        ;	    +——————————> 1: variable operand size...
                                        ;
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;	    Variable operand size refers to an immediate mode instruction
                                        ;	    that can accept either an 8 or 16 bit operand.  During instr-
                                        ;	    uction assembly, an 8 bit operand can be forced to 16 bits by
                                        ;	    preceding the operand field with !,  e.g.,  LDA !#$01,  which
                                        ;	    will assemble as $A9 $01 $00.
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;
   5093 CEBB 00                         mnetabam .byte ops0 | am_nam   ; $00  BRK
   5094 CEBC 17                                   .byte ops1 | am_indx  ; $01  ORA (dp,X)
   5095 CEBD 10                                   .byte ops1 | am_nam   ; $02  COP
   5096 CEBE 19                                   .byte ops1 | am_stk   ; $03  ORA offset,S
   5097 CEBF 10                                   .byte ops1 | am_nam   ; $04  TSB dp
   5098 CEC0 10                                   .byte ops1 | am_nam   ; $05  ORA dp
   5099 CEC1 10                                   .byte ops1 | am_nam   ; $06  ASL dp
   5100 CEC2 15                                   .byte ops1 | am_indl  ; $07  ORA [dp]
   5101 CEC3 00                                   .byte ops0 | am_nam   ; $08  PHP
   5102 CEC4 91                                   .byte vops | am_imm   ; $09  ORA #
   5103 CEC5 00                                   .byte ops0 | am_nam   ; $0A  ASL A
   5104 CEC6 00                                   .byte ops0 | am_nam   ; $0B  PHD
   5105 CEC7 20                                   .byte ops2 | am_nam   ; $0C  TSB abs
   5106 CEC8 20                                   .byte ops2 | am_nam   ; $0D  ORA abs
   5107 CEC9 20                                   .byte ops2 | am_nam   ; $0E  ASL abs
   5108 CECA 30                                   .byte ops3 | am_nam   ; $0F  ORA absl
                                        ;
   5110 CECB 50                                   .byte bop1 | am_nam   ; $10  BPL abs
   5111 CECC 18                                   .byte ops1 | am_indy  ; $11  ORA (dp),Y
   5112 CECD 14                                   .byte ops1 | am_ind   ; $12  ORA (dp)
   5113 CECE 1A                                   .byte ops1 | am_stky  ; $13  ORA (offset,S),Y
   5114 CECF 10                                   .byte ops1 | am_nam   ; $14  TRB dp
   5115 CED0 12                                   .byte ops1 | am_adrx  ; $15  ORA dp,X
   5116 CED1 12                                   .byte ops1 | am_adrx  ; $16  ASL dp,X
   5117 CED2 16                                   .byte ops1 | am_indly ; $17  ORA [dp],Y
   5118 CED3 00                                   .byte ops0 | am_nam   ; $18  CLC
   5119 CED4 20                                   .byte ops2 | am_nam   ; $19  ORA abs
   5120 CED5 00                                   .byte ops0 | am_nam   ; $1A  INC A
   5121 CED6 00                                   .byte ops0 | am_nam   ; $1B  TCS
   5122 CED7 20                                   .byte ops2 | am_nam   ; $1C  TRB abs
   5123 CED8 22                                   .byte ops2 | am_adrx  ; $1D  ORA abs,X
   5124 CED9 22                                   .byte ops2 | am_adrx  ; $1E  ASL abs,X
   5125 CEDA 32                                   .byte ops3 | am_adrx  ; $1F  ORA absl,X
                                        ;
   5127 CEDB 20                                   .byte ops2 | am_nam   ; $20  JSR abs
   5128 CEDC 17                                   .byte ops1 | am_indx  ; $21  AND (dp,X)
   5129 CEDD 30                                   .byte ops3 | am_nam   ; $22  JSL absl
   5130 CEDE 19                                   .byte ops1 | am_stk   ; $23  AND offset,S
   5131 CEDF 10                                   .byte ops1 | am_nam   ; $24  BIT dp
   5132 CEE0 10                                   .byte ops1 | am_nam   ; $25  AND dp
   5133 CEE1 10                                   .byte ops1 | am_nam   ; $26  ROL dp
   5134 CEE2 15                                   .byte ops1 | am_indl  ; $27  AND [dp]
   5135 CEE3 00                                   .byte ops0 | am_nam   ; $28  PLP
   5136 CEE4 91                                   .byte vops | am_imm   ; $29  AND #
   5137 CEE5 00                                   .byte ops0 | am_nam   ; $2A  ROL A
   5138 CEE6 00                                   .byte ops0 | am_nam   ; $2B  PLD
   5139 CEE7 20                                   .byte ops2 | am_nam   ; $2C  BIT abs
   5140 CEE8 20                                   .byte ops2 | am_nam   ; $2D  AND abs
   5141 CEE9 20                                   .byte ops2 | am_nam   ; $2E  ROL abs
   5142 CEEA 30                                   .byte ops3 | am_nam   ; $2F  AND absl
                                        ;
   5144 CEEB 50                                   .byte bop1 | am_nam   ; $30  BMI abs
   5145 CEEC 18                                   .byte ops1 | am_indy  ; $31  AND (dp),Y
   5146 CEED 14                                   .byte ops1 | am_ind   ; $32  AND (dp)
   5147 CEEE 1A                                   .byte ops1 | am_stky  ; $33  AND (offset,S),Y
   5148 CEEF 12                                   .byte ops1 | am_adrx  ; $34  BIT dp,X
   5149 CEF0 12                                   .byte ops1 | am_adrx  ; $35  AND dp,X
   5150 CEF1 12                                   .byte ops1 | am_adrx  ; $36  ROL dp,X
   5151 CEF2 16                                   .byte ops1 | am_indly ; $37  AND [dp],Y
   5152 CEF3 00                                   .byte ops0 | am_nam   ; $38  SEC
   5153 CEF4 23                                   .byte ops2 | am_adry  ; $39  AND abs,Y
   5154 CEF5 00                                   .byte ops0 | am_nam   ; $3A  DEC A
   5155 CEF6 00                                   .byte ops0 | am_nam   ; $3B  TSC
   5156 CEF7 22                                   .byte ops2 | am_adrx  ; $3C  BIT abs,X
   5157 CEF8 22                                   .byte ops2 | am_adrx  ; $3D  AND abs,X
   5158 CEF9 22                                   .byte ops2 | am_adrx  ; $3E  ROL abs,X
   5159 CEFA 32                                   .byte ops3 | am_adrx  ; $3F  AND absl,X
                                        ;
   5161 CEFB 00                                   .byte ops0 | am_nam   ; $40  RTI
   5162 CEFC 17                                   .byte ops1 | am_indx  ; $41  EOR (dp,X)
   5163 CEFD 00                                   .byte ops0 | am_nam   ; $42  WDM
   5164 CEFE 19                                   .byte ops1 | am_stk   ; $43  EOR offset,S
   5165 CEFF 2B                                   .byte ops2 | am_move  ; $44  MVP sb,db
   5166 CF00 10                                   .byte ops1 | am_nam   ; $45  EOR dp
   5167 CF01 10                                   .byte ops1 | am_nam   ; $46  LSR dp
   5168 CF02 15                                   .byte ops1 | am_indl  ; $47  EOR [dp]
   5169 CF03 00                                   .byte ops0 | am_nam   ; $48  PHA
   5170 CF04 91                                   .byte vops | am_imm   ; $49  EOR #
   5171 CF05 00                                   .byte ops0 | am_nam   ; $4A  LSR A
   5172 CF06 00                                   .byte ops0 | am_nam   ; $4B  PHK
   5173 CF07 20                                   .byte ops2 | am_nam   ; $4C  JMP abs
   5174 CF08 20                                   .byte ops2 | am_nam   ; $4D  EOR abs
   5175 CF09 20                                   .byte ops2 | am_nam   ; $4E  LSR abs
   5176 CF0A 30                                   .byte ops3 | am_nam   ; $4F  EOR absl
                                        ;
   5178 CF0B 50                                   .byte bop1 | am_nam   ; $50  BVC abs
   5179 CF0C 18                                   .byte ops1 | am_indy  ; $51  EOR (dp),Y
   5180 CF0D 14                                   .byte ops1 | am_ind   ; $52  EOR (dp)
   5181 CF0E 1A                                   .byte ops1 | am_stky  ; $53  EOR (offset,S),Y
   5182 CF0F 2B                                   .byte ops2 | am_move  ; $54  MVN sb,db
   5183 CF10 12                                   .byte ops1 | am_adrx  ; $55  EOR dp,X
   5184 CF11 12                                   .byte ops1 | am_adrx  ; $56  LSR dp,X
   5185 CF12 16                                   .byte ops1 | am_indly ; $57  EOR [dp],Y
   5186 CF13 00                                   .byte ops0 | am_nam   ; $58  CLI
   5187 CF14 23                                   .byte ops2 | am_adry  ; $59  EOR abs,Y
   5188 CF15 00                                   .byte ops0 | am_nam   ; $5A  PHY
   5189 CF16 00                                   .byte ops0 | am_nam   ; $5B  TCD
   5190 CF17 30                                   .byte ops3 | am_nam   ; $5C  JML absl
   5191 CF18 22                                   .byte ops2 | am_adrx  ; $5D  EOR abs,X
   5192 CF19 22                                   .byte ops2 | am_adrx  ; $5E  LSR abs,X
   5193 CF1A 32                                   .byte ops3 | am_adrx  ; $5F  EOR absl,X
                                        ;
   5195 CF1B 00                                   .byte ops0 | am_nam   ; $60  RTS
   5196 CF1C 17                                   .byte ops1 | am_indx  ; $61  ADC (dp,X)
   5197 CF1D 60                                   .byte bop2 | am_nam   ; $62  PER
   5198 CF1E 19                                   .byte ops1 | am_stk   ; $63  ADC offset,S
   5199 CF1F 10                                   .byte ops1 | am_nam   ; $64  STZ dp
   5200 CF20 10                                   .byte ops1 | am_nam   ; $65  ADC dp
   5201 CF21 10                                   .byte ops1 | am_nam   ; $66  ROR dp
   5202 CF22 15                                   .byte ops1 | am_indl  ; $67  ADC [dp]
   5203 CF23 00                                   .byte ops0 | am_nam   ; $68  PLA
   5204 CF24 91                                   .byte vops | am_imm   ; $69  ADC #
   5205 CF25 00                                   .byte ops0 | am_nam   ; $6A  ROR A
   5206 CF26 00                                   .byte ops0 | am_nam   ; $6B  RTL
   5207 CF27 24                                   .byte ops2 | am_ind   ; $6C  JMP (abs)
   5208 CF28 20                                   .byte ops2 | am_nam   ; $6D  ADC abs
   5209 CF29 20                                   .byte ops2 | am_nam   ; $6E  ROR abs
   5210 CF2A 30                                   .byte ops3 | am_nam   ; $6F  ADC absl
                                        ;
   5212 CF2B 50                                   .byte bop1 | am_nam   ; $70  BVS abs
   5213 CF2C 18                                   .byte ops1 | am_indy  ; $71  ADC (dp),Y
   5214 CF2D 14                                   .byte ops1 | am_ind   ; $72  ADC (dp)
   5215 CF2E 1A                                   .byte ops1 | am_stky  ; $73  ADC (offset,S),Y
   5216 CF2F 12                                   .byte ops1 | am_adrx  ; $74  STZ dp,X
   5217 CF30 12                                   .byte ops1 | am_adrx  ; $75  ADC dp,X
   5218 CF31 12                                   .byte ops1 | am_adrx  ; $76  ROR dp,X
   5219 CF32 16                                   .byte ops1 | am_indly ; $77  ADC [dp],Y
   5220 CF33 00                                   .byte ops0 | am_nam   ; $78  SEI
   5221 CF34 23                                   .byte ops2 | am_adry  ; $79  ADC abs,Y
   5222 CF35 00                                   .byte ops0 | am_nam   ; $7A  PLY
   5223 CF36 00                                   .byte ops0 | am_nam   ; $7B  TDC
   5224 CF37 27                                   .byte ops2 | am_indx  ; $7C  JMP (abs,X)
   5225 CF38 22                                   .byte ops2 | am_adrx  ; $7D  ADC abs,X
   5226 CF39 22                                   .byte ops2 | am_adrx  ; $7E  ROR abs,X
   5227 CF3A 32                                   .byte ops3 | am_adrx  ; $7F  ADC absl,X
                                        ;
   5229 CF3B 50                                   .byte bop1 | am_nam   ; $80  BRA abs
   5230 CF3C 17                                   .byte ops1 | am_indx  ; $81  STA (dp,X)
   5231 CF3D 60                                   .byte bop2 | am_nam   ; $82  BRL abs
   5232 CF3E 19                                   .byte ops1 | am_stk   ; $83  STA offset,S
   5233 CF3F 10                                   .byte ops1 | am_nam   ; $84  STY dp
   5234 CF40 10                                   .byte ops1 | am_nam   ; $85  STA dp
   5235 CF41 10                                   .byte ops1 | am_nam   ; $86  STX dp
   5236 CF42 15                                   .byte ops1 | am_indl  ; $87  STA [dp]
   5237 CF43 00                                   .byte ops0 | am_nam   ; $88  DEY
   5238 CF44 91                                   .byte vops | am_imm   ; $89  BIT #
   5239 CF45 00                                   .byte ops0 | am_nam   ; $8A  TXA
   5240 CF46 00                                   .byte ops0 | am_nam   ; $8B  PHB
   5241 CF47 20                                   .byte ops2 | am_nam   ; $8C  STY abs
   5242 CF48 20                                   .byte ops2 | am_nam   ; $8D  STA abs
   5243 CF49 20                                   .byte ops2 | am_nam   ; $8E  STX abs
   5244 CF4A 30                                   .byte ops3 | am_nam   ; $8F  STA absl
                                        ;
   5246 CF4B 50                                   .byte bop1 | am_nam   ; $90  BCC abs
   5247 CF4C 18                                   .byte ops1 | am_indy  ; $91  STA (dp),Y
   5248 CF4D 14                                   .byte ops1 | am_ind   ; $92  STA (dp)
   5249 CF4E 1A                                   .byte ops1 | am_stky  ; $93  STA (offset,S),Y
   5250 CF4F 12                                   .byte ops1 | am_adrx  ; $94  STY dp,X
   5251 CF50 12                                   .byte ops1 | am_adrx  ; $95  STA dp,X
   5252 CF51 13                                   .byte ops1 | am_adry  ; $96  STX dp,Y
   5253 CF52 16                                   .byte ops1 | am_indly ; $97  STA [dp],Y
   5254 CF53 00                                   .byte ops0 | am_nam   ; $98  TYA
   5255 CF54 23                                   .byte ops2 | am_adry  ; $99  STA abs,Y
   5256 CF55 00                                   .byte ops0 | am_nam   ; $9A  TXS
   5257 CF56 00                                   .byte ops0 | am_nam   ; $9B  TXY
   5258 CF57 20                                   .byte ops2 | am_nam   ; $9C  STZ abs
   5259 CF58 22                                   .byte ops2 | am_adrx  ; $9D  STA abs,X
   5260 CF59 22                                   .byte ops2 | am_adrx  ; $9E  STZ abs,X
   5261 CF5A 32                                   .byte ops3 | am_adrx  ; $9F  STA absl,X
                                        ;
   5263 CF5B 91                                   .byte vops | am_imm   ; $A0  LDY #
   5264 CF5C 17                                   .byte ops1 | am_indx  ; $A1  LDA (dp,X)
   5265 CF5D 91                                   .byte vops | am_imm   ; $A2  LDX #
   5266 CF5E 19                                   .byte ops1 | am_stk   ; $A3  LDA offset,S
   5267 CF5F 10                                   .byte ops1 | am_nam   ; $A4  LDY dp
   5268 CF60 10                                   .byte ops1 | am_nam   ; $A5  LDA dp
   5269 CF61 10                                   .byte ops1 | am_nam   ; $A6  LDX dp
   5270 CF62 15                                   .byte ops1 | am_indl  ; $A7  LDA [dp]
   5271 CF63 00                                   .byte ops0 | am_nam   ; $A8  TAY
   5272 CF64 91                                   .byte vops | am_imm   ; $A9  LDA #
   5273 CF65 00                                   .byte ops0 | am_nam   ; $AA  TAX
   5274 CF66 00                                   .byte ops0 | am_nam   ; $AB  PLB
   5275 CF67 20                                   .byte ops2 | am_nam   ; $AC  LDY abs
   5276 CF68 20                                   .byte ops2 | am_nam   ; $AD  LDA abs
   5277 CF69 20                                   .byte ops2 | am_nam   ; $AE  LDX abs
   5278 CF6A 30                                   .byte ops3 | am_nam   ; $AF  LDA absl
                                        ;
   5280 CF6B 50                                   .byte bop1 | am_nam   ; $B0  BCS abs
   5281 CF6C 18                                   .byte ops1 | am_indy  ; $B1  LDA (dp),Y
   5282 CF6D 14                                   .byte ops1 | am_ind   ; $B2  LDA (dp)
   5283 CF6E 1A                                   .byte ops1 | am_stky  ; $B3  LDA (offset,S),Y
   5284 CF6F 12                                   .byte ops1 | am_adrx  ; $B4  LDY dp,X
   5285 CF70 12                                   .byte ops1 | am_adrx  ; $B5  LDA dp,X
   5286 CF71 13                                   .byte ops1 | am_adry  ; $B6  LDX dp,Y
   5287 CF72 16                                   .byte ops1 | am_indly ; $B7  LDA [dp],Y
   5288 CF73 00                                   .byte ops0 | am_nam   ; $B8  CLV
   5289 CF74 23                                   .byte ops2 | am_adry  ; $B9  LDA abs,Y
   5290 CF75 00                                   .byte ops0 | am_nam   ; $BA  TSX
   5291 CF76 00                                   .byte ops0 | am_nam   ; $BB  TYX
   5292 CF77 22                                   .byte ops2 | am_adrx  ; $BC  LDY abs,X
   5293 CF78 22                                   .byte ops2 | am_adrx  ; $BD  LDA abs,X
   5294 CF79 23                                   .byte ops2 | am_adry  ; $BE  LDX abs,Y
   5295 CF7A 32                                   .byte ops3 | am_adrx  ; $BF  LDA absl,X
                                        ;
   5297 CF7B 91                                   .byte vops | am_imm   ; $C0  CPY #
   5298 CF7C 17                                   .byte ops1 | am_indx  ; $C1  CMP (dp,X)
   5299 CF7D 11                                   .byte ops1 | am_imm   ; $C2  REP #
   5300 CF7E 19                                   .byte ops1 | am_stk   ; $C3  CMP offset,S
   5301 CF7F 10                                   .byte ops1 | am_nam   ; $C4  CPY dp
   5302 CF80 10                                   .byte ops1 | am_nam   ; $C5  CMP dp
   5303 CF81 10                                   .byte ops1 | am_nam   ; $C6  DEC dp
   5304 CF82 15                                   .byte ops1 | am_indl  ; $C7  CMP [dp]
   5305 CF83 00                                   .byte ops0 | am_nam   ; $C8  INY
   5306 CF84 91                                   .byte vops | am_imm   ; $C9  CMP #
   5307 CF85 00                                   .byte ops0 | am_nam   ; $CA  DEX
   5308 CF86 00                                   .byte ops0 | am_nam   ; $CB  WAI
   5309 CF87 20                                   .byte ops2 | am_nam   ; $CC  CPY abs
   5310 CF88 20                                   .byte ops2 | am_nam   ; $CD  CMP abs
   5311 CF89 20                                   .byte ops2 | am_nam   ; $CE  DEC abs
   5312 CF8A 30                                   .byte ops3 | am_nam   ; $CF  CMP absl
                                        ;
   5314 CF8B 50                                   .byte bop1 | am_nam   ; $D0  BNE abs
   5315 CF8C 18                                   .byte ops1 | am_indy  ; $D1  CMP (dp),Y
   5316 CF8D 14                                   .byte ops1 | am_ind   ; $D2  CMP (dp)
   5317 CF8E 1A                                   .byte ops1 | am_stky  ; $D3  CMP (offset,S),Y
   5318 CF8F 10                                   .byte ops1 | am_nam   ; $D4  PEI dp
   5319 CF90 12                                   .byte ops1 | am_adrx  ; $D5  CMP dp,X
   5320 CF91 12                                   .byte ops1 | am_adrx  ; $D6  DEC dp,X
   5321 CF92 16                                   .byte ops1 | am_indly ; $D7  CMP [dp],Y
   5322 CF93 00                                   .byte ops0 | am_nam   ; $D8  CLD
   5323 CF94 23                                   .byte ops2 | am_adry  ; $D9  CMP abs,Y
   5324 CF95 00                                   .byte ops0 | am_nam   ; $DA  PHX
   5325 CF96 00                                   .byte ops0 | am_nam   ; $DB  STP
   5326 CF97 25                                   .byte ops2 | am_indl  ; $DC  JMP [abs]
   5327 CF98 22                                   .byte ops2 | am_adrx  ; $DD  CMP abs,X
   5328 CF99 22                                   .byte ops2 | am_adrx  ; $DE  DEC abs,X
   5329 CF9A 32                                   .byte ops3 | am_adrx  ; $DF  CMP absl,X
                                        ;
   5331 CF9B 91                                   .byte vops | am_imm   ; $E0  CPX #
   5332 CF9C 17                                   .byte ops1 | am_indx  ; $E1  SBC (dp,X)
   5333 CF9D 11                                   .byte ops1 | am_imm   ; $E2  SEP #
   5334 CF9E 19                                   .byte ops1 | am_stk   ; $E3  SBC offset,S
   5335 CF9F 10                                   .byte ops1 | am_nam   ; $E4  CPX dp
   5336 CFA0 10                                   .byte ops1 | am_nam   ; $E5  SBC dp
   5337 CFA1 10                                   .byte ops1 | am_nam   ; $E6  INC dp
   5338 CFA2 15                                   .byte ops1 | am_indl  ; $E7  SBC [dp]
   5339 CFA3 00                                   .byte ops0 | am_nam   ; $E8  INX
   5340 CFA4 91                                   .byte vops | am_imm   ; $E9  SBC #
   5341 CFA5 00                                   .byte ops0 | am_nam   ; $EA  NOP
   5342 CFA6 00                                   .byte ops0 | am_nam   ; $EB  XBA
   5343 CFA7 20                                   .byte ops2 | am_nam   ; $EC  CPX abs
   5344 CFA8 20                                   .byte ops2 | am_nam   ; $ED  SBC abs
   5345 CFA9 20                                   .byte ops2 | am_nam   ; $EE  INC abs
   5346 CFAA 30                                   .byte ops3 | am_nam   ; $EF  SBC absl
                                        ;
   5348 CFAB 50                                   .byte bop1 | am_nam   ; $F0  BEQ abs
   5349 CFAC 18                                   .byte ops1 | am_indy  ; $F1  SBC (dp),Y
   5350 CFAD 14                                   .byte ops1 | am_ind   ; $F2  SBC (dp)
   5351 CFAE 1A                                   .byte ops1 | am_stky  ; $F3  SBC (offset,S),Y
   5352 CFAF 21                                   .byte ops2 | am_imm   ; $F4  PEA #
   5353 CFB0 12                                   .byte ops1 | am_adrx  ; $F5  SBC dp,X
   5354 CFB1 12                                   .byte ops1 | am_adrx  ; $F6  INC dp,X
   5355 CFB2 16                                   .byte ops1 | am_indly ; $F7  SBC [dp],Y
   5356 CFB3 00                                   .byte ops0 | am_nam   ; $F8  SED
   5357 CFB4 23                                   .byte ops2 | am_adry  ; $F9  SBC abs,Y
   5358 CFB5 00                                   .byte ops0 | am_nam   ; $FA  PLX
   5359 CFB6 00                                   .byte ops0 | am_nam   ; $FB  XCE
   5360 CFB7 27                                   .byte ops2 | am_indx  ; $FC  JSR (abs,X)
   5361 CFB8 22                                   .byte ops2 | am_adrx  ; $FD  SBC abs,X
   5362 CFB9 22                                   .byte ops2 | am_adrx  ; $FE  INC abs,X
   5363 CFBA 32                                   .byte ops3 | am_adrx  ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	.X & .Y immediate mode opcodes...
                                        ;
   5368 CFBB A0                         vopidx   .byte $a0             ;LDY #
   5369 CFBC A2                                   .byte $a2             ;LDX #
   5370 CFBD C0                                   .byte $c0             ;CPY #
   5371 CFBE E0                                   .byte $e0             ;CPX #
   5598 = 00000004                      n_vopidx =*-vopidx             ;number of opcodes
                                        ;
                                        ;
                                        ;	addressing mode symbology lookup...
                                        ;
   5377 CFBF D7 CF                      ms_lutab .word ms_nam          ;(0000)  no symbol
   5378 CFC1 E1 CF                                .word ms_imm          ;(0001)  #
   5379 CFC3 D9 CF                                .word ms_addrx        ;(0010)  dp,X or abs,X
   5380 CFC5 DD CF                                .word ms_addry        ;(0011)  dp,Y or abs,Y
   5381 CFC7 E3 CF                                .word ms_ind          ;(0100)  (dp) or (abs)
   5382 CFC9 E6 CF                                .word ms_indl         ;(0101)  [dp] or [abs]
   5383 CFCB E9 CF                                .word ms_indly        ;(0110)  [dp],Y
   5384 CFCD EE CF                                .word ms_indx         ;(0111)  (dp,X) or (abs,X)
   5385 CFCF F3 CF                                .word ms_indy         ;(1000)  (dp),Y
   5386 CFD1 FB CF                                .word ms_stk          ;(1001)  offset,S
   5387 CFD3 FF CF                                .word ms_stky         ;(1010) (offset,S),Y
   5388 CFD5 D7 CF                                .word ms_nam          ;(1011) sbnk,dbnk
                                        ;
                                        ;
                                        ;	addressing mode symbology strings...
                                        ;
   5393 CFD7 20 00                      ms_nam   .byte " ",0           ;no symbol
   5394 CFD9 20 2C 58 00                ms_addrx .byte " ,X",0         ;dp,X or addr,X
   5395 CFDD 20 2C 59 00                ms_addry .byte " ,Y",0         ;dp,Y or addr,Y
   5396 CFE1 23 00                      ms_imm   .byte "#",0           ;immediate
   5397 CFE3 28 29 00                   ms_ind   .byte "()",0          ;(dp) or (abs)
   5398 CFE6 5B 5D 00                   ms_indl  .byte "[]",0          ;[dp] or [abs]
   5399 CFE9 5B 5D 2C 59 00             ms_indly .byte "[],Y",0        ;[dp],Y
   5400 CFEE 28 2C 58 29 00             ms_indx  .byte "(,X)",0        ;(dp,X) or (abs,X)
   5401 CFF3 28 29 2C 59 00             ms_indy  .byte "(),Y",0        ;(dp),Y
   5402 CFF8 2C 24 00                   ms_move  .byte ",$",0          ;MVN/MVP sbnk,dbnk
   5403 CFFB 20 2C 53 00                ms_stk   .byte " ,S",0         ;offset,S
   5404 CFFF 28 2C 53 29 2C 59 00       ms_stky  .byte "(,S),Y",0      ;(offset,S),Y
   5405 D006 7B 7D 2C 59 00             ms_indxly	.byte "{},Y",0     ;{dp},Y
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL STRINGS
                                        ;
   5411 D00B 1B 28                      dc_bf +         .byte a_esc,"("
   5411 D00D 1B 47 34                 +            .byte a_esc,"G4"
                                                            ;enable reverse foreground
   5412 D010 00                                   .byte 0
                                        ;
   5414 D011 08                         dc_bs +         .byte a_bs
   5414 D012 1B 57                    +   +         .byte a_esc,"W"
                                        
                                                            ;destructive backspace
   5416 D014 00                                   .byte 0
                                        ;
   5418 D015 1B 54                      dc_cl +         .byte a_esc,"T"
                                                            ;clear to end of line 
   5419 D017 00                                   .byte 0
                                        ;
   5421 D018 1B 60 31                   dc_cn +         .byte a_esc,"`1"
                                                            ;cursor on
   5422 D01B 00                                   .byte 0
                                        ;
   5424 D01C 1B 60 30                   dc_co +         .byte a_esc,"`0"
                                                            ;cursor off
   5425 D01F 00                                   .byte 0
                                        ;
   5427 D020 1B 28                      dc_er +         .byte a_esc,"("
   5427 D022 1B 47 30                 +            .byte a_esc,"G0"
                                                            ;enable normal foreground
   5428 D025 00                                   .byte 0
                                        ;
   5430 D026 0D                         dc_lf ++         .byte a_cr
                                     +   
   5430 D027 0A                       +            .byte a_lf
                                                            ;newline
   5431 D028 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;TEXT STRINGS
                                        ;
   5437 D029 07                         mm_brk +         .byte a_bel
                                        
   5438 D02A 0D                       +   +         .byte a_cr
                                     +   
   5438 D02B 0A                       +            .byte a_lf
                                        
   5439 D02C 2A 2A 42 52 4B                       .byte "**BRK"
   5440 D031 0D                       +   +         .byte a_cr
                                     +   
   5440 D032 0A                       +            .byte a_lf
                                        
   5441 D033 00                                   .byte 0
                                        ;
   5443 D034 0D                         mm_entry ++         .byte a_cr
                                     +   
   5443 D035 0A                       +            .byte a_lf
                                        
   5444 D036 0A 53 75 70 65 72 6D 6F              .byte a_lf,"Supermon 832 "
   5444 D03E 6E 20 38 33 32 20         
   5445 D044 31                       +            .byte "1"
   5445 D045 2E                       +            .byte "."
   5445 D046 30                       +            .byte "0"
   5445 D047 2E                       +            .byte "."
   5445 D048 30                       +            .byte "0"
                                        
   5446 D049 20                                   .byte " "
   5447 D04A 0D                       +   +         .byte a_cr
                                     +   
   5447 D04B 0A                       +            .byte a_lf
                                        
   5448 D04C 00                                   .byte 0
                                        ;
   5450 D04D 20 2A 2A 45 52 52 20 20    mm_err   .byte " **ERR  ",0
   5450 D055 00                        
                                        ;
   5452 D056 0D                         mm_prmpt ++         .byte a_cr
                                     +   
   5452 D057 0A                       +            .byte a_lf
                                        
   5453 D058 1B 28                    +            .byte a_esc,"("
   5453 D05A 1B 47 30                 +            .byte a_esc,"G0"
                                        
   5454 D05D 2E 00                                .byte ".",0
                                        ;
   5456 D05F 0D                         mm_regs ++         .byte a_cr
                                     +   
   5456 D060 0A                       +            .byte a_lf
                                        
   5457 D061 20 20 20 20 20 20 20 20              .byte "                    31"
   5457 D069 20 20 20 20 20 20 20 20   
   5457 D071 20 20 20 20 33 31         
   5458 D077 0D                       +   +         .byte a_cr
                                     +   
   5458 D078 0A                       +            .byte a_lf
                                        
   5459 D079 20 20 20 43 53 20 20 50              .byte "   CS  PB  PC   26NVmxDIZC    .A       .X       .Y       SP  "
   5459 D081 42 20 20 50 43 20 20 20   
   5459 D089 32 36 4E 56 6D 78 44 49   
   5459 D091 5A 43 20 20 20 20 2E 41   
   5459 D099 20 20 20 20 20 20 20 2E   
   5459 D0A1 58 20 20 20 20 20 20 20   
   5459 D0A9 2E 59 20 20 20 20 20 20   
   5459 D0B1 20 53 50 20 20            
   5460 D0B6 0D                       +   +         .byte a_cr
                                     +   
   5460 D0B7 0A                       +            .byte a_lf
                                        
   5461 D0B8 3B 20 00                             .byte "; ",0
   5462 D0BB 0D                         mm_regs2 ++         .byte a_cr
                                     +   
   5462 D0BC 0A                       +            .byte a_lf
                                        
   5463 D0BD 20 20 20 44 53 20 20 20              .byte "   DS   SS  DP  DB"
   5463 D0C5 53 53 20 20 44 50 20 20   
   5463 D0CD 44 42                     
   5464 D0CF 0D                       +   +         .byte a_cr
                                     +   
   5464 D0D0 0A                       +            .byte a_lf
                                        
   5465 D0D1 3B 20 00                             .byte "; ",0
                                        ;
   5467 D0D4 07                         mm_rts +         .byte a_bel
                                        
   5468 D0D5 0D                       +   +         .byte a_cr
                                     +   
   5468 D0D6 0A                       +            .byte a_lf
                                        
   5469 D0D7 2A 2A 52 54 53                       .byte "**RTS"
   5470 D0DC 0D                       +   +         .byte a_cr
                                     +   
   5470 D0DD 0A                       +            .byte a_lf
                                        
   5471 D0DE 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;VECTOR STORAGE
                                        ;
                                        ;
   5774 = 0000D0DF                      _txtend_ =*                     ;end of program text
                                        ;
                                        ;================================================================================
                                        	;.end
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
FTBios816.asm


                                        .include "supermon832.asm"
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
FAC1ToString.asm

                                        ; ============================================================================
                                        ; FAC1ToString.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014  Robert Finch, Stratford
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
                                        ; This code is a heavily modified version of the floating point to string
                                        ; conversion routine which is a part of Lee Davison's EhBASIC.
                                        ;
   5806 = 00000000000000C6                            Cvaral		= $C6		; current var address low byte
   5807 = 000000C7                      Cvarah		= Cvaral+1	; current var address high byte
   5808 = 00000000000000C0                            numexp		= $C0		; string to float number exponent count
   5809 = 00000000000000C2                            expcnt		= $C2		; string to float exponent count
   5810 = 00000000000000C4                            Sendl			= $C4	; BASIC pointer temp low byte
   5811 = 00000000000000C5                            Sendh			= $C5	; BASIC pointer temp low byte
                                        
   5813 = 00000000000003A0                            Decss		= $3A0		; number to decimal string start
   5814 = 000003A1                      Decssp1		= Decss+1	; number to decimal string start
   5815 = 0000000000000001                            FP_ADD		EQU		1
   5816 = 0000000000000002                            FP_SUB		EQU		2
   5817 = 0000000000000003                            FP_MUL		EQU		3
   5818 = 0000000000000004                            FP_DIV		EQU		4
   5819 = 0000000000000005                            FP_FIX2FLT	EQU		5
   5820 = 0000000000000006                            FP_FLT2FIX	EQU		6
   5821 = 0000000000000007                            FP_ABS		EQU		7
   5822 = 0000000000000010                            FP_NEG		EQU		16
   5823 = 0000000000000011                            FP_SWAP		EQU		17
   5824 = 0000000000000083                            FIXED_MUL	EQU		$83
   5825 = 0000000000000081                            FIXED_ADD	EQU		$81
   5826 = 0000000000000082                            FIXED_SUB	EQU		$82
                                        ;parameter FIXED_DIV = 8'h84;
                                        ;parameter FIXED_ABS = 8'h87;
                                        ;parameter FIXED_NEG = 8'h90;
   5830 = 0000000000FEA20E                            FP_CMDREG	EQU		$FEA20E
   5831 = 0000000000FEA20E                            FP_STATREG	EQU		$FEA20E
   5832 = 0000000000FEA200                            FAC1		EQU		$FEA200
   5833 = 0000000000FEA200                            FAC1_5		EQU		$FEA200
   5834 = 0000000000FEA202                            FAC1_4		EQU		$FEA202
   5835 = 0000000000FEA204                            FAC1_3		EQU		$FEA204
   5836 = 0000000000FEA206                            FAC1_2		EQU		$FEA206
   5837 = 0000000000FEA208                            FAC1_1		EQU		$FEA208
   5838 = 0000000000FEA208                            FAC1_msw	EQU		$FEA208
   5839 = 0000000000FEA20A                            FAC1_e		EQU		$FEA20A
   5840 = 0000000000FEA210                            FAC2		EQU		$FEA210
                                        
                                           	CPU		W65C816S
                                           	NDX		16
                                           	MEM		16
                                           	
                                           public FAC1ToString:
                                           
                                           ; The first chunk of code determines if the number is positive or negative
                                           ; and spits out the appropriate sign. Next it takes the absolute value of
                                           ; the accumulator so following code only has to deal with positive numbers.
                                           
   5556 00D0DF A0 00 00                     	LDY	#$00			; set index = 1
   5557 00D0E2 AF 08 A2 FE                  	LDA	FAC1_msw		; test FAC1 sign (b15) (Can't use BIT)
   5558 00D0E6 10 0E                        	BPL	.0002		; branch if +ve
   5559 00D0E8 A9 2D 00                     	LDA	#'-'			; else character = "-"
   5560 00D0EB 99 A0 03                     	STA	Decss,Y		; save leading character (" " or "-")
   5561 00D0EE A9 10 00                     	LDA	#FP_NEG		; make the FAC positive
   5562 00D0F1 20 18 D3                     	JSR	FPCommandWait
   5563 00D0F4 80 06                        	BRA	.0001
   5564 00D0F6                             .0002:
   5565 00D0F6 A9 20 00                     	LDA	#$20			; character = " " (assume +ve)
   5566 00D0F9 99 A0 03                     	STA	Decss,Y
   5567 00D0FC                             .0001:
   5568 00D0FC 84 C4                        	STY	Sendl			; save index
                                           
                                           ; This little bit of code check for a zero exponent which indicates a
                                           ; value of zero.
                                           
   5573 00D0FE AF 0A A2 FE                  	LDA	FAC1_e		; get FAC1 exponent
   5574 00D102 AA                           	TAX
   5575 00D103 D0 06                        	BNE	LAB_2989		; branch if FAC1<>0
                                           					; exponent was $00 so FAC1 is 0
   5577 00D105 A9 30 00                     	LDA	#'0'			; set character = "0"
   5578 00D108 82 93 01                     	BRL	LAB_2A89		; save last character, [EOT] and exit
                                           
                                           ; This loop attempts to make small values more significant, so that there are
                                           ; fewer leading zeros in the value. (The exponent is decremented so that it
                                           ; corresponds). Because of the potential for extremely small values looping is
                                           ; limited. The problem is the 16 bit exponent can allow for much smaller
                                           ; values than an 8 bit exponent would and we don't want to loop for thousands
                                           ; of iterations in order to display a value that's almost zero.
                                           
                                           					; FAC1 is some non zero value
   5588 00D10B                             LAB_2989
   5589 00D10B 84 C4                        	STY	Sendl			; save off .Y
   5590 00D10D A0 67 06                     	LDY #1639			; max number of retries
   5591 00D110 A9 00 00                     	LDA	#$00			; clear (number exponent count)
   5592 00D113 85 C0                        	STA numexp
   5593 00D115                             LOOP_MBMILLION:
   5594 00D115 E0 00 80                     	CPX	#$8000			; compare FAC1 exponent with $8000 (>1.00000)
   5595 00D118 B0 1A                        	BCS	LAB_299A		; branch if FAC1=>1
                                           					; FAC1<1
   5597 00D11A F4 67 D3                     	PEA	A_MILLION		; multiply FAC * 1,000,000
   5598 00D11D 20 CD D2                     	JSR	LOAD_FAC2		; 
   5599 00D120 68                           	PLA					; get rid of parameter
   5600 00D121 20 C7 D2                     	JSR	FMUL
   5601 00D124 A5 C0                        	LDA numexp
   5602 00D126 38                           	SEC
   5603 00D127 E9 06 00                     	SBC	#6				; set number exponent count (-6)
   5604 00D12A 85 C0                        	STA numexp
   5605 00D12C AF 0A A2 FE                  	LDA FAC1_e
   5606 00D130 AA                           	TAX
   5607 00D131 88                           	DEY
   5608 00D132 10 E1                        	BPL	LOOP_MBMILLION
                                           
   5610 00D134                             LAB_299A
   5611 00D134 A4 C4                        	LDY	Sendl		; get back .Y
                                           
                                           ; These two loops coerce the value of the FAC to be between 100,000 and
                                           ; 1,000,000. This gives a maximum of six digits before the decimal point
                                           ; in scientific notation.
                                           
                                           ; This loop divides by 10 until the value in the FAC is less than 1,000,000
                                           ;
   5619 00D136                             LOOP_DB10:
   5620 00D136 F4 7F D3                     	PEA	MAX_BEFORE_SCI	; set pointer low byte to 999999.4375 (max before sci note)
   5621 00D139 20 CD D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5622 00D13C 68                           	PLA					; get rid of parameter
   5623 00D13D AF 0E A2 FE                  	LDA FP_CMDREG
   5624 00D141 89 08 00                     	BIT	#$08			; test equals bit
   5625 00D144 D0 28                        	BNE	LAB_29C3		; exit if FAC1 = (AY)
   5626 00D146 89 04 00                     	BIT	#$04			; test greater than bit
   5627 00D149 F0 07                        	BEQ	LOOP_MB10		; go do *10 if FAC1 < (AY)
                                           
   5629 00D14B                             LAB_29B9
   5630 00D14B 20 05 D3                     	JSR	DivideByTen		; divide by 10
   5631 00D14E E6 C0                        	INC	numexp			; increment number exponent count
   5632 00D150 80 E4                        	BRA	LOOP_DB10		; go test again (branch always)
                                           
                                           ; This loop multiplies the value by 10 until it's greater than
                                           ; 100,000.
                                           					; FAC1 < (AY)
   5637 00D152                             LOOP_MB10
   5638 00D152 F4 97 D3                     	PEA CONST_9375		; set pointer to 99999.9375
   5639 00D155 20 CD D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5640 00D158 68                           	PLA					; get rid of parameter
   5641 00D159 AF 0E A2 FE                  	LDA FP_CMDREG
   5642 00D15D 89 08 00                     	BIT #$08
   5643 00D160 D0 05                        	BNE	LAB_29B2		; branch if FAC1 = (AY) (allow decimal places)
   5644 00D162 89 04 00                     	BIT #$04
   5645 00D165 D0 07                        	BNE	LAB_29C0		; branch if FAC1 > (AY) (no decimal places)
                                           					; FAC1 <= (AY)
   5647 00D167                             LAB_29B2
   5648 00D167 20 F8 D2                     	JSR	MultiplyByTen	; multiply by 10
   5649 00D16A C6 C0                        	DEC	numexp		; decrement number exponent count
   5650 00D16C 80 E4                        	BRA	LOOP_MB10		; go test again (branch always)
                                           
                                           ; now we have just the digits to do
                                           
   5654 00D16E                             LAB_29C0
                                           ;	JSR	AddPoint5		; add 0.5 to FAC1 (round FAC1)
   5656 00D16E                             LAB_29C3
                                           ;	JSR	FloatToFixed	; convert FAC1 floating-to-fixed
   5658 00D16E A2 01 00                     	LDX	#$01			; set default digits before dp = 1
   5659 00D171 A5 C0                        	LDA	numexp		; get number exponent count
   5660 00D173 18                           	CLC				; clear carry for add
   5661 00D174 69 07 00                     	ADC	#$07			; up to 6 digits before point
   5662 00D177 30 0A                        	BMI	LAB_29D8		; if -ve then 1 digit before dp
                                           
   5664 00D179 C9 08 00                     	CMP	#$08			; A>=8 if n>=1E6
   5665 00D17C B0 06                        	BCS	LAB_29D9		; branch if >= $08
                                           
                                           					; carry is clear
   5668 00D17E AA                           	TAX				; copy to A
   5669 00D17F CA                           	DEX				; take 1 from digit count
   5670 00D180 A9 02 00                     	LDA	#$02			;.set exponent adjust
                                           
   5672 00D183                             LAB_29D8
   5673 00D183 38                           	SEC				; set carry for subtract
   5674 00D184                             LAB_29D9
   5675 00D184 E9 02 00                     	SBC	#$02			; -2
   5676 00D187 85 C2                        	STA	expcnt		;.save exponent adjust
   5677 00D189 86 C0                        	STX	numexp		; save digits before dp count
   5678 00D18B 8A                           	TXA				; copy to A
   5679 00D18C F0 02                        	BEQ	LAB_29E4		; branch if no digits before dp
                                           
   5681 00D18E 10 15                        	BPL	LAB_29F7		; branch if digits before dp
                                           
   5683 00D190                             LAB_29E4
   5684 00D190 A4 C4                        	LDY	Sendl			; get output string index
   5685 00D192 A9 2E 00                     	LDA	#'.'			; character "."
   5686 00D195 C8                           	INY				; increment index
   5687 00D196 99 A0 03                     	STA	Decss,Y		; save to output string
   5688 00D199 8A                           	TXA				;.
   5689 00D19A F0 07                        	BEQ	LAB_29F5		;.
                                           
   5691 00D19C A9 30 00                     	LDA	#'0'			; character "0"
   5692 00D19F C8                           	INY				; increment index
   5693 00D1A0 99 A0 03                     	STA	Decss,Y		; save to output string
   5694 00D1A3                             LAB_29F5
   5695 00D1A3 84 C4                        	STY	Sendl			; save output string index
                                           
   5697 00D1A5                             LAB_29F7
   5698 00D1A5 A2 30 00                     	LDX	#'0'			; holds onto the digit value
                                           
                                           ; Now loop subtracting 100,000 as many times as we can. The value was coerced
                                           ; to be between 100,000 and 1,000,000. Count the number of times subtraction
                                           ; can be done successfully.
                                           ;
   5704 00D1A8                             LAB_29FB
   5705 00D1A8 F4 73 D3                     	PEA CONST_100000
   5706 00D1AB 20 CD D2                     	JSR LOAD_FAC2	; load FAC2 with 100,000
   5707 00D1AE 68                           	PLA				; get rid of parameter
   5708 00D1AF AF 0E A2 FE                  	LDA FP_STATREG
   5709 00D1B3 89 04 00                     	BIT #$04		; Is FAC1 > 100,000 ?
   5710 00D1B6 F0 0F                        	BEQ	.0005		; branch if not
   5711 00D1B8 A9 11 00                     	LDA #FP_SWAP	; subtract is FAC2-FAC1!
   5712 00D1BB 20 18 D3                     	JSR FPCommandWait;
   5713 00D1BE A9 02 00                     	LDA #FP_SUB		; subtract 100,000 from the mantissa.
   5714 00D1C1 20 18 D3                     	JSR FPCommandWait
   5715 00D1C4 E8                           	INX				; increment the value of the digit
   5716 00D1C5 80 E1                        	BRA	LAB_29FB	; try again
   5717 00D1C7                             .0005:
   5718 00D1C7 8A                           	TXA
   5719 00D1C8 A4 C4                        	LDY	Sendl			; get output string index
   5720 00D1CA C8                           	INY				; increment output string index
   5721 00D1CB 8A                           	TXA
   5722 00D1CC 99 A0 03                     	STA	Decss,Y		; save to output string
   5723 00D1CF C6 C0                        	DEC	numexp		; decrement # of characters before the dp
   5724 00D1D1 D0 07                        	BNE	LAB_2A3B		; branch if still characters to do
                                           				; else output the point
   5726 00D1D3 A9 2E 00                     	LDA	#'.'			; character "."
   5727 00D1D6 C8                           	INY				; increment output string index
   5728 00D1D7 99 A0 03                     	STA	Decss,Y		; save to output string
   5729 00D1DA                             LAB_2A3B
   5730 00D1DA 84 C4                        	STY	Sendl		; save output string index
                                           	; We subtracted until the value was < 100,000 so multiply the
                                           	; remainder upwards to get the next digit.
   5733 00D1DC 20 F8 D2                     	JSR	MultiplyByTen	; If not, multiply by 10
   5734 00D1DF C0 1B 00                     	CPY #27			; converted (+/- . incl)
   5735 00D1E2 90 C1                        	BCC	LAB_29F7
                                           					; now remove trailing zeroes
   5737 00D1E4                             .RemoveTrailingZeros
   5738 00D1E4 B9 A0 03                     	LDA	Decss,Y		; get character from output string
   5739 00D1E7 29 FF 00                     	AND	#$FF		; mask to a byte
   5740 00D1EA 88                           	DEY				; decrement output string index
   5741 00D1EB C9 30 00                     	CMP	#'0'			; compare with "0"
   5742 00D1EE F0 F4                        	BEQ	.RemoveTrailingZeros	; loop until non "0" character found
                                           
   5744 00D1F0 C9 2E 00                     	CMP	#'.'			; compare with "."
   5745 00D1F3 F0 01                        	BEQ	LAB_2A58		; branch if was dp
                                           
                                           					; restore last character
   5748 00D1F5 C8                           	INY				; increment output string index
   5749 00D1F6                             LAB_2A58
   5750 00D1F6 A9 2B 00                     	LDA	#'+'			; character "+"
   5751 00D1F9 A6 C2                        	LDX	expcnt		; get exponent count
   5752 00D1FB F0 FF A2 00                  	LBEQ	LAB_2A8C		; if zero go set null terminator and exit
                                           
                                           					; exponent isn't zero so write exponent
   5755 00D1FF 10 0A                        	BPL	LAB_2A68		; branch if exponent count +ve
                                           
   5757 00D201 A9 00 00                     	LDA	#$00			; clear A
   5758 00D204 38                           	SEC				; set carry for subtract
   5759 00D205 E5 C2                        	SBC	expcnt		; subtract exponent count adjust (convert -ve to +ve)
   5760 00D207 AA                           	TAX				; copy exponent count to X
   5761 00D208 A9 2D 00                     	LDA	#'-'			; character "-"
                                           
                                           ; We must keep moving forwards through the string because the acc is storing
                                           ; two bytes.
                                           
   5766 00D20B                             LAB_2A68
   5767 00D20B 48                           	PHA
   5768 00D20C A9 45 00                     	LDA	#'E'			; character "E"
   5769 00D20F 99 A1 03                     	STA	Decss+1,Y		; save exponent sign to output string
   5770 00D212 68                           	PLA
   5771 00D213 99 A2 03                     	STA	Decss+2,Y		; save to output string
   5772 00D216 8A                           	TXA				; get exponent count back
                                           
                                           ; do highest exponent digit
   5775 00D217 64 C4                        	STZ Sendl
   5776 00D219 A2 2F 00                     	LDX	#'0'-1		; one less than "0" character
   5777 00D21C 38                           	SEC				; set carry for subtract
   5778 00D21D E8                          .0001:				
   5779 00D21E E9 10 27                     	SBC	#10000
   5780 00D221 B0 FA                        	BCS .0001
   5781 00D223 69 10 27                     	ADC #10000
   5782 00D226 E0 30 00                     	CPX #'0'
   5783 00D229 F0 09                        	BEQ .0005
   5784 00D22B E6 C4                        	INC Sendl
   5785 00D22D 48                           	PHA
   5786 00D22E 8A                           	TXA
   5787 00D22F 99 A3 03                     	STA Decss+3,Y
   5788 00D232 68                           	PLA
   5789 00D233 C8                           	INY
                                           ; do the next exponent digit
   5791 00D234                             .0005:
   5792 00D234 A2 2F 00                     	LDX #'0'-1
   5793 00D237 38                           	SEC
   5794 00D238                             .0002:
   5795 00D238 E8                           	INX
   5796 00D239 E9 E8 03                     	SBC #1000
   5797 00D23C B0 FA                        	BCS .0002
   5798 00D23E 69 E8 03                     	ADC #1000
   5799 00D241 46 C4                        	LSR Sendl
   5800 00D243 B0 05                        	BCS .00010
   5801 00D245 E0 30 00                     	CPX #'0'
   5802 00D248 F0 09                        	BEQ .0006
   5803 00D24A                             .00010:
   5804 00D24A E6 C4                        	INC Sendl
   5805 00D24C 48                           	PHA
   5806 00D24D 8A                           	TXA
   5807 00D24E 99 A3 03                     	STA Decss+3,Y
   5808 00D251 68                           	PLA
   5809 00D252 C8                           	INY
                                           ; and the next
   5811 00D253                             .0006:
   5812 00D253 A2 2F 00                     	LDX	#'0'-1
   5813 00D256 38                           	SEC
   5814 00D257                             .0003:
   5815 00D257 E8                           	INX
   5816 00D258 E9 64 00                     	SBC #100
   5817 00D25B B0 FA                        	BCS .0003
   5818 00D25D 69 64 00                     	ADC #100
   5819 00D260 46 C4                        	LSR Sendl
   5820 00D262 B0 05                        	BCS .00011
   5821 00D264 E0 30 00                     	CPX #'0'
   5822 00D267 F0 09                        	BEQ .0007
   5823 00D269                             .00011:
   5824 00D269 E6 C4                        	INC Sendl
   5825 00D26B 48                           	PHA
   5826 00D26C 8A                           	TXA
   5827 00D26D 99 A3 03                     	STA Decss+3,Y
   5828 00D270 68                           	PLA
   5829 00D271 C8                           	INY
                                           
   5831 00D272                             .0007:
   5832 00D272 A2 2F 00                     	LDX #'0'-1
   5833 00D275 38                           	SEC
   5834 00D276                             .0004:
   5835 00D276 E8                           	INX
   5836 00D277 E9 0A 00                     	SBC #10
   5837 00D27A B0 FA                        	BCS .0004
   5838 00D27C 69 0A 00                     	ADC #10
   5839 00D27F 46 C4                        	LSR Sendl
   5840 00D281 B0 05                        	BCS .00012
   5841 00D283 E0 30 00                     	CPX #'0'
   5842 00D286 F0 09                        	BEQ .0008
   5843 00D288                             .00012:
   5844 00D288 E6 C4                        	INC Sendl
   5845 00D28A 48                           	PHA
   5846 00D28B 8A                           	TXA
   5847 00D28C 99 A3 03                     	STA Decss+3,Y
   5848 00D28F 68                           	PLA
   5849 00D290 C8                           	INY
                                           
   5851 00D291                             .0008:
   5852 00D291 69 30 00                     	ADC #'0'
   5853 00D294 99 A3 03                     	STA Decss+3,Y
   5854 00D297 A9 00 00                     	LDA	#$00			; set null terminator
   5855 00D29A 99 A4 03                     	STA	Decss+4,Y		; save to output string
   5856 00D29D 60                           	RTS					; go set string pointer (AY) and exit (branch always)
                                           
   5858 00D29E                             LAB_2A89
   5859 00D29E 99 A0 03                     	STA	Decss,Y		; save last character to output string
                                           					; set null terminator and exit
   5861 00D2A1                             LAB_2A8C
   5862 00D2A1 A9 00 00                     	LDA	#$00			; set null terminator
   5863 00D2A4 99 A1 03                     	STA	Decss+1,Y		; save after last character
                                           
   5865 00D2A7                             LAB_2A91
                                           ;	LDA	#<Decssp1		; set result string low pointer
                                           ;	LDY	#>Decssp1		; set result string high pointer
   5868 00D2A7 60                           	RTS
                                           
   5870 00D2A8                             LAB_25FB:
   5871 00D2A8 A9 11 00                     	LDA		#FP_SWAP
   5872 00D2AB 20 18 D3                     	JSR		FPCommandWait
   5873 00D2AE A0 00 00                     	LDY		#0
   5874 00D2B1 BB                           	TYX
   5875 00D2B2                             .0002:
   5876 00D2B2 B3 03                        	LDA		(3,S),Y
   5877 00D2B4 9F 00 A2 FE                  	STA		FAC1,X
   5878 00D2B8 C8                           	INY
   5879 00D2B9 C8                           	INY
   5880 00D2BA E8                           	INX
   5881 00D2BB E8                           	INX
   5882 00D2BC E0 0C 00                     	CPX		#12
   5883 00D2BF D0 F1                        	BNE		.0002
   5884 00D2C1 A9 05 00                     	LDA		#FP_FIX2FLT
   5885 00D2C4 20 18 D3                     	JSR		FPCommandWait
   5886 00D2C7                             FMUL:
   5887 00D2C7 A9 03 00                     	LDA		#FP_MUL
   5888 00D2CA 4C 18 D3                     	JMP		FPCommandWait
   5889 00D2CD                             	
   5890 00D2CD DA                           	PHX
   5891 00D2CE 5A                           	PHY
   5892 00D2CF A0 00 00                     	LDY		#0
   5893 00D2D2 BB                           	TYX
   5894 00D2D3                             .0002:
   5895 00D2D3 B3 07                        	LDA		(7,s),Y
   5896 00D2D5 9F 10 A2 FE                  	STA		FAC2,X
   5897 00D2D9 C8                           	INY
   5898 00D2DA C8                           	INY
   5899 00D2DB E8                           	INX
   5900 00D2DC E8                           	INX
   5901 00D2DD E0 0C 00                     	CPX		#12
   5902 00D2E0 D0 F1                        	BNE		.0002
   5903 00D2E2 7A                           	PLY
   5904 00D2E3 FA                           	PLX
   5905 00D2E4 60                           	RTS
   5906 00D2E5                             	
   5907 00D2E5 A9 06 00                     	LDA		#FP_FLT2FIX
   5908 00D2E8 4C 18 D3                     	JMP		FPCommandWait
   5909 00D2EB                             	
   5910 00D2EB F4 A3 D3                     	PEA		CONST_POINT5
   5911 00D2EE 20 CD D2                     	JSR		LOAD_FAC2
   5912 00D2F1 68                           	PLA
   5913 00D2F2 A9 01 00                     	LDA		#FP_ADD
   5914 00D2F5 4C 18 D3                     	JMP		FPCommandWait
   5915 00D2F8                             	
   5916 00D2F8 F4 8B D3                     	PEA		TEN_AS_FLOAT
   5917 00D2FB 20 CD D2                     	JSR		LOAD_FAC2
   5918 00D2FE 68                           	PLA
   5919 00D2FF A9 03 00                     	LDA		#FP_MUL
   5920 00D302 4C 18 D3                     	JMP		FPCommandWait
                                           	
   5922 00D305 F4 8B D3                     	PEA		TEN_AS_FLOAT
   5923 00D308 20 CD D2                     	JSR		LOAD_FAC2
   5924 00D30B 68                           	PLA
   5925 00D30C 20 15 D3                     	JSR		SwapFACs
   5926 00D30F A9 04 00                     	LDA		#FP_DIV
   5927 00D312 4C 18 D3                     	JMP		FPCommandWait
   5928 00D315                             	
   5929 00D315 A9 11 00                     	LDA		#FP_SWAP
                                           
                                           ; Issue a command to the FP unit and wait for it to complete
                                           ;
                                           public FPCommandWait:
   5934 00D318 48                           	PHA
   5935 00D319 A9 06 00                     	LDA		#6
   5936 00D31C 8D 00 70                     	STA		$7000
   5937 00D31F                             .0001:
   5938 00D31F AF 0E A2 FE                  	LDA		FP_STATREG	; get the status register
   5939 00D323 89 80 00                     	BIT		#$80		; check for busy bit
   5940 00D326 D0 F7                        	BNE		.0001		; if busy go back
   5941 00D328 68                           	PLA					; to pop acc
   5942 00D329 8F 0E A2 FE                  	STA		FP_CMDREG	; store the command
   5943 00D32D 48                           	PHA
   5944 00D32E A9 07 00                     	LDA		#7
   5945 00D331 8D 00 70                     	STA		$7000
   5946 00D334 68                           	PLA
   5947 00D335 60                           	RTS
                                           
                                           ; Display the FAC1 as a hex number
                                           ;
                                           public DispFAC1:
   5952 00D336 AF 0A A2 FE                  	LDA FAC1_e
   5953 00D33A 20 B6 EC                     	JSR DispWord
   5954 00D33D AF 08 A2 FE                  	LDA	FAC1_1
   5955 00D341 20 B6 EC                     	JSR	DispWord
   5956 00D344 AF 06 A2 FE                  	LDA FAC1_2
   5957 00D348 20 B6 EC                     	JSR	DispWord
   5958 00D34B AF 04 A2 FE                  	LDA FAC1_3
   5959 00D34F 20 B6 EC                     	JSR DispWord
   5960 00D352 AF 02 A2 FE                  	LDA FAC1_4
   5961 00D356 20 B6 EC                     	JSR DispWord
   5962 00D359 AF 00 A2 FE                  	LDA FAC1_5
   5963 00D35D 20 B6 EC                     	JSR DispWord
   5964 00D360 A9 20 00                     	LDA #' '
   5965 00D363 20 D6 EB                     	JSR OutChar
   5966 00D366 60                           	RTS
                                           ;
                                           ; 1,000,000 as a floating point number
                                           ;
   5970 00D367                             A_MILLION:	; $F4240
   5971 00D367 00 00                        	dw		$0000
   5972 00D369 00 00                        	dw		$0000
   5973 00D36B 00 00                        	dw		$0000
   5974 00D36D 00 00                        	dW		$0000
   5975 00D36F 12 7A                        	dw		$7A12
   5976 00D371 13 80                        	dw		$8013
                                           
   5978 00D373                             CONST_100000:
                                           	;186A0
   5980 00D373 00 00                        	dw		$0000
   5981 00D375 00 00                        	dw		$0000
   5982 00D377 00 00                        	dw		$0000
   5983 00D379 00 00                        	dw		$0000
   5984 00D37B A8 61                        	dw		$61A8
   5985 00D37D 10 80                        	dw		$8010
                                           ; The constant 999999.4375 as hex
                                           ; 01.11_1010_0001_0001_1111_1011_1000_00000000000000000000000000
   5988 00D37F                             MAX_BEFORE_SCI:
   5989 00D37F 00 00                        	dw  $0000
   5990 00D381 00 00                        	dw  $0000
   5991 00D383 00 00                        	dw	$0000
   5992 00D385 80 FB                        	dw	$FB80
   5993 00D387 11 7A                        	dw	$7A11
   5994 00D389 13 80                        	dw	$8013
                                           
   5996 00D38B                             TEN_AS_FLOAT:
   5997 00D38B 00 00                        	dw	$0000
   5998 00D38D 00 00                        	dw	$0000
   5999 00D38F 00 00                        	dw	$0000
   6000 00D391 00 00                        	dw	$0000
   6001 00D393 00 50                        	dw	$5000
   6002 00D395 03 80                        	dw	$8003
                                           
                                           ; 99999.9375
                                           ; 01.10_0001_1010_0111_1111_1100_000000000000000000000000000000
                                           ;
   6007 00D397                             CONST_9375:
   6008 00D397 00 00                        	dw	$0000
   6009 00D399 00 00                        	dw	$0000
   6010 00D39B 00 00                        	dw	$0000
   6011 00D39D 00 FC                        	dw	$FC00
   6012 00D39F A7 61                        	dw	$61A7
   6013 00D3A1 10 80                        	dw	$8010
                                           
                                           ; 0.5
   6016 00D3A3                             CONST_POINT5:
   6017 00D3A3 00 00                        	dw	$0000
   6018 00D3A5 00 00                        	dw	$0000
   6019 00D3A7 00 00                        	dw	$0000
   6020 00D3A9 00 00                        	dw	$0000
   6021 00D3AB 00 40                        	dw	$4000
   6022 00D3AD FF 7F                        	dw	$7FFF
                                           
                                           ; This table is used in converting numbers to ASCII.
                                           
   6026 00D3AF                             LAB_2A9A
   6323 = 0000D3B0                         LAB_2A9B = LAB_2A9A+1
   6324 = 0000D3B1                         LAB_2A9C = LAB_2A9B+1
                                           ;	.word	$FFFF,$F21F,$494C,$589C,$0000
                                           ;	.word	$0000,$0163,$4578,$5D8A,$0000
                                           ;	.word	$FFFF,$FFDC,$790D,$903F,$0000
                                           ;	.word	$0000,$0003,$8D7E,$A4C6,$8000
                                           ;	.word	$FFFF,$FFFF,$A50C,$EF85,$C000
                                           ;	.word	$0000,$0000,$0918,$4E72,$A000
                                           ;	.word	$FFFF,$FFFF,$FF17,$2B5A,$F000
                                           ;	.word	$0000,$0000,$0017,$4876,$E800
                                           ;	.word	$FFFF,$FFFF,$FFFD,$ABF4,$1C00
                                           ;	.word	$0000,$0000,$0000,$3B9A,$CA00
                                           ;	.word	$FFFF,$FFFF,$FFFF,$FF67,$6980
                                           ;	.word	$0000,$0000,$0000,$05F5,$E100		; 100000000
                                           ;	.word	$0000,$0000,$0098,$9680		; 10000000
                                           ;	.word   $4240,$000F,$0000,$0000,$0000,$804E		; 1000000
   6043 00D3AF A0 86 01 00 00 00 00 00      	.word	$86A0,$0001,$0000,$0000,$0000,$804E		; 100000
   6043 00D3B7 00 00 4E 80                
   6044 00D3BB 10 27 00 00 00 00 00 00      	.word	$2710,$0000,$0000,$0000,$0000,$804E		; 10000
   6044 00D3C3 00 00 4E 80                
   6045 00D3C7 E8 03 00 00 00 00 00 00      	.word	$03E8,$0000,$0000,$0000,$0000,$804E		; 1000
   6045 00D3CF 00 00 4E 80                
   6046 00D3D3 64 00 00 00 00 00 00 00      	.word	$0064,$0000,$0000,$0000,$0000,$804E		; 100
   6046 00D3DB 00 00 4E 80                
   6047 00D3DF                             FIXED10:
   6048 00D3DF 0A 00 00 00 00 00 00 00      	.word	$000A,$0000,$0000,$0000,$0000,$804E		; 10
   6048 00D3E7 00 00 4E 80                
   6049 00D3EB 01 00 00 00 00 00 00 00      	.word	$0001,$0000,$0000,$0000,$0000,$804E		; 1
   6049 00D3F3 00 00 4E 80                
                                           
                                           		 MEM	16
                                           		 NDX	16
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
FTBios816.asm


                                           .include "FAC1ToString.asm"
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
invaders.asm

                                           	CPU		FT832
                                           
   6358 = 0000000000FEA100                               PRNG		EQU		$FEA100
   6359 = 0000000000FEA108                               PRNG_NUM	EQU		$FEA108
   6360 = 0000000000FEA10E                               PRNG_ADV	EQU		$FEA10E
   6361 = 0000000000000001                               MAN_EXPLODING	EQU		1
                                           
                                           ; which invaders are still active (not destroyed)
                                           ; These var addresses are segment offsets into seg $7800
   6365 = 0000000000000000                               active				EQU		$00
   6366 = 000000000000005E                               left_right			EQU		$5E
   6367 = 0000000000000060                               rightmost_column	EQU		$60
   6368 = 0000000000000062                               leftmost_column		EQU		$62
   6369 = 0000000000000064                               bottom_row			EQU		$64
   6370 = 0000000000000066                               top_row				EQU		$66
   6371 = 000000000000006A                               inv_tick			EQU		$6A
   6372 = 000000000000006C                               inv_tick2			EQU		$6C
   6373 = 000000000000006E                               manX				EQU		$6E
   6374 = 0000000000000070                               manY				EQU		$70
   6375 = 0000000000000072                               manState			EQU		$72
   6376 = 0000000000000100                               InvadersX			EQU		$100
   6377 = 0000000000000200                               InvadersY			EQU		$200
   6378 = 0000000000000300                               min_right			EQU		$300
   6379 = 0000000000000310                               max_left			EQU		$310
   6380 = 0000000000000320                               bombX				EQU		$320
   6381 = 0000000000000330                               bombY				EQU		$330
   6382 = 0000000000000400                               inv_state			EQU		$400
                                           
                                           ; This var is shared, must be referenced ZS:
   6385 = 0000000000007868                               do_invaders			EQU		$7868
                                           
                                           	; minimum right +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6087 00D3F7                             st_min_right:
   6088 00D3F7 01 00                        	.word	1
   6089 00D3F9 05 00                        	.word	5
   6090 00D3FB 09 00                        	.word	9
   6091 00D3FD 0D 00                        	.word	13
   6092 00D3FF 11 00                        	.word	17
   6093 00D401 15 00                        	.word	21
   6094 00D403 19 00                        	.word	25
   6095 00D405 1D 00                        	.word	29
                                           
                                           	; maximum left +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6099 00D407 34 00                        	.word	52
   6100 00D409 38 00                        	.word	56
   6101 00D40B 3C 00                        	.word	60
   6102 00D40D 40 00                        	.word	64
   6103 00D40F 44 00                        	.word	68
   6104 00D411 48 00                        	.word	72
   6105 00D413 4C 00                        	.word	76
   6106 00D415 50 00                        	.word	80
                                           
   6108 00D417 00 00                        	.word	0		; rightmost column
   6109 00D419 07 00                        	.word	7		; lefmost column
   6110 00D41B 01 00                        	.word	1		; dx
                                           
                                           	MEM		16
                                           	NDX		16
                                           
                                           	code
                                           
   6117 00D41D                             InvBomb:
   6118 00D41D A2 00 00                     	LDX		#0
   6119 00D420                             .0001:
   6120 00D420 B5 00                        	LDA		active,X
   6121 00D422 F0 27                        	BEQ		.0002
   6122 00D424 20 FC D4                     	JSR		CanDropBomb
   6123 00D427 F0 22                        	BEQ		.0002
   6124 00D429 42 5B AF 08 A1 FE            	LDA		ZS:PRNG_NUM
   6125 00D42F 42 5B 8F 0E A1 FE            	STA		ZS:PRNG_ADV
   6126 00D435 29 63 00                     	AND		#$63
   6127 00D438 D0 11                        	BNE		.0002
   6128 00D43A 20 53 D4                     	JSR		FindEmptyBomb
   6129 00D43D 30 13                        	BMI		.0003
   6130 00D43F BD 00 01                     	LDA		InvadersX,X
   6131 00D442 99 20 03                     	STA		bombX,Y
   6132 00D445 BD 00 02                     	LDA		InvadersY,X
   6133 00D448 99 30 03                     	STA		bombY,Y
   6134 00D44B                             .0002:
   6135 00D44B E8                           	INX
   6136 00D44C E8                           	INX
   6137 00D44D E0 50 00                     	CPX		#80
   6138 00D450 30 CE                        	BMI		.0001
   6139 00D452                             .0003:
   6140 00D452 60                           	RTS
                                           
   6142 00D453                             FindEmptyBomb:
   6143 00D453 A0 00 00                     	LDY		#0
   6144 00D456                             .0001:
   6145 00D456 B9 20 03                     	LDA		bombX,Y
   6146 00D459 F0 0A                        	BEQ		.0002
   6147 00D45B C8                           	INY
   6148 00D45C C8                           	INY
   6149 00D45D C0 10 00                     	CPY		#16
   6150 00D460 30 F4                        	BMI		.0001
   6151 00D462 A0 FF FF                     	LDY		#-1
   6152 00D465                             .0002:
   6153 00D465 60                           	RTS
                                           
   6155 00D466                             MoveBombs:
   6156 00D466 A2 00 00                     	LDX		#0
   6157 00D469                             .0002:
   6158 00D469 BD 20 03                     	LDA		bombX,X
   6159 00D46C F0 14                        	BEQ		.0001
   6160 00D46E BD 30 03                     	LDA		bombY,X
   6161 00D471 C9 1E 00                     	CMP		#30			; has the bomb fallen all the way to the ground ?
   6162 00D474 10 06                        	BPL		.0003		; if yes, reset bomb
   6163 00D476 1A                           	INA
   6164 00D477 9D 30 03                     	STA		bombY,X
   6165 00D47A 80 06                        	BRA		.0001
   6166 00D47C                             .0003:
   6167 00D47C 9E 20 03                     	STZ		bombX,X
   6168 00D47F 9E 30 03                     	STZ		bombY,X
   6169 00D482                             .0001:
   6170 00D482 E8                           	INX
   6171 00D483 E8                           	INX
   6172 00D484 E0 10 00                     	CPX		#16
   6173 00D487 30 E0                        	BMI		.0002
   6174 00D489 60                           	RTS
                                           
   6176 00D48A                             GetBombOffset:
   6177 00D48A B9 30 03                     	LDA		bombY,Y
   6178 00D48D 0A                           	ASL
   6179 00D48E AA                           	TAX
   6180 00D48F 42 5B BD 04 F8               	LDA		ZS:LineTbl,X
   6181 00D494 18                           	CLC
   6182 00D495 79 20 03                     	ADC		bombX,Y
   6183 00D498 79 20 03                     	ADC		bombX,Y
   6184 00D49B AA                           	TAX
   6185 00D49C 60                           	RTS
                                           
   6187 00D49D                             RenderBombs:
   6188 00D49D A0 00 00                     	LDY		#0
   6189 00D4A0                             .0001:
   6190 00D4A0 B9 30 03                     	LDA		bombY,Y
   6191 00D4A3 F0 0C                        	BEQ		.0002
   6192 00D4A5 20 8A D4                     	JSR		GetBombOffset
   6193 00D4A8 A9 24 00                     	LDA		#'$'
   6194 00D4AB 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6195 00D4B1                             .0002:
   6196 00D4B1 C8                           	INY
   6197 00D4B2 C8                           	INY
   6198 00D4B3 C0 10 00                     	CPY		#16
   6199 00D4B6 30 E8                        	BMI		.0001
   6200 00D4B8 60                           	RTS
                                           
   6202 00D4B9                             TestBombsIntercept:
   6203 00D4B9 A0 00 00                     	LDY		#0
   6204 00D4BC                             .0001:
   6205 00D4BC 20 C7 D4                     	JSR		TestBombIntercept
   6206 00D4BF C8                           	INY
   6207 00D4C0 C8                           	INY
   6208 00D4C1 C0 10 00                     	CPY		#16
   6209 00D4C4 30 F6                        	BMI		.0001
   6210 00D4C6 60                           	RTS
                                           
   6212 00D4C7                             TestBombIntercept:
   6213 00D4C7 20 8A D4                     	JSR		GetBombOffset
   6214 00D4CA 42 5B BF 00 00 0D            	LDA		ZS:VIDBUF,X
   6215 00D4D0 C9 20 00                     	CMP		#' '
   6216 00D4D3 F0 1D                        	BEQ		.0001
   6217 00D4D5 B9 30 03                     	LDA		bombY,Y
   6218 00D4D8 C9 1D 00                     	CMP		#29
   6219 00D4DB D0 16                        	BNE		.0002
   6220 00D4DD B9 20 03                     	LDA		bombX,Y
   6221 00D4E0 D9 6E 00                     	CMP		manX,Y
   6222 00D4E3 D0 05                        	BNE		.0003
   6223 00D4E5 A9 01 00                     	LDA		#MAN_EXPLODING
   6224 00D4E8 85 72                        	STA		manState
   6225 00D4EA                             .0003:
   6226 00D4EA BB                           	TYX
   6227 00D4EB 9E 30 03                     	STZ		bombY,X
   6228 00D4EE 9E 20 03                     	STZ		bombX,X
   6229 00D4F1 60                           	RTS
   6230 00D4F2                             .0001:
   6231 00D4F2 60                           	RTS
   6232 00D4F3                             .0002:
   6233 00D4F3 A9 20 00                     	LDA		#' '
   6234 00D4F6 9F 00 00 0D                  	STA		VIDBUF,X
   6235 00D4FA 80 EE                        	BRA		.0003
                                           
                                           ; An invader can drop a bomb only if there are no invaders underneath it.
                                           
   6239 00D4FC                             CanDropBomb:
   6240 00D4FC E0 0F 00                     	CPX		#15
   6241 00D4FF 10 0C                        	BGE		.0001
   6242 00D501 B5 10                        	LDA		active+16,X
   6243 00D503 15 20                        	ORA		active+32,X
   6244 00D505 15 30                        	ORA		active+48,X
   6245 00D507 15 40                        	ORA		active+64,X
   6246 00D509 49 01 00                     	EOR		#1
   6247 00D50C 60                           	RTS
   6248 00D50D                             .0001:
   6249 00D50D E0 1F 00                     	CPX		#31
   6250 00D510 10 0A                        	BGE		.0002
   6251 00D512 B5 10                        	LDA		active+16,X
   6252 00D514 15 20                        	ORA		active+32,X
   6253 00D516 15 30                        	ORA		active+48,X
   6254 00D518 49 01 00                     	EOR		#1
   6255 00D51B 60                           	RTS
   6256 00D51C                             .0002:
   6257 00D51C E0 2F 00                     	CPX		#47
   6258 00D51F 10 08                        	BGE		.0003
   6259 00D521 B5 10                        	LDA		active+16,X
   6260 00D523 15 20                        	ORA		active+32,X
   6261 00D525 49 01 00                     	EOR		#1
   6262 00D528 60                           	RTS
   6263 00D529                             .0003:
   6264 00D529 E0 3F 00                     	CPX		#63
   6265 00D52C 10 06                        	BGE		.0004
   6266 00D52E B5 10                        	LDA		active+16,X
   6267 00D530 49 01 00                     	EOR		#1
   6268 00D533 60                           	RTS
   6269 00D534                             .0004:
   6270 00D534 A9 01 00                     	LDA		#1
   6271 00D537 60                           	RTS
                                           
                                           
                                           ; Test if it's possible to move to the left anymore.
                                           ;
   6276 00D538                             CanMoveLeft:
   6277 00D538 A5 62                        	LDA		leftmost_column
   6278 00D53A 0A                           	ASL
   6279 00D53B AA                           	TAX
   6280 00D53C BD 10 03                     	LDA		max_left,X
   6281 00D53F DD 00 01                     	CMP		InvadersX,X
   6282 00D542 30 04                        	BMI		.0001
   6283 00D544 A9 00 00                     	LDA		#0
   6284 00D547 60                           	RTS
   6285 00D548                             .0001:
   6286 00D548 A9 01 00                     	LDA		#1
   6287 00D54B 60                           	RTS
                                           
                                           ; Test if it's possible to move to the right anymore.
                                           ;
   6291 00D54C                             CanMoveRight:
   6292 00D54C A5 60                        	LDA		rightmost_column
   6293 00D54E 0A                           	ASL
   6294 00D54F AA                           	TAX
   6295 00D550 BD 00 03                     	LDA		min_right,X
   6296 00D553 DD 00 01                     	CMP		InvadersX,X
   6297 00D556 10 04                        	BPL		.0001
   6298 00D558 A9 00 00                     	LDA		#0
   6299 00D55B 60                           	RTS
   6300 00D55C                             .0001:
   6301 00D55C A9 01 00                     	LDA		#1
   6302 00D55F 60                           	RTS
                                           
                                           ; Test if it's possible to move down anymore
                                           ;
   6306 00D560                             CanMoveDown:
   6307 00D560 A5 64                        	LDA		bottom_row
   6308 00D562 0A                           	ASL
   6309 00D563 0A                           	ASL
   6310 00D564 0A                           	ASL
   6311 00D565 0A                           	ASL
   6312 00D566 AA                           	TAX
   6313 00D567 BD 00 02                     	LDA		InvadersY,X
   6314 00D56A C9 1E 00                     	CMP		#30
   6315 00D56D 30 04                        	BMI		.0001
   6316 00D56F A9 00 00                     	LDA		#0
   6317 00D572 60                           	RTS
   6318 00D573                             .0001:
   6319 00D573 A9 01 00                     	LDA		#1
   6320 00D576 60                           	RTS
                                           
                                           ; Move all the invaders to the left
                                           ; Means incrementing the X co-ordinate
                                           ;
   6325 00D577                             MoveLeft:
   6326 00D577 A2 00 00                     	LDX		#00
   6327 00D57A                             .0002:
   6328 00D57A FE 00 01                     	INC		InvadersX,X
   6329 00D57D E8                           	INX
   6330 00D57E E8                           	INX
   6331 00D57F E0 50 00                     	CPX		#80
   6332 00D582 D0 F6                        	BNE		.0002
   6333 00D584 60                           	RTS
                                           
                                           ; Move all the invaders to the right.
                                           ; means decrementing the X co-ordinate
                                           ;
   6338 00D585                             MoveRight:
   6339 00D585 A2 00 00                     	LDX		#0
   6340 00D588                             .0002:
   6341 00D588 DE 00 01                     	DEC		InvadersX,X
   6342 00D58B E8                           	INX
   6343 00D58C E8                           	INX
   6344 00D58D E0 50 00                     	CPX		#80
   6345 00D590 D0 F6                        	BNE		.0002
   6346 00D592 60                           	RTS
                                           
                                           ; Move all the invaders down a row.
                                           ; Means incrementing the Y co-ordinate
                                           ;
   6351 00D593                             MoveDown:
   6352 00D593 A2 00 00                     	LDX		#00
   6353 00D596                             .0002:
   6354 00D596 FE 00 02                     	INC		InvadersY,X
   6355 00D599 E8                           	INX
   6356 00D59A E8                           	INX
   6357 00D59B E0 50 00                     	CPX		#80
   6358 00D59E D0 F6                        	BNE		.0002
   6359 00D5A0 60                           	RTS
                                           
                                           ; Move the invaders
                                           ; Retuns
                                           ; .A = 1 if it was possible to do a move, 0 otherwise
                                           ;
   6365 00D5A1                             Move:
   6366 00D5A1 24 5E                        	BIT		left_right
   6367 00D5A3 30 0A                        	BMI		.0002
   6368 00D5A5 20 38 D5                     	JSR		CanMoveLeft
   6369 00D5A8 F0 0F                        	BEQ		.0001
   6370 00D5AA 20 77 D5                     	JSR		MoveLeft
   6371 00D5AD 80 19                        	BRA		.0003
   6372 00D5AF                             .0002:
   6373 00D5AF 20 4C D5                     	JSR		CanMoveRight
   6374 00D5B2 F0 05                        	BEQ		.0001
   6375 00D5B4 20 85 D5                     	JSR		MoveRight
   6376 00D5B7 80 0F                        	BRA		.0003
   6377 00D5B9                             .0001:
   6378 00D5B9 20 60 D5                     	JSR		CanMoveDown
   6379 00D5BC F0 0E                        	BEQ		.0004
   6380 00D5BE A5 5E                        	LDA		left_right
   6381 00D5C0 49 FF FF                     	EOR		#$FFFF
   6382 00D5C3 85 5E                        	STA		left_right
   6383 00D5C5 20 93 D5                     	JSR		MoveDown
   6384 00D5C8                             .0003:
   6385 00D5C8 A9 01 00                     	LDA		#1
   6386 00D5CB 60                           	RTS
   6387 00D5CC                             .0004:
   6388 00D5CC A9 00 00                     	LDA		#0
   6389 00D5CF 60                           	RTS
                                           
   6391 00D5D0                             Initialize:
   6392 00D5D0 64 60                        	STZ		rightmost_column
   6393 00D5D2 A9 07 00                     	LDA		#7
   6394 00D5D5 85 62                        	STA		leftmost_column
   6395 00D5D7 64 66                        	STZ		top_row
   6396 00D5D9 A9 04 00                     	LDA		#4
   6397 00D5DC 85 64                        	STA		bottom_row
   6398 00D5DE 64 5E                        	STZ		left_right
   6399 00D5E0 20 28 D6                     	JSR		ActivateAllInvaders
   6400 00D5E3 A2 00 00                     	LDX		#0
   6401 00D5E6                             .0001:
   6402 00D5E6 42 1B BD 3B DA               	LDA		CS:StartX,X
   6403 00D5EB 9D 00 01                     	STA		InvadersX,X
   6404 00D5EE 42 1B BD EB D9               	LDA		CS:StartY,X
   6405 00D5F3 9D 00 02                     	STA		InvadersY,X
   6406 00D5F6 E8                           	INX
   6407 00D5F7 E8                           	INX
   6408 00D5F8 E0 50 00                     	CPX		#80
   6409 00D5FB 30 E9                        	BMI		.0001
   6410 00D5FD A2 00 00                     	LDX		#0
   6411 00D600                             .0002:
   6412 00D600 42 1B BD F7 D3               	LDA		CS:st_min_right,X
   6413 00D605 9D 00 03                     	STA		min_right,X
   6414 00D608 E8                           	INX
   6415 00D609 E8                           	INX
   6416 00D60A E0 20 00                     	CPX		#32
   6417 00D60D 30 F1                        	BMI		.0002
                                           	; Initialize Bombs
   6419 00D60F A2 00 00                     	LDX		#0
   6420 00D612                             .0003:
   6421 00D612 9E 20 03                     	STZ		bombX,X
   6422 00D615 9E 30 03                     	STZ		bombY,X
   6423 00D618 E8                           	INX
   6424 00D619 E8                           	INX
   6425 00D61A E0 10 00                     	CPX		#16
   6426 00D61D 30 F3                        	BMI		.0003
   6427 00D61F A9 FE FF                     	LDA		#$FFFE
   6428 00D622 42 5B 8D 68 78               	STA		ZS:do_invaders
   6429 00D627 60                           	RTS
                                           
   6431 00D628                             ActivateAllInvaders:
   6432 00D628 A2 00 00                     	LDX		#0
   6433 00D62B A9 01 00                     	LDA		#1
   6434 00D62E                             .0001:
   6435 00D62E 95 00                        	STA		active,X
   6436 00D630 E8                           	INX
   6437 00D631 E8                           	INX
   6438 00D632 E0 50 00                     	CPX		#80
   6439 00D635 D0 F7                        	BNE		.0001
   6440 00D637 60                           	RTS
                                           
   6442 00D638                             IsAllDestroyed:
   6443 00D638 20 C0 D6                     	JSR		IsRightmostColumnDestroyed
   6444 00D63B F0 2C                        	BEQ		.0001
   6445 00D63D E6 60                        	INC		rightmost_column
   6446 00D63F AD 0C 03                     	LDA		min_right+12
   6447 00D642 8D 0E 03                     	STA		min_right+14
   6448 00D645 AD 0A 03                     	LDA		min_right+10
   6449 00D648 8D 0C 03                     	STA		min_right+12
   6450 00D64B AD 08 03                     	LDA		min_right+8
   6451 00D64E 8D 0A 03                     	STA		min_right+10
   6452 00D651 AD 06 03                     	LDA		min_right+6
   6453 00D654 8D 08 03                     	STA		min_right+8
   6454 00D657 AD 04 03                     	LDA		min_right+4
   6455 00D65A 8D 06 03                     	STA		min_right+6
   6456 00D65D AD 02 03                     	LDA		min_right+2
   6457 00D660 8D 04 03                     	STA		min_right+4
   6458 00D663 AD 00 03                     	LDA		min_right
   6459 00D666 8D 02 03                     	STA		min_right+2
   6460 00D669                             .0001:
   6461 00D669 20 BC D6                     	JSR		IsLeftmostColumnDestroyed
   6462 00D66C F0 2C                        	BEQ		.0002
   6463 00D66E C6 62                        	DEC		leftmost_column
   6464 00D670 AD 12 03                     	LDA		max_left+2
   6465 00D673 8D 10 03                     	STA		max_left
   6466 00D676 AD 14 03                     	LDA		max_left+4
   6467 00D679 8D 12 03                     	STA		max_left+2
   6468 00D67C AD 16 03                     	LDA		max_left+6
   6469 00D67F 8D 14 03                     	STA		max_left+4
   6470 00D682 AD 18 03                     	LDA		max_left+8
   6471 00D685 8D 16 03                     	STA		max_left+6
   6472 00D688 AD 1A 03                     	LDA		max_left+10
   6473 00D68B 8D 18 03                     	STA		max_left+8
   6474 00D68E AD 1C 03                     	LDA		max_left+12
   6475 00D691 8D 1A 03                     	STA		max_left+10
   6476 00D694 AD 1E 03                     	LDA		max_left+14
   6477 00D697 8D 1C 03                     	STA		max_left+12
   6478 00D69A                             .0002:
   6479 00D69A A5 62                        	LDA		leftmost_column
   6480 00D69C C5 60                        	CMP		rightmost_column
   6481 00D69E 30 18                        	BMI		.allDestroyed
   6482 00D6A0 20 DC D6                     	JSR		IsBottomRowDestroyed
   6483 00D6A3 F0 02                        	BEQ		.0003
   6484 00D6A5 C6 64                        	DEC		bottom_row
   6485 00D6A7                             .0003:
   6486 00D6A7 20 D8 D6                     	JSR		IsTopRowDestroyed
   6487 00D6AA F0 02                        	BEQ		.0004
   6488 00D6AC E6 66                        	INC		top_row
   6489 00D6AE                             .0004:
   6490 00D6AE A5 64                        	LDA		bottom_row
   6491 00D6B0 C5 66                        	CMP		top_row
   6492 00D6B2 30 04                        	BMI		.allDestroyed
   6493 00D6B4 A9 00 00                     	LDA		#0
   6494 00D6B7 60                           	RTS
   6495 00D6B8                             .allDestroyed:
   6496 00D6B8 A9 01 00                     	LDA		#1
   6497 00D6BB 60                           	RTS
                                           
                                           
   6500 00D6BC                             IsLeftmostColumnDestroyed:
   6501 00D6BC A5 62                        	LDA		leftmost_column
   6502 00D6BE 80 02                        	BRA		IsColumnDestroyed
   6503 00D6C0                             IsRightmostColumnDestroyed:
   6504 00D6C0 A5 60                        	LDA		rightmost_column
   6505 00D6C2                             IsColumnDestroyed:
   6506 00D6C2 0A                           	ASL
   6507 00D6C3 AA                           	TAX
   6508 00D6C4 B5 00                        	LDA		active,X
   6509 00D6C6 15 10                        	ORA		active+16,X
   6510 00D6C8 15 20                        	ORA		active+32,X
   6511 00D6CA 15 30                        	ORA		active+48,X
   6512 00D6CC 15 40                        	ORA		active+64,X
   6513 00D6CE 15 50                        	ORA		active+80,X
   6514 00D6D0 15 60                        	ORA		active+96,X
   6515 00D6D2 15 70                        	ORA		active+112,X
   6516 00D6D4 49 01 00                     	EOR		#1
   6517 00D6D7 60                           	RTS
                                           
   6519 00D6D8                             IsTopRowDestroyed:
   6520 00D6D8 A5 66                        	LDA		top_row
   6521 00D6DA 80 02                        	BRA		IsRowDestroyed
   6522 00D6DC                             IsBottomRowDestroyed:
   6523 00D6DC A5 64                        	LDA		bottom_row
   6524 00D6DE                             IsRowDestroyed:
   6525 00D6DE 0A                           	ASL
   6526 00D6DF 0A                           	ASL
   6527 00D6E0 0A                           	ASL
   6528 00D6E1 0A                           	ASL
   6529 00D6E2 B5 00                        	LDA		active,X
   6530 00D6E4 15 02                        	ORA		active+2,X
   6531 00D6E6 15 04                        	ORA		active+4,X
   6532 00D6E8 15 06                        	ORA		active+6,X
   6533 00D6EA 15 08                        	ORA		active+8,X
   6534 00D6EC 15 0A                        	ORA		active+10,X
   6535 00D6EE 15 0C                        	ORA		active+12,X
   6536 00D6F0 15 0E                        	ORA		active+14,X
   6537 00D6F2 49 01 00                     	EOR		#1
   6538 00D6F5 60                           	RTS
                                           
                                           ; TickCount counts 1/100 of a second. We want to animate the graphics at a much
                                           ; slower rate, so we use bit 6 of the tick count to indicate when to animate.
                                           ;
   6543 00D6F6                             ShiftTick:
   6544 00D6F6 42 5B A5 04                  	LDA		ZS:TickCount
   6545 00D6FA 4A                           	LSR
   6546 00D6FB 4A                           	LSR
   6547 00D6FC 4A                           	LSR
   6548 00D6FD 4A                           	LSR
   6549 00D6FE 4A                           	LSR
   6550 00D6FF 4A                           	LSR
   6551 00D700 60                           	RTS
                                           
   6553 00D701                             RenderInvaders:
                                           	; First, clear the screen
   6555 00D701 A2 00 00                     	LDX		#0
   6556 00D704 A9 20 00                     	LDA		#' '
   6557 00D707 09 00 BF                     	ORA		#$BF00
   6558 00D70A                             .0003:
   6559 00D70A 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6560 00D710 E8                           	INX
   6561 00D711 E8                           	INX
   6562 00D712 E0 58 14                     	CPX		#84*31*2
   6563 00D715 30 F3                        	BMI		.0003
   6564 00D717 A2 00 00                     	LDX		#0
   6565 00D71A                             .0002:
   6566 00D71A C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   6569 00D71C B5 00                        	LDA		active,X
   6570 00D71E F0 FF BD 01                  	LBEQ	.0001
   6571 00D722 BD 00 04                     	LDA		inv_state,X
   6572 00D725 BD 00 02                     	LDA		InvadersY,X
   6573 00D728 0A                           	ASL
   6574 00D729 A8                           	TAY
   6575 00D72A 42 5B B9 04 F8               	LDA		ZS:LineTbl,Y
   6576 00D72F 18                           	CLC
   6577 00D730 7D 00 01                     	ADC		InvadersX,X
   6578 00D733 18                           	CLC
   6579 00D734 7D 00 01                     	ADC		InvadersX,X
   6580 00D737 A8                           	TAY
   6581 00D738 E2 20                        	SEP		#$20			; eight bit acc
                                           	MEM		8
   6583 00D73A 42 1B BD 8B DA               	LDA		CS:InvaderType,X
   6584 00D73F C9 01                        	CMP		#1
   6585 00D741 D0 46                        	BNE		.0004
   6586 00D743 A9 E9                        	LDA		#233
   6587 00D745 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6588 00D74D A9 F2                        	LDA		#242
   6589 00D74F 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6590 00D757 A9 DF                        	LDA		#223
   6591 00D759 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6592 00D761 20 F6 D6                     	JSR		ShiftTick
   6593 00D764 90 04                        	BCC		.0005
   6594 00D766 A9 58                        	LDA		#'X'
   6595 00D768 80 02                        	BRA		.0006
   6596 00D76A                             .0005:
   6597 00D76A A9 56                        	LDA		#'V'
   6598 00D76C                             .0006:
   6599 00D76C 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6600 00D774 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6601 00D77C A9 20                        	LDA		#' '
   6602 00D77E 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6603 00D786 82 E4 00                     	BRL		.0007
   6604 00D789                             .0004:
   6605 00D789 C9 02                        	CMP		#2
   6606 00D78B D0 FF 83 00                  	LBNE	.0008
   6607 00D78F 20 F6 D6                     	JSR		ShiftTick
   6608 00D792 90 3F                        	BCC		.0009
   6609 00D794 A9 FC                        	LDA		#252
   6610 00D796 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6611 00D79E A9 99                        	LDA		#153
   6612 00D7A0 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6613 00D7A8 A9 FE                        	LDA		#254
   6614 00D7AA 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6615 00D7B2 A9 E2                        	LDA		#226
   6616 00D7B4 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6617 00D7BC A9 62                        	LDA		#98
   6618 00D7BE 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6619 00D7C6 A9 E2                        	LDA		#226
   6620 00D7C8 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6621 00D7D0 82 9A 00                     	BRL		.0007
   6622 00D7D3                             .0009:
   6623 00D7D3 A9 62                        	LDA		#98
   6624 00D7D5 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6625 00D7DD A9 99                        	LDA		#153
   6626 00D7DF 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6627 00D7E7 A9 62                        	LDA		#98
   6628 00D7E9 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6629 00D7F1 A9 EC                        	LDA		#236
   6630 00D7F3 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6631 00D7FB A9 62                        	LDA		#98
   6632 00D7FD 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6633 00D805 A9 FB                        	LDA		#251
   6634 00D807 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6635 00D80F 82 5B 00                     	BRL		.0007
   6636 00D812                             .0008:
   6637 00D812 A9 FF                        	LDA		#255
   6638 00D814 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6639 00D81C A9 F8                        	LDA		#248
   6640 00D81E 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6641 00D826 A9 7F                        	LDA		#127
   6642 00D828 42 5B 99 21 D8               	STA		ZS:VIDBUf+4,Y
   6643 00D82D 20 F6 D6                     	JSR		ShiftTick
   6644 00D830 90 20                        	BCC		.0010
   6645 00D832 A9 FF                        	LDA		#255
   6646 00D834 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6647 00D83C A9 F9                        	LDA		#249
   6648 00D83E 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6649 00D846 A9 7F                        	LDA		#127
   6650 00D848 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6651 00D850 80 1B                        	BRA		.0007
   6652 00D852                             .0010:
   6653 00D852 A9 E1                        	LDA		#225
   6654 00D854 42 5B 99 71 D8               	STA		ZS:VIDBUf+84,Y
   6655 00D859 A9 F9                        	LDA		#249
   6656 00D85B 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6657 00D863 A9 60                        	LDA		#96
   6658 00D865 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6659 00D86D                             .0007:
                                           	; Surround the alien with spaces
   6661 00D86D A9 20                        	LDA		#' '
   6662 00D86F 42 5B 42 99 AA FF 0C 00      	STA		ZS:VIDBUF-86,Y
                                         
   6663 00D877 42 5B 42 99 AC FF 0C 00      	STA		ZS:VIDBUF-84,Y
                                         
   6664 00D87F 42 5B 42 99 AE FF 0C 00      	STA		ZS:VIDBUF-82,Y
                                         
   6665 00D887 42 5B 42 99 B0 FF 0C 00      	STA		ZS:VIDBUF-80,Y
                                         
   6666 00D88F 42 5B 42 99 B2 FF 0C 00      	STA		ZS:VIDBUF-78,Y
                                         
   6667 00D897 42 5B 42 99 FE FF 0C 00      	STA		ZS:VIDBUF-2,Y
                                         
   6668 00D89F 42 5B 42 99 06 00 0D 00      	STA		ZS:VIDBUF+6,Y
                                         
   6669 00D8A7 42 5B 42 99 52 00 0D 00      	STA		ZS:VIDBUF+82,Y
                                         
   6670 00D8AF 42 5B 42 99 5A 00 0D 00      	STA		ZS:VIDBUF+90,Y
                                         
   6671 00D8B7 42 5B 42 99 A6 00 0D 00      	STA		ZS:VIDBUF+166,Y
                                         
   6672 00D8BF 42 5B 42 99 A8 00 0D 00      	STA		ZS:VIDBUF+168,Y
                                         
   6673 00D8C7 42 5B 42 99 AA 00 0D 00      	STA		ZS:VIDBUF+170,Y
                                         
   6674 00D8CF 42 5B 42 99 AC 00 0D 00      	STA		ZS:VIDBUF+172,Y
                                         
   6675 00D8D7 42 5B 42 99 AE 00 0D 00      	STA		ZS:VIDBUF+174,Y
                                         
   6676 00D8DF                             .0001:
   6677 00D8DF E8                           	INX
   6678 00D8E0 E8                           	INX
   6679 00D8E1 E0 50 00                     	CPX		#80
   6680 00D8E4 D0 FF 32 FE                  	LBNE	.0002
   6681 00D8E8 C2 20                        	REP		#$20
                                           	MEM		16
   6683 00D8EA 60                           	RTS
                                           
                                           public InvadersTask:
   6686 00D8EB                             .0001:
   6687 00D8EB F4 00 00                     	PEA		0				; set data segment to $7800
   6688 00D8EE F4 00 78                     	PEA		$7800
   6689 00D8F1 42 2B                        	PLDS
   6690 00D8F3 A9 FF 2B                     	LDA		#$2BFF			; set stack to $2BFF
   6691 00D8F6 1B                           	TAS
   6692 00D8F7 20 D0 D5                     	JSR		Initialize
   6693 00D8FA 42 E2 00 10                  	SEP		#$1000			; turn on single step mode
   6694 00D8FE 20 01 D7                     	JSR		RenderInvaders
   6695 00D901                             .0002:
   6696 00D901 42 20 2A EF 07               	JCR 	KeybdGetCharNoWaitCtx,7	; check for char at keyboard
   6697 00D906                             .0004:
   6698 00D906 A2 00 00                     	LDX		#0
   6699 00D909                             .0006:
   6700 00D909 E8                           	INX
   6701 00D90A E0 D0 07                     	CPX		#2000
   6702 00D90D D0 FA                        	BNE		.0006
   6703 00D90F 42 5B A5 04                  	LDA		ZS:TickCount
   6704 00D913 29 03 00                     	AND		#$3
   6705 00D916 D0 E9                        	BNE		.0002
   6706 00D918 20 1D D4                     	JSR		InvBomb
   6707 00D91B 20 01 D7                     	JSR		RenderInvaders
   6708 00D91E 20 9D D4                     	JSR		RenderBombs
   6709 00D921 20 66 D4                     	JSR		MoveBombs
   6710 00D924 42 5B A5 04                  	LDA		ZS:TickCount
   6711 00D928 29 0F 00                     	AND		#$F
   6712 00D92B D0 D4                        	BNE		.0002
   6713 00D92D 20 38 D6                     	JSR		IsAllDestroyed
   6714 00D930 D0 B9                        	BNE		.0001
   6715 00D932 20 A1 D5                     	JSR		Move
   6716 00D935 F0 B4                        	BEQ		.0001				; Can't move, re-initialize
   6717 00D937 80 C8                        	BRA		.0002
   6718 00D939                             .0005:
   6719 00D939 85 6A                        	STA		inv_tick
   6720 00D93B 80 C4                        	BRA		.0002
   6721 00D93D                             .0003:
   6722 00D93D C9 03 00                     	CMP		#3
   6723 00D940 D0 C4                        	BNE		.0004
   6724 00D942 42 5B 9C 68 78               	STZ		ZS:do_invaders
   6725 00D947 42 60                        	RTT
   6726 00D949 80 A0                        	BRA		.0001
                                           
   6728 00D94B                             InvaderRow:
   6729 00D94B 00 00                        	.word	0
   6730 00D94D 00 00                        	.word	0
   6731 00D94F 00 00                        	.word	0
   6732 00D951 00 00                        	.word	0
   6733 00D953 00 00                        	.word	0
   6734 00D955 00 00                        	.word	0
   6735 00D957 00 00                        	.word	0
   6736 00D959 00 00                        	.word	0
                                           
   6738 00D95B 01 00                        	.word	1
   6739 00D95D 01 00                        	.word	1
   6740 00D95F 01 00                        	.word	1
   6741 00D961 01 00                        	.word	1
   6742 00D963 01 00                        	.word	1
   6743 00D965 01 00                        	.word	1
   6744 00D967 01 00                        	.word	1
   6745 00D969 01 00                        	.word	1
                                           
   6747 00D96B 02 00                        	.word	2
   6748 00D96D 02 00                        	.word	2
   6749 00D96F 02 00                        	.word	2
   6750 00D971 02 00                        	.word	2
   6751 00D973 02 00                        	.word	2
   6752 00D975 02 00                        	.word	2
   6753 00D977 02 00                        	.word	2
   6754 00D979 02 00                        	.word	2
                                           
   6756 00D97B 03 00                        	.word	3
   6757 00D97D 03 00                        	.word	3
   6758 00D97F 03 00                        	.word	3
   6759 00D981 03 00                        	.word	3
   6760 00D983 03 00                        	.word	3
   6761 00D985 03 00                        	.word	3
   6762 00D987 03 00                        	.word	3
   6763 00D989 03 00                        	.word	3
                                           
   6765 00D98B 04 00                        	.word	4
   6766 00D98D 04 00                        	.word	4
   6767 00D98F 04 00                        	.word	4
   6768 00D991 04 00                        	.word	4
   6769 00D993 04 00                        	.word	4
   6770 00D995 04 00                        	.word	4
   6771 00D997 04 00                        	.word	4
   6772 00D999 04 00                        	.word	4
                                           
   6774 00D99B                             InvaderCol:
   6775 00D99B 00 00                        	.word	0
   6776 00D99D 01 00                        	.word	1
   6777 00D99F 02 00                        	.word	2
   6778 00D9A1 03 00                        	.word	3
   6779 00D9A3 04 00                        	.word	4
   6780 00D9A5 05 00                        	.word	5
   6781 00D9A7 06 00                        	.word	6
   6782 00D9A9 07 00                        	.word	7
                                           
   6784 00D9AB 00 00                        	.word	0
   6785 00D9AD 01 00                        	.word	1
   6786 00D9AF 02 00                        	.word	2
   6787 00D9B1 03 00                        	.word	3
   6788 00D9B3 04 00                        	.word	4
   6789 00D9B5 05 00                        	.word	5
   6790 00D9B7 06 00                        	.word	6
   6791 00D9B9 07 00                        	.word	7
                                           
   6793 00D9BB 00 00                        	.word	0
   6794 00D9BD 01 00                        	.word	1
   6795 00D9BF 02 00                        	.word	2
   6796 00D9C1 03 00                        	.word	3
   6797 00D9C3 04 00                        	.word	4
   6798 00D9C5 05 00                        	.word	5
   6799 00D9C7 06 00                        	.word	6
   6800 00D9C9 07 00                        	.word	7
                                           
   6802 00D9CB 00 00                        	.word	0
   6803 00D9CD 01 00                        	.word	1
   6804 00D9CF 02 00                        	.word	2
   6805 00D9D1 03 00                        	.word	3
   6806 00D9D3 04 00                        	.word	4
   6807 00D9D5 05 00                        	.word	5
   6808 00D9D7 06 00                        	.word	6
   6809 00D9D9 07 00                        	.word	7
                                           
   6811 00D9DB 00 00                        	.word	0
   6812 00D9DD 01 00                        	.word	1
   6813 00D9DF 02 00                        	.word	2
   6814 00D9E1 03 00                        	.word	3
   6815 00D9E3 04 00                        	.word	4
   6816 00D9E5 05 00                        	.word	5
   6817 00D9E7 06 00                        	.word	6
   6818 00D9E9 07 00                        	.word	7
                                           
                                           ; Starting Y co-ordinate for each invader
                                           
   6822 00D9EB                             StartY:
   6823 00D9EB 03 00                        	.word	3
   6824 00D9ED 03 00                        	.word	3
   6825 00D9EF 03 00                        	.word	3
   6826 00D9F1 03 00                        	.word	3
   6827 00D9F3 03 00                        	.word	3
   6828 00D9F5 03 00                        	.word	3
   6829 00D9F7 03 00                        	.word	3
   6830 00D9F9 03 00                        	.word	3
                                           
   6832 00D9FB 06 00                        	.word	6
   6833 00D9FD 06 00                        	.word	6
   6834 00D9FF 06 00                        	.word	6
   6835 00DA01 06 00                        	.word	6
   6836 00DA03 06 00                        	.word	6
   6837 00DA05 06 00                        	.word	6
   6838 00DA07 06 00                        	.word	6
   6839 00DA09 06 00                        	.word	6
                                           
   6841 00DA0B 09 00                        	.word	9
   6842 00DA0D 09 00                        	.word	9
   6843 00DA0F 09 00                        	.word	9
   6844 00DA11 09 00                        	.word	9
   6845 00DA13 09 00                        	.word	9
   6846 00DA15 09 00                        	.word	9
   6847 00DA17 09 00                        	.word	9
   6848 00DA19 09 00                        	.word	9
                                           
   6850 00DA1B 0C 00                        	.word	12
   6851 00DA1D 0C 00                        	.word	12
   6852 00DA1F 0C 00                        	.word	12
   6853 00DA21 0C 00                        	.word	12
   6854 00DA23 0C 00                        	.word	12
   6855 00DA25 0C 00                        	.word	12
   6856 00DA27 0C 00                        	.word	12
   6857 00DA29 0C 00                        	.word	12
                                           
   6859 00DA2B 0F 00                        	.word	15
   6860 00DA2D 0F 00                        	.word	15
   6861 00DA2F 0F 00                        	.word	15
   6862 00DA31 0F 00                        	.word	15
   6863 00DA33 0F 00                        	.word	15
   6864 00DA35 0F 00                        	.word	15
   6865 00DA37 0F 00                        	.word	15
   6866 00DA39 0F 00                        	.word	15
                                           
                                           ; Starting X co-ordinate for each invader
                                           
   6870 00DA3B                             StartX:
   6871 00DA3B 01 00                        	.word	1
   6872 00DA3D 05 00                        	.word	5
   6873 00DA3F 09 00                        	.word	9
   6874 00DA41 0D 00                        	.word	13
   6875 00DA43 11 00                        	.word	17
   6876 00DA45 15 00                        	.word	21
   6877 00DA47 19 00                        	.word	25
   6878 00DA49 1D 00                        	.word	29
                                           
   6880 00DA4B 01 00                        	.word	1
   6881 00DA4D 05 00                        	.word	5
   6882 00DA4F 09 00                        	.word	9
   6883 00DA51 0D 00                        	.word	13
   6884 00DA53 11 00                        	.word	17
   6885 00DA55 15 00                        	.word	21
   6886 00DA57 19 00                        	.word	25
   6887 00DA59 1D 00                        	.word	29
                                           
   6889 00DA5B 01 00                        	.word	1
   6890 00DA5D 05 00                        	.word	5
   6891 00DA5F 09 00                        	.word	9
   6892 00DA61 0D 00                        	.word	13
   6893 00DA63 11 00                        	.word	17
   6894 00DA65 15 00                        	.word	21
   6895 00DA67 19 00                        	.word	25
   6896 00DA69 1D 00                        	.word	29
                                           
   6898 00DA6B 01 00                        	.word	1
   6899 00DA6D 05 00                        	.word	5
   6900 00DA6F 09 00                        	.word	9
   6901 00DA71 0D 00                        	.word	13
   6902 00DA73 11 00                        	.word	17
   6903 00DA75 15 00                        	.word	21
   6904 00DA77 19 00                        	.word	25
   6905 00DA79 1D 00                        	.word	29
                                           
   6907 00DA7B 01 00                        	.word	1
   6908 00DA7D 05 00                        	.word	5
   6909 00DA7F 09 00                        	.word	9
   6910 00DA81 0D 00                        	.word	13
   6911 00DA83 11 00                        	.word	17
   6912 00DA85 15 00                        	.word	21
   6913 00DA87 19 00                        	.word	25
   6914 00DA89 1D 00                        	.word	29
                                           
   6916 00DA8B                             InvaderType:
   6917 00DA8B 01 00                        	.word	1
   6918 00DA8D 01 00                        	.word	1
   6919 00DA8F 01 00                        	.word	1
   6920 00DA91 01 00                        	.word	1
   6921 00DA93 01 00                        	.word	1
   6922 00DA95 01 00                        	.word	1
   6923 00DA97 01 00                        	.word	1
   6924 00DA99 01 00                        	.word	1
                                           
   6926 00DA9B 02 00                        	.word	2
   6927 00DA9D 02 00                        	.word	2
   6928 00DA9F 02 00                        	.word	2
   6929 00DAA1 02 00                        	.word	2
   6930 00DAA3 02 00                        	.word	2
   6931 00DAA5 02 00                        	.word	2
   6932 00DAA7 02 00                        	.word	2
   6933 00DAA9 02 00                        	.word	2
                                           
   6935 00DAAB 02 00                        	.word	2
   6936 00DAAD 02 00                        	.word	2
   6937 00DAAF 02 00                        	.word	2
   6938 00DAB1 02 00                        	.word	2
   6939 00DAB3 02 00                        	.word	2
   6940 00DAB5 02 00                        	.word	2
   6941 00DAB7 02 00                        	.word	2
   6942 00DAB9 02 00                        	.word	2
                                           
   6944 00DABB 03 00                        	.word	3
   6945 00DABD 03 00                        	.word	3
   6946 00DABF 03 00                        	.word	3
   6947 00DAC1 03 00                        	.word	3
   6948 00DAC3 03 00                        	.word	3
   6949 00DAC5 03 00                        	.word	3
   6950 00DAC7 03 00                        	.word	3
   6951 00DAC9 03 00                        	.word	3
                                           
   6953 00DACB 03 00                        	.word	3
   6954 00DACD 03 00                        	.word	3
   6955 00DACF 03 00                        	.word	3
   6956 00DAD1 03 00                        	.word	3
   6957 00DAD3 03 00                        	.word	3
   6958 00DAD5 03 00                        	.word	3
   6959 00DAD7 03 00                        	.word	3
   6960 00DAD9 03 00                        	.word	3
                                           			
Finitron FT832 assembler   version 1.4   Thu Jun 01 18:40:59 2017     Page 1
FTBios816.asm


                                           .include "invaders.asm"
                                           
                                           ;	cpu		W65C816S
                                           	cpu		FT832
   6965 00DADB FF FF FF FF FF FF FF FF      	.org	$E000
   6965 00DAE3 FF FF FF FF FF FF FF FF    
   6965 00DAEB FF FF FF FF FF FF FF FF    
   6965 00DAF3 FF FF FF FF FF FF FF FF    
   6965 00DAFB FF FF FF FF FF FF FF FF    
   6965 00DB03 FF FF FF FF FF FF FF FF    
   6965 00DB0B FF FF FF FF FF FF FF FF    
   6965 00DB13 FF FF FF FF FF FF FF FF    
   6965 00DB1B FF FF FF FF FF FF FF FF    
   6965 00DB23 FF FF FF FF FF FF FF FF    
   6965 00DB2B FF FF FF FF FF FF FF FF    
   6965 00DB33 FF FF FF FF FF FF FF FF    
   6965 00DB3B FF FF FF FF FF FF FF FF    
   6965 00DB43 FF FF FF FF FF FF FF FF    
   6965 00DB4B FF FF FF FF FF FF FF FF    
   6965 00DB53 FF FF FF FF FF FF FF FF    
   6965 00DB5B FF FF FF FF FF FF FF FF    
   6965 00DB63 FF FF FF FF FF FF FF FF    
   6965 00DB6B FF FF FF FF FF FF FF FF    
   6965 00DB73 FF FF FF FF FF FF FF FF    
   6965 00DB7B FF FF FF FF FF FF FF FF    
   6965 00DB83 FF FF FF FF FF FF FF FF    
   6965 00DB8B FF FF FF FF FF FF FF FF    
   6965 00DB93 FF FF FF FF FF FF FF FF    
   6965 00DB9B FF FF FF FF FF FF FF FF    
   6965 00DBA3 FF FF FF FF FF FF FF FF    
   6965 00DBAB FF FF FF FF FF FF FF FF    
   6965 00DBB3 FF FF FF FF FF FF FF FF    
   6965 00DBBB FF FF FF FF FF FF FF FF    
   6965 00DBC3 FF FF FF FF FF FF FF FF    
   6965 00DBCB FF FF FF FF FF FF FF FF    
   6965 00DBD3 FF FF FF FF FF FF FF FF    
   6965 00DBDB FF FF FF FF FF FF FF FF    
   6965 00DBE3 FF FF FF FF FF FF FF FF    
   6965 00DBEB FF FF FF FF FF FF FF FF    
   6965 00DBF3 FF FF FF FF FF FF FF FF    
   6965 00DBFB FF FF FF FF FF FF FF FF    
   6965 00DC03 FF FF FF FF FF FF FF FF    
   6965 00DC0B FF FF FF FF FF FF FF FF    
   6965 00DC13 FF FF FF FF FF FF FF FF    
   6965 00DC1B FF FF FF FF FF FF FF FF    
   6965 00DC23 FF FF FF FF FF FF FF FF    
   6965 00DC2B FF FF FF FF FF FF FF FF    
   6965 00DC33 FF FF FF FF FF FF FF FF    
   6965 00DC3B FF FF FF FF FF FF FF FF    
   6965 00DC43 FF FF FF FF FF FF FF FF    
   6965 00DC4B FF FF FF FF FF FF FF FF    
   6965 00DC53 FF FF FF FF FF FF FF FF    
   6965 00DC5B FF FF FF FF FF FF FF FF    
   6965 00DC63 FF FF FF FF FF FF FF FF    
   6965 00DC6B FF FF FF FF FF FF FF FF    
   6965 00DC73 FF FF FF FF FF FF FF FF    
   6965 00DC7B FF FF FF FF FF FF FF FF    
   6965 00DC83 FF FF FF FF FF FF FF FF    
   6965 00DC8B FF FF FF FF FF FF FF FF    
   6965 00DC93 FF FF FF FF FF FF FF FF    
   6965 00DC9B FF FF FF FF FF FF FF FF    
   6965 00DCA3 FF FF FF FF FF FF FF FF    
   6965 00DCAB FF FF FF FF FF FF FF FF    
   6965 00DCB3 FF FF FF FF FF FF FF FF    
   6965 00DCBB FF FF FF FF FF FF FF FF    
   6965 00DCC3 FF FF FF FF FF FF FF FF    
   6965 00DCCB FF FF FF FF FF FF FF FF    
   6965 00DCD3 FF FF FF FF FF FF FF FF    
   6965 00DCDB FF FF FF FF FF FF FF FF    
   6965 00DCE3 FF FF FF FF FF FF FF FF    
   6965 00DCEB FF FF FF FF FF FF FF FF    
   6965 00DCF3 FF FF FF FF FF FF FF FF    
   6965 00DCFB FF FF FF FF FF FF FF FF    
   6965 00DD03 FF FF FF FF FF FF FF FF    
   6965 00DD0B FF FF FF FF FF FF FF FF    
   6965 00DD13 FF FF FF FF FF FF FF FF    
   6965 00DD1B FF FF FF FF FF FF FF FF    
   6965 00DD23 FF FF FF FF FF FF FF FF    
   6965 00DD2B FF FF FF FF FF FF FF FF    
   6965 00DD33 FF FF FF FF FF FF FF FF    
   6965 00DD3B FF FF FF FF FF FF FF FF    
   6965 00DD43 FF FF FF FF FF FF FF FF    
   6965 00DD4B FF FF FF FF FF FF FF FF    
   6965 00DD53 FF FF FF FF FF FF FF FF    
   6965 00DD5B FF FF FF FF FF FF FF FF    
   6965 00DD63 FF FF FF FF FF FF FF FF    
   6965 00DD6B FF FF FF FF FF FF FF FF    
   6965 00DD73 FF FF FF FF FF FF FF FF    
   6965 00DD7B FF FF FF FF FF FF FF FF    
   6965 00DD83 FF FF FF FF FF FF FF FF    
   6965 00DD8B FF FF FF FF FF FF FF FF    
   6965 00DD93 FF FF FF FF FF FF FF FF    
   6965 00DD9B FF FF FF FF FF FF FF FF    
   6965 00DDA3 FF FF FF FF FF FF FF FF    
   6965 00DDAB FF FF FF FF FF FF FF FF    
   6965 00DDB3 FF FF FF FF FF FF FF FF    
   6965 00DDBB FF FF FF FF FF FF FF FF    
   6965 00DDC3 FF FF FF FF FF FF FF FF    
   6965 00DDCB FF FF FF FF FF FF FF FF    
   6965 00DDD3 FF FF FF FF FF FF FF FF    
   6965 00DDDB FF FF FF FF FF FF FF FF    
   6965 00DDE3 FF FF FF FF FF FF FF FF    
   6965 00DDEB FF FF FF FF FF FF FF FF    
   6965 00DDF3 FF FF FF FF FF FF FF FF    
   6965 00DDFB FF FF FF FF FF FF FF FF    
   6965 00DE03 FF FF FF FF FF FF FF FF    
   6965 00DE0B FF FF FF FF FF FF FF FF    
   6965 00DE13 FF FF FF FF FF FF FF FF    
   6965 00DE1B FF FF FF FF FF FF FF FF    
   6965 00DE23 FF FF FF FF FF FF FF FF    
   6965 00DE2B FF FF FF FF FF FF FF FF    
   6965 00DE33 FF FF FF FF FF FF FF FF    
   6965 00DE3B FF FF FF FF FF FF FF FF    
   6965 00DE43 FF FF FF FF FF FF FF FF    
   6965 00DE4B FF FF FF FF FF FF FF FF    
   6965 00DE53 FF FF FF FF FF FF FF FF    
   6965 00DE5B FF FF FF FF FF FF FF FF    
   6965 00DE63 FF FF FF FF FF FF FF FF    
   6965 00DE6B FF FF FF FF FF FF FF FF    
   6965 00DE73 FF FF FF FF FF FF FF FF    
   6965 00DE7B FF FF FF FF FF FF FF FF    
   6965 00DE83 FF FF FF FF FF FF FF FF    
   6965 00DE8B FF FF FF FF FF FF FF FF    
   6965 00DE93 FF FF FF FF FF FF FF FF    
   6965 00DE9B FF FF FF FF FF FF FF FF    
   6965 00DEA3 FF FF FF FF FF FF FF FF    
   6965 00DEAB FF FF FF FF FF FF FF FF    
   6965 00DEB3 FF FF FF FF FF FF FF FF    
   6965 00DEBB FF FF FF FF FF FF FF FF    
   6965 00DEC3 FF FF FF FF FF FF FF FF    
   6965 00DECB FF FF FF FF FF FF FF FF    
   6965 00DED3 FF FF FF FF FF FF FF FF    
   6965 00DEDB FF FF FF FF FF FF FF FF    
   6965 00DEE3 FF FF FF FF FF FF FF FF    
   6965 00DEEB FF FF FF FF FF FF FF FF    
   6965 00DEF3 FF FF FF FF FF FF FF FF    
   6965 00DEFB FF FF FF FF FF FF FF FF    
   6965 00DF03 FF FF FF FF FF FF FF FF    
   6965 00DF0B FF FF FF FF FF FF FF FF    
   6965 00DF13 FF FF FF FF FF FF FF FF    
   6965 00DF1B FF FF FF FF FF FF FF FF    
   6965 00DF23 FF FF FF FF FF FF FF FF    
   6965 00DF2B FF FF FF FF FF FF FF FF    
   6965 00DF33 FF FF FF FF FF FF FF FF    
   6965 00DF3B FF FF FF FF FF FF FF FF    
   6965 00DF43 FF FF FF FF FF FF FF FF    
   6965 00DF4B FF FF FF FF FF FF FF FF    
   6965 00DF53 FF FF FF FF FF FF FF FF    
   6965 00DF5B FF FF FF FF FF FF FF FF    
   6965 00DF63 FF FF FF FF FF FF FF FF    
   6965 00DF6B FF FF FF FF FF FF FF FF    
   6965 00DF73 FF FF FF FF FF FF FF FF    
   6965 00DF7B FF FF FF FF FF FF FF FF    
   6965 00DF83 FF FF FF FF FF FF FF FF    
   6965 00DF8B FF FF FF FF FF FF FF FF    
   6965 00DF93 FF FF FF FF FF FF FF FF    
   6965 00DF9B FF FF FF FF FF FF FF FF    
   6965 00DFA3 FF FF FF FF FF FF FF FF    
   6965 00DFAB FF FF FF FF FF FF FF FF    
   6965 00DFB3 FF FF FF FF FF FF FF FF    
   6965 00DFBB FF FF FF FF FF FF FF FF    
   6965 00DFC3 FF FF FF FF FF FF FF FF    
   6965 00DFCB FF FF FF FF FF FF FF FF    
   6965 00DFD3 FF FF FF FF FF FF FF FF    
   6965 00DFDB FF FF FF FF FF FF FF FF    
   6965 00DFE3 FF FF FF FF FF FF FF FF    
   6965 00DFEB FF FF FF FF FF FF FF FF    
   6965 00DFF3 FF FF FF FF FF FF FF FF    
   6965 00DFFB FF FF FF FF FF             
                                           
   6967 00E000                             start:
   6968 00E000 78                           	SEI					; not strictly necessary after power on reset
   6969 00E001 D8                           	CLD
                                           ;	CLV					; overflow low
                                           ;	SEC					; carry high
                                           ;	XCE					; sets 32 bit mode, 32 bit registers
                                           ;	REP		#$30		; 32 bit registers
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$3FFF
                                           ;	TAS
                                           ;
   6979 00E002 18                           	CLC					; switch to '816 mode
   6980 00E003 2C 00 E0                     	BIT		start		; set overflow bit
   6981 00E006 FB                           	XCE
   6982 00E007 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           	; Setup all the segment descriptors
                                           	; This must be done before the stack can be accessed, and
                                           	; before subroutine calls and task switching can be made.
                                           
                                           	; First setup segment #0, the segment the core starts running under.
                                           	; It's setup for flat addressing.
   6992 00E009 A9 00 00                     	LDA		#0
   6993 00E00C 42 EB                        	XBAW
   6994 00E00E A9 00 00                     	LDA		#0
   6995 00E011 A2 8D 09                     	LDX		#$98D		; present, writeable, executable, max size.
   6996 00E014 A8                           	TAY
   6997 00E015 42 BA                        	SDU
   6998 00E017 C8                           	INY
                                           
                                           	; Flag remaining segments as not present 
   7001 00E018 A2 00 00                     	LDX		#$000		; not present, non-executable, non-writeable, min size
   7002 00E01B                             .0003:
   7003 00E01B 42 BA                        	SDU					; update segment descriptor
   7004 00E01D C8                           	INY
   7005 00E01E C0 00 10                     	CPY		#4096
   7006 00E021 D0 F8                        	BNE		.0003
                                           
                                           	; setup code segment #1
   7009 00E023 A2 05 09                     	LDX		#$905		; executable, 64k
   7010 00E026 A8                           	TAY
   7011 00E027 C8                           	INY
   7012 00E028 42 BA                        	SDU
                                           	; setup data segment #2
   7014 00E02A A2 8B 08                     	LDX		#$88B		; writeable, 256M
   7015 00E02D C8                           	INY
   7016 00E02E 42 BA                        	SDU
                                           	; setup stack segment #3 (for 65c02 mode)
   7018 00E030 A2 82 08                     	LDX		#$882		; writeable, 1k (based at zero)
   7019 00E033 C8                           	INY
   7020 00E034 42 BA                        	SDU
                                           	; setup stack segment #4 (for 65c816 mode)
   7022 00E036 A2 85 08                     	LDX		#$885		; writeable, 64k (based at zero)
   7023 00E039 C8                           	INY
   7024 00E03A 42 BA                        	SDU
                                           	; seg #5 is the maxed out segment
   7026 00E03C A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   7027 00E03F C8                           	INY
   7028 00E040 42 BA                        	SDU
                                           
                                           	; I/O segment
   7031 00E042 A9 F0 00                     	LDA		#$00F0
   7032 00E045 42 EB                        	XBAW
   7033 00E047 A9 00 00                     	LDA		#$0000
   7034 00E04A A2 87 08                     	LDX		#$887		; writeable, 1M (based at $F00000)
   7035 00E04D A0 FF 0F                     	LDY		#$FFF
   7036 00E050 42 BA                        	SDU
                                           
                                           	; now set the code segment (test far jump)
   7039 00E052 42 5C 59 E0 00 01 00         	JMF		1:.0004
   7040 00E059                             .0004:
                                           	; set the stack segment
                                           	; (must be before PEA/PLDS)
   7043 00E059 A9 05 00                     	LDA		#5
   7044 00E05C 42 5A                        	TASS
   7045 00E05E A9 FF 6B                     	LDA		#$6BFF		; set top of stack
   7046 00E061 1B                           	TAS
                                           
                                           	; setup the programmable address decodes
   7049 00E062 A9 70 00                     	LDA		#$0070		; program chip selects for I/O
   7050 00E065 8D 00 B0                     	STA		PCS0		; at $007000
   7051 00E068 A9 71 00                     	LDA		#$0071
   7052 00E06B 8D 02 B0                     	STA		PCS1
                                           ;	LDA		#$FEA1		; select $FEA1xx I/O
                                           ;	STA		PCS3
                                           ;	LDA		#$0000		; select zero page ram
                                           ;	STA		PCS5
                                           
                                           	; set the data segment
                                           	; this must be setup after address decoding is setup
   7060 00E06E F4 05 00                     	PEA		5
   7061 00E071 42 2B                        	PLDS
                                           
                                           	; Setup the counters
   7064 00E073 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
                                           	; Counter #0 is setup as a free running tick count
   7068 00E075 A9 FF                        	LDA		#$FF		; set limit to $FFFFFF
   7069 00E077 8D 10 B0                     	STA		CTR0_LMT
   7070 00E07A 8D 11 B0                     	STA		CTR0_LMT+1
   7071 00E07D 8D 12 B0                     	STA		CTR0_LMT+2
   7072 00E080 A9 14                        	LDA		#$14		; count up, on mpu clock
   7073 00E082 8D 13 B0                     	STA		CTR0_CTRL
                                           	; Counter #1 is set to interrupt at a 50Hz rate
   7075 00E085 A9 2A                        	LDA		#$2A	;94		; divide by 95794 (for 50Hz)
   7076 00E087 8D 14 B0                     	STA		CTR1_LMT		; FFFFFE = 2Hz with 33MHz clock
   7077 00E08A A9 2C                        	LDA		#$2C	;57
   7078 00E08C 8D 15 B0                     	STA		CTR1_LMT+1
   7079 00E08F A9 0A                        	LDA		#$0A	;09
   7080 00E091 8D 16 B0                     	STA		CTR1_LMT+2
   7081 00E094 A9 05                        	LDA		#$05		; count down, on mpu clock, irq disenabled
   7082 00E096 8D 17 B0                     	STA		CTR1_CTRL
                                           	; Counter #2 isn't setup
                                           
   7085 00E099 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
   7089 00E09B A9 20 00                     	LDA		#$20
   7090 00E09E 8F 00 58 02                  	STA		TCB_priority
   7091 00E0A2 A9 00 00                     	LDA		#0
   7092 00E0A5 20 AC F6                     	JSR		InsertIntoReadyFifo
   7093 00E0A8 20 B4 ED                     	JSR		ResetKbd
                                           
   7095 00E0AB 64 D0                        	STZ		TaskSwitchEn
                                           ;	FORK	#8			; fork a BIOS context
                                           ;	TTA
                                           ;	CMP		#8
                                           ;	BNE		.0002
                                           ;	RTT
                                           ;.0002:
                                           	; Setup the task registers
   7103 00E0AD A0 09 00                     	LDY		#9			; # tasks to setup
   7104 00E0B0 A2 01 00                     	LDX		#1
   7105 00E0B3                             .0001:
   7106 00E0B3 42 4C 42 F8 00 00            	LDT		TaskStartTbl,X
   7107 00E0B9 E8                           	INX
   7108 00E0BA 88                           	DEY
   7109 00E0BB D0 F6                        	BNE		.0001
                                           
   7111 00E0BD 42 9C FE FF 02 00            	STZ		running_task
                                           
   7113 00E0C3 A9 D7 F7                     	LDA		#BrkRout1
   7114 00E0C6 8D 02 01                     	STA		$0102
                                           
   7116 00E0C9 64 04                        	STZ		TickCount
   7117 00E0CB 64 06                        	STZ		TickCount+2
   7118 00E0CD                             Task0:
   7119 00E0CD 58                           	CLI
   7120 00E0CE EA                           	NOP
   7121 00E0CF EA                           	NOP
   7122 00E0D0 EA                           	NOP
                                           	; Start the single stepping task.
   7124 00E0D1 A9 01 00                     	LDA		#$01
   7125 00E0D4 8D 00 70                     	STA		$7000
   7126 00E0D7 42 A2 09 00                  	TSK		#9
   7127 00E0DB                             .0001:
   7128 00E0DB A9 04 00                     	LDA		#$04
   7129 00E0DE 8D 00 70                     	STA		$7000
   7130 00E0E1 A9 FF 0F                     	LDA		#$FFF
   7131 00E0E4 85 44                        	STA		Vidptr+4
   7132 00E0E6 85 4A                        	STA		Vidregs+4
   7133 00E0E8 A9 0D 00                     	LDA		#VIDBUF>>16
   7134 00E0EB 85 42                        	STA		Vidptr+2
   7135 00E0ED 64 40                        	STZ		Vidptr
   7136 00E0EF A9 0D BF                     	LDA		#$BF0D	; 'm'
   7137 00E0F2 42 DA 42 87 40               	STA		FAR {Vidptr}
   7138 00E0F7 A9 0E 00                     	LDA		#VIDREGS >> 16
   7139 00E0FA 85 48                        	STA		Vidregs+2
   7140 00E0FC A9 00 A0                     	LDA		#VIDREGS
   7141 00E0FF 85 46                        	STA		Vidregs
   7142 00E101 A0 07 00                     	LDY		#7	
   7143 00E104 A9 21 00                     	LDA		#$21		; divide by 3 vertically, 2 horizontally
   7144 00E107 20 2F EC                     	JSR		SetVideoReg	; clear POR state
   7145 00E10A A9 54 00                     	LDA		#84		; set window left position 84
   7146 00E10D A0 02 00                     	LDY		#2
   7147 00E110 20 2F EC                     	JSR		SetVideoReg
   7148 00E113 A9 00 00                     	LDA		#0
   7149 00E116 A0 03 00                     	LDY		#3
   7150 00E119 20 2F EC                     	JSR		SetVideoReg
   7151 00E11C A9 10 00                     	LDA		#16			; set window top position
   7152 00E11F A0 04 00                     	LDY		#4
   7153 00E122 20 2F EC                     	JSR		SetVideoReg
   7154 00E125 20 14 EC                     	JSR		GetTextRowsCols
   7155 00E128 A9 E4 E9                     	LDA		#DisplayChar
   7156 00E12B 8D F0 03                     	STA		OutputVec
   7157 00E12E AD F0 03                     	LDA		OutputVec
   7158 00E131 C9 E4 E9                     	CMP		#DisplayChar
   7159 00E134 D0 A5                        	BNE		.0001
   7160 00E136 A9 02 00                     	LDA		#$02
   7161 00E139 8D 00 70                     	STA		$7000
   7162 00E13C A9 00 BF                     	LDA		#$BF00
   7163 00E13F 85 36                        	STA		NormAttr
   7164 00E141 20 59 EC                     	JSR		ClearScreen
   7165 00E144 20 A9 EB                     	JSR		HomeCursor
                                           ;	JSR		beep
   7167 00E147 A9 03 00                     	LDA		#$03
   7168 00E14A 42 3B 05 00 8D 00 70         	STA		5:$7000
   7169 00E151 F4 05 00                     	PEA		5
   7170 00E154 F4 68 E8                     	PEA		msgStarting
   7171 00E157 20 E5 EB                     	JSR		DisplayString
   7172 00E15A 20 1F F5                     	JSR		rtc_init
   7173 00E15D 20 27 F5                     	JSR		rtc_read
   7174 00E160 C9 00 00                     	CMP		#0
   7175 00E163 F0 09                        	BEQ		.0006
   7176 00E165 F4 01 00                     	PEA		1
   7177 00E168 F4 EF F5                     	PEA		msgRtcReadFail
   7178 00E16B 20 E5 EB                     	JSR		DisplayString
   7179 00E16E                             .0006:
                                           ;	SEP		#$1000		; turn on single step mode
                                           ;	LDA		#0
                                           ;	STA		$FFF:FAC1
                                           ;	STA		$FFF:FAC1+2
                                           ;	STA		$FFF:FAC1+4
                                           ;	STA		$FFF:FAC1+6
                                           ;	STA		$FFF:FAC1+8
                                           ;	STA		$FFF:FAC1+10
                                           ;	LDA		#3
                                           ;	STA		$7000
                                           ;	LDA		#1234
                                           ;	STA		FAC1
                                           ;	LDA		#5			; FIX2FLT
                                           ;	JSR 	FPCommandWait
                                           ;	LDA		#4
                                           ;	STA		$7000
                                           ;	JSR		DivideByTen
                                           ;	LDA		#5
                                           ;	STA		$7000
                                           ;	JSR		FAC1ToString
                                           ;	PEA		2
                                           ;	PEA		$3A0
                                           ;	JSR		DisplayString
                                           ;	LDA		#' '
                                           ;	JSR		OutChar
                                           ;	JSR		DispFAC1
                                           
                                           ;	FORK	#11
                                           ;	TTA
                                           ;	CMP		#11
                                           ;	LBEQ	KeybdInit
                                           
                                           	; Create a workhorse BIOS context that will allow subroutine calls into
                                           	; the BIOS code from alternate contexts which may not have the same VM
                                           	; settings.
                                           	;
   7216 00E16E 78                           	SEI
   7217 00E16F 42 A0 FC 00                  	FORK	#$FC
   7218 00E173 42 1A                        	TTA
   7219 00E175 29 FF 01                     	AND		#$01FF
   7220 00E178 C9 FC 00                     	CMP		#$FC
   7221 00E17B D0 20                        	BNE		TaskMon
   7222 00E17D                             TaskFC:
   7223 00E17D A2 F8 01                     	LDX		#$FC*2
   7224 00E180 A9 20 00                     	LDA		#$20
   7225 00E183 9F 00 58 02                  	STA		TCB_priority,X
   7226 00E187 8A                           	TXA
   7227 00E188 4A                           	LSR
   7228 00E189 20 AC F6                     	JSR		InsertIntoReadyFifo
   7229 00E18C                             .0003
   7230 00E18C 78                           	SEI
   7231 00E18D 68                           	PLA
   7232 00E18E A2 FF 23                     	LDX		#$23FF
   7233 00E191 9A                           	TXS
   7234 00E192 48                           	PHA
   7235 00E193 58                           	CLI
   7236 00E194 EA                           	NOP		; allow CLI to take place
   7237 00E195 EA                           	NOP
   7238 00E196 EA                           	NOP
   7239 00E197 EA                           	NOP
   7240 00E198 EA                           	NOP
   7241 00E199 42 60                        	RTT
   7242 00E19B 80 EF                        	BRA		.0003
   7243 00E19D                             TaskMon:
   7244 00E19D 58                           	CLI
                                           
   7246 00E19E                             Mon1:
   7247 00E19E                             .mon1:
   7248 00E19E A9 FF 6B                     	LDA		#$6BFF
   7249 00E1A1 1B                           	TAS
   7250 00E1A2 20 39 EC                     	JSR		CursorOn
   7251 00E1A5 20 CD EB                     	JSR		OutCRLF
   7252 00E1A8 A9 24 00                     	LDA		#'$'
   7253 00E1AB 85 D0                        	STA		TaskSwitchEn
   7254 00E1AD                             .mon3:
   7255 00E1AD 20 D6 EB                     	JSR		OutChar
   7256 00E1B0 20 4A EF                     	JSR		KeybdGetCharWait
   7257 00E1B3 29 FF 00                     	AND		#$FF
                                           ;	CMP		#'.'
                                           ;	BEQ		.mon3
   7260 00E1B6 C9 0D 00                     	CMP		#CR
   7261 00E1B9 D0 F2                        	BNE		.mon3
   7262 00E1BB A5 32                        	LDA		CursorY
   7263 00E1BD 0A                           	ASL
   7264 00E1BE AA                           	TAX
   7265 00E1BF 42 1B BD 04 F8               	LDA		CS:LineTbl,X
   7266 00E1C4 0A                           	ASL
   7267 00E1C5 AA                           	TAX
   7268 00E1C6                             .mon4:
   7269 00E1C6 20 00 E8                     	JSR		IgnoreBlanks
   7270 00E1C9 20 6C E2                     	JSR		MonGetch
   7271 00E1CC C9 24 00                     	CMP		#'$'
   7272 00E1CF F0 F5                        	BEQ		.mon4
   7273 00E1D1 C9 53 00                     	CMP		#'S'
   7274 00E1D4 D0 27                        	BNE		.mon2
   7275 00E1D6 20 6C E2                     	JSR		MonGetch
   7276 00E1D9 C9 45 00                     	CMP		#'E'
   7277 00E1DC F0 FF 73 01                  	LBEQ	GetSecnum
   7278 00E1E0 A9 20 00                     	LDA		#$20
   7279 00E1E3 8F 08 58 02                  	STA		TCB_priority+8
   7280 00E1E7 42 9C 00 5A 02 00            	STZ		TCB_status		; monitor is no longer ready
   7281 00E1ED A9 08 00                     	LDA		#8
   7282 00E1F0 85 CE                        	STA		IOFocusTask
   7283 00E1F2 20 AC F6                     	JSR		InsertIntoReadyFifo
   7284 00E1F5 42 CB 42 A2 08 00            	TSK		JMP:#8
   7285 00E1FB 80 A1                        	BRA		.mon1
                                           	;JMP		$C000		; invoke Supermon832
   7287 00E1FD                             .mon2:
   7288 00E1FD C9 43 00                     	CMP		#'C'
   7289 00E200 D0 08                        	BNE		.mon5
   7290 00E202 20 59 EC                     	JSR		ClearScreen
   7291 00E205 20 A9 EB                     	JSR		HomeCursor
   7292 00E208 80 94                        	BRA		.mon1
   7293 00E20A                             .mon5:
   7294 00E20A C9 4D 00                     	CMP		#'M'
   7295 00E20D D0 05                        	BNE		.mon6
   7296 00E20F 20 43 E6                     	JSR		doMemoryDump
   7297 00E212 80 8A                        	BRA		Mon1
   7298 00E214                             .mon6:
   7299 00E214 C9 44 00                     	CMP		#'D'
   7300 00E217 F0 FF 6E 00                  	LBEQ	doD
   7301 00E21B C9 3E 00                     	CMP		#'>'
   7302 00E21E F0 FF 93 04                  	LBEQ	doMemoryEdit
   7303 00E222 C9 46 00                     	CMP		#'F'
   7304 00E225 F0 FF C7 04                  	LBEQ	doFill
   7305 00E229 C9 4A 00                     	CMP		#'J'
   7306 00E22C F0 FF 66 05                  	LBEQ	doJump
   7307 00E230 C9 54 00                     	CMP		#'T'
   7308 00E233 F0 FF C9 00                  	LBEQ	doTask
   7309 00E237 C9 49 00                     	CMP		#'I'
   7310 00E23A F0 FF 8E 01                  	LBEQ	doInvaders
   7311 00E23E C9 52 00                     	CMP		#'R'
   7312 00E241 D0 0F                        	BNE		.mon7
   7313 00E243 20 6C E2                     	JSR		MonGetch
   7314 00E246 C9 44 00                     	CMP		#'D'
   7315 00E249 F0 FF 1B 01                  	LBEQ	doRead
   7316 00E24D CA                           	DEX
   7317 00E24E CA                           	DEX
   7318 00E24F 82 87 01                     	BRL		doRegs
   7319 00E252                             .mon7:
   7320 00E252 C9 42 00                     	CMP		#'B'
   7321 00E255 F0 FF CE 00                  	LBEQ	doBasic
   7322 00E259 C9 57 00                     	CMP		#'W'
   7323 00E25C F0 FF 01 01                  	LBEQ	doWrite
   7324 00E260 82 3B FF                     	BRL		Mon1
                                           
                                           ; Get a character from the screen, skipping over spaces and tabs
                                           ;
   7328 00E263                             MonGetNonSpace:
   7329 00E263                             .0001:
   7330 00E263 20 6C E2                     	JSR		MonGetch
   7331 00E266 C9 20 00                     	CMP		#' '
   7332 00E269 F0 F8                        	BEQ		.0001
   7333 00E26B 60                           	RTS
                                           
                                           ; Get a character from the screen.
                                           ;
   7337 00E26C                             MonGetch:
   7338 00E26C 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7339 00E274 E8                           	INX
   7340 00E275 E8                           	INX
   7341 00E276 29 FF 00                     	AND		#$FF
   7342 00E279 20 D8 E9                     	JSR		ScreenToAscii
   7343 00E27C 60                           	RTS
                                           
   7345 00E27D                             MonErr:
   7346 00E27D F4 01 00                     	PEA		1
   7347 00E280 F4 FD F9                     	PEA		msgErr
   7348 00E283 20 E5 EB                     	JSR		DisplayString
   7349 00E286 82 15 FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7353 00E289                             doD:
   7354 00E289 20 6C E2                     	JSR		MonGetch
   7355 00E28C C9 54 00                     	CMP		#'T'
   7356 00E28F F0 05                        	BEQ		doDate
   7357 00E291 CA                           	DEX
   7358 00E292 CA                           	DEX
   7359 00E293 82 FD FF                     	BRL		doDisasssemble
                                           
                                           ;------------------------------------------------------------------------------
                                           ; DT? - displays the date from the RTC
                                           ; DT <year> <month> <day> - updates the RTC with the year, month and day.
                                           ;------------------------------------------------------------------------------
                                           
   7366 00E296                             doDate:
   7367 00E296 20 6C E2                     	JSR		MonGetch
   7368 00E299 C9 3F 00                     	CMP		#'?'
   7369 00E29C F0 35                        	BEQ		DispDate
   7370 00E29E CA                           	DEX
   7371 00E29F CA                           	DEX
   7372 00E2A0 20 11 ED                     	JSR		GetHexNumber
   7373 00E2A3 C0 00 00                     	CPY		#0
   7374 00E2A6 F0 28                        	BEQ		.0001
   7375 00E2A8 A5 0C                        	LDA		NumWorkArea
   7376 00E2AA 42 8B 8D 06 03               	STA.B	RTCBuf+6
   7377 00E2AF 20 11 ED                     	JSR		GetHexNumber
   7378 00E2B2 C0 00 00                     	CPY		#0
   7379 00E2B5 F0 19                        	BEQ		.0001
   7380 00E2B7 A5 0C                        	LDA		NumWorkArea
   7381 00E2B9 42 8B 8D 05 03               	STA.B	RTCBuf+5
   7382 00E2BE 20 11 ED                     	JSR		GetHexNumber
   7383 00E2C1 C0 00 00                     	CPY		#0
   7384 00E2C4 F0 0A                        	BEQ		.0001
   7385 00E2C6 A5 0C                        	LDA		NumWorkArea
   7386 00E2C8 42 8B 8D 04 03               	STA.B	RTCBuf+4
   7387 00E2CD 20 A9 F5                     	JSR		rtc_write
   7388 00E2D0                             .0001:
   7389 00E2D0 82 CB FE                     	BRL		Mon1
                                           
   7391 00E2D3                             DispDate:
   7392 00E2D3 20 27 F5                     	JSR		rtc_read
   7393 00E2D6 42 8B AD 06 03               	LDA.B	RTCBuf+6
   7394 00E2DB 20 BB EC                     	JSR		DispByte
   7395 00E2DE A9 2F 00                     	LDA		#'/'
   7396 00E2E1 20 D6 EB                     	JSR		OutChar
   7397 00E2E4 42 8B AD 05 03               	LDA.B	RTCBuf+5
   7398 00E2E9 20 BB EC                     	JSR		DispByte
   7399 00E2EC A9 2F 00                     	LDA		#'/'
   7400 00E2EF 20 D6 EB                     	JSR		OutChar
   7401 00E2F2 42 8B AD 04 03               	LDA.B	RTCBuf+4
   7402 00E2F7 20 BB EC                     	JSR		DispByte
   7403 00E2FA 20 CD EB                     	JSR		OutCRLF
   7404 00E2FD 82 9E FE                     	BRL		Mon1
                                           		
                                           ;------------------------------------------------------------------------------
   7407 00E300                             doTask:
   7408 00E300 20 6C E2                     	JSR		MonGetch
   7409 00E303 C9 53 00                     	CMP		#'S'
   7410 00E306 D0 16                        	BNE		.0001
   7411 00E308 20 11 ED                     	JSR		GetHexNumber
   7412 00E30B A5 0C                        	LDA		NumWorkArea
   7413 00E30D 0A                           	ASL
   7414 00E30E AA                           	TAX		
   7415 00E30F A9 20 00                     	LDA		#$20
   7416 00E312 9F 00 58 02                  	STA		TCB_priority,X
   7417 00E316 A5 0C                        	LDA		NumWorkArea
   7418 00E318 20 AC F6                     	JSR		InsertIntoReadyFifo
                                           ;	TSK
   7420 00E31B 82 80 FE                     	BRL		Mon1
   7421 00E31E                             .0001:
   7422 00E31E CA                           	DEX
   7423 00E31F CA                           	DEX
   7424 00E320 20 11 ED                     	JSR		GetHexNumber
   7425 00E323 A5 0C                        	LDA		NumWorkArea
   7426 00E325 42 3A                        	TSK
                                           	BRK		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Start the BASIC interpreter.
                                           ;------------------------------------------------------------------------------
                                           
   7433 00E327                             doBasic:
   7434 00E327 A9 01 00                     	LDA		#$0001
   7435 00E32A 42 EB                        	XBAW
   7436 00E32C A9 00 00                     	LDA		#$0000
   7437 00E32F A2 85 09                     	LDX		#$985		; executable, writeable, 64k (based at $10000)
   7438 00E332 A0 FD 0F                     	LDY		#$FFD
   7439 00E335 42 BA                        	SDU
   7440 00E337 A9 20 00                     	LDA		#$20
   7441 00E33A 8F 07 58 02                  	STA		TCB_priority+7
   7442 00E33E 42 9C 00 5A 02 00            	STZ		TCB_status	; monitor is no longer ready
   7443 00E344 A9 07 00                     	LDA		#7
   7444 00E347 85 CE                        	STA		IOFocusTask
   7445 00E349 20 AC F6                     	JSR		InsertIntoReadyFifo
   7446 00E34C 42 A2 07 00                  	TSK		#7
   7447 00E350 82 4B FE                     	BRL		Mon1
                                           	
                                           ; Get starting sector number for SD Card read/write routines
                                           ;------------------------------------------------------------------------------
                                           
   7452 00E353                             GetSecnum:
   7453 00E353 20 11 ED                     	JSR		GetHexNumber
   7454 00E356 A5 0C                        	LDA		NumWorkArea
   7455 00E358 85 C4                        	STA		secnum
   7456 00E35A A5 0E                        	LDA		NumWorkArea+2
   7457 00E35C 85 C6                        	STA		secnum+2
   7458 00E35E 82 3D FE                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Read or write a block of memory to SD Card.
                                           ;------------------------------------------------------------------------------
                                           
   7464 00E361                             doWrite:
   7465 00E361 A9 FF FF                     	LDA		#$FFFF
   7466 00E364 85 BA                        	STA		rw_flag
   7467 00E366 80 02                        	BRA		doReadWrite
   7468 00E368                             doRead:
   7469 00E368 64 BA                        	STZ		rw_flag
   7470 00E36A                             doReadWrite:
   7471 00E36A 20 E6 EC                     	JSR		GetRange
   7472 00E36D 20 AA F3                     	JSR		spi_master_init
   7473 00E370 C9 00 00                     	CMP		#0
   7474 00E373 F0 03                        	BEQ		.0004
   7475 00E375 82 26 FE                     	BRL		Mon1
   7476 00E378                             .0004:
   7477 00E378 20 CD EB                     	JSR		OutCRLF
   7478 00E37B                             .0002:
   7479 00E37B 20 BC E3                     	JSR		DispSecnum
   7480 00E37E A5 22                        	LDA		RangeStart+2
   7481 00E380 48                           	PHA
   7482 00E381 A5 20                        	LDA		RangeStart
   7483 00E383 48                           	PHA
   7484 00E384 A5 C6                        	LDA		secnum+2
   7485 00E386 48                           	PHA
   7486 00E387 A5 C4                        	LDA		secnum
   7487 00E389 48                           	PHA
   7488 00E38A 24 BA                        	BIT		rw_flag
   7489 00E38C 50 05                        	BVC		.0005
   7490 00E38E 20 54 F4                     	JSR		spi_master_write
   7491 00E391 80 03                        	BRA		.0006
   7492 00E393                             .0005:
   7493 00E393 20 DD F3                     	JSR		spi_master_read
   7494 00E396                             .0006:
   7495 00E396 E6 C4                        	INC		secnum
   7496 00E398 D0 02                        	BNE		.0001
   7497 00E39A E6 C6                        	INC		secnum+2
   7498 00E39C                             .0001:
   7499 00E39C 18                           	CLC
   7500 00E39D A5 20                        	LDA		RangeStart
   7501 00E39F 69 00 02                     	ADC		#512
   7502 00E3A2 85 20                        	STA		RangeStart
   7503 00E3A4 A5 22                        	LDA		RangeStart+2
   7504 00E3A6 69 00 00                     	ADC		#0
   7505 00E3A9 85 22                        	STA		RangeStart+2
   7506 00E3AB 38                           	SEC
   7507 00E3AC A5 20                        	LDA		RangeStart
   7508 00E3AE E5 24                        	SBC		RangeEnd
   7509 00E3B0 A5 22                        	LDA		RangeStart+2
   7510 00E3B2 E5 26                        	SBC		RangeEnd+2
   7511 00E3B4 30 C5                        	BLT		.0002
   7512 00E3B6 20 CD EB                     	JSR		OutCRLF
   7513 00E3B9 82 E2 FD                     	BRL		Mon1
                                           
   7515 00E3BC                             DispSecnum:
   7516 00E3BC A5 C6                        	LDA		secnum+2
   7517 00E3BE 20 B6 EC                     	JSR		DispWord
   7518 00E3C1 A5 C4                        	LDA		secnum
   7519 00E3C3 20 B6 EC                     	JSR		DispWord
   7520 00E3C6 A9 0D 00                     	LDA		#$0D
   7521 00E3C9 4C D6 EB                     	JMP		OutChar
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7525 00E3CC                             doInvaders:
   7526 00E3CC A9 FF FF                     	LDA		#$FFFF
   7527 00E3CF 8D 68 78                     	STA		do_invaders
   7528 00E3D2 42 A2 05 00                  	TSK		#5
                                           ;	FORK	#5
                                           ;	TTA
                                           ;	CMP		#5
                                           ;	LBEQ	InvadersTask
   7533 00E3D6 82 C5 FD                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display Registers
                                           ; R<xx>		xx = context register to display
                                           ; Update Registers
                                           ; R.<reg> <val>
                                           ;	reg = CS PB PC A X Y SP SR DS DB DP or MP
                                           ;------------------------------------------------------------------------------
                                           
   7543 00E3D9                             doRegs:
   7544 00E3D9 20 6C E2                     	JSR		MonGetch
   7545 00E3DC C9 2E 00                     	CMP		#'.'
   7546 00E3DF D0 FF 31 01                  	LBNE	.0004
   7547 00E3E3 20 6C E2                     	JSR		MonGetch
   7548 00E3E6 C9 43 00                     	CMP		#'C'
   7549 00E3E9 D0 26                        	BNE		.0005
   7550 00E3EB 20 6C E2                     	JSR		MonGetch
   7551 00E3EE C9 53 00                     	CMP		#'S'
   7552 00E3F1 D0 FF A9 FD                  	LBNE	Mon1
   7553 00E3F5 20 00 E8                     	JSR		IgnoreBlanks
   7554 00E3F8 20 11 ED                     	JSR		GetHexNumber
   7555 00E3FB A5 0C                        	LDA		NumWorkArea
   7556 00E3FD 85 80                        	STA		reg_cs
   7557 00E3FF A5 0E                        	LDA		NumWorkArea+2
   7558 00E401 85 82                        	STA		reg_cs+2
   7559 00E403                             .buildrec
   7560 00E403 20 D6 E5                     	JSR		BuildRec
   7561 00E406 A6 BE                        	LDX		WorkTR
   7562 00E408 42 6C 00 01 00 00            	LDT		ldtrec
   7563 00E40E 82 8D FD                     	BRL		Mon1
   7564 00E411                             .0005:
   7565 00E411 C9 50 00                     	CMP		#'P'
   7566 00E414 D0 27                        	BNE		.0006
   7567 00E416 20 6C E2                     	JSR		MonGetch
   7568 00E419 C9 42 00                     	CMP		#'B'
   7569 00E41C D0 0C                        	BNE		.0007
   7570 00E41E 20 00 E8                     	JSR		IgnoreBlanks
   7571 00E421 20 11 ED                     	JSR		GetHexNumber
   7572 00E424 A5 0E                        	LDA		NumWorkArea+2
   7573 00E426 85 8E                        	STA		reg_pc+2
   7574 00E428 80 D9                        	BRA		.buildrec
   7575 00E42A                             .0007:
   7576 00E42A C9 43 00                     	CMP		#'C'
   7577 00E42D D0 FF 6D FD                  	LBNE	Mon1
   7578 00E431 20 00 E8                     	JSR		IgnoreBlanks
   7579 00E434 20 11 ED                     	JSR		GetHexNumber
   7580 00E437 A5 0C                        	LDA		NumWorkArea
   7581 00E439 85 8C                        	STA		reg_pc
   7582 00E43B 80 C6                        	BRA		.buildrec
   7583 00E43D                             .0006:
   7584 00E43D C9 41 00                     	CMP		#'A'
   7585 00E440 D0 10                        	BNE		.0008
   7586 00E442 20 00 E8                     	JSR		IgnoreBlanks
   7587 00E445 20 11 ED                     	JSR		GetHexNumber
   7588 00E448 A5 0C                        	LDA		NumWorkArea
   7589 00E44A 85 90                        	STA		reg_a
   7590 00E44C A5 0E                        	LDA		NumWorkArea+2
   7591 00E44E 85 92                        	STA		reg_a+2
   7592 00E450 80 B1                        	BRA		.buildrec
   7593 00E452                             .0008:
   7594 00E452 C9 58 00                     	CMP		#'X'
   7595 00E455 D0 11                        	BNE		.0009
   7596 00E457 20 00 E8                     	JSR		IgnoreBlanks
   7597 00E45A 20 11 ED                     	JSR		GetHexNumber
   7598 00E45D A5 0C                        	LDA		NumWorkArea
   7599 00E45F 85 94                        	STA		reg_x
   7600 00E461 A5 0E                        	LDA		NumWorkArea+2
   7601 00E463 85 96                        	STA		reg_x+2
   7602 00E465 82 9B FF                     	BRL		.buildrec
   7603 00E468                             .0009:
   7604 00E468 C9 59 00                     	CMP		#'Y'
   7605 00E46B D0 11                        	BNE		.0010
   7606 00E46D 20 00 E8                     	JSR		IgnoreBlanks
   7607 00E470 20 11 ED                     	JSR		GetHexNumber
   7608 00E473 A5 0C                        	LDA		NumWorkArea
   7609 00E475 85 98                        	STA		reg_y
   7610 00E477 A5 0E                        	LDA		NumWorkArea+2
   7611 00E479 85 9A                        	STA		reg_y+2
   7612 00E47B 82 85 FF                     	BRL		.buildrec
   7613 00E47E                             .0010:
   7614 00E47E C9 53 00                     	CMP		#'S'
   7615 00E481 D0 2D                        	BNE		.0011
   7616 00E483 20 6C E2                     	JSR		MonGetch
   7617 00E486 C9 50 00                     	CMP		#'P'
   7618 00E489 D0 11                        	BNE		.0015
   7619 00E48B 20 00 E8                     	JSR		IgnoreBlanks
   7620 00E48E 20 11 ED                     	JSR		GetHexNumber
   7621 00E491 A5 0C                        	LDA		NumWorkArea
   7622 00E493 85 9C                        	STA		reg_sp
   7623 00E495 A5 0E                        	LDA		NumWorkArea+2
   7624 00E497 85 9E                        	STA		reg_sp+2
   7625 00E499 82 67 FF                     	BRL		.buildrec
   7626 00E49C                             .0015:
   7627 00E49C C9 52 00                     	CMP		#'R'
   7628 00E49F D0 FF FB FC                  	LBNE	Mon1
   7629 00E4A3 20 00 E8                     	JSR		IgnoreBlanks
   7630 00E4A6 20 11 ED                     	JSR		GetHexNumber
   7631 00E4A9 A5 0C                        	LDA		NumWorkArea
   7632 00E4AB 85 A0                        	STA		reg_sr
   7633 00E4AD 82 53 FF                     	BRL		.buildrec
   7634 00E4B0                             .0011:
   7635 00E4B0 C9 44 00                     	CMP		#'D'
   7636 00E4B3 D0 FF FC FF                  	LBNE	Mon14
   7637 00E4B7 20 6C E2                     	JSR		MonGetch
   7638 00E4BA C9 53 00                     	CMP		#'S'
   7639 00E4BD D0 11                        	BNE		.0012
   7640 00E4BF 20 00 E8                     	JSR		IgnoreBlanks
   7641 00E4C2 20 11 ED                     	JSR		GetHexNumber
   7642 00E4C5 A5 0C                        	LDA		NumWorkArea
   7643 00E4C7 85 84                        	STA		reg_ds
   7644 00E4C9 A5 0E                        	LDA		NumWorkArea+2
   7645 00E4CB 85 86                        	STA		reg_ds+2
   7646 00E4CD 82 33 FF                     	BRL		.buildrec
   7647 00E4D0                             .0012:
   7648 00E4D0 C9 42 00                     	CMP		#'B'
   7649 00E4D3 D0 0D                        	BNE		.0013
   7650 00E4D5 20 00 E8                     	JSR		IgnoreBlanks
   7651 00E4D8 20 11 ED                     	JSR		GetHexNumber
   7652 00E4DB A5 0C                        	LDA		NumWorkArea
   7653 00E4DD 85 A4                        	STA		reg_db
   7654 00E4DF 82 21 FF                     	BRL		.buildrec
   7655 00E4E2                             .0013:
   7656 00E4E2 C9 50 00                     	CMP		#'P'
   7657 00E4E5 D0 FF B5 FC                  	LBNE	Mon1
   7658 00E4E9 20 00 E8                     	JSR		IgnoreBlanks
   7659 00E4EC 20 11 ED                     	JSR		GetHexNumber
   7660 00E4EF A5 0C                        	LDA		NumWorkArea
   7661 00E4F1 85 A8                        	STA		reg_dp
   7662 00E4F3 82 0D FF                     	BRL		.buildrec
   7663 00E4F6                             .0014:
   7664 00E4F6 C9 4D 00                     	CMP		#'M'
   7665 00E4F9 D0 FF A1 FC                  	LBNE	Mon1
   7666 00E4FD 20 6C E2                     	JSR		MonGetch
   7667 00E500 C9 50 00                     	CMP		#'P'
   7668 00E503 D0 FF 97 FC                  	LBNE	Mon1
   7669 00E507 20 00 E8                     	JSR		IgnoreBlanks
   7670 00E50A 20 11 ED                     	JSR		GetHexNumber
   7671 00E50D A5 0C                        	LDA		NumWorkArea
   7672 00E50F 85 B0                        	STA		reg_mp
   7673 00E511 82 EF FE                     	BRL		.buildrec
                                           
   7675 00E514                             .0004:
   7676 00E514 CA                           	DEX
   7677 00E515 CA                           	DEX
                                           ;	JSR		IgnoreBlanks
   7679 00E516 20 11 ED                     	JSR		GetHexNumber
   7680 00E519 C0 00 00                     	CPY		#0
   7681 00E51C F0 FF 7E FC                  	LBEQ	Mon1
   7682 00E520 A5 0C                        	LDA		NumWorkArea
   7683 00E522 85 BE                        	STA		WorkTR
   7684 00E524 42 28 03 00                  	BSR		DispRegs
   7685 00E528 82 73 FC                     	BRL		Mon1
                                           
   7687 00E52B                             DispRegs:
   7688 00E52B F4 01 00                     	PEA		1
   7689 00E52E F4 82 F9                     	PEA		msgRegs
   7690 00E531 20 E5 EB                     	JSR		DisplayString
   7691 00E534 20 DD EC                     	JSR		space
                                           
   7693 00E537 A5 BE                        	LDA		WorkTR
   7694 00E539 0A                           	ASL
   7695 00E53A 0A                           	ASL
   7696 00E53B 0A                           	ASL
   7697 00E53C 0A                           	ASL
   7698 00E53D AA                           	TAX
                                           
   7700 00E53E A0 00 00                     	LDY		#0
   7701 00E541                             .0001:
   7702 00E541 42 4A                        	INF
   7703 00E543 E8                           	INX
   7704 00E544 99 80 00                     	STA		reg_cs,Y
   7705 00E547 42 EB                        	XBAW
   7706 00E549 99 82 00                     	STA		reg_cs+2,Y
   7707 00E54C 42 C8                        	INY4
   7708 00E54E C0 30 00                     	CPY		#48
   7709 00E551 D0 EE                        	BNE		.0001
                                           
                                           	; Display CS
   7712 00E553 A5 80                        	LDA		reg_cs
   7713 00E555 20 B6 EC                     	JSR		DispWord
   7714 00E558 A9 3A 00                     	LDA		#':'
   7715 00E55B 20 D6 EB                     	JSR		OutChar
                                           
                                           	; Display PB PC
   7718 00E55E A5 8E                        	LDA		reg_pc+2
   7719 00E560 20 BB EC                     	JSR		DispByte
   7720 00E563 A5 8C                        	LDA		reg_pc
   7721 00E565 20 B6 EC                     	JSR		DispWord
   7722 00E568 20 DD EC                     	JSR		space
                                           
                                           	; Display SRX,SR
   7725 00E56B A5 A0                        	LDA		reg_cs+32
   7726 00E56D A2 10 00                     	LDX		#16
   7727 00E570                             .0003:
   7728 00E570 0A                           	ASL
   7729 00E571 48                           	PHA
   7730 00E572 A9 30 00                     	LDA		#'0'
   7731 00E575 69 00 00                     	ADC		#0
   7732 00E578 20 C4 EC                     	JSR		DispNybble
   7733 00E57B 68                           	PLA
   7734 00E57C CA                           	DEX
   7735 00E57D D0 F1                        	BNE		.0003
   7736 00E57F 20 DD EC                     	JSR		space
                                           
   7738 00E582 A2 10 00                     	LDX		#16
   7739 00E585                             .0002
                                           	; display Acc,.X,.Y,.SP
   7741 00E585 B5 82                        	LDA		reg_cs+2,X
   7742 00E587 20 B6 EC                     	JSR		DispWord
   7743 00E58A B5 80                        	LDA		reg_cs,X
   7744 00E58C 20 B6 EC                     	JSR		DispWord
   7745 00E58F 20 DD EC                     	JSR		space
   7746 00E592 42 E8                        	INX4
   7747 00E594 E0 20 00                     	CPX		#32
   7748 00E597 D0 EC                        	BNE		.0002
                                           
   7750 00E599 F4 01 00                     	PEA		1
   7751 00E59C F4 DE F9                     	PEA		msgRegs2
   7752 00E59F 20 E5 EB                     	JSR		DisplayString
   7753 00E5A2 20 DD EC                     	JSR		space
                                           
                                           	; Display SS
   7756 00E5A5 A5 88                        	LDA		reg_ss
   7757 00E5A7 20 B6 EC                     	JSR		DispWord
   7758 00E5AA 20 DD EC                     	JSR		space
                                           
                                           	; Display DS
   7761 00E5AD A5 84                        	LDA		reg_ds
   7762 00E5AF 20 B6 EC                     	JSR		DispWord
   7763 00E5B2 20 DD EC                     	JSR		space
                                           
                                           	; Display DB
   7766 00E5B5 A5 A4                        	LDA		reg_db
   7767 00E5B7 20 BB EC                     	JSR		DispByte
   7768 00E5BA 20 DD EC                     	JSR		space
                                           
                                           	; Display DPR
   7771 00E5BD A5 A8                        	LDA		reg_dp
   7772 00E5BF 20 B6 EC                     	JSR		DispWord
   7773 00E5C2 20 DD EC                     	JSR		space
                                           
                                           	; Display back link
   7776 00E5C5 A5 AC                        	LDA		reg_bl
   7777 00E5C7 20 B6 EC                     	JSR		DispWord
                                           
                                           	; Display map number
   7780 00E5CA 20 DD EC                     	JSR		space
   7781 00E5CD A5 B0                        	LDA		reg_mp
   7782 00E5CF 20 BB EC                     	JSR		DispByte
                                           
   7784 00E5D2 20 CD EB                     	JSR		OutCRLF
   7785 00E5D5 60                           	RTS
                                           
                                           ; Build a startup record from the register values so that a context reg
                                           ; may be loaded
                                           
   7790 00E5D6                             BuildRec:
   7791 00E5D6 A5 80                        	LDA		reg_cs
   7792 00E5D8 8D 00 01                     	STA		ldtrec
   7793 00E5DB A5 84                        	LDA		reg_ds
   7794 00E5DD 8D 02 01                     	STA		ldtrec+2
   7795 00E5E0 A5 88                        	LDA		reg_ss
   7796 00E5E2 8D 04 01                     	STA		ldtrec+4
   7797 00E5E5 A5 8C                        	LDA		reg_pc
   7798 00E5E7 8D 06 01                     	STA		ldtrec+6
   7799 00E5EA A5 8E                        	LDA		reg_pc+2
   7800 00E5EC 29 FF 00                     	AND		#$FF
   7801 00E5EF E2 30                        	SEP		#$30		; 8 bit regs
                                           	MEM		8
   7803 00E5F1 EB                           	XBA
   7804 00E5F2 A5 90                        	LDA		reg_a
   7805 00E5F4 EB                           	XBA
   7806 00E5F5 C2 30                        	REP		#$30
                                           	MEM		16
   7808 00E5F7 8D 08 01                     	STA		ldtrec+8
   7809 00E5FA A5 91                        	LDA		reg_a+1
   7810 00E5FC 8D 0A 01                     	STA		ldtrec+10
   7811 00E5FF A5 93                        	LDA		reg_a+3
   7812 00E601 8D 0C 01                     	STA		ldtrec+12
   7813 00E604 A5 95                        	LDA		reg_x+1
   7814 00E606 8D 0E 01                     	STA		ldtrec+14
   7815 00E609 A5 97                        	LDA		reg_x+3
   7816 00E60B 8D 10 01                     	STA		ldtrec+16
   7817 00E60E A5 99                        	LDA		reg_y+1
   7818 00E610 8D 12 01                     	STA		ldtrec+18
   7819 00E613 A5 9B                        	LDA		reg_y+3
   7820 00E615 8D 14 01                     	STA		ldtrec+20
   7821 00E618 A5 9D                        	LDA		reg_sp+1
   7822 00E61A 8D 16 01                     	STA		ldtrec+22
   7823 00E61D A5 9F                        	LDA		reg_sp+3
   7824 00E61F 8D 18 01                     	STA		ldtrec+24
   7825 00E622 E2 30                        	SEP		#$30
   7826 00E624 A5 A1                        	LDA		reg_sr+1
   7827 00E626 8D 1A 01                     	STA		ldtrec+26
   7828 00E629 A5 A4                        	LDA		reg_db
   7829 00E62B 8D 1B 01                     	STA		ldtrec+27
   7830 00E62E A5 A8                        	LDA		reg_dp
   7831 00E630 8D 1C 01                     	STA		ldtrec+28
   7832 00E633 A5 A9                        	LDA		reg_dp+1
   7833 00E635 8D 1D 01                     	STA		ldtrec+29
   7834 00E638 A5 B0                        	LDA		reg_mp
   7835 00E63A 8D 1E 01                     	STA		ldtrec+30
   7836 00E63D 9C 1F 01                     	STZ		ldtrec+31
   7837 00E640 C2 30                        	REP		#$30
   7838 00E642 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Dump memory.
                                           ;------------------------------------------------------------------------------
                                           
   7844 00E643                             doMemoryDump:
   7845 00E643 20 00 E8                     	JSR		IgnoreBlanks
   7846 00E646 20 E6 EC                     	JSR		GetRange
   7847 00E649 20 CD EB                     	JSR		OutCRLF
   7848 00E64C                             .0007:
   7849 00E64C A9 3E 00                     	LDA		#'>'
   7850 00E64F 20 D6 EB                     	JSR		OutChar
   7851 00E652 20 F0 E7                     	JSR		DispRangeStart
   7852 00E655 A0 00 00                     	LDY		#0
   7853 00E658                             .0001:
   7854 00E658 42 B7 20                     	LDA		{RangeStart},Y
   7855 00E65B 20 BB EC                     	JSR		DispByte
   7856 00E65E A9 20 00                     	LDA		#' '
   7857 00E661 20 D6 EB                     	JSR		OutChar
   7858 00E664 C8                           	INY
   7859 00E665 C0 08 00                     	CPY		#8
   7860 00E668 D0 EE                        	BNE		.0001
   7861 00E66A A0 00 00                     	LDY 	#0
   7862 00E66D                             .0005:
   7863 00E66D 42 B7 20                     	LDA		{RangeStart},Y
   7864 00E670 29 FF 00                     	AND		#$FF
   7865 00E673 C9 20 00                     	CMP		#' '
   7866 00E676 B0 05                        	BCS		.0002
   7867 00E678                             .0004:
   7868 00E678 A9 2E 00                     	LDA		#'.'
   7869 00E67B 80 05                        	BRA		.0003
   7870 00E67D                             .0002:
   7871 00E67D C9 7F 00                     	CMP		#$7f
   7872 00E680 B0 F6                        	BCS		.0004
   7873 00E682                             .0003:
   7874 00E682 20 D6 EB                     	JSR		OutChar
   7875 00E685 C8                           	INY
   7876 00E686 C0 08 00                     	CPY		#8
   7877 00E689 D0 E2                        	BNE		.0005
   7878 00E68B 20 CD EB                     	JSR		OutCRLF
   7879 00E68E 18                           	CLC
   7880 00E68F A5 20                        	LDA		RangeStart
   7881 00E691 69 08 00                     	ADC		#8
   7882 00E694 85 20                        	STA		RangeStart
   7883 00E696 90 02                        	BCC		.0006
   7884 00E698 E6 22                        	INC		RangeStart+2
   7885 00E69A                             .0006:
   7886 00E69A 38                           	SEC
   7887 00E69B A5 24                        	LDA		RangeEnd
   7888 00E69D E5 20                        	SBC		RangeStart
   7889 00E69F A5 26                        	LDA		RangeEnd+2
   7890 00E6A1 E5 22                        	SBC		RangeStart+2
   7891 00E6A3 08                           	PHP
   7892 00E6A4 20 30 EF                     	JSR		KeybdGetCharNoWait;Ctx,7
   7893 00E6A7 29 FF 00                     	AND		#$FF
   7894 00E6AA C9 03 00                     	CMP		#CTRLC
   7895 00E6AD F0 04                        	BEQ		.0009
   7896 00E6AF 28                           	PLP
   7897 00E6B0 10 9A                        	BPL		.0007
   7898 00E6B2                             .0008:
   7899 00E6B2 60                           	RTS
   7900 00E6B3                             .0009:
   7901 00E6B3 28                           	PLP
   7902 00E6B4 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Edit memory.
                                           ; ><memory address> <val1> <val2> ... <val8>
                                           ;------------------------------------------------------------------------------
                                           
   7909 00E6B5                             doMemoryEdit:
   7910 00E6B5 20 00 E8                     	JSR		IgnoreBlanks
   7911 00E6B8 20 11 ED                     	JSR		GetHexNumber
   7912 00E6BB C0 00 00                     	CPY		#0
   7913 00E6BE F0 FF DC FA                  	LBEQ	Mon1
   7914 00E6C2 A5 0C                        	LDA		NumWorkArea
   7915 00E6C4 85 20                        	STA		RangeStart
   7916 00E6C6 A5 0E                        	LDA		NumWorkArea+2
   7917 00E6C8 85 22                        	STA		RangeStart+2
   7918 00E6CA A0 00 00                     	LDY		#0
   7919 00E6CD                             .0001:
   7920 00E6CD 5A                           	PHY
   7921 00E6CE 20 00 E8                     	JSR		IgnoreBlanks
   7922 00E6D1 20 11 ED                     	JSR		GetHexNumber
   7923 00E6D4 C0 00 00                     	CPY		#0
   7924 00E6D7 F0 13                        	BEQ		.0002
   7925 00E6D9 7A                           	PLY
   7926 00E6DA E2 20                        	SEP		#$20
   7927 00E6DC A5 0C                        	LDA		NumWorkArea
   7928 00E6DE 42 97 20                     	STA		{RangeStart},Y
   7929 00E6E1 C2 20                        	REP		#$20
   7930 00E6E3 C8                           	INY
   7931 00E6E4 C0 08 00                     	CPY		#8
   7932 00E6E7 D0 E4                        	BNE		.0001
   7933 00E6E9 82 B2 FA                     	BRL		Mon1
   7934 00E6EC                             .0002:
   7935 00E6EC 7A                           	PLY
   7936 00E6ED 82 AE FA                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Fill memory.
                                           ; $F <start address> <end address> <val1>
                                           ;------------------------------------------------------------------------------
                                           
   7943 00E6F0                             doFill:
   7944 00E6F0 20 00 E8                     	JSR		IgnoreBlanks
   7945 00E6F3 20 11 ED                     	JSR		GetHexNumber
   7946 00E6F6 C0 00 00                     	CPY		#0
   7947 00E6F9 F0 FF 80 FB                  	LBEQ	MonErr
   7948 00E6FD A5 0C                        	LDA		NumWorkArea
   7949 00E6FF 85 20                        	STA		RangeStart
   7950 00E701 A5 0E                        	LDA		NumWorkArea+2
   7951 00E703 85 22                        	STA		RangeStart+2
   7952 00E705 20 00 E8                     	JSR		IgnoreBlanks
   7953 00E708 20 11 ED                     	JSR		GetHexNumber
   7954 00E70B C0 00 00                     	CPY		#0
   7955 00E70E F0 FF 6B FB                  	LBEQ	MonErr
   7956 00E712 A5 0C                        	LDA		NumWorkArea
   7957 00E714 85 24                        	STA		RangeEnd
   7958 00E716 A5 0E                        	LDA		NumWorkArea+2
   7959 00E718 85 26                        	STA		RangeEnd+2
   7960 00E71A 20 00 E8                     	JSR		IgnoreBlanks
   7961 00E71D 20 11 ED                     	JSR		GetHexNumber
   7962 00E720 C0 00 00                     	CPY		#0
   7963 00E723 F0 FF 56 FB                  	LBEQ	MonErr
   7964 00E727 A6 0C                        	LDX		NumWorkArea
                                           	; Process in 32 bit mode
   7966 00E729 42 E2 00 02                  	SEP		#$200
   7967 00E72D 42 C2 00 01                  	REP		#$100
   7968 00E731 A5 24                        	LDA		RangeEnd
   7969 00E733 38                           	SEC
   7970 00E734 E5 20                        	SBC		RangeStart
   7971 00E736 A4 20                        	LDY		RangeStart
   7972 00E738 42 44 00                     	FIL		$00
                                           	; Back to 16 bits mode
   7974 00E73B 42 C2 00 02                  	REP		#$200
   7975 00E73F 42 E2 00 01                  	SEP		#$100
   7976 00E743 82 58 FA                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Disassemble code
                                           ;------------------------------------------------------------------------------
                                           
   7982 00E746                             doDisassemble:
   7983 00E746 20 6C E2                     	JSR		MonGetch
   7984 00E749 C9 4D 00                     	CMP		#'M'
   7985 00E74C F0 11                        	BEQ		.0002
   7986 00E74E                             .0004:
   7987 00E74E C9 4E 00                     	CMP		#'N'
   7988 00E751 D0 1B                        	BNE		.0003
   7989 00E753 E2 20                        	SEP		#$20
                                           	MEM		8
   7991 00E755 A5 BC                        	LDA		$BC
   7992 00E757 09 40                        	ORA		#$40
   7993 00E759 85 BC                        	STA		$BC
   7994 00E75B C2 20                        	REP		#$20
   7995 00E75D 80 11                        	BRA		.0005
   7996 00E75F                             .0002:
   7997 00E75F E2 20                        	SEP		#$20
   7998 00E761 A5 BC                        	LDA		$BC
   7999 00E763 09 80                        	ORA		#$80
   8000 00E765 85 BC                        	STA		$BC
   8001 00E767 C2 20                        	REP		#$20
   8002 00E769 20 6C E2                     	JSR		MonGetch
   8003 00E76C 80 E0                        	BRA		.0004
                                           	MEM		16
   8005 00E76E                             .0003:
   8006 00E76E CA                           	DEX
   8007 00E76F CA                           	DEX
   8008 00E770                             .0005:
   8009 00E770 20 00 E8                     	JSR		IgnoreBlanks
   8010 00E773 20 E6 EC                     	JSR		GetRange
   8011 00E776 A5 20                        	LDA		RangeStart
   8012 00E778 85 8F                        	STA		$8F				; addra
   8013 00E77A A5 21                        	LDA		RangeStart+1
   8014 00E77C 85 90                        	STA		$90
   8015 00E77E 20 CD EB                     	JSR		OutCRLF
   8016 00E781 A0 14 00                     	LDY		#20
   8017 00E784                             .0001:
   8018 00E784 5A                           	PHY
   8019 00E785 E2 30                        	SEP		#$30
   8020 00E787 20 59 C6                     	JSR		dpycod
   8021 00E78A C2 30                        	REP		#$30
   8022 00E78C 20 CD EB                     	JSR		OutCRLF
   8023 00E78F 7A                           	PLY
   8024 00E790 88                           	DEY
   8025 00E791 D0 F1                        	BNE		.0001
   8026 00E793 4C 9E E1                     	JMP		Mon1
                                           
                                           ;$BC flimflag
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Jump to subroutine
                                           ;
                                           ; Either JSR for 16 bit address or JSL for 24 bit address
                                           ;------------------------------------------------------------------------------
                                           
   8036 00E796                             doJump:
   8037 00E796 20 6C E2                     	JSR		MonGetch
   8038 00E799 C9 53 00                     	CMP		#'S'
   8039 00E79C D0 FF FE F9                  	LBNE	Mon1
   8040 00E7A0 20 6C E2                     	JSR		MonGetch
   8041 00E7A3 C9 52 00                     	CMP		#'R'
   8042 00E7A6 D0 1A                        	BNE		.testL
   8043 00E7A8 20 00 E8                     	JSR		IgnoreBlanks
   8044 00E7AB 20 11 ED                     	JSR		GetHexNumber
   8045 00E7AE C0 00 00                     	CPY		#0
   8046 00E7B1 F0 FF E9 F9                  	LBEQ	Mon1
   8047 00E7B5 A5 0C                        	LDA		NumWorkArea
   8048 00E7B7 85 24                        	STA		RangeEnd
   8049 00E7B9 A2 00 00                     	LDX		#0
   8050 00E7BC FC 24 00                     	JSR		(RangeEnd,X)
   8051 00E7BF 82 DC F9                     	BRL		Mon1
   8052 00E7C2                             .testL:
   8053 00E7C2 C9 4C 00                     	CMP		#'L'
   8054 00E7C5 D0 FF D5 F9                  	LBNE	Mon1
   8055 00E7C9 20 00 E8                     	JSR		IgnoreBlanks
   8056 00E7CC 20 11 ED                     	JSR		GetHexNumber
   8057 00E7CF C0 00 00                     	CPY		#0
   8058 00E7D2 F0 FF C8 F9                  	LBEQ	Mon1
   8059 00E7D6 A9 5C 00                     	LDA		#$5C			; JML opcode
   8060 00E7D9 85 23                        	STA		RangeEnd-1
   8061 00E7DB A5 0C                        	LDA		NumWorkArea
   8062 00E7DD 85 24                        	STA		RangeEnd
   8063 00E7DF A5 0D                        	LDA		NumWorkArea+1
   8064 00E7E1 85 25                        	STA		RangeEnd+1
   8065 00E7E3 A9 24 00                     	LDA		#RangeEnd
   8066 00E7E6 42 E0 01                     	CACHE	#1				; 1= invalidate instruction line identified by accumulator
   8067 00E7E9 22 24 00 00                  	JSL		RangeEnd
   8068 00E7ED 82 AE F9                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   8072 00E7F0                             DispRangeStart:
   8073 00E7F0 A5 21                        	LDA		RangeStart+1
   8074 00E7F2 20 B6 EC                     	JSR		DispWord
   8075 00E7F5 A5 20                        	LDA		RangeStart
   8076 00E7F7 20 BB EC                     	JSR		DispByte
   8077 00E7FA A9 20 00                     	LDA		#' '
   8078 00E7FD 4C D6 EB                     	JMP		OutChar
                                           	
                                           ; Skip over blanks in the input
                                           ;------------------------------------------------------------------------------
                                           
   8083 00E800                             IgnoreBlanks:
   8084 00E800                             .0001:
   8085 00E800 20 6C E2                     	JSR		MonGetch
   8086 00E803 C9 20 00                     	CMP		#' '
   8087 00E806 F0 F8                        	BEQ		.0001
   8088 00E808 CA                           	DEX
   8089 00E809 CA                           	DEX
   8090 00E80A 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; BIOSInput allows full screen editing of text until a carriage return is keyed
                                           ; at which point the line the cursor is on is copied to a buffer. The buffer
                                           ; must be at least TEXTCOLS characters in size.
                                           ;------------------------------------------------------------------------------
                                           ;
   8098 00E80B                             BIOSInput:
   8099 00E80B                             .bin1:
   8100 00E80B 20 4A EF                     	JSR		KeybdGetCharWait
   8101 00E80E 29 FF 00                     	AND		#$FF
   8102 00E811 C9 0D 00                     	CMP		#CR
   8103 00E814 F0 05                        	BEQ		.bin2
   8104 00E816 20 D6 EB                     	JSR		OutChar
   8105 00E819 80 F0                        	BRA		.bin1
   8106 00E81B                             .bin2:
   8107 00E81B A5 30                        	LDA		CursorX
   8108 00E81D F0 1E                        	BEQ		.bin4
   8109 00E81F A5 34                        	LDA		VideoPos	; get current video position
   8110 00E821 38                           	SEC
   8111 00E822 E5 30                        	SBC		CursorX		; go back to the start of the line
   8112 00E824 0A                           	ASL
   8113 00E825 AA                           	TAX
   8114 00E826                             .bin3:
   8115 00E826 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   8116 00E82E 29 FF 00                     	AND		#$FF
   8117 00E831 93 03                        	STA		(3,s),Y
   8118 00E833 E8                           	INX
   8119 00E834 E8                           	INX
   8120 00E835 C8                           	INY
   8121 00E836 C6 30                        	DEC		CursorX
   8122 00E838 D0 EC                        	BNE		.bin3
   8123 00E83A A9 00 00                     	LDA		#0
   8124 00E83D                             .bin4:
   8125 00E83D 93 03                        	STA		(3,s),Y	; NULL terminate buffer
   8126 00E83F 60                           	RTS
                                           
   8128 00E840                             .st0003:
   8129 00E840 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD
                                         
   8130 00E848 10 F6                        	BPL		.st0003
   8131 00E84A 48                           	PHA						; save off the char (we need to trash acc)
   8132 00E84B 42 3B FF 0F AF 14 A1 0E      	LDA		$FFF:KEYBD+4	; clear keyboard strobe (must be a read operation)
                                         
   8133 00E853 68                           	PLA						; restore char
   8134 00E854 20 E4 E9                     	JSR		DisplayChar
   8135 00E857 80 E7                        	BRA		.st0003
   8136 00E859 A0 00 00                     	ldy		#$0000
   8137 00E85C                             .st0001:
   8138 00E85C A2 00 00                     	ldx		#$0000
   8139 00E85F                             .st0002:
   8140 00E85F E8                           	inx
   8141 00E860 D0 FD                        	bne		.st0002
   8142 00E862 20 85 E8                     	jsr		echo_switch
   8143 00E865 C8                           	iny
   8144 00E866 80 F4                        	bra		.st0001
                                           
   8146 00E868                             msgStarting:
   8147 00E868 46 54 38 33 32 20 54 65      	.byte	"FT832 Test System Starting",CR,LF,0
   8147 00E870 73 74 20 53 79 73 74 65    
   8147 00E878 6D 20 53 74 61 72 74 69    
   8147 00E880 6E 67 0D 0A 00             
                                           
   8149 00E885                             echo_switch:
   8150 00E885 AD 00 71                     	lda		$7100
   8151 00E888 8D 00 70                     	sta		$7000
   8152 00E88B 60                           	rts
                                           
                                           ;------------------------------------------------------------------------------
                                           ; On entry to the SSM task the .A register will be set to the task number
                                           ; being single stepped. The .X register will contain the address of the
                                           ; next instruction to execute.
                                           ;------------------------------------------------------------------------------
                                           
   8160 00E88C                             SSMInit:
                                           	; setup SSM data segment in SDT
   8162 00E88C A0 06 00                     	LDY		#6
   8163 00E88F A9 01 00                     	LDA		#1
   8164 00E892 42 EB                        	XBAW
   8165 00E894 A9 00 00                     	LDA		#$0000
   8166 00E897 A2 82 08                     	LDX		#$882		; 1k data
   8167 00E89A 42 BA                        	SDU
                                           	; Setup SSM stack segment in SDT
   8169 00E89C C8                           	INY
   8170 00E89D A9 00 04                     	LDA		#$0400
   8171 00E8A0 A2 82 08                     	LDX		#$882		; 1k stack
   8172 00E8A3 42 BA                        	SDU
                                           	; Setup SSM code segment in SDT
   8174 00E8A5 C8                           	INY
   8175 00E8A6 A9 00 00                     	LDA		#$0000
   8176 00E8A9 42 EB                        	XBAW
   8177 00E8AB A9 00 00                     	LDA		#$0000
   8178 00E8AE A2 05 09                     	LDX		#$905
   8179 00E8B1 42 BA                        	SDU
   8180 00E8B3 42 5C BA E8 00 08 00         	JMF		8:.0001
   8181 00E8BA                             .0001:
                                           	; Initialize data selector and stack selector, pointer
                                           	; The stack is begin switched from the one currently defined by
                                           	; by the task table. So the return task needs to be popped off
                                           	; the current stack and placed on the new one.
   8186 00E8BA FA                           	PLX					; get the task to return to
   8187 00E8BB A9 07 00                     	LDA		#7
   8188 00E8BE 78                           	SEI
   8189 00E8BF 42 5A                        	TASS
   8190 00E8C1 A9 FF 03                     	LDA		#$3FF		; setup stack pointer
   8191 00E8C4 1B                           	TAS
   8192 00E8C5 58                           	CLI
   8193 00E8C6 DA                           	PHX					; save return task on new stack
   8194 00E8C7 F4 06 00                     	PEA		6
   8195 00E8CA 42 2B                        	PLDS
                                           
   8197 00E8CC A9 00 61                     	LDA		#$6100
   8198 00E8CF 85 36                        	STA		NormAttr
   8199 00E8D1 A9 FF 0F                     	LDA		#4095		; set segment
   8200 00E8D4 85 44                        	STA		Vidptr+4
   8201 00E8D6 85 4A                        	STA		Vidregs+4
   8202 00E8D8 A9 0B 00                     	LDA		#$000B		; screen location is $FB0000
   8203 00E8DB 85 42                        	STA		Vidptr+2
   8204 00E8DD 64 40                        	STZ		Vidptr
   8205 00E8DF A9 0E 00                     	LDA		#$000E		; regset is at $FEA010
   8206 00E8E2 85 48                        	STA		Vidregs+2
   8207 00E8E4 A9 10 A0                     	LDA		#$A010
   8208 00E8E7 85 46                        	STA		Vidregs
   8209 00E8E9 A0 07 00                     	LDY		#7
   8210 00E8EC A9 10 00                     	LDA		#$10		; divide by 2 vertically, 1 horizontally
   8211 00E8EF 20 2F EC                     	JSR		SetVideoReg
   8212 00E8F2 A9 B4 00                     	LDA		#180		; set window left position 672
   8213 00E8F5 A0 02 00                     	LDY		#2
   8214 00E8F8 20 2F EC                     	JSR		SetVideoReg
   8215 00E8FB A9 02 00                     	LDA		#2
   8216 00E8FE A0 03 00                     	LDY		#3
   8217 00E901 20 2F EC                     	JSR		SetVideoReg
   8218 00E904 A9 20 00                     	LDA		#32			; set window top position
   8219 00E907 A0 04 00                     	LDY		#4
   8220 00E90A 20 2F EC                     	JSR		SetVideoReg
   8221 00E90D 20 14 EC                     	JSR		GetTextRowsCols
   8222 00E910 A9 E4 E9                     	LDA		#DisplayChar
   8223 00E913 8D F0 03                     	STA		OutputVec
   8224 00E916 20 59 EC                     	JSR		ClearScreen
   8225 00E919 20 A9 EB                     	JSR		HomeCursor
   8226 00E91C F4 08 00                     	PEA		8
   8227 00E91F F4 9A E9                     	PEA		msgSSM
   8228 00E922 20 E5 EB                     	JSR		DisplayString
   8229 00E925 42 60                        	RTT
   8230 00E927                             SSMTask:
   8231 00E927 85 BE                        	STA		WorkTR
   8232 00E929 20 2B E5                     	JSR		DispRegs
   8233 00E92C                             .0004:
   8234 00E92C A9 53 00                     	LDA		#'S'
   8235 00E92F 20 D6 EB                     	JSR		OutChar
   8236 00E932 A9 53 00                     	LDA		#'S'
   8237 00E935 20 D6 EB                     	JSR		OutChar
   8238 00E938 A9 4D 00                     	LDA		#'M'
   8239 00E93B 20 D6 EB                     	JSR		OutChar
   8240 00E93E A9 3E 00                     	LDA		#'>'
   8241 00E941                             .0005:
   8242 00E941 20 D6 EB                     	JSR		OutChar
   8243 00E944                             .0008:
   8244 00E944 20 4A EF                     	JSR		KeybdGetCharWait
   8245 00E947 B0 FB                        	BCS		.0008
   8246 00E949 29 FF 00                     	AND		#$FF
   8247 00E94C C9 53 00                     	CMP		#'S'		; step
   8248 00E94F D0 04                        	BNE		.0001
   8249 00E951                             .0002:
   8250 00E951 42 60                        	RTT
   8251 00E953 80 D2                        	BRA		SSMTask
   8252 00E955                             .0001:
   8253 00E955 C9 58 00                     	CMP		#'X'
   8254 00E958 D0 16                        	BNE		.0006
   8255 00E95A A5 A0                        	LDA		reg_sr
   8256 00E95C 29 FF EF                     	AND		#$EFFF
   8257 00E95F 85 A0                        	STA		reg_sr
   8258 00E961 20 D6 E5                     	JSR		BuildRec
   8259 00E964 A6 BE                        	LDX		WorkTR
   8260 00E966 42 6C 00 01 00 00            	LDT		ldtrec
   8261 00E96C 42 60                        	RTT
   8262 00E96E 80 B7                        	BRA		SSMTask
   8263 00E970                             .0006:
   8264 00E970 C9 0D 00                     	CMP		#CR
   8265 00E973 D0 CC                        	BNE		.0005
   8266 00E975 A5 32                        	LDA		CursorY
   8267 00E977 0A                           	ASL
   8268 00E978 AA                           	TAX
   8269 00E979 42 1B BD 04 F8               	LDA		CS:LineTbl,X
   8270 00E97E 18                           	CLC
   8271 00E97F 69 04 00                     	ADC		#4
   8272 00E982 0A                           	ASL
   8273 00E983 AA                           	TAX
   8274 00E984 20 00 E8                     	JSR		IgnoreBlanks
   8275 00E987 20 6C E2                     	JSR		MonGetch
   8276 00E98A C9 4D 00                     	CMP		#'M'
   8277 00E98D D0 03                        	BNE		.0007
   8278 00E98F 20 43 E6                     	JSR		doMemoryDump
   8279 00E992                             .0007:
   8280 00E992 82 AC FF                     	BRL		.0005
   8281 00E995 42 60                        	RTT
   8282 00E997 82 8D FF                     	BRL		SSMTask
                                           
   8284 00E99A                             msgSSM:
   8285 00E99A 53 69 6E 67 6C 65 20 73      	.byte	"Single step mode task starting.",CR,LF,0
   8285 00E9A2 74 65 70 20 6D 6F 64 65    
   8285 00E9AA 20 74 61 73 6B 20 73 74    
   8285 00E9B2 61 72 74 69 6E 67 2E 0D    
   8285 00E9BA 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert Ascii character to screen character.
                                           ;------------------------------------------------------------------------------
                                           
   8291 00E9BC                             AsciiToScreen:
   8292 00E9BC 29 FF 00                     	AND		#$FF
   8293 00E9BF 89 20 00                     	BIT		#%00100000	; if bit 5 isn't set
   8294 00E9C2 F0 08                        	BEQ		.00001
   8295 00E9C4 89 40 00                     	BIT		#%01000000	; or bit 6 isn't set
   8296 00E9C7 F0 03                        	BEQ		.00001
   8297 00E9C9 29 9F 00                     	AND		#%10011111
   8298 00E9CC                             .00001:
   8299 00E9CC 60                           	rts
                                           
                                           	MEM		8
   8302 00E9CD                             AsciiToScreen8:
   8303 00E9CD 89 20                        	BIT		#%00100000	; if bit 5 isn't set
   8304 00E9CF F0 06                        	BEQ		.00001
   8305 00E9D1 89 40                        	BIT		#%01000000	; or bit 6 isn't set
   8306 00E9D3 F0 02                        	BEQ		.00001
   8307 00E9D5 29 9F                        	AND		#%10011111
   8308 00E9D7                             .00001:
   8309 00E9D7 60                           	rts
                                           
                                           	MEM		16
                                           ;------------------------------------------------------------------------------
                                           ; Convert screen character to ascii character
                                           ;------------------------------------------------------------------------------
                                           ;
   8316 00E9D8                             ScreenToAscii:
   8317 00E9D8 29 FF 00                     	AND		#$FF
   8318 00E9DB C9 1B 00                     	CMP		#26+1
   8319 00E9DE B0 03                        	BCS		.0001
   8320 00E9E0 69 60 00                     	ADC		#$60
   8321 00E9E3                             .0001:
   8322 00E9E3 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display a character on the screen device
                                           ; Expects the processor to be in 16 bit mode with 16 bit acc and 16 bit indexes
                                           ;------------------------------------------------------------------------------
                                           ;
   8329 00E9E4                             DisplayChar:
   8330 00E9E4 29 FF 00                     	AND		#$0FF
   8331 00E9E7 24 3C                        	BIT		EscState		; check if processing escape sequence
   8332 00E9E9 30 FF 89 00                  	LBMI	processEsc
   8333 00E9ED C9 08 00                     	CMP		#BS
   8334 00E9F0 F0 FF 33 01                  	LBEQ	doBackSpace
   8335 00E9F4 C9 91 00                     	CMP		#$91			; cursor right
   8336 00E9F7 F0 FF 89 01                  	LBEQ	doCursorRight
   8337 00E9FB C9 93 00                     	CMP		#$93			; cursor left
   8338 00E9FE F0 FF 8D 01                  	LBEQ	doCursorLeft
   8339 00EA02 C9 90 00                     	CMP		#$90			; cursor up
   8340 00EA05 F0 FF 8D 01                  	LBEQ	doCursorUp
   8341 00EA09 C9 92 00                     	CMP		#$92			; cursor down
   8342 00EA0C F0 FF 8D 01                  	LBEQ	doCursorDown
   8343 00EA10 C9 99 00                     	CMP		#$99			; delete
   8344 00EA13 F0 FF 3B 01                  	LBEQ	doDelete
   8345 00EA17 C9 0D 00                     	CMP		#CR
   8346 00EA1A F0 47                        	BEQ		doCR
   8347 00EA1C C9 0A 00                     	CMP		#LF
   8348 00EA1F F0 47                        	BEQ		doLF
   8349 00EA21 C9 94 00                     	CMP		#$94
   8350 00EA24 F0 FF 54 01                  	LBEQ	doCursorHome	; cursor home
   8351 00EA28 C9 1B 00                     	CMP		#ESC
   8352 00EA2B D0 05                        	BNE		.0003
   8353 00EA2D 64 3C                        	STZ		EscState		; put a -1 in the escape state
   8354 00EA2F C6 3C                        	DEC		EscState
   8355 00EA31 60                           	RTS
   8356 00EA32                             .0003:
   8357 00EA32 20 BC E9                     	JSR		AsciiToScreen
   8358 00EA35 05 36                        	ORA		NormAttr
   8359 00EA37 48                           	PHA
   8360 00EA38 A5 34                        	LDA		VideoPos
   8361 00EA3A 0A                           	ASL
   8362 00EA3B A8                           	TAY
   8363 00EA3C 68                           	PLA
   8364 00EA3D 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8365 00EA42 A5 30                        	LDA		CursorX
   8366 00EA44 1A                           	INA
   8367 00EA45 C5 4C                        	CMP		Textcols
   8368 00EA47 D0 15                        	BNE		.0001
   8369 00EA49 64 30                        	STZ		CursorX
   8370 00EA4B A5 32                        	LDA		CursorY
   8371 00EA4D 1A                           	INA
   8372 00EA4E C5 4E                        	CMP		Textrows
   8373 00EA50 F0 05                        	BEQ		.0002
   8374 00EA52 85 32                        	STA		CursorY
   8375 00EA54 82 59 01                     	BRL		SyncVideoPos
   8376 00EA57                             .0002:
   8377 00EA57 3A                           	DEA
   8378 00EA58 20 B0 EB                     	JSR		SyncVideoPos
   8379 00EA5B 82 14 02                     	BRL		ScrollUp
   8380 00EA5E                             .0001:
   8381 00EA5E 85 30                        	STA		CursorX
   8382 00EA60 82 4D 01                     	BRL		SyncVideoPos
   8383 00EA63                             doCR:
   8384 00EA63 64 30                        	STZ		CursorX
   8385 00EA65 82 48 01                     	BRL		SyncVideoPos
   8386 00EA68                             doLF:
   8387 00EA68 A5 32                        	LDA		CursorY
   8388 00EA6A 1A                           	INA
   8389 00EA6B C5 4E                        	CMP		Textrows
   8390 00EA6D 10 FF 01 02                  	LBPL	ScrollUp
   8391 00EA71 85 32                        	STA		CursorY
   8392 00EA73 82 3A 01                     	BRL		SyncVideoPos
                                           
                                           ; Process escape sequences for WYSE terminal emulation
                                           ; Handles:
                                           ; {esc}T		- clear to end of line
                                           ; {esc}W		- delete character
                                           ; {esc}`1		- cursor on
                                           ; {esc}`0		- cursor off
                                           ; {esc}({esc}G4	- reverse video
                                           ; {esc}({esc}G0	- normal video
                                           ;
                                           ; EscState
                                           ; -1 = first esc char
                                           ; -2 = second esc char
                                           ; ...
                                           ;
   8408 00EA76                             processEsc:
   8409 00EA76 A6 3C                        	LDX		EscState
   8410 00EA78 E0 FF FF                     	CPX		#-1
   8411 00EA7B D0 45                        	BNE		.0006
   8412 00EA7D C9 54 00                     	CMP		#'T'	; clear to EOL
   8413 00EA80 D0 1D                        	BNE		.0003
   8414 00EA82 A5 34                        	LDA		VideoPos
   8415 00EA84 0A                           	ASL
   8416 00EA85 A8                           	TAY
   8417 00EA86 A6 30                        	LDX		CursorX
   8418 00EA88 E8                           	INX
   8419 00EA89                             .0001:
   8420 00EA89 E4 4C                        	CPX		Textcols
   8421 00EA8B 10 0F                        	BPL		.0002
   8422 00EA8D A9 20 00                     	LDA		#' '
   8423 00EA90 05 36                        	ORA		NormAttr
   8424 00EA92 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8425 00EA97 E8                           	INX
   8426 00EA98 C8                           	INY
   8427 00EA99 C8                           	INY
   8428 00EA9A D0 ED                        	BNE		.0001
   8429 00EA9C                             .0002:
   8430 00EA9C 64 3C                        	STZ		EscState
   8431 00EA9E 60                           	RTS
   8432 00EA9F                             .0003:
   8433 00EA9F C9 57 00                     	CMP		#'W'
   8434 00EAA2 D0 05                        	BNE		.0004
   8435 00EAA4 64 3C                        	STZ		EscState
   8436 00EAA6 82 A9 00                     	BRL		doDelete
   8437 00EAA9                             .0004:
   8438 00EAA9 C9 60 00                     	CMP		#'`'
   8439 00EAAC D0 06                        	BNE		.0005
   8440 00EAAE A9 FE FF                     	LDA		#-2
   8441 00EAB1 85 3C                        	STA		EscState
   8442 00EAB3 60                           	RTS
   8443 00EAB4                             .0005:
   8444 00EAB4 C9 28 00                     	CMP		#'('
   8445 00EAB7 D0 06                        	BNE		.0008
   8446 00EAB9 A9 FD FF                     	LDA		#-3
   8447 00EABC 85 3C                        	STA		EscState
   8448 00EABE 60                           	RTS
   8449 00EABF                             .0008:
   8450 00EABF 64 3C                        	STZ		EscState
   8451 00EAC1 60                           	RTS
   8452 00EAC2                             .0006:
   8453 00EAC2 E0 FE FF                     	CPX		#-2
   8454 00EAC5 D0 11                        	BNE		.0007
   8455 00EAC7 64 3C                        	STZ		EscState
   8456 00EAC9 C9 31 00                     	CMP		#'1'
   8457 00EACC F0 FF 69 01                  	LBEQ	CursorOn
   8458 00EAD0 C9 30 00                     	CMP		#'0'
   8459 00EAD3 F0 FF 72 01                  	LBEQ	CursorOff
   8460 00EAD7 60                           	RTS
   8461 00EAD8                             .0007:
   8462 00EAD8 E0 FD FF                     	CPX		#-3
   8463 00EADB D0 0B                        	BNE		.0009
   8464 00EADD C9 1B 00                     	CMP		#ESC
   8465 00EAE0 D0 DD                        	BNE		.0008
   8466 00EAE2 A9 FC FF                     	LDA		#-4
   8467 00EAE5 85 3C                        	STA		EscState
   8468 00EAE7 60                           	RTS
   8469 00EAE8                             .0009:
   8470 00EAE8 E0 FC FF                     	CPX		#-4
   8471 00EAEB D0 0B                        	BNE		.0010
   8472 00EAED C9 47 00                     	CMP		#'G'
   8473 00EAF0 D0 CD                        	BNE		.0008
   8474 00EAF2 A9 FB FF                     	LDA		#-5
   8475 00EAF5 85 3C                        	STA		EscState
   8476 00EAF7 60                           	RTS
   8477 00EAF8                             .0010:
   8478 00EAF8 E0 FB FF                     	CPX		#-5
   8479 00EAFB D0 C2                        	BNE		.0008
   8480 00EAFD 64 3C                        	STZ		EscState
   8481 00EAFF C9 34 00                     	CMP		#'4'
   8482 00EB02 D0 12                        	BNE		.0011
   8483 00EB04 A5 36                        	LDA		NormAttr
                                           	; Swap the high nybbles of the attribute
   8485 00EB06 EB                           	XBA				
   8486 00EB07 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
   8489 00EB09 2A                           	ROL
   8490 00EB0A 2A                           	ROL
   8491 00EB0B 2A                           	ROL
   8492 00EB0C 2A                           	ROL
   8493 00EB0D C2 30                        	REP		#$30		; set 16 bit regs
                                           	NDX		16			; tell the assembler
                                           	MEM		16
   8496 00EB0F EB                           	XBA
   8497 00EB10 29 00 FF                     	AND		#$FF00
   8498 00EB13 85 36                        	STA		NormAttr
   8499 00EB15 60                           	RTS
   8500 00EB16                             .0011:
   8501 00EB16 C9 30 00                     	CMP		#'0'
   8502 00EB19 D0 06                        	BNE		.0012
   8503 00EB1B A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8504 00EB1E 85 36                        	STA		NormAttr
   8505 00EB20 60                           	RTS
   8506 00EB21                             .0012:
   8507 00EB21 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8508 00EB24 85 36                        	STA		NormAttr
   8509 00EB26 60                           	RTS
                                           
   8511 00EB27                             doBackSpace:
   8512 00EB27 A6 30                        	LDX		CursorX
   8513 00EB29 F0 26                        	BEQ		.0001		; Can't backspace anymore
   8514 00EB2B A5 34                        	LDA		VideoPos
   8515 00EB2D 0A                           	ASL
   8516 00EB2E A8                           	TAY
   8517 00EB2F                             .0002:
   8518 00EB2F 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8519 00EB34 88                           	DEY
   8520 00EB35 88                           	DEY
   8521 00EB36 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8522 00EB3B 42 C8                        	INY4
   8523 00EB3D E8                           	INX
   8524 00EB3E E4 4C                        	CPX		Textcols
   8525 00EB40 D0 ED                        	BNE		.0002
   8526 00EB42                             .0003:
   8527 00EB42 A9 20 00                     	LDA		#' '
   8528 00EB45 05 36                        	ORA		NormAttr
   8529 00EB47 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8530 00EB4C C6 30                        	DEC		CursorX
   8531 00EB4E 82 5F 00                     	BRL		SyncVideoPos
   8532 00EB51                             .0001:
   8533 00EB51 60                           	RTS
                                           
                                           ; Deleting a character does not change the video position so there's no need
                                           ; to resynchronize it.
                                           
   8538 00EB52                             doDelete:
   8539 00EB52 A6 30                        	LDX		CursorX
   8540 00EB54 A5 34                        	LDA		VideoPos
   8541 00EB56 0A                           	ASL
   8542 00EB57 A8                           	TAY
   8543 00EB58                             .0002:
   8544 00EB58 E8                           	INX
   8545 00EB59 E4 4C                        	CPX		Textcols
   8546 00EB5B 10 14                        	BPL		.0001
   8547 00EB5D CA                           	DEX
   8548 00EB5E C8                           	INY
   8549 00EB5F C8                           	INY
   8550 00EB60 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8551 00EB65 88                           	DEY
   8552 00EB66 88                           	DEY
   8553 00EB67 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8554 00EB6C C8                           	INY
   8555 00EB6D C8                           	INY
   8556 00EB6E E8                           	INX
   8557 00EB6F 80 E7                        	BRA		.0002
   8558 00EB71                             .0001:
   8559 00EB71 A9 20 00                     	LDA		#' '
   8560 00EB74 05 36                        	ORA		NormAttr
   8561 00EB76 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8562 00EB7B 60                           	RTS
                                           
   8564 00EB7C                             doCursorHome:
   8565 00EB7C A5 30                        	LDA		CursorX
   8566 00EB7E F0 24                        	BEQ		doCursor1
   8567 00EB80 64 30                        	STZ		CursorX
   8568 00EB82 80 2C                        	BRA		SyncVideoPos
   8569 00EB84                             doCursorRight:
   8570 00EB84 A5 30                        	LDA		CursorX
   8571 00EB86 1A                           	INA
   8572 00EB87 C5 4C                        	CMP		Textcols
   8573 00EB89 10 1D                        	BPL		doRTS
   8574 00EB8B                             doCursor2:
   8575 00EB8B 85 30                        	STA		CursorX
   8576 00EB8D 80 21                        	BRA		SyncVideoPos
   8577 00EB8F                             doCursorLeft:
   8578 00EB8F A5 30                        	LDA		CursorX
   8579 00EB91 F0 15                        	BEQ		doRTS
   8580 00EB93 3A                           	DEA
   8581 00EB94 80 F5                        	BRA		doCursor2
   8582 00EB96                             doCursorUp:
   8583 00EB96 A5 32                        	LDA		CursorY
   8584 00EB98 F0 0E                        	BEQ		doRTS
   8585 00EB9A 3A                           	DEA
   8586 00EB9B 80 07                        	BRA		doCursor1
   8587 00EB9D                             doCursorDown:
   8588 00EB9D A5 32                        	LDA		CursorY
   8589 00EB9F 1A                           	INA
   8590 00EBA0 C5 4E                        	CMP		Textrows
   8591 00EBA2 10 04                        	BPL		doRTS
   8592 00EBA4                             doCursor1:
   8593 00EBA4 85 32                        	STA		CursorY
   8594 00EBA6 80 08                        	BRA		SyncVideoPos
   8595 00EBA8                             doRTS:
   8596 00EBA8 60                           	RTS
                                           
   8598 00EBA9                             HomeCursor:
   8599 00EBA9 A9 00 00                     	LDA		#0
   8600 00EBAC 64 30                        	STZ		CursorX
   8601 00EBAE 64 32                        	STZ		CursorY
                                           
                                           ; Synchronize the absolute video position with the cursor co-ordinates.
                                           ;
   8605 00EBB0                             SyncVideoPos:
   8606 00EBB0 48                           	PHA
   8607 00EBB1 5A                           	PHY
   8608 00EBB2 A5 32                        	LDA		CursorY
   8609 00EBB4 0A                           	ASL
   8610 00EBB5 AA                           	TAX
   8611 00EBB6 42 3B 05 00 BD 04 F8         	LDA		5:LineTbl,X
   8612 00EBBD 18                           	CLC
   8613 00EBBE 65 30                        	ADC		CursorX
   8614 00EBC0 85 34                        	STA		VideoPos
   8615 00EBC2 A0 0D 00                     	LDY		#13
   8616 00EBC5 42 DA 42 97 46               	STA		FAR {Vidregs},Y		; Update the position in the text controller
   8617 00EBCA 7A                           	PLY
   8618 00EBCB 68                           	PLA
   8619 00EBCC 60                           	RTS
                                           
   8621 00EBCD                             OutCRLF:
   8622 00EBCD A9 0D 00                     	LDA		#CR
   8623 00EBD0 20 D6 EB                     	JSR		OutChar
   8624 00EBD3 A9 0A 00                     	LDA		#LF
                                           
   8626 00EBD6                             OutChar:
   8627 00EBD6 DA                           	PHX
   8628 00EBD7 5A                           	PHY
   8629 00EBD8 08                           	PHP
   8630 00EBD9 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8633 00EBDB A2 00 00                     	LDX		#0
   8634 00EBDE FC F0 03                     	JSR		(OutputVec,x)
   8635 00EBE1 28                           	PLP
   8636 00EBE2 7A                           	PLY
   8637 00EBE3 FA                           	PLX
   8638 00EBE4 60                           	RTS
                                           
   8640 00EBE5                             DisplayString:
                                           ;	PLA							; pop return address
                                           ;	PLX							; get string address parameter
                                           ;	PHA							; push return address
   8644 00EBE5 08                           	PHP							; push reg settings
   8645 00EBE6 E2 20                        	SEP		#$20				; ACC = 8 bit
                                           	MEM		8
                                           ;	STX		StringPos
   8648 00EBE8 A0 00 00                     	LDY		#0
   8649 00EBEB                             .0002:
   8650 00EBEB 42 DA B3 04                  	LDA		FAR (4,S),Y
   8651 00EBEF F0 06                        	BEQ		.0001
   8652 00EBF1 20 D6 EB                     	JSR		OutChar
   8653 00EBF4 C8                           	INY
   8654 00EBF5 80 F4                        	BRA		.0002
   8655 00EBF7                             .0001:
   8656 00EBF7 28                           	PLP							; restore regs settings
                                           ;	REP		#$20				; ACC 16 bits
                                           	MEM		16
   8659 00EBF8 42 C0 04                     	RTS		#4					; pop stack argument
                                           
   8661 00EBFB                             DisplayString2:
   8662 00EBFB 68                           	PLA							; pop return address
   8663 00EBFC FA                           	PLX							; get string address parameter
   8664 00EBFD 48                           	PHA							; push return address
   8665 00EBFE E2 20                        	SEP		#$20				; ACC = 8 bit
   8666 00EC00 86 38                        	STX		StringPos
   8667 00EC02 A0 00 00                     	LDY		#0
   8668 00EC05 A2 32 00                     	LDX		#50
   8669 00EC08                             .0002:
   8670 00EC08 B1 38                        	LDA		(StringPos),Y
   8671 00EC0A 20 D6 EB                     	JSR		OutChar
   8672 00EC0D C8                           	INY
   8673 00EC0E CA                           	DEX
   8674 00EC0F D0 F7                        	BNE		.0002
   8675 00EC11                             .0001:
   8676 00EC11 C2 20                        	REP		#$20				; ACC 16 bits
   8677 00EC13 60                           	RTS
                                           
   8679 00EC14                             GetTextRowsCols:
   8680 00EC14 48                           	PHA
   8681 00EC15 5A                           	PHY
   8682 00EC16 A0 00 00                     	LDY		#0
   8683 00EC19 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8684 00EC20 85 4C                        	STA		Textcols
   8685 00EC22 C8                           	INY
   8686 00EC23 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8687 00EC2A 85 4E                        	STA		Textrows
   8688 00EC2C 7A                           	PLY
   8689 00EC2D 68                           	PLA
   8690 00EC2E 60                           	RTS
                                           
                                           ; .Y = register number to set
                                           ; Acc = value
                                           ;
   8695 00EC2F                             SetVideoReg:
   8696 00EC2F 08                           	PHP								; save regs size settings
   8697 00EC30 E2 20                        	SEP		#$20
   8698 00EC32 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8699 00EC37 28                           	PLP								; restore reg size settings
   8700 00EC38 60                           	RTS
                                           
   8702 00EC39                             CursorOn:
   8703 00EC39 48                           	PHA
   8704 00EC3A 5A                           	PHY
   8705 00EC3B A0 09 00                     	LDY		#9
   8706 00EC3E A9 60 1F                     	LDA		#$1F60
   8707 00EC41 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8708 00EC46 7A                           	PLY
   8709 00EC47 68                           	PLA
   8710 00EC48 60                           	RTS
                                           
   8712 00EC49                             CursorOff:
   8713 00EC49 48                           	PHA
   8714 00EC4A 5A                           	PHY
   8715 00EC4B A0 09 00                     	LDY		#9
   8716 00EC4E A9 20 00                     	LDA		#$0020
   8717 00EC51 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8718 00EC56 7A                           	PLY
   8719 00EC57 68                           	PLA
   8720 00EC58 60                           	RTS
                                           
   8722 00EC59                             ClearScreen:
   8723 00EC59 A2 FF 0F                     	LDX		#4095
   8724 00EC5C A0 00 00                     	LDY		#$00
   8725 00EC5F A9 20 00                     	LDA		#' '
   8726 00EC62 20 BC E9                     	JSR		AsciiToScreen
   8727 00EC65 05 36                        	ORA		NormAttr
   8728 00EC67                             .0001:
   8729 00EC67 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8730 00EC6C C8                           	INY
   8731 00EC6D C8                           	INY
   8732 00EC6E CA                           	DEX
   8733 00EC6F D0 F6                        	BNE		.0001
   8734 00EC71 60                           	RTS
                                           
   8736 00EC72                             ScrollUp:
   8737 00EC72 A0 00 00                     	LDY		#0				; .Y used as index to char
   8738 00EC75 A2 2B 0A                     	LDX 	#2603			; number of chars on screen
   8739 00EC78                             .0001:
   8740 00EC78 5A                           	PHY						; save off current .Y
   8741 00EC79 98                           	TYA								
   8742 00EC7A 18                           	CLC						; Add double the number of text
   8743 00EC7B 65 4C                        	ADC		Textcols		; columns to .Y to find start of next
   8744 00EC7D 18                           	CLC						; row 
   8745 00EC7E 65 4C                        	ADC		Textcols
   8746 00EC80 A8                           	TAY						
   8747 00EC81 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y	; .A = Load buffer[textcols+Y]
   8748 00EC86 7A                           	PLY						; .Y = restore current .Y
   8749 00EC87 42 DA 42 97 40               	STA		FAR {Vidptr},Y	; Store .A in buffer[0+Y]
   8750 00EC8C C8                           	INY						; advance to next character
   8751 00EC8D C8                           	INY						; decrement total char count
   8752 00EC8E CA                           	DEX
   8753 00EC8F D0 E7                        	BNE		.0001
   8754 00EC91 A5 4E                        	LDA		Textrows
   8755 00EC93 3A                           	DEA
                                           
   8757 00EC94                             BlankLine:
   8758 00EC94 0A                           	ASL
   8759 00EC95 A8                           	TAY
   8760 00EC96 42 1B B9 04 F8               	LDA		CS:LineTbl,Y
   8761 00EC9B 0A                           	ASL
   8762 00EC9C A8                           	TAY
   8763 00EC9D A6 4C                        	LDX		Textcols		; number of chars to clear
   8764 00EC9F A5 36                        	LDA		NormAttr
   8765 00ECA1 09 20 00                     	ORA		#$20			; space
   8766 00ECA4                             .0001:
   8767 00ECA4 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8768 00ECA9 C8                           	INY						; increment to next char
   8769 00ECAA C8                           	INY
   8770 00ECAB CA                           	DEX						; decrement number of chars
   8771 00ECAC D0 F6                        	BNE		.0001
   8772 00ECAE 60                           	RTS
                                           
   8774 00ECAF                             DispDWord:
   8775 00ECAF 42 EB                        	XBAW
   8776 00ECB1 20 B6 EC                     	JSR		DispWord
   8777 00ECB4 42 EB                        	XBAW
   8778 00ECB6                             DispWord:
   8779 00ECB6 EB                           	XBA
   8780 00ECB7 20 BB EC                     	JSR		DispByte
   8781 00ECBA EB                           	XBA
   8782 00ECBB                             DispByte:
   8783 00ECBB 48                           	PHA
   8784 00ECBC 4A                           	LSR
   8785 00ECBD 4A                           	LSR
   8786 00ECBE 4A                           	LSR
   8787 00ECBF 4A                           	LSR
   8788 00ECC0 20 C4 EC                     	JSR		DispNybble
   8789 00ECC3 68                           	PLA
   8790 00ECC4                             DispNybble:
   8791 00ECC4 48                           	PHA
   8792 00ECC5 29 0F 00                     	AND		#$0F
   8793 00ECC8 C9 0A 00                     	CMP		#10
   8794 00ECCB 90 08                        	BCC		.0001
   8795 00ECCD 69 36 00                     	ADC		#'A'-11			; -11 cause the carry is set
   8796 00ECD0 20 D6 EB                     	JSR		OutChar
   8797 00ECD3 68                           	PLA
   8798 00ECD4 60                           	RTS
   8799 00ECD5                             .0001:
   8800 00ECD5 09 30 00                     	ORA		#'0'
   8801 00ECD8 20 D6 EB                     	JSR		OutChar
   8802 00ECDB 68                           	PLA
   8803 00ECDC 60                           	RTS
                                           
   8805 00ECDD                             space:
   8806 00ECDD 48                           	PHA
   8807 00ECDE A9 20 00                     	LDA		#' '
   8808 00ECE1 20 D6 EB                     	JSR		OutChar
   8809 00ECE4 68                           	PLA
   8810 00ECE5 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get a range (two hex numbers)
                                           ;------------------------------------------------------------------------------
                                           
   8816 00ECE6                             GetRange:
   8817 00ECE6 20 00 E8                     	JSR		IgnoreBlanks
   8818 00ECE9 20 11 ED                     	JSR		GetHexNumber
   8819 00ECEC C0 00 00                     	CPY		#0
   8820 00ECEF F0 1F                        	BEQ		.0001
   8821 00ECF1 A5 0C                        	LDA		NumWorkArea
   8822 00ECF3 85 20                        	STA		RangeStart
   8823 00ECF5 85 24                        	STA		RangeEnd
   8824 00ECF7 A5 0E                        	LDA		NumWorkArea+2
   8825 00ECF9 85 22                        	STA		RangeStart+2
   8826 00ECFB 85 26                        	STA		RangeEnd+2
   8827 00ECFD 20 00 E8                     	JSR		IgnoreBlanks
   8828 00ED00 20 11 ED                     	JSR		GetHexNumber
   8829 00ED03 C0 00 00                     	CPY		#0
   8830 00ED06 F0 08                        	BEQ		.0001
   8831 00ED08 A5 0C                        	LDA		NumWorkArea
   8832 00ED0A 85 24                        	STA		RangeEnd
   8833 00ED0C A5 0E                        	LDA		NumWorkArea+2
   8834 00ED0E 85 26                        	STA		RangeEnd+2
   8835 00ED10                             .0001:
   8836 00ED10 60                           	RTS
                                           	
                                           ; Get a hexidecimal number. Maximum of six digits.
                                           ; .X = text pointer (updated)
                                           ;------------------------------------------------------------------------------
                                           ;
   8842 00ED11                             GetHexNumber:
   8843 00ED11 A0 00 00                     	LDY		#0					; maximum of eight digits
   8844 00ED14 64 0C                        	STZ		NumWorkArea
   8845 00ED16 64 0E                        	STZ		NumWorkArea+2
   8846 00ED18                             gthxn2:
   8847 00ED18 20 6C E2                     	JSR		MonGetch
   8848 00ED1B 20 3E ED                     	JSR		AsciiToHexNybble
   8849 00ED1E 30 1B                        	BMI		gthxn1
   8850 00ED20 06 0C                        	ASL		NumWorkArea
   8851 00ED22 26 0E                        	ROL		NumWorkArea+2
   8852 00ED24 06 0C                        	ASL		NumWorkArea
   8853 00ED26 26 0E                        	ROL		NumWorkArea+2
   8854 00ED28 06 0C                        	ASL		NumWorkArea
   8855 00ED2A 26 0E                        	ROL		NumWorkArea+2
   8856 00ED2C 06 0C                        	ASL		NumWorkArea
   8857 00ED2E 26 0E                        	ROL		NumWorkArea+2
   8858 00ED30 05 0C                        	ORA		NumWorkArea
   8859 00ED32 85 0C                        	STA		NumWorkArea
   8860 00ED34 C8                           	INY
   8861 00ED35 C0 08 00                     	CPY		#8
   8862 00ED38 D0 DE                        	BNE		gthxn2
   8863 00ED3A 60                           	RTS
   8864 00ED3B                             gthxn1:
   8865 00ED3B CA                           	DEX
   8866 00ED3C CA                           	DEX
   8867 00ED3D 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert ASCII character in the range '0' to '9', 'a' to 'f' or 'A' to 'F'
                                           ; to a hex nybble.
                                           ;------------------------------------------------------------------------------
                                           ;
   8874 00ED3E                             AsciiToHexNybble:
   8875 00ED3E C9 30 00                     	CMP		#'0'
   8876 00ED41 90 30                        	BCC		gthx3
   8877 00ED43 C9 3A 00                     	CMP		#'9'+1
   8878 00ED46 B0 05                        	BCS		gthx5
   8879 00ED48 38                           	SEC
   8880 00ED49 E9 30 00                     	SBC		#'0'
   8881 00ED4C 60                           	RTS
   8882 00ED4D                             gthx5:
   8883 00ED4D C9 41 00                     	CMP		#'A'
   8884 00ED50 90 21                        	BCC		gthx3
   8885 00ED52 C9 47 00                     	CMP		#'F'+1
   8886 00ED55 B0 09                        	BCS		gthx6
   8887 00ED57 38                           	SEC
   8888 00ED58 E9 41 00                     	SBC		#'A'
   8889 00ED5B 18                           	CLC
   8890 00ED5C 69 0A 00                     	ADC		#10
   8891 00ED5F 60                           	RTS
   8892 00ED60                             gthx6:
   8893 00ED60 C9 61 00                     	CMP		#'a'
   8894 00ED63 90 0E                        	BCC		gthx3
   8895 00ED65 C9 7B 00                     	CMP		#'z'+1
   8896 00ED68 B0 09                        	BCS		gthx3
   8897 00ED6A 38                           	SEC
   8898 00ED6B E9 61 00                     	SBC		#'a'
   8899 00ED6E 18                           	CLC
   8900 00ED6F 69 0A 00                     	ADC		#10
   8901 00ED72 60                           	RTS
   8902 00ED73                             gthx3:
   8903 00ED73 A9 FF FF                     	LDA		#-1		; not a hex number
   8904 00ED76 60                           	RTS
                                           
   8906 00ED77                             AsciiToDecNybble:
   8907 00ED77 C9 30 00                     	CMP		#'0'
   8908 00ED7A 90 0A                        	BCC		gtdc3
   8909 00ED7C C9 3A 00                     	CMP		#'9'+1
   8910 00ED7F B0 05                        	BCS		gtdc3
   8911 00ED81 38                           	SEC
   8912 00ED82 E9 30 00                     	SBC		#'0'
   8913 00ED85 60                           	RTS
   8914 00ED86                             gtdc3:
   8915 00ED86 A9 FF FF                     	LDA		#-1
   8916 00ED89 60                           	RTS
                                           
   8918 00ED8A                             getcharNoWait:
   8919 00ED8A A9 01 00                     	LDA		#1
   8920 00ED8D 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8921 00ED91 42 A2 06 00                  	TSK		#6
   8922 00ED95 42 5B A5 BA                  	LDA		ZS:keybd_char
   8923 00ED99 10 02                        	BPL		.0001
   8924 00ED9B 38                           	SEC
   8925 00ED9C 60                           	RTS
   8926 00ED9D                             .0001:
   8927 00ED9D 18                           	CLC
   8928 00ED9E 60                           	RTS
                                           
   8930 00ED9F                             getcharWait:
   8931 00ED9F A9 02 00                     	LDA		#2
   8932 00EDA2 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8933 00EDA6 42 A2 06 00                  	TSK		#6
   8934 00EDAA 42 5B A5 BA                  	LDA		ZS:keybd_char
   8935 00EDAE 10 02                        	BPL		.0001
   8936 00EDB0 38                           	SEC
   8937 00EDB1 60                           	RTS
   8938 00EDB2                             .0001:
   8939 00EDB2 18                           	CLC
   8940 00EDB3 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; Keyboard processing routines follow.
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   8947 00EDB4                             ResetKbd:
   8948 00EDB4 E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8951 00EDB6 64 08                        	STZ		KeyState1
   8952 00EDB8 64 09                        	STZ		KeyState2
   8953 00EDBA A9 FF                        	LDA		#$FF
   8954 00EDBC 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8955 00EDC4 20 D7 EE                     	JSR		KeybdWaitTx
   8956 00EDC7 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8959 00EDC9 60                           	RTS
   8960 00EDCA                             KeybdInit:
   8961 00EDCA A9 00 20                     	LDA		#$2000
   8962 00EDCD 1B                           	TAS
   8963 00EDCE A9 05 00                     	LDA		#5
   8964 00EDD1 85 BC                        	STA		keybd_cmd
   8965 00EDD3 E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8968 00EDD5 64 08                        	STZ		KeyState1
   8969 00EDD7 64 09                        	STZ		KeyState2
   8970 00EDD9 A0 0C                        	LDY		#12
   8971 00EDDB 42 60                        	RTT
   8972 00EDDD                             .resetAgain:
   8973 00EDDD A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8974 00EDDF 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8975 00EDE7 20 D7 EE                     	JSR		KeybdWaitTx
   8976 00EDEA                             .0001:
   8977 00EDEA 20 B2 EE                     	JSR		KeybdRecvByte	; Look for $AA
   8978 00EDED 90 5A                        	BCC		.tryAgain
   8979 00EDEF C9 AA                        	CMP		#$AA			;
   8980 00EDF1 F0 37                        	BEQ		.config
   8981 00EDF3                             .0002:
                                           	; wait until keyboard not busy
   8983 00EDF3 20 F5 EE                     	JSR		Wait10ms
   8984 00EDF6 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		;
                                         
   8985 00EDFE 89 40                        	BIT		#$40
   8986 00EE00 D0 47                        	BNE		.tryAgain
   8987 00EE02 A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8988 00EE04 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8989 00EE0C 20 F5 EE                     	JSR		Wait10ms
   8990 00EE0F 20 D7 EE                     	JSR		KeybdWaitTx		; wait until no longer busy
   8991 00EE12 20 B2 EE                     	JSR		KeybdRecvByte	; look for an ACK ($FA)
   8992 00EE15 90 32                        	BCC		.tryAgain
   8993 00EE17 C9 FE                        	CMP		#$FE
   8994 00EE19 F0 2E                        	BEQ		.tryAgain
   8995 00EE1B C9 FA                        	CMP		#$FA
   8996 00EE1D D0 2A                        	BNE		.tryAgain
   8997 00EE1F 20 B2 EE                     	JSR		KeybdRecvByte
   8998 00EE22 C9 FC                        	CMP		#$FC			; reset error ?
   8999 00EE24 F0 23                        	BEQ		.tryAgain
   9000 00EE26 C9 AA                        	CMP		#$AA			; reset complete okay ?
   9001 00EE28 D0 1F                        	BNE		.tryAgain
   9002 00EE2A                             .config:
   9003 00EE2A 20 D7 EE                     	JSR		KeybdWaitBusy
   9004 00EE2D A9 F0                        	LDA		#$F0			; send scan code select
   9005 00EE2F 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9006 00EE37 20 D7 EE                     	JSR		KeybdWaitTx
   9007 00EE3A 90 0D                        	BCC		.tryAgain
   9008 00EE3C 20 B2 EE                     	JSR		KeybdRecvByte	; wait for response from keyboard
   9009 00EE3F 90 08                        	BCC		.tryAgain
   9010 00EE41 C9 FE                        	CMP		#$FE
   9011 00EE43 F0 04                        	BEQ		.tryAgain
   9012 00EE45 C9 FA                        	CMP		#$FA
   9013 00EE47 F0 16                        	BEQ		.0004
   9014 00EE49                             .tryAgain:
   9015 00EE49 88                           	DEY
   9016 00EE4A D0 9E                        	BNE		.0001
   9017 00EE4C C6 BC                        	DEC		keybd_cmd
   9018 00EE4E D0 8D                        	BNE		.resetAgain
   9019 00EE50                             .keybdErr:
   9020 00EE50 C2 30                        	REP		#$30
   9021 00EE52 F4 01 00                     	PEA		1
   9022 00EE55 F4 0D EF                     	PEA		msgKeybdNR
   9023 00EE58 20 E5 EB                     	JSR		DisplayString
   9024 00EE5B 42 60                        	RTT
   9025 00EE5D 80 1A                        	BRA		KeybdService
   9026 00EE5F                             .0004:
   9027 00EE5F A9 02                        	LDA		#2				; select scan code set #2
   9028 00EE61 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9029 00EE69 20 D7 EE                     	JSR		KeybdWaitTx
   9030 00EE6C 90 DB                        	BCC		.tryAgain
   9031 00EE6E 20 B2 EE                     	JSR		KeybdRecvByte
   9032 00EE71 90 D6                        	BCC		.tryAgain
   9033 00EE73 C2 30                        	REP		#$30
   9034 00EE75 42 60                        	RTT
   9035 00EE77 80 00                        	BRA		KeybdService
                                           
   9037 00EE79                             KeybdService:
   9038 00EE79 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9041 00EE7B A9 00 20                     	LDA		#$2000
   9042 00EE7E 1B                           	TAS
   9043 00EE7F A5 BC                        	LDA		keybd_cmd
   9044 00EE81 C9 01 00                     	CMP		#1
   9045 00EE84 D0 18                        	BNE		.0001
   9046 00EE86 20 30 EF                     	JSR		KeybdGetCharNoWait
   9047 00EE89 B0 08                        	BCS		.nokey
   9048 00EE8B 64 BC                        	STZ		keybd_cmd
   9049 00EE8D 85 BA                        	STA		keybd_char
   9050 00EE8F 42 60                        	RTT
   9051 00EE91 80 E6                        	BRA		KeybdService
   9052 00EE93                             .nokey
   9053 00EE93 A9 FF FF                     	LDA		#-1
   9054 00EE96 64 BC                        	STZ		keybd_cmd
   9055 00EE98 85 BA                        	STA		keybd_char
   9056 00EE9A 42 60                        	RTT
   9057 00EE9C 80 DB                        	BRA		KeybdService
   9058 00EE9E                             .0001:
   9059 00EE9E C9 02 00                     	CMP		#2
   9060 00EEA1 D0 0B                        	BNE		.0002
   9061 00EEA3 20 4A EF                     	JSR		KeybdGetCharWait
   9062 00EEA6 64 BC                        	STZ		keybd_cmd
   9063 00EEA8 85 BA                        	STA		keybd_char
   9064 00EEAA 42 60                        	RTT
   9065 00EEAC 80 CB                        	BRA		KeybdService
   9066 00EEAE                             .0002:
   9067 00EEAE 42 60                        	RTT
   9068 00EEB0 80 C7                        	BRA		KeybdService
                                           
                                           	MEM		8
                                           	NDX		8
                                           
                                           ; Receive a byte from the keyboard, used after a command is sent to the
                                           ; keyboard in order to wait for a response.
                                           ;
   9076 00EEB2                             KeybdRecvByte:
   9077 00EEB2 5A                           	PHY
   9078 00EEB3 A0 14                        	LDY		#20				; wait up to .2s
   9079 00EEB5                             .0003:
   9080 00EEB5 20 D7 EE                     	JSR		KeybdWaitBusy
   9081 00EEB8 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1	; wait for response from keyboard
                                         
   9082 00EEC0 0A                           	ASL						; is input buffer full ?
   9083 00EEC1 B0 09                        	BCS		.0004			; yes, branch
   9084 00EEC3 20 F5 EE                     	JSR		Wait10ms		; wait a bit
   9085 00EEC6 88                           	DEY
   9086 00EEC7 D0 EC                        	BNE		.0003			; go back and try again
   9087 00EEC9 7A                           	PLY						; timeout
   9088 00EECA 18                           	CLC						; carry clear = no code
   9089 00EECB 60                           	RTS
   9090 00EECC                             .0004:
   9091 00EECC 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD		; clear recieve state
                                         
   9092 00EED4 7A                           	PLY
   9093 00EED5 38                           	SEC						; carry set = code available
   9094 00EED6 60                           	RTS
                                           
                                           ; Wait until the keyboard isn't busy anymore
                                           ; Wait until the keyboard transmit is complete
                                           ; Returns .CF = 1 if successful, .CF=0 timeout
                                           ;
   9100 00EED7                             KeybdWaitBusy:				; alias for KeybdWaitTx
   9101 00EED7                             KeybdWaitTx:
   9102 00EED7 48                           	PHA
   9103 00EED8 5A                           	PHY
   9104 00EED9 A0 0A                        	LDY		#10				; wait a max of .1s
   9105 00EEDB                             .0001:
   9106 00EEDB 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1
                                         
   9107 00EEE3 89 40                        	BIT		#$40			; check for transmit busy bit
   9108 00EEE5 F0 0A                        	BEQ		.0002			; branch if bit clear
   9109 00EEE7 20 F5 EE                     	JSR		Wait10ms		; delay a little bit
   9110 00EEEA 88                           	DEY						; go back and try again
   9111 00EEEB D0 EE                        	BNE		.0001
   9112 00EEED 7A                           	PLY						; timed out
   9113 00EEEE 68                           	PLA
   9114 00EEEF 18                           	CLC						; return carry clear
   9115 00EEF0 60                           	RTS
   9116 00EEF1                             .0002:
   9117 00EEF1 7A                           	PLY						; wait complete, return 
   9118 00EEF2 68                           	PLA
   9119 00EEF3 38                           	SEC						; carry set
   9120 00EEF4 60                           	RTS
                                           
                                           ; Wait approximately 10ms. Used by keyboard routines. Makes use of the free
                                           ; running counter #0.
                                           ; .A = trashed (=-5)
                                           ;
   9126 00EEF5                             Wait10ms:
   9127 00EEF5 48                           	PHA
   9128 00EEF6 DA                           	PHX				; save .X
   9129 00EEF7 42 5B A5 12                  	LDA		ZS:CNT0H	; get starting count
   9130 00EEFB AA                           	TAX				; save it off in .X
   9131 00EEFC                             .0002:
   9132 00EEFC 38                           	SEC				; compare to current counter value
   9133 00EEFD 42 5B E5 12                  	SBC		ZS:CNT0H
   9134 00EF01 49 FF                        	EOR		#$FF	; make negative
   9135 00EF03 C9 0A                        	CMP		#10
   9136 00EF05 10 03                        	BPL     .0001
   9137 00EF07 8A                           	TXA				; prepare for next check, get startcount in .A
   9138 00EF08 80 F2                        	BRA		.0002	; go back if less than 5 ticks
   9139 00EF0A                             .0001:
   9140 00EF0A FA                           	PLX				; restore .X
   9141 00EF0B 68                           	PLA
   9142 00EF0C 60                           	RTS
                                           
                                           	MEM		16
                                           	NDX		16
                                           
   9147 00EF0D                             msgKeybdNR:
   9148 00EF0D 0D 0A 4B 65 79 62 6F 61      	.byte	CR,LF,"Keyboard not responding.",CR,LF,0
   9148 00EF15 72 64 20 6E 6F 74 20 72    
   9148 00EF1D 65 73 70 6F 6E 64 69 6E    
   9148 00EF25 67 2E 0D 0A 00             
                                           
                                           	cpu		FT832
                                           
   9152 00EF2A                             KeybdGetCharNoWaitCtx:
   9153 00EF2A 20 30 EF                     	JSR		KeybdGetCharNoWait
   9154 00EF2D 42 40 00                     	RTC		#0
   9155 00EF30                             	
   9156 00EF30 08                           	PHP
   9157 00EF31 78                           	SEI
   9158 00EF32 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9161 00EF34 42 1A                        	TTA
   9162 00EF36 C5 CE                        	CMP		IOFocusTask
   9163 00EF38 D0 0D                        	BNE		.noFocus
   9164 00EF3A E2 20                        	SEP		#$20
   9165 00EF3C C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9168 00EF3E 64 D0                        	STZ		TaskSwitchEn
   9169 00EF40 58                           	CLI
   9170 00EF41 A9 00                        	LDA		#0
   9171 00EF43 85 0B                        	STA		KeybdWaitFlag
   9172 00EF45 80 13                        	BRA		KeybdGetChar1
   9173 00EF47                             .noFocus:
   9174 00EF47 28                           	PLP
   9175 00EF48 38                           	SEC		; flag no key available
   9176 00EF49 60                           	RTS
                                           
   9178 00EF4A                             KeybdGetCharWait:
   9179 00EF4A 08                           	PHP
   9180 00EF4B E2 20                        	SEP		#$20
   9181 00EF4D C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9184 00EF4F A9 FF                        	LDA		#$FF
   9185 00EF51 85 0B                        	STA		KeybdWaitFlag
   9186 00EF53 80 05                        	BRA		KeybdGetChar1
                                           
                                           ; Wait for a keyboard character to be available
                                           ; Returns (CF=1) if no key available
                                           ; Return key (CF=0) if key is available
                                           ;
                                           ;
   9193 00EF55                             KeybdGetChar:
   9194 00EF55 08                           	PHP
   9195 00EF56 E2 20                        	SEP		#$20		; 8 bit acc
   9196 00EF58 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9199 00EF5A                             KeybdGetChar1:
   9200 00EF5A DA                           	PHX
   9201 00EF5B EB                           	XBA					; force .B to zero for TAX
   9202 00EF5C A9 00                        	LDA		#0
   9203 00EF5E EB                           	XBA
   9204 00EF5F                             .0002:
   9205 00EF5F                             .0003:
   9206 00EF5F 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		; check MSB of keyboard status reg.
                                         
   9207 00EF67 2A                           	ROL
   9208 00EF68 2A                           	ROL
   9209 00EF69 B0 F4                        	BCS		.0003		; check busy flag, branch if busy
   9210 00EF6B 6A                           	ROR
   9211 00EF6C B0 08                        	BCS		.0006		; branch if keystroke ready
   9212 00EF6E 24 0B                        	BIT		KeybdWaitFlag
   9213 00EF70 30 ED                        	BMI		.0003
   9214 00EF72 FA                           	PLX
   9215 00EF73 28                           	PLP
   9216 00EF74 38                           	SEC
   9217 00EF75 60                           	RTS
   9218 00EF76                             .0006:
   9219 00EF76 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD	; get scan code value
                                         
   9220 00EF7E 42 3B FF 0F 42 9C 12 A1      	STZ		$FFF:KEYBD+2	; clear read flag
   9220 00EF86 0E 00                      
                                           	;REP		#$20
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;SEP		#$20
   9225 00EF88                             .0001:
   9226 00EF88 C9 F0                        	CMP		#SC_KEYUP	; keyup scan code ?
   9227 00EF8A F0 FF 6F 00                  	LBEQ	.doKeyup	; 
   9228 00EF8E C9 E0                        	CMP		#SC_EXTEND	; extended scan code ?
   9229 00EF90 F0 FF 70 00                  	LBEQ	.doExtend
   9230 00EF94 C9 14                        	CMP		#$14		; control ?
   9231 00EF96 F0 FF 73 00                  	LBEQ	.doCtrl
   9232 00EF9A C9 12                        	CMP		#$12		; left shift
   9233 00EF9C F0 FF 7D 00                  	LBEQ	.doShift
   9234 00EFA0 C9 59                        	CMP		#$59		; right shift
   9235 00EFA2 F0 FF 77 00                  	LBEQ	.doShift
   9236 00EFA6 C9 77                        	CMP		#SC_NUMLOCK
   9237 00EFA8 F0 FF 81 00                  	LBEQ	.doNumLock
   9238 00EFAC C9 58                        	CMP		#SC_CAPSLOCK
   9239 00EFAE F0 FF 8B 00                  	LBEQ	.doCapsLock
   9240 00EFB2 C9 7E                        	CMP		#SC_SCROLLLOCK
   9241 00EFB4 F0 FF 95 00                  	LBEQ	.doScrollLock
   9242 00EFB8 46 08                        	LSR		KeyState1
   9243 00EFBA B0 A3                        	BCS		.0003
   9244 00EFBC AA                           	TAX
   9245 00EFBD A9 80                        	LDA		#$80
   9246 00EFBF 24 09                        	BIT		KeyState2	; Is extended code ?
   9247 00EFC1 F0 13                        	BEQ		.0010
   9248 00EFC3 A9 7F                        	LDA		#$7F
   9249 00EFC5 25 09                        	AND		KeyState2
   9250 00EFC7 85 09                        	STA		KeyState2
   9251 00EFC9 46 08                        	LSR		KeyState1	; clear keyup
   9252 00EFCB 8A                           	TXA
   9253 00EFCC 29 7F                        	AND		#$7F
   9254 00EFCE AA                           	TAX
   9255 00EFCF 42 1B BD 2A F3               	LDA		cs:keybdExtendedCodes,X
   9256 00EFD4 80 23                        	BRA		.0008
   9257 00EFD6                             .0010:
   9258 00EFD6 A9 04                        	LDA		#4
   9259 00EFD8 24 09                        	BIT		KeyState2	; Is Cntrl down ?
   9260 00EFDA F0 0B                        	BEQ		.0009
   9261 00EFDC 8A                           	TXA
   9262 00EFDD 29 7F                        	AND		#$7F		; table is 128 chars
   9263 00EFDF AA                           	TAX
   9264 00EFE0 42 1B BD AA F2               	LDA		cs:keybdControlCodes,X
   9265 00EFE5 80 12                        	BRA		.0008
   9266 00EFE7                             .0009:
   9267 00EFE7 A9 01                        	LDA		#$1			; Is shift down ?
   9268 00EFE9 24 09                        	BIT		KeyState2
   9269 00EFEB F0 07                        	BEQ		.0007
   9270 00EFED 42 1B BD AA F1               	LDA		cs:shiftedScanCodes,X
   9271 00EFF2 80 05                        	BRA		.0008
   9272 00EFF4                             .0007:
   9273 00EFF4 42 1B BD AA F0               	LDA		cs:unshiftedScanCodes,X
   9274 00EFF9                             .0008:
   9275 00EFF9 FA                           	PLX
   9276 00EFFA 28                           	PLP
   9277 00EFFB 18                           	CLC
   9278 00EFFC 60                           	RTS
                                           	MEM		8
   9280 00EFFD                             .doKeyup:
   9281 00EFFD A9 01                        	LDA		#1
   9282 00EFFF 04 08                        	TSB		KeyState1
   9283 00F001 82 5B FF                     	BRL		.0003
   9284 00F004                             .doExtend:				; set extended key flag
   9285 00F004 A5 09                        	LDA		KeyState2
   9286 00F006 09 80                        	ORA		#$80
   9287 00F008 85 09                        	STA		KeyState2
   9288 00F00A 82 52 FF                     	BRL		.0003
   9289 00F00D                             .doCtrl:
   9290 00F00D A9 04                        	LDA		#4
   9291 00F00F 46 08                        	LSR		KeyState1	; check key up/down	
   9292 00F011 90 05                        	BCC		.0004		; keydown = carry clear
   9293 00F013 14 09                        	TRB		KeyState2
   9294 00F015 82 47 FF                     	BRL		.0003
   9295 00F018                             .0004:
   9296 00F018 04 09                        	TSB		KeyState2	; set control active bit
   9297 00F01A 82 42 FF                     	BRL		.0003
   9298 00F01D                             .doShift:
   9299 00F01D A9 01                        	LDA		#1
   9300 00F01F 46 08                        	LSR		KeyState1	; check key up/down	
   9301 00F021 90 05                        	BCC		.0005
   9302 00F023 14 09                        	TRB		KeyState2
   9303 00F025 82 37 FF                     	BRL		.0003
   9304 00F028                             .0005:
   9305 00F028 04 09                        	TSB		KeyState2
   9306 00F02A 82 32 FF                     	BRL		.0003
   9307 00F02D                             .doNumLock:
   9308 00F02D A5 09                        	LDA		KeyState2
   9309 00F02F 49 10                        	EOR		#16
   9310 00F031 85 09                        	STA		KeyState2
   9311 00F033 E2 30                        	SEP		#$30
   9312 00F035 20 5D F0                     	JSR		KeybdSetLEDStatus
   9313 00F038 C2 20                        	REP		#$20
   9314 00F03A 82 22 FF                     	BRL		.0003
   9315 00F03D                             .doCapsLock:
   9316 00F03D A5 09                        	LDA		KeyState2
   9317 00F03F 49 20                        	EOR		#32
   9318 00F041 85 09                        	STA		KeyState2
   9319 00F043 E2 30                        	SEP		#$30
   9320 00F045 20 5D F0                     	JSR		KeybdSetLEDStatus
   9321 00F048 C2 20                        	REP		#$20
   9322 00F04A 82 12 FF                     	BRL		.0003
   9323 00F04D                             .doScrollLock:
   9324 00F04D A5 09                        	LDA		KeyState2
   9325 00F04F 49 40                        	EOR		#64
   9326 00F051 85 09                        	STA		KeyState2
   9327 00F053 E2 30                        	SEP		#$30
   9328 00F055 20 5D F0                     	JSR		KeybdSetLEDStatus
   9329 00F058 C2 20                        	REP		#$20
   9330 00F05A 82 02 FF                     	BRL		.0003
                                           
   9332 00F05D                             KeybdSetLEDStatus:
                                           ;	PHDS				; save off DS
                                           ;	PEA		5			; set DS to zero
                                           ;	PLDS
   9336 00F05D A9 00                        	LDA		#0
   9337 00F05F 85 0A                        	STA		KeybdLEDs
   9338 00F061 A9 10                        	LDA		#16
   9339 00F063 24 09                        	BIT		KeyState2
   9340 00F065 F0 06                        	BEQ		.0002
   9341 00F067 A5 0A                        	LDA		KeybdLEDs	; set bit 1 for Num lock, 0 for scrolllock , 2 for caps lock
   9342 00F069 09 02                        	ORA		#$2
   9343 00F06B 85 0A                        	STA		KeybdLEDs
   9344 00F06D                             .0002:
   9345 00F06D A9 20                        	LDA		#32
   9346 00F06F 24 09                        	BIT		KeyState2
   9347 00F071 F0 06                        	BEQ		.0003
   9348 00F073 A5 0A                        	LDA		KeybdLEDs
   9349 00F075 09 04                        	ORA		#$4
   9350 00F077 85 0A                        	STA		KeybdLEDs
   9351 00F079                             .0003:
   9352 00F079 A9 40                        	LDA		#64
   9353 00F07B 24 09                        	BIT		KeyState2
   9354 00F07D F0 06                        	BEQ		.0004
   9355 00F07F A5 0A                        	LDA		KeybdLEDs
   9356 00F081 09 01                        	ORA		#1
   9357 00F083 85 0A                        	STA		KeybdLEDs
   9358 00F085                             .0004:
   9359 00F085 A9 ED                        	LDA		#$ED		; set status LEDs command
   9360 00F087 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9361 00F08F 20 D7 EE                     	JSR		KeybdWaitTx
   9362 00F092 20 B2 EE                     	JSR		KeybdRecvByte
   9363 00F095 90 12                        	BCC		.0001
   9364 00F097 C9 FA                        	CMP		#$FA
   9365 00F099 A5 0A                        	LDA		KeybdLEDs
   9366 00F09B 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9367 00F0A3 20 D7 EE                     	JSR		KeybdWaitTx
   9368 00F0A6 20 B2 EE                     	JSR		KeybdRecvByte	; wait for $FA byte
   9369 00F0A9                             .0001:
                                           ;	PLDS				; recover DS
   9371 00F0A9 60                           	RTS
                                           
                                           
                                           	;--------------------------------------------------------------------------
                                           	; PS2 scan codes to ascii conversion tables.
                                           	;--------------------------------------------------------------------------
                                           	;
   9378 00F0AA                             unshiftedScanCodes:
   9379 00F0AA 2E A9 2E A5 A3 A1 A2 AC      	.byte	$2e,$a9,$2e,$a5,$a3,$a1,$a2,$ac
                                         
   9380 00F0B2 2E AA A8 A6 A4 09 60 2E      	.byte	$2e,$aa,$a8,$a6,$a4,$09,$60,$2e
                                         
   9381 00F0BA 2E 2E 2E 2E 2E 71 31 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$71,$31,$2e
                                         
   9382 00F0C2 2E 2E 7A 73 61 77 32 2E      	.byte	$2e,$2e,$7a,$73,$61,$77,$32,$2e
                                         
   9383 00F0CA 2E 63 78 64 65 34 33 2E      	.byte	$2e,$63,$78,$64,$65,$34,$33,$2e
                                         
   9384 00F0D2 2E 20 76 66 74 72 35 2E      	.byte	$2e,$20,$76,$66,$74,$72,$35,$2e
                                         
   9385 00F0DA 2E 6E 62 68 67 79 36 2E      	.byte	$2e,$6e,$62,$68,$67,$79,$36,$2e
                                         
   9386 00F0E2 2E 2E 6D 6A 75 37 38 2E      	.byte	$2e,$2e,$6d,$6a,$75,$37,$38,$2e
                                         
   9387 00F0EA 2E 2C 6B 69 6F 30 39 2E      	.byte	$2e,$2c,$6b,$69,$6f,$30,$39,$2e
                                         
   9388 00F0F2 2E 2E 2F 6C 3B 70 2D 2E      	.byte	$2e,$2e,$2f,$6c,$3b,$70,$2d,$2e
                                         
   9389 00F0FA 2E 2E 27 2E 5B 3D 2E 2E      	.byte	$2e,$2e,$27,$2e,$5b,$3d,$2e,$2e
                                         
   9390 00F102 AD 2E 0D 5D 2E 5C 2E 2E      	.byte	$ad,$2e,$0d,$5d,$2e,$5c,$2e,$2e
                                         
   9391 00F10A 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9392 00F112 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9393 00F11A 98 7F 92 2E 91 90 1B AF      	.byte	$98,$7f,$92,$2e,$91,$90,$1b,$af
                                         
   9394 00F122 AB 2E 97 2E 2E 96 AE 2E      	.byte	$ab,$2e,$97,$2e,$2e,$96,$ae,$2e
                                         
                                           
   9396 00F12A 2E 2E 2E A7 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$a7,$2e,$2e,$2e,$2e
                                         
   9397 00F132 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9398 00F13A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9399 00F142 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9400 00F14A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9401 00F152 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9402 00F15A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9403 00F162 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9404 00F16A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9405 00F172 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9406 00F17A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9407 00F182 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9408 00F18A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9409 00F192 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9410 00F19A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9411 00F1A2 2E 2E FA 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$fa,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9413 00F1AA                             shiftedScanCodes:
   9414 00F1AA 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9415 00F1B2 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9416 00F1BA 2E 2E 2E 2E 2E 51 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$51,$21,$2e
                                         
   9417 00F1C2 2E 2E 5A 53 41 57 40 2E      	.byte	$2e,$2e,$5a,$53,$41,$57,$40,$2e
                                         
   9418 00F1CA 2E 43 58 44 45 24 23 2E      	.byte	$2e,$43,$58,$44,$45,$24,$23,$2e
                                         
   9419 00F1D2 2E 20 56 46 54 52 25 2E      	.byte	$2e,$20,$56,$46,$54,$52,$25,$2e
                                         
   9420 00F1DA 2E 4E 42 48 47 59 5E 2E      	.byte	$2e,$4e,$42,$48,$47,$59,$5e,$2e
                                         
   9421 00F1E2 2E 2E 4D 4A 55 26 2A 2E      	.byte	$2e,$2e,$4d,$4a,$55,$26,$2a,$2e
                                         
   9422 00F1EA 2E 3C 4B 49 4F 29 28 2E      	.byte	$2e,$3c,$4b,$49,$4f,$29,$28,$2e
                                         
   9423 00F1F2 2E 3E 3F 4C 3A 50 5F 2E      	.byte	$2e,$3e,$3f,$4c,$3a,$50,$5f,$2e
                                         
   9424 00F1FA 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9425 00F202 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9426 00F20A 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9427 00F212 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9428 00F21A 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9429 00F222 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9431 00F22A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9432 00F232 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9433 00F23A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9434 00F242 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9435 00F24A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9436 00F252 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9437 00F25A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9438 00F262 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9439 00F26A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9440 00F272 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9441 00F27A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9442 00F282 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9443 00F28A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9444 00F292 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9445 00F29A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9446 00F2A2 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
                                           ; control
   9449 00F2AA                             keybdControlCodes:
   9450 00F2AA 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9451 00F2B2 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9452 00F2BA 2E 2E 2E 2E 2E 11 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$11,$21,$2e
                                         
   9453 00F2C2 2E 2E 1A 13 01 17 40 2E      	.byte	$2e,$2e,$1a,$13,$01,$17,$40,$2e
                                         
   9454 00F2CA 2E 03 18 04 05 24 23 2E      	.byte	$2e,$03,$18,$04,$05,$24,$23,$2e
                                         
   9455 00F2D2 2E 20 16 06 14 12 25 2E      	.byte	$2e,$20,$16,$06,$14,$12,$25,$2e
                                         
   9456 00F2DA 2E 0E 02 08 07 19 5E 2E      	.byte	$2e,$0e,$02,$08,$07,$19,$5e,$2e
                                         
   9457 00F2E2 2E 2E 0D 0A 15 26 2A 2E      	.byte	$2e,$2e,$0d,$0a,$15,$26,$2a,$2e
                                         
   9458 00F2EA 2E 3C 0B 09 0F 29 28 2E      	.byte	$2e,$3c,$0b,$09,$0f,$29,$28,$2e
                                         
   9459 00F2F2 2E 3E 3F 0C 3A 10 5F 2E      	.byte	$2e,$3e,$3f,$0c,$3a,$10,$5f,$2e
                                         
   9460 00F2FA 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9461 00F302 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9462 00F30A 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9463 00F312 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9464 00F31A 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9465 00F322 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9467 00F32A                             keybdExtendedCodes:
   9468 00F32A 2E 2E 2E 2E A3 A1 A2 2E      	.byte	$2e,$2e,$2e,$2e,$a3,$a1,$a2,$2e
                                         
   9469 00F332 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9470 00F33A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9471 00F342 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9472 00F34A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9473 00F352 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9474 00F35A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9475 00F362 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9476 00F36A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9477 00F372 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9478 00F37A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9479 00F382 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9480 00F38A 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9481 00F392 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9482 00F39A 98 99 92 2E 91 90 2E 2E      	.byte	$98,$99,$92,$2e,$91,$90,$2e,$2e
                                         
   9483 00F3A2 2E 2E 97 2E 2E 96 2E 2E      	.byte	$2e,$2e,$97,$2e,$2e,$96,$2e,$2e
                                         
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; SPI MASTER driver
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ; spi_master_init
                                           ; Initialize the spi master controller
                                           
   9494 00F3AA                             spi_master_init:
   9495 00F3AA 08                           	
   9496 00F3AB E2 20                        	SEP		#$20
                                           	MEM		8
   9498 00F3AD A9 01                        	LDA		#SPI_INIT_SD
   9499 00F3AF 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9500 00F3B3 A9 01                        	LDA		#SPI_TRANS_START
   9501 00F3B5 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9502 00F3B9                             .0001:
   9503 00F3B9 AD B5 F3                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9504 00F3BC C9 01                        	CMP		#SPI_TRANS_BUSY
   9505 00F3BE F0 F9                        	BEQ		.0001
   9506 00F3C0 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9507 00F3C4 29 03                        	AND		#3	; INIT errors
   9508 00F3C6 C9 00                        	CMP		#SPI_INIT_NO_ERROR
   9509 00F3C8 F0 0E                        	BEQ		.0004
   9510 00F3CA 28                           	PLP
                                           	MEM		16
                                           	NDX		16
   9513 00F3CB F4 01 00                     	PEA		1
   9514 00F3CE F4 C8 F4                     	PEA		msgSpiInitError
   9515 00F3D1 20 E5 EB                     	JSR		DisplayString
   9516 00F3D4 A9 01 00                     	LDA		#1
   9517 00F3D7 60                           	RTS
   9518 00F3D8                             .0004:
   9519 00F3D8 28                           	PLP
                                           	;PEA		1
                                           	;PEA		msgSpiInited
                                           	;JSR		DisplayString
   9523 00F3D9 A9 00 00                     	LDA		#0
   9524 00F3DC 60                           	RTS
                                           
                                           ; spi_master_read
                                           ; read a block from the SD card
                                           ;
                                           ; Parameters:
                                           ;	32 bit buffer address pushed onto stack
                                           ;	32 bit block number pushed onto stack
                                           ;
   9533 00F3DD                             spi_master_read:
   9534 00F3DD 08                           	PHP
   9535 00F3DE E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
   9538 00F3E0 BA                           	TSX
   9539 00F3E1 B5 04                        	LDA		4,X
   9540 00F3E3 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9541 00F3E7 B5 05                        	LDA		5,X
   9542 00F3E9 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9543 00F3ED B5 06                        	LDA		6,X
   9544 00F3EF 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9545 00F3F3 B5 07                        	LDA		7,X
   9546 00F3F5 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
   9547 00F3F9 B5 08                        	LDA		8,X
   9548 00F3FB 85 C8                        	STA		bufptr
   9549 00F3FD B5 09                        	LDA		9,X
   9550 00F3FF 85 C9                        	STA		bufptr+1
   9551 00F401 B5 0A                        	LDA		10,X
   9552 00F403 85 CA                        	STA		bufptr+2
   9553 00F405 B5 0B                        	LDA		11,X
   9554 00F407 85 CB                        	STA		bufptr+3
   9555 00F409 A9 02                        	LDA		#SPI_RW_READ_SD_BLOCK
   9556 00F40B 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9557 00F40F A9 01                        	LDA		#SPI_TRANS_START
   9558 00F411 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9559 00F415                             .0001:
   9560 00F415 AD B5 F3                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9561 00F418 C9 01                        	CMP		#SPI_TRANS_BUSY
   9562 00F41A F0 F9                        	BEQ		.0001
   9563 00F41C AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9564 00F420 4A                           	LSR
   9565 00F421 4A                           	LSR
   9566 00F422 29 03                        	AND		#3	; INIT errors
   9567 00F424 C9 00                        	CMP		#SPI_READ_NO_ERROR
   9568 00F426 F0 10                        	BEQ		.0004
   9569 00F428 28                           	PLP
                                           	MEM		16
   9571 00F429 F4 01 00                     	PEA		1
   9572 00F42C F4 FC F4                     	PEA		msgSpiReadError
   9573 00F42F 20 E5 EB                     	JSR		DisplayString
   9574 00F432 A9 01 00                     	LDA		#1
   9575 00F435 42 C0 08                     	RTS		#8
   9576 00F438                             .0004:
   9577 00F438 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   9580 00F43A A2 00 02                     	LDX		#512
   9581 00F43D A0 00 00                     	LDY		#0
   9582 00F440                             .0003:
                                           	;TXA
                                           	;AND		#$0F
                                           	;BNE		.0002
                                           	;PLP
                                           	;JSR		OutCRLF
                                           	;PHP
                                           	;SEP		#$20
   9590 00F440                             .0002:
   9591 00F440 AF 10 C0 FE                  	LDA		SPI_RX_FIFO_DATA_REG
   9592 00F444 42 97 C8                     	STA		{bufptr},Y
   9593 00F447 C8                           	INY
                                           	;PLP
                                           	;JSR		DispByte
                                           	;JSR		space
                                           	;PHP
   9598 00F448 E2 20                        	SEP		#$20
   9599 00F44A CA                           	DEX
   9600 00F44B D0 F3                        	BNE		.0003
   9601 00F44D 28                           	PLP
                                           	;JSR		OutCRLF
                                           	MEM		16
                                           	NDX		16
   9605 00F44E A9 00 00                     	LDA		#0
   9606 00F451 42 C0 08                     	RTS		#8
                                           
   9608 00F454                             spi_master_write:
   9609 00F454 08                           	PHP
   9610 00F455 E2 20                        	SEP		#$20
                                           	MEM		8
                                           	NDX		16
                                           
   9614 00F457 BA                           	TSX
   9615 00F458 B5 08                        	LDA		8,X
   9616 00F45A 85 C8                        	STA		bufptr
   9617 00F45C B5 09                        	LDA		9,X
   9618 00F45E 85 C9                        	STA		bufptr+1
   9619 00F460 B5 0A                        	LDA		10,X
   9620 00F462 85 CA                        	STA		bufptr+2
   9621 00F464 B5 0B                        	LDA		11,X
   9622 00F466 85 CB                        	STA		bufptr+3
                                           
   9624 00F468 A0 00 00                     	LDY		#0
   9625 00F46B                             .0001:
   9626 00F46B 42 B7 C8                     	LDA		{bufptr},Y
   9627 00F46E 8F 20 C0 FE                  	STA		SPI_TX_FIFO_DATA_REG
   9628 00F472 C8                           	INY
   9629 00F473 C0 00 02                     	CPY		#512
   9630 00F476 D0 F3                        	BNE		.0001
                                           
   9632 00F478 B5 04                        	LDA		4,X
   9633 00F47A 8F 07 C0 FE                  	STA		SPI_SD_SECT_7_0_REG
   9634 00F47E B5 05                        	LDA		5,X
   9635 00F480 8F 08 C0 FE                  	STA		SPI_SD_SECT_15_8_REG
   9636 00F484 B5 06                        	LDA		6,X
   9637 00F486 8F 09 C0 FE                  	STA		SPI_SD_SECT_23_16_REG
   9638 00F48A B5 07                        	LDA		7,X
   9639 00F48C 8F 0A C0 FE                  	STA		SPI_SD_SECT_31_24_REG
                                           
   9641 00F490 A9 03                        	LDA		#SPI_RW_WRITE_SD_BLOCK
   9642 00F492 8F 02 C0 FE                  	STA		SPI_TRANS_TYPE_REG
   9643 00F496 A9 01                        	LDA		#SPI_TRANS_START
   9644 00F498 8F 03 C0 FE                  	STA		SPI_TRANS_CTRL_REG
   9645 00F49C                             .0002:
   9646 00F49C AD B5 F3                     	LDA		SPI_TRANS_STS_REG		; wait for SPI transfer to complete
   9647 00F49F C9 01                        	CMP		#SPI_TRANS_BUSY
   9648 00F4A1 F0 F9                        	BEQ		.0002
   9649 00F4A3 AF 05 C0 FE                  	LDA		SPI_TRANS_ERROR_REG
   9650 00F4A7 4A                           	LSR
   9651 00F4A8 4A                           	LSR
   9652 00F4A9 4A                           	LSR
   9653 00F4AA 4A                           	LSR
   9654 00F4AB 29 03                        	AND		#3	; write errors
   9655 00F4AD C9 00                        	CMP		#SPI_WRITE_NO_ERROR
   9656 00F4AF F0 10                        	BEQ		.0004
   9657 00F4B1 28                           	PLP
                                           	MEM		16
   9659 00F4B2 F4 01 00                     	PEA		1
   9660 00F4B5 F4 0D F5                     	PEA		msgSpiWriteError
   9661 00F4B8 20 E5 EB                     	JSR		DisplayString
   9662 00F4BB A9 01 00                     	LDA		#1
   9663 00F4BE 42 C0 08                     	RTS		#8
   9664 00F4C1                             .0004:
   9665 00F4C1 28                           	PLP
   9666 00F4C2 A9 00 00                     	LDA		#0
   9667 00F4C5 42 C0 08                     	RTS		#8
                                           
   9669 00F4C8                             msgSpiInitError:
   9670 00F4C8 45 72 72 6F 72 20 69 6E      .byte	"Error initializing SPI master",$0D,$0A,$00
   9670 00F4D0 69 74 69 61 6C 69 7A 69    
   9670 00F4D8 6E 67 20 53 50 49 20 6D    
   9670 00F4E0 61 73 74 65 72 0D 0A 00    
                                         
   9671 00F4E8                             msgSpiInited:
   9672 00F4E8 53 50 49 20 6D 61 73 74      .byte	"SPI master inited",$0D,$0A,$00
   9672 00F4F0 65 72 20 69 6E 69 74 65    
   9672 00F4F8 64 0D 0A 00                
   9673 00F4FC                             msgSpiReadError:
   9674 00F4FC 53 50 49 20 72 65 61 64      .byte	"SPI read error",$0D,$0A,$00
   9674 00F504 20 65 72 72 6F 72 0D 0A    
   9674 00F50C 00                         
   9675 00F50D                             msgSpiWriteError:
   9676 00F50D 53 50 49 20 77 72 69 74      .byte	"SPI write error",$0D,$0A,$00
   9676 00F515 65 20 65 72 72 6F 72 0D    
   9676 00F51D 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; RTC driver for MCP7941x
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
   9684 00F51F                             rtc_init:
   9685 00F51F A9 35 00                     		LDA		#53					; constant for 125kHz I2C from 33MHz 
   9686 00F522 8F 00 C1 FE                  		STA		I2C_PRESCALE_LO
   9687 00F526 60                           		RTS
                                           
                                           ; Read all the RTC sram registers into a buffer
                                           
   9691 00F527                             rtc_read:
   9692 00F527 08                           		PHP
   9693 00F528 E2 30                        		SEP		#$30
                                           		MEM		8
                                           		NDX		8
   9696 00F52A A9 80                        		LDA		#$80				; enable I2C
   9697 00F52C 8F 02 C1 FE                  		STA		I2C_CONTROL
   9698 00F530 A9 DE                        		LDA		#$DE				; read address, write op
   9699 00F532 A0 90                        		LDY		#$90				; STA + wr bit
   9700 00F534 20 97 F5                     		JSR		rtc_wr_cmd
   9701 00F537 30 4D                        		BMI		.rxerr
   9702 00F539 A9 00                        		LDA		#$00				; address zero
   9703 00F53B A0 10                        		LDY		#$10				; wr bit
   9704 00F53D 20 97 F5                     		JSR		rtc_wr_cmd
   9705 00F540 30 44                        		BMI		.rxerr
   9706 00F542 A9 DF                        		LDA		#$DF				; read address, read op
   9707 00F544 A0 90                        		LDY		#$90				; STA + wr bit
   9708 00F546 20 97 F5                     		JSR		rtc_wr_cmd
   9709 00F549 30 3B                        		BMI		.rxerr
   9710 00F54B A2 00                        		LDX		#0
   9711 00F54D                             .0001:
   9712 00F54D A9 20                        		LDA		#$20				; rd bit
   9713 00F54F 8F 04 C1 FE                  		STA		I2C_CMD
   9714 00F553 20 8E F5                     		JSR		rtc_wait_tip
   9715 00F556 AF 04 C1 FE                  		LDA		I2C_STAT
   9716 00F55A 30 2A                        		BMI		.rxerr
   9717 00F55C AF 03 C1 FE                  		LDA		I2C_RX
   9718 00F560 9D 00 03                     		STA		RTCBuf,X
   9719 00F563 E8                           		INX
   9720 00F564 E0 5F                        		CPX		#$5F
   9721 00F566 D0 E5                        		BNE		.0001
   9722 00F568 A9 68                        		LDA		#$68				; STO, rd bit + nack
   9723 00F56A 8F 04 C1 FE                  		STA		I2C_CMD
   9724 00F56E 20 8E F5                     		JSR		rtc_wait_tip
   9725 00F571 AF 04 C1 FE                  		LDA		I2C_STAT
   9726 00F575 30 0F                        		BMI		.rxerr
   9727 00F577 AF 03 C1 FE                  		LDA		I2C_RX
   9728 00F57B 9D 00 03                     		STA		RTCBuf,X
   9729 00F57E A9 00                        		LDA		#0					; disable I2C and return 0
   9730 00F580 8F 02 C1 FE                  		STA		I2C_CONTROL
   9731 00F584 28                           		PLP
   9732 00F585 60                           		RTS
   9733 00F586                             .rxerr:
   9734 00F586 42 9C 02 C1 FE 00            		STZ		I2C_CONTROL			; disable I2C and return status
   9735 00F58C 28                           		PLP
   9736 00F58D 60                           		RTS
                                           
   9738 00F58E                             rtc_wait_tip:
   9739 00F58E                             .0001:
   9740 00F58E AF 04 C1 FE                  		LDA		I2C_STAT
   9741 00F592 29 04                        		AND		#$4					; transmit in progress bit
   9742 00F594 D0 F8                        		BNE		.0001
   9743 00F596 60                           		RTS
                                           
   9745 00F597                             rtc_wr_cmd:
   9746 00F597 8F 03 C1 FE                  		STA		I2C_TX
   9747 00F59B 42 8C 04 C1 FE 00            		STY		I2C_CMD
   9748 00F5A1 20 8E F5                     		JSR		rtc_wait_tip
   9749 00F5A4 AF 04 C1 FE                  		LDA		I2C_STAT
   9750 00F5A8 60                           		RTS
                                           
   9752 00F5A9                             rtc_write:
   9753 00F5A9 08                           		PHP
   9754 00F5AA E2 30                        		SEP		#$30
                                           		MEM		8
                                           		NDX		8
   9757 00F5AC A9 80                        		LDA		#$80				; enable I2C
   9758 00F5AE 8F 02 C1 FE                  		STA		I2C_CONTROL
   9759 00F5B2 A9 DE                        		LDA		#$DE				; read address, write op
   9760 00F5B4 A0 90                        		LDY		#$90				; STA + wr bit
   9761 00F5B6 20 97 F5                     		JSR		rtc_wr_cmd
   9762 00F5B9 30 2C                        		BMI		.rxerr
   9763 00F5BB A9 00                        		LDA		#$00				; address zero
   9764 00F5BD A0 10                        		LDY		#$10				; wr bit
   9765 00F5BF 20 97 F5                     		JSR		rtc_wr_cmd
   9766 00F5C2 30 23                        		BMI		.rxerr
   9767 00F5C4 A2 00                        		LDX		#0
   9768 00F5C6                             .0001:
   9769 00F5C6 BD 00 03                     		LDA		RTCBuf,X
   9770 00F5C9 A0 10                        		LDY		#$10
   9771 00F5CB 20 97 F5                     		JSR		rtc_wr_cmd
   9772 00F5CE 30 17                        		BMI		.rxerr
   9773 00F5D0 E8                           		INX
   9774 00F5D1 E0 5F                        		CPX		#$5F
   9775 00F5D3 D0 F1                        		BNE		.0001
   9776 00F5D5 BD 00 03                     		LDA		RTCBuf,X
   9777 00F5D8 A0 50                        		LDY		#$50				; STO, wr bit
   9778 00F5DA 20 97 F5                     		JSR		rtc_wr_cmd
   9779 00F5DD 30 08                        		BMI		.rxerr
   9780 00F5DF A9 00                        		LDA		#0					; disable I2C and return 0
   9781 00F5E1 8F 02 C1 FE                  		STA		I2C_CONTROL
   9782 00F5E5 28                           		PLP
   9783 00F5E6 60                           		RTS
   9784 00F5E7                             .rxerr:
   9785 00F5E7 42 9C 02 C1 FE 00            		STZ		I2C_CONTROL			; disable I2C and return status
   9786 00F5ED 28                           		PLP
   9787 00F5EE 60                           		RTS
                                           
   9789 00F5EF                             msgRtcReadFail:
   9790 00F5EF 52 54 43 20 72 65 61 64      	.byte	"RTC read/write failed.",$0D,$0A,$00
   9790 00F5F7 2F 77 72 69 74 65 20 66    
   9790 00F5FF 61 69 6C 65 64 2E 0D 0A    
   9790 00F607 00                         
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ; Get char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
                                           	MEM		16
                                           	NDX		16
   9802 00F608                             SuperGetch:
   9803 00F608 20 30 EF                     	JSR		KeybdGetCharNoWait
   9804 00F60B 29 FF 00                     	AND		#$FF
   9805 00F60E 42 40 00                     	RTC		#0
   9806 00F611 82 69 EB                     	BRL		TaskFC
                                           
                                           ; Put char routine for Supermon
                                           ;
   9810 00F614                             SuperPutch:
   9811 00F614 20 D6 EB                     	JSR		OutChar
   9812 00F617 42 40 00                     	RTC		#0
   9813 00F61A 82 60 EB                     	BRL		TaskFC
                                           
                                           ; Char get routine for BASIC
                                           ; Same thing as for Supermon, except carry flag needs to be inverted
                                           ; This routine should be called from a different context than the BIOS,
                                           ; otherwise the call will be ignored.
                                           ;
   9820 00F61D                             BasicGetch:
   9821 00F61D A9 F1 00                     	LDA		#$F1
   9822 00F620 8D 00 70                     	STA		$7000
   9823 00F623 20 30 EF                     	JSR		KeybdGetCharNoWait
   9824 00F626 29 FF 00                     	AND		#$FF
   9825 00F629 42 18                        	CMC
   9826 00F62B 42 40 00                     	RTC		#0
   9827 00F62E 82 4C EB                     	BRL		TaskFC
                                           
   9829 00F631                             xitBasic:
   9830 00F631 FA                           	PLX						; get rid of task to return to, we won't be returning
   9831 00F632 85 C0                        	STA		ExitCode
   9832 00F634 42 9C 07 5A 02 00            	STZ		TCB_status+7	; no longer ready
   9833 00F63A 64 CE                        	STZ		IOFocusTask
   9834 00F63C 64 CF                        	STZ		IOFocusTask+1
   9835 00F63E 42 CB 42 A2 00 00            	TSK		JMP:#0
   9836 00F644 82 36 EB                     	BRL		TaskFC
                                           
   9838 00F647                             warm_start:
   9839 00F647 42 E2 00 01                  	SEP		#$100		; 16 bit mode
   9840 00F64B C2 30                        	REP		#$30		; 16 bit MEM,NDX
                                           	MEM		16
                                           	NDX		16
   9843 00F64D A9 FF 3F                     	LDA		#$3FFF
   9844 00F650 1B                           	TAS
   9845 00F651 20 39 EC                     	JSR		CursorOn
   9846 00F654 82 47 EB                     	BRL		Mon1
                                           
                                           	cpu		FT832
   9849 00F657                             ICacheIL832:
   9850 00F657 42 E0 01                     	CACHE	#1			; 1= invalidate instruction line identified by accumulator
   9851 00F65A 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; SelectTaskToRun:
                                           ;
                                           ; Selects a task to run from the ready fifo. The ready fifo is really a 
                                           ; group of fifos, one each for a priority group. Priority groups are
                                           ; $0x, $1x, $2x, $3x, $4x
                                           ;----------------------------------------------------------------------------
                                           
   9861 00F65B                             StartQ:
   9862 00F65B 00 01 00 02 00 03 00 04      	.byte	0,1,0,2,0,3,0,4,0,1,0,2,0,3,0,4
   9862 00F663 00 01 00 02 00 03 00 04    
                                         
                                           
   9864 00F66B                             SelectTaskToRun:
   9865 00F66B A9 04 00                     	LDA		#4
   9866 00F66E 85 CC                        	STA		qcnt
   9867 00F670 A5 04                        	LDA		TickCount		; vary the starting queue to check
   9868 00F672 29 0F 00                     	AND		#$0F			; based on the tick count
   9869 00F675 A8                           	TAY
   9870 00F676 42 8B B9 5B F6               	LDA.B	StartQ,Y
   9871 00F67B 0A                           	ASL
   9872 00F67C AA                           	TAX
   9873 00F67D                             .nextQ:
   9874 00F67D                             .notReady:
   9875 00F67D BF 10 C2 FE                  	LDA		READY_FIFO_CNT,X	; get count of ready tasks in fifo
   9876 00F681 F0 18                        	BEQ		.fifoEmpty
   9877 00F683 BF 00 C2 FE                  	LDA		READY_FIFO,X	; get ready task from fifo
   9878 00F687 A8                           	TAY
   9879 00F688 42 8B 42 B9 00 5A 02 00      	LDA.B	TCB_status,Y	; check the status and make sure it's ready
                                         
   9880 00F690 C9 01 00                     	CMP		#TS_READY
   9881 00F693 D0 E8                        	BNE		.notReady
   9882 00F695 98                           	TYA
   9883 00F696 9F 00 C2 FE                  	STA		READY_FIFO,X	; add back to fifo as last entry
   9884 00F69A 60                           	RTS
                                           
                                           	; move to the next queue
   9887 00F69B                             .fifoEmpty:
   9888 00F69B E8                           	INX
   9889 00F69C E8                           	INX
   9890 00F69D E0 0A 00                     	CPX		#10
   9891 00F6A0 30 03                        	BLT		.0001
   9892 00F6A2 A2 00 00                     	LDX		#0				; cycle back around to first Q
   9893 00F6A5                             .0001:
   9894 00F6A5 C6 CC                        	DEC		qcnt
   9895 00F6A7 D0 D4                        	BNE		.nextQ
   9896 00F6A9 42 1A                        	TTA						; if all queues empty, keep running the current
   9897 00F6AB 60                           	RTS
                                           
                                           ;----------------------------------------------------------------------------
                                           ; Insert task into ready fifo.
                                           ;----------------------------------------------------------------------------
                                           
   9903 00F6AC                             InsertIntoReadyFifo:
   9904 00F6AC AA                           	TAX							; .X = task number (index into tables)
   9905 00F6AD A9 01 00                     	LDA		#TS_READY			; set task status to ready
   9906 00F6B0 42 8B 9F 00 5A 02            	STA.B	TCB_status,X
   9907 00F6B6 42 8B BF 00 58 02            	LDA.B	TCB_priority,X		; get the priority
   9908 00F6BC 4A                           	LSR							; use upper nybble to identify priority que
   9909 00F6BD 4A                           	LSR
   9910 00F6BE 4A                           	LSR
   9911 00F6BF 4A                           	LSR
   9912 00F6C0 0A                           	ASL
   9913 00F6C1 A8                           	TAY
   9914 00F6C2 8A                           	TXA
   9915 00F6C3 42 99 00 C2 FE 00            	STA		READY_FIFO,Y
   9916 00F6C9 60                           	RTS
                                           
                                           ; IRQ routine for all modes. The interrupted task must of had interrupts
                                           ; enabled and this status should be saved on the stack with the value of
                                           ; the status register. The RTI instruction will pop the status register off
                                           ; the stack and restore the interrupt enable.
                                           ; Note that all this routine does is switch to a task which has a different
                                           ; register set, so there's no need to stack and restore registers. The
                                           ; task switch also allows the routine to be located anywhere in the memory
                                           ; system, so we don't have to worry about using up bank 0 memory.
                                           
   9927 00F6CA                             IRQRout832:
   9928 00F6CA                             IRQRout816:
   9929 00F6CA                             IRQRout02:
   9930 00F6CA 42 A2 01 00                  	TSK		#1			; switch to the interrupt handling task
   9931 00F6CE 40                           	RTI
                                           
                                           ; This task has interrupts masked in it's startup record and therefore runs
                                           ; with interrupts masked as the task never enables interrupts. Note that it's
                                           ; important that interrupts are masked while this is running, otherwise the
                                           ; uncleared interrupt status would cause another interrupt resulting in an
                                           ; infinite interrupt loop.
                                           	MEM		16
   9939 00F6CF                             Task1:
   9940 00F6CF 42 8B AD 1F B0               	LDA.B	MPU_IRQ_STATUS	; check if counter expired
   9941 00F6D4 89 02 00                     	BIT		#2				; counter #1 IRQ active bit
   9942 00F6D7 F0 51                        	BEQ		.0001			; no IRQ ?
   9943 00F6D9 A5 04                        	LDA		TickCount		; increment the tick count
   9944 00F6DB 1A                           	INA						; lower 16 bits
   9945 00F6DC 85 04                        	STA		TickCount
   9946 00F6DE 42 3B FF 0F 42 8B 8F A4      	STA.B	$FFF:$D00A4		; update on-screen IRQ live indicator
   9946 00F6E6 00 0D                      
   9947 00F6E8 D0 02                        	BNE		.0002
   9948 00F6EA E6 06                        	INC		TickCount+2		; increment upper 16 bits of tick count
   9949 00F6EC                             .0002:
   9950 00F6EC A9 05 00                     	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9951 00F6EF 42 8B 8D 17 B0               	STA.B	CTR1_CTRL		; set control register clearing interrupt
   9952 00F6F4 42 3B 00 00 42 8B AF DF      	LDA.B	$0:$100DF		; Set flag for EhBASIC Irq
   9952 00F6FC 00 01                      
   9953 00F6FE 09 20 00                     	ORA		#$20
   9954 00F701 42 3B 00 00 42 8B 8F DF      	STA.B	$0:$100DF
   9954 00F709 00 01                      
   9955 00F70B                             .nextTo:
   9956 00F70B A9 01 00                     	LDA		#1
   9957 00F70E 42 8B 8F 00 C3 FE            	STA.B	TIMEOUT_LIST	; decrement the timeout list
   9958 00F714 EA                           	NOP						; might take up to 3 clock cycles
   9959 00F715 EA                           	NOP
   9960 00F716 AF 02 C3 FE                  	LDA		TIMEOUT_LIST+2	; get any timedout task
   9961 00F71A 30 05                        	BMI		.noMoreTos
   9962 00F71C 20 AC F6                     	JSR		InsertIntoReadyFifo
   9963 00F71F 80 EA                        	BRA		.nextTo
   9964 00F721                             .noMoreTos:
   9965 00F721 A5 D0                        	LDA		TaskSwitchEn	; only switch tasks if enabled
   9966 00F723 F0 05                        	BEQ		.0001
   9967 00F725 20 6B F6                     	JSR		SelectTaskToRun
   9968 00F728 FA                           	PLX						; get rid of task # saved on irq
   9969 00F729 48                           	PHA						; push the desired task
   9970 00F72A                             .0001:
   9971 00F72A 42 50                        	RIT					; return from interrupt task
   9972 00F72C 80 A1                        	BRA		Task1		; the next time task1 is run it will start here
                                           
   9974 00F72E                             BtnuIRQ:
   9975 00F72E 42 3B FF 0F 42 8B AF A0      	LDA.B	$FFF:$D00A0
   9975 00F736 00 0D                      
   9976 00F738 1A                           	INA
   9977 00F739 42 3B FF 0F 42 8B 8F A0      	STA.B	$FFF:$D00A0
   9977 00F741 00 0D                      
   9978 00F743 20 AA F3                     	JSR		spi_master_init
   9979 00F746 C9 00 00                     	CMP		#0
   9980 00F749 D0 1D                        	BNE		.0001
   9981 00F74B A2 00 00                     	LDX		#0
   9982 00F74E                             .0002:
   9983 00F74E F4 0F 00                     	PEA		$000F
   9984 00F751 8A                           	TXA
   9985 00F752 EB                           	XBA
   9986 00F753 0A                           	ASL
   9987 00F754 48                           	PHA
   9988 00F755 F4 00 00                     	PEA		0
   9989 00F758 F4 00 00                     	PEA		0
   9990 00F75B 86 94                        	STX		reg_x
   9991 00F75D 20 DD F3                     	JSR		spi_master_read
   9992 00F760 A6 94                        	LDX		reg_x
   9993 00F762 E8                           	INX
   9994 00F763 E0 80 00                     	CPX		#128
   9995 00F766 D0 E6                        	BNE		.0002
   9996 00F768                             .0001:
   9997 00F768 42 50                        	RIT
   9998 00F76A 80 C2                        	BRA		BtnuIRQ
                                           
                                           ; IRQ handler task - 32 bit
                                           ;
  10002 00F76C                             IRQTask:
                                           	MEM		8
                                           	NDX		32
  10005 00F76C                             IRQTask1:
  10006 00F76C AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
  10007 00F76F 89 02                        	BIT		#2
  10008 00F771 F0 16                        	BEQ		.0001
  10009 00F773 A6 04                        	LDX		TickCount		; increment the tick count
  10010 00F775 E8                           	INX
  10011 00F776 86 04                        	STX		TickCount
  10012 00F778 42 3B FF 0F 42 8B 42 8E      	STX.B	$FFF:$D00A2			; update on-screen IRQ live indicator
  10012 00F780 A2 00 0D 00                
  10013 00F784 A9 05                        	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
  10014 00F786 8D 17 B0                     	STA		CTR1_CTRL
  10015 00F789                             .0001:
  10016 00F789 42 60                        	RTT					; go back to interrupted task
  10017 00F78B 80 DF                        	BRA		IRQTask1	; the next time task is run it will start here
                                           
                                           ; This little task sample runs in native 32 bit mode and displays
                                           ; "Hello World!" on the screen.
                                           
                                           	CPU		FT832
                                           	MEM		8
                                           	NDX		32
                                           
  10026 00F78D                             Task2:
  10027 00F78D A2 F8 01 00 00               	LDX		#84*2*3
  10028 00F792                             .0003:
  10029 00F792 A0 00 00 00 00               	LDY		#0
  10030 00F797                             .0002:
  10031 00F797 42 1B B9 B2 F7               	LDA		CS:msgHelloWorld,Y
  10032 00F79C F0 10                        	BEQ		.0001
  10033 00F79E 20 CD E9                     	JSR		AsciiToScreen8
  10034 00F7A1 42 3B FF 0F 9F 00 00 0D      	STA		$FFF:VIDBUF,X
                                         
  10035 00F7A9 E8                           	INX
  10036 00F7AA E8                           	INX
  10037 00F7AB C8                           	INY
  10038 00F7AC 80 E9                        	BRA		.0002
  10039 00F7AE                             .0001:
  10040 00F7AE 42 60                        	RTT
  10041 00F7B0 80 E0                        	BRA		.0003
                                           
  10043 00F7B2                             msgHelloWorld:
  10044 00F7B2 0D 0A 48 65 6C 6C 6F 20      	.byte	CR,LF,"Hello World!",CR,LF,0
  10044 00F7BA 57 6F 72 6C 64 21 0D 0A    
  10044 00F7C2 00                         
                                           
                                           	NDX		16
                                           	MEM		16
                                           
  10049 00F7C3                             BrkTask:
  10050 00F7C3 42 EE 00 00 D0 FF            	INC		$FFD00000
  10051 00F7C9 42 60                        	RTT
  10052 00F7CB 80 F6                        	BRA		BrkTask
                                           
                                           ; The following store sequence for the benefit of Supermon816
                                           ;
  10056 00F7CD                             BrkRout:
  10057 00F7CD 0B                           	PHD
  10058 00F7CE 8B                           	PHB
  10059 00F7CF C2 30                        	REP		#$30
  10060 00F7D1 48                           	PHA
  10061 00F7D2 DA                           	PHX
  10062 00F7D3 5A                           	PHY
  10063 00F7D4 6C 02 01                     	JMP		($0102)		; This jump normally points to BrkRout1
  10064 00F7D7                             BrkRout1:
  10065 00F7D7 C2 30                        	REP		#$30
  10066 00F7D9 7A                           	PLY
  10067 00F7DA FA                           	PLX
  10068 00F7DB 68                           	PLA
  10069 00F7DC AB                           	PLB
  10070 00F7DD 2B                           	PLD
  10071 00F7DE E2 20                        	SEP		#$20
  10072 00F7E0 68                           	PLA
  10073 00F7E1 C2 30                        	REP		#$30
  10074 00F7E3 68                           	PLA
  10075 00F7E4 20 B6 EC                     	JSR		DispWord
  10076 00F7E7 A2 00 00                     	LDX		#0
  10077 00F7EA A0 40 00                     	LDY		#64
  10078 00F7ED                             .0001:
  10079 00F7ED 42 F0                        	.word	$f042		; pchist
  10080 00F7EF 20 B6 EC                     	JSR		DispWord
  10081 00F7F2 A9 20 00                     	LDA		#' '
  10082 00F7F5 20 D6 EB                     	JSR		OutChar
  10083 00F7F8 E8                           	INX
  10084 00F7F9 88                           	DEY
  10085 00F7FA D0 F1                        	BNE		.0001
  10086 00F7FC A9 FF FF                     	LDA		#$FFFF
  10087 00F7FF 8D 00 70                     	STA		$7000
  10088 00F802                             Hung:
  10089 00F802 80 FE                        	BRA		Hung
                                           
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------
                                           	; I/O page is located at $F0xx
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------	
                                           	;org		$F100
                                           
  10098 00F804                             LineTbl:
  10099 00F804 00 00                        	.WORD	0
  10100 00F806 54 00                        	.WORD	TEXTCOLS
  10101 00F808 A8 00                        	.WORD	TEXTCOLS*2
  10102 00F80A FC 00                        	.WORD	TEXTCOLS*3
  10103 00F80C 50 01                        	.WORD	TEXTCOLS*4
  10104 00F80E A4 01                        	.WORD	TEXTCOLS*5
  10105 00F810 F8 01                        	.WORD	TEXTCOLS*6
  10106 00F812 4C 02                        	.WORD	TEXTCOLS*7
  10107 00F814 A0 02                        	.WORD	TEXTCOLS*8
  10108 00F816 F4 02                        	.WORD	TEXTCOLS*9
  10109 00F818 48 03                        	.WORD	TEXTCOLS*10
  10110 00F81A 9C 03                        	.WORD	TEXTCOLS*11
  10111 00F81C F0 03                        	.WORD	TEXTCOLS*12
  10112 00F81E 44 04                        	.WORD	TEXTCOLS*13
  10113 00F820 98 04                        	.WORD	TEXTCOLS*14
  10114 00F822 EC 04                        	.WORD	TEXTCOLS*15
  10115 00F824 40 05                        	.WORD	TEXTCOLS*16
  10116 00F826 94 05                        	.WORD	TEXTCOLS*17
  10117 00F828 E8 05                        	.WORD	TEXTCOLS*18
  10118 00F82A 3C 06                        	.WORD	TEXTCOLS*19
  10119 00F82C 90 06                        	.WORD	TEXTCOLS*20
  10120 00F82E E4 06                        	.WORD	TEXTCOLS*21
  10121 00F830 38 07                        	.WORD	TEXTCOLS*22
  10122 00F832 8C 07                        	.WORD	TEXTCOLS*23
  10123 00F834 E0 07                        	.WORD	TEXTCOLS*24
  10124 00F836 34 08                        	.WORD	TEXTCOLS*25
  10125 00F838 88 08                        	.WORD	TEXTCOLS*26
  10126 00F83A DC 08                        	.WORD	TEXTCOLS*27
  10127 00F83C 30 09                        	.WORD	TEXTCOLS*28
  10128 00F83E 84 09                        	.WORD	TEXTCOLS*29
  10129 00F840 D8 09                        	.WORD	TEXTCOLS*30
                                           
  10131 00F842                             TaskStartTbl:
  10132 00F842 00 00                        	.WORD	0			; CS
  10133 00F844 00 00                        	.WORD	0			; DS
  10134 00F846 00 00                        	.WORD	0			; SS
  10135 00F848 CD E0                        	.WORD	Task0		; PC
  10136 00F84A 00                           	.BYTE	Task0>>16	; PB
  10137 00F84B 00 00                        	.WORD	0			; acc
  10138 00F84D 00 00                        	.WORD	0
  10139 00F84F 00 00                        	.WORD	0			; x
  10140 00F851 00 00                        	.WORD	0
  10141 00F853 00 00                        	.WORD	0			; y
  10142 00F855 00 00                        	.WORD	0
  10143 00F857 FF 3F                        	.WORD	$3FFF		; sp
  10144 00F859 00 00                        	.WORD	0
  10145 00F85B 04                           	.BYTE	4			; SR
  10146 00F85C 01                           	.BYTE	1			; SR extension
  10147 00F85D 00                           	.BYTE	0			; DB
  10148 00F85E 00 00                        	.WORD	0			; DPR
  10149 00F860 00 00                        	.WORD	0
                                           
                                           	; TASK #1
                                           	; Interrupt handler task
  10153 00F862 00 00                        	.WORD	0			; CS
  10154 00F864 05 00                        	.WORD	5			; DS
  10155 00F866 05 00                        	.WORD	5			; SS
  10156 00F868 CF F6                        	.WORD	Task1		; PC
  10157 00F86A 00                           	.BYTE	Task1>>16
  10158 00F86B 00 00                        	.WORD	0			; acc
  10159 00F86D 00 00                        	.WORD	0
  10160 00F86F 00 00                        	.WORD	0			; x
  10161 00F871 00 00                        	.WORD	0
  10162 00F873 00 00                        	.WORD	0			; y
  10163 00F875 00 00                        	.WORD	0
  10164 00F877 FF 3B                        	.WORD	$3BFF		; sp
  10165 00F879 00 00                        	.WORD	0
  10166 00F87B 04                           	.BYTE	4			; SR
  10167 00F87C 01                           	.BYTE	1			; SR extension
  10168 00F87D 00                           	.BYTE	0			; DB
  10169 00F87E 00 00                        	.WORD	0			; DPR
  10170 00F880 00 00                        	.WORD	0
                                           
  10172 00F882 00 00                        	.WORD	0			; CS
  10173 00F884 00 00                        	.WORD	0			; DS
  10174 00F886 00 00                        	.WORD	0			; SS
  10175 00F888 8D F7                        	.WORD	Task2		; PC
  10176 00F88A 00                           	.BYTE	Task2>>16
  10177 00F88B 00 00                        	.WORD	0			; acc
  10178 00F88D 00 00                        	.WORD	0
  10179 00F88F 00 00                        	.WORD	0			; x
  10180 00F891 00 00                        	.WORD	0
  10181 00F893 00 00                        	.WORD	0			; y
  10182 00F895 00 00                        	.WORD	0
  10183 00F897 FF 37                        	.WORD	$37FF		; sp
  10184 00F899 00 00                        	.WORD	0
  10185 00F89B 20                           	.BYTE	$20			; SR			; eight bit mem
  10186 00F89C 02                           	.BYTE	2			; SR extension
  10187 00F89D 00                           	.BYTE	0			; DB
  10188 00F89E 00 00                        	.WORD	0			; DPR
  10189 00F8A0 00 00                        	.WORD	0
                                           
                                           	; TASK #3
                                           	; Button Interrupt handler task
  10193 00F8A2 00 00                        	.WORD	0			; CS
  10194 00F8A4 05 00                        	.WORD	5			; DS
  10195 00F8A6 05 00                        	.WORD	5			; SS
  10196 00F8A8 2E F7                        	.WORD	BtnuIRQ		; PC
  10197 00F8AA 00                           	.BYTE	BtnuIRQ>>16
  10198 00F8AB 00 00                        	.WORD	0			; acc
  10199 00F8AD 00 00                        	.WORD	0
  10200 00F8AF 00 00                        	.WORD	0			; x
  10201 00F8B1 00 00                        	.WORD	0
  10202 00F8B3 00 00                        	.WORD	0			; y
  10203 00F8B5 00 00                        	.WORD	0
  10204 00F8B7 FF 3A                        	.WORD	$3AFF		; sp
  10205 00F8B9 00 00                        	.WORD	0
  10206 00F8BB 04                           	.BYTE	4			; SR
  10207 00F8BC 01                           	.BYTE	1			; SR extension
  10208 00F8BD 00                           	.BYTE	0			; DB
  10209 00F8BE 00 00                        	.WORD	0			; DPR
  10210 00F8C0 00 00                        	.WORD	0
                                           
  10212 00F8C2 00 00                        	.WORD	0			; CS
  10213 00F8C4 00 00                        	.WORD	0			; DS
  10214 00F8C6 00 00                        	.WORD	0			; SS
  10215 00F8C8 C3 F7                        	.WORD	BrkTask		; PC
  10216 00F8CA 00                           	.BYTE	BrkTask>>16
  10217 00F8CB 00 00                        	.WORD	0			; acc
  10218 00F8CD 00 00                        	.WORD	0
  10219 00F8CF 00 00                        	.WORD	0			; x
  10220 00F8D1 00 00                        	.WORD	0
  10221 00F8D3 00 00                        	.WORD	0			; y
  10222 00F8D5 00 00                        	.WORD	0
  10223 00F8D7 FF 2F                        	.WORD	$2FFF		; sp
  10224 00F8D9 00 00                        	.WORD	0
  10225 00F8DB 00                           	.BYTE	0			; SR
  10226 00F8DC 01                           	.BYTE	1			; SR extension
  10227 00F8DD 00                           	.BYTE	0			; DB
  10228 00F8DE 00 00                        	.WORD	0			; DPR
  10229 00F8E0 00 00                        	.WORD	0
                                           
                                           	; task #5
                                           	; DS is placed at $7800
  10233 00F8E2 00 00                        	.WORD	0			; CS
  10234 00F8E4 00 00                        	.WORD	0    		; DS
  10235 00F8E6 00 00                        	.WORD	0			; SS
  10236 00F8E8 EB D8                        	.WORD	InvadersTask	; PC
  10237 00F8EA 00                           	.BYTE	InvadersTask>>16
  10238 00F8EB 00 00                        	.WORD	0			; acc
  10239 00F8ED 00 00                        	.WORD	0
  10240 00F8EF 00 00                        	.WORD	0			; x
  10241 00F8F1 00 00                        	.WORD	0
  10242 00F8F3 00 00                        	.WORD	0			; y
  10243 00F8F5 00 00                        	.WORD	0
  10244 00F8F7 FF 2B                        	.WORD	$2BFF		; sp
  10245 00F8F9 00 00                        	.WORD	0
  10246 00F8FB 00                           	.BYTE	0			; SR
  10247 00F8FC 01                           	.BYTE	1			; SR extension
  10248 00F8FD 00                           	.BYTE	0			; DB
  10249 00F8FE 00 00                        	.WORD	0			; DPR
  10250 00F900 00 00                        	.WORD	0
                                           
  10252 00F902 00 00                        	.WORD	0			; CS
  10253 00F904 00 00                        	.WORD	0			; DS
  10254 00F906 00 00                        	.WORD	0			; SS
  10255 00F908 6C F7                        	.WORD	IRQTask		; PC
  10256 00F90A 00                           	.BYTE	IRQTask>>16
  10257 00F90B 00 00                        	.WORD	0			; acc
  10258 00F90D 00 00                        	.WORD	0
  10259 00F90F 00 00                        	.WORD	0			; x
  10260 00F911 00 00                        	.WORD	0
  10261 00F913 00 00                        	.WORD	0			; y
  10262 00F915 00 00                        	.WORD	0
  10263 00F917 FF 27                        	.WORD	$27FF		; sp
  10264 00F919 00 00                        	.WORD	0
  10265 00F91B 24                           	.BYTE	$24			; SR	8 bit acc, mask interrupts
  10266 00F91C 02                           	.BYTE	2			; SR extension - 832 mode
  10267 00F91D 00                           	.BYTE	0			; DB
  10268 00F91E 00 00                        	.WORD	0			; DPR
  10269 00F920 00 00                        	.WORD	0
                                           
                                           	; task 7 (Basic)
  10272 00F922 FD 0F                        	.WORD	$FFD		; CS
  10273 00F924 FD 0F                        	.WORD	$FFD		; DS
  10274 00F926 FD 0F                        	.WORD	$FFD		; SS
  10275 00F928 00 C0                        	.WORD	$C000		; PC
  10276 00F92A 00                           	.BYTE	$00
  10277 00F92B 00 00                        	.WORD	0			; acc
  10278 00F92D 00 00                        	.WORD	0
  10279 00F92F 00 00                        	.WORD	0			; x
  10280 00F931 00 00                        	.WORD	0
  10281 00F933 00 00                        	.WORD	0			; y
  10282 00F935 00 00                        	.WORD	0
  10283 00F937 FF 01                        	.WORD	$01FF		; sp
  10284 00F939 00 00                        	.WORD	0
  10285 00F93B 00                           	.BYTE	0			; SR
  10286 00F93C 00                           	.BYTE	0			; SR extension - 832 mode
  10287 00F93D 00                           	.BYTE	0			; DB
  10288 00F93E 00 00                        	.WORD	0			; DPR
  10289 00F940 3F 00                        	.WORD	63			; map
                                           
                                           	; task 8 (Supermon)
  10292 00F942 00 00                        	.WORD	$0			; CS
  10293 00F944 05 00                        	.WORD	$5			; DS
  10294 00F946 05 00                        	.WORD	$5			; SS
  10295 00F948 00 C0                        	.WORD	$C000		; PC
  10296 00F94A 00                           	.BYTE	$00
  10297 00F94B 00 00                        	.WORD	0			; acc
  10298 00F94D 00 00                        	.WORD	0
  10299 00F94F 00 00                        	.WORD	0			; x
  10300 00F951 00 00                        	.WORD	0
  10301 00F953 00 00                        	.WORD	0			; y
  10302 00F955 00 00                        	.WORD	0
  10303 00F957 FF 2B                        	.WORD	$2BFF		; sp
  10304 00F959 00 00                        	.WORD	0
  10305 00F95B 00                           	.BYTE	0			; SR
  10306 00F95C 01                           	.BYTE	1			; SR extension - 832 mode
  10307 00F95D 00                           	.BYTE	0			; DB
  10308 00F95E 00 00                        	.WORD	0			; DPR
  10309 00F960 00 00                        	.WORD	0			; map
                                           
                                           	; task 9 (single step)
  10312 00F962 00 00                        	.WORD	0			; CS
  10313 00F964 00 00                        	.WORD	0			; DS
  10314 00F966 00 00                        	.WORD	0			; SS
  10315 00F968 8C E8                        	.WORD	SSMInit		; PC
  10316 00F96A 00                           	.BYTE	SSMTnit>>16
  10317 00F96B 00 00                        	.WORD	0			; acc
  10318 00F96D 00 00                        	.WORD	0
  10319 00F96F 00 00                        	.WORD	0			; x
  10320 00F971 00 00                        	.WORD	0
  10321 00F973 00 00                        	.WORD	0			; y
  10322 00F975 00 00                        	.WORD	0
  10323 00F977 FF 33                        	.WORD	$33FF		; sp
  10324 00F979 00 00                        	.WORD	0
  10325 00F97B 04                           	.BYTE	$4			; SR	16 bit regs, mask interrupts
  10326 00F97C 01                           	.BYTE	1			; SR extension - 816 mode
  10327 00F97D 00                           	.BYTE	0			; DB
  10328 00F97E 00 00                        	.WORD	0			; DPR
  10329 00F980 00 00                        	.WORD	0
                                           
  10331 00F982                             msgRegs:
  10332 00F982 0D 0A                        	.byte	CR,LF
  10333 00F984 20 20 20 20 20 20 20 20          .byte   "             xxxsxi31",CR,LF
  10333 00F98C 20 20 20 20 20 78 78 78    
  10333 00F994 73 78 69 33 31 0D 0A       
  10334 00F99B 20 20 43 53 20 20 50 42          .byte   "  CS  PB PC  xxxsxn26NVmxDIZC    .A       .X       .Y       SP  ",CR,LF,0
  10334 00F9A3 20 50 43 20 20 78 78 78    
  10334 00F9AB 73 78 6E 32 36 4E 56 6D    
  10334 00F9B3 78 44 49 5A 43 20 20 20    
  10334 00F9BB 20 2E 41 20 20 20 20 20    
  10334 00F9C3 20 20 2E 58 20 20 20 20    
  10334 00F9CB 20 20 20 2E 59 20 20 20    
  10334 00F9D3 20 20 20 20 53 50 20 20    
  10334 00F9DB 0D 0A 00                   
  10335 00F9DE                             msgRegs2:
  10336 00F9DE 0D 0A                        	.byte	CR,LF
  10337 00F9E0 20 20 53 53 20 20 20 44      	.byte	"  SS   DS  DB  DP   BL  MP",CR,LF,0
  10337 00F9E8 53 20 20 44 42 20 20 44    
  10337 00F9F0 50 20 20 20 42 4C 20 20    
  10337 00F9F8 4D 50 0D 0A 00             
  10338 00F9FD                             msgErr:
  10339 00F9FD 2A 2A 2A 45 72 72 0D 0A      	.byte	"***Err",CR,LF,0
  10339 00FA05 00                         
                                           
                                           	cpu		FT832
                                           	MEM		32
                                           	NDX		32
  10344 00FA06 A9 78 56 34 12               	LDA		#$12345678
  10345 00FA0B A2 32 54 76 98               	LDX		#$98765432
  10346 00FA10 42 8B 42 97 23               	STA.B	{$23},Y
  10347 00FA15 42 BB 42 BC 56 55 45 44      	LDY.UH	$44455556,X
                                         
  10348 00FA1D 42 1B 42 AB 42 BD 56 55      	LDA.H	CS:$44455556,X
  10348 00FA25 45 44                      
  10349 00FA27 42 3B 88 88 42 9B B9 34      	LDA.UB	SEG $8888:$1234,Y
  10349 00FA2F 12                         
  10350 00FA30 42 22 00 E0 00 00 00         	JSF	    $0000:start
                                           	RTF
  10352 00FA37 42 3B 21 98 7D 00 12         	ADC     SEG $9821:$1200,X
  10353 00FA3E 42 3B 21 08 5D 00 12         	EOR     $821:$1200,X
  10354 00FA45 42 3B 41 08 45 12            	EOR     $841:$12
  10355 00FA4B 42 DA 42 F7 24               	SBC     FAR {$24},Y
  10356 00FA50 42 DA 32 25                  	AND     FAR($25)
  10357 00FA54 42 DA 01 26                  	ORA     FAR ($26,x)
  10358 00FA58 42 A2 02 00                  	TSK		#2
  10359 00FA5C 42 3A                        	TSK
  10360 00FA5E 42 4C 00 00 01 00            	LDT		$10000,X
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; +---------------------------+
                                           ; | block status / ptr to free|
                                           ; +---------------------------+
                                           ; | pointer to previous block |
                                           ; +---------------------------+
                                           ; | pointer to next block     |
                                           ; +---------------------------+
                                           ;
                                           	MEM		32
                                           	NDX		32
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
  10379 00FA64                             FreeSysMem:
  10380 00FA64 38                           	SEC
  10381 00FA65 E9 0C 00 00 00               	SBC		#12		;	backup to block header
  10382 00FA6A A8                           	TAY				;	.Y = pointer to block to free (this)
  10383 00FA6B 08                           	PHP				; save interrupt mask
  10384 00FA6C 78                           	SEI				; no interrupts
                                           	STZ		$0,Y	; set status as free
  10386 00FA6D B6 08                        	LDX		$8,Y	;	.X = pointer to next block
  10387 00FA6F B5 00                        	LDA		$0,X	;	.A = next->status
  10388 00FA71 F0 39                        	BEQ		.0001	;	branch if not free
                                           	; merge block with next free block
  10390 00FA73 B5 08                        	LDA		$8,X	;   .A = pointer to next next block
  10391 00FA75 99 08 00                     	STA		$8,Y	;
  10392 00FA78 AA                           	TAX
  10393 00FA79 94 04                        	STY		$4,X	;	next->next->prev = this
  10394 00FA7B                             .0001:
                                           	; merge block with a previous free block
  10396 00FA7B B6 04                        	LDX		$4,Y	;	.X = pointer to prev block
  10397 00FA7D B5 00                        	LDA		$0,X	;	.A = prev->status
  10398 00FA7F F0 1F                        	BEQ		.0002	;	branch if not free
  10399 00FA81 B9 08 00                     	LDA		$8,Y	;   prev->next = this->next
  10400 00FA84 95 08                        	STA		$8,X
  10401 00FA86 A8                           	TAY				;	.Y = this->next
  10402 00FA87 96 04                        	STX		$4,Y	;	this->next->prev = this->prev
  10403 00FA89 9B                           	TXY
  10404 00FA8A                             .0002:
  10405 00FA8A AD 85 FA                     	LDA		heap_free_ptr
  10406 00FA8D 99 00 00                     	STA		$0,Y
  10407 00FA90 8C 85 FA                     	STY		heap_free_ptr
  10408 00FA93 28                           	PLP
  10409 00FA94 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	; round allocation size to mmu available sizes
                                           
  10415 00FA95 A2 00 00 00 00               	LDX		#0
  10416 00FA9A 18                           	CLC				; add room for header
  10417 00FA9B 69 0C 00 00 00               	ADC		#12
  10418 00FAA0                             .0002:
  10419 00FAA0 DD D5 FA                     	CMP		mmas,X
  10420 00FAA3 42 B0 D5                     	BLE		.0001
  10421 00FAA6 E8                           	INX
  10422 00FAA7 E8                           	INX
  10423 00FAA8 E8                           	INX
  10424 00FAA9 E8                           	INX
  10425 00FAAA 80 F4                        	BRA		.0002
  10426 00FAAC                             .0001:
  10427 00FAAC BD D5 FA                     	LDA		mmas,X
  10428 00FAAF AA                           	TAX
  10429 00FAB0 AC A9 FA                     	LDY		free_heap_ptr
                                           	; subtract .Y from .A
  10431 00FAB3 38                           	SEC
  10432 00FAB4 B9 08 00                     	LDA		$8,Y
  10433 00FAB7 8C AF FA                     	STY		tmpy
  10434 00FABA ED AF FA                     	SBC		tmpy
  10435 00FABD DD D5 FA                     	CMP		mmas,X
  10436 00FAC0 30 F5                        	BLT		.0003
                                           	; here block is big enough
  10438 00FAC2 48                           	PHA
  10439 00FAC3 B9 00 00                     	LDA		$0,Y
  10440 00FAC6 8D A9 FA                     	STA		free_heap_ptr
                                           	STZ		$0,Y
  10442 00FAC9 68                           	PLA
  10443 00FACA 38                           	SEC
  10444 00FACB FD D5 FA                     	SBC		mmas,X
  10445 00FACE C9 FF 00 00 00               	CMP		#$0FF
  10446 00FAD3 30 00                        	BLT		.0004
                                           
  10448 00FAD5                             .0004:
                                           	
                                           
                                           ; Memory management allocation sizes
                                           ;
  10453 00FAD5                             mmas:
  10454 00FAD5 00 00 00 00                  	WORD	$0000,$0000
  10455 00FAD9 FF 00 00 00                  	WORD	$00FF,$0000
  10456 00FADD FF 03 00 00                  	WORD	$03FF,$0000
  10457 00FAE1 FF 0F 00 00                  	WORD	$0FFF,$0000
  10458 00FAE5 FF 3F 00 00                  	WORD	$3FFF,$0000
  10459 00FAE9 FF FF 00 00                  	WORD	$FFFF,$0000
  10460 00FAED FF FF 03 00                  	WORD	$FFFF,$0003
  10461 00FAF1 FF FF 0F 00                  	WORD	$FFFF,$000F
  10462 00FAF5 FF FF 3F 00                  	WORD	$FFFF,$003F
  10463 00FAF9 FF FF FF 00                  	WORD	$FFFF,$00FF
  10464 00FAFD FF FF FF 03                  	WORD	$FFFF,$03FF
  10465 00FB01 FF FF FF 0F                  	WORD	$FFFF,$0FFF
  10466 00FB05 FF FF FF 3F                  	WORD	$FFFF,$3FFF
  10467 00FB09 FF FF FF FF                  	WORD	$FFFF,$FFFF
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	MEM		16
                                           	NDX		16
  10475 00FB0D 4C D5 FB                     	JMP		MusicPlay
  10476 00FB10                             beep:
  10477 00FB10 A9 0F 00                     	LDA		#15					; set volume to max
  10478 00FB13 42 3B FF 0F 8F B0 B0 0E      	STA		$FFF:SID+SID_VOLUME		
                                         
  10479 00FB1B A9 6F 0C                     	LDA		#$0C6F				; 10C6F = 800 Hz
  10480 00FB1E 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  10481 00FB26 A9 01 00                     	LDA		#1
  10482 00FB29 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  10483 00FB31 A9 C3 00                     	LDA		#195				; 2ms
  10484 00FB34 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  10485 00FB3C 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  10485 00FB44 0E 00                      
  10486 00FB46 A9 28 09                     	LDA		#2344				; 24 ms decay
  10487 00FB49 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  10488 00FB51 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  10488 00FB59 0E 00                      
  10489 00FB5B A9 80 00                     	LDA		#$80				; 50% sustain level
  10490 00FB5E 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  10491 00FB66 A9 BC BE                     	LDA		#48828				; 500 ms release
  10492 00FB69 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  10493 00FB71 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  10493 00FB79 0E 00                      
  10494 00FB7B A9 01 00                     	LDA		#1					; reset envelope generator
  10495 00FB7E 42 3B FF 0F 8F 0A B0 0E      	STA		$FFF:SID+SID_CTRL0+2
                                         
  10496 00FB86 EA                           	NOP
  10497 00FB87 EA                           	NOP
  10498 00FB88 42 3B FF 0F 42 9C 0A B0      	STZ		$FFF:SID+SID_CTRL0+2
  10498 00FB90 0E 00                      
  10499 00FB92 A9 04 15                     	LDA		#$1504				; gate on
  10500 00FB95 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
                                           	; delay for about 1s
  10502 00FB9D A0 27 00                     	LDY		#39
  10503 00FBA0                             .0002:
  10504 00FBA0 A2 FF FF                     	LDX		#65535
  10505 00FBA3                             .0001:
  10506 00FBA3 CA                           	DEX
  10507 00FBA4 D0 FD                        	BNE		.0001
  10508 00FBA6 88                           	DEY
  10509 00FBA7 D0 F7                        	BNE		.0002
  10510 00FBA9 A9 04 05                     	LDA		#$0504				; gate off
  10511 00FBAC 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10512 00FBB4 60                           	RTS
  10513 00FBB5                             	
  10514 00FBB5 01 00                        	dh	1
  10515 00FBB7 89 83                        	dw	33673		; G4
  10516 00FBB9 0C 00                        	dw	12			; 1/8 sec
  10517 00FBBB 04 00                        	dw	4			; space
                                           
  10519 00FBBD 01 00                        	dh	1
  10520 00FBBF 89 83                        	dw	33673		; G4
  10521 00FBC1 0C 00                        	dw	12			; 1/8
  10522 00FBC3 04 00                        	dw	4			; space
                                           
  10524 00FBC5 01 00                        	dh	1
  10525 00FBC7 89 83                        	dw	33673		; G4
  10526 00FBC9 0C 00                        	dw	12			; 1/8
  10527 00FBCB 04 00                        	dw	4			; space
                                           
  10529 00FBCD 00 00                        	dh	0
  10530 00FBCF 00 00                        	dw	0			; G4
  10531 00FBD1 00 00                        	dw	0			; 1/8
  10532 00FBD3 00 00                        	dw	0			; space
                                           
  10534 00FBD5                             MusicPlay:
  10535 00FBD5 A2 00 00                     	LDX		#0
  10536 00FBD8 A9 C3 00                     	LDA		#195				; 2ms
  10537 00FBDB 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
  10538 00FBE3 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
  10538 00FBEB 0E 00                      
  10539 00FBED A9 28 09                     	LDA		#2344				; 24 ms decay
  10540 00FBF0 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
  10541 00FBF8 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
  10541 00FC00 0E 00                      
  10542 00FC02 A9 D0 00                     	LDA		#$D0				; sustain level
  10543 00FC05 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
  10544 00FC0D A9 F8 11                     	LDA		#4600				; ??? ms release
  10545 00FC10 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
  10546 00FC18 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
  10546 00FC20 0E 00                      
  10547 00FC22                             .0001:
  10548 00FC22 BD B5 FB                     	LDA		music_tbl,x			; check for last note
  10549 00FC25 F0 56                        	BEQ		.xit
  10550 00FC27 BD B7 FB                     	LDA		music_tbl+2,x			; set the frequency
  10551 00FC2A 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
  10552 00FC32 BD B9 FB                     	LDA		music_tbl+4,x
  10553 00FC35 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
  10554 00FC3D A9 04 15                     	LDA		#$1504				; gate on
  10555 00FC40 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10556 00FC48 78                           	SEI
  10557 00FC49 BD BB FB                     	LDA		music_tbl+6,x
  10558 00FC4C 8D 04 01                     	STA		timeout1
  10559 00FC4F BD BD FB                     	LDA		music_tbl+8,x
  10560 00FC52 8D 06 01                     	STA		timeout1+2
  10561 00FC55 20 7E FC                     	JSR		MusicWaitTimeout
  10562 00FC58 A9 04 05                     	LDA		#$0504				; gate off
  10563 00FC5B 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
  10564 00FC63 78                           	SEI
  10565 00FC64 BD BF FB                     	LDA		music_tbl+10,x		; note release delay
  10566 00FC67 8D 04 01                     	STA		timeout1
  10567 00FC6A BD C1 FB                     	LDA		music_tbl+12,x
  10568 00FC6D 8D 06 01                     	STA		timeout1+2
  10569 00FC70 20 7E FC                     	JSR		MusicWaitTimeout
  10570 00FC73 E8                           	INX
  10571 00FC74 E8                           	INX
  10572 00FC75 42 E8                        	INX4
  10573 00FC77 42 E8                        	INX4
  10574 00FC79 42 E8                        	INX4
  10575 00FC7B 80 A5                        	BRA		.0001
  10576 00FC7D                             .xit:
  10577 00FC7D 60                           	RTS
                                           
  10579 00FC7E                             MusicWaitTimeout:
  10580 00FC7E                             .0001:
  10581 00FC7E 58                           	CLI
  10582 00FC7F EA                           	NOP
  10583 00FC80 EA                           	NOP
  10584 00FC81 78                           	SEI
  10585 00FC82 AD 04 01                     	LDA		timeout1
  10586 00FC85 0D 06 01                     	ORA		timeout1+2
  10587 00FC88 D0 F4                        	BNE		.0001
  10588 00FC8A 58                           	CLI
  10589 00FC8B 60                           	RTS
                                           
  10591 00FC8C                             MusicTimeoutIRQ:
  10592 00FC8C C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
  10595 00FC8E AD 04 01                     	LDA		timeout1
  10596 00FC91 0D 06 01                     	ORA		timeout1+2
  10597 00FC94 F0 13                        	BEQ		.0001
  10598 00FC96 38                           	SEC
  10599 00FC97 AD 04 01                     	LDA		timeout1
  10600 00FC9A E9 01 00                     	SBC		#1
  10601 00FC9D 8D 04 01                     	STA		timeout1
  10602 00FCA0 AD 06 01                     	LDA		timeout1+2
  10603 00FCA3 E9 00 00                     	SBC		#0
  10604 00FCA6 8D 06 01                     	STA		timeout1+2
  10605 00FCA9                             .0001:
  10606 00FCA9 60                           	RTS
                                           
  10608 00FCAA FF FF FF FF FF FF FF FF      	.org	$FE00
  10608 00FCB2 FF FF FF FF FF FF FF FF    
  10608 00FCBA FF FF FF FF FF FF FF FF    
  10608 00FCC2 FF FF FF FF FF FF FF FF    
  10608 00FCCA FF FF FF FF FF FF FF FF    
  10608 00FCD2 FF FF FF FF FF FF FF FF    
  10608 00FCDA FF FF FF FF FF FF FF FF    
  10608 00FCE2 FF FF FF FF FF FF FF FF    
  10608 00FCEA FF FF FF FF FF FF FF FF    
  10608 00FCF2 FF FF FF FF FF FF FF FF    
  10608 00FCFA FF FF FF FF FF FF FF FF    
  10608 00FD02 FF FF FF FF FF FF FF FF    
  10608 00FD0A FF FF FF FF FF FF FF FF    
  10608 00FD12 FF FF FF FF FF FF FF FF    
  10608 00FD1A FF FF FF FF FF FF FF FF    
  10608 00FD22 FF FF FF FF FF FF FF FF    
  10608 00FD2A FF FF FF FF FF FF FF FF    
  10608 00FD32 FF FF FF FF FF FF FF FF    
  10608 00FD3A FF FF FF FF FF FF FF FF    
  10608 00FD42 FF FF FF FF FF FF FF FF    
  10608 00FD4A FF FF FF FF FF FF FF FF    
  10608 00FD52 FF FF FF FF FF FF FF FF    
  10608 00FD5A FF FF FF FF FF FF FF FF    
  10608 00FD62 FF FF FF FF FF FF FF FF    
  10608 00FD6A FF FF FF FF FF FF FF FF    
  10608 00FD72 FF FF FF FF FF FF FF FF    
  10608 00FD7A FF FF FF FF FF FF FF FF    
  10608 00FD82 FF FF FF FF FF FF FF FF    
  10608 00FD8A FF FF FF FF FF FF FF FF    
  10608 00FD92 FF FF FF FF FF FF FF FF    
  10608 00FD9A FF FF FF FF FF FF FF FF    
  10608 00FDA2 FF FF FF FF FF FF FF FF    
  10608 00FDAA FF FF FF FF FF FF FF FF    
  10608 00FDB2 FF FF FF FF FF FF FF FF    
  10608 00FDBA FF FF FF FF FF FF FF FF    
  10608 00FDC2 FF FF FF FF FF FF FF FF    
  10608 00FDCA FF FF FF FF FF FF FF FF    
  10608 00FDD2 FF FF FF FF FF FF FF FF    
  10608 00FDDA FF FF FF FF FF FF FF FF    
  10608 00FDE2 FF FF FF FF FF FF FF FF    
  10608 00FDEA FF FF FF FF FF FF FF FF    
  10608 00FDF2 FF FF FF FF FF FF FF FF    
  10608 00FDFA FF FF FF FF FF FF          
  10609 00FE00 4C 08 F6                     	JMP		SuperGetch
  10610 00FE03 4C 47 F6                     	JMP		warm_start
  10611 00FE06 4C 14 F6                     	JMP		SuperPutch
  10612 00FE09 4C 0B E8                     	JMP		BIOSInput
  10613 00FE0C 4C 1D F6                     	JMP		BasicGetch
  10614 00FE0F 4C 31 F6                     	JMP		xitBasic
                                           
  10616 00FE12 FF FF FF FF FF FF FF FF      	.org 	$FFD6
  10616 00FE1A FF FF FF FF FF FF FF FF    
  10616 00FE22 FF FF FF FF FF FF FF FF    
  10616 00FE2A FF FF FF FF FF FF FF FF    
  10616 00FE32 FF FF FF FF FF FF FF FF    
  10616 00FE3A FF FF FF FF FF FF FF FF    
  10616 00FE42 FF FF FF FF FF FF FF FF    
  10616 00FE4A FF FF FF FF FF FF FF FF    
  10616 00FE52 FF FF FF FF FF FF FF FF    
  10616 00FE5A FF FF FF FF FF FF FF FF    
  10616 00FE62 FF FF FF FF FF FF FF FF    
  10616 00FE6A FF FF FF FF FF FF FF FF    
  10616 00FE72 FF FF FF FF FF FF FF FF    
  10616 00FE7A FF FF FF FF FF FF FF FF    
  10616 00FE82 FF FF FF FF FF FF FF FF    
  10616 00FE8A FF FF FF FF FF FF FF FF    
  10616 00FE92 FF FF FF FF FF FF FF FF    
  10616 00FE9A FF FF FF FF FF FF FF FF    
  10616 00FEA2 FF FF FF FF FF FF FF FF    
  10616 00FEAA FF FF FF FF FF FF FF FF    
  10616 00FEB2 FF FF FF FF FF FF FF FF    
  10616 00FEBA FF FF FF FF FF FF FF FF    
  10616 00FEC2 FF FF FF FF FF FF FF FF    
  10616 00FECA FF FF FF FF FF FF FF FF    
  10616 00FED2 FF FF FF FF FF FF FF FF    
  10616 00FEDA FF FF FF FF FF FF FF FF    
  10616 00FEE2 FF FF FF FF FF FF FF FF    
  10616 00FEEA FF FF FF FF FF FF FF FF    
  10616 00FEF2 FF FF FF FF FF FF FF FF    
  10616 00FEFA FF FF FF FF FF FF FF FF    
  10616 00FF02 FF FF FF FF FF FF FF FF    
  10616 00FF0A FF FF FF FF FF FF FF FF    
  10616 00FF12 FF FF FF FF FF FF FF FF    
  10616 00FF1A FF FF FF FF FF FF FF FF    
  10616 00FF22 FF FF FF FF FF FF FF FF    
  10616 00FF2A FF FF FF FF FF FF FF FF    
  10616 00FF32 FF FF FF FF FF FF FF FF    
  10616 00FF3A FF FF FF FF FF FF FF FF    
  10616 00FF42 FF FF FF FF FF FF FF FF    
  10616 00FF4A FF FF FF FF FF FF FF FF    
  10616 00FF52 FF FF FF FF FF FF FF FF    
  10616 00FF5A FF FF FF FF FF FF FF FF    
  10616 00FF62 FF FF FF FF FF FF FF FF    
  10616 00FF6A FF FF FF FF FF FF FF FF    
  10616 00FF72 FF FF FF FF FF FF FF FF    
  10616 00FF7A FF FF FF FF FF FF FF FF    
  10616 00FF82 FF FF FF FF FF FF FF FF    
  10616 00FF8A FF FF FF FF FF FF FF FF    
  10616 00FF92 FF FF FF FF FF FF FF FF    
  10616 00FF9A FF FF FF FF FF FF FF FF    
  10616 00FFA2 FF FF FF FF FF FF FF FF    
  10616 00FFAA FF FF FF FF FF FF FF FF    
  10616 00FFB2 FF FF FF FF FF FF FF FF    
  10616 00FFBA FF FF FF FF FF FF FF FF    
  10616 00FFC2 FF FF FF FF FF FF FF FF    
  10616 00FFCA FF FF FF FF FF FF FF FF    
  10616 00FFD2 FF FF FF FF                
  10617 00FFD6 04 00                        	dw		4			; task #4
                                           
  10619 00FFD8 FF FF FF FF FF FF            	.org	$FFDE
  10620 00FFDE 06 00                        	dw		6			; task #6
                                           
                                           	.org	$FFE0
  10623 00FFE0 03 00                        	dw		3
                                           
  10625 00FFE2 FF FF FF FF                  	.org 	$FFE6
  10626 00FFE6 CD F7                        	dw		BrkRout
                                           
  10628 00FFE8 FF FF FF FF FF FF            	.org	$FFEE		; '816 IRQ vector
  10629 00FFEE 01 00                        	dw		1			; IRQRout816
                                           
  10631 00FFF0 FF FF FF FF FF FF FF FF      	.org	$FFFC
  10631 00FFF8 FF FF FF FF                
  10632 00FFFC 00 E0                        	dw		$E000
                                           
                                           	.org	$FFFE
  10635 00FFFE 01 00                        	dw		1			; IRQRout02

Checksum=ED9AD838

Number of instructions processed: 4601
Number of opcode bytes: 10615
Bytes per instruction: 2.307107 (18.456857 bits)
Clock cycle count: 5447
Clocks per instruction: 1.183873

The above statistics are only estimates.

	The CPI assumes data memory access requires two clock cycles and instruction
	access is single cycle. The actual CPI may be higher if there are memory wait 
	states, or lower if data is found in the cache.
