Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
FTBios816.asm

                                           ; ============================================================================
                                           ; FTBios816.asm
                                           ;        __
                                           ;   \\__/ o\    (C) 2014-2017  Robert Finch, Waterloo
                                           ;    \  __ /    All rights reserved.
                                           ;     \/_//     robfinch<remove>@finitron.ca
                                           ;       ||
                                           ;  
                                           ;
                                           ; This source file is free software: you can redistribute it and/or modify 
                                           ; it under the terms of the GNU Lesser General Public License as published 
                                           ; by the Free Software Foundation, either version 3 of the License, or     
                                           ; (at your option) any later version.                                      
                                           ;                                                                          
                                           ; This source file is distributed in the hope that it will be useful,      
                                           ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                           ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                           ; GNU General Public License for more details.                             
                                           ;                                                                          
                                           ; You should have received a copy of the GNU General Public License        
                                           ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                           ;                                                                          
                                           ; ============================================================================
                                           ;
     25 = 000000000000000D                               CR			EQU		13
     26 = 000000000000000A                               LF			EQU		10
     27 = 000000000000001B                               ESC			EQU		$1B
     28 = 0000000000000008                               BS			EQU		8
     29 = 0000000000000003                               CTRLC		EQU		3
                                           
     31 = 0000000000000012                               SC_LSHIFT	EQU		$12
     32 = 0000000000000059                               SC_RSHIFT	EQU		$59
     33 = 00000000000000F0                               SC_KEYUP	EQU		$F0
     34 = 00000000000000E0                               SC_EXTEND	EQU		$E0
     35 = 0000000000000014                               SC_CTRL		EQU		$14
     36 = 0000000000000011                               SC_ALT		EQU		$11
     37 = 0000000000000071                               SC_DEL		EQU		$71		; extend
     38 = 0000000000000058                               SC_LCTRL	EQU		$58
     39 = 0000000000000077                               SC_NUMLOCK	EQU		$77
     40 = 000000000000007E                               SC_SCROLLLOCK	EQU	$7E
     41 = 0000000000000058                               SC_CAPSLOCK	EQU		$58
                                           
     43 = 000000000000001F                               TEXTROWS	EQU		31
     44 = 0000000000000054                               TEXTCOLS	EQU		84
                                           
     46 = 0000000000000004                               TickCount	EQU		$4
     47 = 0000000000000008                               KeyState1	EQU		$8
     48 = 0000000000000009                               KeyState2	EQU		$9
     49 = 000000000000000A                               KeybdLEDs	EQU		$A
     50 = 000000000000000B                               KeybdWaitFlag	EQU	$B
     51 = 000000000000000C                               NumWorkArea	EQU		$C
                                           
                                           ; Range $10 to $1F reserved for hardware counters
     54 = 0000000000000010                               CNT0L		EQU		$10
     55 = 0000000000000011                               CNT0M		EQU		$11
     56 = 0000000000000012                               CNT0H		EQU		$12
     57 = 0000000000000020                               RangeStart	EQU		$20
     58 = 0000000000000024                               RangeEnd	EQU		$24
     59 = 0000000000000030                               CursorX		EQU		$30
     60 = 0000000000000032                               CursorY		EQU		$32
     61 = 0000000000000034                               VideoPos	EQU		$34
     62 = 0000000000000036                               NormAttr	EQU		$36
     63 = 0000000000000038                               StringPos	EQU		$38
     64 = 000000000000003C                               EscState	EQU		$3C
     65 = 0000000000000040                               Vidptr		EQU		$40
     66 = 0000000000000046                               Vidregs		EQU		$46
     67 = 000000000000004C                               Textcols	EQU		$4C
     68 = 000000000000004E                               Textrows	EQU		$4E
                                           
     70 = 0000000000000080                               reg_cs		EQU		$80
     71 = 00000084                         reg_ds		EQU		reg_cs + 4
     72 = 00000088                         reg_ss		EQU		reg_ds + 4
     73 = 0000008C                         reg_pc		EQU		reg_ss + 4
     74 = 00000090                         reg_a		EQU		reg_pc + 4
     75 = 00000094                         reg_x		EQU		reg_a + 4
     76 = 00000098                         reg_y		EQU		reg_x + 4
     77 = 0000009C                         reg_sp		EQU		reg_y + 4
     78 = 000000A0                         reg_sr		EQU		reg_sp + 4
     79 = 000000A4                         reg_db		EQU		reg_sr + 4
     80 = 000000A8                         reg_dp		EQU		reg_db + 4
     81 = 000000AC                         reg_bl		EQU		reg_dp + 4
                                           
     83 = 0000000000000080                               cs_save		EQU		$80
     84 = 0000000000000084                               ds_save		EQU		$84
     85 = 0000000000000088                               pc_save		EQU		$88
     86 = 000000000000008C                               pb_save		EQU		$8C
     87 = 0000000000000090                               acc_save	EQU		$90
     88 = 0000000000000094                               x_save		EQU		$94
     89 = 0000000000000098                               y_save		EQU		$98
     90 = 000000000000009C                               sp_save		EQU		$9C
     91 = 00000000000000A0                               sr_save		EQU		$A0
     92 = 00000000000000A4                               srx_save	EQU		$A4
     93 = 00000000000000A8                               db_save		EQU		$A8
     94 = 00000000000000AC                               dpr_save	EQU		$AC
                                           
     96 = 00000000000000B8                               running_task	EQU		$B8
                                           
     98 = 00000000000000BA                               keybd_char	EQU		$BA
     99 = 00000000000000BC                               keybd_cmd	EQU		$BC
    100 = 00000000000000BE                               WorkTR		EQU		$BE
    101 = 0000000000000100                               ldtrec		EQU		$100
                                           
    103 = 00000000000003F0                               OutputVec	EQU		$03F0
                                           
    105 = 000000000000B000                               PCS0		EQU		$B000
    106 = 0000B002                         PCS1		EQU		PCS0 + 2
    107 = 0000B004                         PCS2		EQU		PCS1 + 2
    108 = 0000B006                         PCS3		EQU		PCS2 + 2
    109 = 0000B008                         PCS4	    EQU		PCS3 + 2
    110 = 0000B00A                         PCS5		EQU		PCS4 + 2
    111 = 0000B010                         CTR0_LMT	EQU		PCS0 + 16
    112 = 0000B013                         CTR0_CTRL	EQU		CTR0_LMT + 3
    113 = 0000B014                         CTR1_LMT	EQU		CTR0_CTRL + 1
    114 = 0000B017                         CTR1_CTRL	EQU		CTR1_LMT + 3
    115 = 000000000000B01F                               MPU_IRQ_STATUS	EQU		$B01F
                                           
    117 = 0000000000FD0000                               VIDBUF		EQU		$FD0000
    118 = 0000000000FEA000                               VIDREGS		EQU		$FEA000
    119 = 0000000000FEA100                               PRNG		EQU		$FEA100
    120 = 0000000000FEA110                               KEYBD		EQU		$FEA110
    121 = 0000000000FEA200                               FAC1		EQU		$FEA200
                                           
    123 = 0000000000FEB000                               SID			EQU		$FEB000
    124 = 0000000000000000                               SID_FREQ0		EQU		$00
    125 = 0000000000000004                               SID_PW0			EQU		$04
    126 = 0000000000000008                               SID_CTRL0		EQU		$08
    127 = 000000000000000C                               SID_ATTACK0		EQU		$0C
    128 = 0000000000000010                               SID_DECAY0		EQU		$10
    129 = 0000000000000014                               SID_SUSTAIN0	EQU		$14
    130 = 0000000000000018                               SID_RELEASE0	EQU		$18
    131 = 000000000000001C                               SID_WADR0		EQU		$1C
    132 = 00000000000000B0                               SID_VOLUME		EQU		$B0
                                           
    134 = 0000000000007868                               do_invaders			EQU		$7868
                                           
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
supermon832.asm

                                           ;* ——————————————————————————————————————————————————————————————————————————————— *
                                           ;	.opt proc65c02,caseinsensitive
                                        	cpu	W65C02
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;*                                                                                 *
                                        ;*      SUPERMON 816 MACHINE LANGUAGE MONITOR FOR THE W65C816S MICROPROCESSOR      *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;*      Copyright ©1991-2014 by BCS Technology Limited.  All rights reserved.      *
                                        ;*                                                                                 *
                                        ;* Permission is hereby granted to use, copy, modify and distribute this software, *
                                        ;* provided this copyright notice remains in the source code and  proper  attribu- *
                                        ;* tion is given.  Redistribution, regardless of form, must be at no charge to the *
                                        ;* end  user.  This code or any part thereof, including any derivation, MAY NOT be *
                                        ;* incorporated into any package intended for sale,  unless written permission has * 
                                        ;* been given by the copyright holder.                                             *
                                        ;*                                                                                 *
                                        ;* THERE IS NO WARRANTY OF ANY KIND WITH THIS SOFTWARE.  The user assumes all risk *
                                        ;* in connection with the incorporation of this software into any system.          *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a salute to Jim Butterfield, who passed away on June 29, 2007.  *
                                        ;*                                                                                 *
                                        ;* Jim, who was the unofficial  spokesman for  Commodore  International during the *  
                                        ;* heyday of the company's 8 bit supremacy, scratch-developed the Supermon machine *
                                        ;* language monitor for the PET & CBM computers.   When the best-selling Commodore *
                                        ;* 64 was introduced, Jim adapted his software to the new machine & gave the adap- *
                                        ;* tation the name Supermon 64.   Commodore  subsequently  integrated a customized *
                                        ;* version of Supermon 64 into the C-128 to act as the resident M/L monitor.       *
                                        ;*                                                                                 *
                                        ;* Although Supermon 816 is not an adaptation of Supermon 64,  it was  decided  to *
                                        ;* keep the Supermon name alive, since Supermon 816's general operation & user in- *
                                        ;* terface is similar to that of Supermon 64.   Supermon 816 is 100 percent native *
                                        ;* mode 65C816 code & was developed from a blank canvas.                           *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* This version customized for the RTF65002 test system                            *
                                        ;* Finitron.ca                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a full featured monitor and supports the following operations:  *
                                        ;*                                                                                 *
                                        ;*     A — Assemble code                                                           *
                                        ;*     C — Compare memory regions                                                  *
                                        ;*     D — Disassemble code                                                        *
                                        ;*     F — Fill memory region (cannot span banks)                                  *
                                        ;*     G — Execute code (stops at BRK)                                             *
                                        ;*     H — Search (hunt) memory region                                             *
                                        ;*     J — Execute code as a subroutine (stops at BRK or RTS)                      *
                                        ;*     M — Dump & display memory range                                             *
                                        ;*     R — Dump & display 65C816 registers                                         *
                                        ;*     T — Copy (transfer) memory region                                           *
                                        ;*     X — Exit Supermon 816 & return to operating environment                     *
                                        ;*     > — Modify up to 32 bytes of memory                                         *
                                        ;*     ; — Modify 65C816 registers                                                 *
                                        ;*                                                                                 *
                                        ;* Supermon 816 accepts binary (%), octal (@), decimal (+) and hexadecimal ($) as  *
                                        ;* input for numeric parameters.  Additionally, the H and > operations accept an   *
                                        ;* ASCII string in place of numeric values by preceding the string with ', e.g.:   *
                                        ;*                                                                                 *
                                        ;*     h 042000 042FFF 'BCS Technology Limited                                     *
                                        ;*                                                                                 *
                                        ;* If no radix symbol is entered hex is assumed.                                   *
                                        ;*                                                                                 *
                                        ;* Numeric conversion is also available.  For example, typing:                     *
                                        ;*                                                                                 *
                                        ;*     +1234567 <CR>                                                               *
                                        ;*                                                                                 *
                                        ;* will display:                                                                   *
                                        ;*                                                                                 *
                                        ;*         $12D687                                                                 *
                                        ;*         +1234567                                                                *
                                        ;*         @04553207                                                               *
                                        ;*         %100101101011010000111                                                  *
                                        ;*                                                                                 *
                                        ;* In the above example, <CR> means the console keyboard's return or enter key.    *
                                        ;*                                                                                 *
                                        ;* All numeric values are internally processed as 32 bit unsigned integers.  Addr- *
                                        ;* esses may be entered as 8, 16 or 24 bit values.  During instruction assembly,   *
                                        ;* immediate mode operands may be forced to 16 bits by preceding the operand with  *
                                        ;* an exclamation point if the instruction can accept a 16 bit operand, e.g.:      *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 lda !#4                                                            *
                                        ;*                                                                                 *
                                        ;* The above will assemble as:                                                     *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A9 04 00     LDA #$0004                                           *
                                        ;*                                                                                 *
                                        ;* Entering:                                                                       *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 ldx !#+157                                                         *
                                        ;*                                                                                 *
                                        ;* will assemble as:                                                               *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D 00     LDX #$009D                                           *
                                        ;*                                                                                 *
                                        ;* Absent the ! in the operand field, the above would have been assembled as:      *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D        LDX #$9D                                             *
                                        ;*                                                                                 *
                                        ;* If an immediate mode operand is greater than $FF assembly of a 16 bit operand   *
                                        ;* is implied.                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* A Note on the PEA & PEI Instructions                                            *
                                        ;* ————————————————————————————————————                                            *
                                        ;*                                                                                 *
                                        ;* The Eyes and Lichty programming manual uses the following syntax for the PEA    *
                                        ;* and PEI instructions:                                                           *
                                        ;*                                                                                 *
                                        ;*     PEA <operand>                                                               *
                                        ;*     PEI (<operand>)                                                             *
                                        ;*                                                                                 *
                                        ;* The WDC data sheet that was published at the time of the 65C816's release in    *
                                        ;* 1984 does not indicate a recommended or preferred syntax for any of the above   *
                                        ;* instructions.  PEA pushes its operand to the stack and hence operates like any  *
                                        ;* other immediate mode instruction, in that the operand is the data (however, PEA *
                                        ;* doesn't affect the status register).  Similarly, PEI pushes the 16 bit value    *
                                        ;* stored at <operand> and <operand>+1, and hence operates like any other direct   *
                                        ;* (zero) page instruction, again without affecting the status register.           *
                                        ;*                                                                                 *
                                        ;* BCS Technology Limited is of the opinion that the developer of the ORCA/M as-   *
                                        ;* sembler, which is the assembler referred to in the Eyes and Lichty manual, mis- *
                                        ;* understood how PEA and PEI behave during runtime, and hence chose an incorrect  *
                                        ;* syntax for these two instructions.  This error was subsequently carried forward *
                                        ;* by Eyes and Lichty.                                                             *
                                        ;*                                                                                 *
                                        ;* Supermon 816's assembler uses the following syntax for PEA and PEI:             *
                                        ;*                                                                                 *
                                        ;*     PEA #<operand>                                                              *
                                        ;*     PEI <operand>                                                               *
                                        ;*                                                                                 *
                                        ;* The operand for PEA is treated as a 16 bit value, even if entered as an 8 bit   *
                                        ;* value.  The operand for PEI must be 8 bits.                                     *
                                        ;*                                                                                 *
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;	* * * * * * * * * * * *
                                        ;	* VERSION INFORMATION *
                                        ;	* * * * * * * * * * * *
                                        ;
                                        softvers .macro                ;software version — change with each revision...
                                                 .byte "1"             ;major
                                                 .byte "."
                                                 .byte "0"             ;minor
                                                 .byte "."
                                                 .byte "0"             ;revision
                                                 .endm
                                        ;
                                        ;REVISION TABLE
                                        ;
                                        ;Ver  Rev Date    Description
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;1.0  2013/11/01  A) Original derived from the POC V1.1 single-board computer
                                        ;                    firmware.
                                        ;     2013/11/04  A) Fixed a problem where the B-accumulator wasn't always being
                                        ;                    be copied to shadow storage after return from execution of
                                        ;                    a J command.
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	        COMMENT ABBREVIATIONS
                                        ;	————————————————————————————————————————————————————
                                        ;	  BCD   binary-coded decimal
                                        ;	   DP   direct page or page zero
                                        ;	  EOF   end-of-field
                                        ;	  EOI   end-of-input
                                        ;	  LSB   least significant byte/bit
                                        ;	  LSD   least significant digit
                                        ;	  LSN   least significant nybble
                                        ;	  LSW   least significant word
                                        ;	  MPU   microprocessor
                                        ;	  MSB   most significant byte/bit
                                        ;	  MSD   most significant digit
                                        ;	  MSN   most significant nybble
                                        ;	  MSW   most-significant word
                                        ;	  RAM   random access memory
                                        ;	   WS   whitespace, i.e., blanks & horizontal tabs
                                        ;	————————————————————————————————————————————————————
                                        ;	A word is defined as 16 bits.
                                        ;
                                        ;	   MPU REGISTER SYMBOLS
                                        ;	——————————————————————————
                                        ;	   .A   accumulator LSB
                                        ;	   .B   accumulator MSB
                                        ;	   .C   16 bit accumulator
                                        ;	   .X   X-index
                                        ;	   .Y   Y-index
                                        ;      DS   data segment
                                        ;	   DB   data bank
                                        ;	   DP   direct page
                                        ;      CS   code segment
                                        ;	   PB   program bank
                                        ;	   PC   program counter
                                        ;	   SP   stack pointer
                                        ;	   SR   MPU status
                                        ;      SRX  status extension
                                        ;	————————————————————————————
                                        ;
                                        ;	  MPU STATUS REGISTER SYMBOLS
                                        ;	———————————————————————————————
                                        ;	    C   carry
                                        ;	    D   decimal mode
                                        ;	    I   maskable interrupts
                                        ;	    m   accumulator/memory size
                                        ;	    N   result negative
                                        ;	    V   sign overflow
                                        ;	    x   index registers size
                                        ;	    Z   result zero
                                        ;
                                        ;      16   16 bit emulation flag
                                        ;      32   32 bit emulation flag
                                        ;	———————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SYSTEM INTERFACE DEFINITIONS
                                        ;
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;	This section defines the interface between Supermon 816 & the host
                                        ;	system.   Change these definitions to suit your system, but do not
                                        ;	change any label names.  All definitions must have valid values in
                                        ;	order to assemble Supermon 816.
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————
    357 = 000000000000C000                            _origin_ =$00C000              ;assembly address...
                                        ;
                                        ;	Set _ORIGIN_ to Supermon 816's desired assembly address.
                                        ;	————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    363 = 000000000000F403                            vecexit  =$00F403              ;exit to environment address...
                                        ;
                                        ;	Set VECEXIT to where Supermon 816 should go when it exits.  Supermon 816
                                        ;	will do a JML (long jump) to this address, which means VECEXIT must be a
                                        ;	24 bit address.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    371 = 0000000000000102                            vecbrki  =$0102                ;BRK handler indirect vector...
    372 = 0000000000000105                            vecbrkia =$0105                ;system indirect BRK vector
                                        ;
                                        ;	Supermon 816 will modify this vector so that execution of a BRK instruc-
                                        ;	tion is intercepted & the registers  are  captured.   Your BRK front end
                                        ;	should jump through this vector after pushing the registers as follows:
                                        ;
                                        ;	         phb                   ;save DB
                                        ;	         phd                   ;save DP
                                        ;	         rep #%00110000        ;16 bit registers
                                        ;	         pha
                                        ;	         phx
                                        ;	         phy
                                        ;	         jmp (vecbrki)         ;indirect vector
                                        ;
                                        ;	When a G or J command is issued, the above sequence will be reversed be-
                                        ;	fore a jump is made to the code to be executed.  Upon exit from Supermon
                                        ;	816, the original address at VECBRKI will be restored.
                                        ;
                                        ;	If your BRK front end doesn't conform to the above you will have to mod-
                                        ;	ify Supermon 816 to accommodate the differences.  The most likely needed
                                        ;	changes will be in the order in which registers are pushed to the stack.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    396 = 0000000000003FFF                            hwstack  =$3fff                ;top of hardware stack...
                                        ;
                                        ;	Supermon 816 initializes the stack pointer to this address when the cold
                                        ;	start at MONCOLD is called to enter the monitor.  The stack pointer will
                                        ;	be undisturbed when entry into Supermon 816 is through JMONBRK (see jump
                                        ;	table definitions).
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    405 = 0000000000000080                            zeropage =$80                  ;Supermon 816's direct page...
                                        ;
                                        ;	Supermon 816 uses direct page starting at this address.  Be sure that no
                                        ;	conflict occurs with other software.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    412 = 000000000000F400                            getcha   =$F400                ;get keystroke from console...
                                        ;
                                        ;	GETCHA refers to an operating system API call that returns a keystroke
                                        ;	in the 8 bit accumulator.  Supermon 816  assumes that GETCHA is a non-
                                        ;	blocking subroutine & returns with carry clear to indicate that a key-
                                        ;	stroke is in .A, or with carry set to indicate that no keystroke was
                                        ;	available.  GETCHA will be called with a JSR instruction.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from GETCHA.
                                        ;	You may have to modify Supermon 816 at all calls to GETCHA if your "get
                                        ;	keystroke" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    426 = 000000000000F406                            putcha   =$F406                ;print character on console...
                                        ;
                                        ;	PUTCHA refers to an operating system API call that prints a character to
                                        ;	the console screen.  The character to be printed will be in .A, which
                                        ;	will be set to 8-bit width.  Supermon 816 assumes that PUTCHA will block
                                        ;	until the character can be processed.  PUTCHA will be called with a JSR
                                        ;	instructions.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from PUTCHA.
                                        ;	You may have to modify Supermon 816 at all calls to PUTCHA if your "put
                                        ;	character" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    440 = 0000000000000003                            stopkey  =$03                  ;display abort key...
                                        ;
                                        ;	Supermon 816 will poll for a "stop key" during display operations, such
                                        ;	as code disassembly & memory dumps, so as to abort further processing &
                                        ;	return to the command prompt.  STOPKEY must be defined with the ASCII
                                        ;	value that the "stop key" will emit when typed.  The polling is via a
                                        ;	call to GETCHA (described above).  The default STOPKEY definition of $03
                                        ;	is for ASCII <ETX> or [Ctrl-C].
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    450 = 0000000000000200                            ibuffer  =$000200               ;input buffer &...
    451 = 00000251                      auxbuf   =ibuffer+s_ibuf+1 ;auxiliary buffer...
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	Supermon 816 will use the above definitions for input buffers.  These
                                        ;	buffers may be located anywhere in RAM that is convenient.  The buffers
                                        ;	are stateless, which means that unless Supermon 816 has control of your
                                        ;	system, they may be overwritten without consequence.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S INSTRUCTION SYNTHESIS MACROS —— !!!!! DO NOT EDIT !!!!!
                                        ;
                                        _asm24_  .macro .ad
                                                 .byte <.ad,>.ad,.ad >> 16
                                                 .endm
                                        ;
                                        brl      .macro .ad
                                        .ba      =*+3
                                                 .byte $82
                                                 .word .ad-.ba
                                                 .endm
                                        ;
                                        ; jml is supported for the RTF65002 in 65c02 mode. And the opcode is supported
                                        ; by the assembler.
                                        ;jml      .macro .ad
                                        ; ;        .byte $5c
                                        ;         _asm24_ .ad
                                        ;         .endm
                                        ;
                                        mvn      .macro .s,.d
                                                 .byte $54,.d,.s
                                                 .endm
                                        ;
                                        mvp      .macro .s,.d
                                                 .byte $44,.d,.s
                                                 .endm
                                        ;
                                        pea      .macro .op
                                                 .byte $f4
                                                 .word .op
                                                 .endm
                                        ;
                                        phb      .macro
                                                 .byte $8b
                                                 .endm
                                        ;
                                        phk      .macro
                                                 .byte $4b
                                                 .endm
                                        ;
                                        plb      .macro
                                                 .byte $ab
                                                 .endm
                                        ;
                                        rep      .macro .op
                                                 .byte $c2,.op
                                                 .endm
                                        ;
                                        sep      .macro .op
                                                 .byte $e2,.op
                                                 .endm
                                        ;
                                        tcd      .macro
                                                 .byte $5b
                                                 .endm
                                        ;
                                        tcs      .macro
                                                 .byte $1b
                                                 .endm
                                        ;
                                        tdc      .macro
                                                 .byte $7b
                                                 .endm
                                        ;
                                        tsc      .macro
                                                 .byte $3b
                                                 .endm
                                        ;
                                        txy      .macro
                                                 .byte $9b
                                                 .endm
                                        ;
                                        tyx      .macro
                                                 .byte $bb
                                                 .endm
                                        ;
                                        wai      .macro
                                                 .byte $cb
                                                 .endm
                                        ;
                                        xba      .macro
                                                 .byte $eb
                                                 .endm
                                        ;
                                        adcw     .macro .op
                                                 adc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        andw     .macro .op
                                                 and #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        bitw     .macro .op
                                                 bit #<.op
                                                 .byte >.op
                                                 .endm
                                        ;         
                                        cmpw     .macro .op
                                                 cmp #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpxw     .macro .op
                                                 cpx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpyw     .macro .op
                                                 cpy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        eorw     .macro .op
                                                 eor #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldaw     .macro .op
                                                 lda #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldxw     .macro .op
                                                 ldx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldyw     .macro .op
                                                 ldy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        oraw     .macro .op
                                                 ora #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        sbcw     .macro .op
                                                 sbc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldalx    .macro .ad
                                                 .byte $+         .byte a_esc,"("
                                     +            .byte a_esc,"G4"

                                        
                                     +            .byte <.ad,>.ad,.ad >> 16

                                        
                                                 .endm
                                        ;
                                        adcil    .macro .ad
                                                 .byte $67,.ad
                                                 .endm
                                        ;
                                        adcily   .macro .ad
                                                 .byte $77,.ad
                                                 .endm
                                        ;
                                        andil    .macro .ad
                                                 .byte $27,.ad
                                                 .endm
                                        ;
                                        andily   .macro .ad
                                                 .byte $37,.ad
                                                 .endm
                                        ;
                                        cmpil    .macro .ad
                                                 .byte $c7,.ad
                                                 .endm
                                        ;
                                        cmpily   .macro .ad
                                                 .byte $d7,.ad
                                                 .endm
                                        ;
                                        eoril    .macro .ad
                                                 .byte $47,.ad
                                                 .endm
                                        ;
                                        eorily   .macro .ad
                                                 .byte $57,.ad
                                                 .endm
                                        ;
                                        ldail    .macro .ad
                                                 .byte $a7,.ad
                                                 .endm
                                        ;
                                        ldaily   .macro .ad
                                                 .byte $b7,.ad
                                                 .endm
                                        ;
                                        orail    .macro .ad
                                                 .byte $07,.ad
                                                 .endm
                                        ;
                                        oraily   .macro .ad
                                                 .byte $17,.ad
                                                 .endm
                                        ;
                                        sbcil    .macro .ad
                                                 .byte $e7,.ad
                                                 .endm
                                        ;
                                        sbcily   .macro .ad
                                                 .byte $f7,.ad
                                                 .endm
                                        ;
                                        stail    .macro .ad
                                                 .byte $87,.ad
                                                 .endm
                                        ;
                                        staily   .macro .ad
                                                 .byte $97,.ad
                                                 .endm
                                        ;
                                        adcs     .macro .of
                                                 .byte $63,.of
                                                 .endm
                                        ;
                                        adcsi    .macro .of
                                                 .byte $73,.of
                                                 .endm
                                        ;
                                        ands     .macro .of
                                                 .byte $23,.of
                                                 .endm
                                        ;
                                        andsi    .macro .of
                                                 .byte $33,.of
                                                 .endm
                                        ;
                                        cmps     .macro .of
                                                 .byte $c3,.of
                                                 .endm
                                        ;
                                        cmpsi    .macro .of
                                                 .byte $d3,.of
                                                 .endm
                                        ;
                                        eors     .macro .of
                                                 .byte $43,.of
                                                 .endm
                                        ;
                                        eorsi    .macro .of
                                                 .byte $53,.of
                                                 .endm
                                        ;
                                        ldas     .macro .of
                                                 .byte $a3,.of
                                                 .endm
                                        ;
                                        ldasi    .macro .of
                                                 .byte $b3,.of
                                                 .endm
                                        ;
                                        oras     .macro .of
                                                 .byte $03,.of
                                                 .endm
                                        ;
                                        orasi    .macro .of
                                                 .byte $13,.of
                                                 .endm
                                        ;
                                        sbcs     .macro .of
                                                 .byte $e3,.of
                                                 .endm
                                        ;
                                        sbcsi    .macro .of
                                                 .byte $f3,.of
                                                 .endm
                                        ;
                                        stas     .macro .of
                                                 .byte $83,.of
                                                 .endm
                                        ;
                                        stasi    .macro .of
                                                 .byte $93,.of
                                                 .endm
                                        ;
                                        longa    .macro
                                                 .byte $c2,$20
                                                 .endm
                                        ;
                                        longr    .macro
                                                 .byte $c2,$30
                                                 .endm
                                        ;
                                        longx    .macro
                                                 .byte $c2,$10
                                                 .endm
                                        ;
                                        shorta   .macro
                                                 .byte $e2,$20
                                                 .endm
                                        ;
                                        shorti   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        shortr   .macro
                                                 .byte $e2,$30
                                                 .endm
                                        ;
                                        shortx   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL MACROS
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The following macros execute terminal  control procedures  that  perform
                                        ;	such tasks as clearing the screen,  switching  between  normal & reverse
                                        ;	video, etc.  These macros are for WYSE 60 & compatible displays, such as
                                        ;	the WYSE 150, WYSE 160, WYSE 325 & WYSE GPT.   Only the functions needed
                                        ;	by Supermon 816 are included.
                                        ;
                                        ;	If your console is not WYSE 60 compatible, you will need to  edit  these
                                        ;	macros as required to control your particular console or terminal.  Note
                                        ;	that in some cases one macro may call another.  Exercise caution in your
                                        ;	edits to avoid introducing display bugs.
                                        ;
                                        ;	If your console display cannot execute one of these procedures,  such as
                                        ;	'CL' (clear to end of line), you will have to develop an alternative.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	clearing data...
                                        ;
                                        bs       .macro                ;destructive backspace
                                                 .byte a_bs
                                     +            .byte a_esc,"W"

                                        
                                                 .endm
                                        ;
                                        cl       .macro                ;clear to end of line 
                                                 .byte a_esc,"T"
                                                 .endm
                                        ;
                                        ;
                                        ;	cursor control...
                                        ;
                                        cn       .macro                ;cursor on
                                                 .byte a_esc,"`1"
                                                 .endm
                                        ;
                                        co       .macro                ;cursor off
                                                 .byte a_esc,"`0"
                                                 .endm
                                        ;
                                        cr       .macro                ;carriage return
                                                 .byte a_cr
                                                 .endm
                                        ;
                                        lf       .macro                ;carriage return/line feed
                                     +            .byte a_cr

                                        
                                                 .byte a_lf
                                                 .endm
                                        ;
                                        ;
                                        ;	display attributes...
                                        ;
                                        bf       .macro                ;reverse foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G4"
                                                 .endm
                                        ;
                                        er       .macro                ;enable normal foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        sf       .macro                ;set foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        ;
                                        ;	display editing...
                                        ;
                                        dcuc     .macro                ;delete char under cursor
                                                 .byte a_esc,"W"
                                                 .endm
                                        ;
                                        ;
                                        ;	miscellaneous control...
                                        ;
                                        rb       .macro                ;ring "bell"
                                                 .byte a_bel
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASCII CONTROL DEFINITIONS (menmonic order)
                                        ;
    860 = 0000000000000007                            a_bel    =$07                  ;<BEL> alert/ring bell
    861 = 0000000000000008                            a_bs     =$08                  ;<BS>  backspace
    862 = 000000000000000D                            a_cr     =$0d                  ;<CR>  carriage return
    863 = 000000000000007F                            a_del    =$7f                  ;<DEL> delete
    864 = 000000000000001B                            a_esc    =$1b                  ;<ESC> escape
    865 = 0000000000000009                            a_ht     =$09                  ;<HT>  horizontal tabulation
    866 = 000000000000000A                            a_lf     =$0a                  ;<LF>  linefeed
                                        ;
                                        ;
                                        ;	miscellaneous (description order)...
                                        ;
    871 = 20                            a_blank  =' '                  ;blank (whitespace)
    872 = 7A                            a_asclch ='z'                  ;end of lowercase ASCII
    873 = 000000000000005F                            a_lctouc =$5f                  ;LC to UC conversion mask
    874 = 61                            a_asclcl ='a'                  ;start of lowercase ASCII
                                        ;
                                        ;================================================================================
                                        ;
                                        ;GLOBAL ATOMIC CONSTANTS
                                        ;
                                        ;
                                        ;	data type sizes...
                                        ;
    883 = 0000000000000001                            s_byte   =1                    ;byte
    884 = 0000000000000002                            s_word   =2                    ;word (16 bits)
    885 = 0000000000000003                            s_xword  =3                    ;extended word (24 bits)
    886 = 0000000000000004                            s_dword  =4                    ;double word (32 bits)
    887 = 0000000000000100                            s_rampag =$0100                ;65xx RAM page
                                        ;
                                        ;
                                        ;	data type sizes in bits...
                                        ;
    892 = 0000000000000008                            s_bibyte =8                    ;byte
    893 = 0000000000000004                            s_bnybbl =4                    ;nybble
                                        ;
                                        ;
                                        ;	miscellaneous...
                                        ;
    898 = 000000000000002C                            bitabs   =$2c                  ;absolute BIT opcode
    899 = 0000000000000024                            bitzp    =$24                  ;zero page BIT opcode
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S NATIVE MODE STATUS REGISTER DEFINITIONS
                                        ;
    905 = 00000001                      s_mpudbx =s_byte               ;data bank size
    906 = 00000002                      s_mpudpx =s_word               ;direct page size
    907 = 00000001                      s_mpupbx =s_byte               ;program bank size
    908 = 00000002                      s_mpupcx =s_word               ;program counter size
    909 = 00000002                      s_mpuspx =s_word               ;stack pointer size
    910 = 00000001                      s_mpusrx =s_byte               ;status size
                                        ;
                                        ;
                                        ;	status register flags...
                                        ;
    915 = 0000000000000001                            sr_car   =%00000001            ;C
    916 = 00000002                      sr_zer   =sr_car << 1          ;Z
    917 = 00000004                      sr_irq   =sr_zer << 1          ;I
    918 = 00000008                      sr_bdm   =sr_irq << 1          ;D
    919 = 00000010                      sr_ixw   =sr_bdm << 1          ;x
    920 = 00000020                      sr_amw   =sr_ixw << 1          ;m
    921 = 00000040                      sr_ovl   =sr_amw << 1          ;V
    922 = 00000080                      sr_neg   =sr_ovl << 1          ;N
    923 = 00000100                      sr_16	 =sr_neg << 1
    924 = 00000200                      sr_32    =sr_16 << 1
                                        ;
                                        ;	NVmxDIZC
                                        ;	xxxxxxxx
                                        ;	||||||||
                                        ;	|||||||+———> 1 = carry set/generated
                                        ;	||||||+————> 1 = result = zero
                                        ;	|||||+—————> 1 = IRQs ignored
                                        ;	||||+——————> 0 = binary arithmetic mode
                                        ;	||||         1 = decimal arithmetic mode
                                        ;	|||+———————> 0 = 16 bit index
                                        ;	|||          1 = 8 bit index
                                        ;	||+————————> 0 = 16 bit .A & memory
                                        ;	||           1 = 8 bit .A & memory
                                        ;	|+—————————> 1 = sign overflow
                                        ;	+——————————> 1 = result = negative
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"SIZE-OF" CONSTANTS
                                        ;
    945 = 00000003                      s_addr   =s_xword              ;24 bit address
    946 = 0000000000000020                            s_auxbuf =32                   ;auxiliary buffer
    947 = 0000000000000050                            s_ibuf   =80                   ;input buffer
    948 = 0000000000000003                            s_mnemon =3                    ;MPU ASCII mnemonic
    949 = 0000000000000002                            s_mnepck =2                    ;MPU encoded mnemonic
    950 = 0000000000000003                            s_mvinst =3                    ;MVN/MVP instruction
    951 = 00000001                      s_opcode =s_byte               ;MPU opcode
    952 = 00000003                      s_oper   =s_xword              ;operand
    953 = 00000004                      s_pfac   =s_dword              ;primary math accumulator
    954 = 00000006                      s_sfac   =s_dword+s_word       ;secondary math accumulators
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"NUMBER-OF" CONSTANTS
                                        ;
    960 = 0000000000000015                            n_dbytes =21                   ;default disassembly bytes
    961 = 0000000000000008                            n_dump   =8                    ;bytes per memory dump line
    962 = 000000FF                      n_mbytes =s_rampag-1           ;default memory dump bytes
    963 = 0000000000000008                            n_hccols =8                    ;compare/hunt display columns
    964 = 00000009                      n_opcols =3*s_oper             ;disassembly operand columns
    965 = 0000000000000004                            n_opslsr =4                    ;LSRs to extract instruction size
    966 = 0000000000000005                            n_shfenc =5                    ;shifts to encode/decode mnemonic
                                        ;
                                        ;================================================================================
                                        ;
                                        ;NUMERIC CONVERSION CONSTANTS
                                        ;
    972 = 0000000000000006                            a_hexdec ='A'-'9'-2            ;hex to decimal difference
    973 = 25                            c_bin    ='%'                  ;binary prefix
    974 = 2B                            c_dec    ='+'                  ;decimal prefix
    975 = 24                            c_hex    ='$'                  ;hexadecimal prefix
    976 = 40                            c_oct    ='@'                  ;octal prefix
    977 = 66                            k_hex    ='f'                  ;hex ASCII conversion
    978 = 00000020                      m_bits   =s_pfac*s_bibyte      ;operand bit size
    979 = 00000030                      m_cbits  =s_sfac*s_bibyte      ;workspace bit size
    980 = 000000000000000F                            bcdumask =%00001111            ;isolate BCD units mask
    981 = 0000000000000030                            btoamask =%00110000            ;binary to ASCII mask
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER CONSTANTS
                                        ;
    987 = 3F                            a_mnecvt ='?'                  ;encoded mnemonic conversion base
    988 = 000000000000001F                            aimmaska =%00011111            ;.A immediate opcode test #1
    989 = 0000000000000009                            aimmaskb =%00001001            ;.A immediate opcode test #2
    990 = 41                            asmprfx  ='A'                  ;assemble code prefix
    991 = 0000000000000009                            ascprmct =9                    ;assembler prompt "size-of"
    992 = 2E                            disprfx  ='.'                  ;disassemble code prefix
    993 = 00000000000000C0                            flimmask =%11000000            ;force long immediate flag
    994 = 0000000000000054                            opc_mvn  =$54                  ;MVN opcode
    995 = 0000000000000044                            opc_mvp  =$44                  ;MVP opcode
    996 = 00000000000000C2                            opc_rep  =$c2                  ;REP opcode
    997 = 00000000000000E2                            opc_sep  =$e2                  ;SEP opcode
    998 = 00000030                      pfmxmask =sr_amw | sr_ixw      ;MPU m & x flag bits mask
                                        ;
                                        ;
                                        ;	assembler prompt buffer offsets...
                                        ;
   1003 = 00000002                      apadrbkh =s_word               ;instruction address bank MSN
   1004 = 00000003                      apadrbkl =apadrbkh+s_byte      ;instruction address bank LSN
   1005 = 00000004                      apadrmbh =apadrbkl+s_byte      ;instruction address MSB MSN
   1006 = 00000005                      apadrmbl =apadrmbh+s_byte      ;instruction address MSB LSN
   1007 = 00000006                      apadrlbh =apadrmbl+s_byte      ;instruction address LSB MSN
   1008 = 00000007                      apadrlbl =apadrlbh+s_byte      ;instruction address LSB LSN
                                        ;
                                        ;
                                        ;	addressing mode preamble symbols...
                                        ;
   1013 = 21                            amp_flim ='!'                  ;force long immediate
   1014 = 23                            amp_imm  ='#'                  ;immediate
   1015 = 28                            amp_ind  ='('                  ;indirect
   1016 = 5B                            amp_indl ='['                  ;indirect long
                                        ;
                                        ;
                                        ;	addressing mode symbolic translation indices...
                                        ;
   1021 = 0000000000000000                            am_nam   =%0000                ;(0)  no symbol
   1022 = 0000000000000001                            am_imm   =%0001                ;(1)  #
   1023 = 0000000000000002                            am_adrx  =%0010                ;(2)  dp,X or addr,X
   1024 = 0000000000000003                            am_adry  =%0011                ;(3)  dp,Y or addr,Y
   1025 = 0000000000000004                            am_ind   =%0100                ;(4)  (dp) or (addr)
   1026 = 0000000000000005                            am_indl  =%0101                ;(5)  [dp] or [addr]
   1027 = 0000000000000006                            am_indly =%0110                ;(6)  [dp],Y
   1028 = 0000000000000007                            am_indx  =%0111                ;(7)  (dp,X) or (addr,X)
   1029 = 0000000000000008                            am_indy  =%1000                ;(8)  (dp),Y
   1030 = 0000000000000009                            am_stk   =%1001                ;(9)  offset,S
   1031 = 000000000000000A                            am_stky  =%1010                ;(10) (offset,S),Y
   1032 = 000000000000000B                            am_move  =%1011                ;(11) MVN/MVP sbnk,dbnk
                                        ;
                                        ;
                                        ;	operand size translation indices...
                                        ;
   1037 = 0000000000000000                            ops0     =%0000 << 4           ;no operand
   1038 = 0000000000000010                            ops1     =%0001 << 4           ;8 bit operand
   1039 = 0000000000000020                            ops2     =%0010 << 4           ;16 bit operand
   1040 = 0000000000000030                            ops3     =%0011 << 4           ;24 bit operand
   1041 = 0000000000000050                            bop1     =%0101 << 4           ;8 bit relative branch
   1042 = 0000000000000060                            bop2     =%0110 << 4           ;16 bit relative branch
   1043 = 0000000000000090                            vops     =%1001 << 4           ;8 or 16 bit operand
                                        ;
                                        ;
                                        ;	operand size & addressing mode extraction masks...
                                        ;
   1048 = 000000000000000F                            amodmask =%00001111            ;addressing mode index
   1049 = 0000000000000030                            opsmask  =%00110000            ;operand size
   1050 = 00000000000000C0                            vopsmask =%11000000            ;BOPx & VOPS flag bits
                                        ;
                                        ;
                                        ;	instruction mnemonic encoding...
                                        ;
   1055 = 0000000000002144                            mne_adc  =$2144                ;ADC
   1056 = 0000000000002BC4                            mne_and  =$2bc4                ;AND
   1057 = 0000000000006D04                            mne_asl  =$6d04                ;ASL
   1058 = 0000000000002106                            mne_bcc  =$2106                ;BCC
   1059 = 000000000000A106                            mne_bcs  =$a106                ;BCS
   1060 = 0000000000009186                            mne_beq  =$9186                ;BEQ
   1061 = 000000000000AA86                            mne_bit  =$aa86                ;BIT
   1062 = 0000000000005386                            mne_bmi  =$5386                ;BMI
   1063 = 00000000000033C6                            mne_bne  =$33c6                ;BNE
   1064 = 0000000000006C46                            mne_bpl  =$6c46                ;BPL
   1065 = 00000000000014C6                            mne_bra  =$14c6                ;BRA
   1066 = 00000000000064C6                            mne_brk  =$64c6                ;BRK
   1067 = 0000000000006CC6                            mne_brl  =$6cc6                ;BRL
   1068 = 00000000000025C6                            mne_bvc  =$25c6                ;BVC
   1069 = 000000000000A5C6                            mne_bvs  =$a5c6                ;BVS
   1070 = 0000000000002348                            mne_clc  =$2348                ;CLC
   1071 = 0000000000002B48                            mne_cld  =$2b48                ;CLD
   1072 = 0000000000005348                            mne_cli  =$5348                ;CLI
   1073 = 000000000000BB48                            mne_clv  =$bb48                ;CLV
   1074 = 0000000000008B88                            mne_cmp  =$8b88                ;CMP
   1075 = 0000000000008C08                            mne_cop  =$8c08                ;COP
   1076 = 000000000000CC48                            mne_cpx  =$cc48                ;CPX
   1077 = 000000000000D448                            mne_cpy  =$d448                ;CPY
   1078 = 000000000000218A                            mne_dec  =$218a                ;DEC
   1079 = 000000000000C98A                            mne_dex  =$c98a                ;DEX
   1080 = 000000000000D18A                            mne_dey  =$d18a                ;DEY
   1081 = 0000000000009C0C                            mne_eor  =$9c0c                ;EOR
   1082 = 00000000000023D4                            mne_inc  =$23d4                ;INC
   1083 = 000000000000CBD4                            mne_inx  =$cbd4                ;INX
   1084 = 000000000000D3D4                            mne_iny  =$d3d4                ;INY
   1085 = 0000000000006B96                            mne_jml  =$6b96                ;JML
   1086 = 0000000000008B96                            mne_jmp  =$8b96                ;JMP
   1087 = 0000000000006D16                            mne_jsl  =$6d16                ;JSL
   1088 = 0000000000009D16                            mne_jsr  =$9d16                ;JSR
   1089 = 000000000000115A                            mne_lda  =$115a                ;LDA
   1090 = 000000000000C95A                            mne_ldx  =$c95a                ;LDX
   1091 = 000000000000D15A                            mne_ldy  =$d15a                ;LDY
   1092 = 0000000000009D1A                            mne_lsr  =$9d1a                ;LSR
   1093 = 0000000000007DDC                            mne_mvn  =$7ddc                ;MVN
   1094 = 0000000000008DDC                            mne_mvp  =$8ddc                ;MVP
   1095 = 0000000000008C1E                            mne_nop  =$8c1e                ;NOP
   1096 = 00000000000014E0                            mne_ora  =$14e0                ;ORA
   1097 = 00000000000011A2                            mne_pea  =$11a2                ;PEA
   1098 = 00000000000051A2                            mne_pei  =$51a2                ;PEI
   1099 = 00000000000099A2                            mne_per  =$99a2                ;PER
   1100 = 0000000000001262                            mne_pha  =$1262                ;PHA
   1101 = 0000000000001A62                            mne_phb  =$1a62                ;PHB
   1102 = 0000000000002A62                            mne_phd  =$2a62                ;PHD
   1103 = 0000000000006262                            mne_phk  =$6262                ;PHK
   1104 = 0000000000008A62                            mne_php  =$8a62                ;PHP
   1105 = 000000000000CA62                            mne_phx  =$ca62                ;PHX
   1106 = 000000000000D262                            mne_phy  =$d262                ;PHY
   1107 = 0000000000001362                            mne_pla  =$1362                ;PLA
   1108 = 0000000000001B62                            mne_plb  =$1b62                ;PLB
   1109 = 0000000000002B62                            mne_pld  =$2b62                ;PLD
   1110 = 0000000000008B62                            mne_plp  =$8b62                ;PLP
   1111 = 000000000000CB62                            mne_plx  =$cb62                ;PLX
   1112 = 000000000000D362                            mne_ply  =$d362                ;PLY
   1113 = 00000000000089A6                            mne_rep  =$89a6                ;REP
   1114 = 0000000000006C26                            mne_rol  =$6c26                ;ROL
   1115 = 0000000000009C26                            mne_ror  =$9c26                ;ROR
   1116 = 0000000000005566                            mne_rti  =$5566                ;RTI
   1117 = 0000000000006D66                            mne_rtl  =$6d66                ;RTL
   1118 = 000000000000A566                            mne_rts  =$a566                ;RTS
   1119 = 00000000000020E8                            mne_sbc  =$20e8                ;SBC
   1120 = 00000000000021A8                            mne_sec  =$21a8                ;SEC
   1121 = 00000000000029A8                            mne_sed  =$29a8                ;SED
   1122 = 00000000000051A8                            mne_sei  =$51a8                ;SEI
   1123 = 00000000000089A8                            mne_sep  =$89a8                ;SEP
   1124 = 0000000000001568                            mne_sta  =$1568                ;STA
   1125 = 0000000000008D68                            mne_stp  =$8d68                ;STP
   1126 = 000000000000CD68                            mne_stx  =$cd68                ;STX
   1127 = 000000000000D568                            mne_sty  =$d568                ;STY
   1128 = 000000000000DD68                            mne_stz  =$dd68                ;STZ
   1129 = 000000000000C8AA                            mne_tax  =$c8aa                ;TAX
   1130 = 000000000000D0AA                            mne_tay  =$d0aa                ;TAY
   1131 = 000000000000292A                            mne_tcd  =$292a                ;TCD
   1132 = 000000000000A12A                            mne_tcs  =$a12a                ;TCS
   1133 = 000000000000216A                            mne_tdc  =$216a                ;TDC
   1134 = 0000000000001CEA                            mne_trb  =$1cea                ;TRB
   1135 = 0000000000001D2A                            mne_tsb  =$1d2a                ;TSB
   1136 = 000000000000252A                            mne_tsc  =$252a                ;TSC
   1137 = 000000000000CD2A                            mne_tsx  =$cd2a                ;TSX
   1138 = 000000000000166A                            mne_txa  =$166a                ;TXA
   1139 = 000000000000A66A                            mne_txs  =$a66a                ;TXS
   1140 = 000000000000D66A                            mne_txy  =$d66a                ;TXY
   1141 = 00000000000016AA                            mne_tya  =$16aa                ;TYA
   1142 = 000000000000CEAA                            mne_tyx  =$ceaa                ;TYX
   1143 = 00000000000050B0                            mne_wai  =$50b0                ;WAI
   1144 = 0000000000007170                            mne_wdm  =$7170                ;WDM
   1145 = 00000000000010F2                            mne_xba  =$10f2                ;XBA
   1146 = 0000000000003132                            mne_xce  =$3132                ;XCE
                                        ;
                                        ;
                                        ;	encoded instruction mnemonic indices...
                                        ;
   1151 = 0000000000000010                            mne_adcx =16                   ;ADC
   1152 = 000000000000001D                            mne_andx =29                   ;AND
   1153 = 000000000000002C                            mne_aslx =44                   ;ASL
   1154 = 000000000000000F                            mne_bccx =15                   ;BCC
   1155 = 0000000000000041                            mne_bcsx =65                   ;BCS
   1156 = 000000000000003B                            mne_beqx =59                   ;BEQ
   1157 = 0000000000000046                            mne_bitx =70                   ;BIT
   1158 = 0000000000000024                            mne_bmix =36                   ;BMI
   1159 = 000000000000001F                            mne_bnex =31                   ;BNE
   1160 = 000000000000002A                            mne_bplx =42                   ;BPL
   1161 = 0000000000000005                            mne_brax =5                    ;BRA
   1162 = 0000000000000027                            mne_brkx =39                   ;BRK
   1163 = 000000000000002B                            mne_brlx =43                   ;BRL
   1164 = 0000000000000017                            mne_bvcx =23                   ;BVC
   1165 = 0000000000000044                            mne_bvsx =68                   ;BVS
   1166 = 0000000000000014                            mne_clcx =20                   ;CLC
   1167 = 000000000000001B                            mne_cldx =27                   ;CLD
   1168 = 0000000000000023                            mne_clix =35                   ;CLI
   1169 = 0000000000000047                            mne_clvx =71                   ;CLV
   1170 = 0000000000000035                            mne_cmpx =53                   ;CMP
   1171 = 0000000000000037                            mne_copx =55                   ;COP
   1172 = 000000000000004E                            mne_cpxx =78                   ;CPX
   1173 = 0000000000000058                            mne_cpyx =88                   ;CPY
   1174 = 0000000000000012                            mne_decx =18                   ;DEC
   1175 = 000000000000004A                            mne_dexx =74                   ;DEX
   1176 = 0000000000000054                            mne_deyx =84                   ;DEY
   1177 = 000000000000003D                            mne_eorx =61                   ;EOR
   1178 = 0000000000000015                            mne_incx =21                   ;INC
   1179 = 000000000000004D                            mne_inxx =77                   ;INX
   1180 = 0000000000000057                            mne_inyx =87                   ;INY
   1181 = 0000000000000028                            mne_jmlx =40                   ;JML
   1182 = 0000000000000036                            mne_jmpx =54                   ;JMP
   1183 = 000000000000002D                            mne_jslx =45                   ;JSL
   1184 = 000000000000003F                            mne_jsrx =63                   ;JSR
   1185 = 0000000000000001                            mne_ldax =1                    ;LDA
   1186 = 0000000000000049                            mne_ldxx =73                   ;LDX
   1187 = 0000000000000053                            mne_ldyx =83                   ;LDY
   1188 = 0000000000000040                            mne_lsrx =64                   ;LSR
   1189 = 0000000000000030                            mne_mvnx =48                   ;MVN
   1190 = 000000000000003A                            mne_mvpx =58                   ;MVP
   1191 = 0000000000000038                            mne_nopx =56                   ;NOP
   1192 = 0000000000000006                            mne_orax =6                    ;ORA
   1193 = 0000000000000002                            mne_peax =2                    ;PEA
   1194 = 0000000000000021                            mne_peix =33                   ;PEI
   1195 = 000000000000003C                            mne_perx =60                   ;PER
   1196 = 0000000000000003                            mne_phax =3                    ;PHA
   1197 = 000000000000000A                            mne_phbx =10                   ;PHB
   1198 = 000000000000001A                            mne_phdx =26                   ;PHD
   1199 = 0000000000000026                            mne_phkx =38                   ;PHK
   1200 = 0000000000000033                            mne_phpx =51                   ;PHP
   1201 = 000000000000004B                            mne_phxx =75                   ;PHX
   1202 = 0000000000000055                            mne_phyx =85                   ;PHY
   1203 = 0000000000000004                            mne_plax =4                    ;PLA
   1204 = 000000000000000B                            mne_plbx =11                   ;PLB
   1205 = 000000000000001C                            mne_pldx =28                   ;PLD
   1206 = 0000000000000034                            mne_plpx =52                   ;PLP
   1207 = 000000000000004C                            mne_plxx =76                   ;PLX
   1208 = 0000000000000056                            mne_plyx =86                   ;PLY
   1209 = 0000000000000031                            mne_repx =49                   ;REP
   1210 = 0000000000000029                            mne_rolx =41                   ;ROL
   1211 = 000000000000003E                            mne_rorx =62                   ;ROR
   1212 = 0000000000000025                            mne_rtix =37                   ;RTI
   1213 = 000000000000002E                            mne_rtlx =46                   ;RTL
   1214 = 0000000000000043                            mne_rtsx =67                   ;RTS
   1215 = 000000000000000E                            mne_sbcx =14                   ;SBC
   1216 = 0000000000000013                            mne_secx =19                   ;SEC
   1217 = 0000000000000019                            mne_sedx =25                   ;SED
   1218 = 0000000000000022                            mne_seix =34                   ;SEI
   1219 = 0000000000000032                            mne_sepx =50                   ;SEP
   1220 = 0000000000000007                            mne_stax =7                    ;STA
   1221 = 0000000000000039                            mne_stpx =57                   ;STP
   1222 = 0000000000000050                            mne_stxx =80                   ;STX
   1223 = 0000000000000059                            mne_styx =89                   ;STY
   1224 = 000000000000005B                            mne_stzx =91                   ;STZ
   1225 = 0000000000000048                            mne_taxx =72                   ;TAX
   1226 = 0000000000000052                            mne_tayx =82                   ;TAY
   1227 = 0000000000000018                            mne_tcdx =24                   ;TCD
   1228 = 0000000000000042                            mne_tcsx =66                   ;TCS
   1229 = 0000000000000011                            mne_tdcx =17                   ;TDC
   1230 = 000000000000000C                            mne_trbx =12                   ;TRB
   1231 = 000000000000000D                            mne_tsbx =13                   ;TSB
   1232 = 0000000000000016                            mne_tscx =22                   ;TSC
   1233 = 000000000000004F                            mne_tsxx =79                   ;TSX
   1234 = 0000000000000008                            mne_txax =8                    ;TXA
   1235 = 0000000000000045                            mne_txsx =69                   ;TXS
   1236 = 000000000000005A                            mne_txyx =90                   ;TXY
   1237 = 0000000000000009                            mne_tyax =9                    ;TYA
   1238 = 0000000000000051                            mne_tyxx =81                   ;TYX
   1239 = 0000000000000020                            mne_waix =32                   ;WAI
   1240 = 000000000000002F                            mne_wdmx =47                   ;WDM
   1241 = 0000000000000000                            mne_xbax =0                    ;XBA
   1242 = 000000000000001E                            mne_xcex =30                   ;XCE
                                        ;
                                        ;================================================================================
                                        ;
                                        ;MISCELLANEOUS CONSTANTS
                                        ;
   1248 = 0000000000000004                            halftab  =4                    ;1/2 tabulation spacing
   1249 = 3E                            memprfx  ='>'                  ;memory dump prefix
   1250 = 3A                            memsepch =':'                  ;memory dump separator
   1251 = 2E                            memsubch ='.'                  ;memory dump non-print char
   1252 = 0000000000000030                            srinit   =%00110000            ;SR initialization value
                                        ;
                                        ;================================================================================
                                        ;
                                        ;DIRECT PAGE STORAGE
                                        ;
   1258 = 00000080                      reg_csx  =zeropage			;CS
   1259 = 00000084                      reg_dsx  =reg_csx + 4		;DS
   1260 = 00000088                      reg_pcx  =reg_dsx + 4	    ;PC
   1261 = 0000008A                      reg_pbx  =reg_pcx + 2       ;PB
   1262 = 0000008B                      reg_ax   =reg_pbx + 1       ;.C
   1263 = 0000008F                      reg_xx   =reg_ax + 4        ;.X
   1264 = 00000093                      reg_yx   =reg_xx + 4        ;.Y
   1265 = 00000097                      reg_spx  =reg_yx + 4        ;SP
   1266 = 0000009B                      reg_srx  =reg_spx + 4       ;SR
   1267 = 0000009C                      reg_srxx =reg_srx + 1       ;SRX
   1268 = 0000009D                      reg_dbx  =reg_srxx + 1      ;DB
   1269 = 0000009E                      reg_dpx  =reg_dbx + 1       ;DP
                                        ;
                                        ;
                                        ;	general workspace...
                                        ;
   1274 = 000000A2                      addra    =reg_dpx+4            ;address #1
   1275 = 000000A6                      addrb    =addra+4              ;address #2
   1276 = 000000A9                      faca     =addrb+s_addr         ;primary accumulator
   1277 = 000000AD                      facax    =faca+s_pfac          ;extended primary accumulator
   1278 = 000000B1                      facb     =facax+s_pfac         ;secondary accumulator
   1279 = 000000B7                      facc     =facb+s_sfac          ;tertiary accumulator
   1280 = 000000BD                      operand  =facc+s_sfac          ;instruction operand
   1281 = 000000C0                      auxbufix =operand+s_oper       ;auxiliary buffer index
   1282 = 000000C1                      ibufidx  =auxbufix+s_byte      ;input buffer index
   1283 = 000000C2                      bitsdig  =ibufidx+s_byte       ;bits per numeral
   1284 = 000000C3                      numeral  =bitsdig+s_byte       ;numeral buffer
   1285 = 000000C4                      radix    =numeral+s_byte       ;radix index
   1286 = 000000C5                      admodidx =radix+s_byte         ;addressing mode index
   1287 = 000000C6                      charcnt  =admodidx+s_byte      ;character counter
   1288 = 000000C8                      instsize =charcnt+s_word       ;instruction size
   1289 = 000000CA                      mnepck   =instsize+s_word      ;encoded mnemonic
   1290 = 000000CC                      opcode   =mnepck+s_mnepck      ;current opcode
   1291 = 000000CD                      status   =opcode+s_byte        ;I/O status flag
   1292 = 000000CE                      xrtemp   =status+s_byte        ;temp .X storage
   1293 = 000000CF                      eopsize  =xrtemp+s_byte        ;entered operand size
   1294 = 000000D0                      flimflag =eopsize+s_byte       ;forced long immediate...
                                        ;
                                        ;	xx000000
                                        ;	||
                                        ;	|+—————————> 0: .X/.Y = 8 bits
                                        ;	|            1: .X/.Y = 18 bits
                                        ;	+——————————> 0: .A = 8 bits
                                        ;	             1: .A = 16 bits
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	During assembly, FLIMFLAG indicates the operand size used with an immed-
                                        ;	iate mode instruction, thus causing the following disassembly to display
                                        ;	the assembled  operand size.   During disassembly,  FLIMFLAG will mirror
                                        ;	the effect of the most recent REP or SEP instruction.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1310 = 000000D1                      iopsize  =flimflag+s_byte      ;operand size
   1311 = 000000D2                      range    =iopsize+s_byte       ;allowable radix range
   1312 = 000000D3                      vopsflag =range+s_byte         ;VOPS & ROPS mode bits
                                        ;
                                        ;
                                        ;	copy/fill workspace (overlaps some of the above)...
                                        ;
   1317 = 000000D4                      mcftwork =vopsflag+s_byte	;faca                 ;start of copy/fill code
   1318 = 000000D5                      mcftopc  =mcftwork+s_byte      ;instruction opcode
   1319 = 000000D6                      mcftbnk  =mcftopc+s_byte       ;banks
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SUPERMON 816 JUMP TABLE
                                        ;
                                                 org	_origin_
                                        ;
                                           		 CPU	W65C816S
                                           		 MEM	16
                                           		 NDX	16
   1331 00C000 A9 D0 00                     		 LDA	#$D0
   1332 00C003 8D 00 70                     		 STA	$7000
                                           		 MEM	8
                                           		 NDX	8
                                        		 CPU	W65C02
   1336 C006 80 02                      JMON     bra mon               ;cold start entry
   1337 C008 80 4F                      JMONBRK  bra monbrk            ;software interrupt intercept
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mon: SUPERMON 816 COLD START
                                        ;
   1343 C00A C2 20                      mon +         .byte $c2,$20

                                        
   1344 C00C AD 02 01                             lda vecbrki           ;BRK vector
   1345 C00F C9 59                    +            cmp #<monbrk
   1345 C011 C0                       +            .byte >monbrk

                                        ;pointing at monitor?
   1346 C012 D0 03                                bne .2            ;yes, ignore cold start
   1347 C014 4C A4 C0                             jmp	monreg			; got a branch out of range here when debugging code
                                        								; was included
   1349 C017                            .2
                                        ;
   1351 C017 8D 05 01                             sta vecbrkia          ;save vector for exit
   1352 C01A A9 AB                       		 LDA	#$AB
   1353 C01C 00                          		 .byte	$00
   1354 C01D 8D 00 70                    		 STA	$7000
   1355 C020 A9 59                    +            lda #<monbrk
   1355 C022 C0                       +            .byte >monbrk

                                        ;Supermon 816 intercepts...
   1356 C023 8D 02 01                             sta vecbrki           ;BRK handler
   1357 C026 E2 30                    +            .byte $e2,$30

                                                        ;8 bit registers
   1358 C028 A2 49                                ldx #vopsflag-reg_pbx
                                        ;
   1360 C02A 74 8A                      .0000010 stz reg_pbx,x         ;clear DP storage
   1361 C02C CA                                   dex
   1362 C02D 10 FB                                bpl .0000010
                                        ;
   1364 C02F A9 AC                       		 LDA	#$AC
   1365 C031 8D 00 70                    		 STA	$7000
   1366 C034 A9 30                                lda #srinit
   1367 C036 85 9B                                sta reg_srx           ;status register
   1368 C038 C2 20                    +            .byte $c2,$20

                                                         ;16 bit .A
   1369 C03A A9 FF                    +            lda #<hwstack
   1369 C03C 3F                       +            .byte >hwstack

                                        ;top of hardware stack
   1370 C03D 1B                       +            .byte $1b

                                                           ;set SP
   1371 C03E 7B                       +            .byte $7b

                                                           ;get & save...
   1372 C03F 85 9E                                sta reg_dpx           ;DP register
   1373 C041 A9 AD                       		 LDA	#$AD
   1374 C043 00                          		 .byte	$00
   1375 C044 8D 00 70                    		 STA	$7000
   1376 C047 A9 00                    +            lda #<0
   1376 C049 00                       +            .byte >0

                                        
   1377 C04A E2 20                    +            .byte $e2,$20

                                        
   1378 C04C 4B                       +            .byte $4b

                                        
   1379 C04D 68                                   pla                   ;capture PB &...
   1380 C04E 85 8A                                sta reg_pbx           ;set
   1381 C050 8B                       +            .byte $8b

                                        
   1382 C051 68                                   pla                   ;capture DB &...
   1383 C052 85 9D                                sta reg_dbx           ;set
   1384 C054 F4                       +            .byte $f4
   1384 C055 2C D0                    +            .word mm_entry

                                        ;"...ready..."
   1385 C057 80 2E                                bra moncom
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monbrk: SOFTWARE INTERRUPT INTERCEPT
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This is the entry point taken when a BRK instruction is executed.  It is
                                        ;	assumed that the BRK  handler has pushed the registers to the stack that
                                        ;	are not automatically pushed by the MPU in response to BRK.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1397 C059 58                         monbrk   cli                   ;reenable IRQs
   1398 C05A                            		 phcs
   1399 C05A 68                          		 pla
   1400 C05B 85 80                       		 sta reg_csx
   1401 C05D 68                          		 pla
   1402 C05E 85 82                       		 sta reg_csx+2
   1403 C060                            		 phds
   1404 C060 68                          		 pla
   1405 C061 85 84                       		 sta reg_dsx
   1406 C063 68                          		 pla
   1407 C064 85 86                       		 sta reg_dsx+2
   1408 C066 7A                                   ply                   ;recover registers
   1409 C067 FA                                   plx
   1410 C068 68                                   pla
   1411 C069 C2 30                    +            .byte $c2,$30

                                                         ;store 16 bit registers
   1412 C06B 85 8B                                sta reg_ax            ;.A
   1413 C06D 86 8F                                stx reg_xx            ;.X
   1414 C06F 84 93                                sty reg_yx            ;.Y
   1415 C071 E2 10                    +            .byte $e2,$10

                                                        ;8 bit index registers
   1416 C073 68                                   pla                   ;get DP &...
   1417 C074 85 9E                                sta reg_dpx           ;store
   1418 C076 FA                                   plx                   ;get DB &...
   1419 C077 86 9D                                stx reg_dbx           ;store
   1420 C079 FA                                   plx                   ;get SR &...
   1421 C07A 86 9B                                stx reg_srx           ;store
   1422 C07C 68                                   pla                   ;get PC &...
   1423 C07D 85 88                                sta reg_pcx           ;store
   1424 C07F E2 20                    +            .byte $e2,$20

                                        
   1425 C081 68                                   pla                   ;get PB &...
   1426 C082 85 8A                                sta reg_pbx           ;store
   1427 C084 F4                       +            .byte $f4
   1427 C085 21 D0                    +            .word mm_brk

                                        ;"*BRK"
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncom: COMMON ENTRY POINT
                                        ;
                                        ;	——————————————————————————————————————
                                        ;	DO NOT directly call this entry point!
                                        ;	——————————————————————————————————————
                                        ;
   1437 C087                            moncom   
   1438 C087 A9 AE                       		 LDA	#$AE
   1439 C089 8D 00 70                    		 STA	$7000
   1440 C08C 20 1D C8                    		 jsr sprint            ;print heading
   1441 C08F A9 AF                       		 LDA	#$AF
   1442 C091 8D 00 70                    		 STA	$7000
   1443 C094 C2 20                    +            .byte $c2,$20

                                        
   1444 C096 3B                       +            .byte $3b

                                                           ;get SP &...
   1445 C097 85 97                                sta reg_spx           ;store
   1446 C099 A9 B0                       		 LDA	#$B0
   1447 C09B 00                          		 .byte	$00
   1448 C09C 8D 00 70                    		 STA	$7000
   1449 C09F C2 FF                    +            .byte $c2,%11111111

                                        ;clear SR &...
   1450 C0A1 E2 30                    +            .byte $e2,srinit

                                        ;set default state
   1451 C0A3 38                                   sec                   ;see next
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monreg: DISPLAY MPU REGISTERS
                                        ;
                                        ;	—————————
                                        ;	syntax: R
                                        ;	—————————
                                        ;
   1461 C0A4 B0 03                      monreg   bcs .0000010          ;okay to proceed
                                        ;
   1463 C0A6 4C 88 C1                             jmp monerr            ;error if called with a parm
                                        ;
   1465 C0A9 F4                         .0000010 +         .byte $f4
   1465 C0AA 57 D0                    +            .word mm_regs

                                        
   1466 C0AC 20 1D C8                             jsr sprint            ;display heading
                                        ;
                                        ;
                                        ;	display program bank & counter...
                                        ;
   1471 C0AF C2 20                    +            .byte $c2,$20

                                        
   1472 C0B1 A5 82                       		 lda	reg_csx+2
   1473 C0B3 E2 20                    +            .byte $e2,$20

                                        
   1474 C0B5 20 E1 C7                    		 jsr	dpyhexw
   1475 C0B8 C2 20                    +            .byte $c2,$20

                                        
   1476 C0BA A5 80                       		 lda	reg_csx
   1477 C0BC E2 20                    +            .byte $e2,$20

                                        
   1478 C0BE 20 E1 C7                    		 jsr    dpyhexw
   1479 C0C1 E2 20                    +            .byte $e2,$20

                                        
   1480 C0C3 20 18 C8                             jsr printspc          ;inter-field space
   1481 C0C6 A5 8A                                lda reg_pbx           ;PB
   1482 C0C8 20 F1 C7                             jsr dpyhex            ;display as hex ASCII
   1483 C0CB 20 18 C8                             jsr printspc          ;inter-field space
   1484 C0CE C2 20                    +            .byte $c2,$20

                                        
   1485 C0D0 A5 88                                lda reg_pcx
   1486 C0D2 E2 20                    +            .byte $e2,$20

                                        
   1487 C0D4 20 E1 C7                             jsr dpyhexw           ;display PC
   1488 C0D7 A2 02                                ldx #2
   1489 C0D9 20 FB C7                             jsr multspc           ;inter-field spacing
                                        ;
                                        ;
                                        ;	display SR in bitwise fashion...
                                        ;
   1494 C0DC A5 9C                       		 lda reg_srxx
   1495 C0DE 4A                          		 lsr
   1496 C0DF 4A                          		 lsr
   1497 C0E0 69 30                       		 adc #'0'
   1498 C0E2 20 06 F4                    		 jsr putcha
   1499 C0E5 A5 9C                       		 lda reg_srxx
   1500 C0E7 4A                          		 lsr
   1501 C0E8 69 30                       		 adc #'0'
   1502 C0EA 20 06 F4                    		 jsr putcha
                                        
   1504 C0ED A6 9B                                ldx reg_srx           ;SR
   1505 C0EF A0 08                                ldy #s_bibyte         ;bits in a byte
                                        ;
   1507 C0F1 8A                         .0000020 txa                   ;remaining SR bits
   1508 C0F2 0A                                   asl                   ;grab one of them
   1509 C0F3 AA                                   tax                   ;save remainder
   1510 C0F4 A9 30                                lda #'0'              ;a clear bit but...
   1511 C0F6 69 00                                adc #0                ;adjust if set &...
   1512 C0F8 20 06 F4                             jsr putcha            ;print
   1513 C0FB 88                                   dey                   ;bit processed
   1514 C0FC D0 F3                                bne .0000020          ;do another
                                        ;
                                        ;
                                        ;	display .C, .X, .Y, SP & DP...
                                        ;
   1519 C0FE 20 18 C8                   .0000030 jsr printspc          ;spacing
   1520 C101 C2 20                    +            .byte $c2,$20

                                        
   1521 C103 B9 8D 00                             lda reg_ax+2,y        ;get register value
   1522 C106 E2 20                    +            .byte $e2,$20

                                        
   1523 C108 20 E1 C7                             jsr dpyhexw           ;convert & display
   1524 C10B C2 20                    +            .byte $c2,$20

                                        
   1525 C10D B9 8B 00                             lda reg_ax,y          ;get register value
   1526 C110 E2 20                    +            .byte $e2,$20

                                        
   1527 C112 20 E1 C7                             jsr dpyhexw           ;convert & display
                                        ;         .rept s_word
   1529 C115 C8                                     iny
   1530 C116 C8                                     iny
                                        ;         .endr
                                        ;         .rept s_word
   1533 C117 C8                                     iny
   1534 C118 C8                                     iny
                                        ;         .endr
   1536 C119 C0 0F                                cpy #reg_spx-reg_ax+3
   1537 C11B 90 E1                                bcc .0000030          ;next
                                        ;
                                        ;
                                        ;	display DS DB...
                                        ;
   1542 C11D F4                       +            .byte $f4
   1542 C11E B7 D0                    +            .word mm_regs2

                                        
   1543 C120 20 1D C8                    		 jsr sprint
   1544 C123 C2 20                    +            .byte $c2,$20

                                        
   1545 C125 A5 86                                lda reg_dsx+2         ;get DS &...
   1546 C127 E2 20                    +            .byte $e2,$20

                                        
   1547 C129 20 E1 C7                             jsr dpyhexw           ;convert & display
   1548 C12C C2 20                    +            .byte $c2,$20

                                        
   1549 C12E A5 84                                lda reg_dsx           ;get DS &...
   1550 C130 E2 20                    +            .byte $e2,$20

                                        
   1551 C132 20 E1 C7                             jsr dpyhexw           ;convert & display
   1552 C135 20 18 C8                             jsr printspc          ;more spacing
   1553 C138 A5 9D                                lda reg_dbx           ;get DB &...
   1554 C13A 20 F1 C7                             jsr dpyhex            ;display it
   1555 C13D 20 18 C8                             jsr printspc          ;more spacing
   1556 C140 C2 20                    +            .byte $c2,$20

                                        
   1557 C142 A5 9E                                lda reg_dpx           ;get DPR &...
   1558 C144 E2 20                    +            .byte $e2,$20

                                        
   1559 C146 20 E1 C7                             jsr dpyhexw           ;convert & display
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monce: COMMAND EXECUTIVE
                                        ;	
   1565 C149 E2 20                      monce +         .byte $e2,$20

                                        
   1566 C14B A9 00                                lda #0                ;default buffer index
                                        ;
   1568 C14D E2 30                      moncea +         .byte $e2,$30

                                                        ;alternate entry point
   1569 C14F 85 C1                                sta ibufidx           ;(re)set buffer index
   1570 C151 F4                       +            .byte $f4
   1570 C152 4E D0                    +            .word mm_prmpt

                                        
   1571 C154 20 1D C8                             jsr sprint            ;display input prompt
   1572 C157 20 3D CC                             jsr input             ;await some input
                                        ;
   1574 C15A                            .0000010:
   1575 C15A 20 9B CC                    		jsr getcharc          ;read from buffer
   1576 C15D F0 EA                                beq monce             ;terminator, just loop
                                        ;
   1578 C15F C9 20                                cmp #a_blank
   1579 C161 F0 F7                                beq .0000010          ;strip leading blanks
                                        ;
   1581 C163 A2 0C                                ldx #n_mpctab-1       ;number of primary commands
                                        ;
   1583 C165 DD B8 CC                   .0000020 cmp mpctab,x          ;search primary command list
   1584 C168 D0 0E                                bne .0000030
                                        ;
   1586 C16A 8A                                   txa                   ;get index
   1587 C16B 0A                                   asl                   ;double for offset
   1588 C16C AA                                   tax
   1589 C16D C2 20                    +            .byte $c2,$20

                                        
   1590 C16F BD C5 CC                             lda mpcextab,x        ;command address -1
   1591 C172 48                                   pha                   ;prime the stack
   1592 C173 E2 20                    +            .byte $e2,$20

                                        
   1593 C175 4C E1 CA                             jmp getparm           ;evaluate parm & execute command
                                        ;
   1595 C178 CA                         .0000030 dex
   1596 C179 10 EA                                bpl .0000020          ;continue searching primary commands
                                        ;
   1598 C17B A2 03                                ldx #n_radix-1        ;number of radices
                                        ;
   1600 C17D DD F3 CC                   .0000040 cmp radxtab,x         ;search conversion command list
   1601 C180 D0 03                                bne .0000050
                                        ;
   1603 C182 4C D0 C5                             jmp monenv            ;convert & display parameter
                                        ;
   1605 C185 CA                         .0000050 dex
   1606 C186 10 F5                                bpl .0000040
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monerr: COMMON ERROR HANDLER
                                        ;
   1612 C188 E2 30                      monerr +         .byte $e2,$30

                                                        ;8 bit registers
                                        ;
   1614 C18A 20 C8 C7                   monerraa jsr dpyerr            ;indicate an error &...
   1615 C18D 80 BA                                bra monce             ;return to input loop
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monasc: ASSEMBLE CODE
                                        ;
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;	syntax: A <addr> <mnemonic> [<argument>]
                                        ;
                                        ;	After a line of code has been successfully assembled it will be disass-
                                        ;	embled & displayed,  & the monitor will prompt with the next address to
                                        ;	which code may be assembled.
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;
   1629 C18F 90 03                      monasc   bcc .0000020          ;assembly address entered
                                        ;
   1631 C191 4C 88 C1                   .0000010 jmp monerr            ;terminate w/error
                                        ;
                                        ;
                                        ;	evaluate assembly address...
                                        ;
   1636 C194 20 CD CA                   .0000020 jsr facasize          ;check address...
   1637 C197 C9 04                                cmp #s_dword          ;range
   1638 C199 B0 F6                                bcs .0000010          ;out of range — error
                                        ;
   1640 C19B 20 AF CA                             jsr facaddra          ;store assembly address
                                        ;
                                        ;
                                        ;	initialize workspace...
                                        ;
   1645 C19E A2 1F                                ldx #s_auxbuf-s_byte
                                        ;
   1647 C1A0 9E 51 02                   .0000030 stz auxbuf,x          ;clear addressing mode buffer
   1648 C1A3 CA                                   dex
   1649 C1A4 D0 FA                                bne .0000030
                                        ;
   1651 C1A6 A9 20                                lda #a_blank
   1652 C1A8 8D 51 02                             sta auxbuf            ;preamble placeholder
   1653 C1AB 20 1C CA                             jsr clroper           ;clear operand
   1654 C1AE 64 C0                                stz auxbufix          ;reset addressing mode index
   1655 C1B0 64 D0                                stz flimflag          ;clear forced long immediate
   1656 C1B2 64 CA                                stz mnepck            ;clear encoded...
   1657 C1B4 64 CB                                stz mnepck+s_byte     ;mnemonic workspace
   1658 C1B6 64 D3                                stz vopsflag          ;clear 8/16 or relative flag
                                        ;
                                        ;
                                        ;	encode mnemonic...
                                        ;
   1663 C1B8 A0 03                                ldy #s_mnemon         ;expected mnemonic size
                                        ;
   1665 C1BA 20 2E CC                   .0000040 jsr getcharw          ;get from buffer wo/whitespace
   1666 C1BD D0 0A                                bne .0000060          ;gotten
                                        ;
   1668 C1BF C0 03                                cpy #s_mnemon         ;any input at all?
   1669 C1C1 90 03                                bcc .0000050          ;yes
                                        ;
   1671 C1C3 4C 49 C1                             jmp monce             ;no, abort further assembly
                                        ;
   1673 C1C6 4C 66 C3                   .0000050 jmp monasc10          ;incomplete mnemonic — error
                                        ;
   1675 C1C9 38                         .0000060 sec
   1676 C1CA E9 3F                                sbc #a_mnecvt         ;ASCII to binary factor
   1677 C1CC A2 05                                ldx #n_shfenc         ;shifts required to encode
                                        ;
   1679 C1CE 4A                         .0000070 lsr                   ;shift out a bit...
   1680 C1CF 66 CB                                ror mnepck+s_byte     ;into...
   1681 C1D1 66 CA                                ror mnepck            ;encoded mnemonic
   1682 C1D3 CA                                   dex
   1683 C1D4 D0 F8                                bne .0000070          ;next bit
                                        ;
   1685 C1D6 88                                   dey
   1686 C1D7 D0 E1                                bne .0000040          ;get next char
                                        ;
                                        ;
                                        ;	test for copy instruction...
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The MVN & MVP instructions accept two operands & hence have an irregular
                                        ;	syntax.  Therefore, special handling is necessary to assemble either of
                                        ;	these instructions.
                                        ;
                                        ;	The official WDC syntax has the programmer entering a pair of 24 bit ad-
                                        ;	dresses as operands, with the assembler isolating bits 16-23 to	use as
                                        ;	operands.  This formality has been dispensed with in this monitor & the
                                        ;	operands are expected to be 8 bit bank values.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1701 C1D9 C2 20                    +            .byte $c2,$20

                                                         ;16 bit load
   1702 C1DB A5 CA                                lda mnepck            ;packed menmonic
   1703 C1DD A2 54                                ldx #opc_mvn          ;MVN opcode
   1704 C1DF C9 DC                    +            cmp #<mne_mvn
   1704 C1E1 7D                       +            .byte >mne_mvn

                                        ;is it MVN?
   1705 C1E2 F0 07                                beq monasc01          ;yes
                                        ;
   1707 C1E4 A2 44                                ldx #opc_mvp          ;MVP opcode
   1708 C1E6 C9 DC                    +            cmp #<mne_mvp
   1708 C1E8 8D                       +            .byte >mne_mvp

                                        ;is it MVP?
   1709 C1E9 D0 30                                bne monasc02          ;no
                                        ;
                                        ;
                                        ;	assemble copy instruction...
                                        ;
   1714 C1EB 86 CC                      monasc01 stx opcode            ;store relevant opcode
   1715 C1ED E2 20                    +            .byte $e2,$20

                                        
   1716 C1EF 20 3D CB                             jsr instdata          ;get instruction data
   1717 C1F2 86 CF                                stx eopsize           ;effective operand size
   1718 C1F4 E8                                   inx
   1719 C1F5 86 C8                                stx instsize          ;instruction size
   1720 C1F7 A2 01                                ldx #s_oper-s_word    ;operand index
   1721 C1F9 86 CE                                stx xrtemp            ;set it
                                        ;
   1723 C1FB 20 36 C8                   .0000010 jsr ascbin            ;evaluate bank number
   1724 C1FE B0 50                                bcs monasc04          ;conversion error
                                        ;
   1726 C200 F0 4E                                beq monasc04          ;nothing returned — error
                                        ;
   1728 C202 20 CD CA                             jsr facasize          ;bank must be...
   1729 C205 C9 02                                cmp #s_word           ;8 bits
   1730 C207 B0 47                                bcs monasc04          ;it isn't — error
                                        ;
   1732 C209 A5 A9                                lda faca              ;bank
   1733 C20B A6 CE                                ldx xrtemp            ;operand index
   1734 C20D 95 BD                                sta operand,x         ;store
   1735 C20F C6 CE                                dec xrtemp            ;index=index-1
   1736 C211 10 E8                                bpl .0000010          ;get destination bank
                                        ;
   1738 C213 20 CE CB                             jsr getcharr          ;should be no more input
   1739 C216 D0 38                                bne monasc04          ;there is — error
                                        ;
   1741 C218 4C 16 C3                             jmp monasc08          ;finish MVN/MVP assembly 
                                        ;
                                        ;
                                        ;	continue with normal assembly...
                                        ;
   1746 C21B E2 20                      monasc02 +         .byte $e2,$20

                                                        ;back to 8 bits
                                        ;
   1748 C21D 20 2E CC                   monasc03 jsr getcharw          ;get next char
   1749 C220 F0 3D                                beq monasc06          ;EOI, no argument
                                        ;
   1751 C222 C9 21                                cmp #amp_flim
   1752 C224 D0 0A                                bne .0000010          ;no forced long immediate
                                        ;
   1754 C226 A5 D0                                lda flimflag          ;FLIM already set?
   1755 C228 D0 26                                bne monasc04          ;yes — error
                                        ;
   1757 C22A A9 C0                                lda #flimmask
   1758 C22C 85 D0                                sta flimflag          ;set flag &...
   1759 C22E 80 ED                                bra monasc03          ;get next char
                                        ;
   1761 C230 C9 23                      .0000010 cmp #amp_imm          ;immediate mode?
   1762 C232 F0 08                                beq .0000020          ;yes
                                        ;
   1764 C234 C9 28                                cmp #amp_ind          ;indirect mode?
   1765 C236 F0 04                                beq .0000020          ;yes
                                        ;
   1767 C238 C9 5B                                cmp #amp_indl         ;indirect long mode?
   1768 C23A D0 07                                bne .0000030          ;no
                                        ;
   1770 C23C 8D 51 02                   .0000020 sta auxbuf            ;set addressing mode preamble
   1771 C23F E6 C0                                inc auxbufix          ;bump aux buffer index &...
   1772 C241 80 02                                bra .0000040          ;evaluate operand
                                        ;
   1774 C243 C6 C1                      .0000030 dec ibufidx           ;position back to char
                                        ;
   1776 C245 20 36 C8                   .0000040 jsr ascbin            ;evaluate operand
   1777 C248 D0 09                                bne monasc05          ;evaluated
                                        ;
   1779 C24A B0 04                                bcs monasc04          ;conversion error
                                        ;
   1781 C24C A5 C0                                lda auxbufix          ;no operand...any preamble?
   1782 C24E F0 0F                                beq monasc06          ;no, syntax is okay so far
                                        ;
   1784 C250 4C 66 C3                   monasc04 jmp monasc10          ;abort w/error
                                        ;
   1786 C253 20 CD CA                   monasc05 jsr facasize          ;size operand
   1787 C256 C9 04                                cmp #s_dword          ;max is 24 bits
   1788 C258 B0 F6                                bcs monasc04          ;too big
                                        ;
   1790 C25A 85 CF                                sta eopsize           ;save operand size
   1791 C25C 20 C3 CA                             jsr facaoper          ;store operand
                                        ;
   1793 C25F C6 C1                      monasc06 dec ibufidx           ;back to last char
   1794 C261 A6 C0                                ldx auxbufix          ;mode buffer index
   1795 C263 D0 01                                bne .0000010          ;preamble in buffer
                                        ;
   1797 C265 E8                                   inx                   ;step past preamble position
                                        ;
   1799 C266 20 9B CC                   .0000010 jsr getcharc          ;get a char w/forced UC
   1800 C269 F0 0A                                beq .0000030          ;EOI
                                        ;
   1802 C26B E0 20                                cpx #s_auxbuf         ;mode buffer full?
   1803 C26D B0 E1                                bcs monasc04          ;yes, too much input
                                        ;
   1805 C26F 9D 51 02                   .0000020 sta auxbuf,x          ;store for comparison
   1806 C272 E8                                   inx
   1807 C273 D0 F1                                bne .0000010
                                        ;
                                        ;
                                        ;	evaluate mnemonic...
                                        ;
   1812 C275 A2 5B                      .0000030 ldx #n_mnemon-1       ;starting mnemonic index
                                        ;
   1814 C277 8A                         monasc07 txa                   ;convert index...
   1815 C278 0A                                   asl                   ;to offset
   1816 C279 A8                                   tay                   ;now mnemonic table index
   1817 C27A C2 20                    +            .byte $c2,$20

                                                         ;16 bit compare
   1818 C27C B9 00 CD                             lda mnetab,y          ;get mnemonic from table
   1819 C27F C5 CA                                cmp mnepck            ;compare to entered mnemonic
   1820 C281 E2 20                    +            .byte $e2,$20

                                                        ;back to 8 bits
   1821 C283 F0 05                                beq .0000020          ;match
                                        ;
   1823 C285 CA                         .0000010 dex                   ;try next mnemonic
   1824 C286 30 C8                                bmi monasc04          ;unknown mnemonic — error
                                        ;
   1826 C288 80 ED                                bra monasc07          ;keep going
                                        ;
   1828 C28A 86 CA                      .0000020 stx mnepck            ;save mnemonic index
   1829 C28C 8A                                   txa
   1830 C28D A2 00                                ldx #0                ;trial opcode
                                        ;
   1832 C28F DD B8 CD                   .0000030 cmp mnetabix,x        ;search index table...
   1833 C292 F0 05                                beq .0000050          ;for a match
                                        ;
   1835 C294 E8                         .0000040 inx                   ;keep going until we...
   1836 C295 D0 F8                                bne .0000030          ;search entire table
                                        ;
   1838 C297 80 B7                                bra monasc04          ;this shouldn't happen!
                                        ;
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;	If the mnemonic index table search fails then there is a coding error
                                        ;	somewhere, as every entry in the mnemonic table is supposed to have a
                                        ;	matching cardinal index.
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	evaluate addressing mode...
                                        ;
   1849 C299 86 CC                      .0000050 stx opcode            ;save trial opcode
   1850 C29B 20 3D CB                             jsr instdata          ;get related instruction data
   1851 C29E 85 D3                                sta vopsflag          ;save 8/16 or relative flag
   1852 C2A0 86 D1                                stx iopsize           ;operand size
   1853 C2A2 E8                                   inx
   1854 C2A3 86 C8                                stx instsize          ;instruction size
   1855 C2A5 A6 CC                                ldx opcode            ;recover trial opcode
   1856 C2A7 98                                   tya                   ;addressing mode
   1857 C2A8 0A                                   asl                   ;create table index
   1858 C2A9 A8                                   tay
   1859 C2AA C2 20                    +            .byte $c2,$20

                                        
   1860 C2AC B9 BC CF                             lda ms_lutab,y        ;mode lookup table
   1861 C2AF 85 A6                                sta addrb             ;set pointer
   1862 C2B1 E2 20                    +            .byte $e2,$20

                                        
   1863 C2B3 A0 00                                ldy #0
                                        ;
   1865 C2B5 B1 A6                      .0000060 lda (addrb),y         ;table addressing mode
   1866 C2B7 D9 51 02                             cmp auxbuf,y          ;entered addressing mode
   1867 C2BA F0 04                                beq .0000080          ;okay so far
                                        ;
   1869 C2BC A5 CA                      .0000070 lda mnepck            ;reload mnemonic index        
   1870 C2BE 80 D4                                bra .0000040          ;wrong opcode for addresing mode
                                        ;
   1872 C2C0 09 00                      .0000080 ora #0                ;last char the terminator?
   1873 C2C2 F0 03                                beq .0000090          ;yes, evaluate operand
                                        ;
   1875 C2C4 C8                                   iny
   1876 C2C5 80 EE                                bra .0000060          ;keep testing
                                        ;
                                        ;
                                        ;	evaluate operand...
                                        ;
   1881 C2C7 A5 CF                      .0000090 lda eopsize           ;entered operand size
   1882 C2C9 D0 06                                bne .0000100          ;non-zero
                                        ;
   1884 C2CB 05 D1                                ora iopsize           ;instruction operand size
   1885 C2CD D0 ED                                bne .0000070          ;wrong opcode — keep trying
                                        ;
   1887 C2CF 80 45                                bra monasc08          ;assemble instruction
                                        ;
   1889 C2D1 24 D3                      .0000100 bit vopsflag          ;is this a branch?
   1890 C2D3 70 3A                                bvs .0000160          ;yes, evaluate
                                        ;
   1892 C2D5 A5 D1                                lda iopsize           ;instruction operand size
   1893 C2D7 24 D3                                bit vopsflag          ;variable size operand allowed?
   1894 C2D9 30 15                                bmi .0000130          ;yes
                                        ;
   1896 C2DB 24 D0                                bit flimflag          ;was forced immediate set?
   1897 C2DD 10 03                                bpl .0000110          ;no
                                        ;         
   1899 C2DF 4C 66 C3                             jmp monasc10          ;yes — error
                                        ;
   1901 C2E2 C5 CF                      .0000110 cmp eopsize           ;entered operand size
   1902 C2E4 90 D6                                bcc .0000070          ;operand too big
                                        ;
   1904 C2E6 85 CF                                sta eopsize           ;new operand size
   1905 C2E8 80 2C                                bra monasc08          ;assemble, otherwise...
                                        ;
   1907 C2EA C5 CF                      .0000120 cmp eopsize           ;exact size match required
   1908 C2EC D0 CE                                bne .0000070          ;mismatch — wrong opcode
                                        ;
   1910 C2EE 80 26                                bra monasc08          ;assemble
                                        ;
                                        ;
                                        ;	process variable size immediate mode operand...
                                        ;
   1915 C2F0 A6 CF                      .0000130 ldx eopsize           ;entered operand size
   1916 C2F2 E0 03                                cpx #s_xword          ;check size
   1917 C2F4 B0 70                                bcs monasc10          ;too big — error
                                        ;
   1919 C2F6 24 D0                                bit flimflag          ;forced long immediate?
   1920 C2F8 10 06                                bpl .0000140          ;no
                                        ;
   1922 C2FA A2 02                                ldx #s_word           ;promote operand size to...
   1923 C2FC 86 CF                                stx eopsize           ;16 bits
   1924 C2FE 80 08                                bra .0000150
                                        ;
   1926 C300 E0 02                      .0000140 cpx #s_word           ;16 bits?
   1927 C302 D0 04                                bne .0000150          ;no
                                        ;
   1929 C304 A0 C0                                ldy #flimmask         ;yes so force long...
   1930 C306 84 D0                                sty flimflag          ;immediate disassembly
                                        ;
   1932 C308 1A                         .0000150 ina                   ;new instruction operand size
   1933 C309 C5 CF                                cmp eopsize           ;compare against operand size
   1934 C30B 90 AF                                bcc .0000070          ;mismatch — can't assemble
                                        ;
   1936 C30D 80 07                                bra monasc08          ;okay, assemble
                                        ;
                                        ;
                                        ;	process relative branch...
                                        ;
   1941 C30F 20 89 CB                   .0000160 jsr targoff           ;compute branch offset
   1942 C312 B0 52                                bcs monasc10          ;branch out of range
                                        ;
   1944 C314 85 CF                                sta eopsize           ;effective operand size
                                        ;
                                        ;
                                        ;	assemble instruction...
                                        ;
   1949 C316 A5 CC                      monasc08 lda opcode            ;opcode
   1950 C318 87 A2                    +            .byte $87,addra

                                        ;store at assembly address
   1951 C31A A6 CF                                ldx eopsize           ;any operand to process?
   1952 C31C F0 09                                beq .0000020          ;no
                                        ;
   1954 C31E 9B                       +            .byte $9b

                                                           ;also storage offset
                                        ;
   1956 C31F CA                         .0000010 dex
   1957 C320 B5 BD                                lda operand,x         ;get operand byte &...
   1958 C322 97 A2                    +            .byte $97,addra

                                        ;poke into memory
   1959 C324 88                                   dey
   1960 C325 D0 F8                                bne .0000010          ;next
                                        ;
   1962 C327 A9 0D                      .0000020 lda #a_cr
   1963 C329 20 06 F4                             jsr putcha            ;return to left margin
   1964 C32C A9 41                                lda #asmprfx          ;assembly prefix
   1965 C32E 20 71 C6                             jsr dpycodaa          ;disassemble & display
                                        ;
                                        ;
                                        ;	prompt for next instruction...
                                        ;
   1970 C331 A9 20                      monasc09 lda #a_blank
   1971 C333 A2 08                                ldx #ascprmct-1
                                        ;
   1973 C335 9D 00 02                   .0000010 sta ibuffer,x         ;prepare buffer for...
   1974 C338 CA                                   dex                   ;next instruction
   1975 C339 10 FA                                bpl .0000010
                                        ;
   1977 C33B A9 41                                lda #asmprfx          ;assemble code...
   1978 C33D 8D 00 02                             sta ibuffer           ;prompt prefix
   1979 C340 A5 A4                                lda addra+s_word      ;next instruction address bank
   1980 C342 20 88 C9                             jsr binhex            ;convert to ASCII
   1981 C345 8D 02 02                             sta ibuffer+apadrbkh  ;store MSN in buffer
   1982 C348 8E 03 02                             stx ibuffer+apadrbkl  ;store LSN in buffer
   1983 C34B A5 A3                                lda addra+s_byte      ;next instruction address MSB
   1984 C34D 20 88 C9                             jsr binhex
   1985 C350 8D 04 02                             sta ibuffer+apadrmbh
   1986 C353 8E 05 02                             stx ibuffer+apadrmbl
   1987 C356 A5 A2                                lda addra             ;next instruction address LSB
   1988 C358 20 88 C9                             jsr binhex
   1989 C35B 8D 06 02                             sta ibuffer+apadrlbh
   1990 C35E 8E 07 02                             stx ibuffer+apadrlbl
   1991 C361 A9 09                                lda #ascprmct         ;effective input count
   1992 C363 4C 4D C1                             jmp moncea            ;reenter input loop
                                        ;
                                        ;
                                        ;	process assembly error...
                                        ;
   1997 C366 20 C8 C7                   monasc10 jsr dpyerr            ;indicate error &...
   1998 C369 80 C6                                bra monasc09          ;prompt w/same assembly address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondsc: DISASSEMBLE CODE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: D [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2008 C36B B0 11                      mondsc   bcs .0000010          ;no parameters
                                        ;
   2010 C36D 64 D0                                stz flimflag          ;reset to 8 bit mode
   2011 C36F 20 CD CA                             jsr facasize          ;check starting...
   2012 C372 C9 04                                cmp #s_dword          ;address
   2013 C374 B0 46                                bcs .0000050          ;out of range — error
                                        ;
   2015 C376 20 AF CA                             jsr facaddra          ;copy starting address
   2016 C379 20 E1 CA                             jsr getparm           ;get ending address
   2017 C37C 90 17                                bcc .0000020          ;gotten
                                        ;
   2019 C37E 20 9B C9                   .0000010 jsr clrfaca           ;clear accumulator
   2020 C381 C2 20                    +            .byte $c2,$20

                                        
   2021 C383 18                                   clc
   2022 C384 A5 A2                                lda addra             ;starting address
   2023 C386 69 15                    +            adc #<n_dbytes
   2023 C388 00                       +            .byte >n_dbytes

                                        ;default bytes
   2024 C389 85 A9                                sta faca              ;effective ending address
   2025 C38B E2 20                    +            .byte $e2,$20

                                        
   2026 C38D A5 A4                                lda addra+s_word      ;starting bank
   2027 C38F 69 00                                adc #0
   2028 C391 85 AB                                sta faca+s_word       ;effective ending bank
   2029 C393 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2031 C395 20 CD CA                   .0000020 jsr facasize          ;check ending...
   2032 C398 C9 04                                cmp #s_dword          ;address
   2033 C39A B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2035 C39C 20 B9 CA                             jsr facaddrb          ;set ending address
   2036 C39F 20 E1 CA                             jsr getparm           ;check for excess input
   2037 C3A2 90 18                                bcc .0000050          ;present — error
                                        ;
   2039 C3A4 20 07 CA                             jsr calccnt           ;calculate bytes
   2040 C3A7 90 13                                bcc .0000050          ;end < start
                                        ;
   2042 C3A9 20 AD CC                   .0000030 jsr teststop          ;test for display stop
   2043 C3AC B0 0B                                bcs .0000040          ;stopped
                                        ;
   2045 C3AE 20 08 C8                             jsr newline           ;next line
   2046 C3B1 20 6F C6                             jsr dpycod            ;disassemble & display
   2047 C3B4 20 65 CA                             jsr decdcnt           ;decrement byte count
   2048 C3B7 90 F0                                bcc .0000030          ;not done
                                        ;
   2050 C3B9 4C 49 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2052 C3BC 4C 88 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjmp: EXECUTE CODE
                                        ;
                                        ;	—————————————————————————————————————————————————————————————
                                        ;	syntax: G [<addr>]
                                        ;
                                        ;	If no address is specified, the current values in the PB & PC
                                        ;	shadow registers are used.
                                        ;	—————————————————————————————————————————————————————————————
                                        ;
   2065 C3BF 20 72 CB                   monjmp   jsr setxaddr          ;set execution address
   2066 C3C2 B0 29                                bcs monjmpab          ;out of range — error
                                        ;
   2068 C3C4 20 E1 CA                             jsr getparm           ;check for excess input
   2069 C3C7 90 24                                bcc monjmpab          ;too much input — error
                                        ;
   2071 C3C9 C2 20                    +            .byte $c2,$20

                                                         ;16 bit .A
   2072 C3CB A5 97                                lda reg_spx
   2073 C3CD 1B                       +            .byte $1b

                                                           ;restore SP
                                        ;
   2075 C3CE E2 20                      monjmpaa +         .byte $e2,$20

                                        
   2076 C3D0 A5 8A                                lda reg_pbx
   2077 C3D2 48                                   pha                   ;restore PB
   2078 C3D3 C2 20                    +            .byte $c2,$20

                                        
   2079 C3D5 A5 88                                lda reg_pcx
   2080 C3D7 48                                   pha                   ;restore PC
   2081 C3D8 E2 20                    +            .byte $e2,$20

                                        
   2082 C3DA A5 9B                                lda reg_srx
   2083 C3DC 48                                   pha                   ;restore SR
   2084 C3DD A5 9D                                lda reg_dbx
   2085 C3DF 48                                   pha
   2086 C3E0 AB                       +            .byte $ab

                                                           ;restore DB
   2087 C3E1 C2 30                    +            .byte $c2,$30

                                        
   2088 C3E3 A5 9E                                lda reg_dpx
   2089 C3E5 5B                       +            .byte $5b

                                                           ;restore DP
   2090 C3E6 A5 8B                                lda reg_ax            ;restore .C
   2091 C3E8 A6 8F                                ldx reg_xx            ;restore .X
   2092 C3EA A4 93                                ldy reg_yx            ;restore .Y
   2093 C3EC 40                                   rti                   ;execute code
                                        ;
   2095 C3ED 4C 88 C1                   monjmpab jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjsr: EXECUTE CODE AS SUBROUTINE
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	syntax: J [<addr>]
                                        ;
                                        ;	If no address is specified the current values in the PB & PC
                                        ;	shadow registers are used.   An RTS at the end of the called
                                        ;	subroutine will return control to the monitor  provided  the
                                        ;	stack remains in balance.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2110 C3F0 20 72 CB                   monjsr   jsr setxaddr          ;set execution address
   2111 C3F3 B0 F8                                bcs monjmpab          ;out of range — error
                                        ;
   2113 C3F5 20 E1 CA                             jsr getparm           ;check for excess input
   2114 C3F8 90 F3                                bcc monjmpab          ;too much input — error
                                        ;
   2116 C3FA C2 20                    +            .byte $c2,$20

                                        
   2117 C3FC A5 97                                lda reg_spx
   2118 C3FE 1B                       +            .byte $1b

                                                           ;restore SP &...
   2119 C3FF 20 CE C3                             jsr monjmpaa          ;call subroutine
   2120 C402 08                                   php                   ;push SR
   2121 C403 C2 30                    +            .byte $c2,$30

                                        
   2122 C405 85 8B                                sta reg_ax            ;save...
   2123 C407 86 8F                                stx reg_xx            ;register...
   2124 C409 84 93                                sty reg_yx            ;returns
   2125 C40B E2 10                    +            .byte $e2,$10

                                                        ;8 bit .X & .Y
   2126 C40D FA                                   plx                   ;get & save...
   2127 C40E 86 9B                                stx reg_srx           ;return SR
   2128 C410 3B                       +            .byte $3b

                                                           ;get & save...
   2129 C411 85 97                                sta reg_spx           ;return SP
   2130 C413 7B                       +            .byte $7b

                                                           ;get & save...
   2131 C414 85 9E                                sta reg_dpx           ;DP pointer
   2132 C416 E2 20                    +            .byte $e2,$20

                                                        ;8 bit .A
   2133 C418 4B                       +            .byte $4b

                                                           ;get &...
   2134 C419 68                                   pla                   ;save...
   2135 C41A 85 8A                                sta reg_pbx           ;return PB
   2136 C41C 8B                       +            .byte $8b

                                                           ;get &...
   2137 C41D 68                                   pla                   ;save...
   2138 C41E 85 9D                                sta reg_dbx           ;return DB
   2139 C420 F4                       +            .byte $f4
   2139 C421 CF D0                    +            .word mm_rts

                                        ;"*RET"
   2140 C423 4C 87 C0                             jmp moncom            ;return to monitor
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchm: CHANGE and/or DUMP MEMORY
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	syntax: > [<addr> <operand> [<operand>]...]
                                        ;
                                        ;	> <addr> without operands will dump 16 bytes
                                        ;	of memory, starting at <addr>.
                                        ;	————————————————————————————————————————————
                                        ;
   2153 C426 B0 23                      monchm   bcs .0000030          ;no address given — quit
                                        ;
   2155 C428 20 CD CA                             jsr facasize          ;size address
   2156 C42B C9 04                                cmp #s_dword
   2157 C42D B0 1F                                bcs .0000040          ;address out of range — error
                                        ;
   2159 C42F 20 AF CA                             jsr facaddra          ;set starting address
   2160 C432 20 E2 CB                             jsr getpat            ;evaluate change pattern
   2161 C435 90 04                                bcc .0000010          ;entered
                                        ;
   2163 C437 10 0C                                bpl .0000020          ;not entered
                                        ;
   2165 C439 80 13                                bra .0000040          ;evaluation error
                                        ;
   2167 C43B 88                         .0000010 dey                   ;next byte
   2168 C43C 30 07                                bmi .0000020          ;done
                                        ;
   2170 C43E B9 51 02                             lda auxbuf,y          ;write pattern...
   2171 C441 97 A2                    +            .byte $97,addra

                                        ;to memory
   2172 C443 80 F6                                bra .0000010          ;next
                                        ;
   2174 C445 20 08 C8                   .0000020 jsr newline           ;next line
   2175 C448 20 85 C7                             jsr dpymem            ;regurgitate changes
                                        ;
   2177 C44B 4C 49 C1                   .0000030 jmp monce             ;back to command loop
                                        ;
   2179 C44E 4C 88 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncmp: COMPARE MEMORY
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: C <start> <end> <ref>
                                        ;	—————————————————————————————
                                        ;
   2189 C451 B0 26                      moncmp   bcs .0000030          ;start not given — quit
                                        ;
   2191 C453 20 89 CA                             jsr enddest           ;get end & reference addresses
   2192 C456 B0 24                                bcs .0000040          ;range or other error
                                        ;
   2194 C458 64 CE                                stz xrtemp            ;column counter
                                        ;
   2196 C45A 20 AD CC                   .0000010 jsr teststop          ;check for stop
   2197 C45D B0 1A                                bcs .0000030          ;abort
                                        ;
   2199 C45F A7 A2                    +            .byte $a7,addra

                                        ;get from reference location
   2200 C461 C7 BD                    +            .byte $c7,operand

                                        ;test against compare location
   2201 C463 F0 03                                beq .0000020          ;match, don't display address
                                        ;
   2203 C465 20 57 C6                             jsr dpycaddr          ;display current location
                                        ;
   2205 C468 20 09 CB                   .0000020 jsr nxtaddra          ;next reference location
   2206 C46B B0 0C                                bcs .0000030          ;done
                                        ;
   2208 C46D C2 20                    +            .byte $c2,$20

                                        
   2209 C46F E6 BD                                inc operand           ;bump bits 0-15
   2210 C471 E2 20                    +            .byte $e2,$20

                                        
   2211 C473 D0 E5                                bne .0000010
                                        ;
   2213 C475 E6 BF                                inc operand+s_word    ;bump bits 16-23
   2214 C477 80 E1                                bra .0000010
                                        ;
   2216 C479 4C 49 C1                   .0000030 jmp monce             ;return to command exec
                                        ;
   2218 C47C 4C 88 C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncpy: COPY (transfer) MEMORY
                                        ;
                                        ;	————————————————————————————————
                                        ;	syntax: T <start> <end> <target>
                                        ;	————————————————————————————————
                                        ;
   2228 C47F B0 49                      moncpy   bcs .0000040          ;start not given — quit
                                        ;
   2230 C481 20 89 CA                             jsr enddest           ;get end & target addresses
   2231 C484 B0 47                                bcs .0000050          ;range or other error
                                        ;
   2233 C486 C2 20                    +            .byte $c2,$20

                                        
   2234 C488 38                                   sec
   2235 C489 A5 A6                                lda addrb             ;ending address
   2236 C48B E5 A2                                sbc addra             ;starting address
   2237 C48D 90 3E                                bcc .0000050          ;start > end — error
                                        ;
   2239 C48F 85 B1                                sta facb              ;bytes to copy
   2240 C491 E2 20                    +            .byte $e2,$20

                                        
   2241 C493 C2 10                    +            .byte $c2,$10

                                        
   2242 C495 A5 BF                                lda operand+s_word    ;target bank
   2243 C497 A4 BD                                ldy operand           ;target address
   2244 C499 C5 A4                                cmp addra+s_word      ;source bank
   2245 C49B C2 20                    +            .byte $c2,$20

                                        
   2246 C49D D0 1C                                bne .0000020          ;can use forward copy
                                        ;
   2248 C49F C4 A2                                cpy addra             ;source address
   2249 C4A1 90 18                                bcc .0000020          ;can use forward copy
                                        ;
   2251 C4A3 D0 02                                bne .0000010          ;must use reverse copy
                                        ;
   2253 C4A5 80 26                                bra .0000050          ;copy in place — error
                                        ;
   2255 C4A7 A5 B1                      .0000010 lda facb              ;get bytes to copy
   2256 C4A9 48                                   pha                   ;protect
   2257 C4AA 20 93 CC                             jsr lodbnk            ;load banks
   2258 C4AD 20 2F CA                             jsr cprvsup           ;do reverse copy setup
   2259 C4B0 68                                   pla                   ;get bytes to copy
   2260 C4B1 AA                                   tax                   ;save a copy
   2261 C4B2 18                                   clc
   2262 C4B3 65 BD                                adc operand           ;change target to...
   2263 C4B5 A8                                   tay                   ;target end
   2264 C4B6 8A                                   txa                   ;recover bytes to copy
   2265 C4B7 A6 A6                                ldx addrb             ;source end
   2266 C4B9 80 0C                                bra .0000030
                                        ;
   2268 C4BB A5 B1                      .0000020 lda facb              ;get bytes to copy
   2269 C4BD 48                                   pha                   ;protect
   2270 C4BE 20 93 CC                             jsr lodbnk            ;load banks
   2271 C4C1 20 28 CA                             jsr cpfwsup           ;do forward copy setup
   2272 C4C4 68                                   pla                   ;get bytes to copy
   2273 C4C5 A6 A2                                ldx addra             ;source start
                                        ;
   2275 C4C7 4C D4 00                   .0000030 jmp mcftwork          ;copy memory
                                        ;
   2277 C4CA 4C 49 C1                   .0000040 jmp monce             ;back to executive
                                        ;
   2279 C4CD 4C 88 C1                   .0000050 jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondmp: DISPLAY MEMORY RANGE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: M [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2289 C4D0 B0 0F                      mondmp   bcs .0000010          ;no parameters
                                        ;
   2291 C4D2 20 CD CA                             jsr facasize          ;check address...
   2292 C4D5 C9 04                                cmp #s_dword          ;range
   2293 C4D7 B0 46                                bcs .0000050          ;address out of range
                                        ;
   2295 C4D9 20 AF CA                             jsr facaddra          ;copy starting address
   2296 C4DC 20 E1 CA                             jsr getparm           ;get ending address
   2297 C4DF 90 17                                bcc .0000020          ;gotten
                                        ;
   2299 C4E1 20 9B C9                   .0000010 jsr clrfaca           ;clear accumulator
   2300 C4E4 C2 20                    +            .byte $c2,$20

                                        
   2301 C4E6 18                                   clc
   2302 C4E7 A5 A2                                lda addra             ;starting address
   2303 C4E9 69 FF                    +            adc #<n_mbytes
   2303 C4EB 00                       +            .byte >n_mbytes

                                        ;default bytes
   2304 C4EC 85 A9                                sta faca              ;effective ending address
   2305 C4EE E2 20                    +            .byte $e2,$20

                                        
   2306 C4F0 A5 A4                                lda addra+s_word      ;starting bank
   2307 C4F2 69 00                                adc #0
   2308 C4F4 85 AB                                sta faca+s_word       ;effective ending bank
   2309 C4F6 B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2311 C4F8 20 CD CA                   .0000020 jsr facasize          ;check ending address...
   2312 C4FB C9 04                                cmp #s_dword          ;range
   2313 C4FD B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2315 C4FF 20 B9 CA                             jsr facaddrb          ;copy ending address
   2316 C502 20 E1 CA                             jsr getparm           ;check for excess input
   2317 C505 90 18                                bcc .0000050          ;error
                                        ;
   2319 C507 20 07 CA                             jsr calccnt           ;calculate bytes to dump
   2320 C50A 90 13                                bcc .0000050          ;end < start
                                        ;
   2322 C50C 20 AD CC                   .0000030 jsr teststop          ;test for display stop
   2323 C50F B0 0B                                bcs .0000040          ;stopped
                                        ;
   2325 C511 20 08 C8                             jsr newline           ;next line
   2326 C514 20 85 C7                             jsr dpymem            ;display
   2327 C517 20 65 CA                             jsr decdcnt           ;decrement byte count
   2328 C51A 90 F0                                bcc .0000030          ;not done
                                        ;
   2330 C51C 4C 49 C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2332 C51F 4C 88 C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monfil: FILL MEMORY
                                        ;
                                        ;	—————————————————————————————————————————
                                        ;	syntax: F <start> <end> <fill>
                                        ;
                                        ;	<start> & <end> must be in the same bank.
                                        ;	—————————————————————————————————————————
                                        ;
   2344 C522 B0 5E                      monfil   bcs .0000010          ;start not given — quit
                                        ;
   2346 C524 20 CD CA                             jsr facasize          ;check size
   2347 C527 C9 04                                cmp #s_dword
   2348 C529 B0 5A                                bcs .0000020          ;out of range — error...
                                        ;
   2350 C52B 20 AF CA                             jsr facaddra          ;store start
   2351 C52E 20 E1 CA                             jsr getparm           ;evaluate end
   2352 C531 B0 52                                bcs .0000020          ;not entered — error
                                        ;
   2354 C533 20 CD CA                             jsr facasize          ;check size
   2355 C536 C9 04                                cmp #s_dword
   2356 C538 B0 4B                                bcs .0000020          ;out of range — error
                                        ;
   2358 C53A A5 AB                                lda faca+s_word       ;end bank
   2359 C53C C5 A4                                cmp addra+s_word      ;start bank
   2360 C53E D0 45                                bne .0000020          ;not same — error
                                        ;
   2362 C540 20 B9 CA                             jsr facaddrb          ;store <end>
   2363 C543 C2 20                    +            .byte $c2,$20

                                        
   2364 C545 38                                   sec
   2365 C546 A5 A6                                lda addrb             ;ending address
   2366 C548 E5 A2                                sbc addra             ;starting address
   2367 C54A 90 39                                bcc .0000020          ;start > end — error
                                        ;
   2369 C54C 85 B1                                sta facb              ;bytes to copy
   2370 C54E E2 20                    +            .byte $e2,$20

                                        
   2371 C550 20 E1 CA                             jsr getparm           ;evaluate <fill>
   2372 C553 B0 30                                bcs .0000020          ;not entered — error
                                        ;
   2374 C555 20 CD CA                             jsr facasize          ;<fill> should be...
   2375 C558 C9 02                                cmp #s_word           ;8 bits
   2376 C55A B0 29                                bcs .0000020          ;it isn't — error
                                        ;
   2378 C55C 20 C3 CA                             jsr facaoper          ;store <fill>
   2379 C55F 20 E1 CA                             jsr getparm           ;should be no more parameters
   2380 C562 90 21                                bcc .0000020          ;there are — error
                                        ;
   2382 C564 A5 BD                                lda operand           ;<fill>
   2383 C566 87 A2                    +            .byte $87,addra

                                        ;fill 1st location
   2384 C568 C2 30                    +            .byte $c2,$30

                                                         ;16 bit operations
   2385 C56A A5 B1                                lda facb              ;
   2386 C56C F0 14                                beq .0000010          ;only 1 location — finished
                                        ;
   2388 C56E 3A                                   dea                   ;zero align &...
   2389 C56F 48                                   pha                   ;protect
   2390 C570 E2 20                    +            .byte $e2,$20

                                        
   2391 C572 A5 A4                                lda addra+s_word      ;start bank
   2392 C574 EB                       +            .byte $eb

                                        
   2393 C575 A5 A8                                lda addrb+s_word      ;end bank
   2394 C577 20 28 CA                             jsr cpfwsup           ;do forward copy setup
   2395 C57A 68                                   pla                   ;recover fill count
   2396 C57B A6 A2                                ldx addra             ;fill-from starting location
   2397 C57D 9B                       +            .byte $9b

                                        
   2398 C57E C8                                   iny                   ;fill-to starting location
   2399 C57F 4C D4 00                             jmp mcftwork          ;fill memory
                                        ;
   2401 C582 4C 49 C1                   .0000010 jmp monce             ;goto command executive
                                        ;
   2403 C585 4C 88 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monhnt: SEARCH (hunt) MEMORY
                                        ;
                                        ;	———————————————————————————————————
                                        ;	syntax: H <addr1> <addr2> <pattern>
                                        ;	———————————————————————————————————
                                        ;
   2413 C588 B0 40                      monhnt   bcs .0000050          ;no start address
                                        ;
   2415 C58A 20 CD CA                             jsr facasize          ;size starting address
   2416 C58D C9 04                                cmp #s_dword
   2417 C58F B0 3C                                bcs .0000060          ;address out of range — error
                                        ;
   2419 C591 20 AF CA                             jsr facaddra          ;store starting address
   2420 C594 20 E1 CA                             jsr getparm           ;evaluate ending address
   2421 C597 B0 34                                bcs .0000060          ;no address — error
                                        ;
   2423 C599 20 CD CA                             jsr facasize          ;size ending address
   2424 C59C C9 04                                cmp #s_dword
   2425 C59E B0 2D                                bcs .0000060          ;address out of range — error
                                        ;
   2427 C5A0 20 B9 CA                             jsr facaddrb          ;store ending address
   2428 C5A3 20 07 CA                             jsr calccnt           ;calculate byte range
   2429 C5A6 90 25                                bcc .0000060          ;end < start
                                        ;
   2431 C5A8 20 E2 CB                             jsr getpat            ;evaluate search pattern
   2432 C5AB B0 20                                bcs .0000060          ;error
                                        ;
   2434 C5AD 64 CE                                stz xrtemp            ;clear column counter
                                        ;
   2436 C5AF 20 AD CC                   .0000010 jsr teststop          ;check for stop
   2437 C5B2 B0 16                                bcs .0000050          ;abort
                                        ;
   2439 C5B4 A4 C0                                ldy auxbufix          ;pattern index
                                        ;
   2441 C5B6 88                         .0000020 dey
   2442 C5B7 30 09                                bmi .0000030          ;pattern match
                                        ;
   2444 C5B9 B7 A2                    +            .byte $b7,addra

                                        ;get from memory
   2445 C5BB D9 51 02                             cmp auxbuf,y          ;test against pattern
   2446 C5BE D0 05                                bne .0000040          ;mismatch, next location
                                        ;
   2448 C5C0 F0 F4                                beq .0000020          ;match, keep testing
                                        ;
   2450 C5C2 20 57 C6                   .0000030 jsr dpycaddr          ;display current location
                                        ;
   2452 C5C5 20 09 CB                   .0000040 jsr nxtaddra          ;next location
   2453 C5C8 90 E5                                bcc .0000010          ;not done
                                        ;
   2455 C5CA 4C 49 C1                   .0000050 jmp monce             ;back to executive
                                        ;
   2457 C5CD 4C 88 C1                   .0000060 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monenv: CONVERT NUMERIC VALUE
                                        ;
                                        ;	——————————————————————
                                        ;	syntax: <radix><value>
                                        ;	——————————————————————
                                        ;
   2467 C5D0 20 DF CA                   monenv   jsr getparmr          ;reread & evaluate parameter
   2468 C5D3 B0 26                                bcs .0000020          ;none entered
                                        ;
   2470 C5D5 A2 00                                ldx #0                ;radix index
   2471 C5D7 A0 04                                ldy #n_radix          ;number of radices
                                        ;
   2473 C5D9 5A                         .0000010 phy                   ;save counter
   2474 C5DA DA                                   phx                   ;save radix index
   2475 C5DB 20 08 C8                             jsr newline           ;next line &...
   2476 C5DE 20 7B C7                             jsr clearlin          ;clear it
   2477 C5E1 A9 20                                lda #a_blank
   2478 C5E3 A2 04                                ldx #halftab
   2479 C5E5 20 FB C7                             jsr multspc           ;indent 1/2 tab
   2480 C5E8 FA                                   plx                   ;get radix index but...
   2481 C5E9 DA                                   phx                   ;put it back
   2482 C5EA BD F3 CC                             lda radxtab,x         ;get radix
   2483 C5ED 20 F4 C8                             jsr binasc            ;convert to ASCII
   2484 C5F0 5A                                   phy                   ;string address MSB
   2485 C5F1 DA                                   phx                   ;string address LSB
   2486 C5F2 20 1D C8                             jsr sprint            ;print
   2487 C5F5 FA                                   plx                   ;get index again
   2488 C5F6 7A                                   ply                   ;get counter
   2489 C5F7 E8                                   inx
   2490 C5F8 88                                   dey
   2491 C5F9 D0 DE                                bne .0000010          ;no
                                        
   2493 C5FB 4C 49 C1                   .0000020 jmp monce             ;back to command exec
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchr: CHANGE REGISTERS
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	syntax: ; [PB [PC [.S [.C [.X [.Y [SP [DP [DB]]]]]]]]]
                                        ;
                                        ;	; with no parameters is the same as the R command.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   2505 C5FE B0 33                      monchr   bcs .0000040          ;dump registers & quit
                                        ;
   2507 C600 A0 00                                ldy #0                ;register counter
   2508 C602 84 B7                                sty facc              ;initialize register index
                                        ;
   2510 C604 20 CD CA                   .0000010 jsr facasize          ;get parameter size
   2511 C607 D9 F7 CC                             cmp rcvltab,y         ;check against size table
   2512 C60A B0 2A                                bcs .0000050          ;out of range
                                        ;
   2514 C60C B9 F7 CC                             lda rcvltab,y         ;determine number of bytes...
   2515 C60F C9 03                                cmp #s_word+1         ;to store
   2516 C611 66 B8                                ror facc+s_byte       ;condition flag
   2517 C613 10 02                                bpl .0000020          ;8 bit register size
                                        ;
   2519 C615 C2 20                    +            .byte $c2,$20

                                                         ;16 bit register size
                                        ;
   2521 C617 A6 B7                      .0000020 ldx facc              ;get register index
   2522 C619 A5 A9                                lda faca              ;get parm
   2523 C61B 95 8A                                sta reg_pbx,x         ;put in shadow storage
   2524 C61D E2 20                    +            .byte $e2,$20

                                        
   2525 C61F 06 B8                                asl facc+s_byte       ;mode flag to carry
   2526 C621 8A                                   txa                   ;register index
   2527 C622 69 01                                adc #s_byte           ;at least 1 byte stored
   2528 C624 85 B7                                sta facc              ;save new index
   2529 C626 20 E1 CA                             jsr getparm           ;get a parameter
   2530 C629 B0 08                                bcs .0000040          ;EOI
                                        ;
   2532 C62B C8                                   iny                   ;bump register count
   2533 C62C C0 09                                cpy #n_regchv         ;all registers processed?
   2534 C62E D0 D4                                bne .0000010          ;no, keep going
                                        ;
   2536 C630 20 14 C8                   .0000030 jsr alert             ;excessive input
                                        ;
   2538 C633 4C A4 C0                   .0000040 jmp monreg            ;display changes
                                        ;
   2540 C636 4C 88 C1                   .0000050 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monxit: EXIT TO OPERATING ENVIRONMENT
                                        ;
                                        ;	—————————
                                        ;	syntax: X
                                        ;	—————————
                                        ;
   2550 C639 90 19                      monxit   bcc .0000020          ;no parameters allowed
                                        ;
   2552 C63B C2 20                    +            .byte $c2,$20

                                        
   2553 C63D AD 02 01                             lda vecbrki           ;BRK indirect vector
   2554 C640 C9 59                    +            cmp #<monbrk
   2554 C642 C0                       +            .byte >monbrk

                                        ;we intercept it?
   2555 C643 D0 09                                bne .0000010          ;no, don't change it
                                        ;
   2557 C645 AD 05 01                             lda vecbrkia          ;old vector
   2558 C648 8D 02 01                             sta vecbrki           ;restore it
   2559 C64B 9C 05 01                             stz vecbrkia          ;invalidate old vector
                                        ;         
   2561 C64E E2 30                      .0000010 +         .byte $e2,$30

                                        
   2562 C650 5C 03 F4 00                          jml vecexit           ;long jump to exit
                                        ;
   2564 C654 4C 88 C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * *                                         * *
                                        ; * * S T A R T   o f   S U B R O U T I N E S * *
                                        ; * *                                         * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;dpycaddr: DISPLAY CURRENT ADDRESS IN COLUMNS
                                        ;
   2576 C657 A6 CE                      dpycaddr ldx xrtemp            ;column count
   2577 C659 D0 05                                bne .0000010          ;not at right side
                                        ;
   2579 C65B 20 08 C8                             jsr newline           ;next row
   2580 C65E A2 08                                ldx #n_hccols         ;max columns
                                        ;
   2582 C660 E0 08                      .0000010 cpx #n_hccols         ;max columns
   2583 C662 F0 05                                beq .0000020          ;at left margin
                                        ;
   2585 C664 A9 09                                lda #a_ht
   2586 C666 20 06 F4                             jsr putcha            ;tab a column
                                        ;
   2588 C669 CA                         .0000020 dex                   ;one less column
   2589 C66A 86 CE                                stx xrtemp            ;save column counter
   2590 C66C 4C D4 C7                             jmp prntladr          ;print reference address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpycod: DISASSEMBLE & DISPLAY CODE
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This function disassembles & displays the machine code at  the  location
                                        ;	pointed to by ADDRA.  Upon return, ADDRA will point to the opcode of the
                                        ;	next instruction.   The entry point at DPYCODAA  should be called with a
                                        ;	disassembly prefix character loaded in .A.   If entered  at  DPYCOD, the
                                        ;	default character will be display at the beginning of each  disassembled
                                        ;	instruction.
                                        ;
                                        ;	The disassembly of immediate mode instructions that can take an 8 or  16
                                        ;	bit operand is affected by the bit pattern that is  stored  in  FLIMFLAG
                                        ;	upon entry to this function:
                                        ;
                                        ;	    FLIMFLAG: xx000000
                                        ;	              ||
                                        ;	              |+—————————> 0:  8 bit .X or .Y operand
                                        ;	              |            1: 16 bit .X or .Y operand
                                        ;	              +——————————> 0:  8 bit .A or BIT # operand
                                        ;	                           1: 16 bit .A or BIT # operand
                                        ;
                                        ;	FLIMFLAG is conditioned according to the operand of  the  most  recently
                                        ;	disassembled REP or SEP instruction.   Hence repetitive  calls  to  this
                                        ;	subroutine will usually result in the correct disassembly of 16 bit imm-
                                        ;	ediate mode instructions.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   2621 C66F A9 2E                       public dpycod   lda #disprfx          ;default prefix
                                        ;
                                        ;
                                        ;	alternate prefix display entry point...
                                        ;
   2626 C671 20 06 F4                   dpycodaa jsr putcha            ;print prefix
   2627 C674 20 18 C8                             jsr printspc          ;space
   2628 C677 20 D4 C7                             jsr prntladr          ;print long address
   2629 C67A 20 18 C8                             jsr printspc          ;space to opcode field
   2630 C67D 20 DB CA                             jsr getbyte           ;get opcode
   2631 C680 85 CC                                sta opcode            ;save &...
   2632 C682 20 0D C8                             jsr printbyt          ;display as hex
                                        ;
                                        ;
                                        ;	decode menmonic & addressing info...
                                        ;
   2637 C685 A6 CC                                ldx opcode            ;current mnemonic
   2638 C687 BD B8 CD                             lda mnetabix,x        ;get mnemonic index
   2639 C68A 0A                                   asl                   ;double for...
   2640 C68B A8                                   tay                   ;mnemonic table offset
   2641 C68C C2 20                    +            .byte $c2,$20

                                                         ;16 bit load
   2642 C68E B9 00 CD                             lda mnetab,y          ;copy encoded mnemonic to...
   2643 C691 85 CA                                sta mnepck            ;working storage
   2644 C693 E2 20                    +            .byte $e2,$20

                                                        ;back to 8 bits
   2645 C695 20 3D CB                             jsr instdata          ;extract mode & size data
   2646 C698 85 D3                                sta vopsflag          ;save mode flags
   2647 C69A 84 C5                                sty admodidx          ;save mode index
   2648 C69C 0A                                   asl                   ;variable immediate instruction?
   2649 C69D 90 1F                                bcc dpycod01          ;no, effective operand size in .X
                                        ;
                                        ;
                                        ;	determine immediate mode operand size...
                                        ;
   2654 C69F A5 CC                                lda opcode            ;current opcode
   2655 C6A1 24 D0                                bit flimflag          ;operand display mode
   2656 C6A3 10 08                                bpl .0000010          ;8 bit .A & BIT immediate mode
                                        ;
   2658 C6A5 29 1F                                and #aimmaska         ;determine if...
   2659 C6A7 C9 09                                cmp #aimmaskb         ;.A or BIT immediate
   2660 C6A9 F0 10                                beq .0000030          ;display 16 bit operand
                                        ;
   2662 C6AB A5 CC                                lda opcode            ;not .A or BIT immediate
                                        ;
   2664 C6AD 50 0F                      .0000010 bvc dpycod01          ;8 bit .X/.Y immediate mode
                                        ;
   2666 C6AF A0 03                                ldy #n_vopidx-1       ;opcodes to test
                                        ;
   2668 C6B1 D9 B8 CF                   .0000020 cmp vopidx,y          ;looking for LDX #, CPY #, etc.
   2669 C6B4 F0 07                                beq .0000040          ;disassemble a 16 bit operand
                                        ;
   2671 C6B6 88                                   dey
   2672 C6B7 10 F8                                bpl .0000020          ;keep trying
                                        ;
   2674 C6B9 80 03                                bra dpycod01          ;not .X or .Y immediate
                                        ;
   2676 C6BB A5 CC                      .0000030 lda opcode            ;reload
                                        ;
   2678 C6BD E8                         .0000040 inx                   ;16 bit operand
                                        ;
                                        ;
                                        ;	get & display operand bytes...
                                        ;
   2683 C6BE 86 D1                      dpycod01 stx iopsize           ;operand size...
   2684 C6C0 E8                                   inx                   ;plus opcode becomes...
   2685 C6C1 86 C8                                stx instsize          ;instruction size
   2686 C6C3 86 C6                                stx charcnt           ;total bytes to process
   2687 C6C5 A9 0B                                lda #n_opcols+2       ;total operand columns plus WS
   2688 C6C7 85 CE                                sta xrtemp            ;initialize counter
   2689 C6C9 20 1C CA                             jsr clroper           ;clear operand
   2690 C6CC A4 D1                                ldy iopsize           ;operand size
   2691 C6CE F0 16                                beq .0000020          ;no operand
                                        ;
   2693 C6D0 A2 00                                ldx #0                ;operand index
                                        ;
   2695 C6D2 20 DB CA                   .0000010 jsr getbyte           ;get operand byte
   2696 C6D5 95 BD                                sta operand,x         ;save
   2697 C6D7 DA                                   phx                   ;protect operand index
   2698 C6D8 20 0D C8                             jsr printbyt          ;print operand byte
   2699 C6DB C6 CE                                dec xrtemp            ;3 columns used, 2 for...
   2700 C6DD C6 CE                                dec xrtemp            ;operand nybbles &...
   2701 C6DF C6 CE                                dec xrtemp            ;1 for whitespace
   2702 C6E1 FA                                   plx                   ;get operand index
   2703 C6E2 E8                                   inx                   ;bump it
   2704 C6E3 88                                   dey
   2705 C6E4 D0 EC                                bne .0000010          ;next
                                        ;
   2707 C6E6 A6 CE                      .0000020 ldx xrtemp            ;operand columns remaining
   2708 C6E8 20 FB C7                             jsr multspc           ;space to mnemonic field
                                        ;
                                        ;
                                        ;	display mnemonic...
                                        ;
   2713 C6EB A0 03                                ldy #s_mnemon         ;size of ASCII mnemonic
                                        ;
   2715 C6ED A9 00                      .0000030 lda #0                ;initialize char
   2716 C6EF A2 05                                ldx #n_shfenc         ;shifts to execute
                                        ;
   2718 C6F1 06 CA                      .0000040 asl mnepck            ;shift encoded mnemonic
   2719 C6F3 26 CB                                rol mnepck+s_byte
   2720 C6F5 2A                                   rol
   2721 C6F6 CA                                   dex
   2722 C6F7 D0 F8                                bne .0000040
                                        ;
   2724 C6F9 69 3F                                adc #a_mnecvt         ;convert to ASCII &...
   2725 C6FB 48                                   pha                   ;stash
   2726 C6FC 88                                   dey
   2727 C6FD D0 EE                                bne .0000030          ;continue with mnemonic
                                        ;
   2729 C6FF A0 03                                ldy #s_mnemon
                                        ;
   2731 C701 68                         .0000050 pla                   ;get mnenmonic byte
   2732 C702 20 06 F4                             jsr putcha            ;print it
   2733 C705 88                                   dey
   2734 C706 D0 F9                                bne .0000050
                                        ;
                                        ;
                                        ;	display operand...
                                        ;
   2739 C708 A5 D1                                lda iopsize           ;operand size
   2740 C70A F0 6F                                beq clearlin          ;zero, disassembly finished
                                        ;
   2742 C70C 20 18 C8                             jsr printspc          ;space to operand field
   2743 C70F 24 D3                                bit vopsflag          ;check mode flags
   2744 C711 50 08                                bvc dpycod02          ;not a branch
                                        ;
   2746 C713 20 53 CB                             jsr offtarg           ;compute branch target
   2747 C716 A6 C8                                ldx instsize          ;effective instruction size
   2748 C718 CA                                   dex
   2749 C719 86 D1                                stx iopsize           ;effective operand size
                                        ;
   2751 C71B 64 D3                      dpycod02 stz vopsflag          ;clear
   2752 C71D A5 C5                                lda admodidx          ;instruction addressing mode
   2753 C71F C9 0B                                cmp #am_move          ;block move instruction?
   2754 C721 D0 02                                bne .0000010          ;no
                                        ;
   2756 C723 66 D3                                ror vopsflag          ;yes
                                        ;
   2758 C725 0A                         .0000010 asl                   ;convert addressing mode to...
   2759 C726 AA                                   tax                   ;symbology table index
   2760 C727 C2 20                    +            .byte $c2,$20

                                                         ;do a 16 bit load
   2761 C729 BD BC CF                             lda ms_lutab,x        ;addressing symbol pointer
   2762 C72C 48                                   pha
   2763 C72D E2 20                    +            .byte $e2,$20

                                                        ;back to 8 bit loads
   2764 C72F A0 00                                ldy #0
   2765 C731 B3 01                    +            .byte $b3,1

                                        ;get 1st char
   2766 C733 C9 20                                cmp #a_blank
   2767 C735 F0 03                                beq .0000020          ;no addresing mode preamble
                                        ;
   2769 C737 20 06 F4                             jsr putcha            ;print preamble
                                        ;
   2771 C73A A9 24                      .0000020 lda #c_hex
   2772 C73C 20 06 F4                             jsr putcha            ;operand displayed as hex
   2773 C73F A4 D1                                ldy iopsize           ;operand size = index
                                        ;
   2775 C741 88                         .0000030 dey
   2776 C742 30 16                                bmi .0000040          ;done with operand
                                        ;
   2778 C744 B9 BD 00                             lda operand,y         ;get operand byte
   2779 C747 20 F1 C7                             jsr dpyhex            ;print operand byte
   2780 C74A 24 D3                                bit vopsflag          ;block move?
   2781 C74C 10 F3                                bpl .0000030          ;no
                                        ;
   2783 C74E 64 D3                                stz vopsflag          ;reset
   2784 C750 5A                                   phy                   ;protect operand index
   2785 C751 F4                       +            .byte $f4
   2785 C752 F5 CF                    +            .word ms_move

                                        
   2786 C754 20 1D C8                             jsr sprint            ;display MVN/MVP operand separator
   2787 C757 7A                                   ply                   ;recover operand index again
   2788 C758 80 E7                                bra .0000030          ;continue
                                        ;
   2790 C75A FA                         .0000040 plx                   ;symbology LSB
   2791 C75B 7A                                   ply                   ;symbology MSB
   2792 C75C E8                                   inx                   ;move past preamble
   2793 C75D D0 01                                bne .0000050
                                        ;
   2795 C75F C8                                   iny
                                        ;
   2797 C760 5A                         .0000050 phy
   2798 C761 DA                                   phx
   2799 C762 20 1D C8                             jsr sprint            ;print postamble, if any
                                        ;
                                        ;
                                        ;	condition immediate mode display format...
                                        ;
   2804 C765 A5 BD                      dpycod03 lda operand           ;operand LSB
   2805 C767 29 30                                and #pfmxmask         ;isolate M & X bits
   2806 C769 0A                                   asl                   ;shift to match...
   2807 C76A 0A                                   asl                   ;FLIMFLAG alignment
   2808 C76B A6 CC                                ldx opcode            ;current instruction
   2809 C76D E0 C2                                cpx #opc_rep          ;was it REP?
   2810 C76F D0 04                                bne .0000010          ;no
                                        ;
   2812 C771 04 D0                                tsb flimflag          ;set flag bits as required
   2813 C773 80 06                                bra clearlin
                                        ;
   2815 C775 E0 E2                      .0000010 cpx #opc_sep          ;was it SEP?
   2816 C777 D0 02                                bne clearlin          ;no, just exit
                                        ;
   2818 C779 14 D0                                trb flimflag          ;clear flag bits as required
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clearlin: CLEAR DISPLAY LINE
                                        ;
   2824 C77B F4                         clearlin +         .byte $f4
   2824 C77C 0D D0                    +            .word dc_cl

                                        
   2825 C77E 80 4B                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyibuf: DISPLAY MONITOR INPUT BUFFER CONTENTS
                                        ;
   2831 C780 F4                         dpyibuf +         .byte $f4
   2831 C781 00 02                    +            .word ibuffer

                                        
   2832 C783 80 46                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpymem: DISPLAY MEMORY
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	This function displays 16 bytes of memory as hex values & as
                                        ;	ASCII equivalents.  The starting address for the display is
                                        ;	in ADDRA & is expected to be a 24 bit address.  Upon return,
                                        ;	ADDRA will point to the start of the next 16 bytes.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2845 C785 E2 30                      dpymem +         .byte $e2,$30

                                        
   2846 C787 64 C6                                stz charcnt           ;reset
   2847 C789 A9 3E                                lda #memprfx
   2848 C78B 20 06 F4                             jsr putcha            ;display prefix
   2849 C78E 20 D4 C7                             jsr prntladr          ;print 24 bit address
   2850 C791 A2 00                                ldx #0                ;string buffer index
   2851 C793 A0 08                                ldy #n_dump           ;bytes per line
                                        ;
   2853 C795 20 DB CA                   .0000010 jsr getbyte           ;get from RAM, also...
   2854 C798 48                                   pha                   ;save for decoding
   2855 C799 DA                                   phx                   ;save string index
   2856 C79A 20 0D C8                             jsr printbyt          ;display as hex ASCII
   2857 C79D E6 C6                                inc charcnt           ;bytes displayed +1
   2858 C79F FA                                   plx                   ;recover string index &...
   2859 C7A0 68                                   pla                   ;byte
   2860 C7A1 C9 20                                cmp #a_blank          ;printable?
   2861 C7A3 90 04                                bcc .0000020          ;no
                                        ;
   2863 C7A5 C9 7F                                cmp #a_del
   2864 C7A7 90 02                                bcc .0000030          ;is printable
                                        ;
   2866 C7A9 A9 2E                      .0000020 lda #memsubch         ;substitute character
                                        ;
   2868 C7AB 9D 00 02                   .0000030 sta ibuffer,x         ;save char
   2869 C7AE E8                                   inx                   ;bump index
   2870 C7AF 88                                   dey                   ;byte count -= 1
   2871 C7B0 D0 E3                                bne .0000010          ;not done
                                        ;
   2873 C7B2 9E 00 02                             stz ibuffer,x         ;terminate ASCII string
   2874 C7B5 A9 3A                                lda #memsepch
   2875 C7B7 20 06 F4                             jsr putcha            ;separate ASCII from bytes
   2876 C7BA F4                       +            .byte $f4
   2876 C7BB 03 D0                    +            .word dc_bf

                                        
   2877 C7BD 20 1D C8                             jsr sprint            ;select reverse video
   2878 C7C0 20 80 C7                             jsr dpyibuf           ;display ASCII equivalents
   2879 C7C3 F4                       +            .byte $f4
   2879 C7C4 18 D0                    +            .word dc_er

                                        ;normal video
   2880 C7C6 80 03                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyerr: DISPLAY ERROR SIGNAL
                                        ;
   2886 C7C8 F4                         dpyerr +         .byte $f4
   2886 C7C9 45 D0                    +            .word mm_err

                                        ;"*ERR"
                                        ;
   2888 C7CB 20 1D C8                   dpyerraa jsr sprint
   2889 C7CE 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;gendbs: GENERATE DESTRUCTIVE BACKSPACE
                                        ;
   2895 C7CF F4                         gendbs +         .byte $f4
   2895 C7D0 09 D0                    +            .word dc_bs

                                        ;destructive backspace
   2896 C7D2 80 F7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;prntladr: PRINT 24 BIT CURRENT ADDRESS
                                        ;
   2902 C7D4 08                         prntladr php                   ;protect register sizes
   2903 C7D5 E2 20                    +            .byte $e2,$20

                                        
   2904 C7D7 A5 A4                                lda addra+s_word      ;get bank byte &...
   2905 C7D9 20 F1 C7                             jsr dpyhex            ;display it
   2906 C7DC C2 20                    +            .byte $c2,$20

                                        
   2907 C7DE A5 A2                                lda addra             ;get 16 bit address
   2908 C7E0 28                                   plp                   ;restore register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhexw: DISPLAY BINARY WORD AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .C: word to display
                                        ;
                                        ;	Returned Values: .C: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   2922 C7E1 08                         dpyhexw  php                   ;save register sizes
   2923 C7E2 C2 20                    +            .byte $c2,$20

                                        
   2924 C7E4 48                                   pha                   ;protect value
   2925 C7E5 E2 20                    +            .byte $e2,$20

                                        
   2926 C7E7 EB                       +            .byte $eb

                                                           ;get MSB &...
   2927 C7E8 20 F1 C7                             jsr dpyhex            ;display
   2928 C7EB C2 20                    +            .byte $c2,$20

                                        
   2929 C7ED 68                                   pla                   ;recover value
   2930 C7EE E2 20                    +            .byte $e2,$20

                                                        ;only LSB visible
   2931 C7F0 28                                   plp                   ;reset register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhex: DISPLAY BINARY BYTE AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to display
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   2945 C7F1 20 88 C9                   dpyhex   jsr binhex            ;convert to hex ASCII
   2946 C7F4 20 06 F4                             jsr putcha            ;print MSN
   2947 C7F7 8A                                   txa
   2948 C7F8 4C 06 F4                             jmp putcha            ;print LSN
                                        ;
                                        ;================================================================================
                                        ;
                                        ;multspc: PRINT MULTIPLE BLANKS
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .X: number of blanks to print
                                        ;
                                        ;	Register Returns: none
                                        ;
                                        ;	Calling Example : ldx #3
                                        ;	                  jsr multspc    ;print 3 spaces
                                        ;
                                        ;	Notes: This sub will print 1 blank if .X=0.
                                        ;	————————————————————————————————————————————————
                                        ;
   2965 C7FB 8A                         multspc  txa
   2966 C7FC D0 01                                bne .0000010          ;blank count specified
                                        ;
   2968 C7FE E8                                   inx                   ;default to 1 blank
                                        ;
   2970 C7FF A9 20                      .0000010 lda #a_blank
                                        ;
   2972 C801 20 06 F4                   .0000020 jsr putcha
   2973 C804 CA                                   dex
   2974 C805 D0 FA                                bne .0000020
                                        ;
   2976 C807 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;newline: PRINT NEWLINE (CRLF)
                                        ;
   2982 C808 F4                         newline +         .byte $f4
   2982 C809 1E D0                    +            .word dc_lf

                                        
   2983 C80B 80 BE                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printbyt: PRINT A BYTE WITH LEADING SPACE
                                        ;
   2989 C80D 48                         printbyt pha                   ;protect byte
   2990 C80E 20 18 C8                             jsr printspc          ;print leading space
   2991 C811 68                                   pla                   ;restore &...
   2992 C812 80 DD                                bra dpyhex            ;print byte
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;alert: ALERT USER w/TERMINAL BELL
                                        ;
   2998 C814 A9 07                      alert    lda #a_bel
   2999 C816 80 02                                bra printcmn
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printspc: PRINT A SPACE
                                        ;
   3005 C818 A9 20                      printspc lda #a_blank
                                        ;
   3007 C81A 4C 06 F4                   printcmn jmp putcha
                                        ;
                                        ;================================================================================
                                        ;
                                        ;sprint: PRINT NULL-TERMINATED CHARACTER STRING
                                        ;
                                        ;	—————————————————————————————————————————————————————————
                                        ;	Preparatory Ops : SP+1: string address LSB
                                        ;	                  SP+2: string address MSB
                                        ;
                                        ;	Register Returns: .A: used
                                        ;	                  .B: entry value
                                        ;	                  .X: used
                                        ;	                  .Y: used
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: okay
                                        ;	           |||||||      1: string too long (1)
                                        ;	           ||||+++————> not defined
                                        ;	           |||+———————> 1
                                        ;	           ||+————————> 1
                                        ;	           ++—————————> not defined
                                        ;
                                        ;	Example: PER STRING
                                        ;	         JSR SPRINT
                                        ;	         BCS TOOLONG
                                        ;
                                        ;	Notes: 1) Maximum permissible string length including the
                                        ;	          terminator is 32,767 bytes.
                                        ;	       2) All registers are forced to 8 bits.
                                        ;	       3) DO NOT JUMP OR BRANCH INTO THIS FUNCTION!
                                        ;	—————————————————————————————————————————————————————————
                                        ;
   3041 C81D E2 20                      sprint +         .byte $e2,$20

                                                        ;8 bit accumulator
   3042 C81F C2 10                    +            .byte $c2,$10

                                                         ;16 bit index
                                        ;
                                        ;—————————————————————————————————————————————————————————
   3194 = 0000000000000001                            .reetaddr =1                    ;return address
                                        
   3196 = 00000003                      .src     =.reetaddr+s_word      ;string address stack offset
                                        
                                        ;—————————————————————————————————————————————————————————
                                        ;
   3051 C821 A0 00                    +            ldy #<0
   3051 C823 00                       +            .byte >0

                                        
   3052 C824 18                                   clc                   ;no initial error
                                        ;
   3054 C825 B3 03                      .0000010 +         .byte $b3,.src

                                        ;get a byte
   3055 C827 F0 07                                beq .0000020          ;done
                                        ;
   3057 C829 20 06 F4                             jsr putcha            ;write to console port
   3058 C82C C8                                   iny
   3059 C82D 10 F6                                bpl .0000010          ;next
                                        ;
   3061 C82F 38                                   sec                   ;string too long
                                        ;
   3063 C830 FA                         .0000020 plx                   ;pull RTS address
   3064 C831 7A                                   ply                   ;clear string pointer
   3065 C832 DA                                   phx                   ;replace RTS
   3066 C833 E2 10                    +            .byte $e2,$10

                                        
   3067 C835 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ascbin: CONVERT NULL-TERMINATED ASCII NUMBER STRING TO BINARY
                                        ;
                                        ;	———————————————————————————————————————————————————
                                        ;	Preparatory Ops: ASCII number string in IBUFFER
                                        ;
                                        ;	Returned Values: FACA: converted parameter
                                        ;	                   .A: used
                                        ;	                   .X: used
                                        ;	                   .Y: used
                                        ;	                   .C: 1 = conversion error
                                        ;	                   .Z: 1 = nothing to convert
                                        ;
                                        ;	Notes: 1) Conversion stops when a non-numeric char-
                                        ;	          acter is encountered.
                                        ;	       2) Radix symbols are as follows:
                                        ;
                                        ;	          % binary
                                        ;	          @ octal
                                        ;	          + decimal
                                        ;	          $ hexadecimal
                                        ;
                                        ;	          Hex is the default if no radix is speci-
                                        ;	          fied in the 1st character of the string.
                                        ;	———————————————————————————————————————————————————
                                        ;
   3096 C836 E2 30                      ascbin +         .byte $e2,$30

                                        
   3097 C838 20 9B C9                             jsr clrfaca           ;clear accumulator
   3098 C83B 64 C6                                stz charcnt           ;zero char count
   3099 C83D 64 C4                                stz radix             ;initialize
                                        ;
                                        ;
                                        ;	process radix if present...
                                        ;
   3104 C83F 20 2E CC                             jsr getcharw          ;get next non-WS char
   3105 C842 D0 02                                bne .0000010          ;got something
                                        ;
   3107 C844 18                                   clc                   ;no more input
   3108 C845 60                                   rts
                                        ;
   3110 C846 A2 03                      .0000010 ldx #n_radix-1        ;number of radices
                                        ;
   3112 C848 DD F3 CC                   .0000020 cmp radxtab,x         ;recognized radix?
   3113 C84B F0 06                                beq .0000030          ;yes
                                        ;
   3115 C84D CA                                   dex
   3116 C84E 10 F8                                bpl .0000020          ;try next
                                        ;
   3118 C850 C6 C1                                dec ibufidx           ;reposition to previous char
   3119 C852 E8                                   inx                   ;not recognized, assume hex
                                        ;
   3121 C853 C9 2B                      .0000030 cmp #c_dec            ;decimal radix?
   3122 C855 D0 02                                bne .0000040          ;not decimal
                                        ;
   3124 C857 66 C4                                ror radix             ;flag decimal conversion
                                        ;
   3126 C859 BD DF CC                   .0000040 lda basetab,x         ;number bases table
   3127 C85C 85 D2                                sta range             ;set valid numeral range
   3128 C85E BD E3 CC                             lda bitsdtab,x        ;get bits per digit
   3129 C861 85 C2                                sta bitsdig           ;store
                                        ;
                                        ;
                                        ;	process numerals...
                                        ;
   3134 C863 20 D0 CB                   ascbin01 jsr getchar           ;get next char
   3135 C866 F0 70                                beq ascbin03          ;EOI
                                        ;
   3137 C868 C9 20                                cmp #' '
   3138 C86A F0 6C                                beq ascbin03          ;blank — EOF
                                        ;
   3140 C86C C9 2C                                cmp #','
   3141 C86E F0 68                                beq ascbin03          ;comma — EOF
                                        ;
   3143 C870 C9 09                                cmp #a_ht
   3144 C872 F0 64                                beq ascbin03          ;tab — EOF
                                        ;
   3146 C874 20 F5 C9                             jsr nybtobin          ;change to binary
   3147 C877 B0 60                                bcs ascbin04          ;not a recognized numeral
                                        ;
   3149 C879 C5 D2                                cmp range             ;check range
   3150 C87B B0 5C                                bcs ascbin04          ;not valid for base
                                        ;
   3152 C87D 85 C3                                sta numeral           ;save processed numeral
   3153 C87F E6 C6                                inc charcnt           ;bump numeral count
   3154 C881 24 C4                                bit radix             ;working in base 10?
   3155 C883 10 15                                bpl .0000030          ;no
                                        ;
                                        ;
                                        ;	compute N*2 for decimal conversion...
                                        ;
   3160 C885 A2 00                                ldx #0                ;accumulator index
   3161 C887 A0 02                                ldy #s_pfac/2         ;iterations
   3162 C889 C2 20                    +            .byte $c2,$20

                                        
   3163 C88B 18                                   clc
                                        ;
   3165 C88C B5 A9                      .0000020 lda faca,x            ;N
   3166 C88E 2A                                   rol                   ;N=N*2
   3167 C88F 95 B1                                sta facb,x
   3168 C891 E8                                   inx
   3169 C892 E8                                   inx
   3170 C893 88                                   dey
   3171 C894 D0 F6                                bne .0000020
                                        ;
   3173 C896 B0 41                                bcs ascbin04          ;overflow — error
                                        ;
   3175 C898 E2 20                    +            .byte $e2,$20

                                        
                                        ;
                                        ;
                                        ;	compute N*base for binary, octal or hex...
                                        ;	or N*8 for decimal...
                                        ;
   3181 C89A A6 C2                      .0000030 ldx bitsdig           ;bits per digit
   3182 C89C C2 20                    +            .byte $c2,$20

                                                         ;16 bit shifts
                                        ;
   3184 C89E 06 A9                      .0000040 asl faca
   3185 C8A0 26 AB                                rol faca+s_word
   3186 C8A2 B0 35                                bcs ascbin04          ;overflow — error
                                        ;
   3188 C8A4 CA                                   dex
   3189 C8A5 D0 F7                                bne .0000040          ;next shift
                                        ;
   3191 C8A7 E2 20                    +            .byte $e2,$20

                                                        ;back to 8 bits
   3192 C8A9 24 C4                                bit radix             ;check base
   3193 C8AB 10 13                                bpl ascbin02          ;not decimal
                                        ;
                                        ;
                                        ;	compute N*10 for decimal (N*8 + N*2)...
                                        ;
   3198 C8AD A0 04                                ldy #s_pfac
   3199 C8AF C2 20                    +            .byte $c2,$20

                                        
                                        ;
   3201 C8B1 B5 A9                      .0000050 lda faca,x            ;N*8
   3202 C8B3 75 B1                                adc facb,x            ;N*2
   3203 C8B5 95 A9                                sta faca,x            ;now N*10
   3204 C8B7 E8                                   inx
   3205 C8B8 E8                                   inx
   3206 C8B9 88                                   dey
   3207 C8BA D0 F5                                bne .0000050
                                        ;
   3209 C8BC B0 1B                                bcs ascbin04          ;overflow — error
                                        ;
   3211 C8BE E2 20                    +            .byte $e2,$20

                                        
                                        ;
                                        ;
                                        ;	add current numeral to partial result...
                                        ;
   3216 C8C0 A5 A9                      ascbin02 lda faca              ;N
   3217 C8C2 65 C3                                adc numeral           ;N=N+D
   3218 C8C4 85 A9                                sta faca
   3219 C8C6 A2 01                                ldx #1
   3220 C8C8 A0 03                                ldy #s_pfac-1
                                        ;
   3222 C8CA B5 A9                      .0000010 lda faca,x
   3223 C8CC 69 00                                adc #0                ;account for carry
   3224 C8CE 95 A9                                sta faca,x
   3225 C8D0 E8                                   inx
   3226 C8D1 88                                   dey
   3227 C8D2 D0 F6                                bne .0000010
                                        ;
   3229 C8D4 90 8D                                bcc ascbin01          ;next if no overflow
                                        ;
   3231 C8D6 B0 01                                bcs ascbin04          ;overflow — error
                                        ;
                                        ;
                                        ;	finish up...
                                        ;
   3236 C8D8 18                         ascbin03 clc                   ;no error
                                        ;
   3238 C8D9 E2 20                      ascbin04 +         .byte $e2,$20

                                                        ;reset if necessary
   3239 C8DB A5 C6                                lda charcnt           ;load char count
   3240 C8DD 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bcdasc: CONVERT BCD DIGIT TO ASCII
                                        ;
                                        ;	———————————————————————————————————————
                                        ;	Preparatory Ops: .A: BCD digit, $00-$99
                                        ;
                                        ;	Returned Values: .A: ASCII MSD
                                        ;	                 .X: ASCII LSD
                                        ;	                 .Y: entry value
                                        ;	———————————————————————————————————————
                                        ;
   3254 C8DE 20 EA C8                   bcdasc   jsr bintonyb          ;extract nybbles
   3255 C8E1 48                                   pha                   ;save tens
   3256 C8E2 8A                                   txa                 
   3257 C8E3 09 30                                ora #btoamask         ;change units to ASCII
   3258 C8E5 AA                                   tax                   ;store
   3259 C8E6 68                                   pla                   ;get tens
   3260 C8E7 09 30                                ora #btoamask         ;change to ASCII
   3261 C8E9 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bintonyb: EXTRACT BINARY NYBBLES
                                        ;
                                        ;	—————————————————————————————————
                                        ;	Preparatory Ops: .A: binary value
                                        ;
                                        ;	Returned Values: .A: MSN
                                        ;	                 .X: LSN
                                        ;	                 .Y: entry value
                                        ;	—————————————————————————————————
                                        ;
   3275 C8EA 48                         bintonyb pha                   ;save
   3276 C8EB 29 0F                                and #bcdumask         ;extract LSN
   3277 C8ED AA                                   tax                   ;save it
   3278 C8EE 68                                   pla
                                        ;         .rept s_bnybbl        ;extract MSN
   3280 C8EF 4A                                     lsr
   3281 C8F0 4A                                     lsr
   3282 C8F1 4A                                     lsr
   3283 C8F2 4A                                     lsr
                                        ;         .endr
   3285 C8F3 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binasc: CONVERT 32-BIT BINARY TO NULL-TERMINATED ASCII NUMBER STRING
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	Preparatory Ops: FACA: 32-bit operand
                                        ;	                   .A: radix character, w/bit 7 set to
                                        ;	                       suppress radix symbol in the
                                        ;	                       conversion string
                                        ;
                                        ;	Returned Values: ibuffer: conversion string
                                        ;	                      .A: string length
                                        ;	                      .X: string address LSB
                                        ;	                      .Y: string address MSB
                                        ;
                                        ;	Execution Notes: ibufidx & instsize are overwritten.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   3305 C8F4 64 C1                      binasc   stz ibufidx           ;initialize string index
   3306 C8F6 64 C8                                stz instsize          ;clear format flag
                                        ;
                                        ;
                                        ;	evaluate radix...
                                        ;
   3311 C8F8 0A                                   asl                   ;extract format flag &...
   3312 C8F9 66 C8                                ror instsize          ;save it
   3313 C8FB 4A                                   lsr                   ;extract radix character
   3314 C8FC A2 03                                ldx #n_radix-1        ;total radices
                                        ;
   3316 C8FE DD F3 CC                   .0000010 cmp radxtab,x         ;recognized radix?
   3317 C901 F0 04                                beq .0000020          ;yes
                                        ;
   3319 C903 CA                                   dex
   3320 C904 10 F8                                bpl .0000010          ;try next
                                        ;
   3322 C906 E8                                   inx                   ;assume hex
                                        ;
   3324 C907 86 C4                      .0000020 stx radix             ;save radix index for later
   3325 C909 24 C8                                bit instsize
   3326 C90B 30 08                                bmi .0000030          ;no radix symbol wanted
                                        ;
   3328 C90D BD F3 CC                             lda radxtab,x         ;radix table
   3329 C910 8D 00 02                             sta ibuffer           ;prepend to string
   3330 C913 E6 C1                                inc ibufidx           ;bump string index
                                        ;
   3332 C915 C9 2B                      .0000030 cmp #c_dec            ;converting to decimal?
   3333 C917 D0 07                                bne .0000040          ;no
                                        ;
   3335 C919 20 AD C9                             jsr facabcd           ;convert operand to BCD
   3336 C91C A9 00                                lda #0
   3337 C91E 80 17                                bra .0000070          ;skip binary stuff
                                        ;
                                        ;
                                        ;	prepare for binary, octal or hex conversion...
                                        ;
   3342 C920 A2 00                      .0000040 ldx #0                ;operand index
   3343 C922 A0 05                                ldy #s_sfac-1         ;workspace index
                                        ;
   3345 C924 B5 A9                      .0000050 lda faca,x            ;copy operand to...
   3346 C926 99 B1 00                             sta facb,y            ;workspace in...
   3347 C929 88                                   dey                   ;big-endian order
   3348 C92A E8                                   inx
   3349 C92B E0 04                                cpx #s_pfac
   3350 C92D D0 F5                                bne .0000050
                                        ;
   3352 C92F A9 00                                lda #0
   3353 C931 BB                       +            .byte $bb

                                        
                                        ;
   3355 C932 95 B1                      .0000060 sta facb,x            ;pad workspace
   3356 C934 CA                                   dex
   3357 C935 10 FB                                bpl .0000060
                                        ;
                                        ;
                                        ;	set up conversion parameters...
                                        ;
   3362 C937 85 B7                      .0000070 sta facc              ;initialize byte counter
   3363 C939 A4 C4                                ldy radix             ;radix index
   3364 C93B B9 EF CC                             lda numstab,y         ;numerals in string
   3365 C93E 85 B8                                sta facc+s_byte       ;set remaining numeral count
   3366 C940 B9 E7 CC                             lda bitsntab,y        ;bits per numeral
   3367 C943 85 B9                                sta facc+s_word       ;set
   3368 C945 B9 EB CC                             lda lzsttab,y         ;leading zero threshold
   3369 C948 85 BA                                sta facc+s_xword      ;set
                                        ;
                                        ;
                                        ;	generate conversion string...
                                        ;
   3374 C94A A9 00                      .0000080 lda #0
   3375 C94C A4 B9                                ldy facc+s_word       ;bits per numeral
                                        ;
   3377 C94E A2 05                      .0000090 ldx #s_sfac-1         ;workspace size
   3378 C950 18                                   clc                   ;avoid starting carry
                                        ;
   3380 C951 36 B1                      .0000100 rol facb,x            ;shift out a bit...
   3381 C953 CA                                   dex                   ;from the operand or...
   3382 C954 10 FB                                bpl .0000100          ;BCD conversion result
                                        ;
   3384 C956 2A                                   rol                   ;bit to .A
   3385 C957 88                                   dey
   3386 C958 D0 F4                                bne .0000090          ;more bits to grab
                                        ;
   3388 C95A A8                                   tay                   ;if numeral isn't zero...
   3389 C95B D0 0A                                bne .0000110          ;skip leading zero tests
                                        ;
   3391 C95D A6 B8                                ldx facc+s_byte       ;remaining numerals
   3392 C95F E4 BA                                cpx facc+s_xword      ;leading zero threshold
   3393 C961 90 04                                bcc .0000110          ;below it, must convert
                                        ;
   3395 C963 A6 B7                                ldx facc              ;processed byte count
   3396 C965 F0 11                                beq .0000130          ;discard leading zero
                                        ;
   3398 C967 C9 0A                      .0000110 cmp #10               ;check range
   3399 C969 90 02                                bcc .0000120          ;is 0-9
                                        ;
   3401 C96B 69 06                                adc #a_hexdec         ;apply hex adjust
                                        ;
   3403 C96D 69 30                      .0000120 adc #'0'              ;change to ASCII
   3404 C96F A4 C1                                ldy ibufidx           ;string index
   3405 C971 99 00 02                             sta ibuffer,y         ;save numeral in buffer
   3406 C974 E6 C1                                inc ibufidx           ;next buffer position
   3407 C976 E6 B7                                inc facc              ;bytes=bytes+1
                                        ;
   3409 C978 C6 B8                      .0000130 dec facc+s_byte       ;numerals=numerals-1
   3410 C97A D0 CE                                bne .0000080          ;not done
                                        ;
                                        ;
                                        ;	terminate string & exit...
                                        ;
   3415 C97C A6 C1                                ldx ibufidx           ;printable string length
   3416 C97E 9E 00 02                             stz ibuffer,x         ;terminate string
   3417 C981 8A                                   txa
   3418 C982 A2 00                                ldx #<ibuffer         ;converted string
   3419 C984 A0 02                                ldy #>ibuffer
   3420 C986 18                                   clc                   ;all okay
   3421 C987 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binhex: CONVERT BINARY BYTE TO HEX ASCII CHARS
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to convert
                                        ;
                                        ;	Returned Values: .A: MSN ASCII char
                                        ;	                 .X: LSN ASCII char
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————————————
                                        ;
   3435 C988 20 EA C8                   binhex   jsr bintonyb          ;generate binary values
   3436 C98B 48                                   pha                   ;save MSN
   3437 C98C 8A                                   txa
   3438 C98D 20 92 C9                             jsr .0000010          ;generate ASCII LSN
   3439 C990 AA                                   tax                   ;save
   3440 C991 68                                   pla                   ;get input
                                        ;
                                        ;
                                        ;	convert nybble to hex ASCII equivalent...
                                        ;
   3445 C992 C9 0A                      .0000010 cmp #10
   3446 C994 90 02                                bcc .0000020          ;in decimal range
                                        ;
   3448 C996 69 66                                adc #k_hex            ;hex compensate
                                        ;         
   3450 C998 49 30                      .0000020 eor #'0'              ;finalize nybble
   3451 C99A 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfaca: CLEAR FLOATING ACCUMULATOR A
                                        ;
   3457 C99B 08                         clrfaca  php
   3458 C99C C2 20                    +            .byte $c2,$20

                                        
   3459 C99E 64 A9                                stz faca
   3460 C9A0 64 AB                                stz faca+s_word
   3461 C9A2 28                                   plp
   3462 C9A3 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfacb: CLEAR FLOATING ACCUMULATOR B
                                        ;
   3468 C9A4 08                         clrfacb  php
   3469 C9A5 C2 20                    +            .byte $c2,$20

                                        
   3470 C9A7 64 B1                                stz facb
   3471 C9A9 64 B3                                stz facb+s_word
   3472 C9AB 28                                   plp
   3473 C9AC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facabcd: CONVERT FACA INTO BCD
                                        ;
   3479 C9AD A2 03                      facabcd  ldx #s_pfac-1         ;primary accumulator size -1
                                        ;
   3481 C9AF B5 A9                      .0000010 lda faca,x            ;value to be converted
   3482 C9B1 48                                   pha                   ;preserve
   3483 C9B2 CA                                   dex
   3484 C9B3 10 FA                                bpl .0000010          ;next
                                        ;
   3486 C9B5 A2 05                                ldx #s_sfac-1         ;workspace size
                                        ;
   3488 C9B7 74 B1                      .0000020 stz facb,x            ;clear final result
   3489 C9B9 74 B7                                stz facc,x            ;clear scratchpad
   3490 C9BB CA                                   dex
   3491 C9BC 10 F9                                bpl .0000020
                                        ;
   3493 C9BE E6 BC                                inc facc+s_sfac-s_byte
   3494 C9C0 F8                                   sed                   ;select decimal mode
   3495 C9C1 A0 1F                                ldy #m_bits-1         ;bits to convert -1
                                        ;
   3497 C9C3 A2 03                      .0000030 ldx #s_pfac-1         ;operand size
   3498 C9C5 18                                   clc                   ;no carry at start
                                        ;
   3500 C9C6 76 A9                      .0000040 ror faca,x            ;grab LS bit in operand
   3501 C9C8 CA                                   dex
   3502 C9C9 10 FB                                bpl .0000040
                                        ;
   3504 C9CB 90 0D                                bcc .0000060          ;LS bit clear
                                        ;
   3506 C9CD 18                                   clc
   3507 C9CE A2 05                                ldx #s_sfac-1
                                        ;
   3509 C9D0 B5 B1                      .0000050 lda facb,x            ;partial result
   3510 C9D2 75 B7                                adc facc,x            ;scratchpad
   3511 C9D4 95 B1                                sta facb,x            ;new partial result
   3512 C9D6 CA                                   dex
   3513 C9D7 10 F7                                bpl .0000050
                                        ;
   3515 C9D9 18                                   clc
                                        ;
   3517 C9DA A2 05                      .0000060 ldx #s_sfac-1
                                        ;
   3519 C9DC B5 B7                      .0000070 lda facc,x            ;scratchpad
   3520 C9DE 75 B7                                adc facc,x            ;double &...
   3521 C9E0 95 B7                                sta facc,x            ;save
   3522 C9E2 CA                                   dex
   3523 C9E3 10 F7                                bpl .0000070
                                        ;
   3525 C9E5 88                                   dey
   3526 C9E6 10 DB                                bpl .0000030          ;next operand bit
                                        ;
   3528 C9E8 D8                                   cld
   3529 C9E9 A2 00                                ldx #0
   3530 C9EB A0 04                                ldy #s_pfac
                                        ;
   3532 C9ED 68                         .0000080 pla                   ;operand
   3533 C9EE 95 A9                                sta faca,x            ;restore
   3534 C9F0 E8                                   inx
   3535 C9F1 88                                   dey
   3536 C9F2 D0 F9                                bne .0000080          ;next
                                        ;
   3538 C9F4 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nybtobin: CONVERT ASCII NYBBLE TO BINARY
                                        ;
   3544 C9F5 20 A0 CC                   nybtobin jsr toupper           ;convert case if necessary
   3545 C9F8 38                                   sec
   3546 C9F9 E9 30                                sbc #'0'              ;change to binary
   3547 C9FB 90 08                                bcc .0000020          ;not a numeral — error
                                        ;
   3549 C9FD C9 0A                                cmp #10
   3550 C9FF 90 03                                bcc .0000010          ;numeral is 0-9
                                        ;
   3552 CA01 E9 07                                sbc #a_hexdec+1       ;10-15 ——> A-F
   3553 CA03 18                                   clc                   ;no conversion error
                                        ;
   3555 CA04 60                         .0000010 rts
                                        ;
   3557 CA05 38                         .0000020 sec                   ;conversion error
   3558 CA06 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;calccnt: COMPUTE BYTE COUNT FROM ADDRESS RANGE
                                        ;
   3564 CA07 20 A4 C9                   calccnt  jsr clrfacb           ;clear accumulator
   3565 CA0A C2 20                    +            .byte $c2,$20

                                        
   3566 CA0C 38                                   sec
   3567 CA0D A5 A6                                lda addrb             ;ending address
   3568 CA0F E5 A2                                sbc addra             ;starting address
   3569 CA11 85 B1                                sta facb              ;byte count
   3570 CA13 E2 20                    +            .byte $e2,$20

                                        
   3571 CA15 A5 A8                                lda addrb+s_word      ;handle banks
   3572 CA17 E5 A4                                sbc addra+s_word
   3573 CA19 85 B3                                sta facb+s_word
   3574 CA1B 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clroper: CLEAR OPERAND
                                        ;
   3580 CA1C DA                         clroper  phx
   3581 CA1D A2 02                                ldx #s_oper-1
                                        ;
   3583 CA1F 74 BD                      .0000010 stz operand,x
   3584 CA21 CA                                   dex
   3585 CA22 10 FB                                bpl .0000010
                                        ;
   3587 CA24 64 CF                                stz eopsize
   3588 CA26 FA                                   plx
   3589 CA27 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpfwsup: FOWARD COPY MEMORY SETUP
                                        ;
   3595 CA28 C2 30                      cpfwsup +         .byte $c2,$30

                                        
   3596 CA2A A2 54                    +            ldx #<opc_mvn
   3596 CA2C 00                       +            .byte >opc_mvn

                                        ;"move next" opcode
   3597 CA2D 80 05                                bra cpsup
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cprvsup: REVERSE COPY MEMORY SETUP
                                        ;
   3603 CA2F C2 30                      cprvsup +         .byte $c2,$30

                                        
   3604 CA31 A2 44                    +            ldx #<opc_mvp
   3604 CA33 00                       +            .byte >opc_mvp

                                        ;"move previous" opcode
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cpsup: COPY MEMORY SETUP
                                        ;
   3610 CA34 48                         cpsup    pha                   ;save banks
   3611 CA35 8A                                   txa                   ;protect...
   3612 CA36 EB                       +            .byte $eb

                                                           ;opcode
   3613 CA37 E2 20                    +            .byte $e2,$20

                                        
   3614 CA39 A2 08                    +            ldx #<(cpcodeee-cpcode-1)
   3614 CA3B 00                       +            .byte >(cpcodeee-cpcode-1)

                                        
                                        ;
   3616 CA3C BF                         .0000010 +         .byte $bf
   3616 CA3D 5C CA 00                 +   +         .byte <cpcode,>cpcode,cpcode >> 16

                                     +   

                                        ;transfer copy code to...
   3617 CA40 95 D4                                sta mcftwork,x        ;to workspace
   3618 CA42 CA                                   dex
   3619 CA43 10 F7                                bpl .0000010
                                        ;
   3621 CA45 EB                       +            .byte $eb

                                                           ;recover opcode &...
   3622 CA46 85 D5                                sta mcftopc           ;set it
   3623 CA48 C2 20                    +            .byte $c2,$20

                                        
   3624 CA4A 68                                   pla                   ;get banks &...
   3625 CA4B 85 D6                                sta mcftbnk           ;set them
                                         
                                        ; We just dynamically created a routine, so the cache (if one is present) has
                                        ; to be invalidated. Otherwise the processor could execute dead code from the
                                        ; cache. Two lines are invalidated in case the code crosses a line boundary.
                                        ;
                                        ;	acc = 16 bit address to invalidate
                                        ;
                                        ; If there is no cache in the processor then these lines can be deleted.
                                        ;-------------------------------------------------------------------------------
                                           		 CPU	FT832
                                           		 MEM	16
   3637 00CA4D 48                                    pha
   3638 00CA4E A9 D4 00                              lda	#mcftwork
   3639 00CA51 42 E0 01                     		 cache	#1				; 1= invalidate line identified by address in acc
   3640 00CA54 A9 E4 00                              lda	#mcftwork+16
   3641 00CA57 42 E0 01                     		 cache	#1
   3642 00CA5A 68                                    pla
                                        		 CPU	W65C02
   3644 CA5B                            		 MEM	8
                                        ;---------------------------------------------
   3646 CA5B 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpcode: COPY MEMORY CODE
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	This code is transfered to workspace when a
                                        ;	copy or fill operation is to be performed.
                                        ;	———————————————————————————————————————————
                                        ;
   3657 CA5C 8B                         cpcode +         .byte $8b

                                                           ;must preserve data bank
                                        ;         .rept s_mvinst
   3659 CA5D EA                                     nop                 ;placeholder
   3660 CA5E EA                                     nop
   3661 CA5F EA                                     nop
                                        ;         .endr
   3663 CA60 AB                       +            .byte $ab

                                                           ;restore data bank
   3664 CA61 5C 49 C1 00                          jml monce             ;return to command executive
   3848 = 0000CA65                      cpcodeee =*                    ;placeholder — do not delete
                                        ;
                                        ;================================================================================
                                        ;
                                        ;decdcnt: DECREMENT DUMP COUNT
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	Preparatory Ops: bytes to process in FACB
                                        ;	                 bytes processed in CHARCNT
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = count = zero
                                        ;	———————————————————————————————————————————
                                        ;
   3681 CA65 E2 20                      decdcnt +         .byte $e2,$20

                                        
   3682 CA67 A9 00                                lda #0
   3683 CA69 EB                       +            .byte $eb

                                                           ;clear .B
   3684 CA6A A5 B3                                lda facb+s_word       ;count MSW
   3685 CA6C C2 20                    +            .byte $c2,$20

                                        
   3686 CA6E 38                                   sec
   3687 CA6F 05 B1                                ora facb              ;count LSW
   3688 CA71 F0 13                                beq .0000020          ;zero, just exit
                                        ;
   3690 CA73 A5 B1                                lda facb
   3691 CA75 E5 C6                                sbc charcnt           ;bytes processed
   3692 CA77 85 B1                                sta facb
   3693 CA79 E2 20                    +            .byte $e2,$20

                                        
   3694 CA7B A5 B3                                lda facb+s_word
   3695 CA7D E9 00                                sbc #0                ;handle borrow
   3696 CA7F 90 04                                bcc .0000010          ;underflow
                                        ;
   3698 CA81 85 B3                                sta facb+s_word
   3699 CA83 18                                   clc                   ;count > 0
   3700 CA84 60                                   rts
                                        ;
   3702 CA85 38                         .0000010 sec
                                        ;
   3704 CA86 E2 20                      .0000020 +         .byte $e2,$20

                                        
   3705 CA88 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;enddest: GET 2ND & 3RD ADDRESSES FOR COMPARE & TRANSFER
                                        ;
   3711 CA89 20 CD CA                   enddest  jsr facasize          ;check start...
   3712 CA8C C9 04                                cmp #s_dword          ;for range
   3713 CA8E B0 1E                                bcs .0000010          ;out of range — error
                                        ;
   3715 CA90 20 AF CA                             jsr facaddra          ;store start
   3716 CA93 20 E1 CA                             jsr getparm           ;get end
   3717 CA96 B0 16                                bcs .0000010          ;not entered — error
                                        ;
   3719 CA98 20 CD CA                             jsr facasize          ;check end...
   3720 CA9B C9 04                                cmp #s_dword          ;for range
   3721 CA9D B0 0F                                bcs .0000010          ;out of range — error
                                        ;
   3723 CA9F 20 B9 CA                             jsr facaddrb          ;store end
   3724 CAA2 20 E1 CA                             jsr getparm           ;get destination
   3725 CAA5 B0 07                                bcs .0000010          ;not entered — error
                                        ;
   3727 CAA7 20 CD CA                             jsr facasize          ;check destination...
   3728 CAAA C9 04                                cmp #s_dword          ;for range
   3729 CAAC 90 15                                bcc facaoper          ;store dest address
                                        ;
   3731 CAAE 60                         .0000010 rts                   ;exit w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddra: COPY FACA TO ADDRA
                                        ;
   3737 CAAF A2 02                      facaddra ldx #s_xword-1
                                        ;
   3739 CAB1 B5 A9                      .0000010 lda faca,x
   3740 CAB3 95 A2                                sta addra,x
   3741 CAB5 CA                                   dex
   3742 CAB6 10 F9                                bpl .0000010
                                        ;
   3744 CAB8 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddrb: COPY FACA TO ADDRB
                                        ;
   3750 CAB9 A2 02                      facaddrb ldx #s_xword-1
                                        ;
   3752 CABB B5 A9                      .0000010 lda faca,x
   3753 CABD 95 A6                                sta addrb,x
   3754 CABF CA                                   dex
   3755 CAC0 10 F9                                bpl .0000010
                                        ;
   3757 CAC2 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaoper: COPY FACA TO OPERAND
                                        ;
   3763 CAC3 A2 02                      facaoper ldx #s_oper-1
                                        ;
   3765 CAC5 B5 A9                      .0000010 lda faca,x
   3766 CAC7 95 BD                                sta operand,x
   3767 CAC9 CA                                   dex
   3768 CACA 10 F9                                bpl .0000010
                                        ;
   3770 CACC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facasize: REPORT OPERAND SIZE IN FACA
                                        ;
                                        ;	——————————————————————————————————————————
                                        ;	Preparatory Ops: operand in FACA
                                        ;
                                        ;	Returned Values: .A: s_byte  (1)
                                        ;	                     s_word  (2)
                                        ;	                     s_xword (3)
                                        ;	                     s_dword (4)
                                        ;
                                        ;	Notes: 1) This function will always report
                                        ;	          a non-zero result.
                                        ;	——————————————————————————————————————————
                                        ;
   3788 CACD E2 30                      facasize +         .byte $e2,$30

                                        
   3789 CACF A2 03                                ldx #s_dword-1
                                        ;
   3791 CAD1 B5 A9                      .0000010 lda faca,x            ;get byte
   3792 CAD3 D0 03                                bne .0000020          ;done
                                        ;
   3794 CAD5 CA                                   dex
   3795 CAD6 D0 F9                                bne .0000010          ;next byte
                                        ;
   3797 CAD8 E8                         .0000020 inx                   ;count=index+1
   3798 CAD9 8A                                   txa
   3799 CADA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getbyte: GET A BYTE FROM MEMORY
                                        ;
   3805 CADB A7 A2                      getbyte +         .byte $a7,addra

                                        ;get a byte
   3806 CADD 80 3F                                bra incaddra          ;bump address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getparm: GET A PARAMETER
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops: null-terminated input in IBUFFER
                                        ;
                                        ;	Returned Values: .A: chars in converted parameter
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = no parameter entered
                                        ;	—————————————————————————————————————————————————
                                        ;
   3821 CADF C6 C1                      getparmr dec ibufidx           ;reread previous char
                                        ;
   3823 CAE1 5A                         getparm  phy                   ;preserve
   3824 CAE2 20 36 C8                             jsr ascbin            ;convert parameter to binary
   3825 CAE5 B0 1C                                bcs .0000040          ;conversion error
                                        ;
   3827 CAE7 20 CE CB                             jsr getcharr          ;reread last char
   3828 CAEA D0 08                                bne .0000010          ;not end-of-input
                                        ;
   3830 CAEC C6 C1                                dec ibufidx           ;reindex to terminator
   3831 CAEE A5 C6                                lda charcnt           ;get chars processed so far
   3832 CAF0 F0 0C                                beq .0000030          ;none
                                        ;
   3834 CAF2 D0 08                                bne .0000020          ;some
                                        ;
   3836 CAF4 C9 20                      .0000010 cmp #a_blank          ;recognized delimiter
   3837 CAF6 F0 04                                beq .0000020          ;end of parameter
                                        ;
   3839 CAF8 C9 2C                                cmp #','              ;recognized delimiter
   3840 CAFA D0 07                                bne .0000040          ;unknown delimter
                                        ;
   3842 CAFC 18                         .0000020 clc
   3843 CAFD 24                                   .byte bitzp           ;skip SEC below
                                        ;
   3845 CAFE 38                         .0000030 sec
   3846 CAFF 7A                                   ply                   ;restore
   3847 CB00 A5 C6                                lda charcnt           ;get count
   3848 CB02 60                                   rts                   ;done
                                        ;
   3850 CB03                            .0000040 
                                        ;.rept 3               ;clean up stack
   3852 CB03 68                          			pla
   3853 CB04 68                          			pla
   3854 CB05 68                                     pla
                                        ;        .endr
   3856 CB06 4C 88 C1                             jmp monerr            ;abort w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nxtaddra: TEST & INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR NXTADDRA
                                        ;
                                        ;	Exit registers: .A: used
                                        ;	                .B: used
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    |||||||+———> 0: ADDRA < ADDRB
                                        ;	                    |||||||      1: ADDRA >= ADDRB
                                        ;	                    ||||||+————> undefined
                                        ;	                    |||+++—————> entry value
                                        ;	                    ||+————————> 1
                                        ;	                    ++—————————> undefined
                                        ;	——————————————————————————————————————————————————
                                        ;
   3882 CB09 E2 20                      nxtaddra +         .byte $e2,$20

                                        
   3883 CB0B A5 A4                                lda addra+s_word      ;bits 16-23
   3884 CB0D C5 A8                                cmp addrb+s_word
   3885 CB0F 90 0D                                bcc incaddra          ;increment
                                        ;
   3887 CB11 D0 0A                                bne .0000010          ;don't increment
                                        ;
   3889 CB13 C2 20                    +            .byte $c2,$20

                                        
   3890 CB15 A5 A2                                lda addra             ;bits 0-15
   3891 CB17 C5 A6                                cmp addrb             ;condition flags
   3892 CB19 E2 20                    +            .byte $e2,$20

                                        
   3893 CB1B 90 01                                bcc incaddra          ;increment
                                        ;
   3895 CB1D 60                         .0000010 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incaddra: INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR INCADDRA
                                        ;
                                        ;	Exit registers: .A: entry value
                                        ;	                .B: entry value
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    ++++++++———> entry value
                                        ;	——————————————————————————————————————————————————
                                        ;
   3916 CB1E 08                         incaddra php
   3917 CB1F C2 20                    +            .byte $c2,$20

                                        
   3918 CB21 E6 A2                                inc addra             ;bump bits 0-15
   3919 CB23 D0 04                                bne .0000010
                                        ;
   3921 CB25 E2 20                    +            .byte $e2,$20

                                        
   3922 CB27 E6 A4                                inc addra+s_word      ;bump bits 16-23
                                        ;
   3924 CB29 28                         .0000010 plp
   3925 CB2A 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incoper: INCREMENT OPERAND ADDRESS
                                        ;
   3931 CB2B 18                         incoper  clc
   3932 CB2C 08                                   php
   3933 CB2D C2 30                    +            .byte $c2,$30

                                        
   3934 CB2F 48                                   pha
   3935 CB30 E6 BD                                inc operand           ;handle base address
   3936 CB32 D0 06                                bne .0000010
                                        ;              
   3938 CB34 E2 20                    +            .byte $e2,$20

                                        
   3939 CB36 E6 BF                                inc operand+s_word    ;handle bank
   3940 CB38 C2 20                    +            .byte $c2,$20

                                        
                                        ;
   3942 CB3A 68                         .0000010 pla
   3943 CB3B 28                                   plp
   3944 CB3C 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;instdata: GET INSTRUCTION SIZE & ADDRESSING MODE DATA
                                        ;
                                        ;	——————————————————————————————————
                                        ;	Preparatory Ops: .X: 65C816 opcode
                                        ;
                                        ;	Returned Values: .A: mode flags
                                        ;	                 .X: operand size
                                        ;	                 .Y: mode index
                                        ;	——————————————————————————————————
                                        ;
   3958 CB3D E2 30                      instdata +         .byte $e2,$30

                                        
   3959 CB3F BD B8 CE                             lda mnetabam,x        ;addressing mode data
   3960 CB42 48                                   pha                   ;save mode flag bits
   3961 CB43 48                                   pha                   ;save size data
   3962 CB44 29 0F                                and #amodmask         ;extract mode index &...
   3963 CB46 A8                                   tay                   ;save
   3964 CB47 68                                   pla                   ;recover data
   3965 CB48 29 30                                and #opsmask          ;mask mode fields &...
                                        ;         .rept n_opslsr        ;extract operand size
   3967 CB4A 4A                                     lsr
   3968 CB4B 4A                                     lsr
   3969 CB4C 4A                                     lsr
   3970 CB4D 4A                                     lsr
                                        ;         .endr
   3972 CB4E AA                                   tax                   ;operand size
   3973 CB4F 68                                   pla                   ;recover mode flags
   3974 CB50 29 C0                                and #vopsmask         ;discard mode & size fields
   3975 CB52 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;offtarg: CONVERT BRANCH OFFSET TO TARGET ADDRESS
                                        ;
                                        ;	———————————————————————————————————————————————
                                        ;	Preparatory Ops:    ADDRA: base address
                                        ;	                 INSTSIZE: instruction size
                                        ;	                  OPERAND: offset
                                        ;
                                        ;	Returned Values:  OPERAND: target address (L/H)
                                        ;	                       .A: used
                                        ;	                       .X: entry value
                                        ;                              .Y: entry value
                                        ;	———————————————————————————————————————————————
                                        ;
   3992 CB53 C2 20                      offtarg +         .byte $c2,$20

                                        
   3993 CB55 A5 A2                                lda addra             ;base address
   3994 CB57 E2 20                    +            .byte $e2,$20

                                        
   3995 CB59 46 C8                                lsr instsize          ;bit 0 will be set if...
   3996 CB5B B0 07                                bcs .0000010          ;a long branch
                                        ;
   3998 CB5D 24 BD                                bit operand           ;short forward or backward?
   3999 CB5F 10 03                                bpl .0000010          ;forward
                                        ;
   4001 CB61 EB                       +            .byte $eb

                                                           ;expose address MSB
   4002 CB62 3A                                   dea                   ;back a page
   4003 CB63 EB                       +            .byte $eb

                                                           ;expose address LSB
                                        ;
   4005 CB64 C2 20                      .0000010 +         .byte $c2,$20

                                        
   4006 CB66 18                                   clc
   4007 CB67 65 BD                                adc operand           ;calculate target address
   4008 CB69 85 BD                                sta operand           ;new operand
   4009 CB6B E2 20                    +            .byte $e2,$20

                                        
   4010 CB6D A9 03                                lda #s_xword
   4011 CB6F 85 C8                                sta instsize          ;effective instruction size
   4012 CB71 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;setxaddr: SET EXECUTION ADDRESS
                                        ;
   4018 CB72 B0 13                      setxaddr bcs .0000010          ;no address given
                                        ;
   4020 CB74 20 CD CA                             jsr facasize          ;check address...
   4021 CB77 C9 04                                cmp #s_dword          ;range
   4022 CB79 B0 0D                                bcs .0000020          ;out of range
                                        ;
   4024 CB7B C2 20                    +            .byte $c2,$20

                                        
   4025 CB7D A5 A9                                lda faca              ;execution address
   4026 CB7F 85 88                                sta reg_pcx           ;set new PC value
   4027 CB81 E2 20                    +            .byte $e2,$20

                                        
   4028 CB83 A5 AB                                lda faca+s_word
   4029 CB85 85 8A                                sta reg_pbx           ;set new PB value
                                        ;
   4031 CB87 18                         .0000010 clc                   ;no error
                                        ;
   4033 CB88 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;targoff: CONVERT BRANCH TARGET ADDRESS TO BRANCH OFFSET                   
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops:   ADDRA: instruction address
                                        ;	                 OPERAND: target address
                                        ;
                                        ;	Returned Values: OPERAND: computed offset
                                        ;	                      .A: effective operand size
                                        ;	                      .X: entry value
                                        ;                             .Y: entry value
                                        ;	                      .C: 1 = branch out of range
                                        ;
                                        ;	Execution notes: ADDRB is set to the branch base
                                        ;	                 address.
                                        ;	—————————————————————————————————————————————————
                                        ;
   4053 CB89 64 C9                      targoff  stz instsize+s_byte   ;always zero
   4054 CB8B A5 C8                                lda instsize          ;instruction size will tell...
   4055 CB8D 4A                                   lsr                   ;if long or short branch
                                        ;
                                        ;—————————————————————————————————————————————————
   4265 = 000000BC                      .btype   =facc+5               ;branch type flag
                                        ;—————————————————————————————————————————————————
                                        ;
   4061 CB8E 66 BC                                ror .btype            ;set branch type...
                                        ;
                                        ;	x0000000
                                        ;	|
                                        ;	+——————————> 0: short
                                        ;	             1: long
                                        ;
   4068 CB90 C2 20                    +            .byte $c2,$20

                                        
   4069 CB92 18                                   clc
   4070 CB93 A5 A2                                lda addra             ;instruction address
   4071 CB95 65 C8                                adc instsize          ;instruction size
   4072 CB97 85 A6                                sta addrb             ;base address
   4073 CB99 38                                   sec
   4074 CB9A A5 BD                                lda operand           ;target address
   4075 CB9C E5 A6                                sbc addrb             ;base address
   4076 CB9E 85 BD                                sta operand           ;offset
   4077 CBA0 E2 20                    +            .byte $e2,$20

                                        
   4078 CBA2 90 15                                bcc .0000040          ;backward branch
                                        ;
   4080 CBA4 24 BC                                bit .btype            ;check branch range
   4081 CBA6 30 0A                                bmi .0000020          ;long
                                        ;
                                        ;
                                        ;	process short forward branch...
                                        ;
   4086 CBA8 EB                       +            .byte $eb

                                                           ;offset MSB should be zero
   4087 CBA9 D0 21                                bne .0000060          ;it isn't — out of range
                                        ;
   4089 CBAB EB                       +            .byte $eb

                                                           ;offset LSB should be $00-$7F
   4090 CBAC 30 1E                                bmi .0000060          ;it isn't — out of range
                                        ;
   4092 CBAE A9 01                      .0000010 lda #s_byte           ;final instruction size
   4093 CBB0 18                                   clc                   ;branch in range
   4094 CBB1 60                                   rts
                                        ;
                                        ;
                                        ;	process long forward branch...
                                        ;
   4099 CBB2 EB                         .0000020 +         .byte $eb

                                                           ;offset MSB should be positive
   4100 CBB3 30 17                                bmi .0000060          ;it isn't — branch out of range
                                        ;
   4102 CBB5 A9 02                      .0000030 lda #s_word
   4103 CBB7 18                                   clc
   4104 CBB8 60                                   rts
                                        ;
                                        ;
                                        ;	process backward branch...
                                        ;
   4109 CBB9 24 BC                      .0000040 bit .btype            ;long or short?
   4110 CBBB 30 0C                                bmi .0000050          ;long
                                        ;
                                        ;
                                        ;	process short backward branch...
                                        ;
   4115 CBBD EB                       +            .byte $eb

                                                           ;offset MSB should be negative
   4116 CBBE 10 0C                                bpl .0000060          ;it isn't — out of range
                                        ;
   4118 CBC0 49 FF                                eor #%11111111        ;complement offset MSB 2s 
   4119 CBC2 D0 08                                bne .0000060          ;out of range
                                        ;
   4121 CBC4 EB                       +            .byte $eb

                                                           ;offset LSB should be $80-$FF
   4122 CBC5 30 E7                                bmi .0000010          ;it is — branch in range
                                        ;
   4124 CBC7 80 03                                bra .0000060          ;branch out of range
                                        ;
                                        ;
                                        ;	process long backward branch...
                                        ;
   4129 CBC9 EB                         .0000050 +         .byte $eb

                                                           ;offset MSB should be negative
   4130 CBCA 30 E9                                bmi .0000030          ;it is — branch in range
                                        ;
   4132 CBCC 38                         .0000060 sec                   ;range error
   4133 CBCD 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharr: GET PREVIOUS INPUT BUFFER CHARACTER
                                        ;
   4139 CBCE C6 C1                      getcharr dec ibufidx           ;move back a char
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getchar: GET A CHARACTER FROM INPUT BUFFER
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops : none
                                        ;
                                        ;	Register Returns: .A: character or <NUL>
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> entry value
                                        ;	           ||||||+————> 1: <NUL> gotten
                                        ;	           |||||+—————> entry value
                                        ;	           ||||+——————> entry value
                                        ;	           |||+———————> entry value
                                        ;	           ||+————————> entry value
                                        ;	           |+—————————> not defined
                                        ;	           +——————————> not defined
                                        ;	——————————————————————————————————————————————
                                        ;
   4165 CBD0 DA                         getchar  phx
   4166 CBD1 5A                                   phy
   4167 CBD2 08                                   php                   ;save register sizes
   4168 CBD3 E2 30                    +            .byte $e2,$30

                                                        ;force 8 bits
   4169 CBD5 A6 C1                                ldx ibufidx           ;buffer index
   4170 CBD7 BD 00 02                             lda ibuffer,x         ;get char
   4171 CBDA E6 C1                                inc ibufidx           ;bump index
   4172 CBDC 28                                   plp                   ;restore register widths
   4173 CBDD 7A                                   ply
   4174 CBDE FA                                   plx
                                        ; Changed the following to XBA instruction which seems to work as well.
                                        ; XBA doesn't access the stack memory saving a data memory access,
                                        ; and hence is faster.
   4178 CBDF EB                       +            .byte $eb

                                        		;	pha                   ;condition...
   4179 CBE0 EB                       +            .byte $eb

                                        		;   pla                   ;.Z
   4180 CBE1 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getpat: GET PATTERN FOR MEMORY CHANGE or SEARCH
                                        ;
                                        ;	—————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated pattern in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: pattern length if entered
                                        ;	                 .C: 0 = pattern valid
                                        ;	                     1 = exception:
                                        ;	                 .N  0 = no pattern entered
                                        ;	                     1 = evaluation error
                                        ;
                                        ;	Notes: 1) If pattern is preceded by "'" the following
                                        ;	          characters are interpreted as ASCII.
                                        ;	       2) A maximum of 32 bytes or characters is
                                        ;	          accepted.  Excess input will be discarded.
                                        ;	—————————————————————————————————————————————————————
                                        ;
   4203 CBE2 64 CD                      getpat   stz status            ;clear pattern type indicator
   4204 CBE4 A0 00                                ldy #0                ;pattern index
   4205 CBE6 20 CE CB                             jsr getcharr          ;get last char
   4206 CBE9 F0 3C                                beq .0000070          ;EOS
                                        ;
   4208 CBEB A6 C1                                ldx ibufidx           ;current buffer index
   4209 CBED 20 2E CC                             jsr getcharw          ;get next
   4210 CBF0 F0 35                                beq .0000070          ;EOS
                                        ;
   4212 CBF2 C9 27                                cmp #''''			; *** watch syntax here, the following line of code was omitted when only ''' was present
   4213 CBF4 D0 04                                bne .0000010          ;not ASCII input
                                        ;
   4215 CBF6 66 CD                                ror status            ;condition flag
   4216 CBF8 80 12                                bra .0000030          ;balance of input is ASCII
                                        ;
   4218 CBFA 86 C1                      .0000010 stx ibufidx           ;restore buffer index
                                        ;
   4220 CBFC 20 E1 CA                   .0000020 jsr getparm           ;evaluate numeric pattern
   4221 CBFF B0 21                                bcs .0000060          ;done w/pattern
                                        ;
   4223 CC01 20 CD CA                             jsr facasize          ;size
   4224 CC04 C9 02                                cmp #s_word
   4225 CC06 B0 1F                                bcs .0000070          ;not a byte — error
                                        ;
   4227 CC08 A5 A9                                lda faca              ;get byte &...
   4228 CC0A 80 05                                bra .0000040          ;store
                                        ;
   4230 CC0C 20 D0 CB                   .0000030 jsr getchar           ;get ASCII char
   4231 CC0F F0 11                                beq .0000060          ;done w/pattern
                                        ;
   4233 CC11 C0 20                      .0000040 cpy #s_auxbuf         ;pattern buffer full?
   4234 CC13 F0 0A                                beq .0000050          ;yes
                                        ;
   4236 CC15 99 51 02                             sta auxbuf,y          ;store pattern
   4237 CC18 C8                                   iny
   4238 CC19 24 CD                                bit status
   4239 CC1B 10 DF                                bpl .0000020          ;get next numeric value
                                        ;
   4241 CC1D 80 ED                                bra .0000030          ;get next ASCII char
                                        ;
   4243 CC1F 20 14 C8                   .0000050 jsr alert             ;excess input
                                        ;
   4245 CC22 84 C0                      .0000060 sty auxbufix          ;save pattern size
   4246 CC24 98                                   tya                   ;condition .Z
   4247 CC25 18                                   clc                   ;pattern valid
   4248 CC26 60                                   rts
                                        ;
                                        ;
                                        ;	no pattern entered...
                                        ;
   4253 CC27 C2 80                      .0000070 +         .byte $c2,%10000000

                                        
   4254 CC29 38                                   sec
   4255 CC2A 60                                   rts
                                        ;
                                        ;
                                        ;	evaluation error...
                                        ;
   4260 CC2B E2 81                      .0000080 +         .byte $e2,%10000001

                                        
   4261 CC2D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharw: GET FROM INPUT BUFFER, DISCARDING WHITESPACE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;
                                        ;	Notes: Whitespace is defined as a blank ($20) or a
                                        ;	       horizontal tab ($09).
                                        ;	——————————————————————————————————————————————————
                                        ;
   4279 CC2E 20 D0 CB                   getcharw jsr getchar           ;get from buffer
   4280 CC31 F0 08                                beq .0000010          ;EOI
                                        ;
   4282 CC33 C9 20                                cmp #' '
   4283 CC35 F0 F7                                beq getcharw          ;discard whitespace
                                        ;
   4285 CC37 C9 09                                cmp #a_ht             ;also whitespace
   4286 CC39 F0 F3                                beq getcharw
                                        ;
   4288 CC3B 18                         .0000010 clc
   4289 CC3C 60                                   rts  
                                        ;
                                        ;================================================================================
                                        ;
                                        ;input: INTERACTIVE INPUT FROM CONSOLE CHANNEL
                                        ;
                                        ;	———————————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Zero IBUFIDX or load IBUFFER with default
                                        ;	                 input & set IBUFIDX to the number of chars
                                        ;	                 loaded into the buffer.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: characters entered
                                        ;	                 .Y: used
                                        ;
                                        ;	Example: STZ IBUFIDX
                                        ;	         JSR INPUT
                                        ;
                                        ;	Notes: Input is collected in IBUFFER & is null-terminated.
                                        ;	       IBUFIDX is reset to zero upon exit.
                                        ;	———————————————————————————————————————————————————————————
                                        ;
   4311 CC3D                            input:
   4312 CC3D A6 C1                       	    ldx ibufidx
   4313 CC3F 9E 00 02                             stz ibuffer,x         ;be sure buffer is terminated
   4314 CC42 20 80 C7                             jsr dpyibuf           ;print default input if any
   4315 CC45 F4                       +            .byte $f4
   4315 CC46 10 D0                    +            .word dc_cn

                                        
   4316 CC48 20 1D C8                             jsr sprint            ;enable cursor
   4317 CC4B A6 C1                                ldx ibufidx           ;starting buffer index
                                        ;
                                        ;
                                        ;	main input loop...
                                        ;
   4322 CC4D 20 00 F4                   .0000010 jsr getcha            ;poll for input
   4323 CC50 90 02                                bcc .0000020          ;got something
                                        ;
                                        ;         jsr	$F409          ;wait 'til any IRQ &... (Reschedule tasks)
   4326 CC52 80 F9                                bra .0000010          ;try again
                                        ;
   4328 CC54                            .0000020
   4329 CC54 C9 7F                       		cmp #a_del            ;above ASCII range?
   4330 CC56 B0 F5                                bcs .0000010          ;yes, ignore
                                        ;
   4332 CC58 C9 09                                cmp #a_ht             ;horizontal tab?
   4333 CC5A D0 02                                bne .0000030          ;no
                                        ;
   4335 CC5C A9 20                                lda #a_blank          ;replace <HT> w/blank
                                        ;
   4337 CC5E C9 20                      .0000030 cmp #a_blank          ;control char?
   4338 CC60 90 10                                bcc .0000050          ;yes
                                        ;
                                        ;
                                        ;	process QWERTY character...
                                        ;
   4343 CC62 E0 50                                cpx #s_ibuf           ;room in buffer?
   4344 CC64 B0 05                                bcs .0000040          ;no
                                        ;
   4346 CC66 9D 00 02                             sta ibuffer,x         ;store char
   4347 CC69 E8                                   inx                   ;bump index
   4348 CC6A 2C                                   .byte bitabs          ;echo char
                                        ;
   4350 CC6B A9 07                      .0000040 lda #a_bel            ;alert user
   4351 CC6D 20 06 F4                             jsr putcha
   4352 CC70 80 DB                                bra .0000010          ;get some more
                                        ;
                                        ;
                                        ;	process carriage return...
                                        ;
   4357 CC72 C9 0D                      .0000050 cmp #a_cr             ;carriage return?
   4358 CC74 D0 0E                                bne .0000060          ;no
                                        ;
   4360 CC76 DA                                   phx                   ;protect input count
   4361 CC77 F4                       +            .byte $f4
   4361 CC78 14 D0                    +            .word dc_co

                                        
   4362 CC7A 20 1D C8                             jsr sprint            ;cursor off
   4363 CC7D FA                                   plx                   ;recover input count
   4364 CC7E 9E 00 02                             stz ibuffer,x         ;terminate input &...
   4365 CC81 64 C1                                stz ibufidx           ;reset buffer index
   4366 CC83 60                                   rts                   ;done
                                        ;
                                        ;
                                        ;	process backspace...
                                        ;
   4371 CC84 C9 08                      .0000060 cmp #a_bs             ;backspace?
   4372 CC86 D0 C5                                bne .0000010          ;no
                                        ;
   4374 CC88 8A                                   txa
   4375 CC89 F0 C2                                beq .0000010          ;no input, ignore <BS>
                                        ;
   4377 CC8B CA                                   dex                   ;1 less char
   4378 CC8C DA                                   phx                   ;preserve count
   4379 CC8D 20 CF C7                             jsr gendbs            ;destructive backspace
   4380 CC90 FA                                   plx                   ;restore count
   4381 CC91 80 BA                                bra .0000010          ;get more input
                                        ;
                                        ;================================================================================
                                        ;
                                        ;lodbnk: LOAD SOURCE & DESTINATION BANKS
                                        ;
   4387 CC93 E2 20                      lodbnk +         .byte $e2,$20

                                        
   4388 CC95 A5 BF                                lda operand+s_word    ;destination bank
   4389 CC97 EB                       +            .byte $eb

                                                           ;make it MSB
   4390 CC98 A5 A4                                lda addra+s_word      ;source bank is LSB
   4391 CC9A 60                                   rts
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;getcharc: GET A CHARACTER FROM INPUT BUFFER & CONVERT CASE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;	——————————————————————————————————————————————————
                                        ;
   4406 CC9B 20 D0 CB                   getcharc jsr getchar           ;get from buffer
   4407 CC9E F0 0C                                beq touppera          ;just return
                                        ;
                                        ;================================================================================
                                        ;
                                        ;toupper: FORCE CHARACTER TO UPPER CASE
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .A: character to convert
                                        ;
                                        ;	Register Returns: .A: converted character
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: no change
                                        ;
                                        ;	Notes: 1) This subroutine has no effect on char-
                                        ;	          acters that are not alpha.
                                        ;	————————————————————————————————————————————————
                                        ;
   4427 CCA0 08                         toupper  php                   ;protect flags
   4428 CCA1 C9 61                                cmp #a_asclcl         ;check char range
   4429 CCA3 90 06                                bcc .0000010          ;not LC alpha
                                        ;
   4431 CCA5 C9 7B                                cmp #a_asclch+s_byte
   4432 CCA7 B0 02                                bcs .0000010          ;not LC alpha
                                        ;
   4434 CCA9 29 5F                                and #a_lctouc         ;force to UC
                                        ;
   4436 CCAB 28                         .0000010 plp                   ;restore flags
                                        ;
   4438 CCAC 60                         touppera rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;teststop: TEST FOR STOP KEY
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops: none
                                        ;
                                        ;	Returned Values: .A: detected keypress, if any
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: normal key detected
                                        ;	           |||||||      1: <STOP> detected
                                        ;	           +++++++————> not defined
                                        ;
                                        ;	Example: jsr teststop
                                        ;	         bcs stopped
                                        ;
                                        ;	Notes: The symbol STOPKEY defines the ASCII
                                        ;	       value of the "stop key."
                                        ;	——————————————————————————————————————————————
                                        ;
   4464 CCAD 20 00 F4                   teststop jsr getcha            ;poll console
   4465 CCB0 B0 04                                bcs .0000010          ;no input
                                        ;
   4467 CCB2 C9 03                                cmp #stopkey          ;stop key pressed?
   4468 CCB4 F0 01                                beq .0000020          ;yes
                                        ;
   4470 CCB6 18                         .0000010 clc
                                        ;
   4472 CCB7 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;COMMAND PROCESSING DATA TABLES
                                        ;
                                        ;
                                        ;	monitor commands...
                                        ;
   4481 CCB8 41                         mpctab   .byte "A"             ;assemble code
   4482 CCB9 43                                   .byte "C"             ;compare memory ranges
   4483 CCBA 44                                   .byte "D"             ;disassemble code
   4484 CCBB 46                                   .byte "F"             ;fill memory
   4485 CCBC 47                                   .byte "G"             ;execute code
   4486 CCBD 48                                   .byte "H"             ;search memory
   4487 CCBE 4A                                   .byte "J"             ;execute code as subroutine
   4488 CCBF 4D                                   .byte "M"             ;dump memory range
   4489 CCC0 52                                   .byte "R"             ;dump registers
   4490 CCC1 54                                   .byte "T"             ;copy memory range
   4491 CCC2 58                                   .byte "X"             ;exit from monitor
   4492 CCC3 3E                                   .byte ">"             ;change memory
   4493 CCC4 3B                                   .byte ";"             ;change registers
   4720 = 0000000D                      n_mpctab =*-mpctab             ;entries in above table
                                        ;
                                        ;
                                        ;	monitor command jump table...
                                        ;
   4499 CCC5 8E C1                      mpcextab .word monasc-s_byte   ; A  assemble code
   4500 CCC7 50 C4                                .word moncmp-s_byte   ; C  compare memory ranges
   4501 CCC9 6A C3                                .word mondsc-s_byte   ; D  disassemble code
   4502 CCCB 21 C5                                .word monfil-s_byte   ; F  fill memory
   4503 CCCD BE C3                                .word monjmp-s_byte   ; G  execute code
   4504 CCCF 87 C5                                .word monhnt-s_byte   ; H  search memory
   4505 CCD1 EF C3                                .word monjsr-s_byte   ; J  execute code as subroutine
   4506 CCD3 CF C4                                .word mondmp-s_byte   ; M  dump memory range
   4507 CCD5 A3 C0                                .word monreg-s_byte   ; R  dump registers
   4508 CCD7 7E C4                                .word moncpy-s_byte   ; T  copy memory range
   4509 CCD9 38 C6                                .word monxit-s_byte   ; X  exit from monitor
   4510 CCDB 25 C4                                .word monchm-s_byte   ; >  change memory
   4511 CCDD FD C5                                .word monchr-s_byte   ; ;  change registers
                                        ;
                                        ;
                                        ;	number conversion...
                                        ;        
   4516 CCDF 10 0A 08 02                basetab  .byte 16,10,8,2       ;supported number bases
   4517 CCE3 04 03 03 01                bitsdtab .byte 4,3,3,1         ;bits per binary digit
   4518 CCE7 04 04 03 01                bitsntab .byte 4,4,3,1         ;bits per ASCII character
   4519 CCEB 03 02 09 02                lzsttab  .byte 3,2,9,2         ;leading zero suppression thresholds
   4520 CCEF 0C 0C 10 30                numstab  .byte 12,12,16,48     ;bin to ASCII conversion numerals
   4521 CCF3 24                         radxtab  .byte c_hex           ;hexadecimal radix
   4522 CCF4 2B                                   .byte c_dec           ;decimal radix
   4523 CCF5 40                                   .byte c_oct           ;octal radix
   4524 CCF6 25                                   .byte c_bin           ;binary radix
   4751 = 00000004                      n_radix  =*-radxtab            ;number of recognized radices
                                        ;
                                        ;
                                        ;	shadow MPU register sizes...
                                        ;
   4530 CCF7 02                         rcvltab  .byte s_mpupbx+s_byte ; PB
   4531 CCF8 03                                   .byte s_mpupcx+s_byte ; PC
   4532 CCF9 02                                   .byte s_mpusrx+s_byte ; SR
   4533 CCFA 03                                   .byte s_word+s_byte   ; .C
   4534 CCFB 03                                   .byte s_word+s_byte   ; .X
   4535 CCFC 03                                   .byte s_word+s_byte   ; .Y
   4536 CCFD 03                                   .byte s_mpuspx+s_byte ; SP
   4537 CCFE 03                                   .byte s_mpudpx+s_byte ; DP
   4538 CCFF 02                                   .byte s_mpudbx+s_byte ; DB
   4765 = 00000009                      n_regchv =*-rcvltab            ;total shadow registers
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER DATA TABLES
                                        ;
                                        ;
                                        ;	numerically sorted & encoded W65C816S mnemonics...
                                        ;
   4548 CD00 F2 10                      mnetab   .word mne_xba         ;  0 — XBA
   4549 CD02 5A 11                                .word mne_lda         ;  1 — LDA
   4550 CD04 A2 11                                .word mne_pea         ;  2 — PEA
   4551 CD06 62 12                                .word mne_pha         ;  3 — PHA
   4552 CD08 62 13                                .word mne_pla         ;  4 — PLA
   4553 CD0A C6 14                                .word mne_bra         ;  5 — BRA
   4554 CD0C E0 14                                .word mne_ora         ;  6 — ORA
   4555 CD0E 68 15                                .word mne_sta         ;  7 — STA
   4556 CD10 6A 16                                .word mne_txa         ;  8 — TXA
   4557 CD12 AA 16                                .word mne_tya         ;  9 — TYA
   4558 CD14 62 1A                                .word mne_phb         ; 10 — PHB
   4559 CD16 62 1B                                .word mne_plb         ; 11 — PLB
   4560 CD18 EA 1C                                .word mne_trb         ; 12 — TRB
   4561 CD1A 2A 1D                                .word mne_tsb         ; 13 — TSB
   4562 CD1C E8 20                                .word mne_sbc         ; 14 — SBC
   4563 CD1E 06 21                                .word mne_bcc         ; 15 — BCC
   4564 CD20 44 21                                .word mne_adc         ; 16 — ADC
   4565 CD22 6A 21                                .word mne_tdc         ; 17 — TDC
   4566 CD24 8A 21                                .word mne_dec         ; 18 — DEC
   4567 CD26 A8 21                                .word mne_sec         ; 19 — SEC
   4568 CD28 48 23                                .word mne_clc         ; 20 — CLC
   4569 CD2A D4 23                                .word mne_inc         ; 21 — INC
   4570 CD2C 2A 25                                .word mne_tsc         ; 22 — TSC
   4571 CD2E C6 25                                .word mne_bvc         ; 23 — BVC
   4572 CD30 2A 29                                .word mne_tcd         ; 24 — TCD
   4573 CD32 A8 29                                .word mne_sed         ; 25 — SED
   4574 CD34 62 2A                                .word mne_phd         ; 26 — PHD
   4575 CD36 48 2B                                .word mne_cld         ; 27 — CLD
   4576 CD38 62 2B                                .word mne_pld         ; 28 — PLD
   4577 CD3A C4 2B                                .word mne_and         ; 29 — AND
   4578 CD3C 32 31                                .word mne_xce         ; 30 — XCE
   4579 CD3E C6 33                                .word mne_bne         ; 31 — BNE
   4580 CD40 B0 50                                .word mne_wai         ; 32 — WAI
   4581 CD42 A2 51                                .word mne_pei         ; 33 — PEI
   4582 CD44 A8 51                                .word mne_sei         ; 34 — SEI
   4583 CD46 48 53                                .word mne_cli         ; 35 — CLI
   4584 CD48 86 53                                .word mne_bmi         ; 36 — BMI
   4585 CD4A 66 55                                .word mne_rti         ; 37 — RTI
   4586 CD4C 62 62                                .word mne_phk         ; 38 — PHK
   4587 CD4E C6 64                                .word mne_brk         ; 39 — BRK
   4588 CD50 96 6B                                .word mne_jml         ; 40 — JML
   4589 CD52 26 6C                                .word mne_rol         ; 41 — ROL
   4590 CD54 46 6C                                .word mne_bpl         ; 42 — BPL
   4591 CD56 C6 6C                                .word mne_brl         ; 43 — BRL
   4592 CD58 04 6D                                .word mne_asl         ; 44 — ASL
   4593 CD5A 16 6D                                .word mne_jsl         ; 45 — JSL
   4594 CD5C 66 6D                                .word mne_rtl         ; 46 — RTL
   4595 CD5E 70 71                                .word mne_wdm         ; 47 — WDM
   4596 CD60 DC 7D                                .word mne_mvn         ; 48 — MVN
   4597 CD62 A6 89                                .word mne_rep         ; 49 — REP
   4598 CD64 A8 89                                .word mne_sep         ; 50 — SEP
   4599 CD66 62 8A                                .word mne_php         ; 51 — PHP
   4600 CD68 62 8B                                .word mne_plp         ; 52 — PLP
   4601 CD6A 88 8B                                .word mne_cmp         ; 53 — CMP
   4602 CD6C 96 8B                                .word mne_jmp         ; 54 — JMP
   4603 CD6E 08 8C                                .word mne_cop         ; 55 — COP
   4604 CD70 1E 8C                                .word mne_nop         ; 56 — NOP
   4605 CD72 68 8D                                .word mne_stp         ; 57 — STP
   4606 CD74 DC 8D                                .word mne_mvp         ; 58 — MVP
   4607 CD76 86 91                                .word mne_beq         ; 59 — BEQ
   4608 CD78 A2 99                                .word mne_per         ; 60 — PER
   4609 CD7A 0C 9C                                .word mne_eor         ; 61 — EOR
   4610 CD7C 26 9C                                .word mne_ror         ; 62 — ROR
   4611 CD7E 16 9D                                .word mne_jsr         ; 63 — JSR
   4612 CD80 1A 9D                                .word mne_lsr         ; 64 — LSR
   4613 CD82 06 A1                                .word mne_bcs         ; 65 — BCS
   4614 CD84 2A A1                                .word mne_tcs         ; 66 — TCS
   4615 CD86 66 A5                                .word mne_rts         ; 67 — RTS
   4616 CD88 C6 A5                                .word mne_bvs         ; 68 — BVS
   4617 CD8A 6A A6                                .word mne_txs         ; 69 — TXS
   4618 CD8C 86 AA                                .word mne_bit         ; 70 — BIT
   4619 CD8E 48 BB                                .word mne_clv         ; 71 — CLV
   4620 CD90 AA C8                                .word mne_tax         ; 72 — TAX
   4621 CD92 5A C9                                .word mne_ldx         ; 73 — LDX
   4622 CD94 8A C9                                .word mne_dex         ; 74 — DEX
   4623 CD96 62 CA                                .word mne_phx         ; 75 — PHX
   4624 CD98 62 CB                                .word mne_plx         ; 76 — PLX
   4625 CD9A D4 CB                                .word mne_inx         ; 77 — INX
   4626 CD9C 48 CC                                .word mne_cpx         ; 78 — CPX
   4627 CD9E 2A CD                                .word mne_tsx         ; 79 — TSX
   4628 CDA0 68 CD                                .word mne_stx         ; 80 — STX
   4629 CDA2 AA CE                                .word mne_tyx         ; 81 — TYX
   4630 CDA4 AA D0                                .word mne_tay         ; 82 — TAY
   4631 CDA6 5A D1                                .word mne_ldy         ; 83 — LDY
   4632 CDA8 8A D1                                .word mne_dey         ; 84 — DEY
   4633 CDAA 62 D2                                .word mne_phy         ; 85 — PHY
   4634 CDAC 62 D3                                .word mne_ply         ; 86 — PLY
   4635 CDAE D4 D3                                .word mne_iny         ; 87 — INY
   4636 CDB0 48 D4                                .word mne_cpy         ; 88 — CPY
   4637 CDB2 68 D5                                .word mne_sty         ; 89 — STY
   4638 CDB4 6A D6                                .word mne_txy         ; 90 — TXY
   4639 CDB6 68 DD                                .word mne_stz         ; 91 — STZ
                                        ;
   4867 = 000000B8                      s_mnetab =*-mnetab             ;mnemonic table size
   4868 = 0000005C                      n_mnemon =s_mnetab/s_word      ;total mnemonics
                                        ;
                                        ;
                                        ;	mnemonic lookup indices in opcode order...
                                        ;
   4647 CDB8 27                         mnetabix .byte mne_brkx        ; $00  BRK
   4648 CDB9 06                                   .byte mne_orax        ; $01  ORA (dp,X)
   4649 CDBA 37                                   .byte mne_copx        ; $02  COP
   4650 CDBB 06                                   .byte mne_orax        ; $03  ORA offset,S
   4651 CDBC 0D                                   .byte mne_tsbx        ; $04  TSB dp
   4652 CDBD 06                                   .byte mne_orax        ; $05  ORA dp
   4653 CDBE 2C                                   .byte mne_aslx        ; $06  ASL dp
   4654 CDBF 06                                   .byte mne_orax        ; $07  ORA [dp]
   4655 CDC0 33                                   .byte mne_phpx        ; $08  PHP
   4656 CDC1 06                                   .byte mne_orax        ; $09  ORA #
   4657 CDC2 2C                                   .byte mne_aslx        ; $0A  ASL A
   4658 CDC3 1A                                   .byte mne_phdx        ; $0B  PHD
   4659 CDC4 0D                                   .byte mne_tsbx        ; $0C  TSB abs
   4660 CDC5 06                                   .byte mne_orax        ; $0D  ORA abs
   4661 CDC6 2C                                   .byte mne_aslx        ; $0E  ASL abs
   4662 CDC7 06                                   .byte mne_orax        ; $0F  ORA absl
                                        ;
   4664 CDC8 2A                                   .byte mne_bplx        ; $10  BPL abs
   4665 CDC9 06                                   .byte mne_orax        ; $11  ORA (dp),Y
   4666 CDCA 06                                   .byte mne_orax        ; $12  ORA (dp)
   4667 CDCB 06                                   .byte mne_orax        ; $13  ORA (offset,S),Y
   4668 CDCC 0C                                   .byte mne_trbx        ; $14  TRB dp
   4669 CDCD 06                                   .byte mne_orax        ; $15  ORA dp,X
   4670 CDCE 2C                                   .byte mne_aslx        ; $16  ASL dp,X
   4671 CDCF 06                                   .byte mne_orax        ; $17  ORA [dp],Y
   4672 CDD0 14                                   .byte mne_clcx        ; $18  CLC
   4673 CDD1 06                                   .byte mne_orax        ; $19  ORA abs
   4674 CDD2 15                                   .byte mne_incx        ; $1A  INC A
   4675 CDD3 42                                   .byte mne_tcsx        ; $1B  TCS
   4676 CDD4 0C                                   .byte mne_trbx        ; $1C  TRB abs
   4677 CDD5 06                                   .byte mne_orax        ; $1D  ORA abs,X
   4678 CDD6 2C                                   .byte mne_aslx        ; $1E  ASL abs,X
   4679 CDD7 06                                   .byte mne_orax        ; $1F  ORA absl,X
                                        ;
   4681 CDD8 3F                                   .byte mne_jsrx        ; $20  JSR abs
   4682 CDD9 1D                                   .byte mne_andx        ; $21  AND (dp,X)
   4683 CDDA 2D                                   .byte mne_jslx        ; $22  JSL absl
   4684 CDDB 1D                                   .byte mne_andx        ; $23  AND offset,S
   4685 CDDC 46                                   .byte mne_bitx        ; $24  BIT dp
   4686 CDDD 1D                                   .byte mne_andx        ; $25  AND dp
   4687 CDDE 29                                   .byte mne_rolx        ; $26  ROL dp
   4688 CDDF 1D                                   .byte mne_andx        ; $27  AND [dp]
   4689 CDE0 34                                   .byte mne_plpx        ; $28  PLP
   4690 CDE1 1D                                   .byte mne_andx        ; $29  AND #
   4691 CDE2 29                                   .byte mne_rolx        ; $2A  ROL A
   4692 CDE3 1C                                   .byte mne_pldx        ; $2B  PLD
   4693 CDE4 46                                   .byte mne_bitx        ; $2C  BIT abs
   4694 CDE5 1D                                   .byte mne_andx        ; $2D  AND abs
   4695 CDE6 29                                   .byte mne_rolx        ; $2E  ROL abs
   4696 CDE7 1D                                   .byte mne_andx        ; $2F  AND absl
                                        ;
   4698 CDE8 24                                   .byte mne_bmix        ; $30  BMI abs
   4699 CDE9 1D                                   .byte mne_andx        ; $31  AND (dp),Y
   4700 CDEA 1D                                   .byte mne_andx        ; $32  AND (dp)
   4701 CDEB 1D                                   .byte mne_andx        ; $33  AND (offset,S),Y
   4702 CDEC 46                                   .byte mne_bitx        ; $34  BIT dp,X
   4703 CDED 1D                                   .byte mne_andx        ; $35  AND dp,X
   4704 CDEE 29                                   .byte mne_rolx        ; $36  ROL dp,X
   4705 CDEF 1D                                   .byte mne_andx        ; $37  AND [dp],Y
   4706 CDF0 13                                   .byte mne_secx        ; $38  SEC
   4707 CDF1 1D                                   .byte mne_andx        ; $39  AND abs,Y
   4708 CDF2 12                                   .byte mne_decx        ; $3A  DEC A
   4709 CDF3 16                                   .byte mne_tscx        ; $3B  TSC
   4710 CDF4 46                                   .byte mne_bitx        ; $3C  BIT abs,X
   4711 CDF5 1D                                   .byte mne_andx        ; $3D  AND abs,X
   4712 CDF6 29                                   .byte mne_rolx        ; $3E  ROL abs,X
   4713 CDF7 1D                                   .byte mne_andx        ; $3F  AND absl,X
                                        ;
   4715 CDF8 25                                   .byte mne_rtix        ; $40  RTI
   4716 CDF9 3D                                   .byte mne_eorx        ; $41  EOR (dp,X)
   4717 CDFA 2F                                   .byte mne_wdmx        ; $42  WDM
   4718 CDFB 3D                                   .byte mne_eorx        ; $43  EOR offset,S
   4719 CDFC 3A                                   .byte mne_mvpx        ; $44  MVP sb,db
   4720 CDFD 3D                                   .byte mne_eorx        ; $45  EOR dp
   4721 CDFE 40                                   .byte mne_lsrx        ; $46  LSR dp
   4722 CDFF 3D                                   .byte mne_eorx        ; $47  EOR [dp]
   4723 CE00 03                                   .byte mne_phax        ; $48  PHA
   4724 CE01 3D                                   .byte mne_eorx        ; $49  EOR #
   4725 CE02 40                                   .byte mne_lsrx        ; $4A  LSR A
   4726 CE03 26                                   .byte mne_phkx        ; $4B  PHK
   4727 CE04 36                                   .byte mne_jmpx        ; $4C  JMP abs
   4728 CE05 3D                                   .byte mne_eorx        ; $4D  EOR abs
   4729 CE06 40                                   .byte mne_lsrx        ; $4E  LSR abs
   4730 CE07 3D                                   .byte mne_eorx        ; $4F  EOR absl
                                        ;
   4732 CE08 17                                   .byte mne_bvcx        ; $50  BVC abs
   4733 CE09 3D                                   .byte mne_eorx        ; $51  EOR (dp),Y
   4734 CE0A 3D                                   .byte mne_eorx        ; $52  EOR (dp)
   4735 CE0B 3D                                   .byte mne_eorx        ; $53  EOR (offset,S),Y
   4736 CE0C 30                                   .byte mne_mvnx        ; $54  MVN sb,db
   4737 CE0D 3D                                   .byte mne_eorx        ; $55  EOR dp,X
   4738 CE0E 40                                   .byte mne_lsrx        ; $56  LSR dp,X
   4739 CE0F 3D                                   .byte mne_eorx        ; $57  EOR [dp],Y
   4740 CE10 23                                   .byte mne_clix        ; $58  CLI
   4741 CE11 3D                                   .byte mne_eorx        ; $59  EOR abs,Y
   4742 CE12 55                                   .byte mne_phyx        ; $5A  PHY
   4743 CE13 18                                   .byte mne_tcdx        ; $5B  TCD
   4744 CE14 28                                   .byte mne_jmlx        ; $5C  JML absl
   4745 CE15 3D                                   .byte mne_eorx        ; $5D  EOR abs,X
   4746 CE16 40                                   .byte mne_lsrx        ; $5E  LSR abs,X
   4747 CE17 3D                                   .byte mne_eorx        ; $5F  EOR absl,X
                                        ;
   4749 CE18 43                                   .byte mne_rtsx        ; $60  RTS
   4750 CE19 10                                   .byte mne_adcx        ; $61  ADC (dp,X)
   4751 CE1A 3C                                   .byte mne_perx        ; $62  PER
   4752 CE1B 10                                   .byte mne_adcx        ; $63  ADC offset,S
   4753 CE1C 5B                                   .byte mne_stzx        ; $64  STZ dp
   4754 CE1D 10                                   .byte mne_adcx        ; $65  ADC dp
   4755 CE1E 3E                                   .byte mne_rorx        ; $66  ROR dp
   4756 CE1F 10                                   .byte mne_adcx        ; $67  ADC [dp]
   4757 CE20 04                                   .byte mne_plax        ; $68  PLA
   4758 CE21 10                                   .byte mne_adcx        ; $69  ADC #
   4759 CE22 3E                                   .byte mne_rorx        ; $6A  ROR A
   4760 CE23 2E                                   .byte mne_rtlx        ; $6B  RTL
   4761 CE24 36                                   .byte mne_jmpx        ; $6C  JMP (abs)
   4762 CE25 10                                   .byte mne_adcx        ; $6D  ADC abs
   4763 CE26 3E                                   .byte mne_rorx        ; $6E  ROR abs
   4764 CE27 10                                   .byte mne_adcx        ; $6F  ADC absl
                                        ;
   4766 CE28 44                                   .byte mne_bvsx        ; $70  BVS abs
   4767 CE29 10                                   .byte mne_adcx        ; $71  ADC (dp),Y
   4768 CE2A 10                                   .byte mne_adcx        ; $72  ADC (dp)
   4769 CE2B 10                                   .byte mne_adcx        ; $73  ADC (offset,S),Y
   4770 CE2C 5B                                   .byte mne_stzx        ; $74  STZ dp,X
   4771 CE2D 10                                   .byte mne_adcx        ; $75  ADC dp,X
   4772 CE2E 3E                                   .byte mne_rorx        ; $76  ROR dp,X
   4773 CE2F 10                                   .byte mne_adcx        ; $77  ADC [dp],Y
   4774 CE30 22                                   .byte mne_seix        ; $78  SEI
   4775 CE31 10                                   .byte mne_adcx        ; $79  ADC abs,Y
   4776 CE32 56                                   .byte mne_plyx        ; $7A  PLY
   4777 CE33 11                                   .byte mne_tdcx        ; $7B  TDC
   4778 CE34 36                                   .byte mne_jmpx        ; $7C  JMP (abs,X)
   4779 CE35 10                                   .byte mne_adcx        ; $7D  ADC abs,X
   4780 CE36 3E                                   .byte mne_rorx        ; $7E  ROR abs,X
   4781 CE37 10                                   .byte mne_adcx        ; $7F  ADC absl,X
                                        ;
   4783 CE38 05                                   .byte mne_brax        ; $80  BRA abs
   4784 CE39 07                                   .byte mne_stax        ; $81  STA (dp,X)
   4785 CE3A 2B                                   .byte mne_brlx        ; $82  BRL abs
   4786 CE3B 07                                   .byte mne_stax        ; $83  STA offset,S
   4787 CE3C 59                                   .byte mne_styx        ; $84  STY dp
   4788 CE3D 07                                   .byte mne_stax        ; $85  STA dp
   4789 CE3E 50                                   .byte mne_stxx        ; $86  STX dp
   4790 CE3F 07                                   .byte mne_stax        ; $87  STA [dp]
   4791 CE40 54                                   .byte mne_deyx        ; $88  DEY
   4792 CE41 46                                   .byte mne_bitx        ; $89  BIT #
   4793 CE42 08                                   .byte mne_txax        ; $8A  TXA
   4794 CE43 0A                                   .byte mne_phbx        ; $8B  PHB
   4795 CE44 59                                   .byte mne_styx        ; $8C  STY abs
   4796 CE45 07                                   .byte mne_stax        ; $8D  STA abs
   4797 CE46 50                                   .byte mne_stxx        ; $8E  STX abs
   4798 CE47 07                                   .byte mne_stax        ; $8F  STA absl
                                        ;
   4800 CE48 0F                                   .byte mne_bccx        ; $90  BCC abs
   4801 CE49 07                                   .byte mne_stax        ; $91  STA (dp),Y
   4802 CE4A 07                                   .byte mne_stax        ; $92  STA (dp)
   4803 CE4B 07                                   .byte mne_stax        ; $93  STA (offset,S),Y
   4804 CE4C 59                                   .byte mne_styx        ; $94  STY dp,X
   4805 CE4D 07                                   .byte mne_stax        ; $95  STA dp,X
   4806 CE4E 50                                   .byte mne_stxx        ; $96  STX dp,Y
   4807 CE4F 07                                   .byte mne_stax        ; $97  STA [dp],Y
   4808 CE50 09                                   .byte mne_tyax        ; $98  TYA
   4809 CE51 07                                   .byte mne_stax        ; $99  STA abs,Y
   4810 CE52 45                                   .byte mne_txsx        ; $9A  TXS
   4811 CE53 5A                                   .byte mne_txyx        ; $9B  TXY
   4812 CE54 5B                                   .byte mne_stzx        ; $9C  STZ abs
   4813 CE55 07                                   .byte mne_stax        ; $9D  STA abs,X
   4814 CE56 5B                                   .byte mne_stzx        ; $9E  STZ abs,X
   4815 CE57 07                                   .byte mne_stax        ; $9F  STA absl,X
                                        ;
   4817 CE58 53                                   .byte mne_ldyx        ; $A0  LDY #
   4818 CE59 01                                   .byte mne_ldax        ; $A1  LDA (dp,X)
   4819 CE5A 49                                   .byte mne_ldxx        ; $A2  LDX #
   4820 CE5B 01                                   .byte mne_ldax        ; $A3  LDA offset,S
   4821 CE5C 53                                   .byte mne_ldyx        ; $A4  LDY dp
   4822 CE5D 01                                   .byte mne_ldax        ; $A5  LDA dp
   4823 CE5E 49                                   .byte mne_ldxx        ; $A6  LDX dp
   4824 CE5F 01                                   .byte mne_ldax        ; $A7  LDA [dp]
   4825 CE60 52                                   .byte mne_tayx        ; $A8  TAY
   4826 CE61 01                                   .byte mne_ldax        ; $A9  LDA #
   4827 CE62 48                                   .byte mne_taxx        ; $AA  TAX
   4828 CE63 0B                                   .byte mne_plbx        ; $AB  PLB
   4829 CE64 53                                   .byte mne_ldyx        ; $AC  LDY abs
   4830 CE65 01                                   .byte mne_ldax        ; $AD  LDA abs
   4831 CE66 49                                   .byte mne_ldxx        ; $AE  LDX abs
   4832 CE67 01                                   .byte mne_ldax        ; $AF  LDA absl
                                        ;
   4834 CE68 41                                   .byte mne_bcsx        ; $B0  BCS abs
   4835 CE69 01                                   .byte mne_ldax        ; $B1  LDA (dp),Y
   4836 CE6A 01                                   .byte mne_ldax        ; $B2  LDA (dp)
   4837 CE6B 01                                   .byte mne_ldax        ; $B3  LDA (offset,S),Y
   4838 CE6C 53                                   .byte mne_ldyx        ; $B4  LDY dp,X
   4839 CE6D 01                                   .byte mne_ldax        ; $B5  LDA dp,X
   4840 CE6E 49                                   .byte mne_ldxx        ; $B6  LDX dp,Y
   4841 CE6F 01                                   .byte mne_ldax        ; $B7  LDA [dp],Y
   4842 CE70 47                                   .byte mne_clvx        ; $B8  CLV
   4843 CE71 01                                   .byte mne_ldax        ; $B9  LDA abs,Y
   4844 CE72 4F                                   .byte mne_tsxx        ; $BA  TSX
   4845 CE73 51                                   .byte mne_tyxx        ; $BB  TYX
   4846 CE74 53                                   .byte mne_ldyx        ; $BC  LDY abs,X
   4847 CE75 01                                   .byte mne_ldax        ; $BD  LDA abs,X
   4848 CE76 49                                   .byte mne_ldxx        ; $BE  LDX abs,Y
   4849 CE77 01                                   .byte mne_ldax        ; $BF  LDA absl,X
                                        ;
   4851 CE78 58                                   .byte mne_cpyx        ; $C0  CPY #
   4852 CE79 35                                   .byte mne_cmpx        ; $C1  CMP (dp,X)
   4853 CE7A 31                                   .byte mne_repx        ; $C2  REP #
   4854 CE7B 35                                   .byte mne_cmpx        ; $C3  CMP offset,S
   4855 CE7C 58                                   .byte mne_cpyx        ; $C4  CPY dp
   4856 CE7D 35                                   .byte mne_cmpx        ; $C5  CMP dp
   4857 CE7E 12                                   .byte mne_decx        ; $C6  DEC dp
   4858 CE7F 35                                   .byte mne_cmpx        ; $C7  CMP [dp]
   4859 CE80 57                                   .byte mne_inyx        ; $C8  INY
   4860 CE81 35                                   .byte mne_cmpx        ; $C9  CMP #
   4861 CE82 4A                                   .byte mne_dexx        ; $CA  DEX
   4862 CE83 20                                   .byte mne_waix        ; $CB  WAI
   4863 CE84 58                                   .byte mne_cpyx        ; $CC  CPY abs
   4864 CE85 35                                   .byte mne_cmpx        ; $CD  CMP abs
   4865 CE86 12                                   .byte mne_decx        ; $CE  DEC abs
   4866 CE87 35                                   .byte mne_cmpx        ; $CF  CMP absl
                                        ;
   4868 CE88 1F                                   .byte mne_bnex        ; $D0  BNE abs
   4869 CE89 35                                   .byte mne_cmpx        ; $D1  CMP (dp),Y
   4870 CE8A 35                                   .byte mne_cmpx        ; $D2  CMP (dp)
   4871 CE8B 35                                   .byte mne_cmpx        ; $D3  CMP (offset,S),Y
   4872 CE8C 21                                   .byte mne_peix        ; $D4  PEI dp
   4873 CE8D 35                                   .byte mne_cmpx        ; $D5  CMP dp,X
   4874 CE8E 12                                   .byte mne_decx        ; $D6  DEC dp,X
   4875 CE8F 35                                   .byte mne_cmpx        ; $D7  CMP [dp],Y
   4876 CE90 1B                                   .byte mne_cldx        ; $D8  CLD
   4877 CE91 35                                   .byte mne_cmpx        ; $D9  CMP abs,Y
   4878 CE92 4B                                   .byte mne_phxx        ; $DA  PHX
   4879 CE93 39                                   .byte mne_stpx        ; $DB  STP
   4880 CE94 36                                   .byte mne_jmpx        ; $DC  JMP [abs]
   4881 CE95 35                                   .byte mne_cmpx        ; $DD  CMP abs,X
   4882 CE96 12                                   .byte mne_decx        ; $DE  DEC abs,X
   4883 CE97 35                                   .byte mne_cmpx        ; $DF  CMP absl,X
                                        ;
   4885 CE98 4E                                   .byte mne_cpxx        ; $E0  CPX #
   4886 CE99 0E                                   .byte mne_sbcx        ; $E1  SBC (dp,X)
   4887 CE9A 32                                   .byte mne_sepx        ; $E2  SEP #
   4888 CE9B 0E                                   .byte mne_sbcx        ; $E3  SBC offset,S
   4889 CE9C 4E                                   .byte mne_cpxx        ; $E4  CPX dp
   4890 CE9D 0E                                   .byte mne_sbcx        ; $E5  SBC dp
   4891 CE9E 15                                   .byte mne_incx        ; $E6  INC dp
   4892 CE9F 0E                                   .byte mne_sbcx        ; $E7  SBC [dp]
   4893 CEA0 4D                                   .byte mne_inxx        ; $E8  INX
   4894 CEA1 0E                                   .byte mne_sbcx        ; $E9  SBC #
   4895 CEA2 38                                   .byte mne_nopx        ; $EA  NOP
   4896 CEA3 00                                   .byte mne_xbax        ; $EB  XBA
   4897 CEA4 4E                                   .byte mne_cpxx        ; $EC  CPX abs
   4898 CEA5 0E                                   .byte mne_sbcx        ; $ED  SBC abs
   4899 CEA6 15                                   .byte mne_incx        ; $EE  INC abs
   4900 CEA7 0E                                   .byte mne_sbcx        ; $EF  SBC absl
                                        ;
   4902 CEA8 3B                                   .byte mne_beqx        ; $F0  BEQ abs
   4903 CEA9 0E                                   .byte mne_sbcx        ; $F1  SBC (dp),Y
   4904 CEAA 0E                                   .byte mne_sbcx        ; $F2  SBC (dp)
   4905 CEAB 0E                                   .byte mne_sbcx        ; $F3  SBC (offset,S),Y
   4906 CEAC 02                                   .byte mne_peax        ; $F4  PEA #
   4907 CEAD 0E                                   .byte mne_sbcx        ; $F5  SBC dp,X
   4908 CEAE 15                                   .byte mne_incx        ; $F6  INC dp,X
   4909 CEAF 0E                                   .byte mne_sbcx        ; $F7  SBC [dp],Y
   4910 CEB0 19                                   .byte mne_sedx        ; $F8  SED
   4911 CEB1 0E                                   .byte mne_sbcx        ; $F9  SBC abs,Y
   4912 CEB2 4C                                   .byte mne_plxx        ; $FA  PLX
   4913 CEB3 1E                                   .byte mne_xcex        ; $FB  XCE
   4914 CEB4 3F                                   .byte mne_jsrx        ; $FC  JSR (abs,X)
   4915 CEB5 0E                                   .byte mne_sbcx        ; $FD  SBC abs,X
   4916 CEB6 15                                   .byte mne_incx        ; $FE  INC abs,X
   4917 CEB7 0E                                   .byte mne_sbcx        ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	instruction addressing modes & sizes in opcode order...
                                        ;
                                        ;	    xxxxxxxx
                                        ;	    ||||||||
                                        ;	    ||||++++———> Addressing Mode
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||          0000  dp, abs, absl, implied or A
                                        ;	    ||||          0001  #
                                        ;	    ||||          0010  dp,X, abs,X or absl,X
                                        ;	    ||||          0011  dp,Y or abs,Y
                                        ;	    ||||          0100  (dp) or (abs)
                                        ;	    ||||          0101  [dp] or [abs]
                                        ;	    ||||          0110  [dp],Y
                                        ;	    ||||          0111  (dp,X) or (abs,X)
                                        ;	    ||||          1000  (dp),Y
                                        ;	    ||||          1001  offset,S
                                        ;	    ||||          1010  (offset,S),Y
                                        ;	    ||||          1011  sbnk,dbnk (MVN or MVP)
                                        ;	    ||||          —-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—
                                        ;	    ||||           #    = immediate
                                        ;	    ||||           A    = accumulator
                                        ;	    ||||           abs  = absolute
                                        ;	    ||||           absl = absolute long
                                        ;	    ||||           dbnk = destination bank
                                        ;	    ||||           dp   = direct (zero) page
                                        ;	    ||||           S    = stack relative
                                        ;	    ||||           sbnk = source bank
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||
                                        ;	    ||++———————> binary-encoded operand size
                                        ;	    |+—————————> 1: relative branch instruction
                                        ;	    +——————————> 1: variable operand size...
                                        ;
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;	    Variable operand size refers to an immediate mode instruction
                                        ;	    that can accept either an 8 or 16 bit operand.  During instr-
                                        ;	    uction assembly, an 8 bit operand can be forced to 16 bits by
                                        ;	    preceding the operand field with !,  e.g.,  LDA !#$01,  which
                                        ;	    will assemble as $A9 $01 $00.
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;
   4961 CEB8 00                         mnetabam .byte ops0 | am_nam   ; $00  BRK
   4962 CEB9 17                                   .byte ops1 | am_indx  ; $01  ORA (dp,X)
   4963 CEBA 10                                   .byte ops1 | am_nam   ; $02  COP
   4964 CEBB 19                                   .byte ops1 | am_stk   ; $03  ORA offset,S
   4965 CEBC 10                                   .byte ops1 | am_nam   ; $04  TSB dp
   4966 CEBD 10                                   .byte ops1 | am_nam   ; $05  ORA dp
   4967 CEBE 10                                   .byte ops1 | am_nam   ; $06  ASL dp
   4968 CEBF 15                                   .byte ops1 | am_indl  ; $07  ORA [dp]
   4969 CEC0 00                                   .byte ops0 | am_nam   ; $08  PHP
   4970 CEC1 91                                   .byte vops | am_imm   ; $09  ORA #
   4971 CEC2 00                                   .byte ops0 | am_nam   ; $0A  ASL A
   4972 CEC3 00                                   .byte ops0 | am_nam   ; $0B  PHD
   4973 CEC4 20                                   .byte ops2 | am_nam   ; $0C  TSB abs
   4974 CEC5 20                                   .byte ops2 | am_nam   ; $0D  ORA abs
   4975 CEC6 20                                   .byte ops2 | am_nam   ; $0E  ASL abs
   4976 CEC7 30                                   .byte ops3 | am_nam   ; $0F  ORA absl
                                        ;
   4978 CEC8 50                                   .byte bop1 | am_nam   ; $10  BPL abs
   4979 CEC9 18                                   .byte ops1 | am_indy  ; $11  ORA (dp),Y
   4980 CECA 14                                   .byte ops1 | am_ind   ; $12  ORA (dp)
   4981 CECB 1A                                   .byte ops1 | am_stky  ; $13  ORA (offset,S),Y
   4982 CECC 10                                   .byte ops1 | am_nam   ; $14  TRB dp
   4983 CECD 12                                   .byte ops1 | am_adrx  ; $15  ORA dp,X
   4984 CECE 12                                   .byte ops1 | am_adrx  ; $16  ASL dp,X
   4985 CECF 16                                   .byte ops1 | am_indly ; $17  ORA [dp],Y
   4986 CED0 00                                   .byte ops0 | am_nam   ; $18  CLC
   4987 CED1 20                                   .byte ops2 | am_nam   ; $19  ORA abs
   4988 CED2 00                                   .byte ops0 | am_nam   ; $1A  INC A
   4989 CED3 00                                   .byte ops0 | am_nam   ; $1B  TCS
   4990 CED4 20                                   .byte ops2 | am_nam   ; $1C  TRB abs
   4991 CED5 22                                   .byte ops2 | am_adrx  ; $1D  ORA abs,X
   4992 CED6 22                                   .byte ops2 | am_adrx  ; $1E  ASL abs,X
   4993 CED7 32                                   .byte ops3 | am_adrx  ; $1F  ORA absl,X
                                        ;
   4995 CED8 20                                   .byte ops2 | am_nam   ; $20  JSR abs
   4996 CED9 17                                   .byte ops1 | am_indx  ; $21  AND (dp,X)
   4997 CEDA 30                                   .byte ops3 | am_nam   ; $22  JSL absl
   4998 CEDB 19                                   .byte ops1 | am_stk   ; $23  AND offset,S
   4999 CEDC 10                                   .byte ops1 | am_nam   ; $24  BIT dp
   5000 CEDD 10                                   .byte ops1 | am_nam   ; $25  AND dp
   5001 CEDE 10                                   .byte ops1 | am_nam   ; $26  ROL dp
   5002 CEDF 15                                   .byte ops1 | am_indl  ; $27  AND [dp]
   5003 CEE0 00                                   .byte ops0 | am_nam   ; $28  PLP
   5004 CEE1 91                                   .byte vops | am_imm   ; $29  AND #
   5005 CEE2 00                                   .byte ops0 | am_nam   ; $2A  ROL A
   5006 CEE3 00                                   .byte ops0 | am_nam   ; $2B  PLD
   5007 CEE4 20                                   .byte ops2 | am_nam   ; $2C  BIT abs
   5008 CEE5 20                                   .byte ops2 | am_nam   ; $2D  AND abs
   5009 CEE6 20                                   .byte ops2 | am_nam   ; $2E  ROL abs
   5010 CEE7 30                                   .byte ops3 | am_nam   ; $2F  AND absl
                                        ;
   5012 CEE8 50                                   .byte bop1 | am_nam   ; $30  BMI abs
   5013 CEE9 18                                   .byte ops1 | am_indy  ; $31  AND (dp),Y
   5014 CEEA 14                                   .byte ops1 | am_ind   ; $32  AND (dp)
   5015 CEEB 1A                                   .byte ops1 | am_stky  ; $33  AND (offset,S),Y
   5016 CEEC 12                                   .byte ops1 | am_adrx  ; $34  BIT dp,X
   5017 CEED 12                                   .byte ops1 | am_adrx  ; $35  AND dp,X
   5018 CEEE 12                                   .byte ops1 | am_adrx  ; $36  ROL dp,X
   5019 CEEF 16                                   .byte ops1 | am_indly ; $37  AND [dp],Y
   5020 CEF0 00                                   .byte ops0 | am_nam   ; $38  SEC
   5021 CEF1 23                                   .byte ops2 | am_adry  ; $39  AND abs,Y
   5022 CEF2 00                                   .byte ops0 | am_nam   ; $3A  DEC A
   5023 CEF3 00                                   .byte ops0 | am_nam   ; $3B  TSC
   5024 CEF4 22                                   .byte ops2 | am_adrx  ; $3C  BIT abs,X
   5025 CEF5 22                                   .byte ops2 | am_adrx  ; $3D  AND abs,X
   5026 CEF6 22                                   .byte ops2 | am_adrx  ; $3E  ROL abs,X
   5027 CEF7 32                                   .byte ops3 | am_adrx  ; $3F  AND absl,X
                                        ;
   5029 CEF8 00                                   .byte ops0 | am_nam   ; $40  RTI
   5030 CEF9 17                                   .byte ops1 | am_indx  ; $41  EOR (dp,X)
   5031 CEFA 00                                   .byte ops0 | am_nam   ; $42  WDM
   5032 CEFB 19                                   .byte ops1 | am_stk   ; $43  EOR offset,S
   5033 CEFC 2B                                   .byte ops2 | am_move  ; $44  MVP sb,db
   5034 CEFD 10                                   .byte ops1 | am_nam   ; $45  EOR dp
   5035 CEFE 10                                   .byte ops1 | am_nam   ; $46  LSR dp
   5036 CEFF 15                                   .byte ops1 | am_indl  ; $47  EOR [dp]
   5037 CF00 00                                   .byte ops0 | am_nam   ; $48  PHA
   5038 CF01 91                                   .byte vops | am_imm   ; $49  EOR #
   5039 CF02 00                                   .byte ops0 | am_nam   ; $4A  LSR A
   5040 CF03 00                                   .byte ops0 | am_nam   ; $4B  PHK
   5041 CF04 20                                   .byte ops2 | am_nam   ; $4C  JMP abs
   5042 CF05 20                                   .byte ops2 | am_nam   ; $4D  EOR abs
   5043 CF06 20                                   .byte ops2 | am_nam   ; $4E  LSR abs
   5044 CF07 30                                   .byte ops3 | am_nam   ; $4F  EOR absl
                                        ;
   5046 CF08 50                                   .byte bop1 | am_nam   ; $50  BVC abs
   5047 CF09 18                                   .byte ops1 | am_indy  ; $51  EOR (dp),Y
   5048 CF0A 14                                   .byte ops1 | am_ind   ; $52  EOR (dp)
   5049 CF0B 1A                                   .byte ops1 | am_stky  ; $53  EOR (offset,S),Y
   5050 CF0C 2B                                   .byte ops2 | am_move  ; $54  MVN sb,db
   5051 CF0D 12                                   .byte ops1 | am_adrx  ; $55  EOR dp,X
   5052 CF0E 12                                   .byte ops1 | am_adrx  ; $56  LSR dp,X
   5053 CF0F 16                                   .byte ops1 | am_indly ; $57  EOR [dp],Y
   5054 CF10 00                                   .byte ops0 | am_nam   ; $58  CLI
   5055 CF11 23                                   .byte ops2 | am_adry  ; $59  EOR abs,Y
   5056 CF12 00                                   .byte ops0 | am_nam   ; $5A  PHY
   5057 CF13 00                                   .byte ops0 | am_nam   ; $5B  TCD
   5058 CF14 30                                   .byte ops3 | am_nam   ; $5C  JML absl
   5059 CF15 22                                   .byte ops2 | am_adrx  ; $5D  EOR abs,X
   5060 CF16 22                                   .byte ops2 | am_adrx  ; $5E  LSR abs,X
   5061 CF17 32                                   .byte ops3 | am_adrx  ; $5F  EOR absl,X
                                        ;
   5063 CF18 00                                   .byte ops0 | am_nam   ; $60  RTS
   5064 CF19 17                                   .byte ops1 | am_indx  ; $61  ADC (dp,X)
   5065 CF1A 60                                   .byte bop2 | am_nam   ; $62  PER
   5066 CF1B 19                                   .byte ops1 | am_stk   ; $63  ADC offset,S
   5067 CF1C 10                                   .byte ops1 | am_nam   ; $64  STZ dp
   5068 CF1D 10                                   .byte ops1 | am_nam   ; $65  ADC dp
   5069 CF1E 10                                   .byte ops1 | am_nam   ; $66  ROR dp
   5070 CF1F 15                                   .byte ops1 | am_indl  ; $67  ADC [dp]
   5071 CF20 00                                   .byte ops0 | am_nam   ; $68  PLA
   5072 CF21 91                                   .byte vops | am_imm   ; $69  ADC #
   5073 CF22 00                                   .byte ops0 | am_nam   ; $6A  ROR A
   5074 CF23 00                                   .byte ops0 | am_nam   ; $6B  RTL
   5075 CF24 24                                   .byte ops2 | am_ind   ; $6C  JMP (abs)
   5076 CF25 20                                   .byte ops2 | am_nam   ; $6D  ADC abs
   5077 CF26 20                                   .byte ops2 | am_nam   ; $6E  ROR abs
   5078 CF27 30                                   .byte ops3 | am_nam   ; $6F  ADC absl
                                        ;
   5080 CF28 50                                   .byte bop1 | am_nam   ; $70  BVS abs
   5081 CF29 18                                   .byte ops1 | am_indy  ; $71  ADC (dp),Y
   5082 CF2A 14                                   .byte ops1 | am_ind   ; $72  ADC (dp)
   5083 CF2B 1A                                   .byte ops1 | am_stky  ; $73  ADC (offset,S),Y
   5084 CF2C 12                                   .byte ops1 | am_adrx  ; $74  STZ dp,X
   5085 CF2D 12                                   .byte ops1 | am_adrx  ; $75  ADC dp,X
   5086 CF2E 12                                   .byte ops1 | am_adrx  ; $76  ROR dp,X
   5087 CF2F 16                                   .byte ops1 | am_indly ; $77  ADC [dp],Y
   5088 CF30 00                                   .byte ops0 | am_nam   ; $78  SEI
   5089 CF31 23                                   .byte ops2 | am_adry  ; $79  ADC abs,Y
   5090 CF32 00                                   .byte ops0 | am_nam   ; $7A  PLY
   5091 CF33 00                                   .byte ops0 | am_nam   ; $7B  TDC
   5092 CF34 27                                   .byte ops2 | am_indx  ; $7C  JMP (abs,X)
   5093 CF35 22                                   .byte ops2 | am_adrx  ; $7D  ADC abs,X
   5094 CF36 22                                   .byte ops2 | am_adrx  ; $7E  ROR abs,X
   5095 CF37 32                                   .byte ops3 | am_adrx  ; $7F  ADC absl,X
                                        ;
   5097 CF38 50                                   .byte bop1 | am_nam   ; $80  BRA abs
   5098 CF39 17                                   .byte ops1 | am_indx  ; $81  STA (dp,X)
   5099 CF3A 60                                   .byte bop2 | am_nam   ; $82  BRL abs
   5100 CF3B 19                                   .byte ops1 | am_stk   ; $83  STA offset,S
   5101 CF3C 10                                   .byte ops1 | am_nam   ; $84  STY dp
   5102 CF3D 10                                   .byte ops1 | am_nam   ; $85  STA dp
   5103 CF3E 10                                   .byte ops1 | am_nam   ; $86  STX dp
   5104 CF3F 15                                   .byte ops1 | am_indl  ; $87  STA [dp]
   5105 CF40 00                                   .byte ops0 | am_nam   ; $88  DEY
   5106 CF41 91                                   .byte vops | am_imm   ; $89  BIT #
   5107 CF42 00                                   .byte ops0 | am_nam   ; $8A  TXA
   5108 CF43 00                                   .byte ops0 | am_nam   ; $8B  PHB
   5109 CF44 20                                   .byte ops2 | am_nam   ; $8C  STY abs
   5110 CF45 20                                   .byte ops2 | am_nam   ; $8D  STA abs
   5111 CF46 20                                   .byte ops2 | am_nam   ; $8E  STX abs
   5112 CF47 30                                   .byte ops3 | am_nam   ; $8F  STA absl
                                        ;
   5114 CF48 50                                   .byte bop1 | am_nam   ; $90  BCC abs
   5115 CF49 18                                   .byte ops1 | am_indy  ; $91  STA (dp),Y
   5116 CF4A 14                                   .byte ops1 | am_ind   ; $92  STA (dp)
   5117 CF4B 1A                                   .byte ops1 | am_stky  ; $93  STA (offset,S),Y
   5118 CF4C 12                                   .byte ops1 | am_adrx  ; $94  STY dp,X
   5119 CF4D 12                                   .byte ops1 | am_adrx  ; $95  STA dp,X
   5120 CF4E 13                                   .byte ops1 | am_adry  ; $96  STX dp,Y
   5121 CF4F 16                                   .byte ops1 | am_indly ; $97  STA [dp],Y
   5122 CF50 00                                   .byte ops0 | am_nam   ; $98  TYA
   5123 CF51 23                                   .byte ops2 | am_adry  ; $99  STA abs,Y
   5124 CF52 00                                   .byte ops0 | am_nam   ; $9A  TXS
   5125 CF53 00                                   .byte ops0 | am_nam   ; $9B  TXY
   5126 CF54 20                                   .byte ops2 | am_nam   ; $9C  STZ abs
   5127 CF55 22                                   .byte ops2 | am_adrx  ; $9D  STA abs,X
   5128 CF56 22                                   .byte ops2 | am_adrx  ; $9E  STZ abs,X
   5129 CF57 32                                   .byte ops3 | am_adrx  ; $9F  STA absl,X
                                        ;
   5131 CF58 91                                   .byte vops | am_imm   ; $A0  LDY #
   5132 CF59 17                                   .byte ops1 | am_indx  ; $A1  LDA (dp,X)
   5133 CF5A 91                                   .byte vops | am_imm   ; $A2  LDX #
   5134 CF5B 19                                   .byte ops1 | am_stk   ; $A3  LDA offset,S
   5135 CF5C 10                                   .byte ops1 | am_nam   ; $A4  LDY dp
   5136 CF5D 10                                   .byte ops1 | am_nam   ; $A5  LDA dp
   5137 CF5E 10                                   .byte ops1 | am_nam   ; $A6  LDX dp
   5138 CF5F 15                                   .byte ops1 | am_indl  ; $A7  LDA [dp]
   5139 CF60 00                                   .byte ops0 | am_nam   ; $A8  TAY
   5140 CF61 91                                   .byte vops | am_imm   ; $A9  LDA #
   5141 CF62 00                                   .byte ops0 | am_nam   ; $AA  TAX
   5142 CF63 00                                   .byte ops0 | am_nam   ; $AB  PLB
   5143 CF64 20                                   .byte ops2 | am_nam   ; $AC  LDY abs
   5144 CF65 20                                   .byte ops2 | am_nam   ; $AD  LDA abs
   5145 CF66 20                                   .byte ops2 | am_nam   ; $AE  LDX abs
   5146 CF67 30                                   .byte ops3 | am_nam   ; $AF  LDA absl
                                        ;
   5148 CF68 50                                   .byte bop1 | am_nam   ; $B0  BCS abs
   5149 CF69 18                                   .byte ops1 | am_indy  ; $B1  LDA (dp),Y
   5150 CF6A 14                                   .byte ops1 | am_ind   ; $B2  LDA (dp)
   5151 CF6B 1A                                   .byte ops1 | am_stky  ; $B3  LDA (offset,S),Y
   5152 CF6C 12                                   .byte ops1 | am_adrx  ; $B4  LDY dp,X
   5153 CF6D 12                                   .byte ops1 | am_adrx  ; $B5  LDA dp,X
   5154 CF6E 13                                   .byte ops1 | am_adry  ; $B6  LDX dp,Y
   5155 CF6F 16                                   .byte ops1 | am_indly ; $B7  LDA [dp],Y
   5156 CF70 00                                   .byte ops0 | am_nam   ; $B8  CLV
   5157 CF71 23                                   .byte ops2 | am_adry  ; $B9  LDA abs,Y
   5158 CF72 00                                   .byte ops0 | am_nam   ; $BA  TSX
   5159 CF73 00                                   .byte ops0 | am_nam   ; $BB  TYX
   5160 CF74 22                                   .byte ops2 | am_adrx  ; $BC  LDY abs,X
   5161 CF75 22                                   .byte ops2 | am_adrx  ; $BD  LDA abs,X
   5162 CF76 23                                   .byte ops2 | am_adry  ; $BE  LDX abs,Y
   5163 CF77 32                                   .byte ops3 | am_adrx  ; $BF  LDA absl,X
                                        ;
   5165 CF78 91                                   .byte vops | am_imm   ; $C0  CPY #
   5166 CF79 17                                   .byte ops1 | am_indx  ; $C1  CMP (dp,X)
   5167 CF7A 11                                   .byte ops1 | am_imm   ; $C2  REP #
   5168 CF7B 19                                   .byte ops1 | am_stk   ; $C3  CMP offset,S
   5169 CF7C 10                                   .byte ops1 | am_nam   ; $C4  CPY dp
   5170 CF7D 10                                   .byte ops1 | am_nam   ; $C5  CMP dp
   5171 CF7E 10                                   .byte ops1 | am_nam   ; $C6  DEC dp
   5172 CF7F 15                                   .byte ops1 | am_indl  ; $C7  CMP [dp]
   5173 CF80 00                                   .byte ops0 | am_nam   ; $C8  INY
   5174 CF81 91                                   .byte vops | am_imm   ; $C9  CMP #
   5175 CF82 00                                   .byte ops0 | am_nam   ; $CA  DEX
   5176 CF83 00                                   .byte ops0 | am_nam   ; $CB  WAI
   5177 CF84 20                                   .byte ops2 | am_nam   ; $CC  CPY abs
   5178 CF85 20                                   .byte ops2 | am_nam   ; $CD  CMP abs
   5179 CF86 20                                   .byte ops2 | am_nam   ; $CE  DEC abs
   5180 CF87 30                                   .byte ops3 | am_nam   ; $CF  CMP absl
                                        ;
   5182 CF88 50                                   .byte bop1 | am_nam   ; $D0  BNE abs
   5183 CF89 18                                   .byte ops1 | am_indy  ; $D1  CMP (dp),Y
   5184 CF8A 14                                   .byte ops1 | am_ind   ; $D2  CMP (dp)
   5185 CF8B 1A                                   .byte ops1 | am_stky  ; $D3  CMP (offset,S),Y
   5186 CF8C 10                                   .byte ops1 | am_nam   ; $D4  PEI dp
   5187 CF8D 12                                   .byte ops1 | am_adrx  ; $D5  CMP dp,X
   5188 CF8E 12                                   .byte ops1 | am_adrx  ; $D6  DEC dp,X
   5189 CF8F 16                                   .byte ops1 | am_indly ; $D7  CMP [dp],Y
   5190 CF90 00                                   .byte ops0 | am_nam   ; $D8  CLD
   5191 CF91 23                                   .byte ops2 | am_adry  ; $D9  CMP abs,Y
   5192 CF92 00                                   .byte ops0 | am_nam   ; $DA  PHX
   5193 CF93 00                                   .byte ops0 | am_nam   ; $DB  STP
   5194 CF94 25                                   .byte ops2 | am_indl  ; $DC  JMP [abs]
   5195 CF95 22                                   .byte ops2 | am_adrx  ; $DD  CMP abs,X
   5196 CF96 22                                   .byte ops2 | am_adrx  ; $DE  DEC abs,X
   5197 CF97 32                                   .byte ops3 | am_adrx  ; $DF  CMP absl,X
                                        ;
   5199 CF98 91                                   .byte vops | am_imm   ; $E0  CPX #
   5200 CF99 17                                   .byte ops1 | am_indx  ; $E1  SBC (dp,X)
   5201 CF9A 11                                   .byte ops1 | am_imm   ; $E2  SEP #
   5202 CF9B 19                                   .byte ops1 | am_stk   ; $E3  SBC offset,S
   5203 CF9C 10                                   .byte ops1 | am_nam   ; $E4  CPX dp
   5204 CF9D 10                                   .byte ops1 | am_nam   ; $E5  SBC dp
   5205 CF9E 10                                   .byte ops1 | am_nam   ; $E6  INC dp
   5206 CF9F 15                                   .byte ops1 | am_indl  ; $E7  SBC [dp]
   5207 CFA0 00                                   .byte ops0 | am_nam   ; $E8  INX
   5208 CFA1 91                                   .byte vops | am_imm   ; $E9  SBC #
   5209 CFA2 00                                   .byte ops0 | am_nam   ; $EA  NOP
   5210 CFA3 00                                   .byte ops0 | am_nam   ; $EB  XBA
   5211 CFA4 20                                   .byte ops2 | am_nam   ; $EC  CPX abs
   5212 CFA5 20                                   .byte ops2 | am_nam   ; $ED  SBC abs
   5213 CFA6 20                                   .byte ops2 | am_nam   ; $EE  INC abs
   5214 CFA7 30                                   .byte ops3 | am_nam   ; $EF  SBC absl
                                        ;
   5216 CFA8 50                                   .byte bop1 | am_nam   ; $F0  BEQ abs
   5217 CFA9 18                                   .byte ops1 | am_indy  ; $F1  SBC (dp),Y
   5218 CFAA 14                                   .byte ops1 | am_ind   ; $F2  SBC (dp)
   5219 CFAB 1A                                   .byte ops1 | am_stky  ; $F3  SBC (offset,S),Y
   5220 CFAC 21                                   .byte ops2 | am_imm   ; $F4  PEA #
   5221 CFAD 12                                   .byte ops1 | am_adrx  ; $F5  SBC dp,X
   5222 CFAE 12                                   .byte ops1 | am_adrx  ; $F6  INC dp,X
   5223 CFAF 16                                   .byte ops1 | am_indly ; $F7  SBC [dp],Y
   5224 CFB0 00                                   .byte ops0 | am_nam   ; $F8  SED
   5225 CFB1 23                                   .byte ops2 | am_adry  ; $F9  SBC abs,Y
   5226 CFB2 00                                   .byte ops0 | am_nam   ; $FA  PLX
   5227 CFB3 00                                   .byte ops0 | am_nam   ; $FB  XCE
   5228 CFB4 27                                   .byte ops2 | am_indx  ; $FC  JSR (abs,X)
   5229 CFB5 22                                   .byte ops2 | am_adrx  ; $FD  SBC abs,X
   5230 CFB6 22                                   .byte ops2 | am_adrx  ; $FE  INC abs,X
   5231 CFB7 32                                   .byte ops3 | am_adrx  ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	.X & .Y immediate mode opcodes...
                                        ;
   5236 CFB8 A0                         vopidx   .byte $a0             ;LDY #
   5237 CFB9 A2                                   .byte $a2             ;LDX #
   5238 CFBA C0                                   .byte $c0             ;CPY #
   5239 CFBB E0                                   .byte $e0             ;CPX #
   5466 = 00000004                      n_vopidx =*-vopidx             ;number of opcodes
                                        ;
                                        ;
                                        ;	addressing mode symbology lookup...
                                        ;
   5245 CFBC D4 CF                      ms_lutab .word ms_nam          ;(0000)  no symbol
   5246 CFBE DE CF                                .word ms_imm          ;(0001)  #
   5247 CFC0 D6 CF                                .word ms_addrx        ;(0010)  dp,X or abs,X
   5248 CFC2 DA CF                                .word ms_addry        ;(0011)  dp,Y or abs,Y
   5249 CFC4 E0 CF                                .word ms_ind          ;(0100)  (dp) or (abs)
   5250 CFC6 E3 CF                                .word ms_indl         ;(0101)  [dp] or [abs]
   5251 CFC8 E6 CF                                .word ms_indly        ;(0110)  [dp],Y
   5252 CFCA EB CF                                .word ms_indx         ;(0111)  (dp,X) or (abs,X)
   5253 CFCC F0 CF                                .word ms_indy         ;(1000)  (dp),Y
   5254 CFCE F8 CF                                .word ms_stk          ;(1001)  offset,S
   5255 CFD0 FC CF                                .word ms_stky         ;(1010) (offset,S),Y
   5256 CFD2 D4 CF                                .word ms_nam          ;(1011) sbnk,dbnk
                                        ;
                                        ;
                                        ;	addressing mode symbology strings...
                                        ;
   5261 CFD4 20 00                      ms_nam   .byte " ",0           ;no symbol
   5262 CFD6 20 2C 58 00                ms_addrx .byte " ,X",0         ;dp,X or addr,X
   5263 CFDA 20 2C 59 00                ms_addry .byte " ,Y",0         ;dp,Y or addr,Y
   5264 CFDE 23 00                      ms_imm   .byte "#",0           ;immediate
   5265 CFE0 28 29 00                   ms_ind   .byte "()",0          ;(dp) or (abs)
   5266 CFE3 5B 5D 00                   ms_indl  .byte "[]",0          ;[dp] or [abs]
   5267 CFE6 5B 5D 2C 59 00             ms_indly .byte "[],Y",0        ;[dp],Y
   5268 CFEB 28 2C 58 29 00             ms_indx  .byte "(,X)",0        ;(dp,X) or (abs,X)
   5269 CFF0 28 29 2C 59 00             ms_indy  .byte "(),Y",0        ;(dp),Y
   5270 CFF5 2C 24 00                   ms_move  .byte ",$",0          ;MVN/MVP sbnk,dbnk
   5271 CFF8 20 2C 53 00                ms_stk   .byte " ,S",0         ;offset,S
   5272 CFFC 28 2C 53 29 2C 59 00       ms_stky  .byte "(,S),Y",0      ;(offset,S),Y
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL STRINGS
                                        ;
   5278 D003 1B 28                      dc_bf +         .byte a_esc,"("
   5278 D005 1B 47 34                 +            .byte a_esc,"G4"

                                                            ;enable reverse foreground
   5279 D008 00                                   .byte 0
                                        ;
   5281 D009 08                         dc_bs +         .byte a_bs
   5281 D00A 1B 57                    +   +         .byte a_esc,"W"

                                        

                                                            ;destructive backspace
   5283 D00C 00                                   .byte 0
                                        ;
   5285 D00D 1B 54                      dc_cl +         .byte a_esc,"T"

                                                            ;clear to end of line 
   5286 D00F 00                                   .byte 0
                                        ;
   5288 D010 1B 60 31                   dc_cn +         .byte a_esc,"`1"

                                                            ;cursor on
   5289 D013 00                                   .byte 0
                                        ;
   5291 D014 1B 60 30                   dc_co +         .byte a_esc,"`0"

                                                            ;cursor off
   5292 D017 00                                   .byte 0
                                        ;
   5294 D018 1B 28                      dc_er +         .byte a_esc,"("
   5294 D01A 1B 47 30                 +            .byte a_esc,"G0"

                                                            ;enable normal foreground
   5295 D01D 00                                   .byte 0
                                        ;
   5297 D01E 0D                         dc_lf ++         .byte a_cr

                                     +   
   5297 D01F 0A                       +            .byte a_lf

                                                            ;newline
   5298 D020 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;TEXT STRINGS
                                        ;
   5304 D021 07                         mm_brk +         .byte a_bel

                                        
   5305 D022 0D                       +   +         .byte a_cr

                                     +   
   5305 D023 0A                       +            .byte a_lf

                                        
   5306 D024 2A 2A 42 52 4B                       .byte "**BRK"
   5307 D029 0D                       +   +         .byte a_cr

                                     +   
   5307 D02A 0A                       +            .byte a_lf

                                        
   5308 D02B 00                                   .byte 0
                                        ;
   5310 D02C 0D                         mm_entry ++         .byte a_cr

                                     +   
   5310 D02D 0A                       +            .byte a_lf

                                        
   5311 D02E 0A 53 75 70 65 72 6D 6F              .byte a_lf,"Supermon 832 "
   5311 D036 6E 20 38 33 32 20         
   5312 D03C 31                       +            .byte "1"
   5312 D03D 2E                       +            .byte "."
   5312 D03E 30                       +            .byte "0"
   5312 D03F 2E                       +            .byte "."
   5312 D040 30                       +            .byte "0"

                                        
   5313 D041 20                                   .byte " "
   5314 D042 0D                       +   +         .byte a_cr

                                     +   
   5314 D043 0A                       +            .byte a_lf

                                        
   5315 D044 00                                   .byte 0
                                        ;
   5317 D045 20 2A 2A 45 52 52 20 20    mm_err   .byte " **ERR  ",0
   5317 D04D 00                        
                                        ;
   5319 D04E 0D                         mm_prmpt ++         .byte a_cr

                                     +   
   5319 D04F 0A                       +            .byte a_lf

                                        
   5320 D050 1B 28                    +            .byte a_esc,"("
   5320 D052 1B 47 30                 +            .byte a_esc,"G0"

                                        
   5321 D055 2E 00                                .byte ".",0
                                        ;
   5323 D057 0D                         mm_regs ++         .byte a_cr

                                     +   
   5323 D058 0A                       +            .byte a_lf

                                        
   5324 D059 20 20 20 20 20 20 20 20              .byte "                    31"
   5324 D061 20 20 20 20 20 20 20 20   
   5324 D069 20 20 20 20 33 31         
   5325 D06F 0D                       +   +         .byte a_cr

                                     +   
   5325 D070 0A                       +            .byte a_lf

                                        
   5326 D071 20 20 20 20 20 43 53 20              .byte "     CS    PB  PC   26NVmxDIZC    .A       .X       .Y       SP  "
   5326 D079 20 20 20 50 42 20 20 50   
   5326 D081 43 20 20 20 32 36 4E 56   
   5326 D089 6D 78 44 49 5A 43 20 20   
   5326 D091 20 20 2E 41 20 20 20 20   
   5326 D099 20 20 20 2E 58 20 20 20   
   5326 D0A1 20 20 20 20 2E 59 20 20   
   5326 D0A9 20 20 20 20 20 53 50 20   
   5326 D0B1 20                        
   5327 D0B2 0D                       +   +         .byte a_cr

                                     +   
   5327 D0B3 0A                       +            .byte a_lf

                                        
   5328 D0B4 3B 20 00                             .byte "; ",0
   5329 D0B7 0D                         mm_regs2 ++         .byte a_cr

                                     +   
   5329 D0B8 0A                       +            .byte a_lf

                                        
   5330 D0B9 20 20 20 20 20 44 53 20              .byte "     DS    DP  DB"
   5330 D0C1 20 20 20 44 50 20 20 44   
   5330 D0C9 42                        
   5331 D0CA 0D                       +   +         .byte a_cr

                                     +   
   5331 D0CB 0A                       +            .byte a_lf

                                        
   5332 D0CC 3B 20 00                             .byte "; ",0
                                        ;
   5334 D0CF 07                         mm_rts +         .byte a_bel

                                        
   5335 D0D0 0D                       +   +         .byte a_cr

                                     +   
   5335 D0D1 0A                       +            .byte a_lf

                                        
   5336 D0D2 2A 2A 52 54 53                       .byte "**RTS"
   5337 D0D7 0D                       +   +         .byte a_cr

                                     +   
   5337 D0D8 0A                       +            .byte a_lf

                                        
   5338 D0D9 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;VECTOR STORAGE
                                        ;
                                        ;
   5642 = 0000D0DA                      _txtend_ =*                     ;end of program text
                                        ;
                                        ;================================================================================
                                        	;.end
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
FTBios816.asm


                                        .include "supermon832.asm"
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
FAC1ToString.asm

                                        ; ============================================================================
                                        ; FAC1ToString.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014  Robert Finch, Stratford
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
                                        ; This code is a heavily modified version of the floating point to string
                                        ; conversion routine which is a part of Lee Davison's EhBASIC.
                                        ;
   5674 = 00000000000000C6                            Cvaral		= $C6		; current var address low byte
   5675 = 000000C7                      Cvarah		= Cvaral+1	; current var address high byte
   5676 = 00000000000000C0                            numexp		= $C0		; string to float number exponent count
   5677 = 00000000000000C2                            expcnt		= $C2		; string to float exponent count
   5678 = 00000000000000C4                            Sendl			= $C4	; BASIC pointer temp low byte
   5679 = 00000000000000C5                            Sendh			= $C5	; BASIC pointer temp low byte
                                        
   5681 = 00000000000003A0                            Decss		= $3A0		; number to decimal string start
   5682 = 000003A1                      Decssp1		= Decss+1	; number to decimal string start
   5683 = 0000000000000001                            FP_ADD		EQU		1
   5684 = 0000000000000002                            FP_SUB		EQU		2
   5685 = 0000000000000003                            FP_MUL		EQU		3
   5686 = 0000000000000004                            FP_DIV		EQU		4
   5687 = 0000000000000005                            FP_FIX2FLT	EQU		5
   5688 = 0000000000000006                            FP_FLT2FIX	EQU		6
   5689 = 0000000000000007                            FP_ABS		EQU		7
   5690 = 0000000000000010                            FP_NEG		EQU		16
   5691 = 0000000000000011                            FP_SWAP		EQU		17
   5692 = 0000000000000083                            FIXED_MUL	EQU		$83
   5693 = 0000000000000081                            FIXED_ADD	EQU		$81
   5694 = 0000000000000082                            FIXED_SUB	EQU		$82
                                        ;parameter FIXED_DIV = 8'h84;
                                        ;parameter FIXED_ABS = 8'h87;
                                        ;parameter FIXED_NEG = 8'h90;
   5698 = 0000000000FEA20E                            FP_CMDREG	EQU		$FEA20E
   5699 = 0000000000FEA20E                            FP_STATREG	EQU		$FEA20E
   5700 = 0000000000FEA200                            FAC1		EQU		$FEA200
   5701 = 0000000000FEA200                            FAC1_5		EQU		$FEA200
   5702 = 0000000000FEA202                            FAC1_4		EQU		$FEA202
   5703 = 0000000000FEA204                            FAC1_3		EQU		$FEA204
   5704 = 0000000000FEA206                            FAC1_2		EQU		$FEA206
   5705 = 0000000000FEA208                            FAC1_1		EQU		$FEA208
   5706 = 0000000000FEA208                            FAC1_msw	EQU		$FEA208
   5707 = 0000000000FEA20A                            FAC1_e		EQU		$FEA20A
   5708 = 0000000000FEA210                            FAC2		EQU		$FEA210
                                        
                                           	CPU		W65C816S
                                           	NDX		16
                                           	MEM		16
                                           	
                                           public FAC1ToString:
                                           
                                           ; The first chunk of code determines if the number is positive or negative
                                           ; and spits out the appropriate sign. Next it takes the absolute value of
                                           ; the accumulator so following code only has to deal with positive numbers.
                                           
   5423 00D0DA A0 00 00                     	LDY	#$00			; set index = 1
   5424 00D0DD AF 08 A2 FE                  	LDA	FAC1_msw		; test FAC1 sign (b15) (Can't use BIT)
   5425 00D0E1 10 0E                        	BPL	.0002		; branch if +ve
   5426 00D0E3 A9 2D 00                     	LDA	#'-'			; else character = "-"
   5427 00D0E6 99 A0 03                     	STA	Decss,Y		; save leading character (" " or "-")
   5428 00D0E9 A9 10 00                     	LDA	#FP_NEG		; make the FAC positive
   5429 00D0EC 20 13 D3                     	JSR	FPCommandWait
   5430 00D0EF 80 06                        	BRA	.0001
   5431 00D0F1                             .0002:
   5432 00D0F1 A9 20 00                     	LDA	#$20			; character = " " (assume +ve)
   5433 00D0F4 99 A0 03                     	STA	Decss,Y
   5434 00D0F7                             .0001:
   5435 00D0F7 84 C4                        	STY	Sendl			; save index
                                           
                                           ; This little bit of code check for a zero exponent which indicates a
                                           ; value of zero.
                                           
   5440 00D0F9 AF 0A A2 FE                  	LDA	FAC1_e		; get FAC1 exponent
   5441 00D0FD AA                           	TAX
   5442 00D0FE D0 06                        	BNE	LAB_2989		; branch if FAC1<>0
                                           					; exponent was $00 so FAC1 is 0
   5444 00D100 A9 30 00                     	LDA	#'0'			; set character = "0"
   5445 00D103 82 93 01                     	BRL	LAB_2A89		; save last character, [EOT] and exit
                                           
                                           ; This loop attempts to make small values more significant, so that there are
                                           ; fewer leading zeros in the value. (The exponent is decremented so that it
                                           ; corresponds). Because of the potential for extremely small values looping is
                                           ; limited. The problem is the 16 bit exponent can allow for much smaller
                                           ; values than an 8 bit exponent would and we don't want to loop for thousands
                                           ; of iterations in order to display a value that's almost zero.
                                           
                                           					; FAC1 is some non zero value
   5455 00D106                             LAB_2989
   5456 00D106 84 C4                        	STY	Sendl			; save off .Y
   5457 00D108 A0 67 06                     	LDY #1639			; max number of retries
   5458 00D10B A9 00 00                     	LDA	#$00			; clear (number exponent count)
   5459 00D10E 85 C0                        	STA numexp
   5460 00D110                             LOOP_MBMILLION:
   5461 00D110 E0 00 80                     	CPX	#$8000			; compare FAC1 exponent with $8000 (>1.00000)
   5462 00D113 B0 1A                        	BCS	LAB_299A		; branch if FAC1=>1
                                           					; FAC1<1
   5464 00D115 F4 62 D3                     	PEA	A_MILLION		; multiply FAC * 1,000,000
   5465 00D118 20 C8 D2                     	JSR	LOAD_FAC2		; 
   5466 00D11B 68                           	PLA					; get rid of parameter
   5467 00D11C 20 C2 D2                     	JSR	FMUL
   5468 00D11F A5 C0                        	LDA numexp
   5469 00D121 38                           	SEC
   5470 00D122 E9 06 00                     	SBC	#6				; set number exponent count (-6)
   5471 00D125 85 C0                        	STA numexp
   5472 00D127 AF 0A A2 FE                  	LDA FAC1_e
   5473 00D12B AA                           	TAX
   5474 00D12C 88                           	DEY
   5475 00D12D 10 E1                        	BPL	LOOP_MBMILLION
                                           
   5477 00D12F                             LAB_299A
   5478 00D12F A4 C4                        	LDY	Sendl		; get back .Y
                                           
                                           ; These two loops coerce the value of the FAC to be between 100,000 and
                                           ; 1,000,000. This gives a maximum of six digits before the decimal point
                                           ; in scientific notation.
                                           
                                           ; This loop divides by 10 until the value in the FAC is less than 1,000,000
                                           ;
   5486 00D131                             LOOP_DB10:
   5487 00D131 F4 7A D3                     	PEA	MAX_BEFORE_SCI	; set pointer low byte to 999999.4375 (max before sci note)
   5488 00D134 20 C8 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5489 00D137 68                           	PLA					; get rid of parameter
   5490 00D138 AF 0E A2 FE                  	LDA FP_CMDREG
   5491 00D13C 89 08 00                     	BIT	#$08			; test equals bit
   5492 00D13F D0 28                        	BNE	LAB_29C3		; exit if FAC1 = (AY)
   5493 00D141 89 04 00                     	BIT	#$04			; test greater than bit
   5494 00D144 F0 07                        	BEQ	LOOP_MB10		; go do *10 if FAC1 < (AY)
                                           
   5496 00D146                             LAB_29B9
   5497 00D146 20 00 D3                     	JSR	DivideByTen		; divide by 10
   5498 00D149 E6 C0                        	INC	numexp			; increment number exponent count
   5499 00D14B 80 E4                        	BRA	LOOP_DB10		; go test again (branch always)
                                           
                                           ; This loop multiplies the value by 10 until it's greater than
                                           ; 100,000.
                                           					; FAC1 < (AY)
   5504 00D14D                             LOOP_MB10
   5505 00D14D F4 92 D3                     	PEA CONST_9375		; set pointer to 99999.9375
   5506 00D150 20 C8 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5507 00D153 68                           	PLA					; get rid of parameter
   5508 00D154 AF 0E A2 FE                  	LDA FP_CMDREG
   5509 00D158 89 08 00                     	BIT #$08
   5510 00D15B D0 05                        	BNE	LAB_29B2		; branch if FAC1 = (AY) (allow decimal places)
   5511 00D15D 89 04 00                     	BIT #$04
   5512 00D160 D0 07                        	BNE	LAB_29C0		; branch if FAC1 > (AY) (no decimal places)
                                           					; FAC1 <= (AY)
   5514 00D162                             LAB_29B2
   5515 00D162 20 F3 D2                     	JSR	MultiplyByTen	; multiply by 10
   5516 00D165 C6 C0                        	DEC	numexp		; decrement number exponent count
   5517 00D167 80 E4                        	BRA	LOOP_MB10		; go test again (branch always)
                                           
                                           ; now we have just the digits to do
                                           
   5521 00D169                             LAB_29C0
                                           ;	JSR	AddPoint5		; add 0.5 to FAC1 (round FAC1)
   5523 00D169                             LAB_29C3
                                           ;	JSR	FloatToFixed	; convert FAC1 floating-to-fixed
   5525 00D169 A2 01 00                     	LDX	#$01			; set default digits before dp = 1
   5526 00D16C A5 C0                        	LDA	numexp		; get number exponent count
   5527 00D16E 18                           	CLC				; clear carry for add
   5528 00D16F 69 07 00                     	ADC	#$07			; up to 6 digits before point
   5529 00D172 30 0A                        	BMI	LAB_29D8		; if -ve then 1 digit before dp
                                           
   5531 00D174 C9 08 00                     	CMP	#$08			; A>=8 if n>=1E6
   5532 00D177 B0 06                        	BCS	LAB_29D9		; branch if >= $08
                                           
                                           					; carry is clear
   5535 00D179 AA                           	TAX				; copy to A
   5536 00D17A CA                           	DEX				; take 1 from digit count
   5537 00D17B A9 02 00                     	LDA	#$02			;.set exponent adjust
                                           
   5539 00D17E                             LAB_29D8
   5540 00D17E 38                           	SEC				; set carry for subtract
   5541 00D17F                             LAB_29D9
   5542 00D17F E9 02 00                     	SBC	#$02			; -2
   5543 00D182 85 C2                        	STA	expcnt		;.save exponent adjust
   5544 00D184 86 C0                        	STX	numexp		; save digits before dp count
   5545 00D186 8A                           	TXA				; copy to A
   5546 00D187 F0 02                        	BEQ	LAB_29E4		; branch if no digits before dp
                                           
   5548 00D189 10 15                        	BPL	LAB_29F7		; branch if digits before dp
                                           
   5550 00D18B                             LAB_29E4
   5551 00D18B A4 C4                        	LDY	Sendl			; get output string index
   5552 00D18D A9 2E 00                     	LDA	#'.'			; character "."
   5553 00D190 C8                           	INY				; increment index
   5554 00D191 99 A0 03                     	STA	Decss,Y		; save to output string
   5555 00D194 8A                           	TXA				;.
   5556 00D195 F0 07                        	BEQ	LAB_29F5		;.
                                           
   5558 00D197 A9 30 00                     	LDA	#'0'			; character "0"
   5559 00D19A C8                           	INY				; increment index
   5560 00D19B 99 A0 03                     	STA	Decss,Y		; save to output string
   5561 00D19E                             LAB_29F5
   5562 00D19E 84 C4                        	STY	Sendl			; save output string index
                                           
   5564 00D1A0                             LAB_29F7
   5565 00D1A0 A2 30 00                     	LDX	#'0'			; holds onto the digit value
                                           
                                           ; Now loop subtracting 100,000 as many times as we can. The value was coerced
                                           ; to be between 100,000 and 1,000,000. Count the number of times subtraction
                                           ; can be done successfully.
                                           ;
   5571 00D1A3                             LAB_29FB
   5572 00D1A3 F4 6E D3                     	PEA CONST_100000
   5573 00D1A6 20 C8 D2                     	JSR LOAD_FAC2	; load FAC2 with 100,000
   5574 00D1A9 68                           	PLA				; get rid of parameter
   5575 00D1AA AF 0E A2 FE                  	LDA FP_STATREG
   5576 00D1AE 89 04 00                     	BIT #$04		; Is FAC1 > 100,000 ?
   5577 00D1B1 F0 0F                        	BEQ	.0005		; branch if not
   5578 00D1B3 A9 11 00                     	LDA #FP_SWAP	; subtract is FAC2-FAC1!
   5579 00D1B6 20 13 D3                     	JSR FPCommandWait;
   5580 00D1B9 A9 02 00                     	LDA #FP_SUB		; subtract 100,000 from the mantissa.
   5581 00D1BC 20 13 D3                     	JSR FPCommandWait
   5582 00D1BF E8                           	INX				; increment the value of the digit
   5583 00D1C0 80 E1                        	BRA	LAB_29FB	; try again
   5584 00D1C2                             .0005:
   5585 00D1C2 8A                           	TXA
   5586 00D1C3 A4 C4                        	LDY	Sendl			; get output string index
   5587 00D1C5 C8                           	INY				; increment output string index
   5588 00D1C6 8A                           	TXA
   5589 00D1C7 99 A0 03                     	STA	Decss,Y		; save to output string
   5590 00D1CA C6 C0                        	DEC	numexp		; decrement # of characters before the dp
   5591 00D1CC D0 07                        	BNE	LAB_2A3B		; branch if still characters to do
                                           				; else output the point
   5593 00D1CE A9 2E 00                     	LDA	#'.'			; character "."
   5594 00D1D1 C8                           	INY				; increment output string index
   5595 00D1D2 99 A0 03                     	STA	Decss,Y		; save to output string
   5596 00D1D5                             LAB_2A3B
   5597 00D1D5 84 C4                        	STY	Sendl		; save output string index
                                           	; We subtracted until the value was < 100,000 so multiply the
                                           	; remainder upwards to get the next digit.
   5600 00D1D7 20 F3 D2                     	JSR	MultiplyByTen	; If not, multiply by 10
   5601 00D1DA C0 1B 00                     	CPY #27			; converted (+/- . incl)
   5602 00D1DD 90 C1                        	BCC	LAB_29F7
                                           					; now remove trailing zeroes
   5604 00D1DF                             .RemoveTrailingZeros
   5605 00D1DF B9 A0 03                     	LDA	Decss,Y		; get character from output string
   5606 00D1E2 29 FF 00                     	AND	#$FF		; mask to a byte
   5607 00D1E5 88                           	DEY				; decrement output string index
   5608 00D1E6 C9 30 00                     	CMP	#'0'			; compare with "0"
   5609 00D1E9 F0 F4                        	BEQ	.RemoveTrailingZeros	; loop until non "0" character found
                                           
   5611 00D1EB C9 2E 00                     	CMP	#'.'			; compare with "."
   5612 00D1EE F0 01                        	BEQ	LAB_2A58		; branch if was dp
                                           
                                           					; restore last character
   5615 00D1F0 C8                           	INY				; increment output string index
   5616 00D1F1                             LAB_2A58
   5617 00D1F1 A9 2B 00                     	LDA	#'+'			; character "+"
   5618 00D1F4 A6 C2                        	LDX	expcnt		; get exponent count
   5619 00D1F6 F0 FF A2 00                  	LBEQ	LAB_2A8C		; if zero go set null terminator and exit
                                           
                                           					; exponent isn't zero so write exponent
   5622 00D1FA 10 0A                        	BPL	LAB_2A68		; branch if exponent count +ve
                                           
   5624 00D1FC A9 00 00                     	LDA	#$00			; clear A
   5625 00D1FF 38                           	SEC				; set carry for subtract
   5626 00D200 E5 C2                        	SBC	expcnt		; subtract exponent count adjust (convert -ve to +ve)
   5627 00D202 AA                           	TAX				; copy exponent count to X
   5628 00D203 A9 2D 00                     	LDA	#'-'			; character "-"
                                           
                                           ; We must keep moving forwards through the string because the acc is storing
                                           ; two bytes.
                                           
   5633 00D206                             LAB_2A68
   5634 00D206 48                           	PHA
   5635 00D207 A9 45 00                     	LDA	#'E'			; character "E"
   5636 00D20A 99 A1 03                     	STA	Decss+1,Y		; save exponent sign to output string
   5637 00D20D 68                           	PLA
   5638 00D20E 99 A2 03                     	STA	Decss+2,Y		; save to output string
   5639 00D211 8A                           	TXA				; get exponent count back
                                           
                                           ; do highest exponent digit
   5642 00D212 64 C4                        	STZ Sendl
   5643 00D214 A2 2F 00                     	LDX	#'0'-1		; one less than "0" character
   5644 00D217 38                           	SEC				; set carry for subtract
   5645 00D218 E8                          .0001:				
   5646 00D219 E9 10 27                     	SBC	#10000
   5647 00D21C B0 FA                        	BCS .0001
   5648 00D21E 69 10 27                     	ADC #10000
   5649 00D221 E0 30 00                     	CPX #'0'
   5650 00D224 F0 09                        	BEQ .0005
   5651 00D226 E6 C4                        	INC Sendl
   5652 00D228 48                           	PHA
   5653 00D229 8A                           	TXA
   5654 00D22A 99 A3 03                     	STA Decss+3,Y
   5655 00D22D 68                           	PLA
   5656 00D22E C8                           	INY
                                           ; do the next exponent digit
   5658 00D22F                             .0005:
   5659 00D22F A2 2F 00                     	LDX #'0'-1
   5660 00D232 38                           	SEC
   5661 00D233                             .0002:
   5662 00D233 E8                           	INX
   5663 00D234 E9 E8 03                     	SBC #1000
   5664 00D237 B0 FA                        	BCS .0002
   5665 00D239 69 E8 03                     	ADC #1000
   5666 00D23C 46 C4                        	LSR Sendl
   5667 00D23E B0 05                        	BCS .00010
   5668 00D240 E0 30 00                     	CPX #'0'
   5669 00D243 F0 09                        	BEQ .0006
   5670 00D245                             .00010:
   5671 00D245 E6 C4                        	INC Sendl
   5672 00D247 48                           	PHA
   5673 00D248 8A                           	TXA
   5674 00D249 99 A3 03                     	STA Decss+3,Y
   5675 00D24C 68                           	PLA
   5676 00D24D C8                           	INY
                                           ; and the next
   5678 00D24E                             .0006:
   5679 00D24E A2 2F 00                     	LDX	#'0'-1
   5680 00D251 38                           	SEC
   5681 00D252                             .0003:
   5682 00D252 E8                           	INX
   5683 00D253 E9 64 00                     	SBC #100
   5684 00D256 B0 FA                        	BCS .0003
   5685 00D258 69 64 00                     	ADC #100
   5686 00D25B 46 C4                        	LSR Sendl
   5687 00D25D B0 05                        	BCS .00011
   5688 00D25F E0 30 00                     	CPX #'0'
   5689 00D262 F0 09                        	BEQ .0007
   5690 00D264                             .00011:
   5691 00D264 E6 C4                        	INC Sendl
   5692 00D266 48                           	PHA
   5693 00D267 8A                           	TXA
   5694 00D268 99 A3 03                     	STA Decss+3,Y
   5695 00D26B 68                           	PLA
   5696 00D26C C8                           	INY
                                           
   5698 00D26D                             .0007:
   5699 00D26D A2 2F 00                     	LDX #'0'-1
   5700 00D270 38                           	SEC
   5701 00D271                             .0004:
   5702 00D271 E8                           	INX
   5703 00D272 E9 0A 00                     	SBC #10
   5704 00D275 B0 FA                        	BCS .0004
   5705 00D277 69 0A 00                     	ADC #10
   5706 00D27A 46 C4                        	LSR Sendl
   5707 00D27C B0 05                        	BCS .00012
   5708 00D27E E0 30 00                     	CPX #'0'
   5709 00D281 F0 09                        	BEQ .0008
   5710 00D283                             .00012:
   5711 00D283 E6 C4                        	INC Sendl
   5712 00D285 48                           	PHA
   5713 00D286 8A                           	TXA
   5714 00D287 99 A3 03                     	STA Decss+3,Y
   5715 00D28A 68                           	PLA
   5716 00D28B C8                           	INY
                                           
   5718 00D28C                             .0008:
   5719 00D28C 69 30 00                     	ADC #'0'
   5720 00D28F 99 A3 03                     	STA Decss+3,Y
   5721 00D292 A9 00 00                     	LDA	#$00			; set null terminator
   5722 00D295 99 A4 03                     	STA	Decss+4,Y		; save to output string
   5723 00D298 60                           	RTS					; go set string pointer (AY) and exit (branch always)
                                           
   5725 00D299                             LAB_2A89
   5726 00D299 99 A0 03                     	STA	Decss,Y		; save last character to output string
                                           					; set null terminator and exit
   5728 00D29C                             LAB_2A8C
   5729 00D29C A9 00 00                     	LDA	#$00			; set null terminator
   5730 00D29F 99 A1 03                     	STA	Decss+1,Y		; save after last character
                                           
   5732 00D2A2                             LAB_2A91
                                           ;	LDA	#<Decssp1		; set result string low pointer
                                           ;	LDY	#>Decssp1		; set result string high pointer
   5735 00D2A2 60                           	RTS
                                           
   5737 00D2A3                             LAB_25FB:
   5738 00D2A3 A9 11 00                     	LDA		#FP_SWAP
   5739 00D2A6 20 13 D3                     	JSR		FPCommandWait
   5740 00D2A9 A0 00 00                     	LDY		#0
   5741 00D2AC BB                           	TYX
   5742 00D2AD                             .0002:
   5743 00D2AD B3 03                        	LDA		(3,S),Y
   5744 00D2AF 9F 00 A2 FE                  	STA		FAC1,X
   5745 00D2B3 C8                           	INY
   5746 00D2B4 C8                           	INY
   5747 00D2B5 E8                           	INX
   5748 00D2B6 E8                           	INX
   5749 00D2B7 E0 0C 00                     	CPX		#12
   5750 00D2BA D0 F1                        	BNE		.0002
   5751 00D2BC A9 05 00                     	LDA		#FP_FIX2FLT
   5752 00D2BF 20 13 D3                     	JSR		FPCommandWait
   5753 00D2C2                             FMUL:
   5754 00D2C2 A9 03 00                     	LDA		#FP_MUL
   5755 00D2C5 4C 13 D3                     	JMP		FPCommandWait
   5756 00D2C8                             	
   5757 00D2C8 DA                           	PHX
   5758 00D2C9 5A                           	PHY
   5759 00D2CA A0 00 00                     	LDY		#0
   5760 00D2CD BB                           	TYX
   5761 00D2CE                             .0002:
   5762 00D2CE B3 07                        	LDA		(7,s),Y
   5763 00D2D0 9F 10 A2 FE                  	STA		FAC2,X
   5764 00D2D4 C8                           	INY
   5765 00D2D5 C8                           	INY
   5766 00D2D6 E8                           	INX
   5767 00D2D7 E8                           	INX
   5768 00D2D8 E0 0C 00                     	CPX		#12
   5769 00D2DB D0 F1                        	BNE		.0002
   5770 00D2DD 7A                           	PLY
   5771 00D2DE FA                           	PLX
   5772 00D2DF 60                           	RTS
   5773 00D2E0                             	
   5774 00D2E0 A9 06 00                     	LDA		#FP_FLT2FIX
   5775 00D2E3 4C 13 D3                     	JMP		FPCommandWait
   5776 00D2E6                             	
   5777 00D2E6 F4 9E D3                     	PEA		CONST_POINT5
   5778 00D2E9 20 C8 D2                     	JSR		LOAD_FAC2
   5779 00D2EC 68                           	PLA
   5780 00D2ED A9 01 00                     	LDA		#FP_ADD
   5781 00D2F0 4C 13 D3                     	JMP		FPCommandWait
   5782 00D2F3                             	
   5783 00D2F3 F4 86 D3                     	PEA		TEN_AS_FLOAT
   5784 00D2F6 20 C8 D2                     	JSR		LOAD_FAC2
   5785 00D2F9 68                           	PLA
   5786 00D2FA A9 03 00                     	LDA		#FP_MUL
   5787 00D2FD 4C 13 D3                     	JMP		FPCommandWait
                                           	
   5789 00D300 F4 86 D3                     	PEA		TEN_AS_FLOAT
   5790 00D303 20 C8 D2                     	JSR		LOAD_FAC2
   5791 00D306 68                           	PLA
   5792 00D307 20 10 D3                     	JSR		SwapFACs
   5793 00D30A A9 04 00                     	LDA		#FP_DIV
   5794 00D30D 4C 13 D3                     	JMP		FPCommandWait
   5795 00D310                             	
   5796 00D310 A9 11 00                     	LDA		#FP_SWAP
                                           
                                           ; Issue a command to the FP unit and wait for it to complete
                                           ;
                                           public FPCommandWait:
   5801 00D313 48                           	PHA
   5802 00D314 A9 06 00                     	LDA		#6
   5803 00D317 8D 00 70                     	STA		$7000
   5804 00D31A                             .0001:
   5805 00D31A AF 0E A2 FE                  	LDA		FP_STATREG	; get the status register
   5806 00D31E 89 80 00                     	BIT		#$80		; check for busy bit
   5807 00D321 D0 F7                        	BNE		.0001		; if busy go back
   5808 00D323 68                           	PLA					; to pop acc
   5809 00D324 8F 0E A2 FE                  	STA		FP_CMDREG	; store the command
   5810 00D328 48                           	PHA
   5811 00D329 A9 07 00                     	LDA		#7
   5812 00D32C 8D 00 70                     	STA		$7000
   5813 00D32F 68                           	PLA
   5814 00D330 60                           	RTS
                                           
                                           ; Display the FAC1 as a hex number
                                           ;
                                           public DispFAC1:
   5819 00D331 AF 0A A2 FE                  	LDA FAC1_e
   5820 00D335 20 96 EA                     	JSR DispWord
   5821 00D338 AF 08 A2 FE                  	LDA	FAC1_1
   5822 00D33C 20 96 EA                     	JSR	DispWord
   5823 00D33F AF 06 A2 FE                  	LDA FAC1_2
   5824 00D343 20 96 EA                     	JSR	DispWord
   5825 00D346 AF 04 A2 FE                  	LDA FAC1_3
   5826 00D34A 20 96 EA                     	JSR DispWord
   5827 00D34D AF 02 A2 FE                  	LDA FAC1_4
   5828 00D351 20 96 EA                     	JSR DispWord
   5829 00D354 AF 00 A2 FE                  	LDA FAC1_5
   5830 00D358 20 96 EA                     	JSR DispWord
   5831 00D35B A9 20 00                     	LDA #' '
   5832 00D35E 20 B6 E9                     	JSR OutChar
   5833 00D361 60                           	RTS
                                           ;
                                           ; 1,000,000 as a floating point number
                                           ;
   5837 00D362                             A_MILLION:	; $F4240
   5838 00D362 00 00                        	dw		$0000
   5839 00D364 00 00                        	dw		$0000
   5840 00D366 00 00                        	dw		$0000
   5841 00D368 00 00                        	dW		$0000
   5842 00D36A 12 7A                        	dw		$7A12
   5843 00D36C 13 80                        	dw		$8013
                                           
   5845 00D36E                             CONST_100000:
                                           	;186A0
   5847 00D36E 00 00                        	dw		$0000
   5848 00D370 00 00                        	dw		$0000
   5849 00D372 00 00                        	dw		$0000
   5850 00D374 00 00                        	dw		$0000
   5851 00D376 A8 61                        	dw		$61A8
   5852 00D378 10 80                        	dw		$8010
                                           ; The constant 999999.4375 as hex
                                           ; 01.11_1010_0001_0001_1111_1011_1000_00000000000000000000000000
   5855 00D37A                             MAX_BEFORE_SCI:
   5856 00D37A 00 00                        	dw  $0000
   5857 00D37C 00 00                        	dw  $0000
   5858 00D37E 00 00                        	dw	$0000
   5859 00D380 80 FB                        	dw	$FB80
   5860 00D382 11 7A                        	dw	$7A11
   5861 00D384 13 80                        	dw	$8013
                                           
   5863 00D386                             TEN_AS_FLOAT:
   5864 00D386 00 00                        	dw	$0000
   5865 00D388 00 00                        	dw	$0000
   5866 00D38A 00 00                        	dw	$0000
   5867 00D38C 00 00                        	dw	$0000
   5868 00D38E 00 50                        	dw	$5000
   5869 00D390 03 80                        	dw	$8003
                                           
                                           ; 99999.9375
                                           ; 01.10_0001_1010_0111_1111_1100_000000000000000000000000000000
                                           ;
   5874 00D392                             CONST_9375:
   5875 00D392 00 00                        	dw	$0000
   5876 00D394 00 00                        	dw	$0000
   5877 00D396 00 00                        	dw	$0000
   5878 00D398 00 FC                        	dw	$FC00
   5879 00D39A A7 61                        	dw	$61A7
   5880 00D39C 10 80                        	dw	$8010
                                           
                                           ; 0.5
   5883 00D39E                             CONST_POINT5:
   5884 00D39E 00 00                        	dw	$0000
   5885 00D3A0 00 00                        	dw	$0000
   5886 00D3A2 00 00                        	dw	$0000
   5887 00D3A4 00 00                        	dw	$0000
   5888 00D3A6 00 40                        	dw	$4000
   5889 00D3A8 FF 7F                        	dw	$7FFF
                                           
                                           ; This table is used in converting numbers to ASCII.
                                           
   5893 00D3AA                             LAB_2A9A
   6191 = 0000D3AB                         LAB_2A9B = LAB_2A9A+1
   6192 = 0000D3AC                         LAB_2A9C = LAB_2A9B+1
                                           ;	.word	$FFFF,$F21F,$494C,$589C,$0000
                                           ;	.word	$0000,$0163,$4578,$5D8A,$0000
                                           ;	.word	$FFFF,$FFDC,$790D,$903F,$0000
                                           ;	.word	$0000,$0003,$8D7E,$A4C6,$8000
                                           ;	.word	$FFFF,$FFFF,$A50C,$EF85,$C000
                                           ;	.word	$0000,$0000,$0918,$4E72,$A000
                                           ;	.word	$FFFF,$FFFF,$FF17,$2B5A,$F000
                                           ;	.word	$0000,$0000,$0017,$4876,$E800
                                           ;	.word	$FFFF,$FFFF,$FFFD,$ABF4,$1C00
                                           ;	.word	$0000,$0000,$0000,$3B9A,$CA00
                                           ;	.word	$FFFF,$FFFF,$FFFF,$FF67,$6980
                                           ;	.word	$0000,$0000,$0000,$05F5,$E100		; 100000000
                                           ;	.word	$0000,$0000,$0098,$9680		; 10000000
                                           ;	.word   $4240,$000F,$0000,$0000,$0000,$804E		; 1000000
   5910 00D3AA A0 86 01 00 00 00 00 00      	.word	$86A0,$0001,$0000,$0000,$0000,$804E		; 100000
   5910 00D3B2 00 00 4E 80                
   5911 00D3B6 10 27 00 00 00 00 00 00      	.word	$2710,$0000,$0000,$0000,$0000,$804E		; 10000
   5911 00D3BE 00 00 4E 80                
   5912 00D3C2 E8 03 00 00 00 00 00 00      	.word	$03E8,$0000,$0000,$0000,$0000,$804E		; 1000
   5912 00D3CA 00 00 4E 80                
   5913 00D3CE 64 00 00 00 00 00 00 00      	.word	$0064,$0000,$0000,$0000,$0000,$804E		; 100
   5913 00D3D6 00 00 4E 80                
   5914 00D3DA                             FIXED10:
   5915 00D3DA 0A 00 00 00 00 00 00 00      	.word	$000A,$0000,$0000,$0000,$0000,$804E		; 10
   5915 00D3E2 00 00 4E 80                
   5916 00D3E6 01 00 00 00 00 00 00 00      	.word	$0001,$0000,$0000,$0000,$0000,$804E		; 1
   5916 00D3EE 00 00 4E 80                
                                           
                                           		 MEM	16
                                           		 NDX	16
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
FTBios816.asm


                                           .include "FAC1ToString.asm"
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
invaders.asm

                                           	CPU		FT832
                                           
   6226 = 0000000000FEA100                               PRNG		EQU		$FEA100
   6227 = 0000000000FEA108                               PRNG_NUM	EQU		$FEA108
   6228 = 0000000000FEA10E                               PRNG_ADV	EQU		$FEA10E
   6229 = 0000000000000001                               MAN_EXPLODING	EQU		1
                                           
                                           ; which invaders are still active (not destroyed)
                                           ; These var addresses are segment offsets into seg $7800
   6233 = 0000000000000000                               active				EQU		$00
   6234 = 000000000000005E                               left_right			EQU		$5E
   6235 = 0000000000000060                               rightmost_column	EQU		$60
   6236 = 0000000000000062                               leftmost_column		EQU		$62
   6237 = 0000000000000064                               bottom_row			EQU		$64
   6238 = 0000000000000066                               top_row				EQU		$66
   6239 = 000000000000006A                               inv_tick			EQU		$6A
   6240 = 000000000000006C                               inv_tick2			EQU		$6C
   6241 = 000000000000006E                               manX				EQU		$6E
   6242 = 0000000000000070                               manY				EQU		$70
   6243 = 0000000000000072                               manState			EQU		$72
   6244 = 0000000000000100                               InvadersX			EQU		$100
   6245 = 0000000000000200                               InvadersY			EQU		$200
   6246 = 0000000000000300                               min_right			EQU		$300
   6247 = 0000000000000310                               max_left			EQU		$310
   6248 = 0000000000000320                               bombX				EQU		$320
   6249 = 0000000000000330                               bombY				EQU		$330
   6250 = 0000000000000400                               inv_state			EQU		$400
                                           
                                           ; This var is shared, must be referenced ZS:
   6253 = 0000000000007868                               do_invaders			EQU		$7868
                                           
                                           	; minimum right +         .byte a_esc,"`0"

                                           -ordinate for each column of invaders
   5954 00D3F2                             st_min_right:
   5955 00D3F2 01 00                        	.word	1
   5956 00D3F4 05 00                        	.word	5
   5957 00D3F6 09 00                        	.word	9
   5958 00D3F8 0D 00                        	.word	13
   5959 00D3FA 11 00                        	.word	17
   5960 00D3FC 15 00                        	.word	21
   5961 00D3FE 19 00                        	.word	25
   5962 00D400 1D 00                        	.word	29
                                           
                                           	; maximum left +         .byte a_esc,"`0"

                                           -ordinate for each column of invaders
   5966 00D402 34 00                        	.word	52
   5967 00D404 38 00                        	.word	56
   5968 00D406 3C 00                        	.word	60
   5969 00D408 40 00                        	.word	64
   5970 00D40A 44 00                        	.word	68
   5971 00D40C 48 00                        	.word	72
   5972 00D40E 4C 00                        	.word	76
   5973 00D410 50 00                        	.word	80
                                           
   5975 00D412 00 00                        	.word	0		; rightmost column
   5976 00D414 07 00                        	.word	7		; lefmost column
   5977 00D416 01 00                        	.word	1		; dx
                                           
                                           	MEM		16
                                           	NDX		16
                                           
                                           	code
                                           
   5984 00D418                             InvBomb:
   5985 00D418 A2 00 00                     	LDX		#0
   5986 00D41B                             .0001:
   5987 00D41B B5 00                        	LDA		active,X
   5988 00D41D F0 27                        	BEQ		.0002
   5989 00D41F 20 F7 D4                     	JSR		CanDropBomb
   5990 00D422 F0 22                        	BEQ		.0002
   5991 00D424 42 5B AF 08 A1 FE            	LDA		ZS:PRNG_NUM
   5992 00D42A 42 5B 8F 0E A1 FE            	STA		ZS:PRNG_ADV
   5993 00D430 29 63 00                     	AND		#$63
   5994 00D433 D0 11                        	BNE		.0002
   5995 00D435 20 4E D4                     	JSR		FindEmptyBomb
   5996 00D438 30 13                        	BMI		.0003
   5997 00D43A BD 00 01                     	LDA		InvadersX,X
   5998 00D43D 99 20 03                     	STA		bombX,Y
   5999 00D440 BD 00 02                     	LDA		InvadersY,X
   6000 00D443 99 30 03                     	STA		bombY,Y
   6001 00D446                             .0002:
   6002 00D446 E8                           	INX
   6003 00D447 E8                           	INX
   6004 00D448 E0 50 00                     	CPX		#80
   6005 00D44B 30 CE                        	BMI		.0001
   6006 00D44D                             .0003:
   6007 00D44D 60                           	RTS
                                           
   6009 00D44E                             FindEmptyBomb:
   6010 00D44E A0 00 00                     	LDY		#0
   6011 00D451                             .0001:
   6012 00D451 B9 20 03                     	LDA		bombX,Y
   6013 00D454 F0 0A                        	BEQ		.0002
   6014 00D456 C8                           	INY
   6015 00D457 C8                           	INY
   6016 00D458 C0 10 00                     	CPY		#16
   6017 00D45B 30 F4                        	BMI		.0001
   6018 00D45D A0 FF FF                     	LDY		#-1
   6019 00D460                             .0002:
   6020 00D460 60                           	RTS
                                           
   6022 00D461                             MoveBombs:
   6023 00D461 A2 00 00                     	LDX		#0
   6024 00D464                             .0002:
   6025 00D464 BD 20 03                     	LDA		bombX,X
   6026 00D467 F0 14                        	BEQ		.0001
   6027 00D469 BD 30 03                     	LDA		bombY,X
   6028 00D46C C9 1E 00                     	CMP		#30			; has the bomb fallen all the way to the ground ?
   6029 00D46F 10 06                        	BPL		.0003		; if yes, reset bomb
   6030 00D471 1A                           	INA
   6031 00D472 9D 30 03                     	STA		bombY,X
   6032 00D475 80 06                        	BRA		.0001
   6033 00D477                             .0003:
   6034 00D477 9E 20 03                     	STZ		bombX,X
   6035 00D47A 9E 30 03                     	STZ		bombY,X
   6036 00D47D                             .0001:
   6037 00D47D E8                           	INX
   6038 00D47E E8                           	INX
   6039 00D47F E0 10 00                     	CPX		#16
   6040 00D482 30 E0                        	BMI		.0002
   6041 00D484 60                           	RTS
                                           
   6043 00D485                             GetBombOffset:
   6044 00D485 B9 30 03                     	LDA		bombY,Y
   6045 00D488 0A                           	ASL
   6046 00D489 AA                           	TAX
   6047 00D48A 42 5B BD 37 F2               	LDA		ZS:LineTbl,X
   6048 00D48F 18                           	CLC
   6049 00D490 79 20 03                     	ADC		bombX,Y
   6050 00D493 79 20 03                     	ADC		bombX,Y
   6051 00D496 AA                           	TAX
   6052 00D497 60                           	RTS
                                           
   6054 00D498                             RenderBombs:
   6055 00D498 A0 00 00                     	LDY		#0
   6056 00D49B                             .0001:
   6057 00D49B B9 30 03                     	LDA		bombY,Y
   6058 00D49E F0 0C                        	BEQ		.0002
   6059 00D4A0 20 85 D4                     	JSR		GetBombOffset
   6060 00D4A3 A9 24 00                     	LDA		#'$'
   6061 00D4A6 42 5B 9F 00 00 FD            	STA		ZS:VIDBUF,X
   6062 00D4AC                             .0002:
   6063 00D4AC C8                           	INY
   6064 00D4AD C8                           	INY
   6065 00D4AE C0 10 00                     	CPY		#16
   6066 00D4B1 30 E8                        	BMI		.0001
   6067 00D4B3 60                           	RTS
                                           
   6069 00D4B4                             TestBombsIntercept:
   6070 00D4B4 A0 00 00                     	LDY		#0
   6071 00D4B7                             .0001:
   6072 00D4B7 20 C2 D4                     	JSR		TestBombIntercept
   6073 00D4BA C8                           	INY
   6074 00D4BB C8                           	INY
   6075 00D4BC C0 10 00                     	CPY		#16
   6076 00D4BF 30 F6                        	BMI		.0001
   6077 00D4C1 60                           	RTS
                                           
   6079 00D4C2                             TestBombIntercept:
   6080 00D4C2 20 85 D4                     	JSR		GetBombOffset
   6081 00D4C5 42 5B BF 00 00 FD            	LDA		ZS:VIDBUF,X
   6082 00D4CB C9 20 00                     	CMP		#' '
   6083 00D4CE F0 1D                        	BEQ		.0001
   6084 00D4D0 B9 30 03                     	LDA		bombY,Y
   6085 00D4D3 C9 1D 00                     	CMP		#29
   6086 00D4D6 D0 16                        	BNE		.0002
   6087 00D4D8 B9 20 03                     	LDA		bombX,Y
   6088 00D4DB D9 6E 00                     	CMP		manX,Y
   6089 00D4DE D0 05                        	BNE		.0003
   6090 00D4E0 A9 01 00                     	LDA		#MAN_EXPLODING
   6091 00D4E3 85 72                        	STA		manState
   6092 00D4E5                             .0003:
   6093 00D4E5 BB                           	TYX
   6094 00D4E6 9E 30 03                     	STZ		bombY,X
   6095 00D4E9 9E 20 03                     	STZ		bombX,X
   6096 00D4EC 60                           	RTS
   6097 00D4ED                             .0001:
   6098 00D4ED 60                           	RTS
   6099 00D4EE                             .0002:
   6100 00D4EE A9 20 00                     	LDA		#' '
   6101 00D4F1 9F 00 00 FD                  	STA		VIDBUF,X
   6102 00D4F5 80 EE                        	BRA		.0003
                                           
                                           ; An invader can drop a bomb only if there are no invaders underneath it.
                                           
   6106 00D4F7                             CanDropBomb:
   6107 00D4F7 E0 0F 00                     	CPX		#15
   6108 00D4FA 10 0C                        	BGE		.0001
   6109 00D4FC B5 10                        	LDA		active+16,X
   6110 00D4FE 15 20                        	ORA		active+32,X
   6111 00D500 15 30                        	ORA		active+48,X
   6112 00D502 15 40                        	ORA		active+64,X
   6113 00D504 49 01 00                     	EOR		#1
   6114 00D507 60                           	RTS
   6115 00D508                             .0001:
   6116 00D508 E0 1F 00                     	CPX		#31
   6117 00D50B 10 0A                        	BGE		.0002
   6118 00D50D B5 10                        	LDA		active+16,X
   6119 00D50F 15 20                        	ORA		active+32,X
   6120 00D511 15 30                        	ORA		active+48,X
   6121 00D513 49 01 00                     	EOR		#1
   6122 00D516 60                           	RTS
   6123 00D517                             .0002:
   6124 00D517 E0 2F 00                     	CPX		#47
   6125 00D51A 10 08                        	BGE		.0003
   6126 00D51C B5 10                        	LDA		active+16,X
   6127 00D51E 15 20                        	ORA		active+32,X
   6128 00D520 49 01 00                     	EOR		#1
   6129 00D523 60                           	RTS
   6130 00D524                             .0003:
   6131 00D524 E0 3F 00                     	CPX		#63
   6132 00D527 10 06                        	BGE		.0004
   6133 00D529 B5 10                        	LDA		active+16,X
   6134 00D52B 49 01 00                     	EOR		#1
   6135 00D52E 60                           	RTS
   6136 00D52F                             .0004:
   6137 00D52F A9 01 00                     	LDA		#1
   6138 00D532 60                           	RTS
                                           
                                           
                                           ; Test if it's possible to move to the left anymore.
                                           ;
   6143 00D533                             CanMoveLeft:
   6144 00D533 A5 62                        	LDA		leftmost_column
   6145 00D535 0A                           	ASL
   6146 00D536 AA                           	TAX
   6147 00D537 BD 10 03                     	LDA		max_left,X
   6148 00D53A DD 00 01                     	CMP		InvadersX,X
   6149 00D53D 30 04                        	BMI		.0001
   6150 00D53F A9 00 00                     	LDA		#0
   6151 00D542 60                           	RTS
   6152 00D543                             .0001:
   6153 00D543 A9 01 00                     	LDA		#1
   6154 00D546 60                           	RTS
                                           
                                           ; Test if it's possible to move to the right anymore.
                                           ;
   6158 00D547                             CanMoveRight:
   6159 00D547 A5 60                        	LDA		rightmost_column
   6160 00D549 0A                           	ASL
   6161 00D54A AA                           	TAX
   6162 00D54B BD 00 03                     	LDA		min_right,X
   6163 00D54E DD 00 01                     	CMP		InvadersX,X
   6164 00D551 10 04                        	BPL		.0001
   6165 00D553 A9 00 00                     	LDA		#0
   6166 00D556 60                           	RTS
   6167 00D557                             .0001:
   6168 00D557 A9 01 00                     	LDA		#1
   6169 00D55A 60                           	RTS
                                           
                                           ; Test if it's possible to move down anymore
                                           ;
   6173 00D55B                             CanMoveDown:
   6174 00D55B A5 64                        	LDA		bottom_row
   6175 00D55D 0A                           	ASL
   6176 00D55E 0A                           	ASL
   6177 00D55F 0A                           	ASL
   6178 00D560 0A                           	ASL
   6179 00D561 AA                           	TAX
   6180 00D562 BD 00 02                     	LDA		InvadersY,X
   6181 00D565 C9 1E 00                     	CMP		#30
   6182 00D568 30 04                        	BMI		.0001
   6183 00D56A A9 00 00                     	LDA		#0
   6184 00D56D 60                           	RTS
   6185 00D56E                             .0001:
   6186 00D56E A9 01 00                     	LDA		#1
   6187 00D571 60                           	RTS
                                           
                                           ; Move all the invaders to the left
                                           ; Means incrementing the X co-ordinate
                                           ;
   6192 00D572                             MoveLeft:
   6193 00D572 A2 00 00                     	LDX		#00
   6194 00D575                             .0002:
   6195 00D575 FE 00 01                     	INC		InvadersX,X
   6196 00D578 E8                           	INX
   6197 00D579 E8                           	INX
   6198 00D57A E0 50 00                     	CPX		#80
   6199 00D57D D0 F6                        	BNE		.0002
   6200 00D57F 60                           	RTS
                                           
                                           ; Move all the invaders to the right.
                                           ; means decrementing the X co-ordinate
                                           ;
   6205 00D580                             MoveRight:
   6206 00D580 A2 00 00                     	LDX		#0
   6207 00D583                             .0002:
   6208 00D583 DE 00 01                     	DEC		InvadersX,X
   6209 00D586 E8                           	INX
   6210 00D587 E8                           	INX
   6211 00D588 E0 50 00                     	CPX		#80
   6212 00D58B D0 F6                        	BNE		.0002
   6213 00D58D 60                           	RTS
                                           
                                           ; Move all the invaders down a row.
                                           ; Means incrementing the Y co-ordinate
                                           ;
   6218 00D58E                             MoveDown:
   6219 00D58E A2 00 00                     	LDX		#00
   6220 00D591                             .0002:
   6221 00D591 FE 00 02                     	INC		InvadersY,X
   6222 00D594 E8                           	INX
   6223 00D595 E8                           	INX
   6224 00D596 E0 50 00                     	CPX		#80
   6225 00D599 D0 F6                        	BNE		.0002
   6226 00D59B 60                           	RTS
                                           
                                           ; Move the invaders
                                           ; Retuns
                                           ; .A = 1 if it was possible to do a move, 0 otherwise
                                           ;
   6232 00D59C                             Move:
   6233 00D59C 24 5E                        	BIT		left_right
   6234 00D59E 30 0A                        	BMI		.0002
   6235 00D5A0 20 33 D5                     	JSR		CanMoveLeft
   6236 00D5A3 F0 0F                        	BEQ		.0001
   6237 00D5A5 20 72 D5                     	JSR		MoveLeft
   6238 00D5A8 80 19                        	BRA		.0003
   6239 00D5AA                             .0002:
   6240 00D5AA 20 47 D5                     	JSR		CanMoveRight
   6241 00D5AD F0 05                        	BEQ		.0001
   6242 00D5AF 20 80 D5                     	JSR		MoveRight
   6243 00D5B2 80 0F                        	BRA		.0003
   6244 00D5B4                             .0001:
   6245 00D5B4 20 5B D5                     	JSR		CanMoveDown
   6246 00D5B7 F0 0E                        	BEQ		.0004
   6247 00D5B9 A5 5E                        	LDA		left_right
   6248 00D5BB 49 FF FF                     	EOR		#$FFFF
   6249 00D5BE 85 5E                        	STA		left_right
   6250 00D5C0 20 8E D5                     	JSR		MoveDown
   6251 00D5C3                             .0003:
   6252 00D5C3 A9 01 00                     	LDA		#1
   6253 00D5C6 60                           	RTS
   6254 00D5C7                             .0004:
   6255 00D5C7 A9 00 00                     	LDA		#0
   6256 00D5CA 60                           	RTS
                                           
   6258 00D5CB                             Initialize:
   6259 00D5CB 64 60                        	STZ		rightmost_column
   6260 00D5CD A9 07 00                     	LDA		#7
   6261 00D5D0 85 62                        	STA		leftmost_column
   6262 00D5D2 64 66                        	STZ		top_row
   6263 00D5D4 A9 04 00                     	LDA		#4
   6264 00D5D7 85 64                        	STA		bottom_row
   6265 00D5D9 64 5E                        	STZ		left_right
   6266 00D5DB 20 23 D6                     	JSR		ActivateAllInvaders
   6267 00D5DE A2 00 00                     	LDX		#0
   6268 00D5E1                             .0001:
   6269 00D5E1 42 1B BD 36 DA               	LDA		CS:StartX,X
   6270 00D5E6 9D 00 01                     	STA		InvadersX,X
   6271 00D5E9 42 1B BD E6 D9               	LDA		CS:StartY,X
   6272 00D5EE 9D 00 02                     	STA		InvadersY,X
   6273 00D5F1 E8                           	INX
   6274 00D5F2 E8                           	INX
   6275 00D5F3 E0 50 00                     	CPX		#80
   6276 00D5F6 30 E9                        	BMI		.0001
   6277 00D5F8 A2 00 00                     	LDX		#0
   6278 00D5FB                             .0002:
   6279 00D5FB 42 1B BD F2 D3               	LDA		CS:st_min_right,X
   6280 00D600 9D 00 03                     	STA		min_right,X
   6281 00D603 E8                           	INX
   6282 00D604 E8                           	INX
   6283 00D605 E0 20 00                     	CPX		#32
   6284 00D608 30 F1                        	BMI		.0002
                                           	; Initialize Bombs
   6286 00D60A A2 00 00                     	LDX		#0
   6287 00D60D                             .0003:
   6288 00D60D 9E 20 03                     	STZ		bombX,X
   6289 00D610 9E 30 03                     	STZ		bombY,X
   6290 00D613 E8                           	INX
   6291 00D614 E8                           	INX
   6292 00D615 E0 10 00                     	CPX		#16
   6293 00D618 30 F3                        	BMI		.0003
   6294 00D61A A9 FE FF                     	LDA		#$FFFE
   6295 00D61D 42 5B 8D 68 78               	STA		ZS:do_invaders
   6296 00D622 60                           	RTS
                                           
   6298 00D623                             ActivateAllInvaders:
   6299 00D623 A2 00 00                     	LDX		#0
   6300 00D626 A9 01 00                     	LDA		#1
   6301 00D629                             .0001:
   6302 00D629 95 00                        	STA		active,X
   6303 00D62B E8                           	INX
   6304 00D62C E8                           	INX
   6305 00D62D E0 50 00                     	CPX		#80
   6306 00D630 D0 F7                        	BNE		.0001
   6307 00D632 60                           	RTS
                                           
   6309 00D633                             IsAllDestroyed:
   6310 00D633 20 BB D6                     	JSR		IsRightmostColumnDestroyed
   6311 00D636 F0 2C                        	BEQ		.0001
   6312 00D638 E6 60                        	INC		rightmost_column
   6313 00D63A AD 0C 03                     	LDA		min_right+12
   6314 00D63D 8D 0E 03                     	STA		min_right+14
   6315 00D640 AD 0A 03                     	LDA		min_right+10
   6316 00D643 8D 0C 03                     	STA		min_right+12
   6317 00D646 AD 08 03                     	LDA		min_right+8
   6318 00D649 8D 0A 03                     	STA		min_right+10
   6319 00D64C AD 06 03                     	LDA		min_right+6
   6320 00D64F 8D 08 03                     	STA		min_right+8
   6321 00D652 AD 04 03                     	LDA		min_right+4
   6322 00D655 8D 06 03                     	STA		min_right+6
   6323 00D658 AD 02 03                     	LDA		min_right+2
   6324 00D65B 8D 04 03                     	STA		min_right+4
   6325 00D65E AD 00 03                     	LDA		min_right
   6326 00D661 8D 02 03                     	STA		min_right+2
   6327 00D664                             .0001:
   6328 00D664 20 B7 D6                     	JSR		IsLeftmostColumnDestroyed
   6329 00D667 F0 2C                        	BEQ		.0002
   6330 00D669 C6 62                        	DEC		leftmost_column
   6331 00D66B AD 12 03                     	LDA		max_left+2
   6332 00D66E 8D 10 03                     	STA		max_left
   6333 00D671 AD 14 03                     	LDA		max_left+4
   6334 00D674 8D 12 03                     	STA		max_left+2
   6335 00D677 AD 16 03                     	LDA		max_left+6
   6336 00D67A 8D 14 03                     	STA		max_left+4
   6337 00D67D AD 18 03                     	LDA		max_left+8
   6338 00D680 8D 16 03                     	STA		max_left+6
   6339 00D683 AD 1A 03                     	LDA		max_left+10
   6340 00D686 8D 18 03                     	STA		max_left+8
   6341 00D689 AD 1C 03                     	LDA		max_left+12
   6342 00D68C 8D 1A 03                     	STA		max_left+10
   6343 00D68F AD 1E 03                     	LDA		max_left+14
   6344 00D692 8D 1C 03                     	STA		max_left+12
   6345 00D695                             .0002:
   6346 00D695 A5 62                        	LDA		leftmost_column
   6347 00D697 C5 60                        	CMP		rightmost_column
   6348 00D699 30 18                        	BMI		.allDestroyed
   6349 00D69B 20 D7 D6                     	JSR		IsBottomRowDestroyed
   6350 00D69E F0 02                        	BEQ		.0003
   6351 00D6A0 C6 64                        	DEC		bottom_row
   6352 00D6A2                             .0003:
   6353 00D6A2 20 D3 D6                     	JSR		IsTopRowDestroyed
   6354 00D6A5 F0 02                        	BEQ		.0004
   6355 00D6A7 E6 66                        	INC		top_row
   6356 00D6A9                             .0004:
   6357 00D6A9 A5 64                        	LDA		bottom_row
   6358 00D6AB C5 66                        	CMP		top_row
   6359 00D6AD 30 04                        	BMI		.allDestroyed
   6360 00D6AF A9 00 00                     	LDA		#0
   6361 00D6B2 60                           	RTS
   6362 00D6B3                             .allDestroyed:
   6363 00D6B3 A9 01 00                     	LDA		#1
   6364 00D6B6 60                           	RTS
                                           
                                           
   6367 00D6B7                             IsLeftmostColumnDestroyed:
   6368 00D6B7 A5 62                        	LDA		leftmost_column
   6369 00D6B9 80 02                        	BRA		IsColumnDestroyed
   6370 00D6BB                             IsRightmostColumnDestroyed:
   6371 00D6BB A5 60                        	LDA		rightmost_column
   6372 00D6BD                             IsColumnDestroyed:
   6373 00D6BD 0A                           	ASL
   6374 00D6BE AA                           	TAX
   6375 00D6BF B5 00                        	LDA		active,X
   6376 00D6C1 15 10                        	ORA		active+16,X
   6377 00D6C3 15 20                        	ORA		active+32,X
   6378 00D6C5 15 30                        	ORA		active+48,X
   6379 00D6C7 15 40                        	ORA		active+64,X
   6380 00D6C9 15 50                        	ORA		active+80,X
   6381 00D6CB 15 60                        	ORA		active+96,X
   6382 00D6CD 15 70                        	ORA		active+112,X
   6383 00D6CF 49 01 00                     	EOR		#1
   6384 00D6D2 60                           	RTS
                                           
   6386 00D6D3                             IsTopRowDestroyed:
   6387 00D6D3 A5 66                        	LDA		top_row
   6388 00D6D5 80 02                        	BRA		IsRowDestroyed
   6389 00D6D7                             IsBottomRowDestroyed:
   6390 00D6D7 A5 64                        	LDA		bottom_row
   6391 00D6D9                             IsRowDestroyed:
   6392 00D6D9 0A                           	ASL
   6393 00D6DA 0A                           	ASL
   6394 00D6DB 0A                           	ASL
   6395 00D6DC 0A                           	ASL
   6396 00D6DD B5 00                        	LDA		active,X
   6397 00D6DF 15 02                        	ORA		active+2,X
   6398 00D6E1 15 04                        	ORA		active+4,X
   6399 00D6E3 15 06                        	ORA		active+6,X
   6400 00D6E5 15 08                        	ORA		active+8,X
   6401 00D6E7 15 0A                        	ORA		active+10,X
   6402 00D6E9 15 0C                        	ORA		active+12,X
   6403 00D6EB 15 0E                        	ORA		active+14,X
   6404 00D6ED 49 01 00                     	EOR		#1
   6405 00D6F0 60                           	RTS
                                           
                                           ; TickCount counts 1/100 of a second. We want to animate the graphics at a much
                                           ; slower rate, so we use bit 6 of the tick count to indicate when to animate.
                                           ;
   6410 00D6F1                             ShiftTick:
   6411 00D6F1 42 5B A5 04                  	LDA		ZS:TickCount
   6412 00D6F5 4A                           	LSR
   6413 00D6F6 4A                           	LSR
   6414 00D6F7 4A                           	LSR
   6415 00D6F8 4A                           	LSR
   6416 00D6F9 4A                           	LSR
   6417 00D6FA 4A                           	LSR
   6418 00D6FB 60                           	RTS
                                           
   6420 00D6FC                             RenderInvaders:
                                           	; First, clear the screen
   6422 00D6FC A2 00 00                     	LDX		#0
   6423 00D6FF A9 20 00                     	LDA		#' '
   6424 00D702 09 00 BF                     	ORA		#$BF00
   6425 00D705                             .0003:
   6426 00D705 42 5B 9F 00 00 FD            	STA		ZS:VIDBUF,X
   6427 00D70B E8                           	INX
   6428 00D70C E8                           	INX
   6429 00D70D E0 58 14                     	CPX		#84*31*2
   6430 00D710 30 F3                        	BMI		.0003
   6431 00D712 A2 00 00                     	LDX		#0
   6432 00D715                             .0002:
   6433 00D715 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   6436 00D717 B5 00                        	LDA		active,X
   6437 00D719 F0 FF BD 01                  	LBEQ	.0001
   6438 00D71D BD 00 04                     	LDA		inv_state,X
   6439 00D720 BD 00 02                     	LDA		InvadersY,X
   6440 00D723 0A                           	ASL
   6441 00D724 A8                           	TAY
   6442 00D725 42 5B B9 37 F2               	LDA		ZS:LineTbl,Y
   6443 00D72A 18                           	CLC
   6444 00D72B 7D 00 01                     	ADC		InvadersX,X
   6445 00D72E 18                           	CLC
   6446 00D72F 7D 00 01                     	ADC		InvadersX,X
   6447 00D732 A8                           	TAY
   6448 00D733 E2 20                        	SEP		#$20			; eight bit acc
                                           	MEM		8
   6450 00D735 42 1B BD 86 DA               	LDA		CS:InvaderType,X
   6451 00D73A C9 01                        	CMP		#1
   6452 00D73C D0 46                        	BNE		.0004
   6453 00D73E A9 E9                        	LDA		#233
   6454 00D740 42 5B 42 99 00 00 FD 00      	STA		ZS:VIDBUF,Y
                                         
   6455 00D748 A9 F2                        	LDA		#242
   6456 00D74A 42 5B 42 99 02 00 FD 00      	STA		ZS:VIDBUF+2,Y
                                         
   6457 00D752 A9 DF                        	LDA		#223
   6458 00D754 42 5B 42 99 04 00 FD 00      	STA		ZS:VIDBUF+4,Y
                                         
   6459 00D75C 20 F1 D6                     	JSR		ShiftTick
   6460 00D75F 90 04                        	BCC		.0005
   6461 00D761 A9 58                        	LDA		#'X'
   6462 00D763 80 02                        	BRA		.0006
   6463 00D765                             .0005:
   6464 00D765 A9 56                        	LDA		#'V'
   6465 00D767                             .0006:
   6466 00D767 42 5B 42 99 54 00 FD 00      	STA		ZS:VIDBUF+84,Y
                                         
   6467 00D76F 42 5B 42 99 58 00 FD 00      	STA		ZS:VIDBUF+88,Y
                                         
   6468 00D777 A9 20                        	LDA		#' '
   6469 00D779 42 5B 42 99 56 00 FD 00      	STA		ZS:VIDBUF+86,Y
                                         
   6470 00D781 82 E4 00                     	BRL		.0007
   6471 00D784                             .0004:
   6472 00D784 C9 02                        	CMP		#2
   6473 00D786 D0 FF 83 00                  	LBNE	.0008
   6474 00D78A 20 F1 D6                     	JSR		ShiftTick
   6475 00D78D 90 3F                        	BCC		.0009
   6476 00D78F A9 FC                        	LDA		#252
   6477 00D791 42 5B 42 99 00 00 FD 00      	STA		ZS:VIDBUF,Y
                                         
   6478 00D799 A9 99                        	LDA		#153
   6479 00D79B 42 5B 42 99 02 00 FD 00      	STA		ZS:VIDBUF+2,Y
                                         
   6480 00D7A3 A9 FE                        	LDA		#254
   6481 00D7A5 42 5B 42 99 04 00 FD 00      	STA		ZS:VIDBUF+4,Y
                                         
   6482 00D7AD A9 E2                        	LDA		#226
   6483 00D7AF 42 5B 42 99 54 00 FD 00      	STA		ZS:VIDBUF+84,Y
                                         
   6484 00D7B7 A9 62                        	LDA		#98
   6485 00D7B9 42 5B 42 99 56 00 FD 00      	STA		ZS:VIDBUF+86,Y
                                         
   6486 00D7C1 A9 E2                        	LDA		#226
   6487 00D7C3 42 5B 42 99 58 00 FD 00      	STA		ZS:VIDBUF+88,Y
                                         
   6488 00D7CB 82 9A 00                     	BRL		.0007
   6489 00D7CE                             .0009:
   6490 00D7CE A9 62                        	LDA		#98
   6491 00D7D0 42 5B 42 99 00 00 FD 00      	STA		ZS:VIDBUF,Y
                                         
   6492 00D7D8 A9 99                        	LDA		#153
   6493 00D7DA 42 5B 42 99 02 00 FD 00      	STA		ZS:VIDBUF+2,Y
                                         
   6494 00D7E2 A9 62                        	LDA		#98
   6495 00D7E4 42 5B 42 99 04 00 FD 00      	STA		ZS:VIDBUF+4,Y
                                         
   6496 00D7EC A9 EC                        	LDA		#236
   6497 00D7EE 42 5B 42 99 54 00 FD 00      	STA		ZS:VIDBUF+84,Y
                                         
   6498 00D7F6 A9 62                        	LDA		#98
   6499 00D7F8 42 5B 42 99 56 00 FD 00      	STA		ZS:VIDBUF+86,Y
                                         
   6500 00D800 A9 FB                        	LDA		#251
   6501 00D802 42 5B 42 99 58 00 FD 00      	STA		ZS:VIDBUF+88,Y
                                         
   6502 00D80A 82 5B 00                     	BRL		.0007
   6503 00D80D                             .0008:
   6504 00D80D A9 FF                        	LDA		#255
   6505 00D80F 42 5B 42 99 00 00 FD 00      	STA		ZS:VIDBUF,Y
                                         
   6506 00D817 A9 F8                        	LDA		#248
   6507 00D819 42 5B 42 99 02 00 FD 00      	STA		ZS:VIDBUF+2,Y
                                         
   6508 00D821 A9 7F                        	LDA		#127
   6509 00D823 42 5B 99 1C D8               	STA		ZS:VIDBUf+4,Y
   6510 00D828 20 F1 D6                     	JSR		ShiftTick
   6511 00D82B 90 20                        	BCC		.0010
   6512 00D82D A9 FF                        	LDA		#255
   6513 00D82F 42 5B 42 99 54 00 FD 00      	STA		ZS:VIDBUF+84,Y
                                         
   6514 00D837 A9 F9                        	LDA		#249
   6515 00D839 42 5B 42 99 56 00 FD 00      	STA		ZS:VIDBUF+86,Y
                                         
   6516 00D841 A9 7F                        	LDA		#127
   6517 00D843 42 5B 42 99 58 00 FD 00      	STA		ZS:VIDBUF+88,Y
                                         
   6518 00D84B 80 1B                        	BRA		.0007
   6519 00D84D                             .0010:
   6520 00D84D A9 E1                        	LDA		#225
   6521 00D84F 42 5B 99 6C D8               	STA		ZS:VIDBUf+84,Y
   6522 00D854 A9 F9                        	LDA		#249
   6523 00D856 42 5B 42 99 56 00 FD 00      	STA		ZS:VIDBUF+86,Y
                                         
   6524 00D85E A9 60                        	LDA		#96
   6525 00D860 42 5B 42 99 58 00 FD 00      	STA		ZS:VIDBUF+88,Y
                                         
   6526 00D868                             .0007:
                                           	; Surround the alien with spaces
   6528 00D868 A9 20                        	LDA		#' '
   6529 00D86A 42 5B 42 99 AA FF FC 00      	STA		ZS:VIDBUF-86,Y
                                         
   6530 00D872 42 5B 42 99 AC FF FC 00      	STA		ZS:VIDBUF-84,Y
                                         
   6531 00D87A 42 5B 42 99 AE FF FC 00      	STA		ZS:VIDBUF-82,Y
                                         
   6532 00D882 42 5B 42 99 B0 FF FC 00      	STA		ZS:VIDBUF-80,Y
                                         
   6533 00D88A 42 5B 42 99 B2 FF FC 00      	STA		ZS:VIDBUF-78,Y
                                         
   6534 00D892 42 5B 42 99 FE FF FC 00      	STA		ZS:VIDBUF-2,Y
                                         
   6535 00D89A 42 5B 42 99 06 00 FD 00      	STA		ZS:VIDBUF+6,Y
                                         
   6536 00D8A2 42 5B 42 99 52 00 FD 00      	STA		ZS:VIDBUF+82,Y
                                         
   6537 00D8AA 42 5B 42 99 5A 00 FD 00      	STA		ZS:VIDBUF+90,Y
                                         
   6538 00D8B2 42 5B 42 99 A6 00 FD 00      	STA		ZS:VIDBUF+166,Y
                                         
   6539 00D8BA 42 5B 42 99 A8 00 FD 00      	STA		ZS:VIDBUF+168,Y
                                         
   6540 00D8C2 42 5B 42 99 AA 00 FD 00      	STA		ZS:VIDBUF+170,Y
                                         
   6541 00D8CA 42 5B 42 99 AC 00 FD 00      	STA		ZS:VIDBUF+172,Y
                                         
   6542 00D8D2 42 5B 42 99 AE 00 FD 00      	STA		ZS:VIDBUF+174,Y
                                         
   6543 00D8DA                             .0001:
   6544 00D8DA E8                           	INX
   6545 00D8DB E8                           	INX
   6546 00D8DC E0 50 00                     	CPX		#80
   6547 00D8DF D0 FF 32 FE                  	LBNE	.0002
   6548 00D8E3 C2 20                        	REP		#$20
                                           	MEM		16
   6550 00D8E5 60                           	RTS
                                           
                                           public InvadersTask:
   6553 00D8E6                             .0001:
   6554 00D8E6 F4 00 00                     	PEA		0				; set data segment to $7800
   6555 00D8E9 F4 00 78                     	PEA		$7800
   6556 00D8EC 42 2B                        	PLDS
   6557 00D8EE A9 FF 2B                     	LDA		#$2BFF			; set stack to $2BFF
   6558 00D8F1 1B                           	TAS
   6559 00D8F2 20 CB D5                     	JSR		Initialize
   6560 00D8F5 42 E2 00 10                  	SEP		#$1000			; turn on single step mode
   6561 00D8F9 20 FC D6                     	JSR		RenderInvaders
   6562 00D8FC                             .0002:
   6563 00D8FC 42 20 E4 EC 07               	JCR 	KeybdGetCharNoWaitCtx,7	; check for char at keyboard
   6564 00D901                             .0004:
   6565 00D901 A2 00 00                     	LDX		#0
   6566 00D904                             .0006:
   6567 00D904 E8                           	INX
   6568 00D905 E0 D0 07                     	CPX		#2000
   6569 00D908 D0 FA                        	BNE		.0006
   6570 00D90A 42 5B A5 04                  	LDA		ZS:TickCount
   6571 00D90E 29 03 00                     	AND		#$3
   6572 00D911 D0 E9                        	BNE		.0002
   6573 00D913 20 18 D4                     	JSR		InvBomb
   6574 00D916 20 FC D6                     	JSR		RenderInvaders
   6575 00D919 20 98 D4                     	JSR		RenderBombs
   6576 00D91C 20 61 D4                     	JSR		MoveBombs
   6577 00D91F 42 5B A5 04                  	LDA		ZS:TickCount
   6578 00D923 29 0F 00                     	AND		#$F
   6579 00D926 D0 D4                        	BNE		.0002
   6580 00D928 20 33 D6                     	JSR		IsAllDestroyed
   6581 00D92B D0 B9                        	BNE		.0001
   6582 00D92D 20 9C D5                     	JSR		Move
   6583 00D930 F0 B4                        	BEQ		.0001				; Can't move, re-initialize
   6584 00D932 80 C8                        	BRA		.0002
   6585 00D934                             .0005:
   6586 00D934 85 6A                        	STA		inv_tick
   6587 00D936 80 C4                        	BRA		.0002
   6588 00D938                             .0003:
   6589 00D938 C9 03 00                     	CMP		#3
   6590 00D93B D0 C4                        	BNE		.0004
   6591 00D93D 42 5B 9C 68 78               	STZ		ZS:do_invaders
   6592 00D942 42 60                        	RTT
   6593 00D944 80 A0                        	BRA		.0001
                                           
   6595 00D946                             InvaderRow:
   6596 00D946 00 00                        	.word	0
   6597 00D948 00 00                        	.word	0
   6598 00D94A 00 00                        	.word	0
   6599 00D94C 00 00                        	.word	0
   6600 00D94E 00 00                        	.word	0
   6601 00D950 00 00                        	.word	0
   6602 00D952 00 00                        	.word	0
   6603 00D954 00 00                        	.word	0
                                           
   6605 00D956 01 00                        	.word	1
   6606 00D958 01 00                        	.word	1
   6607 00D95A 01 00                        	.word	1
   6608 00D95C 01 00                        	.word	1
   6609 00D95E 01 00                        	.word	1
   6610 00D960 01 00                        	.word	1
   6611 00D962 01 00                        	.word	1
   6612 00D964 01 00                        	.word	1
                                           
   6614 00D966 02 00                        	.word	2
   6615 00D968 02 00                        	.word	2
   6616 00D96A 02 00                        	.word	2
   6617 00D96C 02 00                        	.word	2
   6618 00D96E 02 00                        	.word	2
   6619 00D970 02 00                        	.word	2
   6620 00D972 02 00                        	.word	2
   6621 00D974 02 00                        	.word	2
                                           
   6623 00D976 03 00                        	.word	3
   6624 00D978 03 00                        	.word	3
   6625 00D97A 03 00                        	.word	3
   6626 00D97C 03 00                        	.word	3
   6627 00D97E 03 00                        	.word	3
   6628 00D980 03 00                        	.word	3
   6629 00D982 03 00                        	.word	3
   6630 00D984 03 00                        	.word	3
                                           
   6632 00D986 04 00                        	.word	4
   6633 00D988 04 00                        	.word	4
   6634 00D98A 04 00                        	.word	4
   6635 00D98C 04 00                        	.word	4
   6636 00D98E 04 00                        	.word	4
   6637 00D990 04 00                        	.word	4
   6638 00D992 04 00                        	.word	4
   6639 00D994 04 00                        	.word	4
                                           
   6641 00D996                             InvaderCol:
   6642 00D996 00 00                        	.word	0
   6643 00D998 01 00                        	.word	1
   6644 00D99A 02 00                        	.word	2
   6645 00D99C 03 00                        	.word	3
   6646 00D99E 04 00                        	.word	4
   6647 00D9A0 05 00                        	.word	5
   6648 00D9A2 06 00                        	.word	6
   6649 00D9A4 07 00                        	.word	7
                                           
   6651 00D9A6 00 00                        	.word	0
   6652 00D9A8 01 00                        	.word	1
   6653 00D9AA 02 00                        	.word	2
   6654 00D9AC 03 00                        	.word	3
   6655 00D9AE 04 00                        	.word	4
   6656 00D9B0 05 00                        	.word	5
   6657 00D9B2 06 00                        	.word	6
   6658 00D9B4 07 00                        	.word	7
                                           
   6660 00D9B6 00 00                        	.word	0
   6661 00D9B8 01 00                        	.word	1
   6662 00D9BA 02 00                        	.word	2
   6663 00D9BC 03 00                        	.word	3
   6664 00D9BE 04 00                        	.word	4
   6665 00D9C0 05 00                        	.word	5
   6666 00D9C2 06 00                        	.word	6
   6667 00D9C4 07 00                        	.word	7
                                           
   6669 00D9C6 00 00                        	.word	0
   6670 00D9C8 01 00                        	.word	1
   6671 00D9CA 02 00                        	.word	2
   6672 00D9CC 03 00                        	.word	3
   6673 00D9CE 04 00                        	.word	4
   6674 00D9D0 05 00                        	.word	5
   6675 00D9D2 06 00                        	.word	6
   6676 00D9D4 07 00                        	.word	7
                                           
   6678 00D9D6 00 00                        	.word	0
   6679 00D9D8 01 00                        	.word	1
   6680 00D9DA 02 00                        	.word	2
   6681 00D9DC 03 00                        	.word	3
   6682 00D9DE 04 00                        	.word	4
   6683 00D9E0 05 00                        	.word	5
   6684 00D9E2 06 00                        	.word	6
   6685 00D9E4 07 00                        	.word	7
                                           
                                           ; Starting Y co-ordinate for each invader
                                           
   6689 00D9E6                             StartY:
   6690 00D9E6 03 00                        	.word	3
   6691 00D9E8 03 00                        	.word	3
   6692 00D9EA 03 00                        	.word	3
   6693 00D9EC 03 00                        	.word	3
   6694 00D9EE 03 00                        	.word	3
   6695 00D9F0 03 00                        	.word	3
   6696 00D9F2 03 00                        	.word	3
   6697 00D9F4 03 00                        	.word	3
                                           
   6699 00D9F6 06 00                        	.word	6
   6700 00D9F8 06 00                        	.word	6
   6701 00D9FA 06 00                        	.word	6
   6702 00D9FC 06 00                        	.word	6
   6703 00D9FE 06 00                        	.word	6
   6704 00DA00 06 00                        	.word	6
   6705 00DA02 06 00                        	.word	6
   6706 00DA04 06 00                        	.word	6
                                           
   6708 00DA06 09 00                        	.word	9
   6709 00DA08 09 00                        	.word	9
   6710 00DA0A 09 00                        	.word	9
   6711 00DA0C 09 00                        	.word	9
   6712 00DA0E 09 00                        	.word	9
   6713 00DA10 09 00                        	.word	9
   6714 00DA12 09 00                        	.word	9
   6715 00DA14 09 00                        	.word	9
                                           
   6717 00DA16 0C 00                        	.word	12
   6718 00DA18 0C 00                        	.word	12
   6719 00DA1A 0C 00                        	.word	12
   6720 00DA1C 0C 00                        	.word	12
   6721 00DA1E 0C 00                        	.word	12
   6722 00DA20 0C 00                        	.word	12
   6723 00DA22 0C 00                        	.word	12
   6724 00DA24 0C 00                        	.word	12
                                           
   6726 00DA26 0F 00                        	.word	15
   6727 00DA28 0F 00                        	.word	15
   6728 00DA2A 0F 00                        	.word	15
   6729 00DA2C 0F 00                        	.word	15
   6730 00DA2E 0F 00                        	.word	15
   6731 00DA30 0F 00                        	.word	15
   6732 00DA32 0F 00                        	.word	15
   6733 00DA34 0F 00                        	.word	15
                                           
                                           ; Starting X co-ordinate for each invader
                                           
   6737 00DA36                             StartX:
   6738 00DA36 01 00                        	.word	1
   6739 00DA38 05 00                        	.word	5
   6740 00DA3A 09 00                        	.word	9
   6741 00DA3C 0D 00                        	.word	13
   6742 00DA3E 11 00                        	.word	17
   6743 00DA40 15 00                        	.word	21
   6744 00DA42 19 00                        	.word	25
   6745 00DA44 1D 00                        	.word	29
                                           
   6747 00DA46 01 00                        	.word	1
   6748 00DA48 05 00                        	.word	5
   6749 00DA4A 09 00                        	.word	9
   6750 00DA4C 0D 00                        	.word	13
   6751 00DA4E 11 00                        	.word	17
   6752 00DA50 15 00                        	.word	21
   6753 00DA52 19 00                        	.word	25
   6754 00DA54 1D 00                        	.word	29
                                           
   6756 00DA56 01 00                        	.word	1
   6757 00DA58 05 00                        	.word	5
   6758 00DA5A 09 00                        	.word	9
   6759 00DA5C 0D 00                        	.word	13
   6760 00DA5E 11 00                        	.word	17
   6761 00DA60 15 00                        	.word	21
   6762 00DA62 19 00                        	.word	25
   6763 00DA64 1D 00                        	.word	29
                                           
   6765 00DA66 01 00                        	.word	1
   6766 00DA68 05 00                        	.word	5
   6767 00DA6A 09 00                        	.word	9
   6768 00DA6C 0D 00                        	.word	13
   6769 00DA6E 11 00                        	.word	17
   6770 00DA70 15 00                        	.word	21
   6771 00DA72 19 00                        	.word	25
   6772 00DA74 1D 00                        	.word	29
                                           
   6774 00DA76 01 00                        	.word	1
   6775 00DA78 05 00                        	.word	5
   6776 00DA7A 09 00                        	.word	9
   6777 00DA7C 0D 00                        	.word	13
   6778 00DA7E 11 00                        	.word	17
   6779 00DA80 15 00                        	.word	21
   6780 00DA82 19 00                        	.word	25
   6781 00DA84 1D 00                        	.word	29
                                           
   6783 00DA86                             InvaderType:
   6784 00DA86 01 00                        	.word	1
   6785 00DA88 01 00                        	.word	1
   6786 00DA8A 01 00                        	.word	1
   6787 00DA8C 01 00                        	.word	1
   6788 00DA8E 01 00                        	.word	1
   6789 00DA90 01 00                        	.word	1
   6790 00DA92 01 00                        	.word	1
   6791 00DA94 01 00                        	.word	1
                                           
   6793 00DA96 02 00                        	.word	2
   6794 00DA98 02 00                        	.word	2
   6795 00DA9A 02 00                        	.word	2
   6796 00DA9C 02 00                        	.word	2
   6797 00DA9E 02 00                        	.word	2
   6798 00DAA0 02 00                        	.word	2
   6799 00DAA2 02 00                        	.word	2
   6800 00DAA4 02 00                        	.word	2
                                           
   6802 00DAA6 02 00                        	.word	2
   6803 00DAA8 02 00                        	.word	2
   6804 00DAAA 02 00                        	.word	2
   6805 00DAAC 02 00                        	.word	2
   6806 00DAAE 02 00                        	.word	2
   6807 00DAB0 02 00                        	.word	2
   6808 00DAB2 02 00                        	.word	2
   6809 00DAB4 02 00                        	.word	2
                                           
   6811 00DAB6 03 00                        	.word	3
   6812 00DAB8 03 00                        	.word	3
   6813 00DABA 03 00                        	.word	3
   6814 00DABC 03 00                        	.word	3
   6815 00DABE 03 00                        	.word	3
   6816 00DAC0 03 00                        	.word	3
   6817 00DAC2 03 00                        	.word	3
   6818 00DAC4 03 00                        	.word	3
                                           
   6820 00DAC6 03 00                        	.word	3
   6821 00DAC8 03 00                        	.word	3
   6822 00DACA 03 00                        	.word	3
   6823 00DACC 03 00                        	.word	3
   6824 00DACE 03 00                        	.word	3
   6825 00DAD0 03 00                        	.word	3
   6826 00DAD2 03 00                        	.word	3
   6827 00DAD4 03 00                        	.word	3
                                           			
Finitron FT832 assembler   version 1.4   Thu Jan 19 07:11:31 2017     Page 1
FTBios816.asm


                                           .include "invaders.asm"
                                           
                                           ;	cpu		W65C816S
                                           	cpu		FT832
   6832 00DAD6 FF FF FF FF FF FF FF FF      	.org	$E000
   6832 00DADE FF FF FF FF FF FF FF FF    
   6832 00DAE6 FF FF FF FF FF FF FF FF    
   6832 00DAEE FF FF FF FF FF FF FF FF    
   6832 00DAF6 FF FF FF FF FF FF FF FF    
   6832 00DAFE FF FF FF FF FF FF FF FF    
   6832 00DB06 FF FF FF FF FF FF FF FF    
   6832 00DB0E FF FF FF FF FF FF FF FF    
   6832 00DB16 FF FF FF FF FF FF FF FF    
   6832 00DB1E FF FF FF FF FF FF FF FF    
   6832 00DB26 FF FF FF FF FF FF FF FF    
   6832 00DB2E FF FF FF FF FF FF FF FF    
   6832 00DB36 FF FF FF FF FF FF FF FF    
   6832 00DB3E FF FF FF FF FF FF FF FF    
   6832 00DB46 FF FF FF FF FF FF FF FF    
   6832 00DB4E FF FF FF FF FF FF FF FF    
   6832 00DB56 FF FF FF FF FF FF FF FF    
   6832 00DB5E FF FF FF FF FF FF FF FF    
   6832 00DB66 FF FF FF FF FF FF FF FF    
   6832 00DB6E FF FF FF FF FF FF FF FF    
   6832 00DB76 FF FF FF FF FF FF FF FF    
   6832 00DB7E FF FF FF FF FF FF FF FF    
   6832 00DB86 FF FF FF FF FF FF FF FF    
   6832 00DB8E FF FF FF FF FF FF FF FF    
   6832 00DB96 FF FF FF FF FF FF FF FF    
   6832 00DB9E FF FF FF FF FF FF FF FF    
   6832 00DBA6 FF FF FF FF FF FF FF FF    
   6832 00DBAE FF FF FF FF FF FF FF FF    
   6832 00DBB6 FF FF FF FF FF FF FF FF    
   6832 00DBBE FF FF FF FF FF FF FF FF    
   6832 00DBC6 FF FF FF FF FF FF FF FF    
   6832 00DBCE FF FF FF FF FF FF FF FF    
   6832 00DBD6 FF FF FF FF FF FF FF FF    
   6832 00DBDE FF FF FF FF FF FF FF FF    
   6832 00DBE6 FF FF FF FF FF FF FF FF    
   6832 00DBEE FF FF FF FF FF FF FF FF    
   6832 00DBF6 FF FF FF FF FF FF FF FF    
   6832 00DBFE FF FF FF FF FF FF FF FF    
   6832 00DC06 FF FF FF FF FF FF FF FF    
   6832 00DC0E FF FF FF FF FF FF FF FF    
   6832 00DC16 FF FF FF FF FF FF FF FF    
   6832 00DC1E FF FF FF FF FF FF FF FF    
   6832 00DC26 FF FF FF FF FF FF FF FF    
   6832 00DC2E FF FF FF FF FF FF FF FF    
   6832 00DC36 FF FF FF FF FF FF FF FF    
   6832 00DC3E FF FF FF FF FF FF FF FF    
   6832 00DC46 FF FF FF FF FF FF FF FF    
   6832 00DC4E FF FF FF FF FF FF FF FF    
   6832 00DC56 FF FF FF FF FF FF FF FF    
   6832 00DC5E FF FF FF FF FF FF FF FF    
   6832 00DC66 FF FF FF FF FF FF FF FF    
   6832 00DC6E FF FF FF FF FF FF FF FF    
   6832 00DC76 FF FF FF FF FF FF FF FF    
   6832 00DC7E FF FF FF FF FF FF FF FF    
   6832 00DC86 FF FF FF FF FF FF FF FF    
   6832 00DC8E FF FF FF FF FF FF FF FF    
   6832 00DC96 FF FF FF FF FF FF FF FF    
   6832 00DC9E FF FF FF FF FF FF FF FF    
   6832 00DCA6 FF FF FF FF FF FF FF FF    
   6832 00DCAE FF FF FF FF FF FF FF FF    
   6832 00DCB6 FF FF FF FF FF FF FF FF    
   6832 00DCBE FF FF FF FF FF FF FF FF    
   6832 00DCC6 FF FF FF FF FF FF FF FF    
   6832 00DCCE FF FF FF FF FF FF FF FF    
   6832 00DCD6 FF FF FF FF FF FF FF FF    
   6832 00DCDE FF FF FF FF FF FF FF FF    
   6832 00DCE6 FF FF FF FF FF FF FF FF    
   6832 00DCEE FF FF FF FF FF FF FF FF    
   6832 00DCF6 FF FF FF FF FF FF FF FF    
   6832 00DCFE FF FF FF FF FF FF FF FF    
   6832 00DD06 FF FF FF FF FF FF FF FF    
   6832 00DD0E FF FF FF FF FF FF FF FF    
   6832 00DD16 FF FF FF FF FF FF FF FF    
   6832 00DD1E FF FF FF FF FF FF FF FF    
   6832 00DD26 FF FF FF FF FF FF FF FF    
   6832 00DD2E FF FF FF FF FF FF FF FF    
   6832 00DD36 FF FF FF FF FF FF FF FF    
   6832 00DD3E FF FF FF FF FF FF FF FF    
   6832 00DD46 FF FF FF FF FF FF FF FF    
   6832 00DD4E FF FF FF FF FF FF FF FF    
   6832 00DD56 FF FF FF FF FF FF FF FF    
   6832 00DD5E FF FF FF FF FF FF FF FF    
   6832 00DD66 FF FF FF FF FF FF FF FF    
   6832 00DD6E FF FF FF FF FF FF FF FF    
   6832 00DD76 FF FF FF FF FF FF FF FF    
   6832 00DD7E FF FF FF FF FF FF FF FF    
   6832 00DD86 FF FF FF FF FF FF FF FF    
   6832 00DD8E FF FF FF FF FF FF FF FF    
   6832 00DD96 FF FF FF FF FF FF FF FF    
   6832 00DD9E FF FF FF FF FF FF FF FF    
   6832 00DDA6 FF FF FF FF FF FF FF FF    
   6832 00DDAE FF FF FF FF FF FF FF FF    
   6832 00DDB6 FF FF FF FF FF FF FF FF    
   6832 00DDBE FF FF FF FF FF FF FF FF    
   6832 00DDC6 FF FF FF FF FF FF FF FF    
   6832 00DDCE FF FF FF FF FF FF FF FF    
   6832 00DDD6 FF FF FF FF FF FF FF FF    
   6832 00DDDE FF FF FF FF FF FF FF FF    
   6832 00DDE6 FF FF FF FF FF FF FF FF    
   6832 00DDEE FF FF FF FF FF FF FF FF    
   6832 00DDF6 FF FF FF FF FF FF FF FF    
   6832 00DDFE FF FF FF FF FF FF FF FF    
   6832 00DE06 FF FF FF FF FF FF FF FF    
   6832 00DE0E FF FF FF FF FF FF FF FF    
   6832 00DE16 FF FF FF FF FF FF FF FF    
   6832 00DE1E FF FF FF FF FF FF FF FF    
   6832 00DE26 FF FF FF FF FF FF FF FF    
   6832 00DE2E FF FF FF FF FF FF FF FF    
   6832 00DE36 FF FF FF FF FF FF FF FF    
   6832 00DE3E FF FF FF FF FF FF FF FF    
   6832 00DE46 FF FF FF FF FF FF FF FF    
   6832 00DE4E FF FF FF FF FF FF FF FF    
   6832 00DE56 FF FF FF FF FF FF FF FF    
   6832 00DE5E FF FF FF FF FF FF FF FF    
   6832 00DE66 FF FF FF FF FF FF FF FF    
   6832 00DE6E FF FF FF FF FF FF FF FF    
   6832 00DE76 FF FF FF FF FF FF FF FF    
   6832 00DE7E FF FF FF FF FF FF FF FF    
   6832 00DE86 FF FF FF FF FF FF FF FF    
   6832 00DE8E FF FF FF FF FF FF FF FF    
   6832 00DE96 FF FF FF FF FF FF FF FF    
   6832 00DE9E FF FF FF FF FF FF FF FF    
   6832 00DEA6 FF FF FF FF FF FF FF FF    
   6832 00DEAE FF FF FF FF FF FF FF FF    
   6832 00DEB6 FF FF FF FF FF FF FF FF    
   6832 00DEBE FF FF FF FF FF FF FF FF    
   6832 00DEC6 FF FF FF FF FF FF FF FF    
   6832 00DECE FF FF FF FF FF FF FF FF    
   6832 00DED6 FF FF FF FF FF FF FF FF    
   6832 00DEDE FF FF FF FF FF FF FF FF    
   6832 00DEE6 FF FF FF FF FF FF FF FF    
   6832 00DEEE FF FF FF FF FF FF FF FF    
   6832 00DEF6 FF FF FF FF FF FF FF FF    
   6832 00DEFE FF FF FF FF FF FF FF FF    
   6832 00DF06 FF FF FF FF FF FF FF FF    
   6832 00DF0E FF FF FF FF FF FF FF FF    
   6832 00DF16 FF FF FF FF FF FF FF FF    
   6832 00DF1E FF FF FF FF FF FF FF FF    
   6832 00DF26 FF FF FF FF FF FF FF FF    
   6832 00DF2E FF FF FF FF FF FF FF FF    
   6832 00DF36 FF FF FF FF FF FF FF FF    
   6832 00DF3E FF FF FF FF FF FF FF FF    
   6832 00DF46 FF FF FF FF FF FF FF FF    
   6832 00DF4E FF FF FF FF FF FF FF FF    
   6832 00DF56 FF FF FF FF FF FF FF FF    
   6832 00DF5E FF FF FF FF FF FF FF FF    
   6832 00DF66 FF FF FF FF FF FF FF FF    
   6832 00DF6E FF FF FF FF FF FF FF FF    
   6832 00DF76 FF FF FF FF FF FF FF FF    
   6832 00DF7E FF FF FF FF FF FF FF FF    
   6832 00DF86 FF FF FF FF FF FF FF FF    
   6832 00DF8E FF FF FF FF FF FF FF FF    
   6832 00DF96 FF FF FF FF FF FF FF FF    
   6832 00DF9E FF FF FF FF FF FF FF FF    
   6832 00DFA6 FF FF FF FF FF FF FF FF    
   6832 00DFAE FF FF FF FF FF FF FF FF    
   6832 00DFB6 FF FF FF FF FF FF FF FF    
   6832 00DFBE FF FF FF FF FF FF FF FF    
   6832 00DFC6 FF FF FF FF FF FF FF FF    
   6832 00DFCE FF FF FF FF FF FF FF FF    
   6832 00DFD6 FF FF FF FF FF FF FF FF    
   6832 00DFDE FF FF FF FF FF FF FF FF    
   6832 00DFE6 FF FF FF FF FF FF FF FF    
   6832 00DFEE FF FF FF FF FF FF FF FF    
   6832 00DFF6 FF FF FF FF FF FF FF FF    
   6832 00DFFE FF FF                      
                                           
   6834 00E000                             start:
   6835 00E000 78                           	SEI
   6836 00E001 D8                           	CLD
                                           ;	CLV					; overflow low
                                           ;	SEC					; carry high
                                           ;	XCE					; sets 32 bit mode, 32 bit registers
                                           ;	REP		#$30		; 32 bit registers
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$3FFF
                                           ;	TAS
                                           ;
   6846 00E002 18                           	CLC					; switch to '816 mode
   6847 00E003 2C 00 E0                     	BIT		start		; set overflow bit
   6848 00E006 FB                           	XCE
   6849 00E007 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           	; Setup all the segment descriptors
                                           	; This must be done before the stack can be accessed, and
                                           	; before subroutine calls and task switching can be made.
                                           
                                           	; First setup segment #0, the segment the core starts running under.
                                           	; It's setup for flat addressing.
   6859 00E009 A9 00 00                     	LDA		#0
   6860 00E00C 42 EB                        	XBAW
   6861 00E00E A9 00 00                     	LDA		#0
   6862 00E011 A2 8D 09                     	LDX		#$98D		; present, writeable, executable, max size.
   6863 00E014 A8                           	TAY
   6864 00E015 42 BA                        	SDU
   6865 00E017 C8                           	INY
                                           
                                           	; Flag remaining segments as not present 
   6868 00E018 A2 00 00                     	LDX		#$000		; not present, non-executable, non-writeable, min size
   6869 00E01B                             .0003:
   6870 00E01B 42 BA                        	SDU					; update segment descriptor
   6871 00E01D C8                           	INY
   6872 00E01E C0 00 10                     	CPY		#4096
   6873 00E021 D0 F8                        	BNE		.0003
                                           
                                           	; setup code segment #1
   6876 00E023 A2 05 09                     	LDX		#$905		; executable, 64k
   6877 00E026 A8                           	TAY
   6878 00E027 C8                           	INY
   6879 00E028 42 BA                        	SDU
                                           	; setup data segment #2
   6881 00E02A A2 8B 08                     	LDX		#$88B		; writeable, 256M
   6882 00E02D C8                           	INY
   6883 00E02E 42 BA                        	SDU
                                           	; setup stack segment #3 (for 65c02 mode)
   6885 00E030 A2 82 08                     	LDX		#$882		; writeable, 1k (based at zero)
   6886 00E033 C8                           	INY
   6887 00E034 42 BA                        	SDU
                                           	; setup stack segment #4 (for 65c816 mode)
   6889 00E036 A2 85 08                     	LDX		#$885		; writeable, 64k (based at zero)
   6890 00E039 C8                           	INY
   6891 00E03A 42 BA                        	SDU
                                           	; seg #5 is the maxed out segment
   6893 00E03C A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   6894 00E03F C8                           	INY
   6895 00E040 42 BA                        	SDU
                                           	; seg #9 is the maxed out segment
   6897 00E042 A9 02 00                     	LDA		#2			; begin at $20000
   6898 00E045 42 EB                        	XBAW
   6899 00E047 A9 00 00                     	LDA		#0
   6900 00E04A A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   6901 00E04D A0 09 00                     	LDY		#9
   6902 00E050 42 BA                        	SDU
                                           	; now set the code segment (test far jump)
                                           	JMF		1:.0004
   6905 00E052                             .0004:
                                           	; set the stack segment
                                           	; (must be before PEA/PLDS)
   6908 00E052 A9 05 00                     	LDA		#5
   6909 00E055 42 5A                        	TASS
   6910 00E057 A9 FF 6B                     	LDA		#$6BFF		; set top of stack
   6911 00E05A 1B                           	TAS
                                           
                                           	; setup the programmable address decodes
   6914 00E05B A9 70 00                     	LDA		#$0070		; program chip selects for I/O
   6915 00E05E 8D 00 B0                     	STA		PCS0		; at $007000
   6916 00E061 A9 71 00                     	LDA		#$0071
   6917 00E064 8D 02 B0                     	STA		PCS1
                                           ;	LDA		#$FEA1		; select $FEA1xx I/O
                                           ;	STA		PCS3
   6920 00E067 A9 00 00                     	LDA		#$0000		; select zero page ram
   6921 00E06A 8D 0A B0                     	STA		PCS5
                                           
                                           	; set the data segment
                                           	; this must be setup after address decoding is setup
   6925 00E06D F4 05 00                     	PEA		5
   6926 00E070 42 2B                        	PLDS
                                           
                                           	; Setup the counters
   6929 00E072 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
                                           	; Counter #0 is setup as a free running tick count
   6933 00E074 A9 FF                        	LDA		#$FF		; set limit to $FFFFFF
   6934 00E076 8D 10 B0                     	STA		CTR0_LMT
   6935 00E079 8D 11 B0                     	STA		CTR0_LMT+1
   6936 00E07C 8D 12 B0                     	STA		CTR0_LMT+2
   6937 00E07F A9 14                        	LDA		#$14		; count up, on mpu clock
   6938 00E081 8D 13 B0                     	STA		CTR0_CTRL
                                           	; Counter #1 is set to interrupt at a 100Hz rate
   6940 00E084 A9 94                        	LDA		#$94		; divide by 95794 (for 100Hz)
   6941 00E086 8D 14 B0                     	STA		CTR1_LMT
   6942 00E089 A9 57                        	LDA		#$57
   6943 00E08B 8D 15 B0                     	STA		CTR1_LMT+1
   6944 00E08E A9 09                        	LDA		#$09
   6945 00E090 8D 16 B0                     	STA		CTR1_LMT+2
   6946 00E093 A9 05                        	LDA		#$05		; count down, on mpu clock, irq disenabled
   6947 00E095 8D 17 B0                     	STA		CTR1_CTRL
                                           	; Counter #2 isn't setup
                                           
   6950 00E098 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           ;	FORK	#7			; fork a BIOS context
                                           ;	TTA
                                           ;	CMP		#7
                                           ;	BNE		.0002
                                           ;	RTT
                                           ;.0002:
                                           	; Setup the task registers
   6961 00E09A A0 06 00                     	LDY		#6			; # tasks to setup
   6962 00E09D A2 01 00                     	LDX		#1
   6963 00E0A0                             .0001:
   6964 00E0A0 42 4C 75 F2 00 00            	LDT		TaskStartTbl,X
   6965 00E0A6 E8                           	INX
   6966 00E0A7 88                           	DEY
   6967 00E0A8 D0 F6                        	BNE		.0001
                                           
   6969 00E0AA 64 B8                        	STZ		running_task
                                           
   6971 00E0AC A9 0A F2                     	LDA		#BrkRout1
   6972 00E0AF 8D 02 01                     	STA		$0102
                                           
   6974 00E0B2 64 04                        	STZ		TickCount
   6975 00E0B4 64 06                        	STZ		TickCount+2
   6976 00E0B6                             Task0:
   6977 00E0B6 58                           	CLI
                                           	; Start the single stepping task.
   6979 00E0B7 A9 01 00                     	LDA		#$01
   6980 00E0BA 8D 00 70                     	STA		$7000
   6981 00E0BD 42 A2 03 00                  	TSK		#3
   6982 00E0C1                             .0001:
   6983 00E0C1 A9 04 00                     	LDA		#$04
   6984 00E0C4 8D 00 70                     	STA		$7000
   6985 00E0C7 A9 05 00                     	LDA		#5
   6986 00E0CA 85 44                        	STA		Vidptr+4
   6987 00E0CC 85 4A                        	STA		Vidregs+4
   6988 00E0CE A9 FD 00                     	LDA		#VIDBUF>>16
   6989 00E0D1 85 42                        	STA		Vidptr+2
   6990 00E0D3 64 40                        	STZ		Vidptr
   6991 00E0D5 A9 0D BF                     	LDA		#$BF0D	; 'm'
   6992 00E0D8 42 DA 42 87 40               	STA		FAR {Vidptr}
   6993 00E0DD A9 FE 00                     	LDA		#VIDREGS >> 16
   6994 00E0E0 85 48                        	STA		Vidregs+2
   6995 00E0E2 A9 00 A0                     	LDA		#VIDREGS
   6996 00E0E5 85 46                        	STA		Vidregs
   6997 00E0E7 A0 07 00                     	LDY		#7	
   6998 00E0EA A9 21 00                     	LDA		#$21		; divide by 3 vertically, 2 horizontally
   6999 00E0ED 20 0F EA                     	JSR		SetVideoReg	; clear POR state
   7000 00E0F0 A9 54 00                     	LDA		#84		; set window left position 84
   7001 00E0F3 A0 02 00                     	LDY		#2
   7002 00E0F6 20 0F EA                     	JSR		SetVideoReg
   7003 00E0F9 A9 00 00                     	LDA		#0
   7004 00E0FC A0 03 00                     	LDY		#3
   7005 00E0FF 20 0F EA                     	JSR		SetVideoReg
   7006 00E102 A9 10 00                     	LDA		#16			; set window top position
   7007 00E105 A0 04 00                     	LDY		#4
   7008 00E108 20 0F EA                     	JSR		SetVideoReg
   7009 00E10B 20 F4 E9                     	JSR		GetTextRowsCols
   7010 00E10E A9 BF E7                     	LDA		#DisplayChar
   7011 00E111 8D F0 03                     	STA		OutputVec
   7012 00E114 AD F0 03                     	LDA		OutputVec
   7013 00E117 C9 BF E7                     	CMP		#DisplayChar
   7014 00E11A D0 A5                        	BNE		.0001
   7015 00E11C A9 02 00                     	LDA		#$02
   7016 00E11F 8D 00 70                     	STA		$7000
   7017 00E122 A9 00 BF                     	LDA		#$BF00
   7018 00E125 85 36                        	STA		NormAttr
   7019 00E127 20 39 EA                     	JSR		ClearScreen
   7020 00E12A 20 84 E9                     	JSR		HomeCursor
   7021 00E12D 20 65 F4                     	JSR		beep
   7022 00E130 A9 03 00                     	LDA		#$03
   7023 00E133 8D 00 70                     	STA		$7000
   7024 00E136 F4 05 00                     	PEA		5
   7025 00E139 F4 4A E6                     	PEA		msgStarting
   7026 00E13C 20 C5 E9                     	JSR		DisplayString
                                           ;	SEP		#$1000		; turn on single step mode
   7028 00E13F A9 00 00                     	LDA		#0
   7029 00E142 8F 00 A2 FE                  	STA		FAC1
   7030 00E146 8F 02 A2 FE                  	STA		FAC1+2
   7031 00E14A 8F 04 A2 FE                  	STA		FAC1+4
   7032 00E14E 8F 06 A2 FE                  	STA		FAC1+6
   7033 00E152 8F 08 A2 FE                  	STA		FAC1+8
   7034 00E156 8F 0A A2 FE                  	STA		FAC1+10
                                           ;	LDA		#3
                                           ;	STA		$7000
                                           ;	LDA		#1234
                                           ;	STA		FAC1
                                           ;	LDA		#5			; FIX2FLT
                                           ;	JSR 	FPCommandWait
                                           ;	LDA		#4
                                           ;	STA		$7000
                                           ;	JSR		DivideByTen
                                           ;	LDA		#5
                                           ;	STA		$7000
                                           ;	JSR		FAC1ToString
                                           ;	PEA		2
                                           ;	PEA		$3A0
                                           ;	JSR		DisplayString
                                           ;	LDA		#' '
                                           ;	JSR		OutChar
                                           ;	JSR		DispFAC1
   7053 00E15A 42 A0 0B 00                  	FORK	#11
   7054 00E15E 42 1A                        	TTA
   7055 00E160 C9 0B 00                     	CMP		#11
   7056 00E163 F0 FF 2D 0A                  	LBEQ	KeybdInit
   7057 00E167 42 A0 07 00                  	FORK	#7			; fork a BIOS context
   7058 00E16B 42 1A                        	TTA
   7059 00E16D C9 07 00                     	CMP		#7
   7060 00E170 D0 06                        	BNE		.0002
   7061 00E172 A2 FF 23                     	LDX		#$23FF
   7062 00E175 9A                           	TXS
   7063 00E176 42 60                        	RTT
   7064 00E178                             .0002:
   7065 00E178 58                           	CLI
                                           
   7067 00E179                             Mon1:
   7068 00E179                             .mon1:
   7069 00E179 20 AD E9                     	JSR		OutCRLF
   7070 00E17C A9 24 00                     	LDA		#'$'
   7071 00E17F                             .mon3:
   7072 00E17F 20 B6 E9                     	JSR		OutChar
   7073 00E182 20 F5 EC                     	JSR		KeybdGetCharWait
   7074 00E185 29 FF 00                     	AND		#$FF
                                           ;	CMP		#'.'
                                           ;	BEQ		.mon3
   7077 00E188 C9 0D 00                     	CMP		#CR
   7078 00E18B D0 F2                        	BNE		.mon3
   7079 00E18D A5 32                        	LDA		CursorY
   7080 00E18F 0A                           	ASL
   7081 00E190 AA                           	TAX
   7082 00E191 42 1B BD 37 F2               	LDA		CS:LineTbl,X
   7083 00E196 0A                           	ASL
   7084 00E197 AA                           	TAX
   7085 00E198                             .mon4:
   7086 00E198 20 EE E5                     	JSR		IgnoreBlanks
   7087 00E19B 20 FF E1                     	JSR		MonGetch
   7088 00E19E C9 24 00                     	CMP		#'$'
   7089 00E1A1 F0 F5                        	BEQ		.mon4
   7090 00E1A3 C9 53 00                     	CMP		#'S'
   7091 00E1A6 D0 03                        	BNE		.mon2
   7092 00E1A8 4C 00 C0                     	JMP		$C000		; invoke Supermon816
   7093 00E1AB                             .mon2:
   7094 00E1AB C9 43 00                     	CMP		#'C'
   7095 00E1AE D0 08                        	BNE		.mon5
   7096 00E1B0 20 39 EA                     	JSR		ClearScreen
   7097 00E1B3 20 84 E9                     	JSR		HomeCursor
   7098 00E1B6 80 C1                        	BRA		.mon1
   7099 00E1B8                             .mon5:
   7100 00E1B8 C9 4D 00                     	CMP		#'M'
   7101 00E1BB D0 05                        	BNE		.mon6
   7102 00E1BD 20 6B E4                     	JSR		doMemoryDump
   7103 00E1C0 80 B7                        	BRA		Mon1
   7104 00E1C2                             .mon6:
   7105 00E1C2 C9 44 00                     	CMP		#'D'
   7106 00E1C5 F0 FF A5 03                  	LBEQ	doDisassemble
   7107 00E1C9 C9 3E 00                     	CMP		#'>'
   7108 00E1CC F0 FF 0D 03                  	LBEQ	doMemoryEdit
   7109 00E1D0 C9 46 00                     	CMP		#'F'
   7110 00E1D3 F0 FF 41 03                  	LBEQ	doFill
   7111 00E1D7 C9 4A 00                     	CMP		#'J'
   7112 00E1DA F0 FF E0 03                  	LBEQ	doJump
   7113 00E1DE C9 54 00                     	CMP		#'T'
   7114 00E1E1 F0 FF 33 00                  	LBEQ	doTask
   7115 00E1E5 C9 49 00                     	CMP		#'I'
   7116 00E1E8 F0 FF 36 00                  	LBEQ	doInvaders
   7117 00E1EC C9 52 00                     	CMP		#'R'
   7118 00E1EF F0 FF 3C 00                  	LBEQ	doRegs
   7119 00E1F3 82 83 FF                     	BRL		Mon1
                                           
                                           ; Get a character from the screen, skipping over spaces and tabs
                                           ;
   7123 00E1F6                             MonGetNonSpace:
   7124 00E1F6                             .0001:
   7125 00E1F6 20 FF E1                     	JSR		MonGetch
   7126 00E1F9 C9 20 00                     	CMP		#' '
   7127 00E1FC F0 F8                        	BEQ		.0001
   7128 00E1FE 60                           	RTS
                                           
                                           ; Get a character from the screen.
                                           ;
   7132 00E1FF                             MonGetch:
   7133 00E1FF BF 00 00 FD                  	LDA		VIDBUF,X
   7134 00E203 E8                           	INX
   7135 00E204 E8                           	INX
   7136 00E205 29 FF 00                     	AND		#$FF
   7137 00E208 20 B3 E7                     	JSR		ScreenToAscii
   7138 00E20B 60                           	RTS
                                           
   7140 00E20C                             MonErr:
   7141 00E20C F4 01 00                     	PEA		1
   7142 00E20F F4 CC F3                     	PEA		msgErr
   7143 00E212 20 C5 E9                     	JSR		DisplayString
   7144 00E215 82 61 FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7148 00E218                             doTask:
   7149 00E218 20 F1 EA                     	JSR		GetHexNumber
   7150 00E21B A5 0C                        	LDA		NumWorkArea
   7151 00E21D 42 3A                        	TSK
   7152 00E21F 82 57 FF                     	BRL		Mon1
                                           
   7154 00E222                             doInvaders:
   7155 00E222 A9 FF FF                     	LDA		#$FFFF
   7156 00E225 8D 68 78                     	STA		do_invaders
   7157 00E228 42 A2 05 00                  	TSK		#5
                                           ;	FORK	#5
                                           ;	TTA
                                           ;	CMP		#5
                                           ;	LBEQ	InvadersTask
   7162 00E22C 82 4A FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display Registers
                                           ; R<xx>		xx = context register to display
                                           ; Update Registers
                                           ; R.<reg> <val>
                                           ;	reg = CS PB PC A X Y SP SR DS DB or DP
                                           ;------------------------------------------------------------------------------
                                           
   7172 00E22F                             doRegs:
   7173 00E22F 20 FF E1                     	JSR		MonGetch
   7174 00E232 C9 2E 00                     	CMP		#'.'
   7175 00E235 D0 FF 13 01                  	LBNE	.0004
   7176 00E239 20 FF E1                     	JSR		MonGetch
   7177 00E23C C9 43 00                     	CMP		#'C'
   7178 00E23F D0 26                        	BNE		.0005
   7179 00E241 20 FF E1                     	JSR		MonGetch
   7180 00E244 C9 53 00                     	CMP		#'S'
   7181 00E247 D0 FF 2E FF                  	LBNE	Mon1
   7182 00E24B 20 EE E5                     	JSR		IgnoreBlanks
   7183 00E24E 20 F1 EA                     	JSR		GetHexNumber
   7184 00E251 A5 0C                        	LDA		NumWorkArea
   7185 00E253 85 80                        	STA		reg_cs
   7186 00E255 A5 0E                        	LDA		NumWorkArea+2
   7187 00E257 85 82                        	STA		reg_cs+2
   7188 00E259                             .buildrec
   7189 00E259 20 06 E4                     	JSR		BuildRec
   7190 00E25C A6 BE                        	LDX		WorkTR
   7191 00E25E 42 6C 00 01 00 00            	LDT		ldtrec
   7192 00E264 82 12 FF                     	BRL		Mon1
   7193 00E267                             .0005:
   7194 00E267 C9 50 00                     	CMP		#'P'
   7195 00E26A D0 27                        	BNE		.0006
   7196 00E26C 20 FF E1                     	JSR		MonGetch
   7197 00E26F C9 42 00                     	CMP		#'B'
   7198 00E272 D0 0C                        	BNE		.0007
   7199 00E274 20 EE E5                     	JSR		IgnoreBlanks
   7200 00E277 20 F1 EA                     	JSR		GetHexNumber
   7201 00E27A A5 0E                        	LDA		NumWorkArea+2
   7202 00E27C 85 8E                        	STA		reg_pc+2
   7203 00E27E 80 D9                        	BRA		.buildrec
   7204 00E280                             .0007:
   7205 00E280 C9 43 00                     	CMP		#'C'
   7206 00E283 D0 FF F2 FE                  	LBNE	Mon1
   7207 00E287 20 EE E5                     	JSR		IgnoreBlanks
   7208 00E28A 20 F1 EA                     	JSR		GetHexNumber
   7209 00E28D A5 0C                        	LDA		NumWorkArea
   7210 00E28F 85 8C                        	STA		reg_pc
   7211 00E291 80 C6                        	BRA		.buildrec
   7212 00E293                             .0006:
   7213 00E293 C9 41 00                     	CMP		#'A'
   7214 00E296 D0 10                        	BNE		.0008
   7215 00E298 20 EE E5                     	JSR		IgnoreBlanks
   7216 00E29B 20 F1 EA                     	JSR		GetHexNumber
   7217 00E29E A5 0C                        	LDA		NumWorkArea
   7218 00E2A0 85 90                        	STA		reg_a
   7219 00E2A2 A5 0E                        	LDA		NumWorkArea+2
   7220 00E2A4 85 92                        	STA		reg_a+2
   7221 00E2A6 80 B1                        	BRA		.buildrec
   7222 00E2A8                             .0008:
   7223 00E2A8 C9 58 00                     	CMP		#'X'
   7224 00E2AB D0 11                        	BNE		.0009
   7225 00E2AD 20 EE E5                     	JSR		IgnoreBlanks
   7226 00E2B0 20 F1 EA                     	JSR		GetHexNumber
   7227 00E2B3 A5 0C                        	LDA		NumWorkArea
   7228 00E2B5 85 94                        	STA		reg_x
   7229 00E2B7 A5 0E                        	LDA		NumWorkArea+2
   7230 00E2B9 85 96                        	STA		reg_x+2
   7231 00E2BB 82 9B FF                     	BRL		.buildrec
   7232 00E2BE                             .0009:
   7233 00E2BE C9 59 00                     	CMP		#'Y'
   7234 00E2C1 D0 11                        	BNE		.0010
   7235 00E2C3 20 EE E5                     	JSR		IgnoreBlanks
   7236 00E2C6 20 F1 EA                     	JSR		GetHexNumber
   7237 00E2C9 A5 0C                        	LDA		NumWorkArea
   7238 00E2CB 85 98                        	STA		reg_y
   7239 00E2CD A5 0E                        	LDA		NumWorkArea+2
   7240 00E2CF 85 9A                        	STA		reg_y+2
   7241 00E2D1 82 85 FF                     	BRL		.buildrec
   7242 00E2D4                             .0010:
   7243 00E2D4 C9 53 00                     	CMP		#'S'
   7244 00E2D7 D0 2D                        	BNE		.0011
   7245 00E2D9 20 FF E1                     	JSR		MonGetch
   7246 00E2DC C9 50 00                     	CMP		#'P'
   7247 00E2DF D0 11                        	BNE		.0015
   7248 00E2E1 20 EE E5                     	JSR		IgnoreBlanks
   7249 00E2E4 20 F1 EA                     	JSR		GetHexNumber
   7250 00E2E7 A5 0C                        	LDA		NumWorkArea
   7251 00E2E9 85 9C                        	STA		reg_sp
   7252 00E2EB A5 0E                        	LDA		NumWorkArea+2
   7253 00E2ED 85 9E                        	STA		reg_sp+2
   7254 00E2EF 82 67 FF                     	BRL		.buildrec
   7255 00E2F2                             .0015:
   7256 00E2F2 C9 52 00                     	CMP		#'R'
   7257 00E2F5 D0 FF 80 FE                  	LBNE	Mon1
   7258 00E2F9 20 EE E5                     	JSR		IgnoreBlanks
   7259 00E2FC 20 F1 EA                     	JSR		GetHexNumber
   7260 00E2FF A5 0C                        	LDA		NumWorkArea
   7261 00E301 85 A0                        	STA		reg_sr
   7262 00E303 82 53 FF                     	BRL		.buildrec
   7263 00E306                             .0011:
   7264 00E306 C9 44 00                     	CMP		#'D'
   7265 00E309 D0 FF 6C FE                  	LBNE	Mon1
   7266 00E30D 20 FF E1                     	JSR		MonGetch
   7267 00E310 C9 53 00                     	CMP		#'S'
   7268 00E313 D0 11                        	BNE		.0012
   7269 00E315 20 EE E5                     	JSR		IgnoreBlanks
   7270 00E318 20 F1 EA                     	JSR		GetHexNumber
   7271 00E31B A5 0C                        	LDA		NumWorkArea
   7272 00E31D 85 84                        	STA		reg_ds
   7273 00E31F A5 0E                        	LDA		NumWorkArea+2
   7274 00E321 85 86                        	STA		reg_ds+2
   7275 00E323 82 33 FF                     	BRL		.buildrec
   7276 00E326                             .0012:
   7277 00E326 C9 42 00                     	CMP		#'B'
   7278 00E329 D0 0D                        	BNE		.0013
   7279 00E32B 20 EE E5                     	JSR		IgnoreBlanks
   7280 00E32E 20 F1 EA                     	JSR		GetHexNumber
   7281 00E331 A5 0C                        	LDA		NumWorkArea
   7282 00E333 85 A4                        	STA		reg_db
   7283 00E335 82 21 FF                     	BRL		.buildrec
   7284 00E338                             .0013:
   7285 00E338 C9 50 00                     	CMP		#'P'
   7286 00E33B D0 FF 3A FE                  	LBNE	Mon1
   7287 00E33F 20 EE E5                     	JSR		IgnoreBlanks
   7288 00E342 20 F1 EA                     	JSR		GetHexNumber
   7289 00E345 A5 0C                        	LDA		NumWorkArea
   7290 00E347 85 A8                        	STA		reg_dp
   7291 00E349 82 0D FF                     	BRL		.buildrec
                                           
   7293 00E34C                             .0004:
   7294 00E34C CA                           	DEX
   7295 00E34D CA                           	DEX
                                           ;	JSR		IgnoreBlanks
   7297 00E34E 20 F1 EA                     	JSR		GetHexNumber
   7298 00E351 C0 00 00                     	CPY		#0
   7299 00E354 F0 FF 21 FE                  	LBEQ	Mon1
   7300 00E358 A5 0C                        	LDA		NumWorkArea
   7301 00E35A 85 BE                        	STA		WorkTR
   7302 00E35C 42 28 03 00                  	BSR		DispRegs
   7303 00E360 82 16 FE                     	BRL		Mon1
                                           
   7305 00E363                             DispRegs:
   7306 00E363 F4 01 00                     	PEA		1
   7307 00E366 F4 55 F3                     	PEA		msgRegs
   7308 00E369 20 C5 E9                     	JSR		DisplayString
   7309 00E36C 20 BD EA                     	JSR		space
                                           
   7311 00E36F A5 BE                        	LDA		WorkTR
   7312 00E371 0A                           	ASL
   7313 00E372 0A                           	ASL
   7314 00E373 0A                           	ASL
   7315 00E374 0A                           	ASL
   7316 00E375 AA                           	TAX
                                           
   7318 00E376 A0 00 00                     	LDY		#0
   7319 00E379                             .0001:
   7320 00E379 42 4A                        	INF
   7321 00E37B E8                           	INX
   7322 00E37C 99 80 00                     	STA		reg_cs,Y
   7323 00E37F 42 EB                        	XBAW
   7324 00E381 99 82 00                     	STA		reg_cs+2,Y
   7325 00E384 42 C8                        	INY4
   7326 00E386 C0 30 00                     	CPY		#48
   7327 00E389 D0 EE                        	BNE		.0001
                                           
                                           	; Display CS
   7330 00E38B A5 80                        	LDA		reg_cs
   7331 00E38D 20 96 EA                     	JSR		DispWord
   7332 00E390 A9 3A 00                     	LDA		#':'
   7333 00E393 20 B6 E9                     	JSR		OutChar
                                           
                                           	; Display PB PC
   7336 00E396 A5 8E                        	LDA		reg_pc+2
   7337 00E398 20 9B EA                     	JSR		DispByte
   7338 00E39B A5 8C                        	LDA		reg_pc
   7339 00E39D 20 96 EA                     	JSR		DispWord
   7340 00E3A0 20 BD EA                     	JSR		space
                                           
                                           	; Display SRX,SR
   7343 00E3A3 A5 A0                        	LDA		reg_cs+32
   7344 00E3A5 A2 10 00                     	LDX		#16
   7345 00E3A8                             .0003:
   7346 00E3A8 0A                           	ASL
   7347 00E3A9 48                           	PHA
   7348 00E3AA A9 30 00                     	LDA		#'0'
   7349 00E3AD 69 00 00                     	ADC		#0
   7350 00E3B0 20 A4 EA                     	JSR		DispNybble
   7351 00E3B3 68                           	PLA
   7352 00E3B4 CA                           	DEX
   7353 00E3B5 D0 F1                        	BNE		.0003
   7354 00E3B7 20 BD EA                     	JSR		space
                                           
   7356 00E3BA A2 10 00                     	LDX		#16
   7357 00E3BD                             .0002
                                           	; display Acc,.X,.Y,.SP
   7359 00E3BD B5 82                        	LDA		reg_cs+2,X
   7360 00E3BF 20 96 EA                     	JSR		DispWord
   7361 00E3C2 B5 80                        	LDA		reg_cs,X
   7362 00E3C4 20 96 EA                     	JSR		DispWord
   7363 00E3C7 20 BD EA                     	JSR		space
   7364 00E3CA 42 E8                        	INX4
   7365 00E3CC E0 20 00                     	CPX		#32
   7366 00E3CF D0 EC                        	BNE		.0002
                                           
   7368 00E3D1 F4 01 00                     	PEA		1
   7369 00E3D4 F4 B1 F3                     	PEA		msgRegs2
   7370 00E3D7 20 C5 E9                     	JSR		DisplayString
   7371 00E3DA 20 BD EA                     	JSR		space
                                           
                                           	; Display SS
   7374 00E3DD A5 88                        	LDA		reg_ss
   7375 00E3DF 20 96 EA                     	JSR		DispWord
   7376 00E3E2 20 BD EA                     	JSR		space
                                           
                                           	; Display DS
   7379 00E3E5 A5 84                        	LDA		reg_ds
   7380 00E3E7 20 96 EA                     	JSR		DispWord
   7381 00E3EA 20 BD EA                     	JSR		space
                                           
                                           	; Display DB
   7384 00E3ED A5 A4                        	LDA		reg_db
   7385 00E3EF 20 9B EA                     	JSR		DispByte
   7386 00E3F2 20 BD EA                     	JSR		space
                                           
                                           	; Display DPR
   7389 00E3F5 A5 A8                        	LDA		reg_dp
   7390 00E3F7 20 96 EA                     	JSR		DispWord
   7391 00E3FA 20 BD EA                     	JSR		space
                                           
                                           	; Display back link
   7394 00E3FD A5 AC                        	LDA		reg_bl
   7395 00E3FF 20 96 EA                     	JSR		DispWord
                                           
   7397 00E402 20 AD E9                     	JSR		OutCRLF
   7398 00E405 60                           	RTS
                                           
                                           ; Build a startup record from the register values so that a context reg
                                           ; may be loaded
                                           
   7403 00E406                             BuildRec:
   7404 00E406 A5 80                        	LDA		reg_cs
   7405 00E408 8D 00 01                     	STA		ldtrec
   7406 00E40B A5 84                        	LDA		reg_ds
   7407 00E40D 8D 02 01                     	STA		ldtrec+2
   7408 00E410 A5 88                        	LDA		reg_ss
   7409 00E412 8D 04 01                     	STA		ldtrec+4
   7410 00E415 A5 8C                        	LDA		reg_pc
   7411 00E417 8D 06 01                     	STA		ldtrec+6
   7412 00E41A A5 8E                        	LDA		reg_pc+2
   7413 00E41C 29 FF 00                     	AND		#$FF
   7414 00E41F E2 30                        	SEP		#$30		; 8 bit regs
                                           	MEM		8
   7416 00E421 EB                           	XBA
   7417 00E422 A5 90                        	LDA		reg_a
   7418 00E424 EB                           	XBA
   7419 00E425 C2 30                        	REP		#$30
                                           	MEM		16
   7421 00E427 8D 08 01                     	STA		ldtrec+8
   7422 00E42A A5 91                        	LDA		reg_a+1
   7423 00E42C 8D 0A 01                     	STA		ldtrec+10
   7424 00E42F A5 93                        	LDA		reg_a+3
   7425 00E431 8D 0C 01                     	STA		ldtrec+12
   7426 00E434 A5 95                        	LDA		reg_x+1
   7427 00E436 8D 0E 01                     	STA		ldtrec+14
   7428 00E439 A5 97                        	LDA		reg_x+3
   7429 00E43B 8D 10 01                     	STA		ldtrec+16
   7430 00E43E A5 99                        	LDA		reg_y+1
   7431 00E440 8D 12 01                     	STA		ldtrec+18
   7432 00E443 A5 9B                        	LDA		reg_y+3
   7433 00E445 8D 14 01                     	STA		ldtrec+20
   7434 00E448 A5 9D                        	LDA		reg_sp+1
   7435 00E44A 8D 16 01                     	STA		ldtrec+22
   7436 00E44D A5 9F                        	LDA		reg_sp+3
   7437 00E44F 8D 18 01                     	STA		ldtrec+24
   7438 00E452 E2 30                        	SEP		#$30
   7439 00E454 A5 A1                        	LDA		reg_sr+1
   7440 00E456 8D 1A 01                     	STA		ldtrec+26
   7441 00E459 A5 A4                        	LDA		reg_db
   7442 00E45B 8D 1B 01                     	STA		ldtrec+27
   7443 00E45E A5 A8                        	LDA		reg_dp
   7444 00E460 8D 1C 01                     	STA		ldtrec+28
   7445 00E463 A5 A9                        	LDA		reg_dp+1
   7446 00E465 8D 1D 01                     	STA		ldtrec+29
   7447 00E468 C2 30                        	REP		#$30
   7448 00E46A 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Dump memory.
                                           ;------------------------------------------------------------------------------
                                           
   7454 00E46B                             doMemoryDump:
   7455 00E46B 20 EE E5                     	JSR		IgnoreBlanks
   7456 00E46E 20 C6 EA                     	JSR		GetRange
   7457 00E471 20 AD E9                     	JSR		OutCRLF
   7458 00E474                             .0007:
   7459 00E474 A9 3E 00                     	LDA		#'>'
   7460 00E477 20 B6 E9                     	JSR		OutChar
   7461 00E47A 20 DE E5                     	JSR		DispRangeStart
   7462 00E47D A0 00 00                     	LDY		#0
   7463 00E480                             .0001:
   7464 00E480 42 B7 20                     	LDA		{RangeStart},Y
   7465 00E483 20 9B EA                     	JSR		DispByte
   7466 00E486 A9 20 00                     	LDA		#' '
   7467 00E489 20 B6 E9                     	JSR		OutChar
   7468 00E48C C8                           	INY
   7469 00E48D C0 08 00                     	CPY		#8
   7470 00E490 D0 EE                        	BNE		.0001
   7471 00E492 A0 00 00                     	LDY 	#0
   7472 00E495                             .0005:
   7473 00E495 42 B7 20                     	LDA		{RangeStart},Y
   7474 00E498 29 FF 00                     	AND		#$FF
   7475 00E49B C9 20 00                     	CMP		#' '
   7476 00E49E B0 05                        	BCS		.0002
   7477 00E4A0                             .0004:
   7478 00E4A0 A9 2E 00                     	LDA		#'.'
   7479 00E4A3 80 05                        	BRA		.0003
   7480 00E4A5                             .0002:
   7481 00E4A5 C9 7F 00                     	CMP		#$7f
   7482 00E4A8 B0 F6                        	BCS		.0004
   7483 00E4AA                             .0003:
   7484 00E4AA 20 B6 E9                     	JSR		OutChar
   7485 00E4AD C8                           	INY
   7486 00E4AE C0 08 00                     	CPY		#8
   7487 00E4B1 D0 E2                        	BNE		.0005
   7488 00E4B3 20 AD E9                     	JSR		OutCRLF
   7489 00E4B6 18                           	CLC
   7490 00E4B7 A5 20                        	LDA		RangeStart
   7491 00E4B9 69 08 00                     	ADC		#8
   7492 00E4BC 85 20                        	STA		RangeStart
   7493 00E4BE 90 02                        	BCC		.0006
   7494 00E4C0 E6 22                        	INC		RangeStart+2
   7495 00E4C2                             .0006:
   7496 00E4C2 38                           	SEC
   7497 00E4C3 A5 24                        	LDA		RangeEnd
   7498 00E4C5 E5 20                        	SBC		RangeStart
   7499 00E4C7 A5 26                        	LDA		RangeEnd+2
   7500 00E4C9 E5 22                        	SBC		RangeStart+2
   7501 00E4CB 08                           	PHP
   7502 00E4CC 20 EA EC                     	JSR		KeybdGetCharNoWait;Ctx,7
   7503 00E4CF 29 FF 00                     	AND		#$FF
   7504 00E4D2 C9 03 00                     	CMP		#CTRLC
   7505 00E4D5 F0 04                        	BEQ		.0009
   7506 00E4D7 28                           	PLP
   7507 00E4D8 10 9A                        	BPL		.0007
   7508 00E4DA                             .0008:
   7509 00E4DA 60                           	RTS
   7510 00E4DB                             .0009:
   7511 00E4DB 28                           	PLP
   7512 00E4DC 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Edit memory.
                                           ; ><memory address> <val1> <val2> ... <val8>
                                           ;------------------------------------------------------------------------------
                                           
   7519 00E4DD                             doMemoryEdit:
   7520 00E4DD 20 EE E5                     	JSR		IgnoreBlanks
   7521 00E4E0 20 F1 EA                     	JSR		GetHexNumber
   7522 00E4E3 C0 00 00                     	CPY		#0
   7523 00E4E6 F0 FF 8F FC                  	LBEQ	Mon1
   7524 00E4EA A5 0C                        	LDA		NumWorkArea
   7525 00E4EC 85 20                        	STA		RangeStart
   7526 00E4EE A5 0E                        	LDA		NumWorkArea+2
   7527 00E4F0 85 22                        	STA		RangeStart+2
   7528 00E4F2 A0 00 00                     	LDY		#0
   7529 00E4F5                             .0001:
   7530 00E4F5 5A                           	PHY
   7531 00E4F6 20 EE E5                     	JSR		IgnoreBlanks
   7532 00E4F9 20 F1 EA                     	JSR		GetHexNumber
   7533 00E4FC C0 00 00                     	CPY		#0
   7534 00E4FF F0 13                        	BEQ		.0002
   7535 00E501 7A                           	PLY
   7536 00E502 E2 20                        	SEP		#$20
   7537 00E504 A5 0C                        	LDA		NumWorkArea
   7538 00E506 42 97 20                     	STA		{RangeStart},Y
   7539 00E509 C2 20                        	REP		#$20
   7540 00E50B C8                           	INY
   7541 00E50C C0 08 00                     	CPY		#8
   7542 00E50F D0 E4                        	BNE		.0001
   7543 00E511 82 65 FC                     	BRL		Mon1
   7544 00E514                             .0002:
   7545 00E514 7A                           	PLY
   7546 00E515 82 61 FC                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Fill memory.
                                           ; $F <start address> <end address> <val1>
                                           ;------------------------------------------------------------------------------
                                           
   7553 00E518                             doFill:
   7554 00E518 20 EE E5                     	JSR		IgnoreBlanks
   7555 00E51B 20 F1 EA                     	JSR		GetHexNumber
   7556 00E51E C0 00 00                     	CPY		#0
   7557 00E521 F0 FF E7 FC                  	LBEQ	MonErr
   7558 00E525 A5 0C                        	LDA		NumWorkArea
   7559 00E527 85 20                        	STA		RangeStart
   7560 00E529 A5 0E                        	LDA		NumWorkArea+2
   7561 00E52B 85 22                        	STA		RangeStart+2
   7562 00E52D 20 EE E5                     	JSR		IgnoreBlanks
   7563 00E530 20 F1 EA                     	JSR		GetHexNumber
   7564 00E533 C0 00 00                     	CPY		#0
   7565 00E536 F0 FF D2 FC                  	LBEQ	MonErr
   7566 00E53A A5 0C                        	LDA		NumWorkArea
   7567 00E53C 85 24                        	STA		RangeEnd
   7568 00E53E A5 0E                        	LDA		NumWorkArea+2
   7569 00E540 85 26                        	STA		RangeEnd+2
   7570 00E542 20 EE E5                     	JSR		IgnoreBlanks
   7571 00E545 20 F1 EA                     	JSR		GetHexNumber
   7572 00E548 C0 00 00                     	CPY		#0
   7573 00E54B F0 FF BD FC                  	LBEQ	MonErr
   7574 00E54F A6 0C                        	LDX		NumWorkArea
                                           	; Process in 32 bit mode
   7576 00E551 42 E2 00 02                  	SEP		#$200
   7577 00E555 42 C2 00 01                  	REP		#$100
   7578 00E559 A5 24                        	LDA		RangeEnd
   7579 00E55B 38                           	SEC
   7580 00E55C E5 20                        	SBC		RangeStart
   7581 00E55E A4 20                        	LDY		RangeStart
   7582 00E560 42 44 00                     	FIL		$00
                                           	; Back to 16 bits mode
   7584 00E563 42 C2 00 02                  	REP		#$200
   7585 00E567 42 E2 00 01                  	SEP		#$100
   7586 00E56B 82 0B FC                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Disassemble code
                                           ;------------------------------------------------------------------------------
                                           
   7592 00E56E                             doDisassemble:
   7593 00E56E 20 FF E1                     	JSR		MonGetch
   7594 00E571 C9 4D 00                     	CMP		#'M'
   7595 00E574 F0 11                        	BEQ		.0002
   7596 00E576                             .0004:
   7597 00E576 C9 4E 00                     	CMP		#'N'
   7598 00E579 D0 1B                        	BNE		.0003
   7599 00E57B E2 20                        	SEP		#$20
                                           	MEM		8
   7601 00E57D A5 BC                        	LDA		$BC
   7602 00E57F 09 40                        	ORA		#$40
   7603 00E581 85 BC                        	STA		$BC
   7604 00E583 C2 20                        	REP		#$20
   7605 00E585 80 11                        	BRA		.0005
   7606 00E587                             .0002:
   7607 00E587 E2 20                        	SEP		#$20
   7608 00E589 A5 BC                        	LDA		$BC
   7609 00E58B 09 80                        	ORA		#$80
   7610 00E58D 85 BC                        	STA		$BC
   7611 00E58F C2 20                        	REP		#$20
   7612 00E591 20 FF E1                     	JSR		MonGetch
   7613 00E594 80 E0                        	BRA		.0004
                                           	MEM		16
   7615 00E596                             .0003:
   7616 00E596 CA                           	DEX
   7617 00E597 CA                           	DEX
   7618 00E598                             .0005:
   7619 00E598 20 EE E5                     	JSR		IgnoreBlanks
   7620 00E59B 20 C6 EA                     	JSR		GetRange
   7621 00E59E A5 20                        	LDA		RangeStart
   7622 00E5A0 85 8F                        	STA		$8F				; addra
   7623 00E5A2 A5 21                        	LDA		RangeStart+1
   7624 00E5A4 85 90                        	STA		$90
   7625 00E5A6 20 AD E9                     	JSR		OutCRLF
   7626 00E5A9 A0 14 00                     	LDY		#20
   7627 00E5AC                             .0001:
   7628 00E5AC 5A                           	PHY
   7629 00E5AD E2 30                        	SEP		#$30
   7630 00E5AF 20 6F C6                     	JSR		dpycod
   7631 00E5B2 C2 30                        	REP		#$30
   7632 00E5B4 20 AD E9                     	JSR		OutCRLF
   7633 00E5B7 7A                           	PLY
   7634 00E5B8 88                           	DEY
   7635 00E5B9 D0 F1                        	BNE		.0001
   7636 00E5BB 4C 79 E1                     	JMP		Mon1
                                           
                                           ;$BC flimflag
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Jump to subroutine
                                           ;------------------------------------------------------------------------------
                                           
   7644 00E5BE                             doJump:
   7645 00E5BE 20 EE E5                     	JSR		IgnoreBlanks
   7646 00E5C1 20 F1 EA                     	JSR		GetHexNumber
   7647 00E5C4 C0 00 00                     	CPY		#0
   7648 00E5C7 F0 FF AE FB                  	LBEQ	Mon1
   7649 00E5CB A9 5C 00                     	LDA		#$5C			; JML opcode
   7650 00E5CE 85 23                        	STA		RangeEnd-1
   7651 00E5D0 A5 0C                        	LDA		NumWorkArea
   7652 00E5D2 85 24                        	STA		RangeEnd
   7653 00E5D4 A5 0D                        	LDA		NumWorkArea+1
   7654 00E5D6 85 25                        	STA		RangeEnd+1
   7655 00E5D8 22 24 00                     	JSL		RangeEnd
   7656 00E5DB 82 9B FB                     	BRL		Mon1
                                           
   7658 00E5DE                             DispRangeStart:
   7659 00E5DE A5 21                        	LDA		RangeStart+1
   7660 00E5E0 20 96 EA                     	JSR		DispWord
   7661 00E5E3 A5 20                        	LDA		RangeStart
   7662 00E5E5 20 9B EA                     	JSR		DispByte
   7663 00E5E8 A9 20 00                     	LDA		#' '
   7664 00E5EB 4C B6 E9                     	JMP		OutChar
                                           	
                                           ; Skip over blanks in the input
                                           ;------------------------------------------------------------------------------
                                           
   7669 00E5EE                             IgnoreBlanks:
   7670 00E5EE                             .0001:
   7671 00E5EE 20 FF E1                     	JSR		MonGetch
   7672 00E5F1 C9 20 00                     	CMP		#' '
   7673 00E5F4 F0 F8                        	BEQ		.0001
   7674 00E5F6 CA                           	DEX
   7675 00E5F7 CA                           	DEX
   7676 00E5F8 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; BIOSInput allows full screen editing of text until a carriage return is keyed
                                           ; at which point the line the cursor is on is copied to a buffer. The buffer
                                           ; must be at least TEXTCOLS characters in size.
                                           ;------------------------------------------------------------------------------
                                           ;
   7684 00E5F9                             BIOSInput:
   7685 00E5F9                             .bin1:
   7686 00E5F9 20 F5 EC                     	JSR		KeybdGetCharWait
   7687 00E5FC 29 FF 00                     	AND		#$FF
   7688 00E5FF C9 0D 00                     	CMP		#CR
   7689 00E602 F0 05                        	BEQ		.bin2
   7690 00E604 20 B6 E9                     	JSR		OutChar
   7691 00E607 80 F0                        	BRA		.bin1
   7692 00E609                             .bin2:
   7693 00E609 A5 30                        	LDA		CursorX
   7694 00E60B F0 1A                        	BEQ		.bin4
   7695 00E60D A5 34                        	LDA		VideoPos	; get current video position
   7696 00E60F 38                           	SEC
   7697 00E610 E5 30                        	SBC		CursorX		; go back to the start of the line
   7698 00E612 0A                           	ASL
   7699 00E613 AA                           	TAX
   7700 00E614                             .bin3:
   7701 00E614 BF 00 00 FD                  	LDA		VIDBUF,X
   7702 00E618 29 FF 00                     	AND		#$FF
   7703 00E61B 93 03                        	STA		(3,s),Y
   7704 00E61D E8                           	INX
   7705 00E61E E8                           	INX
   7706 00E61F C8                           	INY
   7707 00E620 C6 30                        	DEC		CursorX
   7708 00E622 D0 F0                        	BNE		.bin3
   7709 00E624 A9 00 00                     	LDA		#0
   7710 00E627                             .bin4:
   7711 00E627 93 03                        	STA		(3,s),Y	; NULL terminate buffer
   7712 00E629 60                           	RTS
                                           
   7714 00E62A                             .st0003:
   7715 00E62A AF 10 A1 FE                  	LDA		KEYBD
   7716 00E62E 10 FA                        	BPL		.st0003
   7717 00E630 48                           	PHA					; save off the char (we need to trash acc)
   7718 00E631 AF 14 A1 FE                  	LDA		KEYBD+4		; clear keyboard strobe (must be a read operation)
   7719 00E635 68                           	PLA					; restore char
   7720 00E636 20 BF E7                     	JSR		DisplayChar
   7721 00E639 80 EF                        	BRA		.st0003
   7722 00E63B A0 00 00                     	ldy		#$0000
   7723 00E63E                             .st0001:
   7724 00E63E A2 00 00                     	ldx		#$0000
   7725 00E641                             .st0002:
   7726 00E641 E8                           	inx
   7727 00E642 D0 FD                        	bne		.st0002
   7728 00E644 20 67 E6                     	jsr		echo_switch
   7729 00E647 C8                           	iny
   7730 00E648 80 F4                        	bra		.st0001
                                           
   7732 00E64A                             msgStarting:
   7733 00E64A 46 54 38 33 32 20 54 65      	.byte	"FT832 Test System Starting",CR,LF,0
   7733 00E652 73 74 20 53 79 73 74 65    
   7733 00E65A 6D 20 53 74 61 72 74 69    
   7733 00E662 6E 67 0D 0A 00             
                                           
   7735 00E667                             echo_switch:
   7736 00E667 AD 00 71                     	lda		$7100
   7737 00E66A 8D 00 70                     	sta		$7000
   7738 00E66D 60                           	rts
                                           
                                           ;------------------------------------------------------------------------------
                                           ; On entry to the SSM task the .A register will be set to the task number
                                           ; being single stepped. The .X register will contain the address of the
                                           ; next instruction to execute.
                                           ;------------------------------------------------------------------------------
                                           
   7746 00E66E                             SSMInit:
                                           	; setup SSM data segment in SDT
   7748 00E66E A0 06 00                     	LDY		#6
   7749 00E671 A9 01 00                     	LDA		#1
   7750 00E674 42 EB                        	XBAW
   7751 00E676 A9 00 00                     	LDA		#$0000
   7752 00E679 A2 82 08                     	LDX		#$882		; 1k data
   7753 00E67C 42 BA                        	SDU
                                           	; Setup SSM stack segment in SDT
   7755 00E67E C8                           	INY
   7756 00E67F A9 00 04                     	LDA		#$0400
   7757 00E682 A2 82 08                     	LDX		#$882		; 1k stack
   7758 00E685 42 BA                        	SDU
                                           	; Setup SSM code segment in SDT
   7760 00E687 C8                           	INY
   7761 00E688 A9 00 00                     	LDA		#$0000
   7762 00E68B 42 EB                        	XBAW
   7763 00E68D A9 00 00                     	LDA		#$0000
   7764 00E690 A2 05 09                     	LDX		#$905
   7765 00E693 42 BA                        	SDU
                                           	JMF		8:.0001
   7767 00E695                             .0001:
                                           	; Initialize data selector and stack selector, pointer
                                           	; The stack is begin switched from the one currently defined by
                                           	; by the task table. So the return task needs to be popped off
                                           	; the current stack and placed on the new one.
   7772 00E695 FA                           	PLX					; get the task to return to
   7773 00E696 A9 07 00                     	LDA		#7
   7774 00E699 78                           	SEI
   7775 00E69A 42 5A                        	TASS
   7776 00E69C A9 FF 03                     	LDA		#$3FF		; setup stack pointer
   7777 00E69F 1B                           	TAS
   7778 00E6A0 58                           	CLI
   7779 00E6A1 DA                           	PHX					; save return task on new stack
   7780 00E6A2 F4 06 00                     	PEA		6
   7781 00E6A5 42 2B                        	PLDS
                                           
   7783 00E6A7 A9 00 61                     	LDA		#$6100
   7784 00E6AA 85 36                        	STA		NormAttr
   7785 00E6AC A9 05 00                     	LDA		#5			; set segment
   7786 00E6AF 85 44                        	STA		Vidptr+4
   7787 00E6B1 85 4A                        	STA		Vidregs+4
   7788 00E6B3 A9 FB 00                     	LDA		#$00FB		; screen location is $FB0000
   7789 00E6B6 85 42                        	STA		Vidptr+2
   7790 00E6B8 64 40                        	STZ		Vidptr
   7791 00E6BA A9 FE 00                     	LDA		#$00FE		; regset is at $FEA010
   7792 00E6BD 85 48                        	STA		Vidregs+2
   7793 00E6BF A9 10 A0                     	LDA		#$A010
   7794 00E6C2 85 46                        	STA		Vidregs
   7795 00E6C4 A0 07 00                     	LDY		#7
   7796 00E6C7 A9 10 00                     	LDA		#$10		; divide by 2 vertically, 1 horizontally
   7797 00E6CA 20 0F EA                     	JSR		SetVideoReg
   7798 00E6CD A9 B4 00                     	LDA		#180		; set window left position 672
   7799 00E6D0 A0 02 00                     	LDY		#2
   7800 00E6D3 20 0F EA                     	JSR		SetVideoReg
   7801 00E6D6 A9 02 00                     	LDA		#2
   7802 00E6D9 A0 03 00                     	LDY		#3
   7803 00E6DC 20 0F EA                     	JSR		SetVideoReg
   7804 00E6DF A9 20 00                     	LDA		#32			; set window top position
   7805 00E6E2 A0 04 00                     	LDY		#4
   7806 00E6E5 20 0F EA                     	JSR		SetVideoReg
   7807 00E6E8 20 F4 E9                     	JSR		GetTextRowsCols
   7808 00E6EB A9 BF E7                     	LDA		#DisplayChar
   7809 00E6EE 8D F0 03                     	STA		OutputVec
   7810 00E6F1 20 39 EA                     	JSR		ClearScreen
   7811 00E6F4 20 84 E9                     	JSR		HomeCursor
   7812 00E6F7 F4 08 00                     	PEA		8
   7813 00E6FA F4 75 E7                     	PEA		msgSSM
   7814 00E6FD 20 C5 E9                     	JSR		DisplayString
   7815 00E700 42 60                        	RTT
   7816 00E702                             SSMTask:
   7817 00E702 85 BE                        	STA		WorkTR
   7818 00E704 20 63 E3                     	JSR		DispRegs
   7819 00E707                             .0004:
   7820 00E707 A9 53 00                     	LDA		#'S'
   7821 00E70A 20 B6 E9                     	JSR		OutChar
   7822 00E70D A9 53 00                     	LDA		#'S'
   7823 00E710 20 B6 E9                     	JSR		OutChar
   7824 00E713 A9 4D 00                     	LDA		#'M'
   7825 00E716 20 B6 E9                     	JSR		OutChar
   7826 00E719 A9 3E 00                     	LDA		#'>'
   7827 00E71C                             .0005:
   7828 00E71C 20 B6 E9                     	JSR		OutChar
   7829 00E71F                             .0008:
   7830 00E71F 20 F5 EC                     	JSR		KeybdGetCharWait
   7831 00E722 B0 FB                        	BCS		.0008
   7832 00E724 29 FF 00                     	AND		#$FF
   7833 00E727 C9 53 00                     	CMP		#'S'		; step
   7834 00E72A D0 04                        	BNE		.0001
   7835 00E72C                             .0002:
   7836 00E72C 42 60                        	RTT
   7837 00E72E 80 D2                        	BRA		SSMTask
   7838 00E730                             .0001:
   7839 00E730 C9 58 00                     	CMP		#'X'
   7840 00E733 D0 16                        	BNE		.0006
   7841 00E735 A5 A0                        	LDA		reg_sr
   7842 00E737 29 FF EF                     	AND		#$EFFF
   7843 00E73A 85 A0                        	STA		reg_sr
   7844 00E73C 20 06 E4                     	JSR		BuildRec
   7845 00E73F A6 BE                        	LDX		WorkTR
   7846 00E741 42 6C 00 01 00 00            	LDT		ldtrec
   7847 00E747 42 60                        	RTT
   7848 00E749 80 B7                        	BRA		SSMTask
   7849 00E74B                             .0006:
   7850 00E74B C9 0D 00                     	CMP		#CR
   7851 00E74E D0 CC                        	BNE		.0005
   7852 00E750 A5 32                        	LDA		CursorY
   7853 00E752 0A                           	ASL
   7854 00E753 AA                           	TAX
   7855 00E754 42 1B BD 37 F2               	LDA		CS:LineTbl,X
   7856 00E759 18                           	CLC
   7857 00E75A 69 04 00                     	ADC		#4
   7858 00E75D 0A                           	ASL
   7859 00E75E AA                           	TAX
   7860 00E75F 20 EE E5                     	JSR		IgnoreBlanks
   7861 00E762 20 FF E1                     	JSR		MonGetch
   7862 00E765 C9 4D 00                     	CMP		#'M'
   7863 00E768 D0 03                        	BNE		.0007
   7864 00E76A 20 6B E4                     	JSR		doMemoryDump
   7865 00E76D                             .0007:
   7866 00E76D 82 AC FF                     	BRL		.0005
   7867 00E770 42 60                        	RTT
   7868 00E772 82 8D FF                     	BRL		SSMTask
                                           
   7870 00E775                             msgSSM:
   7871 00E775 53 69 6E 67 6C 65 20 73      	.byte	"Single step mode task starting.",CR,LF,0
   7871 00E77D 74 65 70 20 6D 6F 64 65    
   7871 00E785 20 74 61 73 6B 20 73 74    
   7871 00E78D 61 72 74 69 6E 67 2E 0D    
   7871 00E795 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert Ascii character to screen character.
                                           ;------------------------------------------------------------------------------
                                           
   7877 00E797                             AsciiToScreen:
   7878 00E797 29 FF 00                     	AND		#$FF
   7879 00E79A 89 20 00                     	BIT		#%00100000	; if bit 5 isn't set
   7880 00E79D F0 08                        	BEQ		.00001
   7881 00E79F 89 40 00                     	BIT		#%01000000	; or bit 6 isn't set
   7882 00E7A2 F0 03                        	BEQ		.00001
   7883 00E7A4 29 9F 00                     	AND		#%10011111
   7884 00E7A7                             .00001:
   7885 00E7A7 60                           	rts
                                           
                                           	MEM		8
   7888 00E7A8                             AsciiToScreen8:
   7889 00E7A8 89 20                        	BIT		#%00100000	; if bit 5 isn't set
   7890 00E7AA F0 06                        	BEQ		.00001
   7891 00E7AC 89 40                        	BIT		#%01000000	; or bit 6 isn't set
   7892 00E7AE F0 02                        	BEQ		.00001
   7893 00E7B0 29 9F                        	AND		#%10011111
   7894 00E7B2                             .00001:
   7895 00E7B2 60                           	rts
                                           
                                           	MEM		16
                                           ;------------------------------------------------------------------------------
                                           ; Convert screen character to ascii character
                                           ;------------------------------------------------------------------------------
                                           ;
   7902 00E7B3                             ScreenToAscii:
   7903 00E7B3 29 FF 00                     	AND		#$FF
   7904 00E7B6 C9 1B 00                     	CMP		#26+1
   7905 00E7B9 B0 03                        	BCS		.0001
   7906 00E7BB 69 60 00                     	ADC		#$60
   7907 00E7BE                             .0001:
   7908 00E7BE 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display a character on the screen device
                                           ; Expects the processor to be in 16 bit mode with 16 bit acc and 16 bit indexes
                                           ;------------------------------------------------------------------------------
                                           ;
   7915 00E7BF                             DisplayChar:
   7916 00E7BF 29 FF 00                     	AND		#$0FF
   7917 00E7C2 24 3C                        	BIT		EscState
   7918 00E7C4 30 FF 89 00                  	LBMI	processEsc
   7919 00E7C8 C9 08 00                     	CMP		#BS
   7920 00E7CB F0 FF 33 01                  	LBEQ	doBackSpace
   7921 00E7CF C9 91 00                     	CMP		#$91			; cursor right
   7922 00E7D2 F0 FF 89 01                  	LBEQ	doCursorRight
   7923 00E7D6 C9 93 00                     	CMP		#$93			; cursor left
   7924 00E7D9 F0 FF 8D 01                  	LBEQ	doCursorLeft
   7925 00E7DD C9 90 00                     	CMP		#$90			; cursor up
   7926 00E7E0 F0 FF 8D 01                  	LBEQ	doCursorUp
   7927 00E7E4 C9 92 00                     	CMP		#$92			; cursor down
   7928 00E7E7 F0 FF 8D 01                  	LBEQ	doCursorDown
   7929 00E7EB C9 99 00                     	CMP		#$99			; delete
   7930 00E7EE F0 FF 3B 01                  	LBEQ	doDelete
   7931 00E7F2 C9 0D 00                     	CMP		#CR
   7932 00E7F5 F0 47                        	BEQ		doCR
   7933 00E7F7 C9 0A 00                     	CMP		#LF
   7934 00E7FA F0 47                        	BEQ		doLF
   7935 00E7FC C9 94 00                     	CMP		#$94
   7936 00E7FF F0 FF 54 01                  	LBEQ	doCursorHome	; cursor home
   7937 00E803 C9 1B 00                     	CMP		#ESC
   7938 00E806 D0 05                        	BNE		.0003
   7939 00E808 64 3C                        	STZ		EscState		; put a -1 in the escape state
   7940 00E80A C6 3C                        	DEC		EscState
   7941 00E80C 60                           	RTS
   7942 00E80D                             .0003:
   7943 00E80D 20 97 E7                     	JSR		AsciiToScreen
   7944 00E810 05 36                        	ORA		NormAttr
   7945 00E812 48                           	PHA
   7946 00E813 A5 34                        	LDA		VideoPos
   7947 00E815 0A                           	ASL
   7948 00E816 A8                           	TAY
   7949 00E817 68                           	PLA
   7950 00E818 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   7951 00E81D A5 30                        	LDA		CursorX
   7952 00E81F 1A                           	INA
   7953 00E820 C5 4C                        	CMP		Textcols
   7954 00E822 D0 15                        	BNE		.0001
   7955 00E824 64 30                        	STZ		CursorX
   7956 00E826 A5 32                        	LDA		CursorY
   7957 00E828 C9 1E 00                     	CMP		#TEXTROWS-1
   7958 00E82B F0 06                        	BEQ		.0002
   7959 00E82D 1A                           	INA
   7960 00E82E 85 32                        	STA		CursorY
   7961 00E830 82 58 01                     	BRL		SyncVideoPos
   7962 00E833                             .0002:
   7963 00E833 20 8B E9                     	JSR		SyncVideoPos
   7964 00E836 82 19 02                     	BRL		ScrollUp
   7965 00E839                             .0001:
   7966 00E839 85 30                        	STA		CursorX
   7967 00E83B 82 4D 01                     	BRL		SyncVideoPos
   7968 00E83E                             doCR:
   7969 00E83E 64 30                        	STZ		CursorX
   7970 00E840 82 48 01                     	BRL		SyncVideoPos
   7971 00E843                             doLF:
   7972 00E843 A5 32                        	LDA		CursorY
   7973 00E845 1A                           	INA
   7974 00E846 C5 4E                        	CMP		Textrows
   7975 00E848 10 FF 06 02                  	LBPL	ScrollUp
   7976 00E84C 85 32                        	STA		CursorY
   7977 00E84E 82 3A 01                     	BRL		SyncVideoPos
                                           
   7979 00E851                             processEsc:
   7980 00E851 A6 3C                        	LDX		EscState
   7981 00E853 E0 FF FF                     	CPX		#-1
   7982 00E856 D0 45                        	BNE		.0006
   7983 00E858 C9 54 00                     	CMP		#'T'	; clear to EOL
   7984 00E85B D0 1D                        	BNE		.0003
   7985 00E85D A5 34                        	LDA		VideoPos
   7986 00E85F 0A                           	ASL
   7987 00E860 A8                           	TAY
   7988 00E861 A6 30                        	LDX		CursorX
   7989 00E863 E8                           	INX
   7990 00E864                             .0001:
   7991 00E864 E4 4C                        	CPX		Textcols
   7992 00E866 10 0F                        	BPL		.0002
   7993 00E868 A9 20 00                     	LDA		#' '
   7994 00E86B 05 36                        	ORA		NormAttr
   7995 00E86D 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   7996 00E872 E8                           	INX
   7997 00E873 C8                           	INY
   7998 00E874 C8                           	INY
   7999 00E875 D0 ED                        	BNE		.0001
   8000 00E877                             .0002:
   8001 00E877 64 3C                        	STZ		EscState
   8002 00E879 60                           	RTS
   8003 00E87A                             .0003:
   8004 00E87A C9 57 00                     	CMP		#'W'
   8005 00E87D D0 05                        	BNE		.0004
   8006 00E87F 64 3C                        	STZ		EscState
   8007 00E881 82 A9 00                     	BRL		doDelete
   8008 00E884                             .0004:
   8009 00E884 C9 60 00                     	CMP		#'`'
   8010 00E887 D0 06                        	BNE		.0005
   8011 00E889 A9 FE FF                     	LDA		#-2
   8012 00E88C 85 3C                        	STA		EscState
   8013 00E88E 60                           	RTS
   8014 00E88F                             .0005:
   8015 00E88F C9 28 00                     	CMP		#'('
   8016 00E892 D0 06                        	BNE		.0008
   8017 00E894 A9 FD FF                     	LDA		#-3
   8018 00E897 85 3C                        	STA		EscState
   8019 00E899 60                           	RTS
   8020 00E89A                             .0008:
   8021 00E89A 64 3C                        	STZ		EscState
   8022 00E89C 60                           	RTS
   8023 00E89D                             .0006:
   8024 00E89D E0 FE FF                     	CPX		#-2
   8025 00E8A0 D0 11                        	BNE		.0007
   8026 00E8A2 64 3C                        	STZ		EscState
   8027 00E8A4 C9 31 00                     	CMP		#'1'
   8028 00E8A7 F0 FF 6E 01                  	LBEQ	CursorOn
   8029 00E8AB C9 30 00                     	CMP		#'0'
   8030 00E8AE F0 FF 77 01                  	LBEQ	CursorOff
   8031 00E8B2 60                           	RTS
   8032 00E8B3                             .0007:
   8033 00E8B3 E0 FD FF                     	CPX		#-3
   8034 00E8B6 D0 0B                        	BNE		.0009
   8035 00E8B8 C9 1B 00                     	CMP		#ESC
   8036 00E8BB D0 DD                        	BNE		.0008
   8037 00E8BD A9 FC FF                     	LDA		#-4
   8038 00E8C0 85 3C                        	STA		EscState
   8039 00E8C2 60                           	RTS
   8040 00E8C3                             .0009:
   8041 00E8C3 E0 FC FF                     	CPX		#-4
   8042 00E8C6 D0 0B                        	BNE		.0010
   8043 00E8C8 C9 47 00                     	CMP		#'G'
   8044 00E8CB D0 CD                        	BNE		.0008
   8045 00E8CD A9 FB FF                     	LDA		#-5
   8046 00E8D0 85 3C                        	STA		EscState
   8047 00E8D2 60                           	RTS
   8048 00E8D3                             .0010:
   8049 00E8D3 E0 FB FF                     	CPX		#-5
   8050 00E8D6 D0 C2                        	BNE		.0008
   8051 00E8D8 64 3C                        	STZ		EscState
   8052 00E8DA C9 34 00                     	CMP		#'4'
   8053 00E8DD D0 12                        	BNE		.0011
   8054 00E8DF A5 36                        	LDA		NormAttr
                                           	; Swap the high nybbles of the attribute
   8056 00E8E1 EB                           	XBA				
   8057 00E8E2 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
   8060 00E8E4 2A                           	ROL
   8061 00E8E5 2A                           	ROL
   8062 00E8E6 2A                           	ROL
   8063 00E8E7 2A                           	ROL
   8064 00E8E8 C2 30                        	REP		#$30		; set 16 bit regs
                                           	NDX		16			; tell the assembler
                                           	MEM		16
   8067 00E8EA EB                           	XBA
   8068 00E8EB 29 00 FF                     	AND		#$FF00
   8069 00E8EE 85 36                        	STA		NormAttr
   8070 00E8F0 60                           	RTS
   8071 00E8F1                             .0011:
   8072 00E8F1 C9 30 00                     	CMP		#'0'
   8073 00E8F4 D0 06                        	BNE		.0012
   8074 00E8F6 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8075 00E8F9 85 36                        	STA		NormAttr
   8076 00E8FB 60                           	RTS
   8077 00E8FC                             .0012:
   8078 00E8FC A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8079 00E8FF 85 36                        	STA		NormAttr
   8080 00E901 60                           	RTS
                                           
   8082 00E902                             doBackSpace:
   8083 00E902 A6 30                        	LDX		CursorX
   8084 00E904 F0 26                        	BEQ		.0001		; Can't backspace anymore
   8085 00E906 A5 34                        	LDA		VideoPos
   8086 00E908 0A                           	ASL
   8087 00E909 A8                           	TAY
   8088 00E90A                             .0002:
   8089 00E90A 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8090 00E90F 88                           	DEY
   8091 00E910 88                           	DEY
   8092 00E911 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8093 00E916 42 C8                        	INY4
   8094 00E918 E8                           	INX
   8095 00E919 E4 4C                        	CPX		Textcols
   8096 00E91B D0 ED                        	BNE		.0002
   8097 00E91D                             .0003:
   8098 00E91D A9 20 00                     	LDA		#' '
   8099 00E920 05 36                        	ORA		NormAttr
   8100 00E922 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8101 00E927 C6 30                        	DEC		CursorX
   8102 00E929 82 5F 00                     	BRL		SyncVideoPos
   8103 00E92C                             .0001:
   8104 00E92C 60                           	RTS
                                           
                                           ; Deleting a character does not change the video position so there's no need
                                           ; to resynchronize it.
                                           
   8109 00E92D                             doDelete:
   8110 00E92D A6 30                        	LDX		CursorX
   8111 00E92F A5 34                        	LDA		VideoPos
   8112 00E931 0A                           	ASL
   8113 00E932 A8                           	TAY
   8114 00E933                             .0002:
   8115 00E933 E8                           	INX
   8116 00E934 E4 4C                        	CPX		Textcols
   8117 00E936 10 14                        	BPL		.0001
   8118 00E938 CA                           	DEX
   8119 00E939 C8                           	INY
   8120 00E93A C8                           	INY
   8121 00E93B 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8122 00E940 88                           	DEY
   8123 00E941 88                           	DEY
   8124 00E942 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8125 00E947 C8                           	INY
   8126 00E948 C8                           	INY
   8127 00E949 E8                           	INX
   8128 00E94A 80 E7                        	BRA		.0002
   8129 00E94C                             .0001:
   8130 00E94C A9 20 00                     	LDA		#' '
   8131 00E94F 05 36                        	ORA		NormAttr
   8132 00E951 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8133 00E956 60                           	RTS
                                           
   8135 00E957                             doCursorHome:
   8136 00E957 A5 30                        	LDA		CursorX
   8137 00E959 F0 24                        	BEQ		doCursor1
   8138 00E95B 64 30                        	STZ		CursorX
   8139 00E95D 80 2C                        	BRA		SyncVideoPos
   8140 00E95F                             doCursorRight:
   8141 00E95F A5 30                        	LDA		CursorX
   8142 00E961 1A                           	INA
   8143 00E962 C5 4C                        	CMP		Textcols
   8144 00E964 10 1D                        	BPL		doRTS
   8145 00E966                             doCursor2:
   8146 00E966 85 30                        	STA		CursorX
   8147 00E968 80 21                        	BRA		SyncVideoPos
   8148 00E96A                             doCursorLeft:
   8149 00E96A A5 30                        	LDA		CursorX
   8150 00E96C F0 15                        	BEQ		doRTS
   8151 00E96E 3A                           	DEA
   8152 00E96F 80 F5                        	BRA		doCursor2
   8153 00E971                             doCursorUp:
   8154 00E971 A5 32                        	LDA		CursorY
   8155 00E973 F0 0E                        	BEQ		doRTS
   8156 00E975 3A                           	DEA
   8157 00E976 80 07                        	BRA		doCursor1
   8158 00E978                             doCursorDown:
   8159 00E978 A5 32                        	LDA		CursorY
   8160 00E97A 1A                           	INA
   8161 00E97B C5 4E                        	CMP		Textrows
   8162 00E97D 10 04                        	BPL		doRTS
   8163 00E97F                             doCursor1:
   8164 00E97F 85 32                        	STA		CursorY
   8165 00E981 80 08                        	BRA		SyncVideoPos
   8166 00E983                             doRTS:
   8167 00E983 60                           	RTS
                                           
   8169 00E984                             HomeCursor:
   8170 00E984 A9 00 00                     	LDA		#0
   8171 00E987 64 30                        	STZ		CursorX
   8172 00E989 64 32                        	STZ		CursorY
                                           
                                           ; Synchronize the absolute video position with the cursor co-ordinates.
                                           ;
   8176 00E98B                             SyncVideoPos:
   8177 00E98B 5A                           	PHY
   8178 00E98C A5 32                        	LDA		CursorY
   8179 00E98E 42 3B 05 00 8D 00 70         	STA		5:$7000
   8180 00E995 0A                           	ASL
   8181 00E996 AA                           	TAX
   8182 00E997 42 3B 05 00 BD 37 F2         	LDA		5:LineTbl,X
   8183 00E99E 18                           	CLC
   8184 00E99F 65 30                        	ADC		CursorX
   8185 00E9A1 85 34                        	STA		VideoPos
   8186 00E9A3 A0 0D 00                     	LDY		#13
   8187 00E9A6 42 DA 42 97 46               	STA		FAR {Vidregs},Y		; Update the position in the text controller
   8188 00E9AB 7A                           	PLY
   8189 00E9AC 60                           	RTS
                                           
   8191 00E9AD                             OutCRLF:
   8192 00E9AD A9 0D 00                     	LDA		#CR
   8193 00E9B0 20 B6 E9                     	JSR		OutChar
   8194 00E9B3 A9 0A 00                     	LDA		#LF
                                           
   8196 00E9B6                             OutChar:
   8197 00E9B6 08                           	PHP
   8198 00E9B7 C2 30                        	REP		#$30
   8199 00E9B9 DA                           	PHX
   8200 00E9BA 5A                           	PHY
   8201 00E9BB A2 00 00                     	LDX		#0
   8202 00E9BE FC F0 03                     	JSR		(OutputVec,x)
   8203 00E9C1 7A                           	PLY
   8204 00E9C2 FA                           	PLX
   8205 00E9C3 28                           	PLP
   8206 00E9C4 60                           	RTS
                                           
   8208 00E9C5                             DisplayString:
                                           ;	PLA							; pop return address
                                           ;	PLX							; get string address parameter
                                           ;	PHA							; push return address
   8212 00E9C5 08                           	PHP							; push reg settings
   8213 00E9C6 E2 20                        	SEP		#$20				; ACC = 8 bit
                                           	MEM		8
                                           ;	STX		StringPos
   8216 00E9C8 A0 00 00                     	LDY		#0
   8217 00E9CB                             .0002:
   8218 00E9CB 42 DA B3 04                  	LDA		FAR (4,S),Y
   8219 00E9CF F0 06                        	BEQ		.0001
   8220 00E9D1 20 5E F1                     	JSR		SuperPutch
   8221 00E9D4 C8                           	INY
   8222 00E9D5 80 F4                        	BRA		.0002
   8223 00E9D7                             .0001:
   8224 00E9D7 28                           	PLP							; restore regs settings
                                           ;	REP		#$20				; ACC 16 bits
                                           	MEM		16
   8227 00E9D8 42 C0 04                     	RTS		#4					; pop stack argument
                                           
   8229 00E9DB                             DisplayString2:
   8230 00E9DB 68                           	PLA							; pop return address
   8231 00E9DC FA                           	PLX							; get string address parameter
   8232 00E9DD 48                           	PHA							; push return address
   8233 00E9DE E2 20                        	SEP		#$20				; ACC = 8 bit
   8234 00E9E0 86 38                        	STX		StringPos
   8235 00E9E2 A0 00 00                     	LDY		#0
   8236 00E9E5 A2 32 00                     	LDX		#50
   8237 00E9E8                             .0002:
   8238 00E9E8 B1 38                        	LDA		(StringPos),Y
   8239 00E9EA 20 5E F1                     	JSR		SuperPutch
   8240 00E9ED C8                           	INY
   8241 00E9EE CA                           	DEX
   8242 00E9EF D0 F7                        	BNE		.0002
   8243 00E9F1                             .0001:
   8244 00E9F1 C2 20                        	REP		#$20				; ACC 16 bits
   8245 00E9F3 60                           	RTS
                                           
   8247 00E9F4                             GetTextRowsCols:
   8248 00E9F4 48                           	PHA
   8249 00E9F5 5A                           	PHY
   8250 00E9F6 A0 00 00                     	LDY		#0
   8251 00E9F9 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8252 00EA00 85 4C                        	STA		Textcols
   8253 00EA02 C8                           	INY
   8254 00EA03 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8255 00EA0A 85 4E                        	STA		Textrows
   8256 00EA0C 7A                           	PLY
   8257 00EA0D 68                           	PLA
   8258 00EA0E 60                           	RTS
                                           
                                           ; .Y = register number to set
                                           ; Acc = value
                                           ;
   8263 00EA0F                             SetVideoReg:
   8264 00EA0F 08                           	PHP								; save regs size settings
   8265 00EA10 E2 20                        	SEP		#$20
   8266 00EA12 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8267 00EA17 28                           	PLP								; restore reg size settings
   8268 00EA18 60                           	RTS
                                           
   8270 00EA19                             CursorOn:
   8271 00EA19 48                           	PHA
   8272 00EA1A 5A                           	PHY
   8273 00EA1B A0 09 00                     	LDY		#9
   8274 00EA1E A9 60 1F                     	LDA		#$1F60
   8275 00EA21 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8276 00EA26 7A                           	PLY
   8277 00EA27 68                           	PLA
   8278 00EA28 60                           	RTS
                                           
   8280 00EA29                             CursorOff:
   8281 00EA29 48                           	PHA
   8282 00EA2A 5A                           	PHY
   8283 00EA2B A0 09 00                     	LDY		#9
   8284 00EA2E A9 20 00                     	LDA		#$0020
   8285 00EA31 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8286 00EA36 7A                           	PLY
   8287 00EA37 68                           	PLA
   8288 00EA38 60                           	RTS
                                           
   8290 00EA39                             ClearScreen:
   8291 00EA39 A2 FF 0F                     	LDX		#4095
   8292 00EA3C A0 00 00                     	LDY		#$00
   8293 00EA3F A9 20 00                     	LDA		#' '
   8294 00EA42 20 97 E7                     	JSR		AsciiToScreen
   8295 00EA45 05 36                        	ORA		NormAttr
   8296 00EA47                             .0001:
   8297 00EA47 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8298 00EA4C C8                           	INY
   8299 00EA4D C8                           	INY
   8300 00EA4E CA                           	DEX
   8301 00EA4F D0 F6                        	BNE		.0001
   8302 00EA51 60                           	RTS
                                           
   8304 00EA52                             ScrollUp:
   8305 00EA52 A0 00 00                     	LDY		#0
   8306 00EA55 A2 FF 0F                     	LDX 	#4095
   8307 00EA58                             .0001:
   8308 00EA58 5A                           	PHY
   8309 00EA59 98                           	TYA
   8310 00EA5A 18                           	CLC
   8311 00EA5B 65 4C                        	ADC		Textcols
   8312 00EA5D 18                           	CLC
   8313 00EA5E 65 4C                        	ADC		Textcols
   8314 00EA60 A8                           	TAY
   8315 00EA61 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8316 00EA66 7A                           	PLY
   8317 00EA67 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8318 00EA6C C8                           	INY
   8319 00EA6D C8                           	INY
   8320 00EA6E CA                           	DEX
   8321 00EA6F D0 E7                        	BNE		.0001
   8322 00EA71 A5 4E                        	LDA		Textrows
   8323 00EA73 3A                           	DEA
                                           
   8325 00EA74                             BlankLine:
   8326 00EA74 0A                           	ASL
   8327 00EA75 A8                           	TAY
   8328 00EA76 42 1B B9 37 F2               	LDA		CS:LineTbl,Y
   8329 00EA7B 0A                           	ASL
   8330 00EA7C A8                           	TAY
   8331 00EA7D A6 4C                        	LDX		Textcols
   8332 00EA7F A5 36                        	LDA		NormAttr
   8333 00EA81 09 20 00                     	ORA		#$20
   8334 00EA84                             .0001:
   8335 00EA84 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8336 00EA89 C8                           	INY
   8337 00EA8A C8                           	INY
   8338 00EA8B CA                           	DEX
   8339 00EA8C D0 F6                        	BNE		.0001
   8340 00EA8E 60                           	RTS
                                           
   8342 00EA8F                             DispDWord:
   8343 00EA8F 42 EB                        	XBAW
   8344 00EA91 20 96 EA                     	JSR		DispWord
   8345 00EA94 42 EB                        	XBAW
   8346 00EA96                             DispWord:
   8347 00EA96 EB                           	XBA
   8348 00EA97 20 9B EA                     	JSR		DispByte
   8349 00EA9A EB                           	XBA
   8350 00EA9B                             DispByte:
   8351 00EA9B 48                           	PHA
   8352 00EA9C 4A                           	LSR
   8353 00EA9D 4A                           	LSR
   8354 00EA9E 4A                           	LSR
   8355 00EA9F 4A                           	LSR
   8356 00EAA0 20 A4 EA                     	JSR		DispNybble
   8357 00EAA3 68                           	PLA
   8358 00EAA4                             DispNybble:
   8359 00EAA4 48                           	PHA
   8360 00EAA5 29 0F 00                     	AND		#$0F
   8361 00EAA8 C9 0A 00                     	CMP		#10
   8362 00EAAB 90 08                        	BCC		.0001
   8363 00EAAD 69 36 00                     	ADC		#'A'-11			; -11 cause the carry is set
   8364 00EAB0 20 B6 E9                     	JSR		OutChar
   8365 00EAB3 68                           	PLA
   8366 00EAB4 60                           	RTS
   8367 00EAB5                             .0001:
   8368 00EAB5 09 30 00                     	ORA		#'0'
   8369 00EAB8 20 B6 E9                     	JSR		OutChar
   8370 00EABB 68                           	PLA
   8371 00EABC 60                           	RTS
                                           
   8373 00EABD                             space:
   8374 00EABD 48                           	PHA
   8375 00EABE A9 20 00                     	LDA		#' '
   8376 00EAC1 20 B6 E9                     	JSR		OutChar
   8377 00EAC4 68                           	PLA
   8378 00EAC5 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get a range (two hex numbers)
                                           ;------------------------------------------------------------------------------
                                           
   8384 00EAC6                             GetRange:
   8385 00EAC6 20 EE E5                     	JSR		IgnoreBlanks
   8386 00EAC9 20 F1 EA                     	JSR		GetHexNumber
   8387 00EACC C0 00 00                     	CPY		#0
   8388 00EACF F0 1F                        	BEQ		.0001
   8389 00EAD1 A5 0C                        	LDA		NumWorkArea
   8390 00EAD3 85 20                        	STA		RangeStart
   8391 00EAD5 85 24                        	STA		RangeEnd
   8392 00EAD7 A5 0E                        	LDA		NumWorkArea+2
   8393 00EAD9 85 22                        	STA		RangeStart+2
   8394 00EADB 85 26                        	STA		RangeEnd+2
   8395 00EADD 20 EE E5                     	JSR		IgnoreBlanks
   8396 00EAE0 20 F1 EA                     	JSR		GetHexNumber
   8397 00EAE3 C0 00 00                     	CPY		#0
   8398 00EAE6 F0 08                        	BEQ		.0001
   8399 00EAE8 A5 0C                        	LDA		NumWorkArea
   8400 00EAEA 85 24                        	STA		RangeEnd
   8401 00EAEC A5 0E                        	LDA		NumWorkArea+2
   8402 00EAEE 85 26                        	STA		RangeEnd+2
   8403 00EAF0                             .0001:
   8404 00EAF0 60                           	RTS
                                           	
                                           ; Get a hexidecimal number. Maximum of six digits.
                                           ; .X = text pointer (updated)
                                           ;------------------------------------------------------------------------------
                                           ;
   8410 00EAF1                             GetHexNumber:
   8411 00EAF1 A0 00 00                     	LDY		#0					; maximum of eight digits
   8412 00EAF4 64 0C                        	STZ		NumWorkArea
   8413 00EAF6 64 0E                        	STZ		NumWorkArea+2
   8414 00EAF8                             gthxn2:
   8415 00EAF8 20 FF E1                     	JSR		MonGetch
   8416 00EAFB 20 1E EB                     	JSR		AsciiToHexNybble
   8417 00EAFE 30 1B                        	BMI		gthxn1
   8418 00EB00 06 0C                        	ASL		NumWorkArea
   8419 00EB02 26 0E                        	ROL		NumWorkArea+2
   8420 00EB04 06 0C                        	ASL		NumWorkArea
   8421 00EB06 26 0E                        	ROL		NumWorkArea+2
   8422 00EB08 06 0C                        	ASL		NumWorkArea
   8423 00EB0A 26 0E                        	ROL		NumWorkArea+2
   8424 00EB0C 06 0C                        	ASL		NumWorkArea
   8425 00EB0E 26 0E                        	ROL		NumWorkArea+2
   8426 00EB10 05 0C                        	ORA		NumWorkArea
   8427 00EB12 85 0C                        	STA		NumWorkArea
   8428 00EB14 C8                           	INY
   8429 00EB15 C0 08 00                     	CPY		#8
   8430 00EB18 D0 DE                        	BNE		gthxn2
   8431 00EB1A 60                           	RTS
   8432 00EB1B                             gthxn1:
   8433 00EB1B CA                           	DEX
   8434 00EB1C CA                           	DEX
   8435 00EB1D 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert ASCII character in the range '0' to '9', 'a' to 'f' or 'A' to 'F'
                                           ; to a hex nybble.
                                           ;------------------------------------------------------------------------------
                                           ;
   8442 00EB1E                             AsciiToHexNybble:
   8443 00EB1E C9 30 00                     	CMP		#'0'
   8444 00EB21 90 30                        	BCC		gthx3
   8445 00EB23 C9 3A 00                     	CMP		#'9'+1
   8446 00EB26 B0 05                        	BCS		gthx5
   8447 00EB28 38                           	SEC
   8448 00EB29 E9 30 00                     	SBC		#'0'
   8449 00EB2C 60                           	RTS
   8450 00EB2D                             gthx5:
   8451 00EB2D C9 41 00                     	CMP		#'A'
   8452 00EB30 90 21                        	BCC		gthx3
   8453 00EB32 C9 47 00                     	CMP		#'F'+1
   8454 00EB35 B0 09                        	BCS		gthx6
   8455 00EB37 38                           	SEC
   8456 00EB38 E9 41 00                     	SBC		#'A'
   8457 00EB3B 18                           	CLC
   8458 00EB3C 69 0A 00                     	ADC		#10
   8459 00EB3F 60                           	RTS
   8460 00EB40                             gthx6:
   8461 00EB40 C9 61 00                     	CMP		#'a'
   8462 00EB43 90 0E                        	BCC		gthx3
   8463 00EB45 C9 7B 00                     	CMP		#'z'+1
   8464 00EB48 B0 09                        	BCS		gthx3
   8465 00EB4A 38                           	SEC
   8466 00EB4B E9 61 00                     	SBC		#'a'
   8467 00EB4E 18                           	CLC
   8468 00EB4F 69 0A 00                     	ADC		#10
   8469 00EB52 60                           	RTS
   8470 00EB53                             gthx3:
   8471 00EB53 A9 FF FF                     	LDA		#-1		; not a hex number
   8472 00EB56 60                           	RTS
                                           
   8474 00EB57                             AsciiToDecNybble:
   8475 00EB57 C9 30 00                     	CMP		#'0'
   8476 00EB5A 90 0A                        	BCC		gtdc3
   8477 00EB5C C9 3A 00                     	CMP		#'9'+1
   8478 00EB5F B0 05                        	BCS		gtdc3
   8479 00EB61 38                           	SEC
   8480 00EB62 E9 30 00                     	SBC		#'0'
   8481 00EB65 60                           	RTS
   8482 00EB66                             gtdc3:
   8483 00EB66 A9 FF FF                     	LDA		#-1
   8484 00EB69 60                           	RTS
                                           
   8486 00EB6A                             getcharNoWait:
   8487 00EB6A A9 01 00                     	LDA		#1
   8488 00EB6D 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8489 00EB71 42 A2 06 00                  	TSK		#6
   8490 00EB75 42 5B A5 BA                  	LDA		ZS:keybd_char
   8491 00EB79 10 02                        	BPL		.0001
   8492 00EB7B 38                           	SEC
   8493 00EB7C 60                           	RTS
   8494 00EB7D                             .0001:
   8495 00EB7D 18                           	CLC
   8496 00EB7E 60                           	RTS
                                           
   8498 00EB7F                             getcharWait:
   8499 00EB7F A9 02 00                     	LDA		#2
   8500 00EB82 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8501 00EB86 42 A2 06 00                  	TSK		#6
   8502 00EB8A 42 5B A5 BA                  	LDA		ZS:keybd_char
   8503 00EB8E 10 02                        	BPL		.0001
   8504 00EB90 38                           	SEC
   8505 00EB91 60                           	RTS
   8506 00EB92                             .0001:
   8507 00EB92 18                           	CLC
   8508 00EB93 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; Keyboard processing routines follow.
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
   8516 00EB94                             KeybdInit:
   8517 00EB94 A9 00 20                     	LDA		#$2000
   8518 00EB97 1B                           	TAS
   8519 00EB98 A9 05 00                     	LDA		#5
   8520 00EB9B 85 BC                        	STA		keybd_cmd
   8521 00EB9D E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8524 00EB9F 64 08                        	STZ		KeyState1
   8525 00EBA1 64 09                        	STZ		KeyState2
   8526 00EBA3 A0 0C                        	LDY		#12
   8527 00EBA5 42 60                        	RTT
   8528 00EBA7                             .resetAgain:
   8529 00EBA7 A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8530 00EBA9 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8531 00EBAF 20 93 EC                     	JSR		KeybdWaitTx
   8532 00EBB2                             .0001:
   8533 00EBB2 20 72 EC                     	JSR		KeybdRecvByte	; Look for $AA
   8534 00EBB5 90 54                        	BCC		.tryAgain
   8535 00EBB7 C9 AA                        	CMP		#$AA			;
   8536 00EBB9 F0 33                        	BEQ		.config
   8537 00EBBB                             .0002:
                                           	; wait until keyboard not busy
   8539 00EBBB 20 AF EC                     	JSR		Wait10ms
   8540 00EBBE 42 5B AF 11 A1 FE            	LDA		ZS:KEYBD+1		;
   8541 00EBC4 89 40                        	BIT		#$40
   8542 00EBC6 D0 43                        	BNE		.tryAgain
   8543 00EBC8 A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8544 00EBCA 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8545 00EBD0 20 AF EC                     	JSR		Wait10ms
   8546 00EBD3 20 93 EC                     	JSR		KeybdWaitTx		; wait until no longer busy
   8547 00EBD6 20 72 EC                     	JSR		KeybdRecvByte	; look for an ACK ($FA)
   8548 00EBD9 90 30                        	BCC		.tryAgain
   8549 00EBDB C9 FE                        	CMP		#$FE
   8550 00EBDD F0 2C                        	BEQ		.tryAgain
   8551 00EBDF C9 FA                        	CMP		#$FA
   8552 00EBE1 D0 28                        	BNE		.tryAgain
   8553 00EBE3 20 72 EC                     	JSR		KeybdRecvByte
   8554 00EBE6 C9 FC                        	CMP		#$FC			; reset error ?
   8555 00EBE8 F0 21                        	BEQ		.tryAgain
   8556 00EBEA C9 AA                        	CMP		#$AA			; reset complete okay ?
   8557 00EBEC D0 1D                        	BNE		.tryAgain
   8558 00EBEE                             .config:
   8559 00EBEE 20 93 EC                     	JSR		KeybdWaitBusy
   8560 00EBF1 A9 F0                        	LDA		#$F0			; send scan code select
   8561 00EBF3 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8562 00EBF9 20 93 EC                     	JSR		KeybdWaitTx
   8563 00EBFC 90 0D                        	BCC		.tryAgain
   8564 00EBFE 20 72 EC                     	JSR		KeybdRecvByte	; wait for response from keyboard
   8565 00EC01 90 08                        	BCC		.tryAgain
   8566 00EC03 C9 FE                        	CMP		#$FE
   8567 00EC05 F0 04                        	BEQ		.tryAgain
   8568 00EC07 C9 FA                        	CMP		#$FA
   8569 00EC09 F0 16                        	BEQ		.0004
   8570 00EC0B                             .tryAgain:
   8571 00EC0B 88                           	DEY
   8572 00EC0C D0 A4                        	BNE		.0001
   8573 00EC0E C6 BC                        	DEC		keybd_cmd
   8574 00EC10 D0 95                        	BNE		.resetAgain
   8575 00EC12                             .keybdErr:
   8576 00EC12 C2 30                        	REP		#$30
   8577 00EC14 F4 01 00                     	PEA		1
   8578 00EC17 F4 C7 EC                     	PEA		msgKeybdNR
   8579 00EC1A 20 C5 E9                     	JSR		DisplayString
   8580 00EC1D 42 60                        	RTT
   8581 00EC1F 80 18                        	BRA		KeybdService
   8582 00EC21                             .0004:
   8583 00EC21 A9 02                        	LDA		#2				; select scan code set #2
   8584 00EC23 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8585 00EC29 20 93 EC                     	JSR		KeybdWaitTx
   8586 00EC2C 90 DD                        	BCC		.tryAgain
   8587 00EC2E 20 72 EC                     	JSR		KeybdRecvByte
   8588 00EC31 90 D8                        	BCC		.tryAgain
   8589 00EC33 C2 30                        	REP		#$30
   8590 00EC35 42 60                        	RTT
   8591 00EC37 80 00                        	BRA		KeybdService
                                           
   8593 00EC39                             KeybdService:
   8594 00EC39 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8597 00EC3B A9 00 20                     	LDA		#$2000
   8598 00EC3E 1B                           	TAS
   8599 00EC3F A5 BC                        	LDA		keybd_cmd
   8600 00EC41 C9 01 00                     	CMP		#1
   8601 00EC44 D0 18                        	BNE		.0001
   8602 00EC46 20 EA EC                     	JSR		KeybdGetCharNoWait
   8603 00EC49 B0 08                        	BCS		.nokey
   8604 00EC4B 64 BC                        	STZ		keybd_cmd
   8605 00EC4D 85 BA                        	STA		keybd_char
   8606 00EC4F 42 60                        	RTT
   8607 00EC51 80 E6                        	BRA		KeybdService
   8608 00EC53                             .nokey
   8609 00EC53 A9 FF FF                     	LDA		#-1
   8610 00EC56 64 BC                        	STZ		keybd_cmd
   8611 00EC58 85 BA                        	STA		keybd_char
   8612 00EC5A 42 60                        	RTT
   8613 00EC5C 80 DB                        	BRA		KeybdService
   8614 00EC5E                             .0001:
   8615 00EC5E C9 02 00                     	CMP		#2
   8616 00EC61 D0 0B                        	BNE		.0002
   8617 00EC63 20 F5 EC                     	JSR		KeybdGetCharWait
   8618 00EC66 64 BC                        	STZ		keybd_cmd
   8619 00EC68 85 BA                        	STA		keybd_char
   8620 00EC6A 42 60                        	RTT
   8621 00EC6C 80 CB                        	BRA		KeybdService
   8622 00EC6E                             .0002:
   8623 00EC6E 42 60                        	RTT
   8624 00EC70 80 C7                        	BRA		KeybdService
                                           
                                           	MEM		8
                                           	NDX		8
                                           
                                           ; Receive a byte from the keyboard, used after a command is sent to the
                                           ; keyboard in order to wait for a response.
                                           ;
   8632 00EC72                             KeybdRecvByte:
   8633 00EC72 5A                           	PHY
   8634 00EC73 A0 14                        	LDY		#20				; wait up to .2s
   8635 00EC75                             .0003:
   8636 00EC75 20 93 EC                     	JSR		KeybdWaitBusy
   8637 00EC78 42 5B AF 11 A1 FE            	LDA		ZS:KEYBD+1			; wait for response from keyboard
   8638 00EC7E 0A                           	ASL						; is input buffer full ?
   8639 00EC7F B0 09                        	BCS		.0004			; yes, branch
   8640 00EC81 20 AF EC                     	JSR		Wait10ms		; wait a bit
   8641 00EC84 88                           	DEY
   8642 00EC85 D0 EE                        	BNE		.0003			; go back and try again
   8643 00EC87 7A                           	PLY						; timeout
   8644 00EC88 18                           	CLC						; carry clear = no code
   8645 00EC89 60                           	RTS
   8646 00EC8A                             .0004:
   8647 00EC8A 42 5B AF 10 A1 FE            	LDA		ZS:KEYBD		; clear recieve state
   8648 00EC90 7A                           	PLY
   8649 00EC91 38                           	SEC						; carry set = code available
   8650 00EC92 60                           	RTS
                                           
                                           ; Wait until the keyboard isn't busy anymore
                                           ; Wait until the keyboard transmit is complete
                                           ; Returns .CF = 1 if successful, .CF=0 timeout
                                           ;
   8656 00EC93                             KeybdWaitBusy:				; alias for KeybdWaitTx
   8657 00EC93                             KeybdWaitTx:
   8658 00EC93 48                           	PHA
   8659 00EC94 5A                           	PHY
   8660 00EC95 A0 0A                        	LDY		#10				; wait a max of .1s
   8661 00EC97                             .0001:
   8662 00EC97 42 5B AF 11 A1 FE            	LDA		ZS:KEYBD+1
   8663 00EC9D 89 40                        	BIT		#$40			; check for transmit busy bit
   8664 00EC9F F0 0A                        	BEQ		.0002			; branch if bit clear
   8665 00ECA1 20 AF EC                     	JSR		Wait10ms		; delay a little bit
   8666 00ECA4 88                           	DEY						; go back and try again
   8667 00ECA5 D0 F0                        	BNE		.0001
   8668 00ECA7 7A                           	PLY						; timed out
   8669 00ECA8 68                           	PLA
   8670 00ECA9 18                           	CLC						; return carry clear
   8671 00ECAA 60                           	RTS
   8672 00ECAB                             .0002:
   8673 00ECAB 7A                           	PLY						; wait complete, return 
   8674 00ECAC 68                           	PLA
   8675 00ECAD 38                           	SEC						; carry set
   8676 00ECAE 60                           	RTS
                                           
                                           ; Wait approximately 10ms. Used by keyboard routines. Makes use of the free
                                           ; running counter #0.
                                           ; .A = trashed (=-5)
                                           ;
   8682 00ECAF                             Wait10ms:
   8683 00ECAF 48                           	PHA
   8684 00ECB0 DA                           	PHX				; save .X
   8685 00ECB1 42 5B A5 12                  	LDA		ZS:CNT0H	; get starting count
   8686 00ECB5 AA                           	TAX				; save it off in .X
   8687 00ECB6                             .0002:
   8688 00ECB6 38                           	SEC				; compare to current counter value
   8689 00ECB7 42 5B E5 12                  	SBC		ZS:CNT0H
   8690 00ECBB 49 FF                        	EOR		#$FF	; make negative
   8691 00ECBD C9 0A                        	CMP		#10
   8692 00ECBF 10 03                        	BPL     .0001
   8693 00ECC1 8A                           	TXA				; prepare for next check, get startcount in .A
   8694 00ECC2 80 F2                        	BRA		.0002	; go back if less than 5 ticks
   8695 00ECC4                             .0001:
   8696 00ECC4 FA                           	PLX				; restore .X
   8697 00ECC5 68                           	PLA
   8698 00ECC6 60                           	RTS
                                           
                                           	MEM		16
                                           	NDX		16
                                           
   8703 00ECC7                             msgKeybdNR:
   8704 00ECC7 0D 0A 4B 65 79 62 6F 61      	.byte	CR,LF,"Keyboard not responding.",CR,LF,0
   8704 00ECCF 72 64 20 6E 6F 74 20 72    
   8704 00ECD7 65 73 70 6F 6E 64 69 6E    
   8704 00ECDF 67 2E 0D 0A 00             
                                           
                                           	cpu		FT832
                                           
   8708 00ECE4                             KeybdGetCharNoWaitCtx:
   8709 00ECE4 20 EA EC                     	JSR		KeybdGetCharNoWait
   8710 00ECE7 42 40 00                     	RTC		#0
   8711 00ECEA                             	
   8712 00ECEA 08                           	PHP
   8713 00ECEB E2 20                        	SEP		#$20
   8714 00ECED C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8717 00ECEF A9 00                        	LDA		#0
   8718 00ECF1 85 0B                        	STA		KeybdWaitFlag
   8719 00ECF3 80 10                        	BRA		KeybdGetChar1
                                           
   8721 00ECF5                             KeybdGetCharWait:
   8722 00ECF5 08                           	PHP
   8723 00ECF6 E2 20                        	SEP		#$20
   8724 00ECF8 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8727 00ECFA A9 FF                        	LDA		#$FF
   8728 00ECFC 85 0B                        	STA		KeybdWaitFlag
   8729 00ECFE 80 05                        	BRA		KeybdGetChar1
                                           
                                           ; Wait for a keyboard character to be available
                                           ; Returns (CF=1) if no key available
                                           ; Return key (CF=0) if key is available
                                           ;
                                           ;
   8736 00ED00                             KeybdGetChar:
   8737 00ED00 08                           	PHP
   8738 00ED01 E2 20                        	SEP		#$20		; 8 bit acc
   8739 00ED03 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8742 00ED05                             KeybdGetChar1:
   8743 00ED05 DA                           	PHX
   8744 00ED06 EB                           	XBA					; force .B to zero for TAX
   8745 00ED07 A9 00                        	LDA		#0
   8746 00ED09 EB                           	XBA
   8747 00ED0A                             .0002:
   8748 00ED0A                             .0003:
   8749 00ED0A 42 5B AF 11 A1 FE            	LDA		ZS:KEYBD+1		; check MSB of keyboard status reg.
   8750 00ED10 0A                           	ASL
   8751 00ED11 B0 08                        	BCS		.0006		; branch if keystroke ready
   8752 00ED13 24 0B                        	BIT		KeybdWaitFlag
   8753 00ED15 30 F3                        	BMI		.0003
   8754 00ED17 FA                           	PLX
   8755 00ED18 28                           	PLP
   8756 00ED19 38                           	SEC
   8757 00ED1A 60                           	RTS
   8758 00ED1B                             .0006:
   8759 00ED1B 42 5B AF 10 A1 FE            	LDA		ZS:KEYBD	; get scan code value
   8760 00ED21 42 5B 42 9C 12 A1 FE 00      	STZ		ZS:KEYBD+2	; clear read flag
                                         
   8761 00ED29 C2 20                        	REP		#$20
                                           	;JSR		DispByte
                                           	;JSR		space
   8764 00ED2B E2 20                        	SEP		#$20
   8765 00ED2D                             .0001:
   8766 00ED2D C9 F0                        	CMP		#SC_KEYUP	; keyup scan code ?
   8767 00ED2F F0 FF 71 00                  	LBEQ	.doKeyup	; 
   8768 00ED33 C9 E0                        	CMP		#SC_EXTEND	; extended scan code ?
   8769 00ED35 F0 FF 72 00                  	LBEQ	.doExtend
   8770 00ED39 C9 14                        	CMP		#$14		; control ?
   8771 00ED3B F0 FF 75 00                  	LBEQ	.doCtrl
   8772 00ED3F C9 12                        	CMP		#$12		; left shift
   8773 00ED41 F0 FF 7F 00                  	LBEQ	.doShift
   8774 00ED45 C9 59                        	CMP		#$59		; right shift
   8775 00ED47 F0 FF 79 00                  	LBEQ	.doShift
   8776 00ED4B C9 77                        	CMP		#SC_NUMLOCK
   8777 00ED4D F0 FF 83 00                  	LBEQ	.doNumLock
   8778 00ED51 C9 58                        	CMP		#SC_CAPSLOCK
   8779 00ED53 F0 FF 8D 00                  	LBEQ	.doCapsLock
   8780 00ED57 C9 7E                        	CMP		#SC_SCROLLLOCK
   8781 00ED59 F0 FF 97 00                  	LBEQ	.doScrollLock
   8782 00ED5D 46 08                        	LSR		KeyState1
   8783 00ED5F B0 A9                        	BCS		.0003
   8784 00ED61 AA                           	TAX
   8785 00ED62 A9 80                        	LDA		#$80
   8786 00ED64 24 09                        	BIT		KeyState2	; Is extended code ?
   8787 00ED66 F0 13                        	BEQ		.0010
   8788 00ED68 A9 7F                        	LDA		#$7F
   8789 00ED6A 25 09                        	AND		KeyState2
   8790 00ED6C 85 09                        	STA		KeyState2
   8791 00ED6E 46 08                        	LSR		KeyState1	; clear keyup
   8792 00ED70 8A                           	TXA
   8793 00ED71 29 7F                        	AND		#$7F
   8794 00ED73 AA                           	TAX
   8795 00ED74 42 1B BD CD F0               	LDA		cs:keybdExtendedCodes,X
   8796 00ED79 80 23                        	BRA		.0008
   8797 00ED7B                             .0010:
   8798 00ED7B A9 04                        	LDA		#4
   8799 00ED7D 24 09                        	BIT		KeyState2	; Is Cntrl down ?
   8800 00ED7F F0 0B                        	BEQ		.0009
   8801 00ED81 8A                           	TXA
   8802 00ED82 29 7F                        	AND		#$7F		; table is 128 chars
   8803 00ED84 AA                           	TAX
   8804 00ED85 42 1B BD 4D F0               	LDA		cs:keybdControlCodes,X
   8805 00ED8A 80 12                        	BRA		.0008
   8806 00ED8C                             .0009:
   8807 00ED8C A9 01                        	LDA		#$1			; Is shift down ?
   8808 00ED8E 24 09                        	BIT		KeyState2
   8809 00ED90 F0 07                        	BEQ		.0007
   8810 00ED92 42 1B BD 4D EF               	LDA		cs:shiftedScanCodes,X
   8811 00ED97 80 05                        	BRA		.0008
   8812 00ED99                             .0007:
   8813 00ED99 42 1B BD 4D EE               	LDA		cs:unshiftedScanCodes,X
   8814 00ED9E                             .0008:
   8815 00ED9E C2 20                        	REP		#$20
                                           	MEM		16
   8817 00EDA0 FA                           	PLX
   8818 00EDA1 28                           	PLP
   8819 00EDA2 18                           	CLC
   8820 00EDA3 60                           	RTS
                                           	MEM		8
   8822 00EDA4                             .doKeyup:
   8823 00EDA4 A9 01                        	LDA		#1
   8824 00EDA6 04 08                        	TSB		KeyState1
   8825 00EDA8 82 5F FF                     	BRL		.0003
   8826 00EDAB                             .doExtend:				; set extended key flag
   8827 00EDAB A5 09                        	LDA		KeyState2
   8828 00EDAD 09 80                        	ORA		#$80
   8829 00EDAF 85 09                        	STA		KeyState2
   8830 00EDB1 82 56 FF                     	BRL		.0003
   8831 00EDB4                             .doCtrl:
   8832 00EDB4 A9 04                        	LDA		#4
   8833 00EDB6 46 08                        	LSR		KeyState1	; check key up/down	
   8834 00EDB8 90 05                        	BCC		.0004		; keydown = carry clear
   8835 00EDBA 14 09                        	TRB		KeyState2
   8836 00EDBC 82 4B FF                     	BRL		.0003
   8837 00EDBF                             .0004:
   8838 00EDBF 04 09                        	TSB		KeyState2	; set control active bit
   8839 00EDC1 82 46 FF                     	BRL		.0003
   8840 00EDC4                             .doShift:
   8841 00EDC4 A9 01                        	LDA		#1
   8842 00EDC6 46 08                        	LSR		KeyState1	; check key up/down	
   8843 00EDC8 90 05                        	BCC		.0005
   8844 00EDCA 14 09                        	TRB		KeyState2
   8845 00EDCC 82 3B FF                     	BRL		.0003
   8846 00EDCF                             .0005:
   8847 00EDCF 04 09                        	TSB		KeyState2
   8848 00EDD1 82 36 FF                     	BRL		.0003
   8849 00EDD4                             .doNumLock:
   8850 00EDD4 A5 09                        	LDA		KeyState2
   8851 00EDD6 49 10                        	EOR		#16
   8852 00EDD8 85 09                        	STA		KeyState2
   8853 00EDDA E2 30                        	SEP		#$30
   8854 00EDDC 20 04 EE                     	JSR		KeybdSetLEDStatus
   8855 00EDDF C2 10                        	REP		#$10
   8856 00EDE1 82 26 FF                     	BRL		.0003
   8857 00EDE4                             .doCapsLock:
   8858 00EDE4 A5 09                        	LDA		KeyState2
   8859 00EDE6 49 20                        	EOR		#32
   8860 00EDE8 85 09                        	STA		KeyState2
   8861 00EDEA E2 30                        	SEP		#$30
   8862 00EDEC 20 04 EE                     	JSR		KeybdSetLEDStatus
   8863 00EDEF C2 10                        	REP		#$10
   8864 00EDF1 82 16 FF                     	BRL		.0003
   8865 00EDF4                             .doScrollLock:
   8866 00EDF4 A5 09                        	LDA		KeyState2
   8867 00EDF6 49 40                        	EOR		#64
   8868 00EDF8 85 09                        	STA		KeyState2
   8869 00EDFA E2 30                        	SEP		#$30
   8870 00EDFC 20 04 EE                     	JSR		KeybdSetLEDStatus
   8871 00EDFF C2 10                        	REP		#$10
   8872 00EE01 82 06 FF                     	BRL		.0003
                                           
   8874 00EE04                             KeybdSetLEDStatus:
                                           ;	PHDS				; save off DS
                                           ;	PEA		5			; set DS to zero
                                           ;	PLDS
   8878 00EE04 A9 00                        	LDA		#0
   8879 00EE06 85 0A                        	STA		KeybdLEDs
   8880 00EE08 A9 10                        	LDA		#16
   8881 00EE0A 24 09                        	BIT		KeyState2
   8882 00EE0C F0 06                        	BEQ		.0002
   8883 00EE0E A5 0A                        	LDA		KeybdLEDs	; set bit 1 for Num lock, 0 for scrolllock , 2 for caps lock
   8884 00EE10 09 02                        	ORA		#$2
   8885 00EE12 85 0A                        	STA		KeybdLEDs
   8886 00EE14                             .0002:
   8887 00EE14 A9 20                        	LDA		#32
   8888 00EE16 24 09                        	BIT		KeyState2
   8889 00EE18 F0 06                        	BEQ		.0003
   8890 00EE1A A5 0A                        	LDA		KeybdLEDs
   8891 00EE1C 09 04                        	ORA		#$4
   8892 00EE1E 85 0A                        	STA		KeybdLEDs
   8893 00EE20                             .0003:
   8894 00EE20 A9 40                        	LDA		#64
   8895 00EE22 24 09                        	BIT		KeyState2
   8896 00EE24 F0 06                        	BEQ		.0004
   8897 00EE26 A5 0A                        	LDA		KeybdLEDs
   8898 00EE28 09 01                        	ORA		#1
   8899 00EE2A 85 0A                        	STA		KeybdLEDs
   8900 00EE2C                             .0004:
   8901 00EE2C A9 ED                        	LDA		#$ED		; set status LEDs command
   8902 00EE2E 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8903 00EE34 20 93 EC                     	JSR		KeybdWaitTx
   8904 00EE37 20 72 EC                     	JSR		KeybdRecvByte
   8905 00EE3A 90 10                        	BCC		.0001
   8906 00EE3C C9 FA                        	CMP		#$FA
   8907 00EE3E A5 0A                        	LDA		KeybdLEDs
   8908 00EE40 42 5B 8F 10 A1 FE            	STA		ZS:KEYBD
   8909 00EE46 20 93 EC                     	JSR		KeybdWaitTx
   8910 00EE49 20 72 EC                     	JSR		KeybdRecvByte	; wait for $FA byte
   8911 00EE4C                             .0001:
                                           ;	PLDS				; recover DS
   8913 00EE4C 60                           	RTS
                                           
                                           
                                           	;--------------------------------------------------------------------------
                                           	; PS2 scan codes to ascii conversion tables.
                                           	;--------------------------------------------------------------------------
                                           	;
   8920 00EE4D                             unshiftedScanCodes:
   8921 00EE4D 2E A9 2E A5 A3 A1 A2 AC      	.byte	$2e,$a9,$2e,$a5,$a3,$a1,$a2,$ac
                                         
   8922 00EE55 2E AA A8 A6 A4 09 60 2E      	.byte	$2e,$aa,$a8,$a6,$a4,$09,$60,$2e
                                         
   8923 00EE5D 2E 2E 2E 2E 2E 71 31 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$71,$31,$2e
                                         
   8924 00EE65 2E 2E 7A 73 61 77 32 2E      	.byte	$2e,$2e,$7a,$73,$61,$77,$32,$2e
                                         
   8925 00EE6D 2E 63 78 64 65 34 33 2E      	.byte	$2e,$63,$78,$64,$65,$34,$33,$2e
                                         
   8926 00EE75 2E 20 76 66 74 72 35 2E      	.byte	$2e,$20,$76,$66,$74,$72,$35,$2e
                                         
   8927 00EE7D 2E 6E 62 68 67 79 36 2E      	.byte	$2e,$6e,$62,$68,$67,$79,$36,$2e
                                         
   8928 00EE85 2E 2E 6D 6A 75 37 38 2E      	.byte	$2e,$2e,$6d,$6a,$75,$37,$38,$2e
                                         
   8929 00EE8D 2E 2C 6B 69 6F 30 39 2E      	.byte	$2e,$2c,$6b,$69,$6f,$30,$39,$2e
                                         
   8930 00EE95 2E 2E 2F 6C 3B 70 2D 2E      	.byte	$2e,$2e,$2f,$6c,$3b,$70,$2d,$2e
                                         
   8931 00EE9D 2E 2E 27 2E 5B 3D 2E 2E      	.byte	$2e,$2e,$27,$2e,$5b,$3d,$2e,$2e
                                         
   8932 00EEA5 AD 2E 0D 5D 2E 5C 2E 2E      	.byte	$ad,$2e,$0d,$5d,$2e,$5c,$2e,$2e
                                         
   8933 00EEAD 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   8934 00EEB5 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   8935 00EEBD 98 7F 92 2E 91 90 1B AF      	.byte	$98,$7f,$92,$2e,$91,$90,$1b,$af
                                         
   8936 00EEC5 AB 2E 97 2E 2E 96 AE 2E      	.byte	$ab,$2e,$97,$2e,$2e,$96,$ae,$2e
                                         
                                           
   8938 00EECD 2E 2E 2E A7 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$a7,$2e,$2e,$2e,$2e
                                         
   8939 00EED5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8940 00EEDD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8941 00EEE5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8942 00EEED 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8943 00EEF5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8944 00EEFD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8945 00EF05 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8946 00EF0D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8947 00EF15 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8948 00EF1D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8949 00EF25 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8950 00EF2D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8951 00EF35 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8952 00EF3D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8953 00EF45 2E 2E FA 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$fa,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   8955 00EF4D                             shiftedScanCodes:
   8956 00EF4D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8957 00EF55 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   8958 00EF5D 2E 2E 2E 2E 2E 51 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$51,$21,$2e
                                         
   8959 00EF65 2E 2E 5A 53 41 57 40 2E      	.byte	$2e,$2e,$5a,$53,$41,$57,$40,$2e
                                         
   8960 00EF6D 2E 43 58 44 45 24 23 2E      	.byte	$2e,$43,$58,$44,$45,$24,$23,$2e
                                         
   8961 00EF75 2E 20 56 46 54 52 25 2E      	.byte	$2e,$20,$56,$46,$54,$52,$25,$2e
                                         
   8962 00EF7D 2E 4E 42 48 47 59 5E 2E      	.byte	$2e,$4e,$42,$48,$47,$59,$5e,$2e
                                         
   8963 00EF85 2E 2E 4D 4A 55 26 2A 2E      	.byte	$2e,$2e,$4d,$4a,$55,$26,$2a,$2e
                                         
   8964 00EF8D 2E 3C 4B 49 4F 29 28 2E      	.byte	$2e,$3c,$4b,$49,$4f,$29,$28,$2e
                                         
   8965 00EF95 2E 3E 3F 4C 3A 50 5F 2E      	.byte	$2e,$3e,$3f,$4c,$3a,$50,$5f,$2e
                                         
   8966 00EF9D 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   8967 00EFA5 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   8968 00EFAD 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   8969 00EFB5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8970 00EFBD 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   8971 00EFC5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   8973 00EFCD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8974 00EFD5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8975 00EFDD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8976 00EFE5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8977 00EFED 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8978 00EFF5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8979 00EFFD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8980 00F005 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8981 00F00D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8982 00F015 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8983 00F01D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8984 00F025 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8985 00F02D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8986 00F035 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8987 00F03D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8988 00F045 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
                                           ; control
   8991 00F04D                             keybdControlCodes:
   8992 00F04D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   8993 00F055 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   8994 00F05D 2E 2E 2E 2E 2E 11 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$11,$21,$2e
                                         
   8995 00F065 2E 2E 1A 13 01 17 40 2E      	.byte	$2e,$2e,$1a,$13,$01,$17,$40,$2e
                                         
   8996 00F06D 2E 03 18 04 05 24 23 2E      	.byte	$2e,$03,$18,$04,$05,$24,$23,$2e
                                         
   8997 00F075 2E 20 16 06 14 12 25 2E      	.byte	$2e,$20,$16,$06,$14,$12,$25,$2e
                                         
   8998 00F07D 2E 0E 02 08 07 19 5E 2E      	.byte	$2e,$0e,$02,$08,$07,$19,$5e,$2e
                                         
   8999 00F085 2E 2E 0D 0A 15 26 2A 2E      	.byte	$2e,$2e,$0d,$0a,$15,$26,$2a,$2e
                                         
   9000 00F08D 2E 3C 0B 09 0F 29 28 2E      	.byte	$2e,$3c,$0b,$09,$0f,$29,$28,$2e
                                         
   9001 00F095 2E 3E 3F 0C 3A 10 5F 2E      	.byte	$2e,$3e,$3f,$0c,$3a,$10,$5f,$2e
                                         
   9002 00F09D 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9003 00F0A5 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9004 00F0AD 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9005 00F0B5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9006 00F0BD 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9007 00F0C5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9009 00F0CD                             keybdExtendedCodes:
   9010 00F0CD 2E 2E 2E 2E A3 A1 A2 2E      	.byte	$2e,$2e,$2e,$2e,$a3,$a1,$a2,$2e
                                         
   9011 00F0D5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9012 00F0DD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9013 00F0E5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9014 00F0ED 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9015 00F0F5 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9016 00F0FD 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9017 00F105 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9018 00F10D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9019 00F115 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9020 00F11D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9021 00F125 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9022 00F12D 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9023 00F135 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9024 00F13D 98 99 92 2E 91 90 2E 2E      	.byte	$98,$99,$92,$2e,$91,$90,$2e,$2e
                                         
   9025 00F145 2E 2E 97 2E 2E 96 2E 2E      	.byte	$2e,$2e,$97,$2e,$2e,$96,$2e,$2e
                                         
                                           
                                           ; Get char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
   9030 00F14D                             SuperGetch:
   9031 00F14D 08                           	PHP
   9032 00F14E C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9035 00F150 20 EA EC                     	JSR		KeybdGetCharNoWait
   9036 00F153 29 FF 00                     	AND		#$FF
   9037 00F156 B0 03                        	BCS		.0001
   9038 00F158 28                           	PLP		; to restore reg size
   9039 00F159 18                           	CLC
   9040 00F15A 60                           	RTS
   9041 00F15B                             .0001:
   9042 00F15B 28                           	PLP
   9043 00F15C 38                           	SEC
   9044 00F15D 60                           	RTS
                                           
                                           ; Put char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
   9049 00F15E                             SuperPutch:
   9050 00F15E 08                           	PHP
   9051 00F15F C2 30                        	REP		#$30	; 16 bit regs
                                           	MEM		16
                                           	NDX		16
   9054 00F161 48                           	PHA
   9055 00F162 DA                           	PHX
   9056 00F163 5A                           	PHY
   9057 00F164 20 B6 E9                     	JSR		OutChar
   9058 00F167 7A                           	PLY
   9059 00F168 FA                           	PLX
   9060 00F169 68                           	PLA
   9061 00F16A 28                           	PLP
   9062 00F16B 60                           	RTS
                                           
   9064 00F16C                             warm_start:
   9065 00F16C 42 E2 00 01                  	SEP		#$100		; 16 bit mode
   9066 00F170 C2 30                        	REP		#$30		; 16 bit MEM,NDX
                                           	MEM		16
                                           	NDX		16
   9069 00F172 A9 FF 3F                     	LDA		#$3FFF
   9070 00F175 1B                           	TAS
   9071 00F176 20 19 EA                     	JSR		CursorOn
   9072 00F179 82 FD EF                     	BRL		Mon1
                                           
                                           	cpu		FT832
   9075 00F17C                             ICacheIL832:
   9076 00F17C 42 E0 01                     	CACHE	#1			; 1= invalidate instruction line identified by accumulator
   9077 00F17F 60                           	RTS
                                           
   9079 00F180                             ByteIRQRout:
   9080 00F180 40                           	RTI
                                           
   9082 00F181                             IRQRout:
   9083 00F181 42 A2 01 00                  	TSK		#1			; switch to the interrupt handling task
   9084 00F185 40                           	RTI
                                           
   9086 00F186                             Task1:
   9087 00F186 AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
   9088 00F189 89 02 00                     	BIT		#2
   9089 00F18C F0 13                        	BEQ		.0001
   9090 00F18E A5 04                        	LDA		TickCount		; increment the tick count
   9091 00F190 1A                           	INA
   9092 00F191 85 04                        	STA		TickCount
   9093 00F193 42 8B 8F A4 00 FD            	STA.B	$FD00A4			; update on-screen IRQ live indicator
   9094 00F199 A9 05 00                     	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9095 00F19C 42 8B 8D 17 B0               	STA.B	CTR1_CTRL
   9096 00F1A1                             .0001:
   9097 00F1A1 42 60                        	RTT					; go back to interrupted task
   9098 00F1A3 80 E1                        	BRA		Task1		; the next time task1 is run it will start here
                                           
                                           ; IRQ handler task - 32 bit
                                           ;
   9102 00F1A5                             IRQTask:
                                           	MEM		8
                                           	NDX		32
   9105 00F1A5                             IRQTask1:
   9106 00F1A5 AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
   9107 00F1A8 89 02                        	BIT		#2
   9108 00F1AA F0 12                        	BEQ		.0001
   9109 00F1AC A6 04                        	LDX		TickCount		; increment the tick count
   9110 00F1AE E8                           	INX
   9111 00F1AF 86 04                        	STX		TickCount
   9112 00F1B1 42 8B 42 8E A2 00 FD 00      	STX.B	$FD00A2			; update on-screen IRQ live indicator
                                         
   9113 00F1B9 A9 05                        	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9114 00F1BB 8D 17 B0                     	STA		CTR1_CTRL
   9115 00F1BE                             .0001:
   9116 00F1BE 42 60                        	RTT					; go back to interrupted task
   9117 00F1C0 80 E3                        	BRA		IRQTask1	; the next time task is run it will start here
                                           
                                           ; This little task sample runs in native 32 bit mode and displays
                                           ; "Hello World!" on the screen.
                                           
                                           	CPU		FT832
                                           	MEM		8
                                           	NDX		32
                                           
   9126 00F1C2                             Task2:
   9127 00F1C2 A2 F8 01 00 00               	LDX		#84*2*3
   9128 00F1C7                             .0003:
   9129 00F1C7 A0 00 00 00 00               	LDY		#0
   9130 00F1CC                             .0002:
   9131 00F1CC 42 1B B9 E5 F1               	LDA		CS:msgHelloWorld,Y
   9132 00F1D1 F0 0E                        	BEQ		.0001
   9133 00F1D3 20 A8 E7                     	JSR		AsciiToScreen8
   9134 00F1D6 42 5B 9F 00 00 FD            	STA		ZS:VIDBUF,X
   9135 00F1DC E8                           	INX
   9136 00F1DD E8                           	INX
   9137 00F1DE C8                           	INY
   9138 00F1DF 80 EB                        	BRA		.0002
   9139 00F1E1                             .0001:
   9140 00F1E1 42 60                        	RTT
   9141 00F1E3 80 E2                        	BRA		.0003
                                           
   9143 00F1E5                             msgHelloWorld:
   9144 00F1E5 0D 0A 48 65 6C 6C 6F 20      	.byte	CR,LF,"Hello World!",CR,LF,0
   9144 00F1ED 57 6F 72 6C 64 21 0D 0A    
   9144 00F1F5 00                         
                                           
                                           	NDX		16
                                           	MEM		16
                                           
   9149 00F1F6                             BrkTask:
   9150 00F1F6 42 EE 00 00 D0 FF            	INC		$FFD00000
   9151 00F1FC 42 60                        	RTT
   9152 00F1FE 80 F6                        	BRA		BrkTask
                                           
                                           ; The following store sequence for the benefit of Supermon816
                                           ;
   9156 00F200                             BrkRout:
   9157 00F200 0B                           	PHD
   9158 00F201 8B                           	PHB
   9159 00F202 C2 30                        	REP		#$30
   9160 00F204 48                           	PHA
   9161 00F205 DA                           	PHX
   9162 00F206 5A                           	PHY
   9163 00F207 6C 02 01                     	JMP		($0102)		; This jump normally points to BrkRout1
   9164 00F20A                             BrkRout1:
   9165 00F20A C2 30                        	REP		#$30
   9166 00F20C 7A                           	PLY
   9167 00F20D FA                           	PLX
   9168 00F20E 68                           	PLA
   9169 00F20F AB                           	PLB
   9170 00F210 2B                           	PLD
   9171 00F211 E2 20                        	SEP		#$20
   9172 00F213 68                           	PLA
   9173 00F214 C2 30                        	REP		#$30
   9174 00F216 68                           	PLA
   9175 00F217 20 96 EA                     	JSR		DispWord
   9176 00F21A A2 00 00                     	LDX		#0
   9177 00F21D A0 40 00                     	LDY		#64
   9178 00F220                             .0001:
   9179 00F220 42 F0                        	.word	$f042		; pchist
   9180 00F222 20 96 EA                     	JSR		DispWord
   9181 00F225 A9 20 00                     	LDA		#' '
   9182 00F228 20 B6 E9                     	JSR		OutChar
   9183 00F22B E8                           	INX
   9184 00F22C 88                           	DEY
   9185 00F22D D0 F1                        	BNE		.0001
   9186 00F22F A9 FF FF                     	LDA		#$FFFF
   9187 00F232 8D 00 70                     	STA		$7000
   9188 00F235                             Hung:
   9189 00F235 80 FE                        	BRA		Hung
                                           
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------
                                           	; I/O page is located at $F0xx
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------	
                                           	;org		$F100
                                           
   9198 00F237                             LineTbl:
   9199 00F237 00 00                        	.WORD	0
   9200 00F239 54 00                        	.WORD	TEXTCOLS
   9201 00F23B A8 00                        	.WORD	TEXTCOLS*2
   9202 00F23D FC 00                        	.WORD	TEXTCOLS*3
   9203 00F23F 50 01                        	.WORD	TEXTCOLS*4
   9204 00F241 A4 01                        	.WORD	TEXTCOLS*5
   9205 00F243 F8 01                        	.WORD	TEXTCOLS*6
   9206 00F245 4C 02                        	.WORD	TEXTCOLS*7
   9207 00F247 A0 02                        	.WORD	TEXTCOLS*8
   9208 00F249 F4 02                        	.WORD	TEXTCOLS*9
   9209 00F24B 48 03                        	.WORD	TEXTCOLS*10
   9210 00F24D 9C 03                        	.WORD	TEXTCOLS*11
   9211 00F24F F0 03                        	.WORD	TEXTCOLS*12
   9212 00F251 44 04                        	.WORD	TEXTCOLS*13
   9213 00F253 98 04                        	.WORD	TEXTCOLS*14
   9214 00F255 EC 04                        	.WORD	TEXTCOLS*15
   9215 00F257 40 05                        	.WORD	TEXTCOLS*16
   9216 00F259 94 05                        	.WORD	TEXTCOLS*17
   9217 00F25B E8 05                        	.WORD	TEXTCOLS*18
   9218 00F25D 3C 06                        	.WORD	TEXTCOLS*19
   9219 00F25F 90 06                        	.WORD	TEXTCOLS*20
   9220 00F261 E4 06                        	.WORD	TEXTCOLS*21
   9221 00F263 38 07                        	.WORD	TEXTCOLS*22
   9222 00F265 8C 07                        	.WORD	TEXTCOLS*23
   9223 00F267 E0 07                        	.WORD	TEXTCOLS*24
   9224 00F269 34 08                        	.WORD	TEXTCOLS*25
   9225 00F26B 88 08                        	.WORD	TEXTCOLS*26
   9226 00F26D DC 08                        	.WORD	TEXTCOLS*27
   9227 00F26F 30 09                        	.WORD	TEXTCOLS*28
   9228 00F271 84 09                        	.WORD	TEXTCOLS*29
   9229 00F273 D8 09                        	.WORD	TEXTCOLS*30
                                           
   9231 00F275                             TaskStartTbl:
   9232 00F275 01 00                        	.WORD	1			; CS
   9233 00F277 00 00                        	.WORD	0			; DS
   9234 00F279 00 00                        	.WORD	0			; SS
   9235 00F27B B6 E0                        	.WORD	Task0		; PC
   9236 00F27D 00                           	.BYTE	Task0>>16	; PB
   9237 00F27E 00 00                        	.WORD	0			; acc
   9238 00F280 00 00                        	.WORD	0
   9239 00F282 00 00                        	.WORD	0			; x
   9240 00F284 00 00                        	.WORD	0
   9241 00F286 00 00                        	.WORD	0			; y
   9242 00F288 00 00                        	.WORD	0
   9243 00F28A FF 3F                        	.WORD	$3FFF		; sp
   9244 00F28C 00 00                        	.WORD	0
   9245 00F28E 04                           	.BYTE	4			; SR
   9246 00F28F 01                           	.BYTE	1			; SR extension
   9247 00F290 00                           	.BYTE	0			; DB
   9248 00F291 00 00                        	.WORD	0			; DPR
   9249 00F293 00 00                        	.WORD	0
                                           
                                           	; Interrupt handler task
   9252 00F295 01 00                        	.WORD	1			; CS
   9253 00F297 05 00                        	.WORD	5			; DS
   9254 00F299 05 00                        	.WORD	5			; SS
   9255 00F29B 86 F1                        	.WORD	Task1		; PC
   9256 00F29D 00                           	.BYTE	Task1>>16
   9257 00F29E 00 00                        	.WORD	0			; acc
   9258 00F2A0 00 00                        	.WORD	0
   9259 00F2A2 00 00                        	.WORD	0			; x
   9260 00F2A4 00 00                        	.WORD	0
   9261 00F2A6 00 00                        	.WORD	0			; y
   9262 00F2A8 00 00                        	.WORD	0
   9263 00F2AA FF 3B                        	.WORD	$3BFF		; sp
   9264 00F2AC 00 00                        	.WORD	0
   9265 00F2AE 04                           	.BYTE	4			; SR
   9266 00F2AF 01                           	.BYTE	1			; SR extension
   9267 00F2B0 00                           	.BYTE	0			; DB
   9268 00F2B1 00 00                        	.WORD	0			; DPR
   9269 00F2B3 00 00                        	.WORD	0
                                           
   9271 00F2B5 01 00                        	.WORD	1			; CS
   9272 00F2B7 00 00                        	.WORD	0			; DS
   9273 00F2B9 00 00                        	.WORD	0			; SS
   9274 00F2BB C2 F1                        	.WORD	Task2		; PC
   9275 00F2BD 00                           	.BYTE	Task2>>16
   9276 00F2BE 00 00                        	.WORD	0			; acc
   9277 00F2C0 00 00                        	.WORD	0
   9278 00F2C2 00 00                        	.WORD	0			; x
   9279 00F2C4 00 00                        	.WORD	0
   9280 00F2C6 00 00                        	.WORD	0			; y
   9281 00F2C8 00 00                        	.WORD	0
   9282 00F2CA FF 37                        	.WORD	$37FF		; sp
   9283 00F2CC 00 00                        	.WORD	0
   9284 00F2CE 20                           	.BYTE	$20			; SR			; eight bit mem
   9285 00F2CF 02                           	.BYTE	2			; SR extension
   9286 00F2D0 00                           	.BYTE	0			; DB
   9287 00F2D1 00 00                        	.WORD	0			; DPR
   9288 00F2D3 00 00                        	.WORD	0
                                           
   9290 00F2D5 01 00                        	.WORD	1			; CS
   9291 00F2D7 00 00                        	.WORD	0			; DS
   9292 00F2D9 00 00                        	.WORD	0			; SS
   9293 00F2DB 6E E6                        	.WORD	SSMInit		; PC
   9294 00F2DD 00                           	.BYTE	SSMTnit>>16
   9295 00F2DE 00 00                        	.WORD	0			; acc
   9296 00F2E0 00 00                        	.WORD	0
   9297 00F2E2 00 00                        	.WORD	0			; x
   9298 00F2E4 00 00                        	.WORD	0
   9299 00F2E6 00 00                        	.WORD	0			; y
   9300 00F2E8 00 00                        	.WORD	0
   9301 00F2EA FF 33                        	.WORD	$33FF		; sp
   9302 00F2EC 00 00                        	.WORD	0
   9303 00F2EE 04                           	.BYTE	$4			; SR	16 bit regs, mask interrupts
   9304 00F2EF 01                           	.BYTE	1			; SR extension - 816 mode
   9305 00F2F0 00                           	.BYTE	0			; DB
   9306 00F2F1 00 00                        	.WORD	0			; DPR
   9307 00F2F3 00 00                        	.WORD	0
                                           
   9309 00F2F5 01 00                        	.WORD	1			; CS
   9310 00F2F7 00 00                        	.WORD	0			; DS
   9311 00F2F9 00 00                        	.WORD	0			; SS
   9312 00F2FB F6 F1                        	.WORD	BrkTask		; PC
   9313 00F2FD 00                           	.BYTE	BrkTask>>16
   9314 00F2FE 00 00                        	.WORD	0			; acc
   9315 00F300 00 00                        	.WORD	0
   9316 00F302 00 00                        	.WORD	0			; x
   9317 00F304 00 00                        	.WORD	0
   9318 00F306 00 00                        	.WORD	0			; y
   9319 00F308 00 00                        	.WORD	0
   9320 00F30A FF 2F                        	.WORD	$2FFF		; sp
   9321 00F30C 00 00                        	.WORD	0
   9322 00F30E 00                           	.BYTE	0			; SR
   9323 00F30F 01                           	.BYTE	1			; SR extension
   9324 00F310 00                           	.BYTE	0			; DB
   9325 00F311 00 00                        	.WORD	0			; DPR
   9326 00F313 00 00                        	.WORD	0
                                           
                                           	; task #5
                                           	; DS is placed at $7800
   9330 00F315 01 00                        	.WORD	1			; CS
   9331 00F317 00 00                        	.WORD	0    		; DS
   9332 00F319 00 00                        	.WORD	0			; SS
   9333 00F31B E6 D8                        	.WORD	InvadersTask	; PC
   9334 00F31D 00                           	.BYTE	InvadersTask>>16
   9335 00F31E 00 00                        	.WORD	0			; acc
   9336 00F320 00 00                        	.WORD	0
   9337 00F322 00 00                        	.WORD	0			; x
   9338 00F324 00 00                        	.WORD	0
   9339 00F326 00 00                        	.WORD	0			; y
   9340 00F328 00 00                        	.WORD	0
   9341 00F32A FF 2B                        	.WORD	$2BFF		; sp
   9342 00F32C 00 00                        	.WORD	0
   9343 00F32E 00                           	.BYTE	0			; SR
   9344 00F32F 01                           	.BYTE	1			; SR extension
   9345 00F330 00                           	.BYTE	0			; DB
   9346 00F331 00 00                        	.WORD	0			; DPR
   9347 00F333 00 00                        	.WORD	0
                                           
   9349 00F335 01 00                        	.WORD	1			; CS
   9350 00F337 00 00                        	.WORD	0			; DS
   9351 00F339 00 00                        	.WORD	0			; SS
   9352 00F33B A5 F1                        	.WORD	IRQTask		; PC
   9353 00F33D 00                           	.BYTE	IRQTask>>16
   9354 00F33E 00 00                        	.WORD	0			; acc
   9355 00F340 00 00                        	.WORD	0
   9356 00F342 00 00                        	.WORD	0			; x
   9357 00F344 00 00                        	.WORD	0
   9358 00F346 00 00                        	.WORD	0			; y
   9359 00F348 00 00                        	.WORD	0
   9360 00F34A FF 27                        	.WORD	$27FF		; sp
   9361 00F34C 00 00                        	.WORD	0
   9362 00F34E 24                           	.BYTE	$24			; SR	8 bit acc, mask interrupts
   9363 00F34F 02                           	.BYTE	2			; SR extension - 832 mode
   9364 00F350 00                           	.BYTE	0			; DB
   9365 00F351 00 00                        	.WORD	0			; DPR
   9366 00F353 00 00                        	.WORD	0
                                           
   9368 00F355                             msgRegs:
   9369 00F355 0D 0A                        	.byte	CR,LF
   9370 00F357 20 20 20 20 20 20 20 20          .byte   "             xxxsxi31",CR,LF
   9370 00F35F 20 20 20 20 20 78 78 78    
   9370 00F367 73 78 69 33 31 0D 0A       
   9371 00F36E 20 20 43 53 20 20 50 42          .byte   "  CS  PB PC  xxxsxn26NVmxDIZC    .A       .X       .Y       SP  ",CR,LF,0
   9371 00F376 20 50 43 20 20 78 78 78    
   9371 00F37E 73 78 6E 32 36 4E 56 6D    
   9371 00F386 78 44 49 5A 43 20 20 20    
   9371 00F38E 20 2E 41 20 20 20 20 20    
   9371 00F396 20 20 2E 58 20 20 20 20    
   9371 00F39E 20 20 20 2E 59 20 20 20    
   9371 00F3A6 20 20 20 20 53 50 20 20    
   9371 00F3AE 0D 0A 00                   
   9372 00F3B1                             msgRegs2:
   9373 00F3B1 0D 0A                        	.byte	CR,LF
   9374 00F3B3 20 20 53 53 20 20 20 44      	.byte	"  SS   DS  DB  DP   BL",CR,LF,0
   9374 00F3BB 53 20 20 44 42 20 20 44    
   9374 00F3C3 50 20 20 20 42 4C 0D 0A    
   9374 00F3CB 00                         
   9375 00F3CC                             msgErr:
   9376 00F3CC 2A 2A 2A 45 72 72 0D 0A      	.byte	"***Err",CR,LF,0
   9376 00F3D4 00                         
                                           
   9378 00F3D5 FF FF FF FF FF FF FF FF      	.org	$F400
   9378 00F3DD FF FF FF FF FF FF FF FF    
   9378 00F3E5 FF FF FF FF FF FF FF FF    
   9378 00F3ED FF FF FF FF FF FF FF FF    
   9378 00F3F5 FF FF FF FF FF FF FF FF    
   9378 00F3FD FF FF FF                   
   9379 00F400 4C 4D F1                     	JMP		SuperGetch
   9380 00F403 4C 6C F1                     	JMP		warm_start
   9381 00F406 4C 5E F1                     	JMP		SuperPutch
   9382 00F409 4C F9 E5                     	JMP		BIOSInput
                                           
                                           	cpu		FT832
                                           	MEM		32
                                           	NDX		32
   9387 00F40C A9 78 56 34 12               	LDA		#$12345678
   9388 00F411 A2 32 54 76 98               	LDX		#$98765432
   9389 00F416 42 8B 42 97 23               	STA.B	{$23},Y
   9390 00F41B 42 BB 42 BC 56 55 45 44      	LDY.UH	$44455556,X
                                         
   9391 00F423 42 1B 42 AB 42 BD 56 55      	LDA.H	CS:$44455556,X
   9391 00F42B 45 44                      
   9392 00F42D 42 3B 88 88 42 9B B9 34      	LDA.UB	SEG $8888:$1234,Y
   9392 00F435 12                         
                                           	JSF	    $0000:start
   9394 00F436 42 6B                        	RTF
   9395 00F438 42 3B 21 98 7D 00 12         	ADC     SEG $9821:$1200,X
   9396 00F43F 42 3B 21 08 5D 00 12         	EOR     $821:$1200,X
   9397 00F446 42 3B 41 08 45 12            	EOR     $841:$12
   9398 00F44C 42 DA 42 F7 24               	SBC     FAR {$24},Y
   9399 00F451 42 DA 32 25                  	AND     FAR($25)
   9400 00F455 42 DA 01 26                  	ORA     FAR ($26,x)
   9401 00F459 42 A2 02 00                  	TSK		#2
   9402 00F45D 42 3A                        	TSK
   9403 00F45F 42 4C 00 00 01 00            	LDT		$10000,X
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	MEM		16
                                           	NDX		16
   9411 00F465                             beep:
   9412 00F465 A9 0F 00                     	LDA		#15					; set volume to max
   9413 00F468 8F B0 B0 FE                  	STA		SID+SID_VOLUME		
   9414 00F46C A9 6F 0C                     	LDA		#$0C6F				; 10C6F = 800 Hz
   9415 00F46F 8F 00 B0 FE                  	STA		SID+SID_FREQ0
   9416 00F473 A9 01 00                     	LDA		#1
   9417 00F476 8F 02 B0 FE                  	STA		SID+SID_FREQ0+2
   9418 00F47A A9 C3 00                     	LDA		#195				; 2ms
   9419 00F47D 8F 0C B0 FE                  	STA		SID+SID_ATTACK0
   9420 00F481 42 9C 0E B0 FE 00            	STZ		SID+SID_ATTACK0+2
   9421 00F487 A9 28 09                     	LDA		#2344				; 24 ms decay
   9422 00F48A 8F 10 B0 FE                  	STA		SID+SID_DECAY0
   9423 00F48E 42 9C 12 B0 FE 00            	STZ		SID+SID_DECAY0+2
   9424 00F494 A9 80 00                     	LDA		#$80				; 50% sustain level
   9425 00F497 8F 14 B0 FE                  	STA		SID+SID_SUSTAIN0
   9426 00F49B A9 BC BE                     	LDA		#48828				; 500 ms release
   9427 00F49E 8F 18 B0 FE                  	STA		SID+SID_RELEASE0
   9428 00F4A2 42 9C 1A B0 FE 00            	STZ		SID+SID_RELEASE0+2
   9429 00F4A8 A9 04 15                     	LDA		#$1504				; gate on
   9430 00F4AB 8F 08 B0 FE                  	STA		SID+SID_CTRL0
                                           	; delay for about 1s
   9432 00F4AF A0 27 00                     	LDY		#39
   9433 00F4B2                             .0002:
   9434 00F4B2 A2 FF FF                     	LDX		#65535
   9435 00F4B5                             .0001:
   9436 00F4B5 CA                           	DEX
   9437 00F4B6 D0 FD                        	BNE		.0001
   9438 00F4B8 88                           	DEY
   9439 00F4B9 D0 F7                        	BNE		.0002
   9440 00F4BB A9 04 05                     	LDA		#$0504				; gate off
   9441 00F4BE 8F 08 B0 FE                  	STA		SID+SID_CTRL0
   9442 00F4C2 60                           	RTS
                                           
   9444 00F4C3 FF FF FF FF FF FF FF FF      	.org 	$FFD6
   9444 00F4CB FF FF FF FF FF FF FF FF    
   9444 00F4D3 FF FF FF FF FF FF FF FF    
   9444 00F4DB FF FF FF FF FF FF FF FF    
   9444 00F4E3 FF FF FF FF FF FF FF FF    
   9444 00F4EB FF FF FF FF FF FF FF FF    
   9444 00F4F3 FF FF FF FF FF FF FF FF    
   9444 00F4FB FF FF FF FF FF FF FF FF    
   9444 00F503 FF FF FF FF FF FF FF FF    
   9444 00F50B FF FF FF FF FF FF FF FF    
   9444 00F513 FF FF FF FF FF FF FF FF    
   9444 00F51B FF FF FF FF FF FF FF FF    
   9444 00F523 FF FF FF FF FF FF FF FF    
   9444 00F52B FF FF FF FF FF FF FF FF    
   9444 00F533 FF FF FF FF FF FF FF FF    
   9444 00F53B FF FF FF FF FF FF FF FF    
   9444 00F543 FF FF FF FF FF FF FF FF    
   9444 00F54B FF FF FF FF FF FF FF FF    
   9444 00F553 FF FF FF FF FF FF FF FF    
   9444 00F55B FF FF FF FF FF FF FF FF    
   9444 00F563 FF FF FF FF FF FF FF FF    
   9444 00F56B FF FF FF FF FF FF FF FF    
   9444 00F573 FF FF FF FF FF FF FF FF    
   9444 00F57B FF FF FF FF FF FF FF FF    
   9444 00F583 FF FF FF FF FF FF FF FF    
   9444 00F58B FF FF FF FF FF FF FF FF    
   9444 00F593 FF FF FF FF FF FF FF FF    
   9444 00F59B FF FF FF FF FF FF FF FF    
   9444 00F5A3 FF FF FF FF FF FF FF FF    
   9444 00F5AB FF FF FF FF FF FF FF FF    
   9444 00F5B3 FF FF FF FF FF FF FF FF    
   9444 00F5BB FF FF FF FF FF FF FF FF    
   9444 00F5C3 FF FF FF FF FF FF FF FF    
   9444 00F5CB FF FF FF FF FF FF FF FF    
   9444 00F5D3 FF FF FF FF FF FF FF FF    
   9444 00F5DB FF FF FF FF FF FF FF FF    
   9444 00F5E3 FF FF FF FF FF FF FF FF    
   9444 00F5EB FF FF FF FF FF FF FF FF    
   9444 00F5F3 FF FF FF FF FF FF FF FF    
   9444 00F5FB FF FF FF FF FF FF FF FF    
   9444 00F603 FF FF FF FF FF FF FF FF    
   9444 00F60B FF FF FF FF FF FF FF FF    
   9444 00F613 FF FF FF FF FF FF FF FF    
   9444 00F61B FF FF FF FF FF FF FF FF    
   9444 00F623 FF FF FF FF FF FF FF FF    
   9444 00F62B FF FF FF FF FF FF FF FF    
   9444 00F633 FF FF FF FF FF FF FF FF    
   9444 00F63B FF FF FF FF FF FF FF FF    
   9444 00F643 FF FF FF FF FF FF FF FF    
   9444 00F64B FF FF FF FF FF FF FF FF    
   9444 00F653 FF FF FF FF FF FF FF FF    
   9444 00F65B FF FF FF FF FF FF FF FF    
   9444 00F663 FF FF FF FF FF FF FF FF    
   9444 00F66B FF FF FF FF FF FF FF FF    
   9444 00F673 FF FF FF FF FF FF FF FF    
   9444 00F67B FF FF FF FF FF FF FF FF    
   9444 00F683 FF FF FF FF FF FF FF FF    
   9444 00F68B FF FF FF FF FF FF FF FF    
   9444 00F693 FF FF FF FF FF FF FF FF    
   9444 00F69B FF FF FF FF FF FF FF FF    
   9444 00F6A3 FF FF FF FF FF FF FF FF    
   9444 00F6AB FF FF FF FF FF FF FF FF    
   9444 00F6B3 FF FF FF FF FF FF FF FF    
   9444 00F6BB FF FF FF FF FF FF FF FF    
   9444 00F6C3 FF FF FF FF FF FF FF FF    
   9444 00F6CB FF FF FF FF FF FF FF FF    
   9444 00F6D3 FF FF FF FF FF FF FF FF    
   9444 00F6DB FF FF FF FF FF FF FF FF    
   9444 00F6E3 FF FF FF FF FF FF FF FF    
   9444 00F6EB FF FF FF FF FF FF FF FF    
   9444 00F6F3 FF FF FF FF FF FF FF FF    
   9444 00F6FB FF FF FF FF FF FF FF FF    
   9444 00F703 FF FF FF FF FF FF FF FF    
   9444 00F70B FF FF FF FF FF FF FF FF    
   9444 00F713 FF FF FF FF FF FF FF FF    
   9444 00F71B FF FF FF FF FF FF FF FF    
   9444 00F723 FF FF FF FF FF FF FF FF    
   9444 00F72B FF FF FF FF FF FF FF FF    
   9444 00F733 FF FF FF FF FF FF FF FF    
   9444 00F73B FF FF FF FF FF FF FF FF    
   9444 00F743 FF FF FF FF FF FF FF FF    
   9444 00F74B FF FF FF FF FF FF FF FF    
   9444 00F753 FF FF FF FF FF FF FF FF    
   9444 00F75B FF FF FF FF FF FF FF FF    
   9444 00F763 FF FF FF FF FF FF FF FF    
   9444 00F76B FF FF FF FF FF FF FF FF    
   9444 00F773 FF FF FF FF FF FF FF FF    
   9444 00F77B FF FF FF FF FF FF FF FF    
   9444 00F783 FF FF FF FF FF FF FF FF    
   9444 00F78B FF FF FF FF FF FF FF FF    
   9444 00F793 FF FF FF FF FF FF FF FF    
   9444 00F79B FF FF FF FF FF FF FF FF    
   9444 00F7A3 FF FF FF FF FF FF FF FF    
   9444 00F7AB FF FF FF FF FF FF FF FF    
   9444 00F7B3 FF FF FF FF FF FF FF FF    
   9444 00F7BB FF FF FF FF FF FF FF FF    
   9444 00F7C3 FF FF FF FF FF FF FF FF    
   9444 00F7CB FF FF FF FF FF FF FF FF    
   9444 00F7D3 FF FF FF FF FF FF FF FF    
   9444 00F7DB FF FF FF FF FF FF FF FF    
   9444 00F7E3 FF FF FF FF FF FF FF FF    
   9444 00F7EB FF FF FF FF FF FF FF FF    
   9444 00F7F3 FF FF FF FF FF FF FF FF    
   9444 00F7FB FF FF FF FF FF FF FF FF    
   9444 00F803 FF FF FF FF FF FF FF FF    
   9444 00F80B FF FF FF FF FF FF FF FF    
   9444 00F813 FF FF FF FF FF FF FF FF    
   9444 00F81B FF FF FF FF FF FF FF FF    
   9444 00F823 FF FF FF FF FF FF FF FF    
   9444 00F82B FF FF FF FF FF FF FF FF    
   9444 00F833 FF FF FF FF FF FF FF FF    
   9444 00F83B FF FF FF FF FF FF FF FF    
   9444 00F843 FF FF FF FF FF FF FF FF    
   9444 00F84B FF FF FF FF FF FF FF FF    
   9444 00F853 FF FF FF FF FF FF FF FF    
   9444 00F85B FF FF FF FF FF FF FF FF    
   9444 00F863 FF FF FF FF FF FF FF FF    
   9444 00F86B FF FF FF FF FF FF FF FF    
   9444 00F873 FF FF FF FF FF FF FF FF    
   9444 00F87B FF FF FF FF FF FF FF FF    
   9444 00F883 FF FF FF FF FF FF FF FF    
   9444 00F88B FF FF FF FF FF FF FF FF    
   9444 00F893 FF FF FF FF FF FF FF FF    
   9444 00F89B FF FF FF FF FF FF FF FF    
   9444 00F8A3 FF FF FF FF FF FF FF FF    
   9444 00F8AB FF FF FF FF FF FF FF FF    
   9444 00F8B3 FF FF FF FF FF FF FF FF    
   9444 00F8BB FF FF FF FF FF FF FF FF    
   9444 00F8C3 FF FF FF FF FF FF FF FF    
   9444 00F8CB FF FF FF FF FF FF FF FF    
   9444 00F8D3 FF FF FF FF FF FF FF FF    
   9444 00F8DB FF FF FF FF FF FF FF FF    
   9444 00F8E3 FF FF FF FF FF FF FF FF    
   9444 00F8EB FF FF FF FF FF FF FF FF    
   9444 00F8F3 FF FF FF FF FF FF FF FF    
   9444 00F8FB FF FF FF FF FF FF FF FF    
   9444 00F903 FF FF FF FF FF FF FF FF    
   9444 00F90B FF FF FF FF FF FF FF FF    
   9444 00F913 FF FF FF FF FF FF FF FF    
   9444 00F91B FF FF FF FF FF FF FF FF    
   9444 00F923 FF FF FF FF FF FF FF FF    
   9444 00F92B FF FF FF FF FF FF FF FF    
   9444 00F933 FF FF FF FF FF FF FF FF    
   9444 00F93B FF FF FF FF FF FF FF FF    
   9444 00F943 FF FF FF FF FF FF FF FF    
   9444 00F94B FF FF FF FF FF FF FF FF    
   9444 00F953 FF FF FF FF FF FF FF FF    
   9444 00F95B FF FF FF FF FF FF FF FF    
   9444 00F963 FF FF FF FF FF FF FF FF    
   9444 00F96B FF FF FF FF FF FF FF FF    
   9444 00F973 FF FF FF FF FF FF FF FF    
   9444 00F97B FF FF FF FF FF FF FF FF    
   9444 00F983 FF FF FF FF FF FF FF FF    
   9444 00F98B FF FF FF FF FF FF FF FF    
   9444 00F993 FF FF FF FF FF FF FF FF    
   9444 00F99B FF FF FF FF FF FF FF FF    
   9444 00F9A3 FF FF FF FF FF FF FF FF    
   9444 00F9AB FF FF FF FF FF FF FF FF    
   9444 00F9B3 FF FF FF FF FF FF FF FF    
   9444 00F9BB FF FF FF FF FF FF FF FF    
   9444 00F9C3 FF FF FF FF FF FF FF FF    
   9444 00F9CB FF FF FF FF FF FF FF FF    
   9444 00F9D3 FF FF FF FF FF FF FF FF    
   9444 00F9DB FF FF FF FF FF FF FF FF    
   9444 00F9E3 FF FF FF FF FF FF FF FF    
   9444 00F9EB FF FF FF FF FF FF FF FF    
   9444 00F9F3 FF FF FF FF FF FF FF FF    
   9444 00F9FB FF FF FF FF FF FF FF FF    
   9444 00FA03 FF FF FF FF FF FF FF FF    
   9444 00FA0B FF FF FF FF FF FF FF FF    
   9444 00FA13 FF FF FF FF FF FF FF FF    
   9444 00FA1B FF FF FF FF FF FF FF FF    
   9444 00FA23 FF FF FF FF FF FF FF FF    
   9444 00FA2B FF FF FF FF FF FF FF FF    
   9444 00FA33 FF FF FF FF FF FF FF FF    
   9444 00FA3B FF FF FF FF FF FF FF FF    
   9444 00FA43 FF FF FF FF FF FF FF FF    
   9444 00FA4B FF FF FF FF FF FF FF FF    
   9444 00FA53 FF FF FF FF FF FF FF FF    
   9444 00FA5B FF FF FF FF FF FF FF FF    
   9444 00FA63 FF FF FF FF FF FF FF FF    
   9444 00FA6B FF FF FF FF FF FF FF FF    
   9444 00FA73 FF FF FF FF FF FF FF FF    
   9444 00FA7B FF FF FF FF FF FF FF FF    
   9444 00FA83 FF FF FF FF FF FF FF FF    
   9444 00FA8B FF FF FF FF FF FF FF FF    
   9444 00FA93 FF FF FF FF FF FF FF FF    
   9444 00FA9B FF FF FF FF FF FF FF FF    
   9444 00FAA3 FF FF FF FF FF FF FF FF    
   9444 00FAAB FF FF FF FF FF FF FF FF    
   9444 00FAB3 FF FF FF FF FF FF FF FF    
   9444 00FABB FF FF FF FF FF FF FF FF    
   9444 00FAC3 FF FF FF FF FF FF FF FF    
   9444 00FACB FF FF FF FF FF FF FF FF    
   9444 00FAD3 FF FF FF FF FF FF FF FF    
   9444 00FADB FF FF FF FF FF FF FF FF    
   9444 00FAE3 FF FF FF FF FF FF FF FF    
   9444 00FAEB FF FF FF FF FF FF FF FF    
   9444 00FAF3 FF FF FF FF FF FF FF FF    
   9444 00FAFB FF FF FF FF FF FF FF FF    
   9444 00FB03 FF FF FF FF FF FF FF FF    
   9444 00FB0B FF FF FF FF FF FF FF FF    
   9444 00FB13 FF FF FF FF FF FF FF FF    
   9444 00FB1B FF FF FF FF FF FF FF FF    
   9444 00FB23 FF FF FF FF FF FF FF FF    
   9444 00FB2B FF FF FF FF FF FF FF FF    
   9444 00FB33 FF FF FF FF FF FF FF FF    
   9444 00FB3B FF FF FF FF FF FF FF FF    
   9444 00FB43 FF FF FF FF FF FF FF FF    
   9444 00FB4B FF FF FF FF FF FF FF FF    
   9444 00FB53 FF FF FF FF FF FF FF FF    
   9444 00FB5B FF FF FF FF FF FF FF FF    
   9444 00FB63 FF FF FF FF FF FF FF FF    
   9444 00FB6B FF FF FF FF FF FF FF FF    
   9444 00FB73 FF FF FF FF FF FF FF FF    
   9444 00FB7B FF FF FF FF FF FF FF FF    
   9444 00FB83 FF FF FF FF FF FF FF FF    
   9444 00FB8B FF FF FF FF FF FF FF FF    
   9444 00FB93 FF FF FF FF FF FF FF FF    
   9444 00FB9B FF FF FF FF FF FF FF FF    
   9444 00FBA3 FF FF FF FF FF FF FF FF    
   9444 00FBAB FF FF FF FF FF FF FF FF    
   9444 00FBB3 FF FF FF FF FF FF FF FF    
   9444 00FBBB FF FF FF FF FF FF FF FF    
   9444 00FBC3 FF FF FF FF FF FF FF FF    
   9444 00FBCB FF FF FF FF FF FF FF FF    
   9444 00FBD3 FF FF FF FF FF FF FF FF    
   9444 00FBDB FF FF FF FF FF FF FF FF    
   9444 00FBE3 FF FF FF FF FF FF FF FF    
   9444 00FBEB FF FF FF FF FF FF FF FF    
   9444 00FBF3 FF FF FF FF FF FF FF FF    
   9444 00FBFB FF FF FF FF FF FF FF FF    
   9444 00FC03 FF FF FF FF FF FF FF FF    
   9444 00FC0B FF FF FF FF FF FF FF FF    
   9444 00FC13 FF FF FF FF FF FF FF FF    
   9444 00FC1B FF FF FF FF FF FF FF FF    
   9444 00FC23 FF FF FF FF FF FF FF FF    
   9444 00FC2B FF FF FF FF FF FF FF FF    
   9444 00FC33 FF FF FF FF FF FF FF FF    
   9444 00FC3B FF FF FF FF FF FF FF FF    
   9444 00FC43 FF FF FF FF FF FF FF FF    
   9444 00FC4B FF FF FF FF FF FF FF FF    
   9444 00FC53 FF FF FF FF FF FF FF FF    
   9444 00FC5B FF FF FF FF FF FF FF FF    
   9444 00FC63 FF FF FF FF FF FF FF FF    
   9444 00FC6B FF FF FF FF FF FF FF FF    
   9444 00FC73 FF FF FF FF FF FF FF FF    
   9444 00FC7B FF FF FF FF FF FF FF FF    
   9444 00FC83 FF FF FF FF FF FF FF FF    
   9444 00FC8B FF FF FF FF FF FF FF FF    
   9444 00FC93 FF FF FF FF FF FF FF FF    
   9444 00FC9B FF FF FF FF FF FF FF FF    
   9444 00FCA3 FF FF FF FF FF FF FF FF    
   9444 00FCAB FF FF FF FF FF FF FF FF    
   9444 00FCB3 FF FF FF FF FF FF FF FF    
   9444 00FCBB FF FF FF FF FF FF FF FF    
   9444 00FCC3 FF FF FF FF FF FF FF FF    
   9444 00FCCB FF FF FF FF FF FF FF FF    
   9444 00FCD3 FF FF FF FF FF FF FF FF    
   9444 00FCDB FF FF FF FF FF FF FF FF    
   9444 00FCE3 FF FF FF FF FF FF FF FF    
   9444 00FCEB FF FF FF FF FF FF FF FF    
   9444 00FCF3 FF FF FF FF FF FF FF FF    
   9444 00FCFB FF FF FF FF FF FF FF FF    
   9444 00FD03 FF FF FF FF FF FF FF FF    
   9444 00FD0B FF FF FF FF FF FF FF FF    
   9444 00FD13 FF FF FF FF FF FF FF FF    
   9444 00FD1B FF FF FF FF FF FF FF FF    
   9444 00FD23 FF FF FF FF FF FF FF FF    
   9444 00FD2B FF FF FF FF FF FF FF FF    
   9444 00FD33 FF FF FF FF FF FF FF FF    
   9444 00FD3B FF FF FF FF FF FF FF FF    
   9444 00FD43 FF FF FF FF FF FF FF FF    
   9444 00FD4B FF FF FF FF FF FF FF FF    
   9444 00FD53 FF FF FF FF FF FF FF FF    
   9444 00FD5B FF FF FF FF FF FF FF FF    
   9444 00FD63 FF FF FF FF FF FF FF FF    
   9444 00FD6B FF FF FF FF FF FF FF FF    
   9444 00FD73 FF FF FF FF FF FF FF FF    
   9444 00FD7B FF FF FF FF FF FF FF FF    
   9444 00FD83 FF FF FF FF FF FF FF FF    
   9444 00FD8B FF FF FF FF FF FF FF FF    
   9444 00FD93 FF FF FF FF FF FF FF FF    
   9444 00FD9B FF FF FF FF FF FF FF FF    
   9444 00FDA3 FF FF FF FF FF FF FF FF    
   9444 00FDAB FF FF FF FF FF FF FF FF    
   9444 00FDB3 FF FF FF FF FF FF FF FF    
   9444 00FDBB FF FF FF FF FF FF FF FF    
   9444 00FDC3 FF FF FF FF FF FF FF FF    
   9444 00FDCB FF FF FF FF FF FF FF FF    
   9444 00FDD3 FF FF FF FF FF FF FF FF    
   9444 00FDDB FF FF FF FF FF FF FF FF    
   9444 00FDE3 FF FF FF FF FF FF FF FF    
   9444 00FDEB FF FF FF FF FF FF FF FF    
   9444 00FDF3 FF FF FF FF FF FF FF FF    
   9444 00FDFB FF FF FF FF FF FF FF FF    
   9444 00FE03 FF FF FF FF FF FF FF FF    
   9444 00FE0B FF FF FF FF FF FF FF FF    
   9444 00FE13 FF FF FF FF FF FF FF FF    
   9444 00FE1B FF FF FF FF FF FF FF FF    
   9444 00FE23 FF FF FF FF FF FF FF FF    
   9444 00FE2B FF FF FF FF FF FF FF FF    
   9444 00FE33 FF FF FF FF FF FF FF FF    
   9444 00FE3B FF FF FF FF FF FF FF FF    
   9444 00FE43 FF FF FF FF FF FF FF FF    
   9444 00FE4B FF FF FF FF FF FF FF FF    
   9444 00FE53 FF FF FF FF FF FF FF FF    
   9444 00FE5B FF FF FF FF FF FF FF FF    
   9444 00FE63 FF FF FF FF FF FF FF FF    
   9444 00FE6B FF FF FF FF FF FF FF FF    
   9444 00FE73 FF FF FF FF FF FF FF FF    
   9444 00FE7B FF FF FF FF FF FF FF FF    
   9444 00FE83 FF FF FF FF FF FF FF FF    
   9444 00FE8B FF FF FF FF FF FF FF FF    
   9444 00FE93 FF FF FF FF FF FF FF FF    
   9444 00FE9B FF FF FF FF FF FF FF FF    
   9444 00FEA3 FF FF FF FF FF FF FF FF    
   9444 00FEAB FF FF FF FF FF FF FF FF    
   9444 00FEB3 FF FF FF FF FF FF FF FF    
   9444 00FEBB FF FF FF FF FF FF FF FF    
   9444 00FEC3 FF FF FF FF FF FF FF FF    
   9444 00FECB FF FF FF FF FF FF FF FF    
   9444 00FED3 FF FF FF FF FF FF FF FF    
   9444 00FEDB FF FF FF FF FF FF FF FF    
   9444 00FEE3 FF FF FF FF FF FF FF FF    
   9444 00FEEB FF FF FF FF FF FF FF FF    
   9444 00FEF3 FF FF FF FF FF FF FF FF    
   9444 00FEFB FF FF FF FF FF FF FF FF    
   9444 00FF03 FF FF FF FF FF FF FF FF    
   9444 00FF0B FF FF FF FF FF FF FF FF    
   9444 00FF13 FF FF FF FF FF FF FF FF    
   9444 00FF1B FF FF FF FF FF FF FF FF    
   9444 00FF23 FF FF FF FF FF FF FF FF    
   9444 00FF2B FF FF FF FF FF FF FF FF    
   9444 00FF33 FF FF FF FF FF FF FF FF    
   9444 00FF3B FF FF FF FF FF FF FF FF    
   9444 00FF43 FF FF FF FF FF FF FF FF    
   9444 00FF4B FF FF FF FF FF FF FF FF    
   9444 00FF53 FF FF FF FF FF FF FF FF    
   9444 00FF5B FF FF FF FF FF FF FF FF    
   9444 00FF63 FF FF FF FF FF FF FF FF    
   9444 00FF6B FF FF FF FF FF FF FF FF    
   9444 00FF73 FF FF FF FF FF FF FF FF    
   9444 00FF7B FF FF FF FF FF FF FF FF    
   9444 00FF83 FF FF FF FF FF FF FF FF    
   9444 00FF8B FF FF FF FF FF FF FF FF    
   9444 00FF93 FF FF FF FF FF FF FF FF    
   9444 00FF9B FF FF FF FF FF FF FF FF    
   9444 00FFA3 FF FF FF FF FF FF FF FF    
   9444 00FFAB FF FF FF FF FF FF FF FF    
   9444 00FFB3 FF FF FF FF FF FF FF FF    
   9444 00FFBB FF FF FF FF FF FF FF FF    
   9444 00FFC3 FF FF FF FF FF FF FF FF    
   9444 00FFCB FF FF FF FF FF FF FF FF    
   9444 00FFD3 FF FF FF                   
   9445 00FFD6 04 00                        	dw		4			; task #4
                                           
   9447 00FFD8 FF FF FF FF FF FF            	.org	$FFDE
   9448 00FFDE 06 00                        	dw		6			; task #6
                                           
   9450 00FFE0 FF FF FF FF FF FF            	.org 	$FFE6
   9451 00FFE6 00 F2                        	dw		BrkRout
                                           
   9453 00FFE8 FF FF FF FF FF FF            	.org	$FFEE		; IRQ vector
   9454 00FFEE 81 F1                        	dw		IRQRout
                                           
   9456 00FFF0 FF FF FF FF FF FF FF FF      	.org	$FFFC
   9456 00FFF8 FF FF FF FF                
   9457 00FFFC 00 E0                        	dw		$E000
                                           
                                           	.org	$FFFE
   9460 00FFFE 80 F1                        	dw		ByteIRQRout

Checksum=76BA8203

Number of instructions processed: 3961
Number of opcode bytes: 8841
Bytes per instruction: 2.232012 (17.856097 bits)
Clock cycle count: 5460
Clocks per instruction: 1.378440

The above statistics are only estimates.

	The CPI assumes data memory access requires two clock cycles and instruction
	access is single cycle. The actual CPI may be higher if there are memory wait 
	states, or lower if data is found in the cache.
