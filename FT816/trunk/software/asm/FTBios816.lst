Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
FTBios816.asm

                                        ; ============================================================================
                                        ; FTBios816.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014-2017  Robert Finch, Waterloo
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
     25 = 000000000000000D                            CR			EQU		13
     26 = 000000000000000A                            LF			EQU		10
     27 = 000000000000001B                            ESC			EQU		$1B
     28 = 0000000000000008                            BS			EQU		8
     29 = 0000000000000003                            CTRLC		EQU		3
                                        
     31 = 0000000000000012                            SC_LSHIFT	EQU		$12
     32 = 0000000000000059                            SC_RSHIFT	EQU		$59
     33 = 00000000000000F0                            SC_KEYUP	EQU		$F0
     34 = 00000000000000E0                            SC_EXTEND	EQU		$E0
     35 = 0000000000000014                            SC_CTRL		EQU		$14
     36 = 0000000000000011                            SC_ALT		EQU		$11
     37 = 0000000000000071                            SC_DEL		EQU		$71		; extend
     38 = 0000000000000058                            SC_LCTRL	EQU		$58
     39 = 0000000000000077                            SC_NUMLOCK	EQU		$77
     40 = 000000000000007E                            SC_SCROLLLOCK	EQU	$7E
     41 = 0000000000000058                            SC_CAPSLOCK	EQU		$58
                                        
     43 = 000000000000001F                            TEXTROWS	EQU		31
     44 = 0000000000000054                            TEXTCOLS	EQU		84
                                        
     46 = 0000000000000004                            TickCount	EQU		$4
     47 = 0000000000000008                            KeyState1	EQU		$8
     48 = 0000000000000009                            KeyState2	EQU		$9
     49 = 000000000000000A                            KeybdLEDs	EQU		$A
     50 = 000000000000000B                            KeybdWaitFlag	EQU	$B
     51 = 000000000000000C                            NumWorkArea	EQU		$C
                                        
                                        ; Range $10 to $1F reserved for hardware counters
     54 = 0000000000000010                            CNT0L		EQU		$10
     55 = 0000000000000011                            CNT0M		EQU		$11
     56 = 0000000000000012                            CNT0H		EQU		$12
     57 = 0000000000000020                            RangeStart	EQU		$20
     58 = 0000000000000024                            RangeEnd	EQU		$24
     59 = 0000000000000030                            CursorX		EQU		$30
     60 = 0000000000000032                            CursorY		EQU		$32
     61 = 0000000000000034                            VideoPos	EQU		$34
     62 = 0000000000000036                            NormAttr	EQU		$36
     63 = 0000000000000038                            StringPos	EQU		$38
     64 = 000000000000003C                            EscState	EQU		$3C
     65 = 0000000000000040                            Vidptr		EQU		$40
     66 = 0000000000000046                            Vidregs		EQU		$46
     67 = 000000000000004C                            Textcols	EQU		$4C
     68 = 000000000000004E                            Textrows	EQU		$4E
                                        
     70 = 0000000000000080                            reg_cs		EQU		$80
     71 = 00000084                      reg_ds		EQU		reg_cs + 4
     72 = 00000088                      reg_ss		EQU		reg_ds + 4
     73 = 0000008C                      reg_pc		EQU		reg_ss + 4
     74 = 00000090                      reg_a		EQU		reg_pc + 4
     75 = 00000094                      reg_x		EQU		reg_a + 4
     76 = 00000098                      reg_y		EQU		reg_x + 4
     77 = 0000009C                      reg_sp		EQU		reg_y + 4
     78 = 000000A0                      reg_sr		EQU		reg_sp + 4
     79 = 000000A4                      reg_db		EQU		reg_sr + 4
     80 = 000000A8                      reg_dp		EQU		reg_db + 4
     81 = 000000AC                      reg_bl		EQU		reg_dp + 4
                                        
     83 = 0000000000000080                            cs_save		EQU		$80
     84 = 0000000000000084                            ds_save		EQU		$84
     85 = 0000000000000088                            pc_save		EQU		$88
     86 = 000000000000008C                            pb_save		EQU		$8C
     87 = 0000000000000090                            acc_save	EQU		$90
     88 = 0000000000000094                            x_save		EQU		$94
     89 = 0000000000000098                            y_save		EQU		$98
     90 = 000000000000009C                            sp_save		EQU		$9C
     91 = 00000000000000A0                            sr_save		EQU		$A0
     92 = 00000000000000A4                            srx_save	EQU		$A4
     93 = 00000000000000A8                            db_save		EQU		$A8
     94 = 00000000000000AC                            dpr_save	EQU		$AC
                                        
     96 = 00000000000000B8                            running_task	EQU		$B8
                                        
     98 = 00000000000000BA                            keybd_char	EQU		$BA
     99 = 00000000000000BC                            keybd_cmd	EQU		$BC
    100 = 00000000000000BE                            WorkTR		EQU		$BE
    101 = 0000000000000100                            ldtrec		EQU		$100
    102 = 0000000000000104                            timeout1	EQU		$104
                                        
    104 = 00000000000003F0                            OutputVec	EQU		$03F0
                                        
    106 = 000000000000B000                            PCS0		EQU		$B000
    107 = 0000B002                      PCS1		EQU		PCS0 + 2
    108 = 0000B004                      PCS2		EQU		PCS1 + 2
    109 = 0000B006                      PCS3		EQU		PCS2 + 2
    110 = 0000B008                      PCS4	    EQU		PCS3 + 2
    111 = 0000B00A                      PCS5		EQU		PCS4 + 2
    112 = 0000B010                      CTR0_LMT	EQU		PCS0 + 16
    113 = 0000B013                      CTR0_CTRL	EQU		CTR0_LMT + 3
    114 = 0000B014                      CTR1_LMT	EQU		CTR0_CTRL + 1
    115 = 0000B017                      CTR1_CTRL	EQU		CTR1_LMT + 3
    116 = 000000000000B01F                            MPU_IRQ_STATUS	EQU		$B01F
                                        
    118 = 00000000000D0000                            VIDBUF		EQU		$D0000		; FD0000
    119 = 00000000000EA000                            VIDREGS		EQU		$EA000
    120 = 00000000000EA100                            PRNG		EQU		$EA100
    121 = 00000000000EA110                            KEYBD		EQU		$EA110
    122 = 00000000000EA200                            FAC1		EQU		$EA200
                                        
    124 = 00000000000EB000                            SID			EQU		$EB000		; FEB000
    125 = 0000000000000000                            SID_FREQ0		EQU		$00
    126 = 0000000000000004                            SID_PW0			EQU		$04
    127 = 0000000000000008                            SID_CTRL0		EQU		$08
    128 = 000000000000000C                            SID_ATTACK0		EQU		$0C
    129 = 0000000000000010                            SID_DECAY0		EQU		$10
    130 = 0000000000000014                            SID_SUSTAIN0	EQU		$14
    131 = 0000000000000018                            SID_RELEASE0	EQU		$18
    132 = 000000000000001C                            SID_WADR0		EQU		$1C
    133 = 00000000000000B0                            SID_VOLUME		EQU		$B0
                                        
    135 = 0000000000007868                            do_invaders			EQU		$7868
                                        
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
supermon832.asm

                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;	.opt proc65c02,caseinsensitive
                                        	cpu	W65C02
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;*                                                                                 *
                                        ;*      SUPERMON 816 MACHINE LANGUAGE MONITOR FOR THE W65C816S MICROPROCESSOR      *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;*      Copyright ©1991-2014 by BCS Technology Limited.  All rights reserved.      *
                                        ;*                                                                                 *
                                        ;* Permission is hereby granted to use, copy, modify and distribute this software, *
                                        ;* provided this copyright notice remains in the source code and  proper  attribu- *
                                        ;* tion is given.  Redistribution, regardless of form, must be at no charge to the *
                                        ;* end  user.  This code or any part thereof, including any derivation, MAY NOT be *
                                        ;* incorporated into any package intended for sale,  unless written permission has * 
                                        ;* been given by the copyright holder.                                             *
                                        ;*                                                                                 *
                                        ;* THERE IS NO WARRANTY OF ANY KIND WITH THIS SOFTWARE.  The user assumes all risk *
                                        ;* in connection with the incorporation of this software into any system.          *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a salute to Jim Butterfield, who passed away on June 29, 2007.  *
                                        ;*                                                                                 *
                                        ;* Jim, who was the unofficial  spokesman for  Commodore  International during the *  
                                        ;* heyday of the company's 8 bit supremacy, scratch-developed the Supermon machine *
                                        ;* language monitor for the PET & CBM computers.   When the best-selling Commodore *
                                        ;* 64 was introduced, Jim adapted his software to the new machine & gave the adap- *
                                        ;* tation the name Supermon 64.   Commodore  subsequently  integrated a customized *
                                        ;* version of Supermon 64 into the C-128 to act as the resident M/L monitor.       *
                                        ;*                                                                                 *
                                        ;* Although Supermon 816 is not an adaptation of Supermon 64,  it was  decided  to *
                                        ;* keep the Supermon name alive, since Supermon 816's general operation & user in- *
                                        ;* terface is similar to that of Supermon 64.   Supermon 816 is 100 percent native *
                                        ;* mode 65C816 code & was developed from a blank canvas.                           *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* This version customized for the RTF65002 test system                            *
                                        ;* Finitron.ca                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* Supermon 816 is a full featured monitor and supports the following operations:  *
                                        ;*                                                                                 *
                                        ;*     A — Assemble code                                                           *
                                        ;*     C — Compare memory regions                                                  *
                                        ;*     D — Disassemble code                                                        *
                                        ;*     F — Fill memory region (cannot span banks)                                  *
                                        ;*     G — Execute code (stops at BRK)                                             *
                                        ;*     H — Search (hunt) memory region                                             *
                                        ;*     J — Execute code as a subroutine (stops at BRK or RTS)                      *
                                        ;*     M — Dump & display memory range                                             *
                                        ;*     R — Dump & display 65C816 registers                                         *
                                        ;*     T — Copy (transfer) memory region                                           *
                                        ;*     X — Exit Supermon 816 & return to operating environment                     *
                                        ;*     > — Modify up to 32 bytes of memory                                         *
                                        ;*     ; — Modify 65C816 registers                                                 *
                                        ;*                                                                                 *
                                        ;* Supermon 816 accepts binary (%), octal (@), decimal (+) and hexadecimal ($) as  *
                                        ;* input for numeric parameters.  Additionally, the H and > operations accept an   *
                                        ;* ASCII string in place of numeric values by preceding the string with ', e.g.:   *
                                        ;*                                                                                 *
                                        ;*     h 042000 042FFF 'BCS Technology Limited                                     *
                                        ;*                                                                                 *
                                        ;* If no radix symbol is entered hex is assumed.                                   *
                                        ;*                                                                                 *
                                        ;* Numeric conversion is also available.  For example, typing:                     *
                                        ;*                                                                                 *
                                        ;*     +1234567 <CR>                                                               *
                                        ;*                                                                                 *
                                        ;* will display:                                                                   *
                                        ;*                                                                                 *
                                        ;*         $12D687                                                                 *
                                        ;*         +1234567                                                                *
                                        ;*         @04553207                                                               *
                                        ;*         %100101101011010000111                                                  *
                                        ;*                                                                                 *
                                        ;* In the above example, <CR> means the console keyboard's return or enter key.    *
                                        ;*                                                                                 *
                                        ;* All numeric values are internally processed as 32 bit unsigned integers.  Addr- *
                                        ;* esses may be entered as 8, 16 or 24 bit values.  During instruction assembly,   *
                                        ;* immediate mode operands may be forced to 16 bits by preceding the operand with  *
                                        ;* an exclamation point if the instruction can accept a 16 bit operand, e.g.:      *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 lda !#4                                                            *
                                        ;*                                                                                 *
                                        ;* The above will assemble as:                                                     *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A9 04 00     LDA #$0004                                           *
                                        ;*                                                                                 *
                                        ;* Entering:                                                                       *
                                        ;*                                                                                 *
                                        ;*     a 1f2000 ldx !#+157                                                         *
                                        ;*                                                                                 *
                                        ;* will assemble as:                                                               *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D 00     LDX #$009D                                           *
                                        ;*                                                                                 *
                                        ;* Absent the ! in the operand field, the above would have been assembled as:      *
                                        ;*                                                                                 *
                                        ;*     A 1F2000  A2 9D        LDX #$9D                                             *
                                        ;*                                                                                 *
                                        ;* If an immediate mode operand is greater than $FF assembly of a 16 bit operand   *
                                        ;* is implied.                                                                     *
                                        ;* ——————————————————————————————————————————————————————————————————————————————— *
                                        ;* A Note on the PEA & PEI Instructions                                            *
                                        ;* ————————————————————————————————————                                            *
                                        ;*                                                                                 *
                                        ;* The Eyes and Lichty programming manual uses the following syntax for the PEA    *
                                        ;* and PEI instructions:                                                           *
                                        ;*                                                                                 *
                                        ;*     PEA <operand>                                                               *
                                        ;*     PEI (<operand>)                                                             *
                                        ;*                                                                                 *
                                        ;* The WDC data sheet that was published at the time of the 65C816's release in    *
                                        ;* 1984 does not indicate a recommended or preferred syntax for any of the above   *
                                        ;* instructions.  PEA pushes its operand to the stack and hence operates like any  *
                                        ;* other immediate mode instruction, in that the operand is the data (however, PEA *
                                        ;* doesn't affect the status register).  Similarly, PEI pushes the 16 bit value    *
                                        ;* stored at <operand> and <operand>+1, and hence operates like any other direct   *
                                        ;* (zero) page instruction, again without affecting the status register.           *
                                        ;*                                                                                 *
                                        ;* BCS Technology Limited is of the opinion that the developer of the ORCA/M as-   *
                                        ;* sembler, which is the assembler referred to in the Eyes and Lichty manual, mis- *
                                        ;* understood how PEA and PEI behave during runtime, and hence chose an incorrect  *
                                        ;* syntax for these two instructions.  This error was subsequently carried forward *
                                        ;* by Eyes and Lichty.                                                             *
                                        ;*                                                                                 *
                                        ;* Supermon 816's assembler uses the following syntax for PEA and PEI:             *
                                        ;*                                                                                 *
                                        ;*     PEA #<operand>                                                              *
                                        ;*     PEI <operand>                                                               *
                                        ;*                                                                                 *
                                        ;* The operand for PEA is treated as a 16 bit value, even if entered as an 8 bit   *
                                        ;* value.  The operand for PEI must be 8 bits.                                     *
                                        ;*                                                                                 *
                                        ;* * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;	* * * * * * * * * * * *
                                        ;	* VERSION INFORMATION *
                                        ;	* * * * * * * * * * * *
                                        ;
                                        softvers .macro                ;software version — change with each revision...
                                                 .byte "1"             ;major
                                                 .byte "."
                                                 .byte "0"             ;minor
                                                 .byte "."
                                                 .byte "0"             ;revision
                                                 .endm
                                        ;
                                        ;REVISION TABLE
                                        ;
                                        ;Ver  Rev Date    Description
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;1.0  2013/11/01  A) Original derived from the POC V1.1 single-board computer
                                        ;                    firmware.
                                        ;     2013/11/04  A) Fixed a problem where the B-accumulator wasn't always being
                                        ;                    be copied to shadow storage after return from execution of
                                        ;                    a J command.
                                        ;———————————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	        COMMENT ABBREVIATIONS
                                        ;	————————————————————————————————————————————————————
                                        ;	  BCD   binary-coded decimal
                                        ;	   DP   direct page or page zero
                                        ;	  EOF   end-of-field
                                        ;	  EOI   end-of-input
                                        ;	  LSB   least significant byte/bit
                                        ;	  LSD   least significant digit
                                        ;	  LSN   least significant nybble
                                        ;	  LSW   least significant word
                                        ;	  MPU   microprocessor
                                        ;	  MSB   most significant byte/bit
                                        ;	  MSD   most significant digit
                                        ;	  MSN   most significant nybble
                                        ;	  MSW   most-significant word
                                        ;	  RAM   random access memory
                                        ;	   WS   whitespace, i.e., blanks & horizontal tabs
                                        ;	————————————————————————————————————————————————————
                                        ;	A word is defined as 16 bits.
                                        ;
                                        ;	   MPU REGISTER SYMBOLS
                                        ;	——————————————————————————
                                        ;	   .A   accumulator LSB
                                        ;	   .B   accumulator MSB
                                        ;	   .C   16 bit accumulator
                                        ;	   .X   X-index
                                        ;	   .Y   Y-index
                                        ;      DS   data segment
                                        ;	   DB   data bank
                                        ;	   DP   direct page
                                        ;      CS   code segment
                                        ;	   PB   program bank
                                        ;	   PC   program counter
                                        ;	   SP   stack pointer
                                        ;	   SR   MPU status
                                        ;      SRX  status extension
                                        ;	————————————————————————————
                                        ;
                                        ;	  MPU STATUS REGISTER SYMBOLS
                                        ;	———————————————————————————————
                                        ;	    C   carry
                                        ;	    D   decimal mode
                                        ;	    I   maskable interrupts
                                        ;	    m   accumulator/memory size
                                        ;	    N   result negative
                                        ;	    V   sign overflow
                                        ;	    x   index registers size
                                        ;	    Z   result zero
                                        ;
                                        ;      16   16 bit emulation flag
                                        ;      32   32 bit emulation flag
                                        ;	———————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SYSTEM INTERFACE DEFINITIONS
                                        ;
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;	This section defines the interface between Supermon 816 & the host
                                        ;	system.   Change these definitions to suit your system, but do not
                                        ;	change any label names.  All definitions must have valid values in
                                        ;	order to assemble Supermon 816.
                                        ;	——————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————
    358 = 000000000000C000                            _origin_ =$00C000              ;assembly address...
                                        ;
                                        ;	Set _ORIGIN_ to Supermon 816's desired assembly address.
                                        ;	————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    364 = 000000000000FE03                            vecexit  =$00FE03              ;exit to environment address...
                                        ;
                                        ;	Set VECEXIT to where Supermon 816 should go when it exits.  Supermon 816
                                        ;	will do a JML (long jump) to this address, which means VECEXIT must be a
                                        ;	24 bit address.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    372 = 0000000000000102                            vecbrki  =$0102                ;BRK handler indirect vector...
    373 = 0000000000000105                            vecbrkia =$0105                ;system indirect BRK vector
                                        ;
                                        ;	Supermon 816 will modify this vector so that execution of a BRK instruc-
                                        ;	tion is intercepted & the registers  are  captured.   Your BRK front end
                                        ;	should jump through this vector after pushing the registers as follows:
                                        ;
                                        ;	         phb                   ;save DB
                                        ;	         phd                   ;save DP
                                        ;	         rep #%00110000        ;16 bit registers
                                        ;	         pha
                                        ;	         phx
                                        ;	         phy
                                        ;	         jmp (vecbrki)         ;indirect vector
                                        ;
                                        ;	When a G or J command is issued, the above sequence will be reversed be-
                                        ;	fore a jump is made to the code to be executed.  Upon exit from Supermon
                                        ;	816, the original address at VECBRKI will be restored.
                                        ;
                                        ;	If your BRK front end doesn't conform to the above you will have to mod-
                                        ;	ify Supermon 816 to accommodate the differences.  The most likely needed
                                        ;	changes will be in the order in which registers are pushed to the stack.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    397 = 0000000000003FFF                            hwstack  =$3fff                ;top of hardware stack...
                                        ;
                                        ;	Supermon 816 initializes the stack pointer to this address when the cold
                                        ;	start at MONCOLD is called to enter the monitor.  The stack pointer will
                                        ;	be undisturbed when entry into Supermon 816 is through JMONBRK (see jump
                                        ;	table definitions).
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    406 = 0000000000000080                            zeropage =$80                  ;Supermon 816's direct page...
                                        ;
                                        ;	Supermon 816 uses direct page starting at this address.  Be sure that no
                                        ;	conflict occurs with other software.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    412 = 00000000000000FC                            biosctx	 =$FC
                                        ;	————————————————————————————————————————————————————————————————————————
    414 = 000000000000FE00                            getcha   =$FE00                ;get keystroke from console...
                                        ;
                                        ;	GETCHA refers to an operating system API call that returns a keystroke
                                        ;	in the 8 bit accumulator.  Supermon 816  assumes that GETCHA is a non-
                                        ;	blocking subroutine & returns with carry clear to indicate that a key-
                                        ;	stroke is in .A, or with carry set to indicate that no keystroke was
                                        ;	available.  GETCHA will be called with a JSR instruction.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from GETCHA.
                                        ;	You may have to modify Supermon 816 at all calls to GETCHA if your "get
                                        ;	keystroke" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    428 = 000000000000FE06                            putcha   =$FE06                ;print character on console...
                                        ;
                                        ;	PUTCHA refers to an operating system API call that prints a character to
                                        ;	the console screen.  The character to be printed will be in .A, which
                                        ;	will be set to 8-bit width.  Supermon 816 assumes that PUTCHA will block
                                        ;	until the character can be processed.  PUTCHA will be called with a JSR
                                        ;	instructions.
                                        ;
                                        ;	Supermon 816 expects .X & .Y to be preserved upon return from PUTCHA.
                                        ;	You may have to modify Supermon 816 at all calls to PUTCHA if your "put
                                        ;	character" routine works differently than described.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
    442 = 0000000000000003                            stopkey  =$03                  ;display abort key...
                                        ;
                                        ;	Supermon 816 will poll for a "stop key" during display operations, such
                                        ;	as code disassembly & memory dumps, so as to abort further processing &
                                        ;	return to the command prompt.  STOPKEY must be defined with the ASCII
                                        ;	value that the "stop key" will emit when typed.  The polling is via a
                                        ;	call to GETCHA (described above).  The default STOPKEY definition of $03
                                        ;	is for ASCII <ETX> or [Ctrl-C].
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
    452 = 0000000000000200                            ibuffer  =$000200               ;input buffer &...
    453 = 00000251                      auxbuf   =ibuffer+s_ibuf+1 ;auxiliary buffer...
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	Supermon 816 will use the above definitions for input buffers.  These
                                        ;	buffers may be located anywhere in RAM that is convenient.  The buffers
                                        ;	are stateless, which means that unless Supermon 816 has control of your
                                        ;	system, they may be overwritten without consequence.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S INSTRUCTION SYNTHESIS MACROS —— !!!!! DO NOT EDIT !!!!!
                                        ;
                                        _asm24_  .macro .ad
                                                 .byte <.ad,>.ad,.ad >> 16
                                                 .endm
                                        ;
                                        brl      .macro .ad
                                        .ba      =*+3
                                                 .byte $82
                                                 .word .ad-.ba
                                                 .endm
                                        ;
                                        ; jml is supported for the RTF65002 in 65c02 mode. And the opcode is supported
                                        ; by the assembler.
                                        ;jml      .macro .ad
                                        ; ;        .byte $5c
                                        ;         _asm24_ .ad
                                        ;         .endm
                                        ;
                                        mvn      .macro .s,.d
                                                 .byte $54,.d,.s
                                                 .endm
                                        ;
                                        mvp      .macro .s,.d
                                                 .byte $44,.d,.s
                                                 .endm
                                        ;
                                        pea      .macro .op
                                                 .byte $f4
                                                 .word .op
                                                 .endm
                                        ;
                                        phb      .macro
                                                 .byte $8b
                                                 .endm
                                        ;
                                        phk      .macro
                                                 .byte $4b
                                                 .endm
                                        ;
                                        plb      .macro
                                                 .byte $ab
                                                 .endm
                                        ;
                                        rep      .macro .op
                                                 .byte $c2,.op
                                                 .endm
                                        ;
                                        sep      .macro .op
                                                 .byte $e2,.op
                                                 .endm
                                        ;
                                        tcd      .macro
                                                 .byte $5b
                                                 .endm
                                        ;
                                        tcs      .macro
                                                 .byte $1b
                                                 .endm
                                        ;
                                        tdc      .macro
                                                 .byte $7b
                                                 .endm
                                        ;
                                        tsc      .macro
                                                 .byte $3b
                                                 .endm
                                        ;
                                        txy      .macro
                                                 .byte $9b
                                                 .endm
                                        ;
                                        tyx      .macro
                                                 .byte $bb
                                                 .endm
                                        ;
                                        wai      .macro
                                                 .byte $cb
                                                 .endm
                                        ;
                                        xba      .macro
                                                 .byte $eb
                                                 .endm
                                        ;
                                        adcw     .macro .op
                                                 adc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        andw     .macro .op
                                                 and #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        bitw     .macro .op
                                                 bit #<.op
                                                 .byte >.op
                                                 .endm
                                        ;         
                                        cmpw     .macro .op
                                                 cmp #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpxw     .macro .op
                                                 cpx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        cpyw     .macro .op
                                                 cpy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        eorw     .macro .op
                                                 eor #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldaw     .macro .op
                                                 lda #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldxw     .macro .op
                                                 ldx #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldyw     .macro .op
                                                 ldy #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        oraw     .macro .op
                                                 ora #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        sbcw     .macro .op
                                                 sbc #<.op
                                                 .byte >.op
                                                 .endm
                                        ;
                                        ldalx    .macro .ad
                                                 .byte $+         .byte a_esc,"("
                                     +            .byte a_esc,"G4"
                                        
                                     +            .byte <.ad,>.ad,.ad >> 16
                                        
                                                 .endm
                                        ;
                                        adcil    .macro .ad
                                                 .byte $67,.ad
                                                 .endm
                                        ;
                                        adcily   .macro .ad
                                                 .byte $77,.ad
                                                 .endm
                                        ;
                                        andil    .macro .ad
                                                 .byte $27,.ad
                                                 .endm
                                        ;
                                        andily   .macro .ad
                                                 .byte $37,.ad
                                                 .endm
                                        ;
                                        cmpil    .macro .ad
                                                 .byte $c7,.ad
                                                 .endm
                                        ;
                                        cmpily   .macro .ad
                                                 .byte $d7,.ad
                                                 .endm
                                        ;
                                        eoril    .macro .ad
                                                 .byte $47,.ad
                                                 .endm
                                        ;
                                        eorily   .macro .ad
                                                 .byte $57,.ad
                                                 .endm
                                        ;
                                        ldail    .macro .ad
                                                 .byte $a7,.ad
                                                 .endm
                                        ;
                                        ldaily   .macro .ad
                                                 .byte $b7,.ad
                                                 .endm
                                        ;
                                        orail    .macro .ad
                                                 .byte $07,.ad
                                                 .endm
                                        ;
                                        oraily   .macro .ad
                                                 .byte $17,.ad
                                                 .endm
                                        ;
                                        sbcil    .macro .ad
                                                 .byte $e7,.ad
                                                 .endm
                                        ;
                                        sbcily   .macro .ad
                                                 .byte $f7,.ad
                                                 .endm
                                        ;
                                        stail    .macro .ad
                                                 .byte $87,.ad
                                                 .endm
                                        ;
                                        staily   .macro .ad
                                                 .byte $97,.ad
                                                 .endm
                                        ;
                                        adcs     .macro .of
                                                 .byte $63,.of
                                                 .endm
                                        ;
                                        adcsi    .macro .of
                                                 .byte $73,.of
                                                 .endm
                                        ;
                                        ands     .macro .of
                                                 .byte $23,.of
                                                 .endm
                                        ;
                                        andsi    .macro .of
                                                 .byte $33,.of
                                                 .endm
                                        ;
                                        cmps     .macro .of
                                                 .byte $c3,.of
                                                 .endm
                                        ;
                                        cmpsi    .macro .of
                                                 .byte $d3,.of
                                                 .endm
                                        ;
                                        eors     .macro .of
                                                 .byte $43,.of
                                                 .endm
                                        ;
                                        eorsi    .macro .of
                                                 .byte $53,.of
                                                 .endm
                                        ;
                                        ldas     .macro .of
                                                 .byte $a3,.of
                                                 .endm
                                        ;
                                        ldasi    .macro .of
                                                 .byte $b3,.of
                                                 .endm
                                        ;
                                        oras     .macro .of
                                                 .byte $03,.of
                                                 .endm
                                        ;
                                        orasi    .macro .of
                                                 .byte $13,.of
                                                 .endm
                                        ;
                                        sbcs     .macro .of
                                                 .byte $e3,.of
                                                 .endm
                                        ;
                                        sbcsi    .macro .of
                                                 .byte $f3,.of
                                                 .endm
                                        ;
                                        stas     .macro .of
                                                 .byte $83,.of
                                                 .endm
                                        ;
                                        stasi    .macro .of
                                                 .byte $93,.of
                                                 .endm
                                        ;
                                        longa    .macro
                                                 .byte $c2,$20
                                                 .endm
                                        ;
                                        longr    .macro
                                                 .byte $c2,$30
                                                 .endm
                                        ;
                                        longx    .macro
                                                 .byte $c2,$10
                                                 .endm
                                        ;
                                        shorta   .macro
                                                 .byte $e2,$20
                                                 .endm
                                        ;
                                        shorti   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        shortr   .macro
                                                 .byte $e2,$30
                                                 .endm
                                        ;
                                        shortx   .macro
                                                 .byte $e2,$10
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL MACROS
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The following macros execute terminal  control procedures  that  perform
                                        ;	such tasks as clearing the screen,  switching  between  normal & reverse
                                        ;	video, etc.  These macros are for WYSE 60 & compatible displays, such as
                                        ;	the WYSE 150, WYSE 160, WYSE 325 & WYSE GPT.   Only the functions needed
                                        ;	by Supermon 816 are included.
                                        ;
                                        ;	If your console is not WYSE 60 compatible, you will need to  edit  these
                                        ;	macros as required to control your particular console or terminal.  Note
                                        ;	that in some cases one macro may call another.  Exercise caution in your
                                        ;	edits to avoid introducing display bugs.
                                        ;
                                        ;	If your console display cannot execute one of these procedures,  such as
                                        ;	'CL' (clear to end of line), you will have to develop an alternative.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	clearing data...
                                        ;
                                        bs       .macro                ;destructive backspace
                                                 .byte a_bs
                                     +            .byte a_esc,"W"
                                        
                                                 .endm
                                        ;
                                        cl       .macro                ;clear to end of line 
                                                 .byte a_esc,"T"
                                                 .endm
                                        ;
                                        ;
                                        ;	cursor control...
                                        ;
                                        cn       .macro                ;cursor on
                                                 .byte a_esc,"`1"
                                                 .endm
                                        ;
                                        co       .macro                ;cursor off
                                                 .byte a_esc,"`0"
                                                 .endm
                                        ;
                                        cr       .macro                ;carriage return
                                                 .byte a_cr
                                                 .endm
                                        ;
                                        lf       .macro                ;carriage return/line feed
                                     +            .byte a_cr
                                        
                                                 .byte a_lf
                                                 .endm
                                        ;
                                        ;
                                        ;	display attributes...
                                        ;
                                        bf       .macro                ;reverse foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G4"
                                                 .endm
                                        ;
                                        er       .macro                ;enable normal foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        sf       .macro                ;set foreground
                                                 .byte a_esc,"("
                                                 .byte a_esc,"G0"
                                                 .endm
                                        ;
                                        ;
                                        ;	display editing...
                                        ;
                                        dcuc     .macro                ;delete char under cursor
                                                 .byte a_esc,"W"
                                                 .endm
                                        ;
                                        ;
                                        ;	miscellaneous control...
                                        ;
                                        rb       .macro                ;ring "bell"
                                                 .byte a_bel
                                                 .endm
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASCII CONTROL DEFINITIONS (menmonic order)
                                        ;
    862 = 0000000000000007                            a_bel    =$07                  ;<BEL> alert/ring bell
    863 = 0000000000000008                            a_bs     =$08                  ;<BS>  backspace
    864 = 000000000000000D                            a_cr     =$0d                  ;<CR>  carriage return
    865 = 000000000000007F                            a_del    =$7f                  ;<DEL> delete
    866 = 000000000000001B                            a_esc    =$1b                  ;<ESC> escape
    867 = 0000000000000009                            a_ht     =$09                  ;<HT>  horizontal tabulation
    868 = 000000000000000A                            a_lf     =$0a                  ;<LF>  linefeed
                                        ;
                                        ;
                                        ;	miscellaneous (description order)...
                                        ;
    873 = 20                            a_blank  =' '                  ;blank (whitespace)
    874 = 7A                            a_asclch ='z'                  ;end of lowercase ASCII
    875 = 000000000000005F                            a_lctouc =$5f                  ;LC to UC conversion mask
    876 = 61                            a_asclcl ='a'                  ;start of lowercase ASCII
                                        ;
                                        ;================================================================================
                                        ;
                                        ;GLOBAL ATOMIC CONSTANTS
                                        ;
                                        ;
                                        ;	data type sizes...
                                        ;
    885 = 0000000000000001                            s_byte   =1                    ;byte
    886 = 0000000000000002                            s_word   =2                    ;word (16 bits)
    887 = 0000000000000003                            s_xword  =3                    ;extended word (24 bits)
    888 = 0000000000000004                            s_dword  =4                    ;double word (32 bits)
    889 = 0000000000000100                            s_rampag =$0100                ;65xx RAM page
                                        ;
                                        ;
                                        ;	data type sizes in bits...
                                        ;
    894 = 0000000000000008                            s_bibyte =8                    ;byte
    895 = 0000000000000004                            s_bnybbl =4                    ;nybble
                                        ;
                                        ;
                                        ;	miscellaneous...
                                        ;
    900 = 000000000000002C                            bitabs   =$2c                  ;absolute BIT opcode
    901 = 0000000000000024                            bitzp    =$24                  ;zero page BIT opcode
                                        ;
                                        ;================================================================================
                                        ;
                                        ;W65C816S NATIVE MODE STATUS REGISTER DEFINITIONS
                                        ;
    907 = 00000001                      s_mpudbx =s_byte               ;data bank size
    908 = 00000002                      s_mpudpx =s_word               ;direct page size
    909 = 00000001                      s_mpupbx =s_byte               ;program bank size
    910 = 00000002                      s_mpupcx =s_word               ;program counter size
    911 = 00000002                      s_mpuspx =s_word               ;stack pointer size
    912 = 00000001                      s_mpusrx =s_byte               ;status size
                                        ;
                                        ;
                                        ;	status register flags...
                                        ;
    917 = 0000000000000001                            sr_car   =%00000001            ;C
    918 = 00000002                      sr_zer   =sr_car << 1          ;Z
    919 = 00000004                      sr_irq   =sr_zer << 1          ;I
    920 = 00000008                      sr_bdm   =sr_irq << 1          ;D
    921 = 00000010                      sr_ixw   =sr_bdm << 1          ;x
    922 = 00000020                      sr_amw   =sr_ixw << 1          ;m
    923 = 00000040                      sr_ovl   =sr_amw << 1          ;V
    924 = 00000080                      sr_neg   =sr_ovl << 1          ;N
    925 = 00000100                      sr_16	 =sr_neg << 1
    926 = 00000200                      sr_32    =sr_16 << 1
                                        ;
                                        ;	NVmxDIZC
                                        ;	xxxxxxxx
                                        ;	||||||||
                                        ;	|||||||+———> 1 = carry set/generated
                                        ;	||||||+————> 1 = result = zero
                                        ;	|||||+—————> 1 = IRQs ignored
                                        ;	||||+——————> 0 = binary arithmetic mode
                                        ;	||||         1 = decimal arithmetic mode
                                        ;	|||+———————> 0 = 16 bit index
                                        ;	|||          1 = 8 bit index
                                        ;	||+————————> 0 = 16 bit .A & memory
                                        ;	||           1 = 8 bit .A & memory
                                        ;	|+—————————> 1 = sign overflow
                                        ;	+——————————> 1 = result = negative
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"SIZE-OF" CONSTANTS
                                        ;
    947 = 00000003                      s_addr   =s_xword              ;24 bit address
    948 = 0000000000000020                            s_auxbuf =32                   ;auxiliary buffer
    949 = 0000000000000050                            s_ibuf   =80                   ;input buffer
    950 = 0000000000000003                            s_mnemon =3                    ;MPU ASCII mnemonic
    951 = 0000000000000002                            s_mnepck =2                    ;MPU encoded mnemonic
    952 = 0000000000000003                            s_mvinst =3                    ;MVN/MVP instruction
    953 = 00000001                      s_opcode =s_byte               ;MPU opcode
    954 = 00000003                      s_oper   =s_xword              ;operand
    955 = 00000004                      s_pfac   =s_dword              ;primary math accumulator
    956 = 00000006                      s_sfac   =s_dword+s_word       ;secondary math accumulators
                                        ;
                                        ;================================================================================
                                        ;
                                        ;"NUMBER-OF" CONSTANTS
                                        ;
    962 = 0000000000000015                            n_dbytes =21                   ;default disassembly bytes
    963 = 0000000000000008                            n_dump   =8                    ;bytes per memory dump line
    964 = 000000FF                      n_mbytes =s_rampag-1           ;default memory dump bytes
    965 = 0000000000000008                            n_hccols =8                    ;compare/hunt display columns
    966 = 00000009                      n_opcols =3*s_oper             ;disassembly operand columns
    967 = 0000000000000004                            n_opslsr =4                    ;LSRs to extract instruction size
    968 = 0000000000000005                            n_shfenc =5                    ;shifts to encode/decode mnemonic
                                        ;
                                        ;================================================================================
                                        ;
                                        ;NUMERIC CONVERSION CONSTANTS
                                        ;
    974 = 0000000000000006                            a_hexdec ='A'-'9'-2            ;hex to decimal difference
    975 = 25                            c_bin    ='%'                  ;binary prefix
    976 = 2B                            c_dec    ='+'                  ;decimal prefix
    977 = 24                            c_hex    ='$'                  ;hexadecimal prefix
    978 = 40                            c_oct    ='@'                  ;octal prefix
    979 = 66                            k_hex    ='f'                  ;hex ASCII conversion
    980 = 00000020                      m_bits   =s_pfac*s_bibyte      ;operand bit size
    981 = 00000030                      m_cbits  =s_sfac*s_bibyte      ;workspace bit size
    982 = 000000000000000F                            bcdumask =%00001111            ;isolate BCD units mask
    983 = 0000000000000030                            btoamask =%00110000            ;binary to ASCII mask
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER CONSTANTS
                                        ;
    989 = 3F                            a_mnecvt ='?'                  ;encoded mnemonic conversion base
    990 = 000000000000001F                            aimmaska =%00011111            ;.A immediate opcode test #1
    991 = 0000000000000009                            aimmaskb =%00001001            ;.A immediate opcode test #2
    992 = 41                            asmprfx  ='A'                  ;assemble code prefix
    993 = 0000000000000009                            ascprmct =9                    ;assembler prompt "size-of"
    994 = 2E                            disprfx  ='.'                  ;disassemble code prefix
    995 = 00000000000000C0                            flimmask =%11000000            ;force long immediate flag
    996 = 0000000000000054                            opc_mvn  =$54                  ;MVN opcode
    997 = 0000000000000044                            opc_mvp  =$44                  ;MVP opcode
    998 = 00000000000000C2                            opc_rep  =$c2                  ;REP opcode
    999 = 00000000000000E2                            opc_sep  =$e2                  ;SEP opcode
   1000 = 00000030                      pfmxmask =sr_amw | sr_ixw      ;MPU m & x flag bits mask
                                        ;
                                        ;
                                        ;	assembler prompt buffer offsets...
                                        ;
   1005 = 00000002                      apadrbkh =s_word               ;instruction address bank MSN
   1006 = 00000003                      apadrbkl =apadrbkh+s_byte      ;instruction address bank LSN
   1007 = 00000004                      apadrmbh =apadrbkl+s_byte      ;instruction address MSB MSN
   1008 = 00000005                      apadrmbl =apadrmbh+s_byte      ;instruction address MSB LSN
   1009 = 00000006                      apadrlbh =apadrmbl+s_byte      ;instruction address LSB MSN
   1010 = 00000007                      apadrlbl =apadrlbh+s_byte      ;instruction address LSB LSN
                                        ;
                                        ;
                                        ;	addressing mode preamble symbols...
                                        ;
   1015 = 21                            amp_flim ='!'                  ;force long immediate
   1016 = 23                            amp_imm  ='#'                  ;immediate
   1017 = 28                            amp_ind  ='('                  ;indirect
   1018 = 5B                            amp_indl ='['                  ;indirect long
                                        ;
                                        ;
                                        ;	addressing mode symbolic translation indices...
                                        ;
   1023 = 0000000000000000                            am_nam   =%0000                ;(0)  no symbol
   1024 = 0000000000000001                            am_imm   =%0001                ;(1)  #
   1025 = 0000000000000002                            am_adrx  =%0010                ;(2)  dp,X or addr,X
   1026 = 0000000000000003                            am_adry  =%0011                ;(3)  dp,Y or addr,Y
   1027 = 0000000000000004                            am_ind   =%0100                ;(4)  (dp) or (addr)
   1028 = 0000000000000005                            am_indl  =%0101                ;(5)  [dp] or [addr]
   1029 = 0000000000000006                            am_indly =%0110                ;(6)  [dp],Y
   1030 = 0000000000000007                            am_indx  =%0111                ;(7)  (dp,X) or (addr,X)
   1031 = 0000000000000008                            am_indy  =%1000                ;(8)  (dp),Y
   1032 = 0000000000000009                            am_stk   =%1001                ;(9)  offset,S
   1033 = 000000000000000A                            am_stky  =%1010                ;(10) (offset,S),Y
   1034 = 000000000000000B                            am_move  =%1011                ;(11) MVN/MVP sbnk,dbnk
                                        ;
                                        ;
                                        ;	operand size translation indices...
                                        ;
   1039 = 0000000000000000                            ops0     =%0000 << 4           ;no operand
   1040 = 0000000000000010                            ops1     =%0001 << 4           ;8 bit operand
   1041 = 0000000000000020                            ops2     =%0010 << 4           ;16 bit operand
   1042 = 0000000000000030                            ops3     =%0011 << 4           ;24 bit operand
   1043 = 0000000000000050                            bop1     =%0101 << 4           ;8 bit relative branch
   1044 = 0000000000000060                            bop2     =%0110 << 4           ;16 bit relative branch
   1045 = 0000000000000090                            vops     =%1001 << 4           ;8 or 16 bit operand
                                        ;
                                        ;
                                        ;	operand size & addressing mode extraction masks...
                                        ;
   1050 = 000000000000000F                            amodmask =%00001111            ;addressing mode index
   1051 = 0000000000000030                            opsmask  =%00110000            ;operand size
   1052 = 00000000000000C0                            vopsmask =%11000000            ;BOPx & VOPS flag bits
                                        ;
                                        ;
                                        ;	instruction mnemonic encoding...
                                        ;
   1057 = 0000000000002144                            mne_adc  =$2144                ;ADC
   1058 = 0000000000002BC4                            mne_and  =$2bc4                ;AND
   1059 = 0000000000006D04                            mne_asl  =$6d04                ;ASL
   1060 = 0000000000002106                            mne_bcc  =$2106                ;BCC
   1061 = 000000000000A106                            mne_bcs  =$a106                ;BCS
   1062 = 0000000000009186                            mne_beq  =$9186                ;BEQ
   1063 = 000000000000AA86                            mne_bit  =$aa86                ;BIT
   1064 = 0000000000005386                            mne_bmi  =$5386                ;BMI
   1065 = 00000000000033C6                            mne_bne  =$33c6                ;BNE
   1066 = 0000000000006C46                            mne_bpl  =$6c46                ;BPL
   1067 = 00000000000014C6                            mne_bra  =$14c6                ;BRA
   1068 = 00000000000064C6                            mne_brk  =$64c6                ;BRK
   1069 = 0000000000006CC6                            mne_brl  =$6cc6                ;BRL
   1070 = 00000000000025C6                            mne_bvc  =$25c6                ;BVC
   1071 = 000000000000A5C6                            mne_bvs  =$a5c6                ;BVS
   1072 = 0000000000002348                            mne_clc  =$2348                ;CLC
   1073 = 0000000000002B48                            mne_cld  =$2b48                ;CLD
   1074 = 0000000000005348                            mne_cli  =$5348                ;CLI
   1075 = 000000000000BB48                            mne_clv  =$bb48                ;CLV
   1076 = 0000000000008B88                            mne_cmp  =$8b88                ;CMP
   1077 = 0000000000008C08                            mne_cop  =$8c08                ;COP
   1078 = 000000000000CC48                            mne_cpx  =$cc48                ;CPX
   1079 = 000000000000D448                            mne_cpy  =$d448                ;CPY
   1080 = 000000000000218A                            mne_dec  =$218a                ;DEC
   1081 = 000000000000C98A                            mne_dex  =$c98a                ;DEX
   1082 = 000000000000D18A                            mne_dey  =$d18a                ;DEY
   1083 = 0000000000009C0C                            mne_eor  =$9c0c                ;EOR
   1084 = 00000000000023D4                            mne_inc  =$23d4                ;INC
   1085 = 000000000000CBD4                            mne_inx  =$cbd4                ;INX
   1086 = 000000000000D3D4                            mne_iny  =$d3d4                ;INY
   1087 = 0000000000006B96                            mne_jml  =$6b96                ;JML
   1088 = 0000000000008B96                            mne_jmp  =$8b96                ;JMP
   1089 = 0000000000006D16                            mne_jsl  =$6d16                ;JSL
   1090 = 0000000000009D16                            mne_jsr  =$9d16                ;JSR
   1091 = 000000000000115A                            mne_lda  =$115a                ;LDA
   1092 = 000000000000C95A                            mne_ldx  =$c95a                ;LDX
   1093 = 000000000000D15A                            mne_ldy  =$d15a                ;LDY
   1094 = 0000000000009D1A                            mne_lsr  =$9d1a                ;LSR
   1095 = 0000000000007DDC                            mne_mvn  =$7ddc                ;MVN
   1096 = 0000000000008DDC                            mne_mvp  =$8ddc                ;MVP
   1097 = 0000000000008C1E                            mne_nop  =$8c1e                ;NOP
   1098 = 00000000000014E0                            mne_ora  =$14e0                ;ORA
   1099 = 00000000000011A2                            mne_pea  =$11a2                ;PEA
   1100 = 00000000000051A2                            mne_pei  =$51a2                ;PEI
   1101 = 00000000000099A2                            mne_per  =$99a2                ;PER
   1102 = 0000000000001262                            mne_pha  =$1262                ;PHA
   1103 = 0000000000001A62                            mne_phb  =$1a62                ;PHB
   1104 = 0000000000002A62                            mne_phd  =$2a62                ;PHD
   1105 = 0000000000006262                            mne_phk  =$6262                ;PHK
   1106 = 0000000000008A62                            mne_php  =$8a62                ;PHP
   1107 = 000000000000CA62                            mne_phx  =$ca62                ;PHX
   1108 = 000000000000D262                            mne_phy  =$d262                ;PHY
   1109 = 0000000000001362                            mne_pla  =$1362                ;PLA
   1110 = 0000000000001B62                            mne_plb  =$1b62                ;PLB
   1111 = 0000000000002B62                            mne_pld  =$2b62                ;PLD
   1112 = 0000000000008B62                            mne_plp  =$8b62                ;PLP
   1113 = 000000000000CB62                            mne_plx  =$cb62                ;PLX
   1114 = 000000000000D362                            mne_ply  =$d362                ;PLY
   1115 = 00000000000089A6                            mne_rep  =$89a6                ;REP
   1116 = 0000000000006C26                            mne_rol  =$6c26                ;ROL
   1117 = 0000000000009C26                            mne_ror  =$9c26                ;ROR
   1118 = 0000000000005566                            mne_rti  =$5566                ;RTI
   1119 = 0000000000006D66                            mne_rtl  =$6d66                ;RTL
   1120 = 000000000000A566                            mne_rts  =$a566                ;RTS
   1121 = 00000000000020E8                            mne_sbc  =$20e8                ;SBC
   1122 = 00000000000021A8                            mne_sec  =$21a8                ;SEC
   1123 = 00000000000029A8                            mne_sed  =$29a8                ;SED
   1124 = 00000000000051A8                            mne_sei  =$51a8                ;SEI
   1125 = 00000000000089A8                            mne_sep  =$89a8                ;SEP
   1126 = 0000000000001568                            mne_sta  =$1568                ;STA
   1127 = 0000000000008D68                            mne_stp  =$8d68                ;STP
   1128 = 000000000000CD68                            mne_stx  =$cd68                ;STX
   1129 = 000000000000D568                            mne_sty  =$d568                ;STY
   1130 = 000000000000DD68                            mne_stz  =$dd68                ;STZ
   1131 = 000000000000C8AA                            mne_tax  =$c8aa                ;TAX
   1132 = 000000000000D0AA                            mne_tay  =$d0aa                ;TAY
   1133 = 000000000000292A                            mne_tcd  =$292a                ;TCD
   1134 = 000000000000A12A                            mne_tcs  =$a12a                ;TCS
   1135 = 000000000000216A                            mne_tdc  =$216a                ;TDC
   1136 = 0000000000001CEA                            mne_trb  =$1cea                ;TRB
   1137 = 0000000000001D2A                            mne_tsb  =$1d2a                ;TSB
   1138 = 000000000000252A                            mne_tsc  =$252a                ;TSC
   1139 = 000000000000CD2A                            mne_tsx  =$cd2a                ;TSX
   1140 = 000000000000166A                            mne_txa  =$166a                ;TXA
   1141 = 000000000000A66A                            mne_txs  =$a66a                ;TXS
   1142 = 000000000000D66A                            mne_txy  =$d66a                ;TXY
   1143 = 00000000000016AA                            mne_tya  =$16aa                ;TYA
   1144 = 000000000000CEAA                            mne_tyx  =$ceaa                ;TYX
   1145 = 00000000000050B0                            mne_wai  =$50b0                ;WAI
   1146 = 0000000000007170                            mne_wdm  =$7170                ;WDM
   1147 = 00000000000010F2                            mne_xba  =$10f2                ;XBA
   1148 = 0000000000003132                            mne_xce  =$3132                ;XCE
                                        ;
                                        ;
                                        ;	encoded instruction mnemonic indices...
                                        ;
   1153 = 0000000000000010                            mne_adcx =16                   ;ADC
   1154 = 000000000000001D                            mne_andx =29                   ;AND
   1155 = 000000000000002C                            mne_aslx =44                   ;ASL
   1156 = 000000000000000F                            mne_bccx =15                   ;BCC
   1157 = 0000000000000041                            mne_bcsx =65                   ;BCS
   1158 = 000000000000003B                            mne_beqx =59                   ;BEQ
   1159 = 0000000000000046                            mne_bitx =70                   ;BIT
   1160 = 0000000000000024                            mne_bmix =36                   ;BMI
   1161 = 000000000000001F                            mne_bnex =31                   ;BNE
   1162 = 000000000000002A                            mne_bplx =42                   ;BPL
   1163 = 0000000000000005                            mne_brax =5                    ;BRA
   1164 = 0000000000000027                            mne_brkx =39                   ;BRK
   1165 = 000000000000002B                            mne_brlx =43                   ;BRL
   1166 = 0000000000000017                            mne_bvcx =23                   ;BVC
   1167 = 0000000000000044                            mne_bvsx =68                   ;BVS
   1168 = 0000000000000014                            mne_clcx =20                   ;CLC
   1169 = 000000000000001B                            mne_cldx =27                   ;CLD
   1170 = 0000000000000023                            mne_clix =35                   ;CLI
   1171 = 0000000000000047                            mne_clvx =71                   ;CLV
   1172 = 0000000000000035                            mne_cmpx =53                   ;CMP
   1173 = 0000000000000037                            mne_copx =55                   ;COP
   1174 = 000000000000004E                            mne_cpxx =78                   ;CPX
   1175 = 0000000000000058                            mne_cpyx =88                   ;CPY
   1176 = 0000000000000012                            mne_decx =18                   ;DEC
   1177 = 000000000000004A                            mne_dexx =74                   ;DEX
   1178 = 0000000000000054                            mne_deyx =84                   ;DEY
   1179 = 000000000000003D                            mne_eorx =61                   ;EOR
   1180 = 0000000000000015                            mne_incx =21                   ;INC
   1181 = 000000000000004D                            mne_inxx =77                   ;INX
   1182 = 0000000000000057                            mne_inyx =87                   ;INY
   1183 = 0000000000000028                            mne_jmlx =40                   ;JML
   1184 = 0000000000000036                            mne_jmpx =54                   ;JMP
   1185 = 000000000000002D                            mne_jslx =45                   ;JSL
   1186 = 000000000000003F                            mne_jsrx =63                   ;JSR
   1187 = 0000000000000001                            mne_ldax =1                    ;LDA
   1188 = 0000000000000049                            mne_ldxx =73                   ;LDX
   1189 = 0000000000000053                            mne_ldyx =83                   ;LDY
   1190 = 0000000000000040                            mne_lsrx =64                   ;LSR
   1191 = 0000000000000030                            mne_mvnx =48                   ;MVN
   1192 = 000000000000003A                            mne_mvpx =58                   ;MVP
   1193 = 0000000000000038                            mne_nopx =56                   ;NOP
   1194 = 0000000000000006                            mne_orax =6                    ;ORA
   1195 = 0000000000000002                            mne_peax =2                    ;PEA
   1196 = 0000000000000021                            mne_peix =33                   ;PEI
   1197 = 000000000000003C                            mne_perx =60                   ;PER
   1198 = 0000000000000003                            mne_phax =3                    ;PHA
   1199 = 000000000000000A                            mne_phbx =10                   ;PHB
   1200 = 000000000000001A                            mne_phdx =26                   ;PHD
   1201 = 0000000000000026                            mne_phkx =38                   ;PHK
   1202 = 0000000000000033                            mne_phpx =51                   ;PHP
   1203 = 000000000000004B                            mne_phxx =75                   ;PHX
   1204 = 0000000000000055                            mne_phyx =85                   ;PHY
   1205 = 0000000000000004                            mne_plax =4                    ;PLA
   1206 = 000000000000000B                            mne_plbx =11                   ;PLB
   1207 = 000000000000001C                            mne_pldx =28                   ;PLD
   1208 = 0000000000000034                            mne_plpx =52                   ;PLP
   1209 = 000000000000004C                            mne_plxx =76                   ;PLX
   1210 = 0000000000000056                            mne_plyx =86                   ;PLY
   1211 = 0000000000000031                            mne_repx =49                   ;REP
   1212 = 0000000000000029                            mne_rolx =41                   ;ROL
   1213 = 000000000000003E                            mne_rorx =62                   ;ROR
   1214 = 0000000000000025                            mne_rtix =37                   ;RTI
   1215 = 000000000000002E                            mne_rtlx =46                   ;RTL
   1216 = 0000000000000043                            mne_rtsx =67                   ;RTS
   1217 = 000000000000000E                            mne_sbcx =14                   ;SBC
   1218 = 0000000000000013                            mne_secx =19                   ;SEC
   1219 = 0000000000000019                            mne_sedx =25                   ;SED
   1220 = 0000000000000022                            mne_seix =34                   ;SEI
   1221 = 0000000000000032                            mne_sepx =50                   ;SEP
   1222 = 0000000000000007                            mne_stax =7                    ;STA
   1223 = 0000000000000039                            mne_stpx =57                   ;STP
   1224 = 0000000000000050                            mne_stxx =80                   ;STX
   1225 = 0000000000000059                            mne_styx =89                   ;STY
   1226 = 000000000000005B                            mne_stzx =91                   ;STZ
   1227 = 0000000000000048                            mne_taxx =72                   ;TAX
   1228 = 0000000000000052                            mne_tayx =82                   ;TAY
   1229 = 0000000000000018                            mne_tcdx =24                   ;TCD
   1230 = 0000000000000042                            mne_tcsx =66                   ;TCS
   1231 = 0000000000000011                            mne_tdcx =17                   ;TDC
   1232 = 000000000000000C                            mne_trbx =12                   ;TRB
   1233 = 000000000000000D                            mne_tsbx =13                   ;TSB
   1234 = 0000000000000016                            mne_tscx =22                   ;TSC
   1235 = 000000000000004F                            mne_tsxx =79                   ;TSX
   1236 = 0000000000000008                            mne_txax =8                    ;TXA
   1237 = 0000000000000045                            mne_txsx =69                   ;TXS
   1238 = 000000000000005A                            mne_txyx =90                   ;TXY
   1239 = 0000000000000009                            mne_tyax =9                    ;TYA
   1240 = 0000000000000051                            mne_tyxx =81                   ;TYX
   1241 = 0000000000000020                            mne_waix =32                   ;WAI
   1242 = 000000000000002F                            mne_wdmx =47                   ;WDM
   1243 = 0000000000000000                            mne_xbax =0                    ;XBA
   1244 = 000000000000001E                            mne_xcex =30                   ;XCE
                                        ;
                                        ;================================================================================
                                        ;
                                        ;MISCELLANEOUS CONSTANTS
                                        ;
   1250 = 0000000000000004                            halftab  =4                    ;1/2 tabulation spacing
   1251 = 3E                            memprfx  ='>'                  ;memory dump prefix
   1252 = 3A                            memsepch =':'                  ;memory dump separator
   1253 = 2E                            memsubch ='.'                  ;memory dump non-print char
   1254 = 0000000000000030                            srinit   =%00110000            ;SR initialization value
                                        ;
                                        ;================================================================================
                                        ;
                                        ;DIRECT PAGE STORAGE
                                        ;
   1260 = 00000080                      reg_csx  =zeropage			;CS
   1261 = 00000084                      reg_dsx  =reg_csx + 4		;DS
   1262 = 00000088                      reg_pcx  =reg_dsx + 4	    ;PC
   1263 = 0000008A                      reg_pbx  =reg_pcx + 2       ;PB
   1264 = 0000008B                      reg_ax   =reg_pbx + 1       ;.C
   1265 = 0000008F                      reg_xx   =reg_ax + 4        ;.X
   1266 = 00000093                      reg_yx   =reg_xx + 4        ;.Y
   1267 = 00000097                      reg_spx  =reg_yx + 4        ;SP
   1268 = 0000009B                      reg_srx  =reg_spx + 4       ;SR
   1269 = 0000009C                      reg_srxx =reg_srx + 1       ;SRX
   1270 = 0000009D                      reg_dbx  =reg_srxx + 1      ;DB
   1271 = 0000009E                      reg_dpx  =reg_dbx + 1       ;DP
                                        ;
                                        ;
                                        ;	general workspace...
                                        ;
   1276 = 000000A2                      addra    =reg_dpx+4            ;address #1
   1277 = 000000A6                      addrb    =addra+4              ;address #2
   1278 = 000000A9                      faca     =addrb+s_addr         ;primary accumulator
   1279 = 000000AD                      facax    =faca+s_pfac          ;extended primary accumulator
   1280 = 000000B1                      facb     =facax+s_pfac         ;secondary accumulator
   1281 = 000000B7                      facc     =facb+s_sfac          ;tertiary accumulator
   1282 = 000000BD                      operand  =facc+s_sfac          ;instruction operand
   1283 = 000000C0                      auxbufix =operand+s_oper       ;auxiliary buffer index
   1284 = 000000C1                      ibufidx  =auxbufix+s_byte      ;input buffer index
   1285 = 000000C2                      bitsdig  =ibufidx+s_byte       ;bits per numeral
   1286 = 000000C3                      numeral  =bitsdig+s_byte       ;numeral buffer
   1287 = 000000C4                      radix    =numeral+s_byte       ;radix index
   1288 = 000000C5                      admodidx =radix+s_byte         ;addressing mode index
   1289 = 000000C6                      charcnt  =admodidx+s_byte      ;character counter
   1290 = 000000C8                      instsize =charcnt+s_word       ;instruction size
   1291 = 000000CA                      mnepck   =instsize+s_word      ;encoded mnemonic
   1292 = 000000CC                      opcode   =mnepck+s_mnepck      ;current opcode
   1293 = 000000CD                      status   =opcode+s_byte        ;I/O status flag
   1294 = 000000CE                      xrtemp   =status+s_byte        ;temp .X storage
   1295 = 000000CF                      eopsize  =xrtemp+s_byte        ;entered operand size
   1296 = 000000D0                      flimflag =eopsize+s_byte       ;forced long immediate...
                                        ;
                                        ;	xx000000
                                        ;	||
                                        ;	|+—————————> 0: .X/.Y = 8 bits
                                        ;	|            1: .X/.Y = 18 bits
                                        ;	+——————————> 0: .A = 8 bits
                                        ;	             1: .A = 16 bits
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	During assembly, FLIMFLAG indicates the operand size used with an immed-
                                        ;	iate mode instruction, thus causing the following disassembly to display
                                        ;	the assembled  operand size.   During disassembly,  FLIMFLAG will mirror
                                        ;	the effect of the most recent REP or SEP instruction.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1312 = 000000D1                      iopsize  =flimflag+s_byte      ;operand size
   1313 = 000000D2                      range    =iopsize+s_byte       ;allowable radix range
   1314 = 000000D3                      vopsflag =range+s_byte         ;VOPS & ROPS mode bits
                                        ;
                                        ;
                                        ;	copy/fill workspace (overlaps some of the above)...
                                        ;
   1319 = 000000D4                      mcftwork =vopsflag+s_byte	;faca                 ;start of copy/fill code
   1320 = 000000D5                      mcftopc  =mcftwork+s_byte      ;instruction opcode
   1321 = 000000D6                      mcftbnk  =mcftopc+s_byte       ;banks
                                        ;
                                        ;================================================================================
                                        ;
                                        ;SUPERMON 816 JUMP TABLE
                                        ;
                                                 org	_origin_
                                        ;
                                           		 CPU	W65C816S
                                           		 MEM	16
                                           		 NDX	16
   1333 00C000 A9 D0 00                     		 LDA	#$D0
   1334 00C003 8D 00 70                     		 STA	$7000
                                           		 MEM	8
                                           		 NDX	8
                                        		 CPU	W65C02
   1338 C006 80 02                      JMON     bra mon               ;cold start entry
   1339 C008 80 4F                      JMONBRK  bra monbrk            ;software interrupt intercept
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mon: SUPERMON 816 COLD START
                                        ;
   1345 C00A C2 20                      mon +         .byte $c2,$20
                                        
   1346 C00C AD 02 01                             lda vecbrki           ;BRK vector
   1347 C00F C9 59                    +            cmp #<monbrk
   1347 C011 C0                       +            .byte >monbrk
                                        ;pointing at monitor?
   1348 C012 D0 03                                bne .2            ;yes, ignore cold start
   1349 C014 4C A4 C0                             jmp	monreg			; got a branch out of range here when debugging code
                                        								; was included
   1351 C017                            .2
                                        ;
   1353 C017 8D 05 01                             sta vecbrkia          ;save vector for exit
   1354 C01A A9 AB                       		 LDA	#$AB
   1355 C01C 00                          		 .byte	$00
   1356 C01D 8D 00 70                    		 STA	$7000
   1357 C020 A9 59                    +            lda #<monbrk
   1357 C022 C0                       +            .byte >monbrk
                                        ;Supermon 816 intercepts...
   1358 C023 8D 02 01                             sta vecbrki           ;BRK handler
   1359 C026 E2 30                    +            .byte $e2,$30
                                                        ;8 bit registers
   1360 C028 A2 49                                ldx #vopsflag-reg_pbx
                                        ;
   1362 C02A 74 8A                      .0000010 stz reg_pbx,x         ;clear DP storage
   1363 C02C CA                                   dex
   1364 C02D 10 FB                                bpl .0000010
                                        ;
   1366 C02F A9 AC                       		 LDA	#$AC
   1367 C031 8D 00 70                    		 STA	$7000
   1368 C034 A9 30                                lda #srinit
   1369 C036 85 9B                                sta reg_srx           ;status register
   1370 C038 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   1371 C03A A9 FF                    +            lda #<hwstack
   1371 C03C 3F                       +            .byte >hwstack
                                        ;top of hardware stack
   1372 C03D 1B                       +            .byte $1b
                                                           ;set SP
   1373 C03E 7B                       +            .byte $7b
                                                           ;get & save...
   1374 C03F 85 9E                                sta reg_dpx           ;DP register
   1375 C041 A9 AD                       		 LDA	#$AD
   1376 C043 00                          		 .byte	$00
   1377 C044 8D 00 70                    		 STA	$7000
   1378 C047 A9 00                    +            lda #<0
   1378 C049 00                       +            .byte >0
                                        
   1379 C04A E2 20                    +            .byte $e2,$20
                                        
   1380 C04C 4B                       +            .byte $4b
                                        
   1381 C04D 68                                   pla                   ;capture PB &...
   1382 C04E 85 8A                                sta reg_pbx           ;set
   1383 C050 8B                       +            .byte $8b
                                        
   1384 C051 68                                   pla                   ;capture DB &...
   1385 C052 85 9D                                sta reg_dbx           ;set
   1386 C054 F4                       +            .byte $f4
   1386 C055 4D D0                    +            .word mm_entry
                                        ;"...ready..."
   1387 C057 80 2E                                bra moncom
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monbrk: SOFTWARE INTERRUPT INTERCEPT
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This is the entry point taken when a BRK instruction is executed.  It is
                                        ;	assumed that the BRK  handler has pushed the registers to the stack that
                                        ;	are not automatically pushed by the MPU in response to BRK.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1399 C059 58                         monbrk   cli                   ;reenable IRQs
   1400 C05A                            		 phcs
   1401 C05A 68                          		 pla
   1402 C05B 85 80                       		 sta reg_csx
   1403 C05D 68                          		 pla
   1404 C05E 85 82                       		 sta reg_csx+2
   1405 C060                            		 phds
   1406 C060 68                          		 pla
   1407 C061 85 84                       		 sta reg_dsx
   1408 C063 68                          		 pla
   1409 C064 85 86                       		 sta reg_dsx+2
   1410 C066 7A                                   ply                   ;recover registers
   1411 C067 FA                                   plx
   1412 C068 68                                   pla
   1413 C069 C2 30                    +            .byte $c2,$30
                                                         ;store 16 bit registers
   1414 C06B 85 8B                                sta reg_ax            ;.A
   1415 C06D 86 8F                                stx reg_xx            ;.X
   1416 C06F 84 93                                sty reg_yx            ;.Y
   1417 C071 E2 10                    +            .byte $e2,$10
                                                        ;8 bit index registers
   1418 C073 68                                   pla                   ;get DP &...
   1419 C074 85 9E                                sta reg_dpx           ;store
   1420 C076 FA                                   plx                   ;get DB &...
   1421 C077 86 9D                                stx reg_dbx           ;store
   1422 C079 FA                                   plx                   ;get SR &...
   1423 C07A 86 9B                                stx reg_srx           ;store
   1424 C07C 68                                   pla                   ;get PC &...
   1425 C07D 85 88                                sta reg_pcx           ;store
   1426 C07F E2 20                    +            .byte $e2,$20
                                        
   1427 C081 68                                   pla                   ;get PB &...
   1428 C082 85 8A                                sta reg_pbx           ;store
   1429 C084 F4                       +            .byte $f4
   1429 C085 42 D0                    +            .word mm_brk
                                        ;"*BRK"
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncom: COMMON ENTRY POINT
                                        ;
                                        ;	——————————————————————————————————————
                                        ;	DO NOT directly call this entry point!
                                        ;	——————————————————————————————————————
                                        ;
   1439 C087                            moncom   
   1440 C087 A9 AE                       		 LDA	#$AE
   1441 C089 8D 00 70                    		 STA	$7000
   1442 C08C 20 3B C8                    		 jsr sprint            ;print heading
   1443 C08F A9 AF                       		 LDA	#$AF
   1444 C091 8D 00 70                    		 STA	$7000
   1445 C094 C2 20                    +            .byte $c2,$20
                                        
   1446 C096 3B                       +            .byte $3b
                                                           ;get SP &...
   1447 C097 85 97                                sta reg_spx           ;store
   1448 C099 A9 B0                       		 LDA	#$B0
   1449 C09B 00                          		 .byte	$00
   1450 C09C 8D 00 70                    		 STA	$7000
   1451 C09F C2 FF                    +            .byte $c2,%11111111
                                        ;clear SR &...
   1452 C0A1 E2 30                    +            .byte $e2,srinit
                                        ;set default state
   1453 C0A3 38                                   sec                   ;see next
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monreg: DISPLAY MPU REGISTERS
                                        ;
                                        ;	—————————
                                        ;	syntax: R
                                        ;	—————————
                                        ;
   1463 C0A4 B0 03                      monreg   bcs .0000010          ;okay to proceed
                                        ;
   1465 C0A6 4C 8E C1                             jmp monerr            ;error if called with a parm
                                        ;
   1467 C0A9 F4                         .0000010 +         .byte $f4
   1467 C0AA 78 D0                    +            .word mm_regs
                                        
   1468 C0AC 20 3B C8                             jsr sprint            ;display heading
                                        ;
                                        ;
                                        ;	display program bank & counter...
                                        ;
   1473 C0AF C2 20                    +            .byte $c2,$20
                                        
   1474 C0B1 A5 82                       		 lda	reg_csx+2
   1475 C0B3 E2 20                    +            .byte $e2,$20
                                        
   1476 C0B5 20 F5 C7                    		 jsr	dpyhexw
   1477 C0B8 C2 20                    +            .byte $c2,$20
                                        
   1478 C0BA A5 80                       		 lda	reg_csx
   1479 C0BC E2 20                    +            .byte $e2,$20
                                        
   1480 C0BE 20 F5 C7                    		 jsr    dpyhexw
   1481 C0C1 E2 20                    +            .byte $e2,$20
                                        
   1482 C0C3 20 33 C8                             jsr printspc          ;inter-field space
   1483 C0C6 A5 8A                                lda reg_pbx           ;PB
   1484 C0C8 20 05 C8                             jsr dpyhex            ;display as hex ASCII
   1485 C0CB 20 33 C8                             jsr printspc          ;inter-field space
   1486 C0CE C2 20                    +            .byte $c2,$20
                                        
   1487 C0D0 A5 88                                lda reg_pcx
   1488 C0D2 E2 20                    +            .byte $e2,$20
                                        
   1489 C0D4 20 F5 C7                             jsr dpyhexw           ;display PC
   1490 C0D7 A2 02                                ldx #2
   1491 C0D9 20 14 C8                             jsr multspc           ;inter-field spacing
                                        ;
                                        ;
                                        ;	display SR in bitwise fashion...
                                        ;
   1496 C0DC A5 9C                       		 lda reg_srxx
   1497 C0DE 4A                          		 lsr
   1498 C0DF 4A                          		 lsr
   1499 C0E0 69 30                       		 adc #'0'
                                           		 cpu FT832
   1501 00C0E2 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1503 C0E7 A5 9C                       		 lda reg_srxx
   1504 C0E9 4A                          		 lsr
   1505 C0EA 69 30                       		 adc #'0'
                                           		 cpu FT832
   1507 00C0EC 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        
   1510 C0F1 A6 9B                                ldx reg_srx           ;SR
   1511 C0F3 A0 08                                ldy #s_bibyte         ;bits in a byte
                                        ;
   1513 C0F5 8A                         .0000020 txa                   ;remaining SR bits
   1514 C0F6 0A                                   asl                   ;grab one of them
   1515 C0F7 AA                                   tax                   ;save remainder
   1516 C0F8 A9 30                                lda #'0'              ;a clear bit but...
   1517 C0FA 69 00                                adc #0                ;adjust if set &...
                                           		 cpu FT832
   1519 00C0FC 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1521 C101 88                                   dey                   ;bit processed
   1522 C102 D0 F1                                bne .0000020          ;do another
                                        ;
                                        ;
                                        ;	display .C, .X, .Y, SP & DP...
                                        ;
   1527 C104 20 33 C8                   .0000030 jsr printspc          ;spacing
   1528 C107 C2 20                    +            .byte $c2,$20
                                        
   1529 C109 B9 8D 00                             lda reg_ax+2,y        ;get register value
   1530 C10C E2 20                    +            .byte $e2,$20
                                        
   1531 C10E 20 F5 C7                             jsr dpyhexw           ;convert & display
   1532 C111 C2 20                    +            .byte $c2,$20
                                        
   1533 C113 B9 8B 00                             lda reg_ax,y          ;get register value
   1534 C116 E2 20                    +            .byte $e2,$20
                                        
   1535 C118 20 F5 C7                             jsr dpyhexw           ;convert & display
                                        ;         .rept s_word
   1537 C11B C8                                     iny
   1538 C11C C8                                     iny
                                        ;         .endr
                                        ;         .rept s_word
   1541 C11D C8                                     iny
   1542 C11E C8                                     iny
                                        ;         .endr
   1544 C11F C0 0F                                cpy #reg_spx-reg_ax+3
   1545 C121 90 E1                                bcc .0000030          ;next
                                        ;
                                        ;
                                        ;	display DS DB...
                                        ;
   1550 C123 F4                       +            .byte $f4
   1550 C124 D8 D0                    +            .word mm_regs2
                                        
   1551 C126 20 3B C8                    		 jsr sprint
   1552 C129 C2 20                    +            .byte $c2,$20
                                        
   1553 C12B A5 86                                lda reg_dsx+2         ;get DS &...
   1554 C12D E2 20                    +            .byte $e2,$20
                                        
   1555 C12F 20 F5 C7                             jsr dpyhexw           ;convert & display
   1556 C132 C2 20                    +            .byte $c2,$20
                                        
   1557 C134 A5 84                                lda reg_dsx           ;get DS &...
   1558 C136 E2 20                    +            .byte $e2,$20
                                        
   1559 C138 20 F5 C7                             jsr dpyhexw           ;convert & display
   1560 C13B 20 33 C8                             jsr printspc          ;more spacing
   1561 C13E A5 9D                                lda reg_dbx           ;get DB &...
   1562 C140 20 05 C8                             jsr dpyhex            ;display it
   1563 C143 20 33 C8                             jsr printspc          ;more spacing
   1564 C146 C2 20                    +            .byte $c2,$20
                                        
   1565 C148 A5 9E                                lda reg_dpx           ;get DPR &...
   1566 C14A E2 20                    +            .byte $e2,$20
                                        
   1567 C14C 20 F5 C7                             jsr dpyhexw           ;convert & display
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monce: COMMAND EXECUTIVE
                                        ;	
   1573 C14F E2 20                      monce +         .byte $e2,$20
                                        
   1574 C151 A9 00                                lda #0                ;default buffer index
                                        ;
   1576 C153 E2 30                      moncea +         .byte $e2,$30
                                                        ;alternate entry point
   1577 C155 85 C1                                sta ibufidx           ;(re)set buffer index
   1578 C157 F4                       +            .byte $f4
   1578 C158 6F D0                    +            .word mm_prmpt
                                        
   1579 C15A 20 3B C8                             jsr sprint            ;display input prompt
   1580 C15D 20 5D CC                             jsr input             ;await some input
                                        ;
   1582 C160                            .0000010:
   1583 C160 20 BF CC                    		jsr getcharc          ;read from buffer
   1584 C163 F0 EA                                beq monce             ;terminator, just loop
                                        ;
   1586 C165 C9 20                                cmp #a_blank
   1587 C167 F0 F7                                beq .0000010          ;strip leading blanks
                                        ;
   1589 C169 A2 0C                                ldx #n_mpctab-1       ;number of primary commands
                                        ;
   1591 C16B DD D9 CC                   .0000020 cmp mpctab,x          ;search primary command list
   1592 C16E D0 0E                                bne .0000030
                                        ;
   1594 C170 8A                                   txa                   ;get index
   1595 C171 0A                                   asl                   ;double for offset
   1596 C172 AA                                   tax
   1597 C173 C2 20                    +            .byte $c2,$20
                                        
   1598 C175 BD E6 CC                             lda mpcextab,x        ;command address -1
   1599 C178 48                                   pha                   ;prime the stack
   1600 C179 E2 20                    +            .byte $e2,$20
                                        
   1601 C17B 4C 01 CB                             jmp getparm           ;evaluate parm & execute command
                                        ;
   1603 C17E CA                         .0000030 dex
   1604 C17F 10 EA                                bpl .0000020          ;continue searching primary commands
                                        ;
   1606 C181 A2 03                                ldx #n_radix-1        ;number of radices
                                        ;
   1608 C183 DD 14 CD                   .0000040 cmp radxtab,x         ;search conversion command list
   1609 C186 D0 03                                bne .0000050
                                        ;
   1611 C188 4C D8 C5                             jmp monenv            ;convert & display parameter
                                        ;
   1613 C18B CA                         .0000050 dex
   1614 C18C 10 F5                                bpl .0000040
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monerr: COMMON ERROR HANDLER
                                        ;
   1620 C18E E2 30                      monerr +         .byte $e2,$30
                                                        ;8 bit registers
                                        ;
   1622 C190 20 DC C7                   monerraa jsr dpyerr            ;indicate an error &...
   1623 C193 80 BA                                bra monce             ;return to input loop
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monasc: ASSEMBLE CODE
                                        ;
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;	syntax: A <addr> <mnemonic> [<argument>]
                                        ;
                                        ;	After a line of code has been successfully assembled it will be disass-
                                        ;	embled & displayed,  & the monitor will prompt with the next address to
                                        ;	which code may be assembled.
                                        ;	———————————————————————————————————————————————————————————————————————
                                        ;
   1637 C195 90 03                      monasc   bcc .0000020          ;assembly address entered
                                        ;
   1639 C197 4C 8E C1                   .0000010 jmp monerr            ;terminate w/error
                                        ;
                                        ;
                                        ;	evaluate assembly address...
                                        ;
   1644 C19A 20 ED CA                   .0000020 jsr facasize          ;check address...
   1645 C19D C9 04                                cmp #s_dword          ;range
   1646 C19F B0 F6                                bcs .0000010          ;out of range — error
                                        ;
   1648 C1A1 20 CF CA                             jsr facaddra          ;store assembly address
                                        ;
                                        ;
                                        ;	initialize workspace...
                                        ;
   1653 C1A4 A2 1F                                ldx #s_auxbuf-s_byte
                                        ;
   1655 C1A6 9E 51 02                   .0000030 stz auxbuf,x          ;clear addressing mode buffer
   1656 C1A9 CA                                   dex
   1657 C1AA D0 FA                                bne .0000030
                                        ;
   1659 C1AC A9 20                                lda #a_blank
   1660 C1AE 8D 51 02                             sta auxbuf            ;preamble placeholder
   1661 C1B1 20 3C CA                             jsr clroper           ;clear operand
   1662 C1B4 64 C0                                stz auxbufix          ;reset addressing mode index
   1663 C1B6 64 D0                                stz flimflag          ;clear forced long immediate
   1664 C1B8 64 CA                                stz mnepck            ;clear encoded...
   1665 C1BA 64 CB                                stz mnepck+s_byte     ;mnemonic workspace
   1666 C1BC 64 D3                                stz vopsflag          ;clear 8/16 or relative flag
                                        ;
                                        ;
                                        ;	encode mnemonic...
                                        ;
   1671 C1BE A0 03                                ldy #s_mnemon         ;expected mnemonic size
                                        ;
   1673 C1C0 20 4E CC                   .0000040 jsr getcharw          ;get from buffer wo/whitespace
   1674 C1C3 D0 0A                                bne .0000060          ;gotten
                                        ;
   1676 C1C5 C0 03                                cpy #s_mnemon         ;any input at all?
   1677 C1C7 90 03                                bcc .0000050          ;yes
                                        ;
   1679 C1C9 4C 4F C1                             jmp monce             ;no, abort further assembly
                                        ;
   1681 C1CC 4C 6E C3                   .0000050 jmp monasc10          ;incomplete mnemonic — error
                                        ;
   1683 C1CF 38                         .0000060 sec
   1684 C1D0 E9 3F                                sbc #a_mnecvt         ;ASCII to binary factor
   1685 C1D2 A2 05                                ldx #n_shfenc         ;shifts required to encode
                                        ;
   1687 C1D4 4A                         .0000070 lsr                   ;shift out a bit...
   1688 C1D5 66 CB                                ror mnepck+s_byte     ;into...
   1689 C1D7 66 CA                                ror mnepck            ;encoded mnemonic
   1690 C1D9 CA                                   dex
   1691 C1DA D0 F8                                bne .0000070          ;next bit
                                        ;
   1693 C1DC 88                                   dey
   1694 C1DD D0 E1                                bne .0000040          ;get next char
                                        ;
                                        ;
                                        ;	test for copy instruction...
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	The MVN & MVP instructions accept two operands & hence have an irregular
                                        ;	syntax.  Therefore, special handling is necessary to assemble either of
                                        ;	these instructions.
                                        ;
                                        ;	The official WDC syntax has the programmer entering a pair of 24 bit ad-
                                        ;	dresses as operands, with the assembler isolating bits 16-23 to	use as
                                        ;	operands.  This formality has been dispensed with in this monitor & the
                                        ;	operands are expected to be 8 bit bank values.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   1709 C1DF C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   1710 C1E1 A5 CA                                lda mnepck            ;packed menmonic
   1711 C1E3 A2 54                                ldx #opc_mvn          ;MVN opcode
   1712 C1E5 C9 DC                    +            cmp #<mne_mvn
   1712 C1E7 7D                       +            .byte >mne_mvn
                                        ;is it MVN?
   1713 C1E8 F0 07                                beq monasc01          ;yes
                                        ;
   1715 C1EA A2 44                                ldx #opc_mvp          ;MVP opcode
   1716 C1EC C9 DC                    +            cmp #<mne_mvp
   1716 C1EE 8D                       +            .byte >mne_mvp
                                        ;is it MVP?
   1717 C1EF D0 30                                bne monasc02          ;no
                                        ;
                                        ;
                                        ;	assemble copy instruction...
                                        ;
   1722 C1F1 86 CC                      monasc01 stx opcode            ;store relevant opcode
   1723 C1F3 E2 20                    +            .byte $e2,$20
                                        
   1724 C1F5 20 5D CB                             jsr instdata          ;get instruction data
   1725 C1F8 86 CF                                stx eopsize           ;effective operand size
   1726 C1FA E8                                   inx
   1727 C1FB 86 C8                                stx instsize          ;instruction size
   1728 C1FD A2 01                                ldx #s_oper-s_word    ;operand index
   1729 C1FF 86 CE                                stx xrtemp            ;set it
                                        ;
   1731 C201 20 56 C8                   .0000010 jsr ascbin            ;evaluate bank number
   1732 C204 B0 50                                bcs monasc04          ;conversion error
                                        ;
   1734 C206 F0 4E                                beq monasc04          ;nothing returned — error
                                        ;
   1736 C208 20 ED CA                             jsr facasize          ;bank must be...
   1737 C20B C9 02                                cmp #s_word           ;8 bits
   1738 C20D B0 47                                bcs monasc04          ;it isn't — error
                                        ;
   1740 C20F A5 A9                                lda faca              ;bank
   1741 C211 A6 CE                                ldx xrtemp            ;operand index
   1742 C213 95 BD                                sta operand,x         ;store
   1743 C215 C6 CE                                dec xrtemp            ;index=index-1
   1744 C217 10 E8                                bpl .0000010          ;get destination bank
                                        ;
   1746 C219 20 EE CB                             jsr getcharr          ;should be no more input
   1747 C21C D0 38                                bne monasc04          ;there is — error
                                        ;
   1749 C21E 4C 1C C3                             jmp monasc08          ;finish MVN/MVP assembly 
                                        ;
                                        ;
                                        ;	continue with normal assembly...
                                        ;
   1754 C221 E2 20                      monasc02 +         .byte $e2,$20
                                                        ;back to 8 bits
                                        ;
   1756 C223 20 4E CC                   monasc03 jsr getcharw          ;get next char
   1757 C226 F0 3D                                beq monasc06          ;EOI, no argument
                                        ;
   1759 C228 C9 21                                cmp #amp_flim
   1760 C22A D0 0A                                bne .0000010          ;no forced long immediate
                                        ;
   1762 C22C A5 D0                                lda flimflag          ;FLIM already set?
   1763 C22E D0 26                                bne monasc04          ;yes — error
                                        ;
   1765 C230 A9 C0                                lda #flimmask
   1766 C232 85 D0                                sta flimflag          ;set flag &...
   1767 C234 80 ED                                bra monasc03          ;get next char
                                        ;
   1769 C236 C9 23                      .0000010 cmp #amp_imm          ;immediate mode?
   1770 C238 F0 08                                beq .0000020          ;yes
                                        ;
   1772 C23A C9 28                                cmp #amp_ind          ;indirect mode?
   1773 C23C F0 04                                beq .0000020          ;yes
                                        ;
   1775 C23E C9 5B                                cmp #amp_indl         ;indirect long mode?
   1776 C240 D0 07                                bne .0000030          ;no
                                        ;
   1778 C242 8D 51 02                   .0000020 sta auxbuf            ;set addressing mode preamble
   1779 C245 E6 C0                                inc auxbufix          ;bump aux buffer index &...
   1780 C247 80 02                                bra .0000040          ;evaluate operand
                                        ;
   1782 C249 C6 C1                      .0000030 dec ibufidx           ;position back to char
                                        ;
   1784 C24B 20 56 C8                   .0000040 jsr ascbin            ;evaluate operand
   1785 C24E D0 09                                bne monasc05          ;evaluated
                                        ;
   1787 C250 B0 04                                bcs monasc04          ;conversion error
                                        ;
   1789 C252 A5 C0                                lda auxbufix          ;no operand...any preamble?
   1790 C254 F0 0F                                beq monasc06          ;no, syntax is okay so far
                                        ;
   1792 C256 4C 6E C3                   monasc04 jmp monasc10          ;abort w/error
                                        ;
   1794 C259 20 ED CA                   monasc05 jsr facasize          ;size operand
   1795 C25C C9 04                                cmp #s_dword          ;max is 24 bits
   1796 C25E B0 F6                                bcs monasc04          ;too big
                                        ;
   1798 C260 85 CF                                sta eopsize           ;save operand size
   1799 C262 20 E3 CA                             jsr facaoper          ;store operand
                                        ;
   1801 C265 C6 C1                      monasc06 dec ibufidx           ;back to last char
   1802 C267 A6 C0                                ldx auxbufix          ;mode buffer index
   1803 C269 D0 01                                bne .0000010          ;preamble in buffer
                                        ;
   1805 C26B E8                                   inx                   ;step past preamble position
                                        ;
   1807 C26C 20 BF CC                   .0000010 jsr getcharc          ;get a char w/forced UC
   1808 C26F F0 0A                                beq .0000030          ;EOI
                                        ;
   1810 C271 E0 20                                cpx #s_auxbuf         ;mode buffer full?
   1811 C273 B0 E1                                bcs monasc04          ;yes, too much input
                                        ;
   1813 C275 9D 51 02                   .0000020 sta auxbuf,x          ;store for comparison
   1814 C278 E8                                   inx
   1815 C279 D0 F1                                bne .0000010
                                        ;
                                        ;
                                        ;	evaluate mnemonic...
                                        ;
   1820 C27B A2 5B                      .0000030 ldx #n_mnemon-1       ;starting mnemonic index
                                        ;
   1822 C27D 8A                         monasc07 txa                   ;convert index...
   1823 C27E 0A                                   asl                   ;to offset
   1824 C27F A8                                   tay                   ;now mnemonic table index
   1825 C280 C2 20                    +            .byte $c2,$20
                                                         ;16 bit compare
   1826 C282 B9 21 CD                             lda mnetab,y          ;get mnemonic from table
   1827 C285 C5 CA                                cmp mnepck            ;compare to entered mnemonic
   1828 C287 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   1829 C289 F0 05                                beq .0000020          ;match
                                        ;
   1831 C28B CA                         .0000010 dex                   ;try next mnemonic
   1832 C28C 30 C8                                bmi monasc04          ;unknown mnemonic — error
                                        ;
   1834 C28E 80 ED                                bra monasc07          ;keep going
                                        ;
   1836 C290 86 CA                      .0000020 stx mnepck            ;save mnemonic index
   1837 C292 8A                                   txa
   1838 C293 A2 00                                ldx #0                ;trial opcode
                                        ;
   1840 C295 DD D9 CD                   .0000030 cmp mnetabix,x        ;search index table...
   1841 C298 F0 05                                beq .0000050          ;for a match
                                        ;
   1843 C29A E8                         .0000040 inx                   ;keep going until we...
   1844 C29B D0 F8                                bne .0000030          ;search entire table
                                        ;
   1846 C29D 80 B7                                bra monasc04          ;this shouldn't happen!
                                        ;
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;	If the mnemonic index table search fails then there is a coding error
                                        ;	somewhere, as every entry in the mnemonic table is supposed to have a
                                        ;	matching cardinal index.
                                        ;	—————————————————————————————————————————————————————————————————————
                                        ;
                                        ;
                                        ;	evaluate addressing mode...
                                        ;
   1857 C29F 86 CC                      .0000050 stx opcode            ;save trial opcode
   1858 C2A1 20 5D CB                             jsr instdata          ;get related instruction data
   1859 C2A4 85 D3                                sta vopsflag          ;save 8/16 or relative flag
   1860 C2A6 86 D1                                stx iopsize           ;operand size
   1861 C2A8 E8                                   inx
   1862 C2A9 86 C8                                stx instsize          ;instruction size
   1863 C2AB A6 CC                                ldx opcode            ;recover trial opcode
   1864 C2AD 98                                   tya                   ;addressing mode
   1865 C2AE 0A                                   asl                   ;create table index
   1866 C2AF A8                                   tay
   1867 C2B0 C2 20                    +            .byte $c2,$20
                                        
   1868 C2B2 B9 DD CF                             lda ms_lutab,y        ;mode lookup table
   1869 C2B5 85 A6                                sta addrb             ;set pointer
   1870 C2B7 E2 20                    +            .byte $e2,$20
                                        
   1871 C2B9 A0 00                                ldy #0
                                        ;
   1873 C2BB B1 A6                      .0000060 lda (addrb),y         ;table addressing mode
   1874 C2BD D9 51 02                             cmp auxbuf,y          ;entered addressing mode
   1875 C2C0 F0 04                                beq .0000080          ;okay so far
                                        ;
   1877 C2C2 A5 CA                      .0000070 lda mnepck            ;reload mnemonic index        
   1878 C2C4 80 D4                                bra .0000040          ;wrong opcode for addresing mode
                                        ;
   1880 C2C6 09 00                      .0000080 ora #0                ;last char the terminator?
   1881 C2C8 F0 03                                beq .0000090          ;yes, evaluate operand
                                        ;
   1883 C2CA C8                                   iny
   1884 C2CB 80 EE                                bra .0000060          ;keep testing
                                        ;
                                        ;
                                        ;	evaluate operand...
                                        ;
   1889 C2CD A5 CF                      .0000090 lda eopsize           ;entered operand size
   1890 C2CF D0 06                                bne .0000100          ;non-zero
                                        ;
   1892 C2D1 05 D1                                ora iopsize           ;instruction operand size
   1893 C2D3 D0 ED                                bne .0000070          ;wrong opcode — keep trying
                                        ;
   1895 C2D5 80 45                                bra monasc08          ;assemble instruction
                                        ;
   1897 C2D7 24 D3                      .0000100 bit vopsflag          ;is this a branch?
   1898 C2D9 70 3A                                bvs .0000160          ;yes, evaluate
                                        ;
   1900 C2DB A5 D1                                lda iopsize           ;instruction operand size
   1901 C2DD 24 D3                                bit vopsflag          ;variable size operand allowed?
   1902 C2DF 30 15                                bmi .0000130          ;yes
                                        ;
   1904 C2E1 24 D0                                bit flimflag          ;was forced immediate set?
   1905 C2E3 10 03                                bpl .0000110          ;no
                                        ;         
   1907 C2E5 4C 6E C3                             jmp monasc10          ;yes — error
                                        ;
   1909 C2E8 C5 CF                      .0000110 cmp eopsize           ;entered operand size
   1910 C2EA 90 D6                                bcc .0000070          ;operand too big
                                        ;
   1912 C2EC 85 CF                                sta eopsize           ;new operand size
   1913 C2EE 80 2C                                bra monasc08          ;assemble, otherwise...
                                        ;
   1915 C2F0 C5 CF                      .0000120 cmp eopsize           ;exact size match required
   1916 C2F2 D0 CE                                bne .0000070          ;mismatch — wrong opcode
                                        ;
   1918 C2F4 80 26                                bra monasc08          ;assemble
                                        ;
                                        ;
                                        ;	process variable size immediate mode operand...
                                        ;
   1923 C2F6 A6 CF                      .0000130 ldx eopsize           ;entered operand size
   1924 C2F8 E0 03                                cpx #s_xword          ;check size
   1925 C2FA B0 72                                bcs monasc10          ;too big — error
                                        ;
   1927 C2FC 24 D0                                bit flimflag          ;forced long immediate?
   1928 C2FE 10 06                                bpl .0000140          ;no
                                        ;
   1930 C300 A2 02                                ldx #s_word           ;promote operand size to...
   1931 C302 86 CF                                stx eopsize           ;16 bits
   1932 C304 80 08                                bra .0000150
                                        ;
   1934 C306 E0 02                      .0000140 cpx #s_word           ;16 bits?
   1935 C308 D0 04                                bne .0000150          ;no
                                        ;
   1937 C30A A0 C0                                ldy #flimmask         ;yes so force long...
   1938 C30C 84 D0                                sty flimflag          ;immediate disassembly
                                        ;
   1940 C30E 1A                         .0000150 ina                   ;new instruction operand size
   1941 C30F C5 CF                                cmp eopsize           ;compare against operand size
   1942 C311 90 AF                                bcc .0000070          ;mismatch — can't assemble
                                        ;
   1944 C313 80 07                                bra monasc08          ;okay, assemble
                                        ;
                                        ;
                                        ;	process relative branch...
                                        ;
   1949 C315 20 A9 CB                   .0000160 jsr targoff           ;compute branch offset
   1950 C318 B0 54                                bcs monasc10          ;branch out of range
                                        ;
   1952 C31A 85 CF                                sta eopsize           ;effective operand size
                                        ;
                                        ;
                                        ;	assemble instruction...
                                        ;
   1957 C31C A5 CC                      monasc08 lda opcode            ;opcode
   1958 C31E 87 A2                    +            .byte $87,addra
                                        ;store at assembly address
   1959 C320 A6 CF                                ldx eopsize           ;any operand to process?
   1960 C322 F0 09                                beq .0000020          ;no
                                        ;
   1962 C324 9B                       +            .byte $9b
                                                           ;also storage offset
                                        ;
   1964 C325 CA                         .0000010 dex
   1965 C326 B5 BD                                lda operand,x         ;get operand byte &...
   1966 C328 97 A2                    +            .byte $97,addra
                                        ;poke into memory
   1967 C32A 88                                   dey
   1968 C32B D0 F8                                bne .0000010          ;next
                                        ;
   1970 C32D A9 0D                      .0000020 lda #a_cr
                                           		 cpu FT832
   1972 00C32F 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   1974 C334 A9 41                                lda #asmprfx          ;assembly prefix
   1975 C336 20 79 C6                             jsr dpycodaa          ;disassemble & display
                                        ;
                                        ;
                                        ;	prompt for next instruction...
                                        ;
   1980 C339 A9 20                      monasc09 lda #a_blank
   1981 C33B A2 08                                ldx #ascprmct-1
                                        ;
   1983 C33D 9D 00 02                   .0000010 sta ibuffer,x         ;prepare buffer for...
   1984 C340 CA                                   dex                   ;next instruction
   1985 C341 10 FA                                bpl .0000010
                                        ;
   1987 C343 A9 41                                lda #asmprfx          ;assemble code...
   1988 C345 8D 00 02                             sta ibuffer           ;prompt prefix
   1989 C348 A5 A4                                lda addra+s_word      ;next instruction address bank
   1990 C34A 20 A8 C9                             jsr binhex            ;convert to ASCII
   1991 C34D 8D 02 02                             sta ibuffer+apadrbkh  ;store MSN in buffer
   1992 C350 8E 03 02                             stx ibuffer+apadrbkl  ;store LSN in buffer
   1993 C353 A5 A3                                lda addra+s_byte      ;next instruction address MSB
   1994 C355 20 A8 C9                             jsr binhex
   1995 C358 8D 04 02                             sta ibuffer+apadrmbh
   1996 C35B 8E 05 02                             stx ibuffer+apadrmbl
   1997 C35E A5 A2                                lda addra             ;next instruction address LSB
   1998 C360 20 A8 C9                             jsr binhex
   1999 C363 8D 06 02                             sta ibuffer+apadrlbh
   2000 C366 8E 07 02                             stx ibuffer+apadrlbl
   2001 C369 A9 09                                lda #ascprmct         ;effective input count
   2002 C36B 4C 53 C1                             jmp moncea            ;reenter input loop
                                        ;
                                        ;
                                        ;	process assembly error...
                                        ;
   2007 C36E 20 DC C7                   monasc10 jsr dpyerr            ;indicate error &...
   2008 C371 80 C6                                bra monasc09          ;prompt w/same assembly address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondsc: DISASSEMBLE CODE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: D [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2018 C373 B0 11                      mondsc   bcs .0000010          ;no parameters
                                        ;
   2020 C375 64 D0                                stz flimflag          ;reset to 8 bit mode
   2021 C377 20 ED CA                             jsr facasize          ;check starting...
   2022 C37A C9 04                                cmp #s_dword          ;address
   2023 C37C B0 46                                bcs .0000050          ;out of range — error
                                        ;
   2025 C37E 20 CF CA                             jsr facaddra          ;copy starting address
   2026 C381 20 01 CB                             jsr getparm           ;get ending address
   2027 C384 90 17                                bcc .0000020          ;gotten
                                        ;
   2029 C386 20 BB C9                   .0000010 jsr clrfaca           ;clear accumulator
   2030 C389 C2 20                    +            .byte $c2,$20
                                        
   2031 C38B 18                                   clc
   2032 C38C A5 A2                                lda addra             ;starting address
   2033 C38E 69 15                    +            adc #<n_dbytes
   2033 C390 00                       +            .byte >n_dbytes
                                        ;default bytes
   2034 C391 85 A9                                sta faca              ;effective ending address
   2035 C393 E2 20                    +            .byte $e2,$20
                                        
   2036 C395 A5 A4                                lda addra+s_word      ;starting bank
   2037 C397 69 00                                adc #0
   2038 C399 85 AB                                sta faca+s_word       ;effective ending bank
   2039 C39B B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2041 C39D 20 ED CA                   .0000020 jsr facasize          ;check ending...
   2042 C3A0 C9 04                                cmp #s_dword          ;address
   2043 C3A2 B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2045 C3A4 20 D9 CA                             jsr facaddrb          ;set ending address
   2046 C3A7 20 01 CB                             jsr getparm           ;check for excess input
   2047 C3AA 90 18                                bcc .0000050          ;present — error
                                        ;
   2049 C3AC 20 27 CA                             jsr calccnt           ;calculate bytes
   2050 C3AF 90 13                                bcc .0000050          ;end < start
                                        ;
   2052 C3B1 20 D1 CC                   .0000030 jsr teststop          ;test for display stop
   2053 C3B4 B0 0B                                bcs .0000040          ;stopped
                                        ;
   2055 C3B6 20 23 C8                             jsr newline           ;next line
   2056 C3B9 20 77 C6                             jsr dpycod            ;disassemble & display
   2057 C3BC 20 85 CA                             jsr decdcnt           ;decrement byte count
   2058 C3BF 90 F0                                bcc .0000030          ;not done
                                        ;
   2060 C3C1 4C 4F C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2062 C3C4 4C 8E C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjmp: EXECUTE CODE
                                        ;
                                        ;	—————————————————————————————————————————————————————————————
                                        ;	syntax: G [<addr>]
                                        ;
                                        ;	If no address is specified, the current values in the PB & PC
                                        ;	shadow registers are used.
                                        ;	—————————————————————————————————————————————————————————————
                                        ;
   2075 C3C7 20 92 CB                   monjmp   jsr setxaddr          ;set execution address
   2076 C3CA B0 29                                bcs monjmpab          ;out of range — error
                                        ;
   2078 C3CC 20 01 CB                             jsr getparm           ;check for excess input
   2079 C3CF 90 24                                bcc monjmpab          ;too much input — error
                                        ;
   2081 C3D1 C2 20                    +            .byte $c2,$20
                                                         ;16 bit .A
   2082 C3D3 A5 97                                lda reg_spx
   2083 C3D5 1B                       +            .byte $1b
                                                           ;restore SP
                                        ;
   2085 C3D6 E2 20                      monjmpaa +         .byte $e2,$20
                                        
   2086 C3D8 A5 8A                                lda reg_pbx
   2087 C3DA 48                                   pha                   ;restore PB
   2088 C3DB C2 20                    +            .byte $c2,$20
                                        
   2089 C3DD A5 88                                lda reg_pcx
   2090 C3DF 48                                   pha                   ;restore PC
   2091 C3E0 E2 20                    +            .byte $e2,$20
                                        
   2092 C3E2 A5 9B                                lda reg_srx
   2093 C3E4 48                                   pha                   ;restore SR
   2094 C3E5 A5 9D                                lda reg_dbx
   2095 C3E7 48                                   pha
   2096 C3E8 AB                       +            .byte $ab
                                                           ;restore DB
   2097 C3E9 C2 30                    +            .byte $c2,$30
                                        
   2098 C3EB A5 9E                                lda reg_dpx
   2099 C3ED 5B                       +            .byte $5b
                                                           ;restore DP
   2100 C3EE A5 8B                                lda reg_ax            ;restore .C
   2101 C3F0 A6 8F                                ldx reg_xx            ;restore .X
   2102 C3F2 A4 93                                ldy reg_yx            ;restore .Y
   2103 C3F4 40                                   rti                   ;execute code
                                        ;
   2105 C3F5 4C 8E C1                   monjmpab jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monjsr: EXECUTE CODE AS SUBROUTINE
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	syntax: J [<addr>]
                                        ;
                                        ;	If no address is specified the current values in the PB & PC
                                        ;	shadow registers are used.   An RTS at the end of the called
                                        ;	subroutine will return control to the monitor  provided  the
                                        ;	stack remains in balance.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2120 C3F8 20 92 CB                   monjsr   jsr setxaddr          ;set execution address
   2121 C3FB B0 F8                                bcs monjmpab          ;out of range — error
                                        ;
   2123 C3FD 20 01 CB                             jsr getparm           ;check for excess input
   2124 C400 90 F3                                bcc monjmpab          ;too much input — error
                                        ;
   2126 C402 C2 20                    +            .byte $c2,$20
                                        
   2127 C404 A5 97                                lda reg_spx
   2128 C406 1B                       +            .byte $1b
                                                           ;restore SP &...
   2129 C407 20 D6 C3                             jsr monjmpaa          ;call subroutine
   2130 C40A 08                                   php                   ;push SR
   2131 C40B C2 30                    +            .byte $c2,$30
                                        
   2132 C40D 85 8B                                sta reg_ax            ;save...
   2133 C40F 86 8F                                stx reg_xx            ;register...
   2134 C411 84 93                                sty reg_yx            ;returns
   2135 C413 E2 10                    +            .byte $e2,$10
                                                        ;8 bit .X & .Y
   2136 C415 FA                                   plx                   ;get & save...
   2137 C416 86 9B                                stx reg_srx           ;return SR
   2138 C418 3B                       +            .byte $3b
                                                           ;get & save...
   2139 C419 85 97                                sta reg_spx           ;return SP
   2140 C41B 7B                       +            .byte $7b
                                                           ;get & save...
   2141 C41C 85 9E                                sta reg_dpx           ;DP pointer
   2142 C41E E2 20                    +            .byte $e2,$20
                                                        ;8 bit .A
   2143 C420 4B                       +            .byte $4b
                                                           ;get &...
   2144 C421 68                                   pla                   ;save...
   2145 C422 85 8A                                sta reg_pbx           ;return PB
   2146 C424 8B                       +            .byte $8b
                                                           ;get &...
   2147 C425 68                                   pla                   ;save...
   2148 C426 85 9D                                sta reg_dbx           ;return DB
   2149 C428 F4                       +            .byte $f4
   2149 C429 F0 D0                    +            .word mm_rts
                                        ;"*RET"
   2150 C42B 4C 87 C0                             jmp moncom            ;return to monitor
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchm: CHANGE and/or DUMP MEMORY
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	syntax: > [<addr> <operand> [<operand>]...]
                                        ;
                                        ;	> <addr> without operands will dump 16 bytes
                                        ;	of memory, starting at <addr>.
                                        ;	————————————————————————————————————————————
                                        ;
   2163 C42E B0 23                      monchm   bcs .0000030          ;no address given — quit
                                        ;
   2165 C430 20 ED CA                             jsr facasize          ;size address
   2166 C433 C9 04                                cmp #s_dword
   2167 C435 B0 1F                                bcs .0000040          ;address out of range — error
                                        ;
   2169 C437 20 CF CA                             jsr facaddra          ;set starting address
   2170 C43A 20 02 CC                             jsr getpat            ;evaluate change pattern
   2171 C43D 90 04                                bcc .0000010          ;entered
                                        ;
   2173 C43F 10 0C                                bpl .0000020          ;not entered
                                        ;
   2175 C441 80 13                                bra .0000040          ;evaluation error
                                        ;
   2177 C443 88                         .0000010 dey                   ;next byte
   2178 C444 30 07                                bmi .0000020          ;done
                                        ;
   2180 C446 B9 51 02                             lda auxbuf,y          ;write pattern...
   2181 C449 97 A2                    +            .byte $97,addra
                                        ;to memory
   2182 C44B 80 F6                                bra .0000010          ;next
                                        ;
   2184 C44D 20 23 C8                   .0000020 jsr newline           ;next line
   2185 C450 20 95 C7                             jsr dpymem            ;regurgitate changes
                                        ;
   2187 C453 4C 4F C1                   .0000030 jmp monce             ;back to command loop
                                        ;
   2189 C456 4C 8E C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncmp: COMPARE MEMORY
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: C <start> <end> <ref>
                                        ;	—————————————————————————————
                                        ;
   2199 C459 B0 26                      moncmp   bcs .0000030          ;start not given — quit
                                        ;
   2201 C45B 20 A9 CA                             jsr enddest           ;get end & reference addresses
   2202 C45E B0 24                                bcs .0000040          ;range or other error
                                        ;
   2204 C460 64 CE                                stz xrtemp            ;column counter
                                        ;
   2206 C462 20 D1 CC                   .0000010 jsr teststop          ;check for stop
   2207 C465 B0 1A                                bcs .0000030          ;abort
                                        ;
   2209 C467 A7 A2                    +            .byte $a7,addra
                                        ;get from reference location
   2210 C469 C7 BD                    +            .byte $c7,operand
                                        ;test against compare location
   2211 C46B F0 03                                beq .0000020          ;match, don't display address
                                        ;
   2213 C46D 20 5D C6                             jsr dpycaddr          ;display current location
                                        ;
   2215 C470 20 29 CB                   .0000020 jsr nxtaddra          ;next reference location
   2216 C473 B0 0C                                bcs .0000030          ;done
                                        ;
   2218 C475 C2 20                    +            .byte $c2,$20
                                        
   2219 C477 E6 BD                                inc operand           ;bump bits 0-15
   2220 C479 E2 20                    +            .byte $e2,$20
                                        
   2221 C47B D0 E5                                bne .0000010
                                        ;
   2223 C47D E6 BF                                inc operand+s_word    ;bump bits 16-23
   2224 C47F 80 E1                                bra .0000010
                                        ;
   2226 C481 4C 4F C1                   .0000030 jmp monce             ;return to command exec
                                        ;
   2228 C484 4C 8E C1                   .0000040 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;moncpy: COPY (transfer) MEMORY
                                        ;
                                        ;	————————————————————————————————
                                        ;	syntax: T <start> <end> <target>
                                        ;	————————————————————————————————
                                        ;
   2238 C487 B0 49                      moncpy   bcs .0000040          ;start not given — quit
                                        ;
   2240 C489 20 A9 CA                             jsr enddest           ;get end & target addresses
   2241 C48C B0 47                                bcs .0000050          ;range or other error
                                        ;
   2243 C48E C2 20                    +            .byte $c2,$20
                                        
   2244 C490 38                                   sec
   2245 C491 A5 A6                                lda addrb             ;ending address
   2246 C493 E5 A2                                sbc addra             ;starting address
   2247 C495 90 3E                                bcc .0000050          ;start > end — error
                                        ;
   2249 C497 85 B1                                sta facb              ;bytes to copy
   2250 C499 E2 20                    +            .byte $e2,$20
                                        
   2251 C49B C2 10                    +            .byte $c2,$10
                                        
   2252 C49D A5 BF                                lda operand+s_word    ;target bank
   2253 C49F A4 BD                                ldy operand           ;target address
   2254 C4A1 C5 A4                                cmp addra+s_word      ;source bank
   2255 C4A3 C2 20                    +            .byte $c2,$20
                                        
   2256 C4A5 D0 1C                                bne .0000020          ;can use forward copy
                                        ;
   2258 C4A7 C4 A2                                cpy addra             ;source address
   2259 C4A9 90 18                                bcc .0000020          ;can use forward copy
                                        ;
   2261 C4AB D0 02                                bne .0000010          ;must use reverse copy
                                        ;
   2263 C4AD 80 26                                bra .0000050          ;copy in place — error
                                        ;
   2265 C4AF A5 B1                      .0000010 lda facb              ;get bytes to copy
   2266 C4B1 48                                   pha                   ;protect
   2267 C4B2 20 B7 CC                             jsr lodbnk            ;load banks
   2268 C4B5 20 4F CA                             jsr cprvsup           ;do reverse copy setup
   2269 C4B8 68                                   pla                   ;get bytes to copy
   2270 C4B9 AA                                   tax                   ;save a copy
   2271 C4BA 18                                   clc
   2272 C4BB 65 BD                                adc operand           ;change target to...
   2273 C4BD A8                                   tay                   ;target end
   2274 C4BE 8A                                   txa                   ;recover bytes to copy
   2275 C4BF A6 A6                                ldx addrb             ;source end
   2276 C4C1 80 0C                                bra .0000030
                                        ;
   2278 C4C3 A5 B1                      .0000020 lda facb              ;get bytes to copy
   2279 C4C5 48                                   pha                   ;protect
   2280 C4C6 20 B7 CC                             jsr lodbnk            ;load banks
   2281 C4C9 20 48 CA                             jsr cpfwsup           ;do forward copy setup
   2282 C4CC 68                                   pla                   ;get bytes to copy
   2283 C4CD A6 A2                                ldx addra             ;source start
                                        ;
   2285 C4CF 4C D4 00                   .0000030 jmp mcftwork          ;copy memory
                                        ;
   2287 C4D2 4C 4F C1                   .0000040 jmp monce             ;back to executive
                                        ;
   2289 C4D5 4C 8E C1                   .0000050 jmp monerr            ;error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;mondmp: DISPLAY MEMORY RANGE
                                        ;
                                        ;	—————————————————————————————
                                        ;	syntax: M [<addr1> [<addr2>]]
                                        ;	—————————————————————————————
                                        ;
   2299 C4D8 B0 0F                      mondmp   bcs .0000010          ;no parameters
                                        ;
   2301 C4DA 20 ED CA                             jsr facasize          ;check address...
   2302 C4DD C9 04                                cmp #s_dword          ;range
   2303 C4DF B0 46                                bcs .0000050          ;address out of range
                                        ;
   2305 C4E1 20 CF CA                             jsr facaddra          ;copy starting address
   2306 C4E4 20 01 CB                             jsr getparm           ;get ending address
   2307 C4E7 90 17                                bcc .0000020          ;gotten
                                        ;
   2309 C4E9 20 BB C9                   .0000010 jsr clrfaca           ;clear accumulator
   2310 C4EC C2 20                    +            .byte $c2,$20
                                        
   2311 C4EE 18                                   clc
   2312 C4EF A5 A2                                lda addra             ;starting address
   2313 C4F1 69 FF                    +            adc #<n_mbytes
   2313 C4F3 00                       +            .byte >n_mbytes
                                        ;default bytes
   2314 C4F4 85 A9                                sta faca              ;effective ending address
   2315 C4F6 E2 20                    +            .byte $e2,$20
                                        
   2316 C4F8 A5 A4                                lda addra+s_word      ;starting bank
   2317 C4FA 69 00                                adc #0
   2318 C4FC 85 AB                                sta faca+s_word       ;effective ending bank
   2319 C4FE B0 27                                bcs .0000050          ;end address > $FFFFFF
                                        ;
   2321 C500 20 ED CA                   .0000020 jsr facasize          ;check ending address...
   2322 C503 C9 04                                cmp #s_dword          ;range
   2323 C505 B0 20                                bcs .0000050          ;out of range — error
                                        ;
   2325 C507 20 D9 CA                             jsr facaddrb          ;copy ending address
   2326 C50A 20 01 CB                             jsr getparm           ;check for excess input
   2327 C50D 90 18                                bcc .0000050          ;error
                                        ;
   2329 C50F 20 27 CA                             jsr calccnt           ;calculate bytes to dump
   2330 C512 90 13                                bcc .0000050          ;end < start
                                        ;
   2332 C514 20 D1 CC                   .0000030 jsr teststop          ;test for display stop
   2333 C517 B0 0B                                bcs .0000040          ;stopped
                                        ;
   2335 C519 20 23 C8                             jsr newline           ;next line
   2336 C51C 20 95 C7                             jsr dpymem            ;display
   2337 C51F 20 85 CA                             jsr decdcnt           ;decrement byte count
   2338 C522 90 F0                                bcc .0000030          ;not done
                                        ;
   2340 C524 4C 4F C1                   .0000040 jmp monce             ;back to main loop
                                        ;
   2342 C527 4C 8E C1                   .0000050 jmp monerr            ;address range error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monfil: FILL MEMORY
                                        ;
                                        ;	—————————————————————————————————————————
                                        ;	syntax: F <start> <end> <fill>
                                        ;
                                        ;	<start> & <end> must be in the same bank.
                                        ;	—————————————————————————————————————————
                                        ;
   2354 C52A B0 5E                      monfil   bcs .0000010          ;start not given — quit
                                        ;
   2356 C52C 20 ED CA                             jsr facasize          ;check size
   2357 C52F C9 04                                cmp #s_dword
   2358 C531 B0 5A                                bcs .0000020          ;out of range — error...
                                        ;
   2360 C533 20 CF CA                             jsr facaddra          ;store start
   2361 C536 20 01 CB                             jsr getparm           ;evaluate end
   2362 C539 B0 52                                bcs .0000020          ;not entered — error
                                        ;
   2364 C53B 20 ED CA                             jsr facasize          ;check size
   2365 C53E C9 04                                cmp #s_dword
   2366 C540 B0 4B                                bcs .0000020          ;out of range — error
                                        ;
   2368 C542 A5 AB                                lda faca+s_word       ;end bank
   2369 C544 C5 A4                                cmp addra+s_word      ;start bank
   2370 C546 D0 45                                bne .0000020          ;not same — error
                                        ;
   2372 C548 20 D9 CA                             jsr facaddrb          ;store <end>
   2373 C54B C2 20                    +            .byte $c2,$20
                                        
   2374 C54D 38                                   sec
   2375 C54E A5 A6                                lda addrb             ;ending address
   2376 C550 E5 A2                                sbc addra             ;starting address
   2377 C552 90 39                                bcc .0000020          ;start > end — error
                                        ;
   2379 C554 85 B1                                sta facb              ;bytes to copy
   2380 C556 E2 20                    +            .byte $e2,$20
                                        
   2381 C558 20 01 CB                             jsr getparm           ;evaluate <fill>
   2382 C55B B0 30                                bcs .0000020          ;not entered — error
                                        ;
   2384 C55D 20 ED CA                             jsr facasize          ;<fill> should be...
   2385 C560 C9 02                                cmp #s_word           ;8 bits
   2386 C562 B0 29                                bcs .0000020          ;it isn't — error
                                        ;
   2388 C564 20 E3 CA                             jsr facaoper          ;store <fill>
   2389 C567 20 01 CB                             jsr getparm           ;should be no more parameters
   2390 C56A 90 21                                bcc .0000020          ;there are — error
                                        ;
   2392 C56C A5 BD                                lda operand           ;<fill>
   2393 C56E 87 A2                    +            .byte $87,addra
                                        ;fill 1st location
   2394 C570 C2 30                    +            .byte $c2,$30
                                                         ;16 bit operations
   2395 C572 A5 B1                                lda facb              ;
   2396 C574 F0 14                                beq .0000010          ;only 1 location — finished
                                        ;
   2398 C576 3A                                   dea                   ;zero align &...
   2399 C577 48                                   pha                   ;protect
   2400 C578 E2 20                    +            .byte $e2,$20
                                        
   2401 C57A A5 A4                                lda addra+s_word      ;start bank
   2402 C57C EB                       +            .byte $eb
                                        
   2403 C57D A5 A8                                lda addrb+s_word      ;end bank
   2404 C57F 20 48 CA                             jsr cpfwsup           ;do forward copy setup
   2405 C582 68                                   pla                   ;recover fill count
   2406 C583 A6 A2                                ldx addra             ;fill-from starting location
   2407 C585 9B                       +            .byte $9b
                                        
   2408 C586 C8                                   iny                   ;fill-to starting location
   2409 C587 4C D4 00                             jmp mcftwork          ;fill memory
                                        ;
   2411 C58A 4C 4F C1                   .0000010 jmp monce             ;goto command executive
                                        ;
   2413 C58D 4C 8E C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monhnt: SEARCH (hunt) MEMORY
                                        ;
                                        ;	———————————————————————————————————
                                        ;	syntax: H <addr1> <addr2> <pattern>
                                        ;	———————————————————————————————————
                                        ;
   2423 C590 B0 40                      monhnt   bcs .0000050          ;no start address
                                        ;
   2425 C592 20 ED CA                             jsr facasize          ;size starting address
   2426 C595 C9 04                                cmp #s_dword
   2427 C597 B0 3C                                bcs .0000060          ;address out of range — error
                                        ;
   2429 C599 20 CF CA                             jsr facaddra          ;store starting address
   2430 C59C 20 01 CB                             jsr getparm           ;evaluate ending address
   2431 C59F B0 34                                bcs .0000060          ;no address — error
                                        ;
   2433 C5A1 20 ED CA                             jsr facasize          ;size ending address
   2434 C5A4 C9 04                                cmp #s_dword
   2435 C5A6 B0 2D                                bcs .0000060          ;address out of range — error
                                        ;
   2437 C5A8 20 D9 CA                             jsr facaddrb          ;store ending address
   2438 C5AB 20 27 CA                             jsr calccnt           ;calculate byte range
   2439 C5AE 90 25                                bcc .0000060          ;end < start
                                        ;
   2441 C5B0 20 02 CC                             jsr getpat            ;evaluate search pattern
   2442 C5B3 B0 20                                bcs .0000060          ;error
                                        ;
   2444 C5B5 64 CE                                stz xrtemp            ;clear column counter
                                        ;
   2446 C5B7 20 D1 CC                   .0000010 jsr teststop          ;check for stop
   2447 C5BA B0 16                                bcs .0000050          ;abort
                                        ;
   2449 C5BC A4 C0                                ldy auxbufix          ;pattern index
                                        ;
   2451 C5BE 88                         .0000020 dey
   2452 C5BF 30 09                                bmi .0000030          ;pattern match
                                        ;
   2454 C5C1 B7 A2                    +            .byte $b7,addra
                                        ;get from memory
   2455 C5C3 D9 51 02                             cmp auxbuf,y          ;test against pattern
   2456 C5C6 D0 05                                bne .0000040          ;mismatch, next location
                                        ;
   2458 C5C8 F0 F4                                beq .0000020          ;match, keep testing
                                        ;
   2460 C5CA 20 5D C6                   .0000030 jsr dpycaddr          ;display current location
                                        ;
   2462 C5CD 20 29 CB                   .0000040 jsr nxtaddra          ;next location
   2463 C5D0 90 E5                                bcc .0000010          ;not done
                                        ;
   2465 C5D2 4C 4F C1                   .0000050 jmp monce             ;back to executive
                                        ;
   2467 C5D5 4C 8E C1                   .0000060 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monenv: CONVERT NUMERIC VALUE
                                        ;
                                        ;	——————————————————————
                                        ;	syntax: <radix><value>
                                        ;	——————————————————————
                                        ;
   2477 C5D8 20 FF CA                   monenv   jsr getparmr          ;reread & evaluate parameter
   2478 C5DB B0 26                                bcs .0000020          ;none entered
                                        ;
   2480 C5DD A2 00                                ldx #0                ;radix index
   2481 C5DF A0 04                                ldy #n_radix          ;number of radices
                                        ;
   2483 C5E1 5A                         .0000010 phy                   ;save counter
   2484 C5E2 DA                                   phx                   ;save radix index
   2485 C5E3 20 23 C8                             jsr newline           ;next line &...
   2486 C5E6 20 8B C7                             jsr clearlin          ;clear it
   2487 C5E9 A9 20                                lda #a_blank
   2488 C5EB A2 04                                ldx #halftab
   2489 C5ED 20 14 C8                             jsr multspc           ;indent 1/2 tab
   2490 C5F0 FA                                   plx                   ;get radix index but...
   2491 C5F1 DA                                   phx                   ;put it back
   2492 C5F2 BD 14 CD                             lda radxtab,x         ;get radix
   2493 C5F5 20 14 C9                             jsr binasc            ;convert to ASCII
   2494 C5F8 5A                                   phy                   ;string address MSB
   2495 C5F9 DA                                   phx                   ;string address LSB
   2496 C5FA 20 3B C8                             jsr sprint            ;print
   2497 C5FD FA                                   plx                   ;get index again
   2498 C5FE 7A                                   ply                   ;get counter
   2499 C5FF E8                                   inx
   2500 C600 88                                   dey
   2501 C601 D0 DE                                bne .0000010          ;no
                                        
   2503 C603 4C 4F C1                   .0000020 jmp monce             ;back to command exec
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monchr: CHANGE REGISTERS
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	syntax: ; [PB [PC [.S [.C [.X [.Y [SP [DP [DB]]]]]]]]]
                                        ;
                                        ;	; with no parameters is the same as the R command.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   2515 C606 B0 33                      monchr   bcs .0000040          ;dump registers & quit
                                        ;
   2517 C608 A0 00                                ldy #0                ;register counter
   2518 C60A 84 B7                                sty facc              ;initialize register index
                                        ;
   2520 C60C 20 ED CA                   .0000010 jsr facasize          ;get parameter size
   2521 C60F D9 18 CD                             cmp rcvltab,y         ;check against size table
   2522 C612 B0 2A                                bcs .0000050          ;out of range
                                        ;
   2524 C614 B9 18 CD                             lda rcvltab,y         ;determine number of bytes...
   2525 C617 C9 03                                cmp #s_word+1         ;to store
   2526 C619 66 B8                                ror facc+s_byte       ;condition flag
   2527 C61B 10 02                                bpl .0000020          ;8 bit register size
                                        ;
   2529 C61D C2 20                    +            .byte $c2,$20
                                                         ;16 bit register size
                                        ;
   2531 C61F A6 B7                      .0000020 ldx facc              ;get register index
   2532 C621 A5 A9                                lda faca              ;get parm
   2533 C623 95 8A                                sta reg_pbx,x         ;put in shadow storage
   2534 C625 E2 20                    +            .byte $e2,$20
                                        
   2535 C627 06 B8                                asl facc+s_byte       ;mode flag to carry
   2536 C629 8A                                   txa                   ;register index
   2537 C62A 69 01                                adc #s_byte           ;at least 1 byte stored
   2538 C62C 85 B7                                sta facc              ;save new index
   2539 C62E 20 01 CB                             jsr getparm           ;get a parameter
   2540 C631 B0 08                                bcs .0000040          ;EOI
                                        ;
   2542 C633 C8                                   iny                   ;bump register count
   2543 C634 C0 09                                cpy #n_regchv         ;all registers processed?
   2544 C636 D0 D4                                bne .0000010          ;no, keep going
                                        ;
   2546 C638 20 2F C8                   .0000030 jsr alert             ;excessive input
                                        ;
   2548 C63B 4C A4 C0                   .0000040 jmp monreg            ;display changes
                                        ;
   2550 C63E 4C 8E C1                   .0000050 jmp monerr            ;goto error handler
                                        ;
                                        ;================================================================================
                                        ;
                                        ;monxit: EXIT TO OPERATING ENVIRONMENT
                                        ;
                                        ;	—————————
                                        ;	syntax: X
                                        ;	—————————
                                        ;
   2560 C641 90 17                      monxit   bcc .0000020          ;no parameters allowed
                                        ;
   2562 C643 C2 20                    +            .byte $c2,$20
                                        
   2563 C645 AD 02 01                             lda vecbrki           ;BRK indirect vector
   2564 C648 C9 59                    +            cmp #<monbrk
   2564 C64A C0                       +            .byte >monbrk
                                        ;we intercept it?
   2565 C64B D0 09                                bne .0000010          ;no, don't change it
                                        ;
   2567 C64D AD 05 01                             lda vecbrkia          ;old vector
   2568 C650 8D 02 01                             sta vecbrki           ;restore it
   2569 C653 9C 05 01                             stz vecbrkia          ;invalidate old vector
                                        ;         
   2571 C656 E2 30                      .0000010 +         .byte $e2,$30
                                        
                                           		 CPU FT832
   2573 00C658 42 60                        		 RTT
                                        		 CPU	W65C02
                                        ;         jml vecexit           ;long jump to exit
                                        ;
   2577 C65A 4C 8E C1                   .0000020 jmp monerr            ;goto error handler
                                        ;
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * *                                         * *
                                        ; * * S T A R T   o f   S U B R O U T I N E S * *
                                        ; * *                                         * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ; * * * * * * * * * * * * * * * * * * * * * * * *
                                        ;
                                        ;dpycaddr: DISPLAY CURRENT ADDRESS IN COLUMNS
                                        ;
   2589 C65D A6 CE                      dpycaddr ldx xrtemp            ;column count
   2590 C65F D0 05                                bne .0000010          ;not at right side
                                        ;
   2592 C661 20 23 C8                             jsr newline           ;next row
   2593 C664 A2 08                                ldx #n_hccols         ;max columns
                                        ;
   2595 C666 E0 08                      .0000010 cpx #n_hccols         ;max columns
   2596 C668 F0 07                                beq .0000020          ;at left margin
                                        ;
   2598 C66A A9 09                                lda #a_ht
                                           		 cpu FT832
   2600 00C66C 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2603 C671 CA                         .0000020 dex                   ;one less column
   2604 C672 86 CE                                stx xrtemp            ;save column counter
   2605 C674 4C E8 C7                             jmp prntladr          ;print reference address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpycod: DISASSEMBLE & DISPLAY CODE
                                        ;
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;	This function disassembles & displays the machine code at  the  location
                                        ;	pointed to by ADDRA.  Upon return, ADDRA will point to the opcode of the
                                        ;	next instruction.   The entry point at DPYCODAA  should be called with a
                                        ;	disassembly prefix character loaded in .A.   If entered  at  DPYCOD, the
                                        ;	default character will be display at the beginning of each  disassembled
                                        ;	instruction.
                                        ;
                                        ;	The disassembly of immediate mode instructions that can take an 8 or  16
                                        ;	bit operand is affected by the bit pattern that is  stored  in  FLIMFLAG
                                        ;	upon entry to this function:
                                        ;
                                        ;	    FLIMFLAG: xx000000
                                        ;	              ||
                                        ;	              |+—————————> 0:  8 bit .X or .Y operand
                                        ;	              |            1: 16 bit .X or .Y operand
                                        ;	              +——————————> 0:  8 bit .A or BIT # operand
                                        ;	                           1: 16 bit .A or BIT # operand
                                        ;
                                        ;	FLIMFLAG is conditioned according to the operand of  the  most  recently
                                        ;	disassembled REP or SEP instruction.   Hence repetitive  calls  to  this
                                        ;	subroutine will usually result in the correct disassembly of 16 bit imm-
                                        ;	ediate mode instructions.
                                        ;	————————————————————————————————————————————————————————————————————————
                                        ;
   2636 C677 A9 2E                       public dpycod   lda #disprfx          ;default prefix
                                        ;
                                        ;
                                        ;	alternate prefix display entry point...
                                        ;
   2641 C679                            dpycodaa 
                                           		 cpu FT832
   2643 00C679 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2645 C67E 20 33 C8                             jsr printspc          ;space
   2646 C681 20 E8 C7                             jsr prntladr          ;print long address
   2647 C684 20 33 C8                             jsr printspc          ;space to opcode field
   2648 C687 20 FB CA                             jsr getbyte           ;get opcode
   2649 C68A 85 CC                                sta opcode            ;save &...
   2650 C68C 20 28 C8                             jsr printbyt          ;display as hex
                                        ;
                                        ;
                                        ;	decode menmonic & addressing info...
                                        ;
   2655 C68F A6 CC                                ldx opcode            ;current mnemonic
   2656 C691 BD D9 CD                             lda mnetabix,x        ;get mnemonic index
   2657 C694 0A                                   asl                   ;double for...
   2658 C695 A8                                   tay                   ;mnemonic table offset
   2659 C696 C2 20                    +            .byte $c2,$20
                                                         ;16 bit load
   2660 C698 B9 21 CD                             lda mnetab,y          ;copy encoded mnemonic to...
   2661 C69B 85 CA                                sta mnepck            ;working storage
   2662 C69D E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   2663 C69F 20 5D CB                             jsr instdata          ;extract mode & size data
   2664 C6A2 85 D3                                sta vopsflag          ;save mode flags
   2665 C6A4 84 C5                                sty admodidx          ;save mode index
   2666 C6A6 0A                                   asl                   ;variable immediate instruction?
   2667 C6A7 90 1F                                bcc dpycod01          ;no, effective operand size in .X
                                        ;
                                        ;
                                        ;	determine immediate mode operand size...
                                        ;
   2672 C6A9 A5 CC                                lda opcode            ;current opcode
   2673 C6AB 24 D0                                bit flimflag          ;operand display mode
   2674 C6AD 10 08                                bpl .0000010          ;8 bit .A & BIT immediate mode
                                        ;
   2676 C6AF 29 1F                                and #aimmaska         ;determine if...
   2677 C6B1 C9 09                                cmp #aimmaskb         ;.A or BIT immediate
   2678 C6B3 F0 10                                beq .0000030          ;display 16 bit operand
                                        ;
   2680 C6B5 A5 CC                                lda opcode            ;not .A or BIT immediate
                                        ;
   2682 C6B7 50 0F                      .0000010 bvc dpycod01          ;8 bit .X/.Y immediate mode
                                        ;
   2684 C6B9 A0 03                                ldy #n_vopidx-1       ;opcodes to test
                                        ;
   2686 C6BB D9 D9 CF                   .0000020 cmp vopidx,y          ;looking for LDX #, CPY #, etc.
   2687 C6BE F0 07                                beq .0000040          ;disassemble a 16 bit operand
                                        ;
   2689 C6C0 88                                   dey
   2690 C6C1 10 F8                                bpl .0000020          ;keep trying
                                        ;
   2692 C6C3 80 03                                bra dpycod01          ;not .X or .Y immediate
                                        ;
   2694 C6C5 A5 CC                      .0000030 lda opcode            ;reload
                                        ;
   2696 C6C7 E8                         .0000040 inx                   ;16 bit operand
                                        ;
                                        ;
                                        ;	get & display operand bytes...
                                        ;
   2701 C6C8 86 D1                      dpycod01 stx iopsize           ;operand size...
   2702 C6CA E8                                   inx                   ;plus opcode becomes...
   2703 C6CB 86 C8                                stx instsize          ;instruction size
   2704 C6CD 86 C6                                stx charcnt           ;total bytes to process
   2705 C6CF A9 0B                                lda #n_opcols+2       ;total operand columns plus WS
   2706 C6D1 85 CE                                sta xrtemp            ;initialize counter
   2707 C6D3 20 3C CA                             jsr clroper           ;clear operand
   2708 C6D6 A4 D1                                ldy iopsize           ;operand size
   2709 C6D8 F0 16                                beq .0000020          ;no operand
                                        ;
   2711 C6DA A2 00                                ldx #0                ;operand index
                                        ;
   2713 C6DC 20 FB CA                   .0000010 jsr getbyte           ;get operand byte
   2714 C6DF 95 BD                                sta operand,x         ;save
   2715 C6E1 DA                                   phx                   ;protect operand index
   2716 C6E2 20 28 C8                             jsr printbyt          ;print operand byte
   2717 C6E5 C6 CE                                dec xrtemp            ;3 columns used, 2 for...
   2718 C6E7 C6 CE                                dec xrtemp            ;operand nybbles &...
   2719 C6E9 C6 CE                                dec xrtemp            ;1 for whitespace
   2720 C6EB FA                                   plx                   ;get operand index
   2721 C6EC E8                                   inx                   ;bump it
   2722 C6ED 88                                   dey
   2723 C6EE D0 EC                                bne .0000010          ;next
                                        ;
   2725 C6F0 A6 CE                      .0000020 ldx xrtemp            ;operand columns remaining
   2726 C6F2 20 14 C8                             jsr multspc           ;space to mnemonic field
                                        ;
                                        ;
                                        ;	display mnemonic...
                                        ;
   2731 C6F5 A0 03                                ldy #s_mnemon         ;size of ASCII mnemonic
                                        ;
   2733 C6F7 A9 00                      .0000030 lda #0                ;initialize char
   2734 C6F9 A2 05                                ldx #n_shfenc         ;shifts to execute
                                        ;
   2736 C6FB 06 CA                      .0000040 asl mnepck            ;shift encoded mnemonic
   2737 C6FD 26 CB                                rol mnepck+s_byte
   2738 C6FF 2A                                   rol
   2739 C700 CA                                   dex
   2740 C701 D0 F8                                bne .0000040
                                        ;
   2742 C703 69 3F                                adc #a_mnecvt         ;convert to ASCII &...
   2743 C705 48                                   pha                   ;stash
   2744 C706 88                                   dey
   2745 C707 D0 EE                                bne .0000030          ;continue with mnemonic
                                        ;
   2747 C709 A0 03                                ldy #s_mnemon
                                        ;
   2749 C70B 68                         .0000050 pla                   ;get mnenmonic byte
                                           		 cpu FT832
   2751 00C70C 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2753 C711 88                                   dey
   2754 C712 D0 F7                                bne .0000050
                                        ;
                                        ;
                                        ;	display operand...
                                        ;
   2759 C714 A5 D1                                lda iopsize           ;operand size
   2760 C716 F0 73                                beq clearlin          ;zero, disassembly finished
                                        ;
   2762 C718 20 33 C8                             jsr printspc          ;space to operand field
   2763 C71B 24 D3                                bit vopsflag          ;check mode flags
   2764 C71D 50 08                                bvc dpycod02          ;not a branch
                                        ;
   2766 C71F 20 73 CB                             jsr offtarg           ;compute branch target
   2767 C722 A6 C8                                ldx instsize          ;effective instruction size
   2768 C724 CA                                   dex
   2769 C725 86 D1                                stx iopsize           ;effective operand size
                                        ;
   2771 C727 64 D3                      dpycod02 stz vopsflag          ;clear
   2772 C729 A5 C5                                lda admodidx          ;instruction addressing mode
   2773 C72B C9 0B                                cmp #am_move          ;block move instruction?
   2774 C72D D0 02                                bne .0000010          ;no
                                        ;
   2776 C72F 66 D3                                ror vopsflag          ;yes
                                        ;
   2778 C731 0A                         .0000010 asl                   ;convert addressing mode to...
   2779 C732 AA                                   tax                   ;symbology table index
   2780 C733 C2 20                    +            .byte $c2,$20
                                                         ;do a 16 bit load
   2781 C735 BD DD CF                             lda ms_lutab,x        ;addressing symbol pointer
   2782 C738 48                                   pha
   2783 C739 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bit loads
   2784 C73B A0 00                                ldy #0
   2785 C73D B3 01                    +            .byte $b3,1
                                        ;get 1st char
   2786 C73F C9 20                                cmp #a_blank
   2787 C741 F0 05                                beq .0000020          ;no addresing mode preamble
                                        ;
                                           		 cpu FT832
   2790 00C743 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
                                        ;
   2793 C748 A9 24                      .0000020 lda #c_hex
                                           		 cpu FT832
   2795 00C74A 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2797 C74F A4 D1                                ldy iopsize           ;operand size = index
                                        ;
   2799 C751 88                         .0000030 dey
   2800 C752 30 16                                bmi .0000040          ;done with operand
                                        ;
   2802 C754 B9 BD 00                             lda operand,y         ;get operand byte
   2803 C757 20 05 C8                             jsr dpyhex            ;print operand byte
   2804 C75A 24 D3                                bit vopsflag          ;block move?
   2805 C75C 10 F3                                bpl .0000030          ;no
                                        ;
   2807 C75E 64 D3                                stz vopsflag          ;reset
   2808 C760 5A                                   phy                   ;protect operand index
   2809 C761 F4                       +            .byte $f4
   2809 C762 16 D0                    +            .word ms_move
                                        
   2810 C764 20 3B C8                             jsr sprint            ;display MVN/MVP operand separator
   2811 C767 7A                                   ply                   ;recover operand index again
   2812 C768 80 E7                                bra .0000030          ;continue
                                        ;
   2814 C76A FA                         .0000040 plx                   ;symbology LSB
   2815 C76B 7A                                   ply                   ;symbology MSB
   2816 C76C E8                                   inx                   ;move past preamble
   2817 C76D D0 01                                bne .0000050
                                        ;
   2819 C76F C8                                   iny
                                        ;
   2821 C770 5A                         .0000050 phy
   2822 C771 DA                                   phx
   2823 C772 20 3B C8                             jsr sprint            ;print postamble, if any
                                        ;
                                        ;
                                        ;	condition immediate mode display format...
                                        ;
   2828 C775 A5 BD                      dpycod03 lda operand           ;operand LSB
   2829 C777 29 30                                and #pfmxmask         ;isolate M & X bits
   2830 C779 0A                                   asl                   ;shift to match...
   2831 C77A 0A                                   asl                   ;FLIMFLAG alignment
   2832 C77B A6 CC                                ldx opcode            ;current instruction
   2833 C77D E0 C2                                cpx #opc_rep          ;was it REP?
   2834 C77F D0 04                                bne .0000010          ;no
                                        ;
   2836 C781 04 D0                                tsb flimflag          ;set flag bits as required
   2837 C783 80 06                                bra clearlin
                                        ;
   2839 C785 E0 E2                      .0000010 cpx #opc_sep          ;was it SEP?
   2840 C787 D0 02                                bne clearlin          ;no, just exit
                                        ;
   2842 C789 14 D0                                trb flimflag          ;clear flag bits as required
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clearlin: CLEAR DISPLAY LINE
                                        ;
   2848 C78B F4                         clearlin +         .byte $f4
   2848 C78C 2E D0                    +            .word dc_cl
                                        
   2849 C78E 80 4F                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyibuf: DISPLAY MONITOR INPUT BUFFER CONTENTS
                                        ;
   2855 C790 F4                         dpyibuf +         .byte $f4
   2855 C791 00 02                    +            .word ibuffer
                                        
   2856 C793 80 4A                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpymem: DISPLAY MEMORY
                                        ;
                                        ;	————————————————————————————————————————————————————————————
                                        ;	This function displays 16 bytes of memory as hex values & as
                                        ;	ASCII equivalents.  The starting address for the display is
                                        ;	in ADDRA & is expected to be a 24 bit address.  Upon return,
                                        ;	ADDRA will point to the start of the next 16 bytes.
                                        ;	————————————————————————————————————————————————————————————
                                        ;
   2869 C795 E2 30                      dpymem +         .byte $e2,$30
                                        
   2870 C797 64 C6                                stz charcnt           ;reset
   2871 C799 A9 3E                                lda #memprfx
                                           		 cpu FT832
   2873 00C79B 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2875 C7A0 20 E8 C7                             jsr prntladr          ;print 24 bit address
   2876 C7A3 A2 00                                ldx #0                ;string buffer index
   2877 C7A5 A0 08                                ldy #n_dump           ;bytes per line
                                        ;
   2879 C7A7 20 FB CA                   .0000010 jsr getbyte           ;get from RAM, also...
   2880 C7AA 48                                   pha                   ;save for decoding
   2881 C7AB DA                                   phx                   ;save string index
   2882 C7AC 20 28 C8                             jsr printbyt          ;display as hex ASCII
   2883 C7AF E6 C6                                inc charcnt           ;bytes displayed +1
   2884 C7B1 FA                                   plx                   ;recover string index &...
   2885 C7B2 68                                   pla                   ;byte
   2886 C7B3 C9 20                                cmp #a_blank          ;printable?
   2887 C7B5 90 04                                bcc .0000020          ;no
                                        ;
   2889 C7B7 C9 7F                                cmp #a_del
   2890 C7B9 90 02                                bcc .0000030          ;is printable
                                        ;
   2892 C7BB A9 2E                      .0000020 lda #memsubch         ;substitute character
                                        ;
   2894 C7BD 9D 00 02                   .0000030 sta ibuffer,x         ;save char
   2895 C7C0 E8                                   inx                   ;bump index
   2896 C7C1 88                                   dey                   ;byte count -= 1
   2897 C7C2 D0 E3                                bne .0000010          ;not done
                                        ;
   2899 C7C4 9E 00 02                             stz ibuffer,x         ;terminate ASCII string
   2900 C7C7 A9 3A                                lda #memsepch
                                           		 cpu FT832
   2902 00C7C9 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2904 C7CE F4                       +            .byte $f4
   2904 C7CF 24 D0                    +            .word dc_bf
                                        
   2905 C7D1 20 3B C8                             jsr sprint            ;select reverse video
   2906 C7D4 20 90 C7                             jsr dpyibuf           ;display ASCII equivalents
   2907 C7D7 F4                       +            .byte $f4
   2907 C7D8 39 D0                    +            .word dc_er
                                        ;normal video
   2908 C7DA 80 03                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyerr: DISPLAY ERROR SIGNAL
                                        ;
   2914 C7DC F4                         dpyerr +         .byte $f4
   2914 C7DD 66 D0                    +            .word mm_err
                                        ;"*ERR"
                                        ;
   2916 C7DF 20 3B C8                   dpyerraa jsr sprint
   2917 C7E2 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;gendbs: GENERATE DESTRUCTIVE BACKSPACE
                                        ;
   2923 C7E3 F4                         gendbs +         .byte $f4
   2923 C7E4 2A D0                    +            .word dc_bs
                                        ;destructive backspace
   2924 C7E6 80 F7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;prntladr: PRINT 24 BIT CURRENT ADDRESS
                                        ;
   2930 C7E8 08                         prntladr php                   ;protect register sizes
   2931 C7E9 E2 20                    +            .byte $e2,$20
                                        
   2932 C7EB A5 A4                                lda addra+s_word      ;get bank byte &...
   2933 C7ED 20 05 C8                             jsr dpyhex            ;display it
   2934 C7F0 C2 20                    +            .byte $c2,$20
                                        
   2935 C7F2 A5 A2                                lda addra             ;get 16 bit address
   2936 C7F4 28                                   plp                   ;restore register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhexw: DISPLAY BINARY WORD AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .C: word to display
                                        ;
                                        ;	Returned Values: .C: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   2950 C7F5 08                         dpyhexw  php                   ;save register sizes
   2951 C7F6 C2 20                    +            .byte $c2,$20
                                        
   2952 C7F8 48                                   pha                   ;protect value
   2953 C7F9 E2 20                    +            .byte $e2,$20
                                        
   2954 C7FB EB                       +            .byte $eb
                                                           ;get MSB &...
   2955 C7FC 20 05 C8                             jsr dpyhex            ;display
   2956 C7FF C2 20                    +            .byte $c2,$20
                                        
   2957 C801 68                                   pla                   ;recover value
   2958 C802 E2 20                    +            .byte $e2,$20
                                                        ;only LSB visible
   2959 C804 28                                   plp                   ;reset register sizes
                                        ;
                                        ;================================================================================
                                        ;
                                        ;dpyhex: DISPLAY BINARY BYTE AS HEX ASCII
                                        ;
                                        ;	————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to display
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————
                                        ;
   2973 C805 20 A8 C9                   dpyhex   jsr binhex            ;convert to hex ASCII
                                           		 cpu FT832
   2975 00C808 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2977 C80D 8A                                   txa
                                           		 cpu FT832
   2979 00C80E 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   2981 C813 60                          		 rts
                                                 ;jmp putcha            ;print LSN
                                        ;
                                        ;================================================================================
                                        ;
                                        ;multspc: PRINT MULTIPLE BLANKS
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .X: number of blanks to print
                                        ;
                                        ;	Register Returns: none
                                        ;
                                        ;	Calling Example : ldx #3
                                        ;	                  jsr multspc    ;print 3 spaces
                                        ;
                                        ;	Notes: This sub will print 1 blank if .X=0.
                                        ;	————————————————————————————————————————————————
                                        ;
   2999 C814 8A                         multspc  txa
   3000 C815 D0 01                                bne .0000010          ;blank count specified
                                        ;
   3002 C817 E8                                   inx                   ;default to 1 blank
                                        ;
   3004 C818 A9 20                      .0000010 lda #a_blank
                                        ;
   3006 C81A                            .0000020 
                                           		 cpu FT832
   3008 00C81A 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3010 C81F CA                                   dex
   3011 C820 D0 F8                                bne .0000020
                                        ;
   3013 C822 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;newline: PRINT NEWLINE (CRLF)
                                        ;
   3019 C823 F4                         newline +         .byte $f4
   3019 C824 3F D0                    +            .word dc_lf
                                        
   3020 C826 80 B7                                bra dpyerraa
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printbyt: PRINT A BYTE WITH LEADING SPACE
                                        ;
   3026 C828 48                         printbyt pha                   ;protect byte
   3027 C829 20 33 C8                             jsr printspc          ;print leading space
   3028 C82C 68                                   pla                   ;restore &...
   3029 C82D 80 D6                                bra dpyhex            ;print byte
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;alert: ALERT USER w/TERMINAL BELL
                                        ;
   3035 C82F A9 07                      alert    lda #a_bel
   3036 C831 80 02                                bra printcmn
                                        ;
                                        ;================================================================================
                                        ;
                                        ;printspc: PRINT A SPACE
                                        ;
   3042 C833 A9 20                      printspc lda #a_blank
                                        ;
   3044 C835                            printcmn 
                                           		 cpu FT832
   3046 00C835 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3048 C83A 60                          		 rts
                                        ;jmp putcha
                                        ;
                                        ;================================================================================
                                        ;
                                        ;sprint: PRINT NULL-TERMINATED CHARACTER STRING
                                        ;
                                        ;	—————————————————————————————————————————————————————————
                                        ;	Preparatory Ops : SP+1: string address LSB
                                        ;	                  SP+2: string address MSB
                                        ;
                                        ;	Register Returns: .A: used
                                        ;	                  .B: entry value
                                        ;	                  .X: used
                                        ;	                  .Y: used
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: okay
                                        ;	           |||||||      1: string too long (1)
                                        ;	           ||||+++————> not defined
                                        ;	           |||+———————> 1
                                        ;	           ||+————————> 1
                                        ;	           ++—————————> not defined
                                        ;
                                        ;	Example: PER STRING
                                        ;	         JSR SPRINT
                                        ;	         BCS TOOLONG
                                        ;
                                        ;	Notes: 1) Maximum permissible string length including the
                                        ;	          terminator is 32,767 bytes.
                                        ;	       2) All registers are forced to 8 bits.
                                        ;	       3) DO NOT JUMP OR BRANCH INTO THIS FUNCTION!
                                        ;	—————————————————————————————————————————————————————————
                                        ;
   3083 C83B E2 20                      sprint +         .byte $e2,$20
                                                        ;8 bit accumulator
   3084 C83D C2 10                    +            .byte $c2,$10
                                                         ;16 bit index
                                        ;
                                        ;—————————————————————————————————————————————————————————
   3236 = 0000000000000001                            .reetaddr =1                    ;return address
                                        
   3238 = 00000003                      .src     =.reetaddr+s_word      ;string address stack offset
                                        
                                        ;—————————————————————————————————————————————————————————
                                        ;
   3093 C83F A0 00                    +            ldy #<0
   3093 C841 00                       +            .byte >0
                                        
   3094 C842 18                                   clc                   ;no initial error
                                        ;
   3096 C843 B3 03                      .0000010 +         .byte $b3,.src
                                        ;get a byte
   3097 C845 F0 09                                beq .0000020          ;done
                                        ;
                                           		 cpu FT832
   3100 00C847 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   3102 C84C C8                                   iny
   3103 C84D 10 F4                                bpl .0000010          ;next
                                        ;
   3105 C84F 38                                   sec                   ;string too long
                                        ;
   3107 C850 FA                         .0000020 plx                   ;pull RTS address
   3108 C851 7A                                   ply                   ;clear string pointer
   3109 C852 DA                                   phx                   ;replace RTS
   3110 C853 E2 10                    +            .byte $e2,$10
                                        
   3111 C855 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ascbin: CONVERT NULL-TERMINATED ASCII NUMBER STRING TO BINARY
                                        ;
                                        ;	———————————————————————————————————————————————————
                                        ;	Preparatory Ops: ASCII number string in IBUFFER
                                        ;
                                        ;	Returned Values: FACA: converted parameter
                                        ;	                   .A: used
                                        ;	                   .X: used
                                        ;	                   .Y: used
                                        ;	                   .C: 1 = conversion error
                                        ;	                   .Z: 1 = nothing to convert
                                        ;
                                        ;	Notes: 1) Conversion stops when a non-numeric char-
                                        ;	          acter is encountered.
                                        ;	       2) Radix symbols are as follows:
                                        ;
                                        ;	          % binary
                                        ;	          @ octal
                                        ;	          + decimal
                                        ;	          $ hexadecimal
                                        ;
                                        ;	          Hex is the default if no radix is speci-
                                        ;	          fied in the 1st character of the string.
                                        ;	———————————————————————————————————————————————————
                                        ;
   3140 C856 E2 30                      ascbin +         .byte $e2,$30
                                        
   3141 C858 20 BB C9                             jsr clrfaca           ;clear accumulator
   3142 C85B 64 C6                                stz charcnt           ;zero char count
   3143 C85D 64 C4                                stz radix             ;initialize
                                        ;
                                        ;
                                        ;	process radix if present...
                                        ;
   3148 C85F 20 4E CC                             jsr getcharw          ;get next non-WS char
   3149 C862 D0 02                                bne .0000010          ;got something
                                        ;
   3151 C864 18                                   clc                   ;no more input
   3152 C865 60                                   rts
                                        ;
   3154 C866 A2 03                      .0000010 ldx #n_radix-1        ;number of radices
                                        ;
   3156 C868 DD 14 CD                   .0000020 cmp radxtab,x         ;recognized radix?
   3157 C86B F0 06                                beq .0000030          ;yes
                                        ;
   3159 C86D CA                                   dex
   3160 C86E 10 F8                                bpl .0000020          ;try next
                                        ;
   3162 C870 C6 C1                                dec ibufidx           ;reposition to previous char
   3163 C872 E8                                   inx                   ;not recognized, assume hex
                                        ;
   3165 C873 C9 2B                      .0000030 cmp #c_dec            ;decimal radix?
   3166 C875 D0 02                                bne .0000040          ;not decimal
                                        ;
   3168 C877 66 C4                                ror radix             ;flag decimal conversion
                                        ;
   3170 C879 BD 00 CD                   .0000040 lda basetab,x         ;number bases table
   3171 C87C 85 D2                                sta range             ;set valid numeral range
   3172 C87E BD 04 CD                             lda bitsdtab,x        ;get bits per digit
   3173 C881 85 C2                                sta bitsdig           ;store
                                        ;
                                        ;
                                        ;	process numerals...
                                        ;
   3178 C883 20 F0 CB                   ascbin01 jsr getchar           ;get next char
   3179 C886 F0 70                                beq ascbin03          ;EOI
                                        ;
   3181 C888 C9 20                                cmp #' '
   3182 C88A F0 6C                                beq ascbin03          ;blank — EOF
                                        ;
   3184 C88C C9 2C                                cmp #','
   3185 C88E F0 68                                beq ascbin03          ;comma — EOF
                                        ;
   3187 C890 C9 09                                cmp #a_ht
   3188 C892 F0 64                                beq ascbin03          ;tab — EOF
                                        ;
   3190 C894 20 15 CA                             jsr nybtobin          ;change to binary
   3191 C897 B0 60                                bcs ascbin04          ;not a recognized numeral
                                        ;
   3193 C899 C5 D2                                cmp range             ;check range
   3194 C89B B0 5C                                bcs ascbin04          ;not valid for base
                                        ;
   3196 C89D 85 C3                                sta numeral           ;save processed numeral
   3197 C89F E6 C6                                inc charcnt           ;bump numeral count
   3198 C8A1 24 C4                                bit radix             ;working in base 10?
   3199 C8A3 10 15                                bpl .0000030          ;no
                                        ;
                                        ;
                                        ;	compute N*2 for decimal conversion...
                                        ;
   3204 C8A5 A2 00                                ldx #0                ;accumulator index
   3205 C8A7 A0 02                                ldy #s_pfac/2         ;iterations
   3206 C8A9 C2 20                    +            .byte $c2,$20
                                        
   3207 C8AB 18                                   clc
                                        ;
   3209 C8AC B5 A9                      .0000020 lda faca,x            ;N
   3210 C8AE 2A                                   rol                   ;N=N*2
   3211 C8AF 95 B1                                sta facb,x
   3212 C8B1 E8                                   inx
   3213 C8B2 E8                                   inx
   3214 C8B3 88                                   dey
   3215 C8B4 D0 F6                                bne .0000020
                                        ;
   3217 C8B6 B0 41                                bcs ascbin04          ;overflow — error
                                        ;
   3219 C8B8 E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	compute N*base for binary, octal or hex...
                                        ;	or N*8 for decimal...
                                        ;
   3225 C8BA A6 C2                      .0000030 ldx bitsdig           ;bits per digit
   3226 C8BC C2 20                    +            .byte $c2,$20
                                                         ;16 bit shifts
                                        ;
   3228 C8BE 06 A9                      .0000040 asl faca
   3229 C8C0 26 AB                                rol faca+s_word
   3230 C8C2 B0 35                                bcs ascbin04          ;overflow — error
                                        ;
   3232 C8C4 CA                                   dex
   3233 C8C5 D0 F7                                bne .0000040          ;next shift
                                        ;
   3235 C8C7 E2 20                    +            .byte $e2,$20
                                                        ;back to 8 bits
   3236 C8C9 24 C4                                bit radix             ;check base
   3237 C8CB 10 13                                bpl ascbin02          ;not decimal
                                        ;
                                        ;
                                        ;	compute N*10 for decimal (N*8 + N*2)...
                                        ;
   3242 C8CD A0 04                                ldy #s_pfac
   3243 C8CF C2 20                    +            .byte $c2,$20
                                        
                                        ;
   3245 C8D1 B5 A9                      .0000050 lda faca,x            ;N*8
   3246 C8D3 75 B1                                adc facb,x            ;N*2
   3247 C8D5 95 A9                                sta faca,x            ;now N*10
   3248 C8D7 E8                                   inx
   3249 C8D8 E8                                   inx
   3250 C8D9 88                                   dey
   3251 C8DA D0 F5                                bne .0000050
                                        ;
   3253 C8DC B0 1B                                bcs ascbin04          ;overflow — error
                                        ;
   3255 C8DE E2 20                    +            .byte $e2,$20
                                        
                                        ;
                                        ;
                                        ;	add current numeral to partial result...
                                        ;
   3260 C8E0 A5 A9                      ascbin02 lda faca              ;N
   3261 C8E2 65 C3                                adc numeral           ;N=N+D
   3262 C8E4 85 A9                                sta faca
   3263 C8E6 A2 01                                ldx #1
   3264 C8E8 A0 03                                ldy #s_pfac-1
                                        ;
   3266 C8EA B5 A9                      .0000010 lda faca,x
   3267 C8EC 69 00                                adc #0                ;account for carry
   3268 C8EE 95 A9                                sta faca,x
   3269 C8F0 E8                                   inx
   3270 C8F1 88                                   dey
   3271 C8F2 D0 F6                                bne .0000010
                                        ;
   3273 C8F4 90 8D                                bcc ascbin01          ;next if no overflow
                                        ;
   3275 C8F6 B0 01                                bcs ascbin04          ;overflow — error
                                        ;
                                        ;
                                        ;	finish up...
                                        ;
   3280 C8F8 18                         ascbin03 clc                   ;no error
                                        ;
   3282 C8F9 E2 20                      ascbin04 +         .byte $e2,$20
                                                        ;reset if necessary
   3283 C8FB A5 C6                                lda charcnt           ;load char count
   3284 C8FD 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bcdasc: CONVERT BCD DIGIT TO ASCII
                                        ;
                                        ;	———————————————————————————————————————
                                        ;	Preparatory Ops: .A: BCD digit, $00-$99
                                        ;
                                        ;	Returned Values: .A: ASCII MSD
                                        ;	                 .X: ASCII LSD
                                        ;	                 .Y: entry value
                                        ;	———————————————————————————————————————
                                        ;
   3298 C8FE 20 0A C9                   bcdasc   jsr bintonyb          ;extract nybbles
   3299 C901 48                                   pha                   ;save tens
   3300 C902 8A                                   txa                 
   3301 C903 09 30                                ora #btoamask         ;change units to ASCII
   3302 C905 AA                                   tax                   ;store
   3303 C906 68                                   pla                   ;get tens
   3304 C907 09 30                                ora #btoamask         ;change to ASCII
   3305 C909 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;bintonyb: EXTRACT BINARY NYBBLES
                                        ;
                                        ;	—————————————————————————————————
                                        ;	Preparatory Ops: .A: binary value
                                        ;
                                        ;	Returned Values: .A: MSN
                                        ;	                 .X: LSN
                                        ;	                 .Y: entry value
                                        ;	—————————————————————————————————
                                        ;
   3319 C90A 48                         bintonyb pha                   ;save
   3320 C90B 29 0F                                and #bcdumask         ;extract LSN
   3321 C90D AA                                   tax                   ;save it
   3322 C90E 68                                   pla
                                        ;         .rept s_bnybbl        ;extract MSN
   3324 C90F 4A                                     lsr
   3325 C910 4A                                     lsr
   3326 C911 4A                                     lsr
   3327 C912 4A                                     lsr
                                        ;         .endr
   3329 C913 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binasc: CONVERT 32-BIT BINARY TO NULL-TERMINATED ASCII NUMBER STRING
                                        ;
                                        ;	——————————————————————————————————————————————————————
                                        ;	Preparatory Ops: FACA: 32-bit operand
                                        ;	                   .A: radix character, w/bit 7 set to
                                        ;	                       suppress radix symbol in the
                                        ;	                       conversion string
                                        ;
                                        ;	Returned Values: ibuffer: conversion string
                                        ;	                      .A: string length
                                        ;	                      .X: string address LSB
                                        ;	                      .Y: string address MSB
                                        ;
                                        ;	Execution Notes: ibufidx & instsize are overwritten.
                                        ;	——————————————————————————————————————————————————————
                                        ;
   3349 C914 64 C1                      binasc   stz ibufidx           ;initialize string index
   3350 C916 64 C8                                stz instsize          ;clear format flag
                                        ;
                                        ;
                                        ;	evaluate radix...
                                        ;
   3355 C918 0A                                   asl                   ;extract format flag &...
   3356 C919 66 C8                                ror instsize          ;save it
   3357 C91B 4A                                   lsr                   ;extract radix character
   3358 C91C A2 03                                ldx #n_radix-1        ;total radices
                                        ;
   3360 C91E DD 14 CD                   .0000010 cmp radxtab,x         ;recognized radix?
   3361 C921 F0 04                                beq .0000020          ;yes
                                        ;
   3363 C923 CA                                   dex
   3364 C924 10 F8                                bpl .0000010          ;try next
                                        ;
   3366 C926 E8                                   inx                   ;assume hex
                                        ;
   3368 C927 86 C4                      .0000020 stx radix             ;save radix index for later
   3369 C929 24 C8                                bit instsize
   3370 C92B 30 08                                bmi .0000030          ;no radix symbol wanted
                                        ;
   3372 C92D BD 14 CD                             lda radxtab,x         ;radix table
   3373 C930 8D 00 02                             sta ibuffer           ;prepend to string
   3374 C933 E6 C1                                inc ibufidx           ;bump string index
                                        ;
   3376 C935 C9 2B                      .0000030 cmp #c_dec            ;converting to decimal?
   3377 C937 D0 07                                bne .0000040          ;no
                                        ;
   3379 C939 20 CD C9                             jsr facabcd           ;convert operand to BCD
   3380 C93C A9 00                                lda #0
   3381 C93E 80 17                                bra .0000070          ;skip binary stuff
                                        ;
                                        ;
                                        ;	prepare for binary, octal or hex conversion...
                                        ;
   3386 C940 A2 00                      .0000040 ldx #0                ;operand index
   3387 C942 A0 05                                ldy #s_sfac-1         ;workspace index
                                        ;
   3389 C944 B5 A9                      .0000050 lda faca,x            ;copy operand to...
   3390 C946 99 B1 00                             sta facb,y            ;workspace in...
   3391 C949 88                                   dey                   ;big-endian order
   3392 C94A E8                                   inx
   3393 C94B E0 04                                cpx #s_pfac
   3394 C94D D0 F5                                bne .0000050
                                        ;
   3396 C94F A9 00                                lda #0
   3397 C951 BB                       +            .byte $bb
                                        
                                        ;
   3399 C952 95 B1                      .0000060 sta facb,x            ;pad workspace
   3400 C954 CA                                   dex
   3401 C955 10 FB                                bpl .0000060
                                        ;
                                        ;
                                        ;	set up conversion parameters...
                                        ;
   3406 C957 85 B7                      .0000070 sta facc              ;initialize byte counter
   3407 C959 A4 C4                                ldy radix             ;radix index
   3408 C95B B9 10 CD                             lda numstab,y         ;numerals in string
   3409 C95E 85 B8                                sta facc+s_byte       ;set remaining numeral count
   3410 C960 B9 08 CD                             lda bitsntab,y        ;bits per numeral
   3411 C963 85 B9                                sta facc+s_word       ;set
   3412 C965 B9 0C CD                             lda lzsttab,y         ;leading zero threshold
   3413 C968 85 BA                                sta facc+s_xword      ;set
                                        ;
                                        ;
                                        ;	generate conversion string...
                                        ;
   3418 C96A A9 00                      .0000080 lda #0
   3419 C96C A4 B9                                ldy facc+s_word       ;bits per numeral
                                        ;
   3421 C96E A2 05                      .0000090 ldx #s_sfac-1         ;workspace size
   3422 C970 18                                   clc                   ;avoid starting carry
                                        ;
   3424 C971 36 B1                      .0000100 rol facb,x            ;shift out a bit...
   3425 C973 CA                                   dex                   ;from the operand or...
   3426 C974 10 FB                                bpl .0000100          ;BCD conversion result
                                        ;
   3428 C976 2A                                   rol                   ;bit to .A
   3429 C977 88                                   dey
   3430 C978 D0 F4                                bne .0000090          ;more bits to grab
                                        ;
   3432 C97A A8                                   tay                   ;if numeral isn't zero...
   3433 C97B D0 0A                                bne .0000110          ;skip leading zero tests
                                        ;
   3435 C97D A6 B8                                ldx facc+s_byte       ;remaining numerals
   3436 C97F E4 BA                                cpx facc+s_xword      ;leading zero threshold
   3437 C981 90 04                                bcc .0000110          ;below it, must convert
                                        ;
   3439 C983 A6 B7                                ldx facc              ;processed byte count
   3440 C985 F0 11                                beq .0000130          ;discard leading zero
                                        ;
   3442 C987 C9 0A                      .0000110 cmp #10               ;check range
   3443 C989 90 02                                bcc .0000120          ;is 0-9
                                        ;
   3445 C98B 69 06                                adc #a_hexdec         ;apply hex adjust
                                        ;
   3447 C98D 69 30                      .0000120 adc #'0'              ;change to ASCII
   3448 C98F A4 C1                                ldy ibufidx           ;string index
   3449 C991 99 00 02                             sta ibuffer,y         ;save numeral in buffer
   3450 C994 E6 C1                                inc ibufidx           ;next buffer position
   3451 C996 E6 B7                                inc facc              ;bytes=bytes+1
                                        ;
   3453 C998 C6 B8                      .0000130 dec facc+s_byte       ;numerals=numerals-1
   3454 C99A D0 CE                                bne .0000080          ;not done
                                        ;
                                        ;
                                        ;	terminate string & exit...
                                        ;
   3459 C99C A6 C1                                ldx ibufidx           ;printable string length
   3460 C99E 9E 00 02                             stz ibuffer,x         ;terminate string
   3461 C9A1 8A                                   txa
   3462 C9A2 A2 00                                ldx #<ibuffer         ;converted string
   3463 C9A4 A0 02                                ldy #>ibuffer
   3464 C9A6 18                                   clc                   ;all okay
   3465 C9A7 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;binhex: CONVERT BINARY BYTE TO HEX ASCII CHARS
                                        ;
                                        ;	————————————————————————————————————————————
                                        ;	Preparatory Ops: .A: byte to convert
                                        ;
                                        ;	Returned Values: .A: MSN ASCII char
                                        ;	                 .X: LSN ASCII char
                                        ;	                 .Y: entry value
                                        ;	————————————————————————————————————————————
                                        ;
   3479 C9A8 20 0A C9                   binhex   jsr bintonyb          ;generate binary values
   3480 C9AB 48                                   pha                   ;save MSN
   3481 C9AC 8A                                   txa
   3482 C9AD 20 B2 C9                             jsr .0000010          ;generate ASCII LSN
   3483 C9B0 AA                                   tax                   ;save
   3484 C9B1 68                                   pla                   ;get input
                                        ;
                                        ;
                                        ;	convert nybble to hex ASCII equivalent...
                                        ;
   3489 C9B2 C9 0A                      .0000010 cmp #10
   3490 C9B4 90 02                                bcc .0000020          ;in decimal range
                                        ;
   3492 C9B6 69 66                                adc #k_hex            ;hex compensate
                                        ;         
   3494 C9B8 49 30                      .0000020 eor #'0'              ;finalize nybble
   3495 C9BA 60                                   rts                   ;done
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfaca: CLEAR FLOATING ACCUMULATOR A
                                        ;
   3501 C9BB 08                         clrfaca  php
   3502 C9BC C2 20                    +            .byte $c2,$20
                                        
   3503 C9BE 64 A9                                stz faca
   3504 C9C0 64 AB                                stz faca+s_word
   3505 C9C2 28                                   plp
   3506 C9C3 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clrfacb: CLEAR FLOATING ACCUMULATOR B
                                        ;
   3512 C9C4 08                         clrfacb  php
   3513 C9C5 C2 20                    +            .byte $c2,$20
                                        
   3514 C9C7 64 B1                                stz facb
   3515 C9C9 64 B3                                stz facb+s_word
   3516 C9CB 28                                   plp
   3517 C9CC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facabcd: CONVERT FACA INTO BCD
                                        ;
   3523 C9CD A2 03                      facabcd  ldx #s_pfac-1         ;primary accumulator size -1
                                        ;
   3525 C9CF B5 A9                      .0000010 lda faca,x            ;value to be converted
   3526 C9D1 48                                   pha                   ;preserve
   3527 C9D2 CA                                   dex
   3528 C9D3 10 FA                                bpl .0000010          ;next
                                        ;
   3530 C9D5 A2 05                                ldx #s_sfac-1         ;workspace size
                                        ;
   3532 C9D7 74 B1                      .0000020 stz facb,x            ;clear final result
   3533 C9D9 74 B7                                stz facc,x            ;clear scratchpad
   3534 C9DB CA                                   dex
   3535 C9DC 10 F9                                bpl .0000020
                                        ;
   3537 C9DE E6 BC                                inc facc+s_sfac-s_byte
   3538 C9E0 F8                                   sed                   ;select decimal mode
   3539 C9E1 A0 1F                                ldy #m_bits-1         ;bits to convert -1
                                        ;
   3541 C9E3 A2 03                      .0000030 ldx #s_pfac-1         ;operand size
   3542 C9E5 18                                   clc                   ;no carry at start
                                        ;
   3544 C9E6 76 A9                      .0000040 ror faca,x            ;grab LS bit in operand
   3545 C9E8 CA                                   dex
   3546 C9E9 10 FB                                bpl .0000040
                                        ;
   3548 C9EB 90 0D                                bcc .0000060          ;LS bit clear
                                        ;
   3550 C9ED 18                                   clc
   3551 C9EE A2 05                                ldx #s_sfac-1
                                        ;
   3553 C9F0 B5 B1                      .0000050 lda facb,x            ;partial result
   3554 C9F2 75 B7                                adc facc,x            ;scratchpad
   3555 C9F4 95 B1                                sta facb,x            ;new partial result
   3556 C9F6 CA                                   dex
   3557 C9F7 10 F7                                bpl .0000050
                                        ;
   3559 C9F9 18                                   clc
                                        ;
   3561 C9FA A2 05                      .0000060 ldx #s_sfac-1
                                        ;
   3563 C9FC B5 B7                      .0000070 lda facc,x            ;scratchpad
   3564 C9FE 75 B7                                adc facc,x            ;double &...
   3565 CA00 95 B7                                sta facc,x            ;save
   3566 CA02 CA                                   dex
   3567 CA03 10 F7                                bpl .0000070
                                        ;
   3569 CA05 88                                   dey
   3570 CA06 10 DB                                bpl .0000030          ;next operand bit
                                        ;
   3572 CA08 D8                                   cld
   3573 CA09 A2 00                                ldx #0
   3574 CA0B A0 04                                ldy #s_pfac
                                        ;
   3576 CA0D 68                         .0000080 pla                   ;operand
   3577 CA0E 95 A9                                sta faca,x            ;restore
   3578 CA10 E8                                   inx
   3579 CA11 88                                   dey
   3580 CA12 D0 F9                                bne .0000080          ;next
                                        ;
   3582 CA14 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nybtobin: CONVERT ASCII NYBBLE TO BINARY
                                        ;
   3588 CA15 20 C4 CC                   nybtobin jsr toupper           ;convert case if necessary
   3589 CA18 38                                   sec
   3590 CA19 E9 30                                sbc #'0'              ;change to binary
   3591 CA1B 90 08                                bcc .0000020          ;not a numeral — error
                                        ;
   3593 CA1D C9 0A                                cmp #10
   3594 CA1F 90 03                                bcc .0000010          ;numeral is 0-9
                                        ;
   3596 CA21 E9 07                                sbc #a_hexdec+1       ;10-15 ——> A-F
   3597 CA23 18                                   clc                   ;no conversion error
                                        ;
   3599 CA24 60                         .0000010 rts
                                        ;
   3601 CA25 38                         .0000020 sec                   ;conversion error
   3602 CA26 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;calccnt: COMPUTE BYTE COUNT FROM ADDRESS RANGE
                                        ;
   3608 CA27 20 C4 C9                   calccnt  jsr clrfacb           ;clear accumulator
   3609 CA2A C2 20                    +            .byte $c2,$20
                                        
   3610 CA2C 38                                   sec
   3611 CA2D A5 A6                                lda addrb             ;ending address
   3612 CA2F E5 A2                                sbc addra             ;starting address
   3613 CA31 85 B1                                sta facb              ;byte count
   3614 CA33 E2 20                    +            .byte $e2,$20
                                        
   3615 CA35 A5 A8                                lda addrb+s_word      ;handle banks
   3616 CA37 E5 A4                                sbc addra+s_word
   3617 CA39 85 B3                                sta facb+s_word
   3618 CA3B 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;clroper: CLEAR OPERAND
                                        ;
   3624 CA3C DA                         clroper  phx
   3625 CA3D A2 02                                ldx #s_oper-1
                                        ;
   3627 CA3F 74 BD                      .0000010 stz operand,x
   3628 CA41 CA                                   dex
   3629 CA42 10 FB                                bpl .0000010
                                        ;
   3631 CA44 64 CF                                stz eopsize
   3632 CA46 FA                                   plx
   3633 CA47 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpfwsup: FOWARD COPY MEMORY SETUP
                                        ;
   3639 CA48 C2 30                      cpfwsup +         .byte $c2,$30
                                        
   3640 CA4A A2 54                    +            ldx #<opc_mvn
   3640 CA4C 00                       +            .byte >opc_mvn
                                        ;"move next" opcode
   3641 CA4D 80 05                                bra cpsup
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cprvsup: REVERSE COPY MEMORY SETUP
                                        ;
   3647 CA4F C2 30                      cprvsup +         .byte $c2,$30
                                        
   3648 CA51 A2 44                    +            ldx #<opc_mvp
   3648 CA53 00                       +            .byte >opc_mvp
                                        ;"move previous" opcode
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;cpsup: COPY MEMORY SETUP
                                        ;
   3654 CA54 48                         cpsup    pha                   ;save banks
   3655 CA55 8A                                   txa                   ;protect...
   3656 CA56 EB                       +            .byte $eb
                                                           ;opcode
   3657 CA57 E2 20                    +            .byte $e2,$20
                                        
   3658 CA59 A2 08                    +            ldx #<(cpcodeee-cpcode-1)
   3658 CA5B 00                       +            .byte >(cpcodeee-cpcode-1)
                                        
                                        ;
   3660 CA5C BF                         .0000010 +         .byte $bf
   3660 CA5D 7C CA 00                 +   +         .byte <cpcode,>cpcode,cpcode >> 16
                                     +   
                                        ;transfer copy code to...
   3661 CA60 95 D4                                sta mcftwork,x        ;to workspace
   3662 CA62 CA                                   dex
   3663 CA63 10 F7                                bpl .0000010
                                        ;
   3665 CA65 EB                       +            .byte $eb
                                                           ;recover opcode &...
   3666 CA66 85 D5                                sta mcftopc           ;set it
   3667 CA68 C2 20                    +            .byte $c2,$20
                                        
   3668 CA6A 68                                   pla                   ;get banks &...
   3669 CA6B 85 D6                                sta mcftbnk           ;set them
                                         
                                        ; We just dynamically created a routine, so the cache (if one is present) has
                                        ; to be invalidated. Otherwise the processor could execute dead code from the
                                        ; cache. Two lines are invalidated in case the code crosses a line boundary.
                                        ;
                                        ;	acc = 16 bit address to invalidate
                                        ;
                                        ; If there is no cache in the processor then these lines can be deleted.
                                        ;-------------------------------------------------------------------------------
                                           		 CPU	FT832
                                           		 MEM	16
   3681 00CA6D 48                                    pha
   3682 00CA6E A9 D4 00                              lda	#mcftwork
   3683 00CA71 42 E0 01                     		 cache	#1				; 1= invalidate line identified by address in acc
   3684 00CA74 A9 E4 00                              lda	#mcftwork+16
   3685 00CA77 42 E0 01                     		 cache	#1
   3686 00CA7A 68                                    pla
                                        		 CPU	W65C02
   3688 CA7B                            		 MEM	8
                                        ;---------------------------------------------
   3690 CA7B 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;cpcode: COPY MEMORY CODE
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	This code is transfered to workspace when a
                                        ;	copy or fill operation is to be performed.
                                        ;	———————————————————————————————————————————
                                        ;
   3701 CA7C 8B                         cpcode +         .byte $8b
                                                           ;must preserve data bank
                                        ;         .rept s_mvinst
   3703 CA7D EA                                     nop                 ;placeholder
   3704 CA7E EA                                     nop
   3705 CA7F EA                                     nop
                                        ;         .endr
   3707 CA80 AB                       +            .byte $ab
                                                           ;restore data bank
   3708 CA81 5C 4F C1 00                          jml monce             ;return to command executive
   3892 = 0000CA85                      cpcodeee =*                    ;placeholder — do not delete
                                        ;
                                        ;================================================================================
                                        ;
                                        ;decdcnt: DECREMENT DUMP COUNT
                                        ;
                                        ;	———————————————————————————————————————————
                                        ;	Preparatory Ops: bytes to process in FACB
                                        ;	                 bytes processed in CHARCNT
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = count = zero
                                        ;	———————————————————————————————————————————
                                        ;
   3725 CA85 E2 20                      decdcnt +         .byte $e2,$20
                                        
   3726 CA87 A9 00                                lda #0
   3727 CA89 EB                       +            .byte $eb
                                                           ;clear .B
   3728 CA8A A5 B3                                lda facb+s_word       ;count MSW
   3729 CA8C C2 20                    +            .byte $c2,$20
                                        
   3730 CA8E 38                                   sec
   3731 CA8F 05 B1                                ora facb              ;count LSW
   3732 CA91 F0 13                                beq .0000020          ;zero, just exit
                                        ;
   3734 CA93 A5 B1                                lda facb
   3735 CA95 E5 C6                                sbc charcnt           ;bytes processed
   3736 CA97 85 B1                                sta facb
   3737 CA99 E2 20                    +            .byte $e2,$20
                                        
   3738 CA9B A5 B3                                lda facb+s_word
   3739 CA9D E9 00                                sbc #0                ;handle borrow
   3740 CA9F 90 04                                bcc .0000010          ;underflow
                                        ;
   3742 CAA1 85 B3                                sta facb+s_word
   3743 CAA3 18                                   clc                   ;count > 0
   3744 CAA4 60                                   rts
                                        ;
   3746 CAA5 38                         .0000010 sec
                                        ;
   3748 CAA6 E2 20                      .0000020 +         .byte $e2,$20
                                        
   3749 CAA8 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;enddest: GET 2ND & 3RD ADDRESSES FOR COMPARE & TRANSFER
                                        ;
   3755 CAA9 20 ED CA                   enddest  jsr facasize          ;check start...
   3756 CAAC C9 04                                cmp #s_dword          ;for range
   3757 CAAE B0 1E                                bcs .0000010          ;out of range — error
                                        ;
   3759 CAB0 20 CF CA                             jsr facaddra          ;store start
   3760 CAB3 20 01 CB                             jsr getparm           ;get end
   3761 CAB6 B0 16                                bcs .0000010          ;not entered — error
                                        ;
   3763 CAB8 20 ED CA                             jsr facasize          ;check end...
   3764 CABB C9 04                                cmp #s_dword          ;for range
   3765 CABD B0 0F                                bcs .0000010          ;out of range — error
                                        ;
   3767 CABF 20 D9 CA                             jsr facaddrb          ;store end
   3768 CAC2 20 01 CB                             jsr getparm           ;get destination
   3769 CAC5 B0 07                                bcs .0000010          ;not entered — error
                                        ;
   3771 CAC7 20 ED CA                             jsr facasize          ;check destination...
   3772 CACA C9 04                                cmp #s_dword          ;for range
   3773 CACC 90 15                                bcc facaoper          ;store dest address
                                        ;
   3775 CACE 60                         .0000010 rts                   ;exit w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddra: COPY FACA TO ADDRA
                                        ;
   3781 CACF A2 02                      facaddra ldx #s_xword-1
                                        ;
   3783 CAD1 B5 A9                      .0000010 lda faca,x
   3784 CAD3 95 A2                                sta addra,x
   3785 CAD5 CA                                   dex
   3786 CAD6 10 F9                                bpl .0000010
                                        ;
   3788 CAD8 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaddrb: COPY FACA TO ADDRB
                                        ;
   3794 CAD9 A2 02                      facaddrb ldx #s_xword-1
                                        ;
   3796 CADB B5 A9                      .0000010 lda faca,x
   3797 CADD 95 A6                                sta addrb,x
   3798 CADF CA                                   dex
   3799 CAE0 10 F9                                bpl .0000010
                                        ;
   3801 CAE2 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facaoper: COPY FACA TO OPERAND
                                        ;
   3807 CAE3 A2 02                      facaoper ldx #s_oper-1
                                        ;
   3809 CAE5 B5 A9                      .0000010 lda faca,x
   3810 CAE7 95 BD                                sta operand,x
   3811 CAE9 CA                                   dex
   3812 CAEA 10 F9                                bpl .0000010
                                        ;
   3814 CAEC 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;facasize: REPORT OPERAND SIZE IN FACA
                                        ;
                                        ;	——————————————————————————————————————————
                                        ;	Preparatory Ops: operand in FACA
                                        ;
                                        ;	Returned Values: .A: s_byte  (1)
                                        ;	                     s_word  (2)
                                        ;	                     s_xword (3)
                                        ;	                     s_dword (4)
                                        ;
                                        ;	Notes: 1) This function will always report
                                        ;	          a non-zero result.
                                        ;	——————————————————————————————————————————
                                        ;
   3832 CAED E2 30                      facasize +         .byte $e2,$30
                                        
   3833 CAEF A2 03                                ldx #s_dword-1
                                        ;
   3835 CAF1 B5 A9                      .0000010 lda faca,x            ;get byte
   3836 CAF3 D0 03                                bne .0000020          ;done
                                        ;
   3838 CAF5 CA                                   dex
   3839 CAF6 D0 F9                                bne .0000010          ;next byte
                                        ;
   3841 CAF8 E8                         .0000020 inx                   ;count=index+1
   3842 CAF9 8A                                   txa
   3843 CAFA 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getbyte: GET A BYTE FROM MEMORY
                                        ;
   3849 CAFB A7 A2                      getbyte +         .byte $a7,addra
                                        ;get a byte
   3850 CAFD 80 3F                                bra incaddra          ;bump address
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getparm: GET A PARAMETER
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops: null-terminated input in IBUFFER
                                        ;
                                        ;	Returned Values: .A: chars in converted parameter
                                        ;	                 .X: used
                                        ;	                 .Y: entry value
                                        ;	                 .C: 1 = no parameter entered
                                        ;	—————————————————————————————————————————————————
                                        ;
   3865 CAFF C6 C1                      getparmr dec ibufidx           ;reread previous char
                                        ;
   3867 CB01 5A                         getparm  phy                   ;preserve
   3868 CB02 20 56 C8                             jsr ascbin            ;convert parameter to binary
   3869 CB05 B0 1C                                bcs .0000040          ;conversion error
                                        ;
   3871 CB07 20 EE CB                             jsr getcharr          ;reread last char
   3872 CB0A D0 08                                bne .0000010          ;not end-of-input
                                        ;
   3874 CB0C C6 C1                                dec ibufidx           ;reindex to terminator
   3875 CB0E A5 C6                                lda charcnt           ;get chars processed so far
   3876 CB10 F0 0C                                beq .0000030          ;none
                                        ;
   3878 CB12 D0 08                                bne .0000020          ;some
                                        ;
   3880 CB14 C9 20                      .0000010 cmp #a_blank          ;recognized delimiter
   3881 CB16 F0 04                                beq .0000020          ;end of parameter
                                        ;
   3883 CB18 C9 2C                                cmp #','              ;recognized delimiter
   3884 CB1A D0 07                                bne .0000040          ;unknown delimter
                                        ;
   3886 CB1C 18                         .0000020 clc
   3887 CB1D 24                                   .byte bitzp           ;skip SEC below
                                        ;
   3889 CB1E 38                         .0000030 sec
   3890 CB1F 7A                                   ply                   ;restore
   3891 CB20 A5 C6                                lda charcnt           ;get count
   3892 CB22 60                                   rts                   ;done
                                        ;
   3894 CB23                            .0000040 
                                        ;.rept 3               ;clean up stack
   3896 CB23 68                          			pla
   3897 CB24 68                          			pla
   3898 CB25 68                                     pla
                                        ;        .endr
   3900 CB26 4C 8E C1                             jmp monerr            ;abort w/error
                                        ;
                                        ;================================================================================
                                        ;
                                        ;nxtaddra: TEST & INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR NXTADDRA
                                        ;
                                        ;	Exit registers: .A: used
                                        ;	                .B: used
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    |||||||+———> 0: ADDRA < ADDRB
                                        ;	                    |||||||      1: ADDRA >= ADDRB
                                        ;	                    ||||||+————> undefined
                                        ;	                    |||+++—————> entry value
                                        ;	                    ||+————————> 1
                                        ;	                    ++—————————> undefined
                                        ;	——————————————————————————————————————————————————
                                        ;
   3926 CB29 E2 20                      nxtaddra +         .byte $e2,$20
                                        
   3927 CB2B A5 A4                                lda addra+s_word      ;bits 16-23
   3928 CB2D C5 A8                                cmp addrb+s_word
   3929 CB2F 90 0D                                bcc incaddra          ;increment
                                        ;
   3931 CB31 D0 0A                                bne .0000010          ;don't increment
                                        ;
   3933 CB33 C2 20                    +            .byte $c2,$20
                                        
   3934 CB35 A5 A2                                lda addra             ;bits 0-15
   3935 CB37 C5 A6                                cmp addrb             ;condition flags
   3936 CB39 E2 20                    +            .byte $e2,$20
                                        
   3937 CB3B 90 01                                bcc incaddra          ;increment
                                        ;
   3939 CB3D 60                         .0000010 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incaddra: INCREMENT WORKING ADDRESS 'A'
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Calling syntax: JSR INCADDRA
                                        ;
                                        ;	Exit registers: .A: entry value
                                        ;	                .B: entry value
                                        ;	                .X: entry value
                                        ;	                .Y: entry value
                                        ;	                DB: entry value
                                        ;	                DP: entry value
                                        ;	                PB: entry value
                                        ;	                SR: NVmxDIZC
                                        ;	                    ||||||||
                                        ;	                    ++++++++———> entry value
                                        ;	——————————————————————————————————————————————————
                                        ;
   3960 CB3E 08                         incaddra php
   3961 CB3F C2 20                    +            .byte $c2,$20
                                        
   3962 CB41 E6 A2                                inc addra             ;bump bits 0-15
   3963 CB43 D0 04                                bne .0000010
                                        ;
   3965 CB45 E2 20                    +            .byte $e2,$20
                                        
   3966 CB47 E6 A4                                inc addra+s_word      ;bump bits 16-23
                                        ;
   3968 CB49 28                         .0000010 plp
   3969 CB4A 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;incoper: INCREMENT OPERAND ADDRESS
                                        ;
   3975 CB4B 18                         incoper  clc
   3976 CB4C 08                                   php
   3977 CB4D C2 30                    +            .byte $c2,$30
                                        
   3978 CB4F 48                                   pha
   3979 CB50 E6 BD                                inc operand           ;handle base address
   3980 CB52 D0 06                                bne .0000010
                                        ;              
   3982 CB54 E2 20                    +            .byte $e2,$20
                                        
   3983 CB56 E6 BF                                inc operand+s_word    ;handle bank
   3984 CB58 C2 20                    +            .byte $c2,$20
                                        
                                        ;
   3986 CB5A 68                         .0000010 pla
   3987 CB5B 28                                   plp
   3988 CB5C 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;instdata: GET INSTRUCTION SIZE & ADDRESSING MODE DATA
                                        ;
                                        ;	——————————————————————————————————
                                        ;	Preparatory Ops: .X: 65C816 opcode
                                        ;
                                        ;	Returned Values: .A: mode flags
                                        ;	                 .X: operand size
                                        ;	                 .Y: mode index
                                        ;	——————————————————————————————————
                                        ;
   4002 CB5D E2 30                      instdata +         .byte $e2,$30
                                        
   4003 CB5F BD D9 CE                             lda mnetabam,x        ;addressing mode data
   4004 CB62 48                                   pha                   ;save mode flag bits
   4005 CB63 48                                   pha                   ;save size data
   4006 CB64 29 0F                                and #amodmask         ;extract mode index &...
   4007 CB66 A8                                   tay                   ;save
   4008 CB67 68                                   pla                   ;recover data
   4009 CB68 29 30                                and #opsmask          ;mask mode fields &...
                                        ;         .rept n_opslsr        ;extract operand size
   4011 CB6A 4A                                     lsr
   4012 CB6B 4A                                     lsr
   4013 CB6C 4A                                     lsr
   4014 CB6D 4A                                     lsr
                                        ;         .endr
   4016 CB6E AA                                   tax                   ;operand size
   4017 CB6F 68                                   pla                   ;recover mode flags
   4018 CB70 29 C0                                and #vopsmask         ;discard mode & size fields
   4019 CB72 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;offtarg: CONVERT BRANCH OFFSET TO TARGET ADDRESS
                                        ;
                                        ;	———————————————————————————————————————————————
                                        ;	Preparatory Ops:    ADDRA: base address
                                        ;	                 INSTSIZE: instruction size
                                        ;	                  OPERAND: offset
                                        ;
                                        ;	Returned Values:  OPERAND: target address (L/H)
                                        ;	                       .A: used
                                        ;	                       .X: entry value
                                        ;                              .Y: entry value
                                        ;	———————————————————————————————————————————————
                                        ;
   4036 CB73 C2 20                      offtarg +         .byte $c2,$20
                                        
   4037 CB75 A5 A2                                lda addra             ;base address
   4038 CB77 E2 20                    +            .byte $e2,$20
                                        
   4039 CB79 46 C8                                lsr instsize          ;bit 0 will be set if...
   4040 CB7B B0 07                                bcs .0000010          ;a long branch
                                        ;
   4042 CB7D 24 BD                                bit operand           ;short forward or backward?
   4043 CB7F 10 03                                bpl .0000010          ;forward
                                        ;
   4045 CB81 EB                       +            .byte $eb
                                                           ;expose address MSB
   4046 CB82 3A                                   dea                   ;back a page
   4047 CB83 EB                       +            .byte $eb
                                                           ;expose address LSB
                                        ;
   4049 CB84 C2 20                      .0000010 +         .byte $c2,$20
                                        
   4050 CB86 18                                   clc
   4051 CB87 65 BD                                adc operand           ;calculate target address
   4052 CB89 85 BD                                sta operand           ;new operand
   4053 CB8B E2 20                    +            .byte $e2,$20
                                        
   4054 CB8D A9 03                                lda #s_xword
   4055 CB8F 85 C8                                sta instsize          ;effective instruction size
   4056 CB91 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;setxaddr: SET EXECUTION ADDRESS
                                        ;
   4062 CB92 B0 13                      setxaddr bcs .0000010          ;no address given
                                        ;
   4064 CB94 20 ED CA                             jsr facasize          ;check address...
   4065 CB97 C9 04                                cmp #s_dword          ;range
   4066 CB99 B0 0D                                bcs .0000020          ;out of range
                                        ;
   4068 CB9B C2 20                    +            .byte $c2,$20
                                        
   4069 CB9D A5 A9                                lda faca              ;execution address
   4070 CB9F 85 88                                sta reg_pcx           ;set new PC value
   4071 CBA1 E2 20                    +            .byte $e2,$20
                                        
   4072 CBA3 A5 AB                                lda faca+s_word
   4073 CBA5 85 8A                                sta reg_pbx           ;set new PB value
                                        ;
   4075 CBA7 18                         .0000010 clc                   ;no error
                                        ;
   4077 CBA8 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;targoff: CONVERT BRANCH TARGET ADDRESS TO BRANCH OFFSET                   
                                        ;
                                        ;	—————————————————————————————————————————————————
                                        ;	Preparatory Ops:   ADDRA: instruction address
                                        ;	                 OPERAND: target address
                                        ;
                                        ;	Returned Values: OPERAND: computed offset
                                        ;	                      .A: effective operand size
                                        ;	                      .X: entry value
                                        ;                             .Y: entry value
                                        ;	                      .C: 1 = branch out of range
                                        ;
                                        ;	Execution notes: ADDRB is set to the branch base
                                        ;	                 address.
                                        ;	—————————————————————————————————————————————————
                                        ;
   4097 CBA9 64 C9                      targoff  stz instsize+s_byte   ;always zero
   4098 CBAB A5 C8                                lda instsize          ;instruction size will tell...
   4099 CBAD 4A                                   lsr                   ;if long or short branch
                                        ;
                                        ;—————————————————————————————————————————————————
   4309 = 000000BC                      .btype   =facc+5               ;branch type flag
                                        ;—————————————————————————————————————————————————
                                        ;
   4105 CBAE 66 BC                                ror .btype            ;set branch type...
                                        ;
                                        ;	x0000000
                                        ;	|
                                        ;	+——————————> 0: short
                                        ;	             1: long
                                        ;
   4112 CBB0 C2 20                    +            .byte $c2,$20
                                        
   4113 CBB2 18                                   clc
   4114 CBB3 A5 A2                                lda addra             ;instruction address
   4115 CBB5 65 C8                                adc instsize          ;instruction size
   4116 CBB7 85 A6                                sta addrb             ;base address
   4117 CBB9 38                                   sec
   4118 CBBA A5 BD                                lda operand           ;target address
   4119 CBBC E5 A6                                sbc addrb             ;base address
   4120 CBBE 85 BD                                sta operand           ;offset
   4121 CBC0 E2 20                    +            .byte $e2,$20
                                        
   4122 CBC2 90 15                                bcc .0000040          ;backward branch
                                        ;
   4124 CBC4 24 BC                                bit .btype            ;check branch range
   4125 CBC6 30 0A                                bmi .0000020          ;long
                                        ;
                                        ;
                                        ;	process short forward branch...
                                        ;
   4130 CBC8 EB                       +            .byte $eb
                                                           ;offset MSB should be zero
   4131 CBC9 D0 21                                bne .0000060          ;it isn't — out of range
                                        ;
   4133 CBCB EB                       +            .byte $eb
                                                           ;offset LSB should be $00-$7F
   4134 CBCC 30 1E                                bmi .0000060          ;it isn't — out of range
                                        ;
   4136 CBCE A9 01                      .0000010 lda #s_byte           ;final instruction size
   4137 CBD0 18                                   clc                   ;branch in range
   4138 CBD1 60                                   rts
                                        ;
                                        ;
                                        ;	process long forward branch...
                                        ;
   4143 CBD2 EB                         .0000020 +         .byte $eb
                                                           ;offset MSB should be positive
   4144 CBD3 30 17                                bmi .0000060          ;it isn't — branch out of range
                                        ;
   4146 CBD5 A9 02                      .0000030 lda #s_word
   4147 CBD7 18                                   clc
   4148 CBD8 60                                   rts
                                        ;
                                        ;
                                        ;	process backward branch...
                                        ;
   4153 CBD9 24 BC                      .0000040 bit .btype            ;long or short?
   4154 CBDB 30 0C                                bmi .0000050          ;long
                                        ;
                                        ;
                                        ;	process short backward branch...
                                        ;
   4159 CBDD EB                       +            .byte $eb
                                                           ;offset MSB should be negative
   4160 CBDE 10 0C                                bpl .0000060          ;it isn't — out of range
                                        ;
   4162 CBE0 49 FF                                eor #%11111111        ;complement offset MSB 2s 
   4163 CBE2 D0 08                                bne .0000060          ;out of range
                                        ;
   4165 CBE4 EB                       +            .byte $eb
                                                           ;offset LSB should be $80-$FF
   4166 CBE5 30 E7                                bmi .0000010          ;it is — branch in range
                                        ;
   4168 CBE7 80 03                                bra .0000060          ;branch out of range
                                        ;
                                        ;
                                        ;	process long backward branch...
                                        ;
   4173 CBE9 EB                         .0000050 +         .byte $eb
                                                           ;offset MSB should be negative
   4174 CBEA 30 E9                                bmi .0000030          ;it is — branch in range
                                        ;
   4176 CBEC 38                         .0000060 sec                   ;range error
   4177 CBED 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharr: GET PREVIOUS INPUT BUFFER CHARACTER
                                        ;
   4183 CBEE C6 C1                      getcharr dec ibufidx           ;move back a char
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getchar: GET A CHARACTER FROM INPUT BUFFER
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops : none
                                        ;
                                        ;	Register Returns: .A: character or <NUL>
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> entry value
                                        ;	           ||||||+————> 1: <NUL> gotten
                                        ;	           |||||+—————> entry value
                                        ;	           ||||+——————> entry value
                                        ;	           |||+———————> entry value
                                        ;	           ||+————————> entry value
                                        ;	           |+—————————> not defined
                                        ;	           +——————————> not defined
                                        ;	——————————————————————————————————————————————
                                        ;
   4209 CBF0 DA                         getchar  phx
   4210 CBF1 5A                                   phy
   4211 CBF2 08                                   php                   ;save register sizes
   4212 CBF3 E2 30                    +            .byte $e2,$30
                                                        ;force 8 bits
   4213 CBF5 A6 C1                                ldx ibufidx           ;buffer index
   4214 CBF7 BD 00 02                             lda ibuffer,x         ;get char
   4215 CBFA E6 C1                                inc ibufidx           ;bump index
   4216 CBFC 28                                   plp                   ;restore register widths
   4217 CBFD 7A                                   ply
   4218 CBFE FA                                   plx
                                        ; Changed the following to XBA instruction which seems to work as well.
                                        ; XBA doesn't access the stack memory saving a data memory access,
                                        ; and hence is faster.
   4222 CBFF EB                       +            .byte $eb
                                        		;	pha                   ;condition...
   4223 CC00 EB                       +            .byte $eb
                                        		;   pla                   ;.Z
   4224 CC01 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getpat: GET PATTERN FOR MEMORY CHANGE or SEARCH
                                        ;
                                        ;	—————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated pattern in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: used
                                        ;	                 .Y: pattern length if entered
                                        ;	                 .C: 0 = pattern valid
                                        ;	                     1 = exception:
                                        ;	                 .N  0 = no pattern entered
                                        ;	                     1 = evaluation error
                                        ;
                                        ;	Notes: 1) If pattern is preceded by "'" the following
                                        ;	          characters are interpreted as ASCII.
                                        ;	       2) A maximum of 32 bytes or characters is
                                        ;	          accepted.  Excess input will be discarded.
                                        ;	—————————————————————————————————————————————————————
                                        ;
   4247 CC02 64 CD                      getpat   stz status            ;clear pattern type indicator
   4248 CC04 A0 00                                ldy #0                ;pattern index
   4249 CC06 20 EE CB                             jsr getcharr          ;get last char
   4250 CC09 F0 3C                                beq .0000070          ;EOS
                                        ;
   4252 CC0B A6 C1                                ldx ibufidx           ;current buffer index
   4253 CC0D 20 4E CC                             jsr getcharw          ;get next
   4254 CC10 F0 35                                beq .0000070          ;EOS
                                        ;
   4256 CC12 C9 27                                cmp #''''			; *** watch syntax here, the following line of code was omitted when only ''' was present
   4257 CC14 D0 04                                bne .0000010          ;not ASCII input
                                        ;
   4259 CC16 66 CD                                ror status            ;condition flag
   4260 CC18 80 12                                bra .0000030          ;balance of input is ASCII
                                        ;
   4262 CC1A 86 C1                      .0000010 stx ibufidx           ;restore buffer index
                                        ;
   4264 CC1C 20 01 CB                   .0000020 jsr getparm           ;evaluate numeric pattern
   4265 CC1F B0 21                                bcs .0000060          ;done w/pattern
                                        ;
   4267 CC21 20 ED CA                             jsr facasize          ;size
   4268 CC24 C9 02                                cmp #s_word
   4269 CC26 B0 1F                                bcs .0000070          ;not a byte — error
                                        ;
   4271 CC28 A5 A9                                lda faca              ;get byte &...
   4272 CC2A 80 05                                bra .0000040          ;store
                                        ;
   4274 CC2C 20 F0 CB                   .0000030 jsr getchar           ;get ASCII char
   4275 CC2F F0 11                                beq .0000060          ;done w/pattern
                                        ;
   4277 CC31 C0 20                      .0000040 cpy #s_auxbuf         ;pattern buffer full?
   4278 CC33 F0 0A                                beq .0000050          ;yes
                                        ;
   4280 CC35 99 51 02                             sta auxbuf,y          ;store pattern
   4281 CC38 C8                                   iny
   4282 CC39 24 CD                                bit status
   4283 CC3B 10 DF                                bpl .0000020          ;get next numeric value
                                        ;
   4285 CC3D 80 ED                                bra .0000030          ;get next ASCII char
                                        ;
   4287 CC3F 20 2F C8                   .0000050 jsr alert             ;excess input
                                        ;
   4289 CC42 84 C0                      .0000060 sty auxbufix          ;save pattern size
   4290 CC44 98                                   tya                   ;condition .Z
   4291 CC45 18                                   clc                   ;pattern valid
   4292 CC46 60                                   rts
                                        ;
                                        ;
                                        ;	no pattern entered...
                                        ;
   4297 CC47 C2 80                      .0000070 +         .byte $c2,%10000000
                                        
   4298 CC49 38                                   sec
   4299 CC4A 60                                   rts
                                        ;
                                        ;
                                        ;	evaluation error...
                                        ;
   4304 CC4B E2 81                      .0000080 +         .byte $e2,%10000001
                                        
   4305 CC4D 60                                   rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;getcharw: GET FROM INPUT BUFFER, DISCARDING WHITESPACE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;
                                        ;	Notes: Whitespace is defined as a blank ($20) or a
                                        ;	       horizontal tab ($09).
                                        ;	——————————————————————————————————————————————————
                                        ;
   4323 CC4E 20 F0 CB                   getcharw jsr getchar           ;get from buffer
   4324 CC51 F0 08                                beq .0000010          ;EOI
                                        ;
   4326 CC53 C9 20                                cmp #' '
   4327 CC55 F0 F7                                beq getcharw          ;discard whitespace
                                        ;
   4329 CC57 C9 09                                cmp #a_ht             ;also whitespace
   4330 CC59 F0 F3                                beq getcharw
                                        ;
   4332 CC5B 18                         .0000010 clc
   4333 CC5C 60                                   rts  
                                        ;
                                        ;================================================================================
                                        ;
                                        ;input: INTERACTIVE INPUT FROM CONSOLE CHANNEL
                                        ;
                                        ;	———————————————————————————————————————————————————————————
                                        ;	Preparatory Ops: Zero IBUFIDX or load IBUFFER with default
                                        ;	                 input & set IBUFIDX to the number of chars
                                        ;	                 loaded into the buffer.
                                        ;
                                        ;	Returned Values: .A: used
                                        ;	                 .X: characters entered
                                        ;	                 .Y: used
                                        ;
                                        ;	Example: STZ IBUFIDX
                                        ;	         JSR INPUT
                                        ;
                                        ;	Notes: Input is collected in IBUFFER & is null-terminated.
                                        ;	       IBUFIDX is reset to zero upon exit.
                                        ;	———————————————————————————————————————————————————————————
                                        ;
   4355 CC5D                            input:
   4356 CC5D A6 C1                       	    ldx ibufidx
   4357 CC5F 9E 00 02                             stz ibuffer,x         ;be sure buffer is terminated
   4358 CC62 20 90 C7                             jsr dpyibuf           ;print default input if any
   4359 CC65 F4                       +            .byte $f4
   4359 CC66 31 D0                    +            .word dc_cn
                                        
   4360 CC68 20 3B C8                             jsr sprint            ;enable cursor
   4361 CC6B A6 C1                                ldx ibufidx           ;starting buffer index
                                        ;
                                        ;
                                        ;	main input loop...
                                        ;
   4366 CC6D                               .0000010 CPU FT832
   4367 00CC6D 42 20 00 FE FC               		 jcr getcha,biosctx            ;poll for input
                                        		 CPU	W65C02
   4369 CC72 90 02                                bcc .0000020          ;got something
                                        ;
                                        ;         jsr	$F409          ;wait 'til any IRQ &... (Reschedule tasks)
   4372 CC74 80 F7                                bra .0000010          ;try again
                                        ;
   4374 CC76                            .0000020
   4375 CC76 C9 7F                       		cmp #a_del            ;above ASCII range?
   4376 CC78 B0 F3                                bcs .0000010          ;yes, ignore
                                        ;
   4378 CC7A C9 09                                cmp #a_ht             ;horizontal tab?
   4379 CC7C D0 02                                bne .0000030          ;no
                                        ;
   4381 CC7E A9 20                                lda #a_blank          ;replace <HT> w/blank
                                        ;
   4383 CC80 C9 20                      .0000030 cmp #a_blank          ;control char?
   4384 CC82 90 12                                bcc .0000050          ;yes
                                        ;
                                        ;
                                        ;	process QWERTY character...
                                        ;
   4389 CC84 E0 50                                cpx #s_ibuf           ;room in buffer?
   4390 CC86 B0 05                                bcs .0000040          ;no
                                        ;
   4392 CC88 9D 00 02                             sta ibuffer,x         ;store char
   4393 CC8B E8                                   inx                   ;bump index
   4394 CC8C 2C                                   .byte bitabs          ;echo char
                                        ;
   4396 CC8D A9 07                      .0000040 lda #a_bel            ;alert user
                                           		 cpu FT832
   4398 00CC8F 42 20 06 FE FC               		 jcr putcha,biosctx
                                        		 cpu W65C02
   4400 CC94 80 D7                                bra .0000010          ;get some more
                                        ;
                                        ;
                                        ;	process carriage return...
                                        ;
   4405 CC96 C9 0D                      .0000050 cmp #a_cr             ;carriage return?
   4406 CC98 D0 0E                                bne .0000060          ;no
                                        ;
   4408 CC9A DA                                   phx                   ;protect input count
   4409 CC9B F4                       +            .byte $f4
   4409 CC9C 35 D0                    +            .word dc_co
                                        
   4410 CC9E 20 3B C8                             jsr sprint            ;cursor off
   4411 CCA1 FA                                   plx                   ;recover input count
   4412 CCA2 9E 00 02                             stz ibuffer,x         ;terminate input &...
   4413 CCA5 64 C1                                stz ibufidx           ;reset buffer index
   4414 CCA7 60                                   rts                   ;done
                                        ;
                                        ;
                                        ;	process backspace...
                                        ;
   4419 CCA8 C9 08                      .0000060 cmp #a_bs             ;backspace?
   4420 CCAA D0 C1                                bne .0000010          ;no
                                        ;
   4422 CCAC 8A                                   txa
   4423 CCAD F0 BE                                beq .0000010          ;no input, ignore <BS>
                                        ;
   4425 CCAF CA                                   dex                   ;1 less char
   4426 CCB0 DA                                   phx                   ;preserve count
   4427 CCB1 20 E3 C7                             jsr gendbs            ;destructive backspace
   4428 CCB4 FA                                   plx                   ;restore count
   4429 CCB5 80 B6                                bra .0000010          ;get more input
                                        ;
                                        ;================================================================================
                                        ;
                                        ;lodbnk: LOAD SOURCE & DESTINATION BANKS
                                        ;
   4435 CCB7 E2 20                      lodbnk +         .byte $e2,$20
                                        
   4436 CCB9 A5 BF                                lda operand+s_word    ;destination bank
   4437 CCBB EB                       +            .byte $eb
                                                           ;make it MSB
   4438 CCBC A5 A4                                lda addra+s_word      ;source bank is LSB
   4439 CCBE 60                                   rts
                                        ;         
                                        ;================================================================================
                                        ;
                                        ;getcharc: GET A CHARACTER FROM INPUT BUFFER & CONVERT CASE
                                        ;
                                        ;	——————————————————————————————————————————————————
                                        ;	Preparatory Ops: Null-terminated input in IBUFFER.
                                        ;
                                        ;	Returned Values: .A: char or null
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;	                 .Z: 1 = null terminator detected
                                        ;	——————————————————————————————————————————————————
                                        ;
   4454 CCBF 20 F0 CB                   getcharc jsr getchar           ;get from buffer
   4455 CCC2 F0 0C                                beq touppera          ;just return
                                        ;
                                        ;================================================================================
                                        ;
                                        ;toupper: FORCE CHARACTER TO UPPER CASE
                                        ;
                                        ;	————————————————————————————————————————————————
                                        ;	Preparatory Ops : .A: character to convert
                                        ;
                                        ;	Register Returns: .A: converted character
                                        ;	                  .B: entry value
                                        ;	                  .X: entry value
                                        ;	                  .Y: entry value
                                        ;
                                        ;	MPU Flags: no change
                                        ;
                                        ;	Notes: 1) This subroutine has no effect on char-
                                        ;	          acters that are not alpha.
                                        ;	————————————————————————————————————————————————
                                        ;
   4475 CCC4 08                         toupper  php                   ;protect flags
   4476 CCC5 C9 61                                cmp #a_asclcl         ;check char range
   4477 CCC7 90 06                                bcc .0000010          ;not LC alpha
                                        ;
   4479 CCC9 C9 7B                                cmp #a_asclch+s_byte
   4480 CCCB B0 02                                bcs .0000010          ;not LC alpha
                                        ;
   4482 CCCD 29 5F                                and #a_lctouc         ;force to UC
                                        ;
   4484 CCCF 28                         .0000010 plp                   ;restore flags
                                        ;
   4486 CCD0 60                         touppera rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;teststop: TEST FOR STOP KEY
                                        ;
                                        ;	——————————————————————————————————————————————
                                        ;	Preparatory Ops: none
                                        ;
                                        ;	Returned Values: .A: detected keypress, if any
                                        ;	                 .X: entry value
                                        ;	                 .Y: entry value
                                        ;
                                        ;	MPU Flags: NVmxDIZC
                                        ;	           ||||||||
                                        ;	           |||||||+———> 0: normal key detected
                                        ;	           |||||||      1: <STOP> detected
                                        ;	           +++++++————> not defined
                                        ;
                                        ;	Example: jsr teststop
                                        ;	         bcs stopped
                                        ;
                                        ;	Notes: The symbol STOPKEY defines the ASCII
                                        ;	       value of the "stop key."
                                        ;	——————————————————————————————————————————————
                                        ;
   4512 CCD1                            teststop 
                                            		CPU	TF832
   4514 00000CCD1                           		jcr getcha,biosctx            ;poll console
                                        		CPU	W65C02
   4516 CCD1 B0 04                                bcs .0000010          ;no input
                                        ;
   4518 CCD3 C9 03                                cmp #stopkey          ;stop key pressed?
   4519 CCD5 F0 01                                beq .0000020          ;yes
                                        ;
   4521 CCD7 18                         .0000010 clc
                                        ;
   4523 CCD8 60                         .0000020 rts
                                        ;
                                        ;================================================================================
                                        ;
                                        ;COMMAND PROCESSING DATA TABLES
                                        ;
                                        ;
                                        ;	monitor commands...
                                        ;
   4532 CCD9 41                         mpctab   .byte "A"             ;assemble code
   4533 CCDA 43                                   .byte "C"             ;compare memory ranges
   4534 CCDB 44                                   .byte "D"             ;disassemble code
   4535 CCDC 46                                   .byte "F"             ;fill memory
   4536 CCDD 47                                   .byte "G"             ;execute code
   4537 CCDE 48                                   .byte "H"             ;search memory
   4538 CCDF 4A                                   .byte "J"             ;execute code as subroutine
   4539 CCE0 4D                                   .byte "M"             ;dump memory range
   4540 CCE1 52                                   .byte "R"             ;dump registers
   4541 CCE2 54                                   .byte "T"             ;copy memory range
   4542 CCE3 58                                   .byte "X"             ;exit from monitor
   4543 CCE4 3E                                   .byte ">"             ;change memory
   4544 CCE5 3B                                   .byte ";"             ;change registers
   4771 = 0000000D                      n_mpctab =*-mpctab             ;entries in above table
                                        ;
                                        ;
                                        ;	monitor command jump table...
                                        ;
   4550 CCE6 94 C1                      mpcextab .word monasc-s_byte   ; A  assemble code
   4551 CCE8 58 C4                                .word moncmp-s_byte   ; C  compare memory ranges
   4552 CCEA 72 C3                                .word mondsc-s_byte   ; D  disassemble code
   4553 CCEC 29 C5                                .word monfil-s_byte   ; F  fill memory
   4554 CCEE C6 C3                                .word monjmp-s_byte   ; G  execute code
   4555 CCF0 8F C5                                .word monhnt-s_byte   ; H  search memory
   4556 CCF2 F7 C3                                .word monjsr-s_byte   ; J  execute code as subroutine
   4557 CCF4 D7 C4                                .word mondmp-s_byte   ; M  dump memory range
   4558 CCF6 A3 C0                                .word monreg-s_byte   ; R  dump registers
   4559 CCF8 86 C4                                .word moncpy-s_byte   ; T  copy memory range
   4560 CCFA 40 C6                                .word monxit-s_byte   ; X  exit from monitor
   4561 CCFC 2D C4                                .word monchm-s_byte   ; >  change memory
   4562 CCFE 05 C6                                .word monchr-s_byte   ; ;  change registers
                                        ;
                                        ;
                                        ;	number conversion...
                                        ;        
   4567 CD00 10 0A 08 02                basetab  .byte 16,10,8,2       ;supported number bases
   4568 CD04 04 03 03 01                bitsdtab .byte 4,3,3,1         ;bits per binary digit
   4569 CD08 04 04 03 01                bitsntab .byte 4,4,3,1         ;bits per ASCII character
   4570 CD0C 03 02 09 02                lzsttab  .byte 3,2,9,2         ;leading zero suppression thresholds
   4571 CD10 0C 0C 10 30                numstab  .byte 12,12,16,48     ;bin to ASCII conversion numerals
   4572 CD14 24                         radxtab  .byte c_hex           ;hexadecimal radix
   4573 CD15 2B                                   .byte c_dec           ;decimal radix
   4574 CD16 40                                   .byte c_oct           ;octal radix
   4575 CD17 25                                   .byte c_bin           ;binary radix
   4802 = 00000004                      n_radix  =*-radxtab            ;number of recognized radices
                                        ;
                                        ;
                                        ;	shadow MPU register sizes...
                                        ;
   4581 CD18 02                         rcvltab  .byte s_mpupbx+s_byte ; PB
   4582 CD19 03                                   .byte s_mpupcx+s_byte ; PC
   4583 CD1A 02                                   .byte s_mpusrx+s_byte ; SR
   4584 CD1B 03                                   .byte s_word+s_byte   ; .C
   4585 CD1C 03                                   .byte s_word+s_byte   ; .X
   4586 CD1D 03                                   .byte s_word+s_byte   ; .Y
   4587 CD1E 03                                   .byte s_mpuspx+s_byte ; SP
   4588 CD1F 03                                   .byte s_mpudpx+s_byte ; DP
   4589 CD20 02                                   .byte s_mpudbx+s_byte ; DB
   4816 = 00000009                      n_regchv =*-rcvltab            ;total shadow registers
                                        ;
                                        ;================================================================================
                                        ;
                                        ;ASSEMBLER/DISASSEMBLER DATA TABLES
                                        ;
                                        ;
                                        ;	numerically sorted & encoded W65C816S mnemonics...
                                        ;
   4599 CD21 F2 10                      mnetab   .word mne_xba         ;  0 — XBA
   4600 CD23 5A 11                                .word mne_lda         ;  1 — LDA
   4601 CD25 A2 11                                .word mne_pea         ;  2 — PEA
   4602 CD27 62 12                                .word mne_pha         ;  3 — PHA
   4603 CD29 62 13                                .word mne_pla         ;  4 — PLA
   4604 CD2B C6 14                                .word mne_bra         ;  5 — BRA
   4605 CD2D E0 14                                .word mne_ora         ;  6 — ORA
   4606 CD2F 68 15                                .word mne_sta         ;  7 — STA
   4607 CD31 6A 16                                .word mne_txa         ;  8 — TXA
   4608 CD33 AA 16                                .word mne_tya         ;  9 — TYA
   4609 CD35 62 1A                                .word mne_phb         ; 10 — PHB
   4610 CD37 62 1B                                .word mne_plb         ; 11 — PLB
   4611 CD39 EA 1C                                .word mne_trb         ; 12 — TRB
   4612 CD3B 2A 1D                                .word mne_tsb         ; 13 — TSB
   4613 CD3D E8 20                                .word mne_sbc         ; 14 — SBC
   4614 CD3F 06 21                                .word mne_bcc         ; 15 — BCC
   4615 CD41 44 21                                .word mne_adc         ; 16 — ADC
   4616 CD43 6A 21                                .word mne_tdc         ; 17 — TDC
   4617 CD45 8A 21                                .word mne_dec         ; 18 — DEC
   4618 CD47 A8 21                                .word mne_sec         ; 19 — SEC
   4619 CD49 48 23                                .word mne_clc         ; 20 — CLC
   4620 CD4B D4 23                                .word mne_inc         ; 21 — INC
   4621 CD4D 2A 25                                .word mne_tsc         ; 22 — TSC
   4622 CD4F C6 25                                .word mne_bvc         ; 23 — BVC
   4623 CD51 2A 29                                .word mne_tcd         ; 24 — TCD
   4624 CD53 A8 29                                .word mne_sed         ; 25 — SED
   4625 CD55 62 2A                                .word mne_phd         ; 26 — PHD
   4626 CD57 48 2B                                .word mne_cld         ; 27 — CLD
   4627 CD59 62 2B                                .word mne_pld         ; 28 — PLD
   4628 CD5B C4 2B                                .word mne_and         ; 29 — AND
   4629 CD5D 32 31                                .word mne_xce         ; 30 — XCE
   4630 CD5F C6 33                                .word mne_bne         ; 31 — BNE
   4631 CD61 B0 50                                .word mne_wai         ; 32 — WAI
   4632 CD63 A2 51                                .word mne_pei         ; 33 — PEI
   4633 CD65 A8 51                                .word mne_sei         ; 34 — SEI
   4634 CD67 48 53                                .word mne_cli         ; 35 — CLI
   4635 CD69 86 53                                .word mne_bmi         ; 36 — BMI
   4636 CD6B 66 55                                .word mne_rti         ; 37 — RTI
   4637 CD6D 62 62                                .word mne_phk         ; 38 — PHK
   4638 CD6F C6 64                                .word mne_brk         ; 39 — BRK
   4639 CD71 96 6B                                .word mne_jml         ; 40 — JML
   4640 CD73 26 6C                                .word mne_rol         ; 41 — ROL
   4641 CD75 46 6C                                .word mne_bpl         ; 42 — BPL
   4642 CD77 C6 6C                                .word mne_brl         ; 43 — BRL
   4643 CD79 04 6D                                .word mne_asl         ; 44 — ASL
   4644 CD7B 16 6D                                .word mne_jsl         ; 45 — JSL
   4645 CD7D 66 6D                                .word mne_rtl         ; 46 — RTL
   4646 CD7F 70 71                                .word mne_wdm         ; 47 — WDM
   4647 CD81 DC 7D                                .word mne_mvn         ; 48 — MVN
   4648 CD83 A6 89                                .word mne_rep         ; 49 — REP
   4649 CD85 A8 89                                .word mne_sep         ; 50 — SEP
   4650 CD87 62 8A                                .word mne_php         ; 51 — PHP
   4651 CD89 62 8B                                .word mne_plp         ; 52 — PLP
   4652 CD8B 88 8B                                .word mne_cmp         ; 53 — CMP
   4653 CD8D 96 8B                                .word mne_jmp         ; 54 — JMP
   4654 CD8F 08 8C                                .word mne_cop         ; 55 — COP
   4655 CD91 1E 8C                                .word mne_nop         ; 56 — NOP
   4656 CD93 68 8D                                .word mne_stp         ; 57 — STP
   4657 CD95 DC 8D                                .word mne_mvp         ; 58 — MVP
   4658 CD97 86 91                                .word mne_beq         ; 59 — BEQ
   4659 CD99 A2 99                                .word mne_per         ; 60 — PER
   4660 CD9B 0C 9C                                .word mne_eor         ; 61 — EOR
   4661 CD9D 26 9C                                .word mne_ror         ; 62 — ROR
   4662 CD9F 16 9D                                .word mne_jsr         ; 63 — JSR
   4663 CDA1 1A 9D                                .word mne_lsr         ; 64 — LSR
   4664 CDA3 06 A1                                .word mne_bcs         ; 65 — BCS
   4665 CDA5 2A A1                                .word mne_tcs         ; 66 — TCS
   4666 CDA7 66 A5                                .word mne_rts         ; 67 — RTS
   4667 CDA9 C6 A5                                .word mne_bvs         ; 68 — BVS
   4668 CDAB 6A A6                                .word mne_txs         ; 69 — TXS
   4669 CDAD 86 AA                                .word mne_bit         ; 70 — BIT
   4670 CDAF 48 BB                                .word mne_clv         ; 71 — CLV
   4671 CDB1 AA C8                                .word mne_tax         ; 72 — TAX
   4672 CDB3 5A C9                                .word mne_ldx         ; 73 — LDX
   4673 CDB5 8A C9                                .word mne_dex         ; 74 — DEX
   4674 CDB7 62 CA                                .word mne_phx         ; 75 — PHX
   4675 CDB9 62 CB                                .word mne_plx         ; 76 — PLX
   4676 CDBB D4 CB                                .word mne_inx         ; 77 — INX
   4677 CDBD 48 CC                                .word mne_cpx         ; 78 — CPX
   4678 CDBF 2A CD                                .word mne_tsx         ; 79 — TSX
   4679 CDC1 68 CD                                .word mne_stx         ; 80 — STX
   4680 CDC3 AA CE                                .word mne_tyx         ; 81 — TYX
   4681 CDC5 AA D0                                .word mne_tay         ; 82 — TAY
   4682 CDC7 5A D1                                .word mne_ldy         ; 83 — LDY
   4683 CDC9 8A D1                                .word mne_dey         ; 84 — DEY
   4684 CDCB 62 D2                                .word mne_phy         ; 85 — PHY
   4685 CDCD 62 D3                                .word mne_ply         ; 86 — PLY
   4686 CDCF D4 D3                                .word mne_iny         ; 87 — INY
   4687 CDD1 48 D4                                .word mne_cpy         ; 88 — CPY
   4688 CDD3 68 D5                                .word mne_sty         ; 89 — STY
   4689 CDD5 6A D6                                .word mne_txy         ; 90 — TXY
   4690 CDD7 68 DD                                .word mne_stz         ; 91 — STZ
                                        ;
   4918 = 000000B8                      s_mnetab =*-mnetab             ;mnemonic table size
   4919 = 0000005C                      n_mnemon =s_mnetab/s_word      ;total mnemonics
                                        ;
                                        ;
                                        ;	mnemonic lookup indices in opcode order...
                                        ;
   4698 CDD9 27                         mnetabix .byte mne_brkx        ; $00  BRK
   4699 CDDA 06                                   .byte mne_orax        ; $01  ORA (dp,X)
   4700 CDDB 37                                   .byte mne_copx        ; $02  COP
   4701 CDDC 06                                   .byte mne_orax        ; $03  ORA offset,S
   4702 CDDD 0D                                   .byte mne_tsbx        ; $04  TSB dp
   4703 CDDE 06                                   .byte mne_orax        ; $05  ORA dp
   4704 CDDF 2C                                   .byte mne_aslx        ; $06  ASL dp
   4705 CDE0 06                                   .byte mne_orax        ; $07  ORA [dp]
   4706 CDE1 33                                   .byte mne_phpx        ; $08  PHP
   4707 CDE2 06                                   .byte mne_orax        ; $09  ORA #
   4708 CDE3 2C                                   .byte mne_aslx        ; $0A  ASL A
   4709 CDE4 1A                                   .byte mne_phdx        ; $0B  PHD
   4710 CDE5 0D                                   .byte mne_tsbx        ; $0C  TSB abs
   4711 CDE6 06                                   .byte mne_orax        ; $0D  ORA abs
   4712 CDE7 2C                                   .byte mne_aslx        ; $0E  ASL abs
   4713 CDE8 06                                   .byte mne_orax        ; $0F  ORA absl
                                        ;
   4715 CDE9 2A                                   .byte mne_bplx        ; $10  BPL abs
   4716 CDEA 06                                   .byte mne_orax        ; $11  ORA (dp),Y
   4717 CDEB 06                                   .byte mne_orax        ; $12  ORA (dp)
   4718 CDEC 06                                   .byte mne_orax        ; $13  ORA (offset,S),Y
   4719 CDED 0C                                   .byte mne_trbx        ; $14  TRB dp
   4720 CDEE 06                                   .byte mne_orax        ; $15  ORA dp,X
   4721 CDEF 2C                                   .byte mne_aslx        ; $16  ASL dp,X
   4722 CDF0 06                                   .byte mne_orax        ; $17  ORA [dp],Y
   4723 CDF1 14                                   .byte mne_clcx        ; $18  CLC
   4724 CDF2 06                                   .byte mne_orax        ; $19  ORA abs
   4725 CDF3 15                                   .byte mne_incx        ; $1A  INC A
   4726 CDF4 42                                   .byte mne_tcsx        ; $1B  TCS
   4727 CDF5 0C                                   .byte mne_trbx        ; $1C  TRB abs
   4728 CDF6 06                                   .byte mne_orax        ; $1D  ORA abs,X
   4729 CDF7 2C                                   .byte mne_aslx        ; $1E  ASL abs,X
   4730 CDF8 06                                   .byte mne_orax        ; $1F  ORA absl,X
                                        ;
   4732 CDF9 3F                                   .byte mne_jsrx        ; $20  JSR abs
   4733 CDFA 1D                                   .byte mne_andx        ; $21  AND (dp,X)
   4734 CDFB 2D                                   .byte mne_jslx        ; $22  JSL absl
   4735 CDFC 1D                                   .byte mne_andx        ; $23  AND offset,S
   4736 CDFD 46                                   .byte mne_bitx        ; $24  BIT dp
   4737 CDFE 1D                                   .byte mne_andx        ; $25  AND dp
   4738 CDFF 29                                   .byte mne_rolx        ; $26  ROL dp
   4739 CE00 1D                                   .byte mne_andx        ; $27  AND [dp]
   4740 CE01 34                                   .byte mne_plpx        ; $28  PLP
   4741 CE02 1D                                   .byte mne_andx        ; $29  AND #
   4742 CE03 29                                   .byte mne_rolx        ; $2A  ROL A
   4743 CE04 1C                                   .byte mne_pldx        ; $2B  PLD
   4744 CE05 46                                   .byte mne_bitx        ; $2C  BIT abs
   4745 CE06 1D                                   .byte mne_andx        ; $2D  AND abs
   4746 CE07 29                                   .byte mne_rolx        ; $2E  ROL abs
   4747 CE08 1D                                   .byte mne_andx        ; $2F  AND absl
                                        ;
   4749 CE09 24                                   .byte mne_bmix        ; $30  BMI abs
   4750 CE0A 1D                                   .byte mne_andx        ; $31  AND (dp),Y
   4751 CE0B 1D                                   .byte mne_andx        ; $32  AND (dp)
   4752 CE0C 1D                                   .byte mne_andx        ; $33  AND (offset,S),Y
   4753 CE0D 46                                   .byte mne_bitx        ; $34  BIT dp,X
   4754 CE0E 1D                                   .byte mne_andx        ; $35  AND dp,X
   4755 CE0F 29                                   .byte mne_rolx        ; $36  ROL dp,X
   4756 CE10 1D                                   .byte mne_andx        ; $37  AND [dp],Y
   4757 CE11 13                                   .byte mne_secx        ; $38  SEC
   4758 CE12 1D                                   .byte mne_andx        ; $39  AND abs,Y
   4759 CE13 12                                   .byte mne_decx        ; $3A  DEC A
   4760 CE14 16                                   .byte mne_tscx        ; $3B  TSC
   4761 CE15 46                                   .byte mne_bitx        ; $3C  BIT abs,X
   4762 CE16 1D                                   .byte mne_andx        ; $3D  AND abs,X
   4763 CE17 29                                   .byte mne_rolx        ; $3E  ROL abs,X
   4764 CE18 1D                                   .byte mne_andx        ; $3F  AND absl,X
                                        ;
   4766 CE19 25                                   .byte mne_rtix        ; $40  RTI
   4767 CE1A 3D                                   .byte mne_eorx        ; $41  EOR (dp,X)
   4768 CE1B 2F                                   .byte mne_wdmx        ; $42  WDM
   4769 CE1C 3D                                   .byte mne_eorx        ; $43  EOR offset,S
   4770 CE1D 3A                                   .byte mne_mvpx        ; $44  MVP sb,db
   4771 CE1E 3D                                   .byte mne_eorx        ; $45  EOR dp
   4772 CE1F 40                                   .byte mne_lsrx        ; $46  LSR dp
   4773 CE20 3D                                   .byte mne_eorx        ; $47  EOR [dp]
   4774 CE21 03                                   .byte mne_phax        ; $48  PHA
   4775 CE22 3D                                   .byte mne_eorx        ; $49  EOR #
   4776 CE23 40                                   .byte mne_lsrx        ; $4A  LSR A
   4777 CE24 26                                   .byte mne_phkx        ; $4B  PHK
   4778 CE25 36                                   .byte mne_jmpx        ; $4C  JMP abs
   4779 CE26 3D                                   .byte mne_eorx        ; $4D  EOR abs
   4780 CE27 40                                   .byte mne_lsrx        ; $4E  LSR abs
   4781 CE28 3D                                   .byte mne_eorx        ; $4F  EOR absl
                                        ;
   4783 CE29 17                                   .byte mne_bvcx        ; $50  BVC abs
   4784 CE2A 3D                                   .byte mne_eorx        ; $51  EOR (dp),Y
   4785 CE2B 3D                                   .byte mne_eorx        ; $52  EOR (dp)
   4786 CE2C 3D                                   .byte mne_eorx        ; $53  EOR (offset,S),Y
   4787 CE2D 30                                   .byte mne_mvnx        ; $54  MVN sb,db
   4788 CE2E 3D                                   .byte mne_eorx        ; $55  EOR dp,X
   4789 CE2F 40                                   .byte mne_lsrx        ; $56  LSR dp,X
   4790 CE30 3D                                   .byte mne_eorx        ; $57  EOR [dp],Y
   4791 CE31 23                                   .byte mne_clix        ; $58  CLI
   4792 CE32 3D                                   .byte mne_eorx        ; $59  EOR abs,Y
   4793 CE33 55                                   .byte mne_phyx        ; $5A  PHY
   4794 CE34 18                                   .byte mne_tcdx        ; $5B  TCD
   4795 CE35 28                                   .byte mne_jmlx        ; $5C  JML absl
   4796 CE36 3D                                   .byte mne_eorx        ; $5D  EOR abs,X
   4797 CE37 40                                   .byte mne_lsrx        ; $5E  LSR abs,X
   4798 CE38 3D                                   .byte mne_eorx        ; $5F  EOR absl,X
                                        ;
   4800 CE39 43                                   .byte mne_rtsx        ; $60  RTS
   4801 CE3A 10                                   .byte mne_adcx        ; $61  ADC (dp,X)
   4802 CE3B 3C                                   .byte mne_perx        ; $62  PER
   4803 CE3C 10                                   .byte mne_adcx        ; $63  ADC offset,S
   4804 CE3D 5B                                   .byte mne_stzx        ; $64  STZ dp
   4805 CE3E 10                                   .byte mne_adcx        ; $65  ADC dp
   4806 CE3F 3E                                   .byte mne_rorx        ; $66  ROR dp
   4807 CE40 10                                   .byte mne_adcx        ; $67  ADC [dp]
   4808 CE41 04                                   .byte mne_plax        ; $68  PLA
   4809 CE42 10                                   .byte mne_adcx        ; $69  ADC #
   4810 CE43 3E                                   .byte mne_rorx        ; $6A  ROR A
   4811 CE44 2E                                   .byte mne_rtlx        ; $6B  RTL
   4812 CE45 36                                   .byte mne_jmpx        ; $6C  JMP (abs)
   4813 CE46 10                                   .byte mne_adcx        ; $6D  ADC abs
   4814 CE47 3E                                   .byte mne_rorx        ; $6E  ROR abs
   4815 CE48 10                                   .byte mne_adcx        ; $6F  ADC absl
                                        ;
   4817 CE49 44                                   .byte mne_bvsx        ; $70  BVS abs
   4818 CE4A 10                                   .byte mne_adcx        ; $71  ADC (dp),Y
   4819 CE4B 10                                   .byte mne_adcx        ; $72  ADC (dp)
   4820 CE4C 10                                   .byte mne_adcx        ; $73  ADC (offset,S),Y
   4821 CE4D 5B                                   .byte mne_stzx        ; $74  STZ dp,X
   4822 CE4E 10                                   .byte mne_adcx        ; $75  ADC dp,X
   4823 CE4F 3E                                   .byte mne_rorx        ; $76  ROR dp,X
   4824 CE50 10                                   .byte mne_adcx        ; $77  ADC [dp],Y
   4825 CE51 22                                   .byte mne_seix        ; $78  SEI
   4826 CE52 10                                   .byte mne_adcx        ; $79  ADC abs,Y
   4827 CE53 56                                   .byte mne_plyx        ; $7A  PLY
   4828 CE54 11                                   .byte mne_tdcx        ; $7B  TDC
   4829 CE55 36                                   .byte mne_jmpx        ; $7C  JMP (abs,X)
   4830 CE56 10                                   .byte mne_adcx        ; $7D  ADC abs,X
   4831 CE57 3E                                   .byte mne_rorx        ; $7E  ROR abs,X
   4832 CE58 10                                   .byte mne_adcx        ; $7F  ADC absl,X
                                        ;
   4834 CE59 05                                   .byte mne_brax        ; $80  BRA abs
   4835 CE5A 07                                   .byte mne_stax        ; $81  STA (dp,X)
   4836 CE5B 2B                                   .byte mne_brlx        ; $82  BRL abs
   4837 CE5C 07                                   .byte mne_stax        ; $83  STA offset,S
   4838 CE5D 59                                   .byte mne_styx        ; $84  STY dp
   4839 CE5E 07                                   .byte mne_stax        ; $85  STA dp
   4840 CE5F 50                                   .byte mne_stxx        ; $86  STX dp
   4841 CE60 07                                   .byte mne_stax        ; $87  STA [dp]
   4842 CE61 54                                   .byte mne_deyx        ; $88  DEY
   4843 CE62 46                                   .byte mne_bitx        ; $89  BIT #
   4844 CE63 08                                   .byte mne_txax        ; $8A  TXA
   4845 CE64 0A                                   .byte mne_phbx        ; $8B  PHB
   4846 CE65 59                                   .byte mne_styx        ; $8C  STY abs
   4847 CE66 07                                   .byte mne_stax        ; $8D  STA abs
   4848 CE67 50                                   .byte mne_stxx        ; $8E  STX abs
   4849 CE68 07                                   .byte mne_stax        ; $8F  STA absl
                                        ;
   4851 CE69 0F                                   .byte mne_bccx        ; $90  BCC abs
   4852 CE6A 07                                   .byte mne_stax        ; $91  STA (dp),Y
   4853 CE6B 07                                   .byte mne_stax        ; $92  STA (dp)
   4854 CE6C 07                                   .byte mne_stax        ; $93  STA (offset,S),Y
   4855 CE6D 59                                   .byte mne_styx        ; $94  STY dp,X
   4856 CE6E 07                                   .byte mne_stax        ; $95  STA dp,X
   4857 CE6F 50                                   .byte mne_stxx        ; $96  STX dp,Y
   4858 CE70 07                                   .byte mne_stax        ; $97  STA [dp],Y
   4859 CE71 09                                   .byte mne_tyax        ; $98  TYA
   4860 CE72 07                                   .byte mne_stax        ; $99  STA abs,Y
   4861 CE73 45                                   .byte mne_txsx        ; $9A  TXS
   4862 CE74 5A                                   .byte mne_txyx        ; $9B  TXY
   4863 CE75 5B                                   .byte mne_stzx        ; $9C  STZ abs
   4864 CE76 07                                   .byte mne_stax        ; $9D  STA abs,X
   4865 CE77 5B                                   .byte mne_stzx        ; $9E  STZ abs,X
   4866 CE78 07                                   .byte mne_stax        ; $9F  STA absl,X
                                        ;
   4868 CE79 53                                   .byte mne_ldyx        ; $A0  LDY #
   4869 CE7A 01                                   .byte mne_ldax        ; $A1  LDA (dp,X)
   4870 CE7B 49                                   .byte mne_ldxx        ; $A2  LDX #
   4871 CE7C 01                                   .byte mne_ldax        ; $A3  LDA offset,S
   4872 CE7D 53                                   .byte mne_ldyx        ; $A4  LDY dp
   4873 CE7E 01                                   .byte mne_ldax        ; $A5  LDA dp
   4874 CE7F 49                                   .byte mne_ldxx        ; $A6  LDX dp
   4875 CE80 01                                   .byte mne_ldax        ; $A7  LDA [dp]
   4876 CE81 52                                   .byte mne_tayx        ; $A8  TAY
   4877 CE82 01                                   .byte mne_ldax        ; $A9  LDA #
   4878 CE83 48                                   .byte mne_taxx        ; $AA  TAX
   4879 CE84 0B                                   .byte mne_plbx        ; $AB  PLB
   4880 CE85 53                                   .byte mne_ldyx        ; $AC  LDY abs
   4881 CE86 01                                   .byte mne_ldax        ; $AD  LDA abs
   4882 CE87 49                                   .byte mne_ldxx        ; $AE  LDX abs
   4883 CE88 01                                   .byte mne_ldax        ; $AF  LDA absl
                                        ;
   4885 CE89 41                                   .byte mne_bcsx        ; $B0  BCS abs
   4886 CE8A 01                                   .byte mne_ldax        ; $B1  LDA (dp),Y
   4887 CE8B 01                                   .byte mne_ldax        ; $B2  LDA (dp)
   4888 CE8C 01                                   .byte mne_ldax        ; $B3  LDA (offset,S),Y
   4889 CE8D 53                                   .byte mne_ldyx        ; $B4  LDY dp,X
   4890 CE8E 01                                   .byte mne_ldax        ; $B5  LDA dp,X
   4891 CE8F 49                                   .byte mne_ldxx        ; $B6  LDX dp,Y
   4892 CE90 01                                   .byte mne_ldax        ; $B7  LDA [dp],Y
   4893 CE91 47                                   .byte mne_clvx        ; $B8  CLV
   4894 CE92 01                                   .byte mne_ldax        ; $B9  LDA abs,Y
   4895 CE93 4F                                   .byte mne_tsxx        ; $BA  TSX
   4896 CE94 51                                   .byte mne_tyxx        ; $BB  TYX
   4897 CE95 53                                   .byte mne_ldyx        ; $BC  LDY abs,X
   4898 CE96 01                                   .byte mne_ldax        ; $BD  LDA abs,X
   4899 CE97 49                                   .byte mne_ldxx        ; $BE  LDX abs,Y
   4900 CE98 01                                   .byte mne_ldax        ; $BF  LDA absl,X
                                        ;
   4902 CE99 58                                   .byte mne_cpyx        ; $C0  CPY #
   4903 CE9A 35                                   .byte mne_cmpx        ; $C1  CMP (dp,X)
   4904 CE9B 31                                   .byte mne_repx        ; $C2  REP #
   4905 CE9C 35                                   .byte mne_cmpx        ; $C3  CMP offset,S
   4906 CE9D 58                                   .byte mne_cpyx        ; $C4  CPY dp
   4907 CE9E 35                                   .byte mne_cmpx        ; $C5  CMP dp
   4908 CE9F 12                                   .byte mne_decx        ; $C6  DEC dp
   4909 CEA0 35                                   .byte mne_cmpx        ; $C7  CMP [dp]
   4910 CEA1 57                                   .byte mne_inyx        ; $C8  INY
   4911 CEA2 35                                   .byte mne_cmpx        ; $C9  CMP #
   4912 CEA3 4A                                   .byte mne_dexx        ; $CA  DEX
   4913 CEA4 20                                   .byte mne_waix        ; $CB  WAI
   4914 CEA5 58                                   .byte mne_cpyx        ; $CC  CPY abs
   4915 CEA6 35                                   .byte mne_cmpx        ; $CD  CMP abs
   4916 CEA7 12                                   .byte mne_decx        ; $CE  DEC abs
   4917 CEA8 35                                   .byte mne_cmpx        ; $CF  CMP absl
                                        ;
   4919 CEA9 1F                                   .byte mne_bnex        ; $D0  BNE abs
   4920 CEAA 35                                   .byte mne_cmpx        ; $D1  CMP (dp),Y
   4921 CEAB 35                                   .byte mne_cmpx        ; $D2  CMP (dp)
   4922 CEAC 35                                   .byte mne_cmpx        ; $D3  CMP (offset,S),Y
   4923 CEAD 21                                   .byte mne_peix        ; $D4  PEI dp
   4924 CEAE 35                                   .byte mne_cmpx        ; $D5  CMP dp,X
   4925 CEAF 12                                   .byte mne_decx        ; $D6  DEC dp,X
   4926 CEB0 35                                   .byte mne_cmpx        ; $D7  CMP [dp],Y
   4927 CEB1 1B                                   .byte mne_cldx        ; $D8  CLD
   4928 CEB2 35                                   .byte mne_cmpx        ; $D9  CMP abs,Y
   4929 CEB3 4B                                   .byte mne_phxx        ; $DA  PHX
   4930 CEB4 39                                   .byte mne_stpx        ; $DB  STP
   4931 CEB5 36                                   .byte mne_jmpx        ; $DC  JMP [abs]
   4932 CEB6 35                                   .byte mne_cmpx        ; $DD  CMP abs,X
   4933 CEB7 12                                   .byte mne_decx        ; $DE  DEC abs,X
   4934 CEB8 35                                   .byte mne_cmpx        ; $DF  CMP absl,X
                                        ;
   4936 CEB9 4E                                   .byte mne_cpxx        ; $E0  CPX #
   4937 CEBA 0E                                   .byte mne_sbcx        ; $E1  SBC (dp,X)
   4938 CEBB 32                                   .byte mne_sepx        ; $E2  SEP #
   4939 CEBC 0E                                   .byte mne_sbcx        ; $E3  SBC offset,S
   4940 CEBD 4E                                   .byte mne_cpxx        ; $E4  CPX dp
   4941 CEBE 0E                                   .byte mne_sbcx        ; $E5  SBC dp
   4942 CEBF 15                                   .byte mne_incx        ; $E6  INC dp
   4943 CEC0 0E                                   .byte mne_sbcx        ; $E7  SBC [dp]
   4944 CEC1 4D                                   .byte mne_inxx        ; $E8  INX
   4945 CEC2 0E                                   .byte mne_sbcx        ; $E9  SBC #
   4946 CEC3 38                                   .byte mne_nopx        ; $EA  NOP
   4947 CEC4 00                                   .byte mne_xbax        ; $EB  XBA
   4948 CEC5 4E                                   .byte mne_cpxx        ; $EC  CPX abs
   4949 CEC6 0E                                   .byte mne_sbcx        ; $ED  SBC abs
   4950 CEC7 15                                   .byte mne_incx        ; $EE  INC abs
   4951 CEC8 0E                                   .byte mne_sbcx        ; $EF  SBC absl
                                        ;
   4953 CEC9 3B                                   .byte mne_beqx        ; $F0  BEQ abs
   4954 CECA 0E                                   .byte mne_sbcx        ; $F1  SBC (dp),Y
   4955 CECB 0E                                   .byte mne_sbcx        ; $F2  SBC (dp)
   4956 CECC 0E                                   .byte mne_sbcx        ; $F3  SBC (offset,S),Y
   4957 CECD 02                                   .byte mne_peax        ; $F4  PEA #
   4958 CECE 0E                                   .byte mne_sbcx        ; $F5  SBC dp,X
   4959 CECF 15                                   .byte mne_incx        ; $F6  INC dp,X
   4960 CED0 0E                                   .byte mne_sbcx        ; $F7  SBC [dp],Y
   4961 CED1 19                                   .byte mne_sedx        ; $F8  SED
   4962 CED2 0E                                   .byte mne_sbcx        ; $F9  SBC abs,Y
   4963 CED3 4C                                   .byte mne_plxx        ; $FA  PLX
   4964 CED4 1E                                   .byte mne_xcex        ; $FB  XCE
   4965 CED5 3F                                   .byte mne_jsrx        ; $FC  JSR (abs,X)
   4966 CED6 0E                                   .byte mne_sbcx        ; $FD  SBC abs,X
   4967 CED7 15                                   .byte mne_incx        ; $FE  INC abs,X
   4968 CED8 0E                                   .byte mne_sbcx        ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	instruction addressing modes & sizes in opcode order...
                                        ;
                                        ;	    xxxxxxxx
                                        ;	    ||||||||
                                        ;	    ||||++++———> Addressing Mode
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||          0000  dp, abs, absl, implied or A
                                        ;	    ||||          0001  #
                                        ;	    ||||          0010  dp,X, abs,X or absl,X
                                        ;	    ||||          0011  dp,Y or abs,Y
                                        ;	    ||||          0100  (dp) or (abs)
                                        ;	    ||||          0101  [dp] or [abs]
                                        ;	    ||||          0110  [dp],Y
                                        ;	    ||||          0111  (dp,X) or (abs,X)
                                        ;	    ||||          1000  (dp),Y
                                        ;	    ||||          1001  offset,S
                                        ;	    ||||          1010  (offset,S),Y
                                        ;	    ||||          1011  sbnk,dbnk (MVN or MVP)
                                        ;	    ||||          —-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—-—
                                        ;	    ||||           #    = immediate
                                        ;	    ||||           A    = accumulator
                                        ;	    ||||           abs  = absolute
                                        ;	    ||||           absl = absolute long
                                        ;	    ||||           dbnk = destination bank
                                        ;	    ||||           dp   = direct (zero) page
                                        ;	    ||||           S    = stack relative
                                        ;	    ||||           sbnk = source bank
                                        ;	    ||||         ——————————————————————————————————
                                        ;	    ||||
                                        ;	    ||++———————> binary-encoded operand size
                                        ;	    |+—————————> 1: relative branch instruction
                                        ;	    +——————————> 1: variable operand size...
                                        ;
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;	    Variable operand size refers to an immediate mode instruction
                                        ;	    that can accept either an 8 or 16 bit operand.  During instr-
                                        ;	    uction assembly, an 8 bit operand can be forced to 16 bits by
                                        ;	    preceding the operand field with !,  e.g.,  LDA !#$01,  which
                                        ;	    will assemble as $A9 $01 $00.
                                        ;	    —————————————————————————————————————————————————————————————
                                        ;
   5012 CED9 00                         mnetabam .byte ops0 | am_nam   ; $00  BRK
   5013 CEDA 17                                   .byte ops1 | am_indx  ; $01  ORA (dp,X)
   5014 CEDB 10                                   .byte ops1 | am_nam   ; $02  COP
   5015 CEDC 19                                   .byte ops1 | am_stk   ; $03  ORA offset,S
   5016 CEDD 10                                   .byte ops1 | am_nam   ; $04  TSB dp
   5017 CEDE 10                                   .byte ops1 | am_nam   ; $05  ORA dp
   5018 CEDF 10                                   .byte ops1 | am_nam   ; $06  ASL dp
   5019 CEE0 15                                   .byte ops1 | am_indl  ; $07  ORA [dp]
   5020 CEE1 00                                   .byte ops0 | am_nam   ; $08  PHP
   5021 CEE2 91                                   .byte vops | am_imm   ; $09  ORA #
   5022 CEE3 00                                   .byte ops0 | am_nam   ; $0A  ASL A
   5023 CEE4 00                                   .byte ops0 | am_nam   ; $0B  PHD
   5024 CEE5 20                                   .byte ops2 | am_nam   ; $0C  TSB abs
   5025 CEE6 20                                   .byte ops2 | am_nam   ; $0D  ORA abs
   5026 CEE7 20                                   .byte ops2 | am_nam   ; $0E  ASL abs
   5027 CEE8 30                                   .byte ops3 | am_nam   ; $0F  ORA absl
                                        ;
   5029 CEE9 50                                   .byte bop1 | am_nam   ; $10  BPL abs
   5030 CEEA 18                                   .byte ops1 | am_indy  ; $11  ORA (dp),Y
   5031 CEEB 14                                   .byte ops1 | am_ind   ; $12  ORA (dp)
   5032 CEEC 1A                                   .byte ops1 | am_stky  ; $13  ORA (offset,S),Y
   5033 CEED 10                                   .byte ops1 | am_nam   ; $14  TRB dp
   5034 CEEE 12                                   .byte ops1 | am_adrx  ; $15  ORA dp,X
   5035 CEEF 12                                   .byte ops1 | am_adrx  ; $16  ASL dp,X
   5036 CEF0 16                                   .byte ops1 | am_indly ; $17  ORA [dp],Y
   5037 CEF1 00                                   .byte ops0 | am_nam   ; $18  CLC
   5038 CEF2 20                                   .byte ops2 | am_nam   ; $19  ORA abs
   5039 CEF3 00                                   .byte ops0 | am_nam   ; $1A  INC A
   5040 CEF4 00                                   .byte ops0 | am_nam   ; $1B  TCS
   5041 CEF5 20                                   .byte ops2 | am_nam   ; $1C  TRB abs
   5042 CEF6 22                                   .byte ops2 | am_adrx  ; $1D  ORA abs,X
   5043 CEF7 22                                   .byte ops2 | am_adrx  ; $1E  ASL abs,X
   5044 CEF8 32                                   .byte ops3 | am_adrx  ; $1F  ORA absl,X
                                        ;
   5046 CEF9 20                                   .byte ops2 | am_nam   ; $20  JSR abs
   5047 CEFA 17                                   .byte ops1 | am_indx  ; $21  AND (dp,X)
   5048 CEFB 30                                   .byte ops3 | am_nam   ; $22  JSL absl
   5049 CEFC 19                                   .byte ops1 | am_stk   ; $23  AND offset,S
   5050 CEFD 10                                   .byte ops1 | am_nam   ; $24  BIT dp
   5051 CEFE 10                                   .byte ops1 | am_nam   ; $25  AND dp
   5052 CEFF 10                                   .byte ops1 | am_nam   ; $26  ROL dp
   5053 CF00 15                                   .byte ops1 | am_indl  ; $27  AND [dp]
   5054 CF01 00                                   .byte ops0 | am_nam   ; $28  PLP
   5055 CF02 91                                   .byte vops | am_imm   ; $29  AND #
   5056 CF03 00                                   .byte ops0 | am_nam   ; $2A  ROL A
   5057 CF04 00                                   .byte ops0 | am_nam   ; $2B  PLD
   5058 CF05 20                                   .byte ops2 | am_nam   ; $2C  BIT abs
   5059 CF06 20                                   .byte ops2 | am_nam   ; $2D  AND abs
   5060 CF07 20                                   .byte ops2 | am_nam   ; $2E  ROL abs
   5061 CF08 30                                   .byte ops3 | am_nam   ; $2F  AND absl
                                        ;
   5063 CF09 50                                   .byte bop1 | am_nam   ; $30  BMI abs
   5064 CF0A 18                                   .byte ops1 | am_indy  ; $31  AND (dp),Y
   5065 CF0B 14                                   .byte ops1 | am_ind   ; $32  AND (dp)
   5066 CF0C 1A                                   .byte ops1 | am_stky  ; $33  AND (offset,S),Y
   5067 CF0D 12                                   .byte ops1 | am_adrx  ; $34  BIT dp,X
   5068 CF0E 12                                   .byte ops1 | am_adrx  ; $35  AND dp,X
   5069 CF0F 12                                   .byte ops1 | am_adrx  ; $36  ROL dp,X
   5070 CF10 16                                   .byte ops1 | am_indly ; $37  AND [dp],Y
   5071 CF11 00                                   .byte ops0 | am_nam   ; $38  SEC
   5072 CF12 23                                   .byte ops2 | am_adry  ; $39  AND abs,Y
   5073 CF13 00                                   .byte ops0 | am_nam   ; $3A  DEC A
   5074 CF14 00                                   .byte ops0 | am_nam   ; $3B  TSC
   5075 CF15 22                                   .byte ops2 | am_adrx  ; $3C  BIT abs,X
   5076 CF16 22                                   .byte ops2 | am_adrx  ; $3D  AND abs,X
   5077 CF17 22                                   .byte ops2 | am_adrx  ; $3E  ROL abs,X
   5078 CF18 32                                   .byte ops3 | am_adrx  ; $3F  AND absl,X
                                        ;
   5080 CF19 00                                   .byte ops0 | am_nam   ; $40  RTI
   5081 CF1A 17                                   .byte ops1 | am_indx  ; $41  EOR (dp,X)
   5082 CF1B 00                                   .byte ops0 | am_nam   ; $42  WDM
   5083 CF1C 19                                   .byte ops1 | am_stk   ; $43  EOR offset,S
   5084 CF1D 2B                                   .byte ops2 | am_move  ; $44  MVP sb,db
   5085 CF1E 10                                   .byte ops1 | am_nam   ; $45  EOR dp
   5086 CF1F 10                                   .byte ops1 | am_nam   ; $46  LSR dp
   5087 CF20 15                                   .byte ops1 | am_indl  ; $47  EOR [dp]
   5088 CF21 00                                   .byte ops0 | am_nam   ; $48  PHA
   5089 CF22 91                                   .byte vops | am_imm   ; $49  EOR #
   5090 CF23 00                                   .byte ops0 | am_nam   ; $4A  LSR A
   5091 CF24 00                                   .byte ops0 | am_nam   ; $4B  PHK
   5092 CF25 20                                   .byte ops2 | am_nam   ; $4C  JMP abs
   5093 CF26 20                                   .byte ops2 | am_nam   ; $4D  EOR abs
   5094 CF27 20                                   .byte ops2 | am_nam   ; $4E  LSR abs
   5095 CF28 30                                   .byte ops3 | am_nam   ; $4F  EOR absl
                                        ;
   5097 CF29 50                                   .byte bop1 | am_nam   ; $50  BVC abs
   5098 CF2A 18                                   .byte ops1 | am_indy  ; $51  EOR (dp),Y
   5099 CF2B 14                                   .byte ops1 | am_ind   ; $52  EOR (dp)
   5100 CF2C 1A                                   .byte ops1 | am_stky  ; $53  EOR (offset,S),Y
   5101 CF2D 2B                                   .byte ops2 | am_move  ; $54  MVN sb,db
   5102 CF2E 12                                   .byte ops1 | am_adrx  ; $55  EOR dp,X
   5103 CF2F 12                                   .byte ops1 | am_adrx  ; $56  LSR dp,X
   5104 CF30 16                                   .byte ops1 | am_indly ; $57  EOR [dp],Y
   5105 CF31 00                                   .byte ops0 | am_nam   ; $58  CLI
   5106 CF32 23                                   .byte ops2 | am_adry  ; $59  EOR abs,Y
   5107 CF33 00                                   .byte ops0 | am_nam   ; $5A  PHY
   5108 CF34 00                                   .byte ops0 | am_nam   ; $5B  TCD
   5109 CF35 30                                   .byte ops3 | am_nam   ; $5C  JML absl
   5110 CF36 22                                   .byte ops2 | am_adrx  ; $5D  EOR abs,X
   5111 CF37 22                                   .byte ops2 | am_adrx  ; $5E  LSR abs,X
   5112 CF38 32                                   .byte ops3 | am_adrx  ; $5F  EOR absl,X
                                        ;
   5114 CF39 00                                   .byte ops0 | am_nam   ; $60  RTS
   5115 CF3A 17                                   .byte ops1 | am_indx  ; $61  ADC (dp,X)
   5116 CF3B 60                                   .byte bop2 | am_nam   ; $62  PER
   5117 CF3C 19                                   .byte ops1 | am_stk   ; $63  ADC offset,S
   5118 CF3D 10                                   .byte ops1 | am_nam   ; $64  STZ dp
   5119 CF3E 10                                   .byte ops1 | am_nam   ; $65  ADC dp
   5120 CF3F 10                                   .byte ops1 | am_nam   ; $66  ROR dp
   5121 CF40 15                                   .byte ops1 | am_indl  ; $67  ADC [dp]
   5122 CF41 00                                   .byte ops0 | am_nam   ; $68  PLA
   5123 CF42 91                                   .byte vops | am_imm   ; $69  ADC #
   5124 CF43 00                                   .byte ops0 | am_nam   ; $6A  ROR A
   5125 CF44 00                                   .byte ops0 | am_nam   ; $6B  RTL
   5126 CF45 24                                   .byte ops2 | am_ind   ; $6C  JMP (abs)
   5127 CF46 20                                   .byte ops2 | am_nam   ; $6D  ADC abs
   5128 CF47 20                                   .byte ops2 | am_nam   ; $6E  ROR abs
   5129 CF48 30                                   .byte ops3 | am_nam   ; $6F  ADC absl
                                        ;
   5131 CF49 50                                   .byte bop1 | am_nam   ; $70  BVS abs
   5132 CF4A 18                                   .byte ops1 | am_indy  ; $71  ADC (dp),Y
   5133 CF4B 14                                   .byte ops1 | am_ind   ; $72  ADC (dp)
   5134 CF4C 1A                                   .byte ops1 | am_stky  ; $73  ADC (offset,S),Y
   5135 CF4D 12                                   .byte ops1 | am_adrx  ; $74  STZ dp,X
   5136 CF4E 12                                   .byte ops1 | am_adrx  ; $75  ADC dp,X
   5137 CF4F 12                                   .byte ops1 | am_adrx  ; $76  ROR dp,X
   5138 CF50 16                                   .byte ops1 | am_indly ; $77  ADC [dp],Y
   5139 CF51 00                                   .byte ops0 | am_nam   ; $78  SEI
   5140 CF52 23                                   .byte ops2 | am_adry  ; $79  ADC abs,Y
   5141 CF53 00                                   .byte ops0 | am_nam   ; $7A  PLY
   5142 CF54 00                                   .byte ops0 | am_nam   ; $7B  TDC
   5143 CF55 27                                   .byte ops2 | am_indx  ; $7C  JMP (abs,X)
   5144 CF56 22                                   .byte ops2 | am_adrx  ; $7D  ADC abs,X
   5145 CF57 22                                   .byte ops2 | am_adrx  ; $7E  ROR abs,X
   5146 CF58 32                                   .byte ops3 | am_adrx  ; $7F  ADC absl,X
                                        ;
   5148 CF59 50                                   .byte bop1 | am_nam   ; $80  BRA abs
   5149 CF5A 17                                   .byte ops1 | am_indx  ; $81  STA (dp,X)
   5150 CF5B 60                                   .byte bop2 | am_nam   ; $82  BRL abs
   5151 CF5C 19                                   .byte ops1 | am_stk   ; $83  STA offset,S
   5152 CF5D 10                                   .byte ops1 | am_nam   ; $84  STY dp
   5153 CF5E 10                                   .byte ops1 | am_nam   ; $85  STA dp
   5154 CF5F 10                                   .byte ops1 | am_nam   ; $86  STX dp
   5155 CF60 15                                   .byte ops1 | am_indl  ; $87  STA [dp]
   5156 CF61 00                                   .byte ops0 | am_nam   ; $88  DEY
   5157 CF62 91                                   .byte vops | am_imm   ; $89  BIT #
   5158 CF63 00                                   .byte ops0 | am_nam   ; $8A  TXA
   5159 CF64 00                                   .byte ops0 | am_nam   ; $8B  PHB
   5160 CF65 20                                   .byte ops2 | am_nam   ; $8C  STY abs
   5161 CF66 20                                   .byte ops2 | am_nam   ; $8D  STA abs
   5162 CF67 20                                   .byte ops2 | am_nam   ; $8E  STX abs
   5163 CF68 30                                   .byte ops3 | am_nam   ; $8F  STA absl
                                        ;
   5165 CF69 50                                   .byte bop1 | am_nam   ; $90  BCC abs
   5166 CF6A 18                                   .byte ops1 | am_indy  ; $91  STA (dp),Y
   5167 CF6B 14                                   .byte ops1 | am_ind   ; $92  STA (dp)
   5168 CF6C 1A                                   .byte ops1 | am_stky  ; $93  STA (offset,S),Y
   5169 CF6D 12                                   .byte ops1 | am_adrx  ; $94  STY dp,X
   5170 CF6E 12                                   .byte ops1 | am_adrx  ; $95  STA dp,X
   5171 CF6F 13                                   .byte ops1 | am_adry  ; $96  STX dp,Y
   5172 CF70 16                                   .byte ops1 | am_indly ; $97  STA [dp],Y
   5173 CF71 00                                   .byte ops0 | am_nam   ; $98  TYA
   5174 CF72 23                                   .byte ops2 | am_adry  ; $99  STA abs,Y
   5175 CF73 00                                   .byte ops0 | am_nam   ; $9A  TXS
   5176 CF74 00                                   .byte ops0 | am_nam   ; $9B  TXY
   5177 CF75 20                                   .byte ops2 | am_nam   ; $9C  STZ abs
   5178 CF76 22                                   .byte ops2 | am_adrx  ; $9D  STA abs,X
   5179 CF77 22                                   .byte ops2 | am_adrx  ; $9E  STZ abs,X
   5180 CF78 32                                   .byte ops3 | am_adrx  ; $9F  STA absl,X
                                        ;
   5182 CF79 91                                   .byte vops | am_imm   ; $A0  LDY #
   5183 CF7A 17                                   .byte ops1 | am_indx  ; $A1  LDA (dp,X)
   5184 CF7B 91                                   .byte vops | am_imm   ; $A2  LDX #
   5185 CF7C 19                                   .byte ops1 | am_stk   ; $A3  LDA offset,S
   5186 CF7D 10                                   .byte ops1 | am_nam   ; $A4  LDY dp
   5187 CF7E 10                                   .byte ops1 | am_nam   ; $A5  LDA dp
   5188 CF7F 10                                   .byte ops1 | am_nam   ; $A6  LDX dp
   5189 CF80 15                                   .byte ops1 | am_indl  ; $A7  LDA [dp]
   5190 CF81 00                                   .byte ops0 | am_nam   ; $A8  TAY
   5191 CF82 91                                   .byte vops | am_imm   ; $A9  LDA #
   5192 CF83 00                                   .byte ops0 | am_nam   ; $AA  TAX
   5193 CF84 00                                   .byte ops0 | am_nam   ; $AB  PLB
   5194 CF85 20                                   .byte ops2 | am_nam   ; $AC  LDY abs
   5195 CF86 20                                   .byte ops2 | am_nam   ; $AD  LDA abs
   5196 CF87 20                                   .byte ops2 | am_nam   ; $AE  LDX abs
   5197 CF88 30                                   .byte ops3 | am_nam   ; $AF  LDA absl
                                        ;
   5199 CF89 50                                   .byte bop1 | am_nam   ; $B0  BCS abs
   5200 CF8A 18                                   .byte ops1 | am_indy  ; $B1  LDA (dp),Y
   5201 CF8B 14                                   .byte ops1 | am_ind   ; $B2  LDA (dp)
   5202 CF8C 1A                                   .byte ops1 | am_stky  ; $B3  LDA (offset,S),Y
   5203 CF8D 12                                   .byte ops1 | am_adrx  ; $B4  LDY dp,X
   5204 CF8E 12                                   .byte ops1 | am_adrx  ; $B5  LDA dp,X
   5205 CF8F 13                                   .byte ops1 | am_adry  ; $B6  LDX dp,Y
   5206 CF90 16                                   .byte ops1 | am_indly ; $B7  LDA [dp],Y
   5207 CF91 00                                   .byte ops0 | am_nam   ; $B8  CLV
   5208 CF92 23                                   .byte ops2 | am_adry  ; $B9  LDA abs,Y
   5209 CF93 00                                   .byte ops0 | am_nam   ; $BA  TSX
   5210 CF94 00                                   .byte ops0 | am_nam   ; $BB  TYX
   5211 CF95 22                                   .byte ops2 | am_adrx  ; $BC  LDY abs,X
   5212 CF96 22                                   .byte ops2 | am_adrx  ; $BD  LDA abs,X
   5213 CF97 23                                   .byte ops2 | am_adry  ; $BE  LDX abs,Y
   5214 CF98 32                                   .byte ops3 | am_adrx  ; $BF  LDA absl,X
                                        ;
   5216 CF99 91                                   .byte vops | am_imm   ; $C0  CPY #
   5217 CF9A 17                                   .byte ops1 | am_indx  ; $C1  CMP (dp,X)
   5218 CF9B 11                                   .byte ops1 | am_imm   ; $C2  REP #
   5219 CF9C 19                                   .byte ops1 | am_stk   ; $C3  CMP offset,S
   5220 CF9D 10                                   .byte ops1 | am_nam   ; $C4  CPY dp
   5221 CF9E 10                                   .byte ops1 | am_nam   ; $C5  CMP dp
   5222 CF9F 10                                   .byte ops1 | am_nam   ; $C6  DEC dp
   5223 CFA0 15                                   .byte ops1 | am_indl  ; $C7  CMP [dp]
   5224 CFA1 00                                   .byte ops0 | am_nam   ; $C8  INY
   5225 CFA2 91                                   .byte vops | am_imm   ; $C9  CMP #
   5226 CFA3 00                                   .byte ops0 | am_nam   ; $CA  DEX
   5227 CFA4 00                                   .byte ops0 | am_nam   ; $CB  WAI
   5228 CFA5 20                                   .byte ops2 | am_nam   ; $CC  CPY abs
   5229 CFA6 20                                   .byte ops2 | am_nam   ; $CD  CMP abs
   5230 CFA7 20                                   .byte ops2 | am_nam   ; $CE  DEC abs
   5231 CFA8 30                                   .byte ops3 | am_nam   ; $CF  CMP absl
                                        ;
   5233 CFA9 50                                   .byte bop1 | am_nam   ; $D0  BNE abs
   5234 CFAA 18                                   .byte ops1 | am_indy  ; $D1  CMP (dp),Y
   5235 CFAB 14                                   .byte ops1 | am_ind   ; $D2  CMP (dp)
   5236 CFAC 1A                                   .byte ops1 | am_stky  ; $D3  CMP (offset,S),Y
   5237 CFAD 10                                   .byte ops1 | am_nam   ; $D4  PEI dp
   5238 CFAE 12                                   .byte ops1 | am_adrx  ; $D5  CMP dp,X
   5239 CFAF 12                                   .byte ops1 | am_adrx  ; $D6  DEC dp,X
   5240 CFB0 16                                   .byte ops1 | am_indly ; $D7  CMP [dp],Y
   5241 CFB1 00                                   .byte ops0 | am_nam   ; $D8  CLD
   5242 CFB2 23                                   .byte ops2 | am_adry  ; $D9  CMP abs,Y
   5243 CFB3 00                                   .byte ops0 | am_nam   ; $DA  PHX
   5244 CFB4 00                                   .byte ops0 | am_nam   ; $DB  STP
   5245 CFB5 25                                   .byte ops2 | am_indl  ; $DC  JMP [abs]
   5246 CFB6 22                                   .byte ops2 | am_adrx  ; $DD  CMP abs,X
   5247 CFB7 22                                   .byte ops2 | am_adrx  ; $DE  DEC abs,X
   5248 CFB8 32                                   .byte ops3 | am_adrx  ; $DF  CMP absl,X
                                        ;
   5250 CFB9 91                                   .byte vops | am_imm   ; $E0  CPX #
   5251 CFBA 17                                   .byte ops1 | am_indx  ; $E1  SBC (dp,X)
   5252 CFBB 11                                   .byte ops1 | am_imm   ; $E2  SEP #
   5253 CFBC 19                                   .byte ops1 | am_stk   ; $E3  SBC offset,S
   5254 CFBD 10                                   .byte ops1 | am_nam   ; $E4  CPX dp
   5255 CFBE 10                                   .byte ops1 | am_nam   ; $E5  SBC dp
   5256 CFBF 10                                   .byte ops1 | am_nam   ; $E6  INC dp
   5257 CFC0 15                                   .byte ops1 | am_indl  ; $E7  SBC [dp]
   5258 CFC1 00                                   .byte ops0 | am_nam   ; $E8  INX
   5259 CFC2 91                                   .byte vops | am_imm   ; $E9  SBC #
   5260 CFC3 00                                   .byte ops0 | am_nam   ; $EA  NOP
   5261 CFC4 00                                   .byte ops0 | am_nam   ; $EB  XBA
   5262 CFC5 20                                   .byte ops2 | am_nam   ; $EC  CPX abs
   5263 CFC6 20                                   .byte ops2 | am_nam   ; $ED  SBC abs
   5264 CFC7 20                                   .byte ops2 | am_nam   ; $EE  INC abs
   5265 CFC8 30                                   .byte ops3 | am_nam   ; $EF  SBC absl
                                        ;
   5267 CFC9 50                                   .byte bop1 | am_nam   ; $F0  BEQ abs
   5268 CFCA 18                                   .byte ops1 | am_indy  ; $F1  SBC (dp),Y
   5269 CFCB 14                                   .byte ops1 | am_ind   ; $F2  SBC (dp)
   5270 CFCC 1A                                   .byte ops1 | am_stky  ; $F3  SBC (offset,S),Y
   5271 CFCD 21                                   .byte ops2 | am_imm   ; $F4  PEA #
   5272 CFCE 12                                   .byte ops1 | am_adrx  ; $F5  SBC dp,X
   5273 CFCF 12                                   .byte ops1 | am_adrx  ; $F6  INC dp,X
   5274 CFD0 16                                   .byte ops1 | am_indly ; $F7  SBC [dp],Y
   5275 CFD1 00                                   .byte ops0 | am_nam   ; $F8  SED
   5276 CFD2 23                                   .byte ops2 | am_adry  ; $F9  SBC abs,Y
   5277 CFD3 00                                   .byte ops0 | am_nam   ; $FA  PLX
   5278 CFD4 00                                   .byte ops0 | am_nam   ; $FB  XCE
   5279 CFD5 27                                   .byte ops2 | am_indx  ; $FC  JSR (abs,X)
   5280 CFD6 22                                   .byte ops2 | am_adrx  ; $FD  SBC abs,X
   5281 CFD7 22                                   .byte ops2 | am_adrx  ; $FE  INC abs,X
   5282 CFD8 32                                   .byte ops3 | am_adrx  ; $FF  SBC absl,X
                                        ;
                                        ;
                                        ;	.X & .Y immediate mode opcodes...
                                        ;
   5287 CFD9 A0                         vopidx   .byte $a0             ;LDY #
   5288 CFDA A2                                   .byte $a2             ;LDX #
   5289 CFDB C0                                   .byte $c0             ;CPY #
   5290 CFDC E0                                   .byte $e0             ;CPX #
   5517 = 00000004                      n_vopidx =*-vopidx             ;number of opcodes
                                        ;
                                        ;
                                        ;	addressing mode symbology lookup...
                                        ;
   5296 CFDD F5 CF                      ms_lutab .word ms_nam          ;(0000)  no symbol
   5297 CFDF FF CF                                .word ms_imm          ;(0001)  #
   5298 CFE1 F7 CF                                .word ms_addrx        ;(0010)  dp,X or abs,X
   5299 CFE3 FB CF                                .word ms_addry        ;(0011)  dp,Y or abs,Y
   5300 CFE5 01 D0                                .word ms_ind          ;(0100)  (dp) or (abs)
   5301 CFE7 04 D0                                .word ms_indl         ;(0101)  [dp] or [abs]
   5302 CFE9 07 D0                                .word ms_indly        ;(0110)  [dp],Y
   5303 CFEB 0C D0                                .word ms_indx         ;(0111)  (dp,X) or (abs,X)
   5304 CFED 11 D0                                .word ms_indy         ;(1000)  (dp),Y
   5305 CFEF 19 D0                                .word ms_stk          ;(1001)  offset,S
   5306 CFF1 1D D0                                .word ms_stky         ;(1010) (offset,S),Y
   5307 CFF3 F5 CF                                .word ms_nam          ;(1011) sbnk,dbnk
                                        ;
                                        ;
                                        ;	addressing mode symbology strings...
                                        ;
   5312 CFF5 20 00                      ms_nam   .byte " ",0           ;no symbol
   5313 CFF7 20 2C 58 00                ms_addrx .byte " ,X",0         ;dp,X or addr,X
   5314 CFFB 20 2C 59 00                ms_addry .byte " ,Y",0         ;dp,Y or addr,Y
   5315 CFFF 23 00                      ms_imm   .byte "#",0           ;immediate
   5316 D001 28 29 00                   ms_ind   .byte "()",0          ;(dp) or (abs)
   5317 D004 5B 5D 00                   ms_indl  .byte "[]",0          ;[dp] or [abs]
   5318 D007 5B 5D 2C 59 00             ms_indly .byte "[],Y",0        ;[dp],Y
   5319 D00C 28 2C 58 29 00             ms_indx  .byte "(,X)",0        ;(dp,X) or (abs,X)
   5320 D011 28 29 2C 59 00             ms_indy  .byte "(),Y",0        ;(dp),Y
   5321 D016 2C 24 00                   ms_move  .byte ",$",0          ;MVN/MVP sbnk,dbnk
   5322 D019 20 2C 53 00                ms_stk   .byte " ,S",0         ;offset,S
   5323 D01D 28 2C 53 29 2C 59 00       ms_stky  .byte "(,S),Y",0      ;(offset,S),Y
                                        ;
                                        ;================================================================================
                                        ;
                                        ;CONSOLE DISPLAY CONTROL STRINGS
                                        ;
   5329 D024 1B 28                      dc_bf +         .byte a_esc,"("
   5329 D026 1B 47 34                 +            .byte a_esc,"G4"
                                                            ;enable reverse foreground
   5330 D029 00                                   .byte 0
                                        ;
   5332 D02A 08                         dc_bs +         .byte a_bs
   5332 D02B 1B 57                    +   +         .byte a_esc,"W"
                                        
                                                            ;destructive backspace
   5334 D02D 00                                   .byte 0
                                        ;
   5336 D02E 1B 54                      dc_cl +         .byte a_esc,"T"
                                                            ;clear to end of line 
   5337 D030 00                                   .byte 0
                                        ;
   5339 D031 1B 60 31                   dc_cn +         .byte a_esc,"`1"
                                                            ;cursor on
   5340 D034 00                                   .byte 0
                                        ;
   5342 D035 1B 60 30                   dc_co +         .byte a_esc,"`0"
                                                            ;cursor off
   5343 D038 00                                   .byte 0
                                        ;
   5345 D039 1B 28                      dc_er +         .byte a_esc,"("
   5345 D03B 1B 47 30                 +            .byte a_esc,"G0"
                                                            ;enable normal foreground
   5346 D03E 00                                   .byte 0
                                        ;
   5348 D03F 0D                         dc_lf ++         .byte a_cr
                                     +   
   5348 D040 0A                       +            .byte a_lf
                                                            ;newline
   5349 D041 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;TEXT STRINGS
                                        ;
   5355 D042 07                         mm_brk +         .byte a_bel
                                        
   5356 D043 0D                       +   +         .byte a_cr
                                     +   
   5356 D044 0A                       +            .byte a_lf
                                        
   5357 D045 2A 2A 42 52 4B                       .byte "**BRK"
   5358 D04A 0D                       +   +         .byte a_cr
                                     +   
   5358 D04B 0A                       +            .byte a_lf
                                        
   5359 D04C 00                                   .byte 0
                                        ;
   5361 D04D 0D                         mm_entry ++         .byte a_cr
                                     +   
   5361 D04E 0A                       +            .byte a_lf
                                        
   5362 D04F 0A 53 75 70 65 72 6D 6F              .byte a_lf,"Supermon 832 "
   5362 D057 6E 20 38 33 32 20         
   5363 D05D 31                       +            .byte "1"
   5363 D05E 2E                       +            .byte "."
   5363 D05F 30                       +            .byte "0"
   5363 D060 2E                       +            .byte "."
   5363 D061 30                       +            .byte "0"
                                        
   5364 D062 20                                   .byte " "
   5365 D063 0D                       +   +         .byte a_cr
                                     +   
   5365 D064 0A                       +            .byte a_lf
                                        
   5366 D065 00                                   .byte 0
                                        ;
   5368 D066 20 2A 2A 45 52 52 20 20    mm_err   .byte " **ERR  ",0
   5368 D06E 00                        
                                        ;
   5370 D06F 0D                         mm_prmpt ++         .byte a_cr
                                     +   
   5370 D070 0A                       +            .byte a_lf
                                        
   5371 D071 1B 28                    +            .byte a_esc,"("
   5371 D073 1B 47 30                 +            .byte a_esc,"G0"
                                        
   5372 D076 2E 00                                .byte ".",0
                                        ;
   5374 D078 0D                         mm_regs ++         .byte a_cr
                                     +   
   5374 D079 0A                       +            .byte a_lf
                                        
   5375 D07A 20 20 20 20 20 20 20 20              .byte "                    31"
   5375 D082 20 20 20 20 20 20 20 20   
   5375 D08A 20 20 20 20 33 31         
   5376 D090 0D                       +   +         .byte a_cr
                                     +   
   5376 D091 0A                       +            .byte a_lf
                                        
   5377 D092 20 20 20 20 20 43 53 20              .byte "     CS    PB  PC   26NVmxDIZC    .A       .X       .Y       SP  "
   5377 D09A 20 20 20 50 42 20 20 50   
   5377 D0A2 43 20 20 20 32 36 4E 56   
   5377 D0AA 6D 78 44 49 5A 43 20 20   
   5377 D0B2 20 20 2E 41 20 20 20 20   
   5377 D0BA 20 20 20 2E 58 20 20 20   
   5377 D0C2 20 20 20 20 2E 59 20 20   
   5377 D0CA 20 20 20 20 20 53 50 20   
   5377 D0D2 20                        
   5378 D0D3 0D                       +   +         .byte a_cr
                                     +   
   5378 D0D4 0A                       +            .byte a_lf
                                        
   5379 D0D5 3B 20 00                             .byte "; ",0
   5380 D0D8 0D                         mm_regs2 ++         .byte a_cr
                                     +   
   5380 D0D9 0A                       +            .byte a_lf
                                        
   5381 D0DA 20 20 20 20 20 44 53 20              .byte "     DS    DP  DB"
   5381 D0E2 20 20 20 44 50 20 20 44   
   5381 D0EA 42                        
   5382 D0EB 0D                       +   +         .byte a_cr
                                     +   
   5382 D0EC 0A                       +            .byte a_lf
                                        
   5383 D0ED 3B 20 00                             .byte "; ",0
                                        ;
   5385 D0F0 07                         mm_rts +         .byte a_bel
                                        
   5386 D0F1 0D                       +   +         .byte a_cr
                                     +   
   5386 D0F2 0A                       +            .byte a_lf
                                        
   5387 D0F3 2A 2A 52 54 53                       .byte "**RTS"
   5388 D0F8 0D                       +   +         .byte a_cr
                                     +   
   5388 D0F9 0A                       +            .byte a_lf
                                        
   5389 D0FA 00                                   .byte 0
                                        ;
                                        ;================================================================================
                                        ;
                                        ;VECTOR STORAGE
                                        ;
                                        ;
   5693 = 0000D0FB                      _txtend_ =*                     ;end of program text
                                        ;
                                        ;================================================================================
                                        	;.end
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
FTBios816.asm


                                        .include "supermon832.asm"
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
FAC1ToString.asm

                                        ; ============================================================================
                                        ; FAC1ToString.asm
                                        ;        __
                                        ;   \\__/ o\    (C) 2014  Robert Finch, Stratford
                                        ;    \  __ /    All rights reserved.
                                        ;     \/_//     robfinch<remove>@finitron.ca
                                        ;       ||
                                        ;  
                                        ;
                                        ; This source file is free software: you can redistribute it and/or modify 
                                        ; it under the terms of the GNU Lesser General Public License as published 
                                        ; by the Free Software Foundation, either version 3 of the License, or     
                                        ; (at your option) any later version.                                      
                                        ;                                                                          
                                        ; This source file is distributed in the hope that it will be useful,      
                                        ; but WITHOUT ANY WARRANTY; without even the implied warranty of           
                                        ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the            
                                        ; GNU General Public License for more details.                             
                                        ;                                                                          
                                        ; You should have received a copy of the GNU General Public License        
                                        ; along with this program.  If not, see <http://www.gnu.org/licenses/>.    
                                        ;                                                                          
                                        ; ============================================================================
                                        ;
                                        ; This code is a heavily modified version of the floating point to string
                                        ; conversion routine which is a part of Lee Davison's EhBASIC.
                                        ;
   5725 = 00000000000000C6                            Cvaral		= $C6		; current var address low byte
   5726 = 000000C7                      Cvarah		= Cvaral+1	; current var address high byte
   5727 = 00000000000000C0                            numexp		= $C0		; string to float number exponent count
   5728 = 00000000000000C2                            expcnt		= $C2		; string to float exponent count
   5729 = 00000000000000C4                            Sendl			= $C4	; BASIC pointer temp low byte
   5730 = 00000000000000C5                            Sendh			= $C5	; BASIC pointer temp low byte
                                        
   5732 = 00000000000003A0                            Decss		= $3A0		; number to decimal string start
   5733 = 000003A1                      Decssp1		= Decss+1	; number to decimal string start
   5734 = 0000000000000001                            FP_ADD		EQU		1
   5735 = 0000000000000002                            FP_SUB		EQU		2
   5736 = 0000000000000003                            FP_MUL		EQU		3
   5737 = 0000000000000004                            FP_DIV		EQU		4
   5738 = 0000000000000005                            FP_FIX2FLT	EQU		5
   5739 = 0000000000000006                            FP_FLT2FIX	EQU		6
   5740 = 0000000000000007                            FP_ABS		EQU		7
   5741 = 0000000000000010                            FP_NEG		EQU		16
   5742 = 0000000000000011                            FP_SWAP		EQU		17
   5743 = 0000000000000083                            FIXED_MUL	EQU		$83
   5744 = 0000000000000081                            FIXED_ADD	EQU		$81
   5745 = 0000000000000082                            FIXED_SUB	EQU		$82
                                        ;parameter FIXED_DIV = 8'h84;
                                        ;parameter FIXED_ABS = 8'h87;
                                        ;parameter FIXED_NEG = 8'h90;
   5749 = 0000000000FEA20E                            FP_CMDREG	EQU		$FEA20E
   5750 = 0000000000FEA20E                            FP_STATREG	EQU		$FEA20E
   5751 = 0000000000FEA200                            FAC1		EQU		$FEA200
   5752 = 0000000000FEA200                            FAC1_5		EQU		$FEA200
   5753 = 0000000000FEA202                            FAC1_4		EQU		$FEA202
   5754 = 0000000000FEA204                            FAC1_3		EQU		$FEA204
   5755 = 0000000000FEA206                            FAC1_2		EQU		$FEA206
   5756 = 0000000000FEA208                            FAC1_1		EQU		$FEA208
   5757 = 0000000000FEA208                            FAC1_msw	EQU		$FEA208
   5758 = 0000000000FEA20A                            FAC1_e		EQU		$FEA20A
   5759 = 0000000000FEA210                            FAC2		EQU		$FEA210
                                        
                                           	CPU		W65C816S
                                           	NDX		16
                                           	MEM		16
                                           	
                                           public FAC1ToString:
                                           
                                           ; The first chunk of code determines if the number is positive or negative
                                           ; and spits out the appropriate sign. Next it takes the absolute value of
                                           ; the accumulator so following code only has to deal with positive numbers.
                                           
   5474 00D0FB A0 00 00                     	LDY	#$00			; set index = 1
   5475 00D0FE AF 08 A2 FE                  	LDA	FAC1_msw		; test FAC1 sign (b15) (Can't use BIT)
   5476 00D102 10 0E                        	BPL	.0002		; branch if +ve
   5477 00D104 A9 2D 00                     	LDA	#'-'			; else character = "-"
   5478 00D107 99 A0 03                     	STA	Decss,Y		; save leading character (" " or "-")
   5479 00D10A A9 10 00                     	LDA	#FP_NEG		; make the FAC positive
   5480 00D10D 20 34 D3                     	JSR	FPCommandWait
   5481 00D110 80 06                        	BRA	.0001
   5482 00D112                             .0002:
   5483 00D112 A9 20 00                     	LDA	#$20			; character = " " (assume +ve)
   5484 00D115 99 A0 03                     	STA	Decss,Y
   5485 00D118                             .0001:
   5486 00D118 84 C4                        	STY	Sendl			; save index
                                           
                                           ; This little bit of code check for a zero exponent which indicates a
                                           ; value of zero.
                                           
   5491 00D11A AF 0A A2 FE                  	LDA	FAC1_e		; get FAC1 exponent
   5492 00D11E AA                           	TAX
   5493 00D11F D0 06                        	BNE	LAB_2989		; branch if FAC1<>0
                                           					; exponent was $00 so FAC1 is 0
   5495 00D121 A9 30 00                     	LDA	#'0'			; set character = "0"
   5496 00D124 82 93 01                     	BRL	LAB_2A89		; save last character, [EOT] and exit
                                           
                                           ; This loop attempts to make small values more significant, so that there are
                                           ; fewer leading zeros in the value. (The exponent is decremented so that it
                                           ; corresponds). Because of the potential for extremely small values looping is
                                           ; limited. The problem is the 16 bit exponent can allow for much smaller
                                           ; values than an 8 bit exponent would and we don't want to loop for thousands
                                           ; of iterations in order to display a value that's almost zero.
                                           
                                           					; FAC1 is some non zero value
   5506 00D127                             LAB_2989
   5507 00D127 84 C4                        	STY	Sendl			; save off .Y
   5508 00D129 A0 67 06                     	LDY #1639			; max number of retries
   5509 00D12C A9 00 00                     	LDA	#$00			; clear (number exponent count)
   5510 00D12F 85 C0                        	STA numexp
   5511 00D131                             LOOP_MBMILLION:
   5512 00D131 E0 00 80                     	CPX	#$8000			; compare FAC1 exponent with $8000 (>1.00000)
   5513 00D134 B0 1A                        	BCS	LAB_299A		; branch if FAC1=>1
                                           					; FAC1<1
   5515 00D136 F4 83 D3                     	PEA	A_MILLION		; multiply FAC * 1,000,000
   5516 00D139 20 E9 D2                     	JSR	LOAD_FAC2		; 
   5517 00D13C 68                           	PLA					; get rid of parameter
   5518 00D13D 20 E3 D2                     	JSR	FMUL
   5519 00D140 A5 C0                        	LDA numexp
   5520 00D142 38                           	SEC
   5521 00D143 E9 06 00                     	SBC	#6				; set number exponent count (-6)
   5522 00D146 85 C0                        	STA numexp
   5523 00D148 AF 0A A2 FE                  	LDA FAC1_e
   5524 00D14C AA                           	TAX
   5525 00D14D 88                           	DEY
   5526 00D14E 10 E1                        	BPL	LOOP_MBMILLION
                                           
   5528 00D150                             LAB_299A
   5529 00D150 A4 C4                        	LDY	Sendl		; get back .Y
                                           
                                           ; These two loops coerce the value of the FAC to be between 100,000 and
                                           ; 1,000,000. This gives a maximum of six digits before the decimal point
                                           ; in scientific notation.
                                           
                                           ; This loop divides by 10 until the value in the FAC is less than 1,000,000
                                           ;
   5537 00D152                             LOOP_DB10:
   5538 00D152 F4 9B D3                     	PEA	MAX_BEFORE_SCI	; set pointer low byte to 999999.4375 (max before sci note)
   5539 00D155 20 E9 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5540 00D158 68                           	PLA					; get rid of parameter
   5541 00D159 AF 0E A2 FE                  	LDA FP_CMDREG
   5542 00D15D 89 08 00                     	BIT	#$08			; test equals bit
   5543 00D160 D0 28                        	BNE	LAB_29C3		; exit if FAC1 = (AY)
   5544 00D162 89 04 00                     	BIT	#$04			; test greater than bit
   5545 00D165 F0 07                        	BEQ	LOOP_MB10		; go do *10 if FAC1 < (AY)
                                           
   5547 00D167                             LAB_29B9
   5548 00D167 20 21 D3                     	JSR	DivideByTen		; divide by 10
   5549 00D16A E6 C0                        	INC	numexp			; increment number exponent count
   5550 00D16C 80 E4                        	BRA	LOOP_DB10		; go test again (branch always)
                                           
                                           ; This loop multiplies the value by 10 until it's greater than
                                           ; 100,000.
                                           					; FAC1 < (AY)
   5555 00D16E                             LOOP_MB10
   5556 00D16E F4 B3 D3                     	PEA CONST_9375		; set pointer to 99999.9375
   5557 00D171 20 E9 D2                     	JSR	LOAD_FAC2		; compare FAC1 with (AY)
   5558 00D174 68                           	PLA					; get rid of parameter
   5559 00D175 AF 0E A2 FE                  	LDA FP_CMDREG
   5560 00D179 89 08 00                     	BIT #$08
   5561 00D17C D0 05                        	BNE	LAB_29B2		; branch if FAC1 = (AY) (allow decimal places)
   5562 00D17E 89 04 00                     	BIT #$04
   5563 00D181 D0 07                        	BNE	LAB_29C0		; branch if FAC1 > (AY) (no decimal places)
                                           					; FAC1 <= (AY)
   5565 00D183                             LAB_29B2
   5566 00D183 20 14 D3                     	JSR	MultiplyByTen	; multiply by 10
   5567 00D186 C6 C0                        	DEC	numexp		; decrement number exponent count
   5568 00D188 80 E4                        	BRA	LOOP_MB10		; go test again (branch always)
                                           
                                           ; now we have just the digits to do
                                           
   5572 00D18A                             LAB_29C0
                                           ;	JSR	AddPoint5		; add 0.5 to FAC1 (round FAC1)
   5574 00D18A                             LAB_29C3
                                           ;	JSR	FloatToFixed	; convert FAC1 floating-to-fixed
   5576 00D18A A2 01 00                     	LDX	#$01			; set default digits before dp = 1
   5577 00D18D A5 C0                        	LDA	numexp		; get number exponent count
   5578 00D18F 18                           	CLC				; clear carry for add
   5579 00D190 69 07 00                     	ADC	#$07			; up to 6 digits before point
   5580 00D193 30 0A                        	BMI	LAB_29D8		; if -ve then 1 digit before dp
                                           
   5582 00D195 C9 08 00                     	CMP	#$08			; A>=8 if n>=1E6
   5583 00D198 B0 06                        	BCS	LAB_29D9		; branch if >= $08
                                           
                                           					; carry is clear
   5586 00D19A AA                           	TAX				; copy to A
   5587 00D19B CA                           	DEX				; take 1 from digit count
   5588 00D19C A9 02 00                     	LDA	#$02			;.set exponent adjust
                                           
   5590 00D19F                             LAB_29D8
   5591 00D19F 38                           	SEC				; set carry for subtract
   5592 00D1A0                             LAB_29D9
   5593 00D1A0 E9 02 00                     	SBC	#$02			; -2
   5594 00D1A3 85 C2                        	STA	expcnt		;.save exponent adjust
   5595 00D1A5 86 C0                        	STX	numexp		; save digits before dp count
   5596 00D1A7 8A                           	TXA				; copy to A
   5597 00D1A8 F0 02                        	BEQ	LAB_29E4		; branch if no digits before dp
                                           
   5599 00D1AA 10 15                        	BPL	LAB_29F7		; branch if digits before dp
                                           
   5601 00D1AC                             LAB_29E4
   5602 00D1AC A4 C4                        	LDY	Sendl			; get output string index
   5603 00D1AE A9 2E 00                     	LDA	#'.'			; character "."
   5604 00D1B1 C8                           	INY				; increment index
   5605 00D1B2 99 A0 03                     	STA	Decss,Y		; save to output string
   5606 00D1B5 8A                           	TXA				;.
   5607 00D1B6 F0 07                        	BEQ	LAB_29F5		;.
                                           
   5609 00D1B8 A9 30 00                     	LDA	#'0'			; character "0"
   5610 00D1BB C8                           	INY				; increment index
   5611 00D1BC 99 A0 03                     	STA	Decss,Y		; save to output string
   5612 00D1BF                             LAB_29F5
   5613 00D1BF 84 C4                        	STY	Sendl			; save output string index
                                           
   5615 00D1C1                             LAB_29F7
   5616 00D1C1 A2 30 00                     	LDX	#'0'			; holds onto the digit value
                                           
                                           ; Now loop subtracting 100,000 as many times as we can. The value was coerced
                                           ; to be between 100,000 and 1,000,000. Count the number of times subtraction
                                           ; can be done successfully.
                                           ;
   5622 00D1C4                             LAB_29FB
   5623 00D1C4 F4 8F D3                     	PEA CONST_100000
   5624 00D1C7 20 E9 D2                     	JSR LOAD_FAC2	; load FAC2 with 100,000
   5625 00D1CA 68                           	PLA				; get rid of parameter
   5626 00D1CB AF 0E A2 FE                  	LDA FP_STATREG
   5627 00D1CF 89 04 00                     	BIT #$04		; Is FAC1 > 100,000 ?
   5628 00D1D2 F0 0F                        	BEQ	.0005		; branch if not
   5629 00D1D4 A9 11 00                     	LDA #FP_SWAP	; subtract is FAC2-FAC1!
   5630 00D1D7 20 34 D3                     	JSR FPCommandWait;
   5631 00D1DA A9 02 00                     	LDA #FP_SUB		; subtract 100,000 from the mantissa.
   5632 00D1DD 20 34 D3                     	JSR FPCommandWait
   5633 00D1E0 E8                           	INX				; increment the value of the digit
   5634 00D1E1 80 E1                        	BRA	LAB_29FB	; try again
   5635 00D1E3                             .0005:
   5636 00D1E3 8A                           	TXA
   5637 00D1E4 A4 C4                        	LDY	Sendl			; get output string index
   5638 00D1E6 C8                           	INY				; increment output string index
   5639 00D1E7 8A                           	TXA
   5640 00D1E8 99 A0 03                     	STA	Decss,Y		; save to output string
   5641 00D1EB C6 C0                        	DEC	numexp		; decrement # of characters before the dp
   5642 00D1ED D0 07                        	BNE	LAB_2A3B		; branch if still characters to do
                                           				; else output the point
   5644 00D1EF A9 2E 00                     	LDA	#'.'			; character "."
   5645 00D1F2 C8                           	INY				; increment output string index
   5646 00D1F3 99 A0 03                     	STA	Decss,Y		; save to output string
   5647 00D1F6                             LAB_2A3B
   5648 00D1F6 84 C4                        	STY	Sendl		; save output string index
                                           	; We subtracted until the value was < 100,000 so multiply the
                                           	; remainder upwards to get the next digit.
   5651 00D1F8 20 14 D3                     	JSR	MultiplyByTen	; If not, multiply by 10
   5652 00D1FB C0 1B 00                     	CPY #27			; converted (+/- . incl)
   5653 00D1FE 90 C1                        	BCC	LAB_29F7
                                           					; now remove trailing zeroes
   5655 00D200                             .RemoveTrailingZeros
   5656 00D200 B9 A0 03                     	LDA	Decss,Y		; get character from output string
   5657 00D203 29 FF 00                     	AND	#$FF		; mask to a byte
   5658 00D206 88                           	DEY				; decrement output string index
   5659 00D207 C9 30 00                     	CMP	#'0'			; compare with "0"
   5660 00D20A F0 F4                        	BEQ	.RemoveTrailingZeros	; loop until non "0" character found
                                           
   5662 00D20C C9 2E 00                     	CMP	#'.'			; compare with "."
   5663 00D20F F0 01                        	BEQ	LAB_2A58		; branch if was dp
                                           
                                           					; restore last character
   5666 00D211 C8                           	INY				; increment output string index
   5667 00D212                             LAB_2A58
   5668 00D212 A9 2B 00                     	LDA	#'+'			; character "+"
   5669 00D215 A6 C2                        	LDX	expcnt		; get exponent count
   5670 00D217 F0 FF A2 00                  	LBEQ	LAB_2A8C		; if zero go set null terminator and exit
                                           
                                           					; exponent isn't zero so write exponent
   5673 00D21B 10 0A                        	BPL	LAB_2A68		; branch if exponent count +ve
                                           
   5675 00D21D A9 00 00                     	LDA	#$00			; clear A
   5676 00D220 38                           	SEC				; set carry for subtract
   5677 00D221 E5 C2                        	SBC	expcnt		; subtract exponent count adjust (convert -ve to +ve)
   5678 00D223 AA                           	TAX				; copy exponent count to X
   5679 00D224 A9 2D 00                     	LDA	#'-'			; character "-"
                                           
                                           ; We must keep moving forwards through the string because the acc is storing
                                           ; two bytes.
                                           
   5684 00D227                             LAB_2A68
   5685 00D227 48                           	PHA
   5686 00D228 A9 45 00                     	LDA	#'E'			; character "E"
   5687 00D22B 99 A1 03                     	STA	Decss+1,Y		; save exponent sign to output string
   5688 00D22E 68                           	PLA
   5689 00D22F 99 A2 03                     	STA	Decss+2,Y		; save to output string
   5690 00D232 8A                           	TXA				; get exponent count back
                                           
                                           ; do highest exponent digit
   5693 00D233 64 C4                        	STZ Sendl
   5694 00D235 A2 2F 00                     	LDX	#'0'-1		; one less than "0" character
   5695 00D238 38                           	SEC				; set carry for subtract
   5696 00D239 E8                          .0001:				
   5697 00D23A E9 10 27                     	SBC	#10000
   5698 00D23D B0 FA                        	BCS .0001
   5699 00D23F 69 10 27                     	ADC #10000
   5700 00D242 E0 30 00                     	CPX #'0'
   5701 00D245 F0 09                        	BEQ .0005
   5702 00D247 E6 C4                        	INC Sendl
   5703 00D249 48                           	PHA
   5704 00D24A 8A                           	TXA
   5705 00D24B 99 A3 03                     	STA Decss+3,Y
   5706 00D24E 68                           	PLA
   5707 00D24F C8                           	INY
                                           ; do the next exponent digit
   5709 00D250                             .0005:
   5710 00D250 A2 2F 00                     	LDX #'0'-1
   5711 00D253 38                           	SEC
   5712 00D254                             .0002:
   5713 00D254 E8                           	INX
   5714 00D255 E9 E8 03                     	SBC #1000
   5715 00D258 B0 FA                        	BCS .0002
   5716 00D25A 69 E8 03                     	ADC #1000
   5717 00D25D 46 C4                        	LSR Sendl
   5718 00D25F B0 05                        	BCS .00010
   5719 00D261 E0 30 00                     	CPX #'0'
   5720 00D264 F0 09                        	BEQ .0006
   5721 00D266                             .00010:
   5722 00D266 E6 C4                        	INC Sendl
   5723 00D268 48                           	PHA
   5724 00D269 8A                           	TXA
   5725 00D26A 99 A3 03                     	STA Decss+3,Y
   5726 00D26D 68                           	PLA
   5727 00D26E C8                           	INY
                                           ; and the next
   5729 00D26F                             .0006:
   5730 00D26F A2 2F 00                     	LDX	#'0'-1
   5731 00D272 38                           	SEC
   5732 00D273                             .0003:
   5733 00D273 E8                           	INX
   5734 00D274 E9 64 00                     	SBC #100
   5735 00D277 B0 FA                        	BCS .0003
   5736 00D279 69 64 00                     	ADC #100
   5737 00D27C 46 C4                        	LSR Sendl
   5738 00D27E B0 05                        	BCS .00011
   5739 00D280 E0 30 00                     	CPX #'0'
   5740 00D283 F0 09                        	BEQ .0007
   5741 00D285                             .00011:
   5742 00D285 E6 C4                        	INC Sendl
   5743 00D287 48                           	PHA
   5744 00D288 8A                           	TXA
   5745 00D289 99 A3 03                     	STA Decss+3,Y
   5746 00D28C 68                           	PLA
   5747 00D28D C8                           	INY
                                           
   5749 00D28E                             .0007:
   5750 00D28E A2 2F 00                     	LDX #'0'-1
   5751 00D291 38                           	SEC
   5752 00D292                             .0004:
   5753 00D292 E8                           	INX
   5754 00D293 E9 0A 00                     	SBC #10
   5755 00D296 B0 FA                        	BCS .0004
   5756 00D298 69 0A 00                     	ADC #10
   5757 00D29B 46 C4                        	LSR Sendl
   5758 00D29D B0 05                        	BCS .00012
   5759 00D29F E0 30 00                     	CPX #'0'
   5760 00D2A2 F0 09                        	BEQ .0008
   5761 00D2A4                             .00012:
   5762 00D2A4 E6 C4                        	INC Sendl
   5763 00D2A6 48                           	PHA
   5764 00D2A7 8A                           	TXA
   5765 00D2A8 99 A3 03                     	STA Decss+3,Y
   5766 00D2AB 68                           	PLA
   5767 00D2AC C8                           	INY
                                           
   5769 00D2AD                             .0008:
   5770 00D2AD 69 30 00                     	ADC #'0'
   5771 00D2B0 99 A3 03                     	STA Decss+3,Y
   5772 00D2B3 A9 00 00                     	LDA	#$00			; set null terminator
   5773 00D2B6 99 A4 03                     	STA	Decss+4,Y		; save to output string
   5774 00D2B9 60                           	RTS					; go set string pointer (AY) and exit (branch always)
                                           
   5776 00D2BA                             LAB_2A89
   5777 00D2BA 99 A0 03                     	STA	Decss,Y		; save last character to output string
                                           					; set null terminator and exit
   5779 00D2BD                             LAB_2A8C
   5780 00D2BD A9 00 00                     	LDA	#$00			; set null terminator
   5781 00D2C0 99 A1 03                     	STA	Decss+1,Y		; save after last character
                                           
   5783 00D2C3                             LAB_2A91
                                           ;	LDA	#<Decssp1		; set result string low pointer
                                           ;	LDY	#>Decssp1		; set result string high pointer
   5786 00D2C3 60                           	RTS
                                           
   5788 00D2C4                             LAB_25FB:
   5789 00D2C4 A9 11 00                     	LDA		#FP_SWAP
   5790 00D2C7 20 34 D3                     	JSR		FPCommandWait
   5791 00D2CA A0 00 00                     	LDY		#0
   5792 00D2CD BB                           	TYX
   5793 00D2CE                             .0002:
   5794 00D2CE B3 03                        	LDA		(3,S),Y
   5795 00D2D0 9F 00 A2 FE                  	STA		FAC1,X
   5796 00D2D4 C8                           	INY
   5797 00D2D5 C8                           	INY
   5798 00D2D6 E8                           	INX
   5799 00D2D7 E8                           	INX
   5800 00D2D8 E0 0C 00                     	CPX		#12
   5801 00D2DB D0 F1                        	BNE		.0002
   5802 00D2DD A9 05 00                     	LDA		#FP_FIX2FLT
   5803 00D2E0 20 34 D3                     	JSR		FPCommandWait
   5804 00D2E3                             FMUL:
   5805 00D2E3 A9 03 00                     	LDA		#FP_MUL
   5806 00D2E6 4C 34 D3                     	JMP		FPCommandWait
   5807 00D2E9                             	
   5808 00D2E9 DA                           	PHX
   5809 00D2EA 5A                           	PHY
   5810 00D2EB A0 00 00                     	LDY		#0
   5811 00D2EE BB                           	TYX
   5812 00D2EF                             .0002:
   5813 00D2EF B3 07                        	LDA		(7,s),Y
   5814 00D2F1 9F 10 A2 FE                  	STA		FAC2,X
   5815 00D2F5 C8                           	INY
   5816 00D2F6 C8                           	INY
   5817 00D2F7 E8                           	INX
   5818 00D2F8 E8                           	INX
   5819 00D2F9 E0 0C 00                     	CPX		#12
   5820 00D2FC D0 F1                        	BNE		.0002
   5821 00D2FE 7A                           	PLY
   5822 00D2FF FA                           	PLX
   5823 00D300 60                           	RTS
   5824 00D301                             	
   5825 00D301 A9 06 00                     	LDA		#FP_FLT2FIX
   5826 00D304 4C 34 D3                     	JMP		FPCommandWait
   5827 00D307                             	
   5828 00D307 F4 BF D3                     	PEA		CONST_POINT5
   5829 00D30A 20 E9 D2                     	JSR		LOAD_FAC2
   5830 00D30D 68                           	PLA
   5831 00D30E A9 01 00                     	LDA		#FP_ADD
   5832 00D311 4C 34 D3                     	JMP		FPCommandWait
   5833 00D314                             	
   5834 00D314 F4 A7 D3                     	PEA		TEN_AS_FLOAT
   5835 00D317 20 E9 D2                     	JSR		LOAD_FAC2
   5836 00D31A 68                           	PLA
   5837 00D31B A9 03 00                     	LDA		#FP_MUL
   5838 00D31E 4C 34 D3                     	JMP		FPCommandWait
                                           	
   5840 00D321 F4 A7 D3                     	PEA		TEN_AS_FLOAT
   5841 00D324 20 E9 D2                     	JSR		LOAD_FAC2
   5842 00D327 68                           	PLA
   5843 00D328 20 31 D3                     	JSR		SwapFACs
   5844 00D32B A9 04 00                     	LDA		#FP_DIV
   5845 00D32E 4C 34 D3                     	JMP		FPCommandWait
   5846 00D331                             	
   5847 00D331 A9 11 00                     	LDA		#FP_SWAP
                                           
                                           ; Issue a command to the FP unit and wait for it to complete
                                           ;
                                           public FPCommandWait:
   5852 00D334 48                           	PHA
   5853 00D335 A9 06 00                     	LDA		#6
   5854 00D338 8D 00 70                     	STA		$7000
   5855 00D33B                             .0001:
   5856 00D33B AF 0E A2 FE                  	LDA		FP_STATREG	; get the status register
   5857 00D33F 89 80 00                     	BIT		#$80		; check for busy bit
   5858 00D342 D0 F7                        	BNE		.0001		; if busy go back
   5859 00D344 68                           	PLA					; to pop acc
   5860 00D345 8F 0E A2 FE                  	STA		FP_CMDREG	; store the command
   5861 00D349 48                           	PHA
   5862 00D34A A9 07 00                     	LDA		#7
   5863 00D34D 8D 00 70                     	STA		$7000
   5864 00D350 68                           	PLA
   5865 00D351 60                           	RTS
                                           
                                           ; Display the FAC1 as a hex number
                                           ;
                                           public DispFAC1:
   5870 00D352 AF 0A A2 FE                  	LDA FAC1_e
   5871 00D356 20 BE EA                     	JSR DispWord
   5872 00D359 AF 08 A2 FE                  	LDA	FAC1_1
   5873 00D35D 20 BE EA                     	JSR	DispWord
   5874 00D360 AF 06 A2 FE                  	LDA FAC1_2
   5875 00D364 20 BE EA                     	JSR	DispWord
   5876 00D367 AF 04 A2 FE                  	LDA FAC1_3
   5877 00D36B 20 BE EA                     	JSR DispWord
   5878 00D36E AF 02 A2 FE                  	LDA FAC1_4
   5879 00D372 20 BE EA                     	JSR DispWord
   5880 00D375 AF 00 A2 FE                  	LDA FAC1_5
   5881 00D379 20 BE EA                     	JSR DispWord
   5882 00D37C A9 20 00                     	LDA #' '
   5883 00D37F 20 DE E9                     	JSR OutChar
   5884 00D382 60                           	RTS
                                           ;
                                           ; 1,000,000 as a floating point number
                                           ;
   5888 00D383                             A_MILLION:	; $F4240
   5889 00D383 00 00                        	dw		$0000
   5890 00D385 00 00                        	dw		$0000
   5891 00D387 00 00                        	dw		$0000
   5892 00D389 00 00                        	dW		$0000
   5893 00D38B 12 7A                        	dw		$7A12
   5894 00D38D 13 80                        	dw		$8013
                                           
   5896 00D38F                             CONST_100000:
                                           	;186A0
   5898 00D38F 00 00                        	dw		$0000
   5899 00D391 00 00                        	dw		$0000
   5900 00D393 00 00                        	dw		$0000
   5901 00D395 00 00                        	dw		$0000
   5902 00D397 A8 61                        	dw		$61A8
   5903 00D399 10 80                        	dw		$8010
                                           ; The constant 999999.4375 as hex
                                           ; 01.11_1010_0001_0001_1111_1011_1000_00000000000000000000000000
   5906 00D39B                             MAX_BEFORE_SCI:
   5907 00D39B 00 00                        	dw  $0000
   5908 00D39D 00 00                        	dw  $0000
   5909 00D39F 00 00                        	dw	$0000
   5910 00D3A1 80 FB                        	dw	$FB80
   5911 00D3A3 11 7A                        	dw	$7A11
   5912 00D3A5 13 80                        	dw	$8013
                                           
   5914 00D3A7                             TEN_AS_FLOAT:
   5915 00D3A7 00 00                        	dw	$0000
   5916 00D3A9 00 00                        	dw	$0000
   5917 00D3AB 00 00                        	dw	$0000
   5918 00D3AD 00 00                        	dw	$0000
   5919 00D3AF 00 50                        	dw	$5000
   5920 00D3B1 03 80                        	dw	$8003
                                           
                                           ; 99999.9375
                                           ; 01.10_0001_1010_0111_1111_1100_000000000000000000000000000000
                                           ;
   5925 00D3B3                             CONST_9375:
   5926 00D3B3 00 00                        	dw	$0000
   5927 00D3B5 00 00                        	dw	$0000
   5928 00D3B7 00 00                        	dw	$0000
   5929 00D3B9 00 FC                        	dw	$FC00
   5930 00D3BB A7 61                        	dw	$61A7
   5931 00D3BD 10 80                        	dw	$8010
                                           
                                           ; 0.5
   5934 00D3BF                             CONST_POINT5:
   5935 00D3BF 00 00                        	dw	$0000
   5936 00D3C1 00 00                        	dw	$0000
   5937 00D3C3 00 00                        	dw	$0000
   5938 00D3C5 00 00                        	dw	$0000
   5939 00D3C7 00 40                        	dw	$4000
   5940 00D3C9 FF 7F                        	dw	$7FFF
                                           
                                           ; This table is used in converting numbers to ASCII.
                                           
   5944 00D3CB                             LAB_2A9A
   6242 = 0000D3CC                         LAB_2A9B = LAB_2A9A+1
   6243 = 0000D3CD                         LAB_2A9C = LAB_2A9B+1
                                           ;	.word	$FFFF,$F21F,$494C,$589C,$0000
                                           ;	.word	$0000,$0163,$4578,$5D8A,$0000
                                           ;	.word	$FFFF,$FFDC,$790D,$903F,$0000
                                           ;	.word	$0000,$0003,$8D7E,$A4C6,$8000
                                           ;	.word	$FFFF,$FFFF,$A50C,$EF85,$C000
                                           ;	.word	$0000,$0000,$0918,$4E72,$A000
                                           ;	.word	$FFFF,$FFFF,$FF17,$2B5A,$F000
                                           ;	.word	$0000,$0000,$0017,$4876,$E800
                                           ;	.word	$FFFF,$FFFF,$FFFD,$ABF4,$1C00
                                           ;	.word	$0000,$0000,$0000,$3B9A,$CA00
                                           ;	.word	$FFFF,$FFFF,$FFFF,$FF67,$6980
                                           ;	.word	$0000,$0000,$0000,$05F5,$E100		; 100000000
                                           ;	.word	$0000,$0000,$0098,$9680		; 10000000
                                           ;	.word   $4240,$000F,$0000,$0000,$0000,$804E		; 1000000
   5961 00D3CB A0 86 01 00 00 00 00 00      	.word	$86A0,$0001,$0000,$0000,$0000,$804E		; 100000
   5961 00D3D3 00 00 4E 80                
   5962 00D3D7 10 27 00 00 00 00 00 00      	.word	$2710,$0000,$0000,$0000,$0000,$804E		; 10000
   5962 00D3DF 00 00 4E 80                
   5963 00D3E3 E8 03 00 00 00 00 00 00      	.word	$03E8,$0000,$0000,$0000,$0000,$804E		; 1000
   5963 00D3EB 00 00 4E 80                
   5964 00D3EF 64 00 00 00 00 00 00 00      	.word	$0064,$0000,$0000,$0000,$0000,$804E		; 100
   5964 00D3F7 00 00 4E 80                
   5965 00D3FB                             FIXED10:
   5966 00D3FB 0A 00 00 00 00 00 00 00      	.word	$000A,$0000,$0000,$0000,$0000,$804E		; 10
   5966 00D403 00 00 4E 80                
   5967 00D407 01 00 00 00 00 00 00 00      	.word	$0001,$0000,$0000,$0000,$0000,$804E		; 1
   5967 00D40F 00 00 4E 80                
                                           
                                           		 MEM	16
                                           		 NDX	16
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
FTBios816.asm


                                           .include "FAC1ToString.asm"
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
invaders.asm

                                           	CPU		FT832
                                           
   6277 = 0000000000FEA100                               PRNG		EQU		$FEA100
   6278 = 0000000000FEA108                               PRNG_NUM	EQU		$FEA108
   6279 = 0000000000FEA10E                               PRNG_ADV	EQU		$FEA10E
   6280 = 0000000000000001                               MAN_EXPLODING	EQU		1
                                           
                                           ; which invaders are still active (not destroyed)
                                           ; These var addresses are segment offsets into seg $7800
   6284 = 0000000000000000                               active				EQU		$00
   6285 = 000000000000005E                               left_right			EQU		$5E
   6286 = 0000000000000060                               rightmost_column	EQU		$60
   6287 = 0000000000000062                               leftmost_column		EQU		$62
   6288 = 0000000000000064                               bottom_row			EQU		$64
   6289 = 0000000000000066                               top_row				EQU		$66
   6290 = 000000000000006A                               inv_tick			EQU		$6A
   6291 = 000000000000006C                               inv_tick2			EQU		$6C
   6292 = 000000000000006E                               manX				EQU		$6E
   6293 = 0000000000000070                               manY				EQU		$70
   6294 = 0000000000000072                               manState			EQU		$72
   6295 = 0000000000000100                               InvadersX			EQU		$100
   6296 = 0000000000000200                               InvadersY			EQU		$200
   6297 = 0000000000000300                               min_right			EQU		$300
   6298 = 0000000000000310                               max_left			EQU		$310
   6299 = 0000000000000320                               bombX				EQU		$320
   6300 = 0000000000000330                               bombY				EQU		$330
   6301 = 0000000000000400                               inv_state			EQU		$400
                                           
                                           ; This var is shared, must be referenced ZS:
   6304 = 0000000000007868                               do_invaders			EQU		$7868
                                           
                                           	; minimum right +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6005 00D413                             st_min_right:
   6006 00D413 01 00                        	.word	1
   6007 00D415 05 00                        	.word	5
   6008 00D417 09 00                        	.word	9
   6009 00D419 0D 00                        	.word	13
   6010 00D41B 11 00                        	.word	17
   6011 00D41D 15 00                        	.word	21
   6012 00D41F 19 00                        	.word	25
   6013 00D421 1D 00                        	.word	29
                                           
                                           	; maximum left +         .byte a_esc,"`0"
                                           -ordinate for each column of invaders
   6017 00D423 34 00                        	.word	52
   6018 00D425 38 00                        	.word	56
   6019 00D427 3C 00                        	.word	60
   6020 00D429 40 00                        	.word	64
   6021 00D42B 44 00                        	.word	68
   6022 00D42D 48 00                        	.word	72
   6023 00D42F 4C 00                        	.word	76
   6024 00D431 50 00                        	.word	80
                                           
   6026 00D433 00 00                        	.word	0		; rightmost column
   6027 00D435 07 00                        	.word	7		; lefmost column
   6028 00D437 01 00                        	.word	1		; dx
                                           
                                           	MEM		16
                                           	NDX		16
                                           
                                           	code
                                           
   6035 00D439                             InvBomb:
   6036 00D439 A2 00 00                     	LDX		#0
   6037 00D43C                             .0001:
   6038 00D43C B5 00                        	LDA		active,X
   6039 00D43E F0 27                        	BEQ		.0002
   6040 00D440 20 18 D5                     	JSR		CanDropBomb
   6041 00D443 F0 22                        	BEQ		.0002
   6042 00D445 42 5B AF 08 A1 FE            	LDA		ZS:PRNG_NUM
   6043 00D44B 42 5B 8F 0E A1 FE            	STA		ZS:PRNG_ADV
   6044 00D451 29 63 00                     	AND		#$63
   6045 00D454 D0 11                        	BNE		.0002
   6046 00D456 20 6F D4                     	JSR		FindEmptyBomb
   6047 00D459 30 13                        	BMI		.0003
   6048 00D45B BD 00 01                     	LDA		InvadersX,X
   6049 00D45E 99 20 03                     	STA		bombX,Y
   6050 00D461 BD 00 02                     	LDA		InvadersY,X
   6051 00D464 99 30 03                     	STA		bombY,Y
   6052 00D467                             .0002:
   6053 00D467 E8                           	INX
   6054 00D468 E8                           	INX
   6055 00D469 E0 50 00                     	CPX		#80
   6056 00D46C 30 CE                        	BMI		.0001
   6057 00D46E                             .0003:
   6058 00D46E 60                           	RTS
                                           
   6060 00D46F                             FindEmptyBomb:
   6061 00D46F A0 00 00                     	LDY		#0
   6062 00D472                             .0001:
   6063 00D472 B9 20 03                     	LDA		bombX,Y
   6064 00D475 F0 0A                        	BEQ		.0002
   6065 00D477 C8                           	INY
   6066 00D478 C8                           	INY
   6067 00D479 C0 10 00                     	CPY		#16
   6068 00D47C 30 F4                        	BMI		.0001
   6069 00D47E A0 FF FF                     	LDY		#-1
   6070 00D481                             .0002:
   6071 00D481 60                           	RTS
                                           
   6073 00D482                             MoveBombs:
   6074 00D482 A2 00 00                     	LDX		#0
   6075 00D485                             .0002:
   6076 00D485 BD 20 03                     	LDA		bombX,X
   6077 00D488 F0 14                        	BEQ		.0001
   6078 00D48A BD 30 03                     	LDA		bombY,X
   6079 00D48D C9 1E 00                     	CMP		#30			; has the bomb fallen all the way to the ground ?
   6080 00D490 10 06                        	BPL		.0003		; if yes, reset bomb
   6081 00D492 1A                           	INA
   6082 00D493 9D 30 03                     	STA		bombY,X
   6083 00D496 80 06                        	BRA		.0001
   6084 00D498                             .0003:
   6085 00D498 9E 20 03                     	STZ		bombX,X
   6086 00D49B 9E 30 03                     	STZ		bombY,X
   6087 00D49E                             .0001:
   6088 00D49E E8                           	INX
   6089 00D49F E8                           	INX
   6090 00D4A0 E0 10 00                     	CPX		#16
   6091 00D4A3 30 E0                        	BMI		.0002
   6092 00D4A5 60                           	RTS
                                           
   6094 00D4A6                             GetBombOffset:
   6095 00D4A6 B9 30 03                     	LDA		bombY,Y
   6096 00D4A9 0A                           	ASL
   6097 00D4AA AA                           	TAX
   6098 00D4AB 42 5B BD 98 F2               	LDA		ZS:LineTbl,X
   6099 00D4B0 18                           	CLC
   6100 00D4B1 79 20 03                     	ADC		bombX,Y
   6101 00D4B4 79 20 03                     	ADC		bombX,Y
   6102 00D4B7 AA                           	TAX
   6103 00D4B8 60                           	RTS
                                           
   6105 00D4B9                             RenderBombs:
   6106 00D4B9 A0 00 00                     	LDY		#0
   6107 00D4BC                             .0001:
   6108 00D4BC B9 30 03                     	LDA		bombY,Y
   6109 00D4BF F0 0C                        	BEQ		.0002
   6110 00D4C1 20 A6 D4                     	JSR		GetBombOffset
   6111 00D4C4 A9 24 00                     	LDA		#'$'
   6112 00D4C7 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6113 00D4CD                             .0002:
   6114 00D4CD C8                           	INY
   6115 00D4CE C8                           	INY
   6116 00D4CF C0 10 00                     	CPY		#16
   6117 00D4D2 30 E8                        	BMI		.0001
   6118 00D4D4 60                           	RTS
                                           
   6120 00D4D5                             TestBombsIntercept:
   6121 00D4D5 A0 00 00                     	LDY		#0
   6122 00D4D8                             .0001:
   6123 00D4D8 20 E3 D4                     	JSR		TestBombIntercept
   6124 00D4DB C8                           	INY
   6125 00D4DC C8                           	INY
   6126 00D4DD C0 10 00                     	CPY		#16
   6127 00D4E0 30 F6                        	BMI		.0001
   6128 00D4E2 60                           	RTS
                                           
   6130 00D4E3                             TestBombIntercept:
   6131 00D4E3 20 A6 D4                     	JSR		GetBombOffset
   6132 00D4E6 42 5B BF 00 00 0D            	LDA		ZS:VIDBUF,X
   6133 00D4EC C9 20 00                     	CMP		#' '
   6134 00D4EF F0 1D                        	BEQ		.0001
   6135 00D4F1 B9 30 03                     	LDA		bombY,Y
   6136 00D4F4 C9 1D 00                     	CMP		#29
   6137 00D4F7 D0 16                        	BNE		.0002
   6138 00D4F9 B9 20 03                     	LDA		bombX,Y
   6139 00D4FC D9 6E 00                     	CMP		manX,Y
   6140 00D4FF D0 05                        	BNE		.0003
   6141 00D501 A9 01 00                     	LDA		#MAN_EXPLODING
   6142 00D504 85 72                        	STA		manState
   6143 00D506                             .0003:
   6144 00D506 BB                           	TYX
   6145 00D507 9E 30 03                     	STZ		bombY,X
   6146 00D50A 9E 20 03                     	STZ		bombX,X
   6147 00D50D 60                           	RTS
   6148 00D50E                             .0001:
   6149 00D50E 60                           	RTS
   6150 00D50F                             .0002:
   6151 00D50F A9 20 00                     	LDA		#' '
   6152 00D512 9F 00 00 0D                  	STA		VIDBUF,X
   6153 00D516 80 EE                        	BRA		.0003
                                           
                                           ; An invader can drop a bomb only if there are no invaders underneath it.
                                           
   6157 00D518                             CanDropBomb:
   6158 00D518 E0 0F 00                     	CPX		#15
   6159 00D51B 10 0C                        	BGE		.0001
   6160 00D51D B5 10                        	LDA		active+16,X
   6161 00D51F 15 20                        	ORA		active+32,X
   6162 00D521 15 30                        	ORA		active+48,X
   6163 00D523 15 40                        	ORA		active+64,X
   6164 00D525 49 01 00                     	EOR		#1
   6165 00D528 60                           	RTS
   6166 00D529                             .0001:
   6167 00D529 E0 1F 00                     	CPX		#31
   6168 00D52C 10 0A                        	BGE		.0002
   6169 00D52E B5 10                        	LDA		active+16,X
   6170 00D530 15 20                        	ORA		active+32,X
   6171 00D532 15 30                        	ORA		active+48,X
   6172 00D534 49 01 00                     	EOR		#1
   6173 00D537 60                           	RTS
   6174 00D538                             .0002:
   6175 00D538 E0 2F 00                     	CPX		#47
   6176 00D53B 10 08                        	BGE		.0003
   6177 00D53D B5 10                        	LDA		active+16,X
   6178 00D53F 15 20                        	ORA		active+32,X
   6179 00D541 49 01 00                     	EOR		#1
   6180 00D544 60                           	RTS
   6181 00D545                             .0003:
   6182 00D545 E0 3F 00                     	CPX		#63
   6183 00D548 10 06                        	BGE		.0004
   6184 00D54A B5 10                        	LDA		active+16,X
   6185 00D54C 49 01 00                     	EOR		#1
   6186 00D54F 60                           	RTS
   6187 00D550                             .0004:
   6188 00D550 A9 01 00                     	LDA		#1
   6189 00D553 60                           	RTS
                                           
                                           
                                           ; Test if it's possible to move to the left anymore.
                                           ;
   6194 00D554                             CanMoveLeft:
   6195 00D554 A5 62                        	LDA		leftmost_column
   6196 00D556 0A                           	ASL
   6197 00D557 AA                           	TAX
   6198 00D558 BD 10 03                     	LDA		max_left,X
   6199 00D55B DD 00 01                     	CMP		InvadersX,X
   6200 00D55E 30 04                        	BMI		.0001
   6201 00D560 A9 00 00                     	LDA		#0
   6202 00D563 60                           	RTS
   6203 00D564                             .0001:
   6204 00D564 A9 01 00                     	LDA		#1
   6205 00D567 60                           	RTS
                                           
                                           ; Test if it's possible to move to the right anymore.
                                           ;
   6209 00D568                             CanMoveRight:
   6210 00D568 A5 60                        	LDA		rightmost_column
   6211 00D56A 0A                           	ASL
   6212 00D56B AA                           	TAX
   6213 00D56C BD 00 03                     	LDA		min_right,X
   6214 00D56F DD 00 01                     	CMP		InvadersX,X
   6215 00D572 10 04                        	BPL		.0001
   6216 00D574 A9 00 00                     	LDA		#0
   6217 00D577 60                           	RTS
   6218 00D578                             .0001:
   6219 00D578 A9 01 00                     	LDA		#1
   6220 00D57B 60                           	RTS
                                           
                                           ; Test if it's possible to move down anymore
                                           ;
   6224 00D57C                             CanMoveDown:
   6225 00D57C A5 64                        	LDA		bottom_row
   6226 00D57E 0A                           	ASL
   6227 00D57F 0A                           	ASL
   6228 00D580 0A                           	ASL
   6229 00D581 0A                           	ASL
   6230 00D582 AA                           	TAX
   6231 00D583 BD 00 02                     	LDA		InvadersY,X
   6232 00D586 C9 1E 00                     	CMP		#30
   6233 00D589 30 04                        	BMI		.0001
   6234 00D58B A9 00 00                     	LDA		#0
   6235 00D58E 60                           	RTS
   6236 00D58F                             .0001:
   6237 00D58F A9 01 00                     	LDA		#1
   6238 00D592 60                           	RTS
                                           
                                           ; Move all the invaders to the left
                                           ; Means incrementing the X co-ordinate
                                           ;
   6243 00D593                             MoveLeft:
   6244 00D593 A2 00 00                     	LDX		#00
   6245 00D596                             .0002:
   6246 00D596 FE 00 01                     	INC		InvadersX,X
   6247 00D599 E8                           	INX
   6248 00D59A E8                           	INX
   6249 00D59B E0 50 00                     	CPX		#80
   6250 00D59E D0 F6                        	BNE		.0002
   6251 00D5A0 60                           	RTS
                                           
                                           ; Move all the invaders to the right.
                                           ; means decrementing the X co-ordinate
                                           ;
   6256 00D5A1                             MoveRight:
   6257 00D5A1 A2 00 00                     	LDX		#0
   6258 00D5A4                             .0002:
   6259 00D5A4 DE 00 01                     	DEC		InvadersX,X
   6260 00D5A7 E8                           	INX
   6261 00D5A8 E8                           	INX
   6262 00D5A9 E0 50 00                     	CPX		#80
   6263 00D5AC D0 F6                        	BNE		.0002
   6264 00D5AE 60                           	RTS
                                           
                                           ; Move all the invaders down a row.
                                           ; Means incrementing the Y co-ordinate
                                           ;
   6269 00D5AF                             MoveDown:
   6270 00D5AF A2 00 00                     	LDX		#00
   6271 00D5B2                             .0002:
   6272 00D5B2 FE 00 02                     	INC		InvadersY,X
   6273 00D5B5 E8                           	INX
   6274 00D5B6 E8                           	INX
   6275 00D5B7 E0 50 00                     	CPX		#80
   6276 00D5BA D0 F6                        	BNE		.0002
   6277 00D5BC 60                           	RTS
                                           
                                           ; Move the invaders
                                           ; Retuns
                                           ; .A = 1 if it was possible to do a move, 0 otherwise
                                           ;
   6283 00D5BD                             Move:
   6284 00D5BD 24 5E                        	BIT		left_right
   6285 00D5BF 30 0A                        	BMI		.0002
   6286 00D5C1 20 54 D5                     	JSR		CanMoveLeft
   6287 00D5C4 F0 0F                        	BEQ		.0001
   6288 00D5C6 20 93 D5                     	JSR		MoveLeft
   6289 00D5C9 80 19                        	BRA		.0003
   6290 00D5CB                             .0002:
   6291 00D5CB 20 68 D5                     	JSR		CanMoveRight
   6292 00D5CE F0 05                        	BEQ		.0001
   6293 00D5D0 20 A1 D5                     	JSR		MoveRight
   6294 00D5D3 80 0F                        	BRA		.0003
   6295 00D5D5                             .0001:
   6296 00D5D5 20 7C D5                     	JSR		CanMoveDown
   6297 00D5D8 F0 0E                        	BEQ		.0004
   6298 00D5DA A5 5E                        	LDA		left_right
   6299 00D5DC 49 FF FF                     	EOR		#$FFFF
   6300 00D5DF 85 5E                        	STA		left_right
   6301 00D5E1 20 AF D5                     	JSR		MoveDown
   6302 00D5E4                             .0003:
   6303 00D5E4 A9 01 00                     	LDA		#1
   6304 00D5E7 60                           	RTS
   6305 00D5E8                             .0004:
   6306 00D5E8 A9 00 00                     	LDA		#0
   6307 00D5EB 60                           	RTS
                                           
   6309 00D5EC                             Initialize:
   6310 00D5EC 64 60                        	STZ		rightmost_column
   6311 00D5EE A9 07 00                     	LDA		#7
   6312 00D5F1 85 62                        	STA		leftmost_column
   6313 00D5F3 64 66                        	STZ		top_row
   6314 00D5F5 A9 04 00                     	LDA		#4
   6315 00D5F8 85 64                        	STA		bottom_row
   6316 00D5FA 64 5E                        	STZ		left_right
   6317 00D5FC 20 44 D6                     	JSR		ActivateAllInvaders
   6318 00D5FF A2 00 00                     	LDX		#0
   6319 00D602                             .0001:
   6320 00D602 42 1B BD 57 DA               	LDA		CS:StartX,X
   6321 00D607 9D 00 01                     	STA		InvadersX,X
   6322 00D60A 42 1B BD 07 DA               	LDA		CS:StartY,X
   6323 00D60F 9D 00 02                     	STA		InvadersY,X
   6324 00D612 E8                           	INX
   6325 00D613 E8                           	INX
   6326 00D614 E0 50 00                     	CPX		#80
   6327 00D617 30 E9                        	BMI		.0001
   6328 00D619 A2 00 00                     	LDX		#0
   6329 00D61C                             .0002:
   6330 00D61C 42 1B BD 13 D4               	LDA		CS:st_min_right,X
   6331 00D621 9D 00 03                     	STA		min_right,X
   6332 00D624 E8                           	INX
   6333 00D625 E8                           	INX
   6334 00D626 E0 20 00                     	CPX		#32
   6335 00D629 30 F1                        	BMI		.0002
                                           	; Initialize Bombs
   6337 00D62B A2 00 00                     	LDX		#0
   6338 00D62E                             .0003:
   6339 00D62E 9E 20 03                     	STZ		bombX,X
   6340 00D631 9E 30 03                     	STZ		bombY,X
   6341 00D634 E8                           	INX
   6342 00D635 E8                           	INX
   6343 00D636 E0 10 00                     	CPX		#16
   6344 00D639 30 F3                        	BMI		.0003
   6345 00D63B A9 FE FF                     	LDA		#$FFFE
   6346 00D63E 42 5B 8D 68 78               	STA		ZS:do_invaders
   6347 00D643 60                           	RTS
                                           
   6349 00D644                             ActivateAllInvaders:
   6350 00D644 A2 00 00                     	LDX		#0
   6351 00D647 A9 01 00                     	LDA		#1
   6352 00D64A                             .0001:
   6353 00D64A 95 00                        	STA		active,X
   6354 00D64C E8                           	INX
   6355 00D64D E8                           	INX
   6356 00D64E E0 50 00                     	CPX		#80
   6357 00D651 D0 F7                        	BNE		.0001
   6358 00D653 60                           	RTS
                                           
   6360 00D654                             IsAllDestroyed:
   6361 00D654 20 DC D6                     	JSR		IsRightmostColumnDestroyed
   6362 00D657 F0 2C                        	BEQ		.0001
   6363 00D659 E6 60                        	INC		rightmost_column
   6364 00D65B AD 0C 03                     	LDA		min_right+12
   6365 00D65E 8D 0E 03                     	STA		min_right+14
   6366 00D661 AD 0A 03                     	LDA		min_right+10
   6367 00D664 8D 0C 03                     	STA		min_right+12
   6368 00D667 AD 08 03                     	LDA		min_right+8
   6369 00D66A 8D 0A 03                     	STA		min_right+10
   6370 00D66D AD 06 03                     	LDA		min_right+6
   6371 00D670 8D 08 03                     	STA		min_right+8
   6372 00D673 AD 04 03                     	LDA		min_right+4
   6373 00D676 8D 06 03                     	STA		min_right+6
   6374 00D679 AD 02 03                     	LDA		min_right+2
   6375 00D67C 8D 04 03                     	STA		min_right+4
   6376 00D67F AD 00 03                     	LDA		min_right
   6377 00D682 8D 02 03                     	STA		min_right+2
   6378 00D685                             .0001:
   6379 00D685 20 D8 D6                     	JSR		IsLeftmostColumnDestroyed
   6380 00D688 F0 2C                        	BEQ		.0002
   6381 00D68A C6 62                        	DEC		leftmost_column
   6382 00D68C AD 12 03                     	LDA		max_left+2
   6383 00D68F 8D 10 03                     	STA		max_left
   6384 00D692 AD 14 03                     	LDA		max_left+4
   6385 00D695 8D 12 03                     	STA		max_left+2
   6386 00D698 AD 16 03                     	LDA		max_left+6
   6387 00D69B 8D 14 03                     	STA		max_left+4
   6388 00D69E AD 18 03                     	LDA		max_left+8
   6389 00D6A1 8D 16 03                     	STA		max_left+6
   6390 00D6A4 AD 1A 03                     	LDA		max_left+10
   6391 00D6A7 8D 18 03                     	STA		max_left+8
   6392 00D6AA AD 1C 03                     	LDA		max_left+12
   6393 00D6AD 8D 1A 03                     	STA		max_left+10
   6394 00D6B0 AD 1E 03                     	LDA		max_left+14
   6395 00D6B3 8D 1C 03                     	STA		max_left+12
   6396 00D6B6                             .0002:
   6397 00D6B6 A5 62                        	LDA		leftmost_column
   6398 00D6B8 C5 60                        	CMP		rightmost_column
   6399 00D6BA 30 18                        	BMI		.allDestroyed
   6400 00D6BC 20 F8 D6                     	JSR		IsBottomRowDestroyed
   6401 00D6BF F0 02                        	BEQ		.0003
   6402 00D6C1 C6 64                        	DEC		bottom_row
   6403 00D6C3                             .0003:
   6404 00D6C3 20 F4 D6                     	JSR		IsTopRowDestroyed
   6405 00D6C6 F0 02                        	BEQ		.0004
   6406 00D6C8 E6 66                        	INC		top_row
   6407 00D6CA                             .0004:
   6408 00D6CA A5 64                        	LDA		bottom_row
   6409 00D6CC C5 66                        	CMP		top_row
   6410 00D6CE 30 04                        	BMI		.allDestroyed
   6411 00D6D0 A9 00 00                     	LDA		#0
   6412 00D6D3 60                           	RTS
   6413 00D6D4                             .allDestroyed:
   6414 00D6D4 A9 01 00                     	LDA		#1
   6415 00D6D7 60                           	RTS
                                           
                                           
   6418 00D6D8                             IsLeftmostColumnDestroyed:
   6419 00D6D8 A5 62                        	LDA		leftmost_column
   6420 00D6DA 80 02                        	BRA		IsColumnDestroyed
   6421 00D6DC                             IsRightmostColumnDestroyed:
   6422 00D6DC A5 60                        	LDA		rightmost_column
   6423 00D6DE                             IsColumnDestroyed:
   6424 00D6DE 0A                           	ASL
   6425 00D6DF AA                           	TAX
   6426 00D6E0 B5 00                        	LDA		active,X
   6427 00D6E2 15 10                        	ORA		active+16,X
   6428 00D6E4 15 20                        	ORA		active+32,X
   6429 00D6E6 15 30                        	ORA		active+48,X
   6430 00D6E8 15 40                        	ORA		active+64,X
   6431 00D6EA 15 50                        	ORA		active+80,X
   6432 00D6EC 15 60                        	ORA		active+96,X
   6433 00D6EE 15 70                        	ORA		active+112,X
   6434 00D6F0 49 01 00                     	EOR		#1
   6435 00D6F3 60                           	RTS
                                           
   6437 00D6F4                             IsTopRowDestroyed:
   6438 00D6F4 A5 66                        	LDA		top_row
   6439 00D6F6 80 02                        	BRA		IsRowDestroyed
   6440 00D6F8                             IsBottomRowDestroyed:
   6441 00D6F8 A5 64                        	LDA		bottom_row
   6442 00D6FA                             IsRowDestroyed:
   6443 00D6FA 0A                           	ASL
   6444 00D6FB 0A                           	ASL
   6445 00D6FC 0A                           	ASL
   6446 00D6FD 0A                           	ASL
   6447 00D6FE B5 00                        	LDA		active,X
   6448 00D700 15 02                        	ORA		active+2,X
   6449 00D702 15 04                        	ORA		active+4,X
   6450 00D704 15 06                        	ORA		active+6,X
   6451 00D706 15 08                        	ORA		active+8,X
   6452 00D708 15 0A                        	ORA		active+10,X
   6453 00D70A 15 0C                        	ORA		active+12,X
   6454 00D70C 15 0E                        	ORA		active+14,X
   6455 00D70E 49 01 00                     	EOR		#1
   6456 00D711 60                           	RTS
                                           
                                           ; TickCount counts 1/100 of a second. We want to animate the graphics at a much
                                           ; slower rate, so we use bit 6 of the tick count to indicate when to animate.
                                           ;
   6461 00D712                             ShiftTick:
   6462 00D712 42 5B A5 04                  	LDA		ZS:TickCount
   6463 00D716 4A                           	LSR
   6464 00D717 4A                           	LSR
   6465 00D718 4A                           	LSR
   6466 00D719 4A                           	LSR
   6467 00D71A 4A                           	LSR
   6468 00D71B 4A                           	LSR
   6469 00D71C 60                           	RTS
                                           
   6471 00D71D                             RenderInvaders:
                                           	; First, clear the screen
   6473 00D71D A2 00 00                     	LDX		#0
   6474 00D720 A9 20 00                     	LDA		#' '
   6475 00D723 09 00 BF                     	ORA		#$BF00
   6476 00D726                             .0003:
   6477 00D726 42 5B 9F 00 00 0D            	STA		ZS:VIDBUF,X
   6478 00D72C E8                           	INX
   6479 00D72D E8                           	INX
   6480 00D72E E0 58 14                     	CPX		#84*31*2
   6481 00D731 30 F3                        	BMI		.0003
   6482 00D733 A2 00 00                     	LDX		#0
   6483 00D736                             .0002:
   6484 00D736 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   6487 00D738 B5 00                        	LDA		active,X
   6488 00D73A F0 FF BD 01                  	LBEQ	.0001
   6489 00D73E BD 00 04                     	LDA		inv_state,X
   6490 00D741 BD 00 02                     	LDA		InvadersY,X
   6491 00D744 0A                           	ASL
   6492 00D745 A8                           	TAY
   6493 00D746 42 5B B9 98 F2               	LDA		ZS:LineTbl,Y
   6494 00D74B 18                           	CLC
   6495 00D74C 7D 00 01                     	ADC		InvadersX,X
   6496 00D74F 18                           	CLC
   6497 00D750 7D 00 01                     	ADC		InvadersX,X
   6498 00D753 A8                           	TAY
   6499 00D754 E2 20                        	SEP		#$20			; eight bit acc
                                           	MEM		8
   6501 00D756 42 1B BD A7 DA               	LDA		CS:InvaderType,X
   6502 00D75B C9 01                        	CMP		#1
   6503 00D75D D0 46                        	BNE		.0004
   6504 00D75F A9 E9                        	LDA		#233
   6505 00D761 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6506 00D769 A9 F2                        	LDA		#242
   6507 00D76B 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6508 00D773 A9 DF                        	LDA		#223
   6509 00D775 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6510 00D77D 20 12 D7                     	JSR		ShiftTick
   6511 00D780 90 04                        	BCC		.0005
   6512 00D782 A9 58                        	LDA		#'X'
   6513 00D784 80 02                        	BRA		.0006
   6514 00D786                             .0005:
   6515 00D786 A9 56                        	LDA		#'V'
   6516 00D788                             .0006:
   6517 00D788 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6518 00D790 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6519 00D798 A9 20                        	LDA		#' '
   6520 00D79A 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6521 00D7A2 82 E4 00                     	BRL		.0007
   6522 00D7A5                             .0004:
   6523 00D7A5 C9 02                        	CMP		#2
   6524 00D7A7 D0 FF 83 00                  	LBNE	.0008
   6525 00D7AB 20 12 D7                     	JSR		ShiftTick
   6526 00D7AE 90 3F                        	BCC		.0009
   6527 00D7B0 A9 FC                        	LDA		#252
   6528 00D7B2 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6529 00D7BA A9 99                        	LDA		#153
   6530 00D7BC 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6531 00D7C4 A9 FE                        	LDA		#254
   6532 00D7C6 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6533 00D7CE A9 E2                        	LDA		#226
   6534 00D7D0 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6535 00D7D8 A9 62                        	LDA		#98
   6536 00D7DA 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6537 00D7E2 A9 E2                        	LDA		#226
   6538 00D7E4 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6539 00D7EC 82 9A 00                     	BRL		.0007
   6540 00D7EF                             .0009:
   6541 00D7EF A9 62                        	LDA		#98
   6542 00D7F1 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6543 00D7F9 A9 99                        	LDA		#153
   6544 00D7FB 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6545 00D803 A9 62                        	LDA		#98
   6546 00D805 42 5B 42 99 04 00 0D 00      	STA		ZS:VIDBUF+4,Y
                                         
   6547 00D80D A9 EC                        	LDA		#236
   6548 00D80F 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6549 00D817 A9 62                        	LDA		#98
   6550 00D819 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6551 00D821 A9 FB                        	LDA		#251
   6552 00D823 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6553 00D82B 82 5B 00                     	BRL		.0007
   6554 00D82E                             .0008:
   6555 00D82E A9 FF                        	LDA		#255
   6556 00D830 42 5B 42 99 00 00 0D 00      	STA		ZS:VIDBUF,Y
                                         
   6557 00D838 A9 F8                        	LDA		#248
   6558 00D83A 42 5B 42 99 02 00 0D 00      	STA		ZS:VIDBUF+2,Y
                                         
   6559 00D842 A9 7F                        	LDA		#127
   6560 00D844 42 5B 99 3D D8               	STA		ZS:VIDBUf+4,Y
   6561 00D849 20 12 D7                     	JSR		ShiftTick
   6562 00D84C 90 20                        	BCC		.0010
   6563 00D84E A9 FF                        	LDA		#255
   6564 00D850 42 5B 42 99 54 00 0D 00      	STA		ZS:VIDBUF+84,Y
                                         
   6565 00D858 A9 F9                        	LDA		#249
   6566 00D85A 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6567 00D862 A9 7F                        	LDA		#127
   6568 00D864 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6569 00D86C 80 1B                        	BRA		.0007
   6570 00D86E                             .0010:
   6571 00D86E A9 E1                        	LDA		#225
   6572 00D870 42 5B 99 8D D8               	STA		ZS:VIDBUf+84,Y
   6573 00D875 A9 F9                        	LDA		#249
   6574 00D877 42 5B 42 99 56 00 0D 00      	STA		ZS:VIDBUF+86,Y
                                         
   6575 00D87F A9 60                        	LDA		#96
   6576 00D881 42 5B 42 99 58 00 0D 00      	STA		ZS:VIDBUF+88,Y
                                         
   6577 00D889                             .0007:
                                           	; Surround the alien with spaces
   6579 00D889 A9 20                        	LDA		#' '
   6580 00D88B 42 5B 42 99 AA FF 0C 00      	STA		ZS:VIDBUF-86,Y
                                         
   6581 00D893 42 5B 42 99 AC FF 0C 00      	STA		ZS:VIDBUF-84,Y
                                         
   6582 00D89B 42 5B 42 99 AE FF 0C 00      	STA		ZS:VIDBUF-82,Y
                                         
   6583 00D8A3 42 5B 42 99 B0 FF 0C 00      	STA		ZS:VIDBUF-80,Y
                                         
   6584 00D8AB 42 5B 42 99 B2 FF 0C 00      	STA		ZS:VIDBUF-78,Y
                                         
   6585 00D8B3 42 5B 42 99 FE FF 0C 00      	STA		ZS:VIDBUF-2,Y
                                         
   6586 00D8BB 42 5B 42 99 06 00 0D 00      	STA		ZS:VIDBUF+6,Y
                                         
   6587 00D8C3 42 5B 42 99 52 00 0D 00      	STA		ZS:VIDBUF+82,Y
                                         
   6588 00D8CB 42 5B 42 99 5A 00 0D 00      	STA		ZS:VIDBUF+90,Y
                                         
   6589 00D8D3 42 5B 42 99 A6 00 0D 00      	STA		ZS:VIDBUF+166,Y
                                         
   6590 00D8DB 42 5B 42 99 A8 00 0D 00      	STA		ZS:VIDBUF+168,Y
                                         
   6591 00D8E3 42 5B 42 99 AA 00 0D 00      	STA		ZS:VIDBUF+170,Y
                                         
   6592 00D8EB 42 5B 42 99 AC 00 0D 00      	STA		ZS:VIDBUF+172,Y
                                         
   6593 00D8F3 42 5B 42 99 AE 00 0D 00      	STA		ZS:VIDBUF+174,Y
                                         
   6594 00D8FB                             .0001:
   6595 00D8FB E8                           	INX
   6596 00D8FC E8                           	INX
   6597 00D8FD E0 50 00                     	CPX		#80
   6598 00D900 D0 FF 32 FE                  	LBNE	.0002
   6599 00D904 C2 20                        	REP		#$20
                                           	MEM		16
   6601 00D906 60                           	RTS
                                           
                                           public InvadersTask:
   6604 00D907                             .0001:
   6605 00D907 F4 00 00                     	PEA		0				; set data segment to $7800
   6606 00D90A F4 00 78                     	PEA		$7800
   6607 00D90D 42 2B                        	PLDS
   6608 00D90F A9 FF 2B                     	LDA		#$2BFF			; set stack to $2BFF
   6609 00D912 1B                           	TAS
   6610 00D913 20 EC D5                     	JSR		Initialize
   6611 00D916 42 E2 00 10                  	SEP		#$1000			; turn on single step mode
   6612 00D91A 20 1D D7                     	JSR		RenderInvaders
   6613 00D91D                             .0002:
   6614 00D91D 42 20 32 ED 07               	JCR 	KeybdGetCharNoWaitCtx,7	; check for char at keyboard
   6615 00D922                             .0004:
   6616 00D922 A2 00 00                     	LDX		#0
   6617 00D925                             .0006:
   6618 00D925 E8                           	INX
   6619 00D926 E0 D0 07                     	CPX		#2000
   6620 00D929 D0 FA                        	BNE		.0006
   6621 00D92B 42 5B A5 04                  	LDA		ZS:TickCount
   6622 00D92F 29 03 00                     	AND		#$3
   6623 00D932 D0 E9                        	BNE		.0002
   6624 00D934 20 39 D4                     	JSR		InvBomb
   6625 00D937 20 1D D7                     	JSR		RenderInvaders
   6626 00D93A 20 B9 D4                     	JSR		RenderBombs
   6627 00D93D 20 82 D4                     	JSR		MoveBombs
   6628 00D940 42 5B A5 04                  	LDA		ZS:TickCount
   6629 00D944 29 0F 00                     	AND		#$F
   6630 00D947 D0 D4                        	BNE		.0002
   6631 00D949 20 54 D6                     	JSR		IsAllDestroyed
   6632 00D94C D0 B9                        	BNE		.0001
   6633 00D94E 20 BD D5                     	JSR		Move
   6634 00D951 F0 B4                        	BEQ		.0001				; Can't move, re-initialize
   6635 00D953 80 C8                        	BRA		.0002
   6636 00D955                             .0005:
   6637 00D955 85 6A                        	STA		inv_tick
   6638 00D957 80 C4                        	BRA		.0002
   6639 00D959                             .0003:
   6640 00D959 C9 03 00                     	CMP		#3
   6641 00D95C D0 C4                        	BNE		.0004
   6642 00D95E 42 5B 9C 68 78               	STZ		ZS:do_invaders
   6643 00D963 42 60                        	RTT
   6644 00D965 80 A0                        	BRA		.0001
                                           
   6646 00D967                             InvaderRow:
   6647 00D967 00 00                        	.word	0
   6648 00D969 00 00                        	.word	0
   6649 00D96B 00 00                        	.word	0
   6650 00D96D 00 00                        	.word	0
   6651 00D96F 00 00                        	.word	0
   6652 00D971 00 00                        	.word	0
   6653 00D973 00 00                        	.word	0
   6654 00D975 00 00                        	.word	0
                                           
   6656 00D977 01 00                        	.word	1
   6657 00D979 01 00                        	.word	1
   6658 00D97B 01 00                        	.word	1
   6659 00D97D 01 00                        	.word	1
   6660 00D97F 01 00                        	.word	1
   6661 00D981 01 00                        	.word	1
   6662 00D983 01 00                        	.word	1
   6663 00D985 01 00                        	.word	1
                                           
   6665 00D987 02 00                        	.word	2
   6666 00D989 02 00                        	.word	2
   6667 00D98B 02 00                        	.word	2
   6668 00D98D 02 00                        	.word	2
   6669 00D98F 02 00                        	.word	2
   6670 00D991 02 00                        	.word	2
   6671 00D993 02 00                        	.word	2
   6672 00D995 02 00                        	.word	2
                                           
   6674 00D997 03 00                        	.word	3
   6675 00D999 03 00                        	.word	3
   6676 00D99B 03 00                        	.word	3
   6677 00D99D 03 00                        	.word	3
   6678 00D99F 03 00                        	.word	3
   6679 00D9A1 03 00                        	.word	3
   6680 00D9A3 03 00                        	.word	3
   6681 00D9A5 03 00                        	.word	3
                                           
   6683 00D9A7 04 00                        	.word	4
   6684 00D9A9 04 00                        	.word	4
   6685 00D9AB 04 00                        	.word	4
   6686 00D9AD 04 00                        	.word	4
   6687 00D9AF 04 00                        	.word	4
   6688 00D9B1 04 00                        	.word	4
   6689 00D9B3 04 00                        	.word	4
   6690 00D9B5 04 00                        	.word	4
                                           
   6692 00D9B7                             InvaderCol:
   6693 00D9B7 00 00                        	.word	0
   6694 00D9B9 01 00                        	.word	1
   6695 00D9BB 02 00                        	.word	2
   6696 00D9BD 03 00                        	.word	3
   6697 00D9BF 04 00                        	.word	4
   6698 00D9C1 05 00                        	.word	5
   6699 00D9C3 06 00                        	.word	6
   6700 00D9C5 07 00                        	.word	7
                                           
   6702 00D9C7 00 00                        	.word	0
   6703 00D9C9 01 00                        	.word	1
   6704 00D9CB 02 00                        	.word	2
   6705 00D9CD 03 00                        	.word	3
   6706 00D9CF 04 00                        	.word	4
   6707 00D9D1 05 00                        	.word	5
   6708 00D9D3 06 00                        	.word	6
   6709 00D9D5 07 00                        	.word	7
                                           
   6711 00D9D7 00 00                        	.word	0
   6712 00D9D9 01 00                        	.word	1
   6713 00D9DB 02 00                        	.word	2
   6714 00D9DD 03 00                        	.word	3
   6715 00D9DF 04 00                        	.word	4
   6716 00D9E1 05 00                        	.word	5
   6717 00D9E3 06 00                        	.word	6
   6718 00D9E5 07 00                        	.word	7
                                           
   6720 00D9E7 00 00                        	.word	0
   6721 00D9E9 01 00                        	.word	1
   6722 00D9EB 02 00                        	.word	2
   6723 00D9ED 03 00                        	.word	3
   6724 00D9EF 04 00                        	.word	4
   6725 00D9F1 05 00                        	.word	5
   6726 00D9F3 06 00                        	.word	6
   6727 00D9F5 07 00                        	.word	7
                                           
   6729 00D9F7 00 00                        	.word	0
   6730 00D9F9 01 00                        	.word	1
   6731 00D9FB 02 00                        	.word	2
   6732 00D9FD 03 00                        	.word	3
   6733 00D9FF 04 00                        	.word	4
   6734 00DA01 05 00                        	.word	5
   6735 00DA03 06 00                        	.word	6
   6736 00DA05 07 00                        	.word	7
                                           
                                           ; Starting Y co-ordinate for each invader
                                           
   6740 00DA07                             StartY:
   6741 00DA07 03 00                        	.word	3
   6742 00DA09 03 00                        	.word	3
   6743 00DA0B 03 00                        	.word	3
   6744 00DA0D 03 00                        	.word	3
   6745 00DA0F 03 00                        	.word	3
   6746 00DA11 03 00                        	.word	3
   6747 00DA13 03 00                        	.word	3
   6748 00DA15 03 00                        	.word	3
                                           
   6750 00DA17 06 00                        	.word	6
   6751 00DA19 06 00                        	.word	6
   6752 00DA1B 06 00                        	.word	6
   6753 00DA1D 06 00                        	.word	6
   6754 00DA1F 06 00                        	.word	6
   6755 00DA21 06 00                        	.word	6
   6756 00DA23 06 00                        	.word	6
   6757 00DA25 06 00                        	.word	6
                                           
   6759 00DA27 09 00                        	.word	9
   6760 00DA29 09 00                        	.word	9
   6761 00DA2B 09 00                        	.word	9
   6762 00DA2D 09 00                        	.word	9
   6763 00DA2F 09 00                        	.word	9
   6764 00DA31 09 00                        	.word	9
   6765 00DA33 09 00                        	.word	9
   6766 00DA35 09 00                        	.word	9
                                           
   6768 00DA37 0C 00                        	.word	12
   6769 00DA39 0C 00                        	.word	12
   6770 00DA3B 0C 00                        	.word	12
   6771 00DA3D 0C 00                        	.word	12
   6772 00DA3F 0C 00                        	.word	12
   6773 00DA41 0C 00                        	.word	12
   6774 00DA43 0C 00                        	.word	12
   6775 00DA45 0C 00                        	.word	12
                                           
   6777 00DA47 0F 00                        	.word	15
   6778 00DA49 0F 00                        	.word	15
   6779 00DA4B 0F 00                        	.word	15
   6780 00DA4D 0F 00                        	.word	15
   6781 00DA4F 0F 00                        	.word	15
   6782 00DA51 0F 00                        	.word	15
   6783 00DA53 0F 00                        	.word	15
   6784 00DA55 0F 00                        	.word	15
                                           
                                           ; Starting X co-ordinate for each invader
                                           
   6788 00DA57                             StartX:
   6789 00DA57 01 00                        	.word	1
   6790 00DA59 05 00                        	.word	5
   6791 00DA5B 09 00                        	.word	9
   6792 00DA5D 0D 00                        	.word	13
   6793 00DA5F 11 00                        	.word	17
   6794 00DA61 15 00                        	.word	21
   6795 00DA63 19 00                        	.word	25
   6796 00DA65 1D 00                        	.word	29
                                           
   6798 00DA67 01 00                        	.word	1
   6799 00DA69 05 00                        	.word	5
   6800 00DA6B 09 00                        	.word	9
   6801 00DA6D 0D 00                        	.word	13
   6802 00DA6F 11 00                        	.word	17
   6803 00DA71 15 00                        	.word	21
   6804 00DA73 19 00                        	.word	25
   6805 00DA75 1D 00                        	.word	29
                                           
   6807 00DA77 01 00                        	.word	1
   6808 00DA79 05 00                        	.word	5
   6809 00DA7B 09 00                        	.word	9
   6810 00DA7D 0D 00                        	.word	13
   6811 00DA7F 11 00                        	.word	17
   6812 00DA81 15 00                        	.word	21
   6813 00DA83 19 00                        	.word	25
   6814 00DA85 1D 00                        	.word	29
                                           
   6816 00DA87 01 00                        	.word	1
   6817 00DA89 05 00                        	.word	5
   6818 00DA8B 09 00                        	.word	9
   6819 00DA8D 0D 00                        	.word	13
   6820 00DA8F 11 00                        	.word	17
   6821 00DA91 15 00                        	.word	21
   6822 00DA93 19 00                        	.word	25
   6823 00DA95 1D 00                        	.word	29
                                           
   6825 00DA97 01 00                        	.word	1
   6826 00DA99 05 00                        	.word	5
   6827 00DA9B 09 00                        	.word	9
   6828 00DA9D 0D 00                        	.word	13
   6829 00DA9F 11 00                        	.word	17
   6830 00DAA1 15 00                        	.word	21
   6831 00DAA3 19 00                        	.word	25
   6832 00DAA5 1D 00                        	.word	29
                                           
   6834 00DAA7                             InvaderType:
   6835 00DAA7 01 00                        	.word	1
   6836 00DAA9 01 00                        	.word	1
   6837 00DAAB 01 00                        	.word	1
   6838 00DAAD 01 00                        	.word	1
   6839 00DAAF 01 00                        	.word	1
   6840 00DAB1 01 00                        	.word	1
   6841 00DAB3 01 00                        	.word	1
   6842 00DAB5 01 00                        	.word	1
                                           
   6844 00DAB7 02 00                        	.word	2
   6845 00DAB9 02 00                        	.word	2
   6846 00DABB 02 00                        	.word	2
   6847 00DABD 02 00                        	.word	2
   6848 00DABF 02 00                        	.word	2
   6849 00DAC1 02 00                        	.word	2
   6850 00DAC3 02 00                        	.word	2
   6851 00DAC5 02 00                        	.word	2
                                           
   6853 00DAC7 02 00                        	.word	2
   6854 00DAC9 02 00                        	.word	2
   6855 00DACB 02 00                        	.word	2
   6856 00DACD 02 00                        	.word	2
   6857 00DACF 02 00                        	.word	2
   6858 00DAD1 02 00                        	.word	2
   6859 00DAD3 02 00                        	.word	2
   6860 00DAD5 02 00                        	.word	2
                                           
   6862 00DAD7 03 00                        	.word	3
   6863 00DAD9 03 00                        	.word	3
   6864 00DADB 03 00                        	.word	3
   6865 00DADD 03 00                        	.word	3
   6866 00DADF 03 00                        	.word	3
   6867 00DAE1 03 00                        	.word	3
   6868 00DAE3 03 00                        	.word	3
   6869 00DAE5 03 00                        	.word	3
                                           
   6871 00DAE7 03 00                        	.word	3
   6872 00DAE9 03 00                        	.word	3
   6873 00DAEB 03 00                        	.word	3
   6874 00DAED 03 00                        	.word	3
   6875 00DAEF 03 00                        	.word	3
   6876 00DAF1 03 00                        	.word	3
   6877 00DAF3 03 00                        	.word	3
   6878 00DAF5 03 00                        	.word	3
                                           			
Finitron FT832 assembler   version 1.4   Sat May 27 19:56:42 2017     Page 1
FTBios816.asm


                                           .include "invaders.asm"
                                           
                                           ;	cpu		W65C816S
                                           	cpu		FT832
   6883 00DAF7 FF FF FF FF FF FF FF FF      	.org	$E000
   6883 00DAFF FF FF FF FF FF FF FF FF    
   6883 00DB07 FF FF FF FF FF FF FF FF    
   6883 00DB0F FF FF FF FF FF FF FF FF    
   6883 00DB17 FF FF FF FF FF FF FF FF    
   6883 00DB1F FF FF FF FF FF FF FF FF    
   6883 00DB27 FF FF FF FF FF FF FF FF    
   6883 00DB2F FF FF FF FF FF FF FF FF    
   6883 00DB37 FF FF FF FF FF FF FF FF    
   6883 00DB3F FF FF FF FF FF FF FF FF    
   6883 00DB47 FF FF FF FF FF FF FF FF    
   6883 00DB4F FF FF FF FF FF FF FF FF    
   6883 00DB57 FF FF FF FF FF FF FF FF    
   6883 00DB5F FF FF FF FF FF FF FF FF    
   6883 00DB67 FF FF FF FF FF FF FF FF    
   6883 00DB6F FF FF FF FF FF FF FF FF    
   6883 00DB77 FF FF FF FF FF FF FF FF    
   6883 00DB7F FF FF FF FF FF FF FF FF    
   6883 00DB87 FF FF FF FF FF FF FF FF    
   6883 00DB8F FF FF FF FF FF FF FF FF    
   6883 00DB97 FF FF FF FF FF FF FF FF    
   6883 00DB9F FF FF FF FF FF FF FF FF    
   6883 00DBA7 FF FF FF FF FF FF FF FF    
   6883 00DBAF FF FF FF FF FF FF FF FF    
   6883 00DBB7 FF FF FF FF FF FF FF FF    
   6883 00DBBF FF FF FF FF FF FF FF FF    
   6883 00DBC7 FF FF FF FF FF FF FF FF    
   6883 00DBCF FF FF FF FF FF FF FF FF    
   6883 00DBD7 FF FF FF FF FF FF FF FF    
   6883 00DBDF FF FF FF FF FF FF FF FF    
   6883 00DBE7 FF FF FF FF FF FF FF FF    
   6883 00DBEF FF FF FF FF FF FF FF FF    
   6883 00DBF7 FF FF FF FF FF FF FF FF    
   6883 00DBFF FF FF FF FF FF FF FF FF    
   6883 00DC07 FF FF FF FF FF FF FF FF    
   6883 00DC0F FF FF FF FF FF FF FF FF    
   6883 00DC17 FF FF FF FF FF FF FF FF    
   6883 00DC1F FF FF FF FF FF FF FF FF    
   6883 00DC27 FF FF FF FF FF FF FF FF    
   6883 00DC2F FF FF FF FF FF FF FF FF    
   6883 00DC37 FF FF FF FF FF FF FF FF    
   6883 00DC3F FF FF FF FF FF FF FF FF    
   6883 00DC47 FF FF FF FF FF FF FF FF    
   6883 00DC4F FF FF FF FF FF FF FF FF    
   6883 00DC57 FF FF FF FF FF FF FF FF    
   6883 00DC5F FF FF FF FF FF FF FF FF    
   6883 00DC67 FF FF FF FF FF FF FF FF    
   6883 00DC6F FF FF FF FF FF FF FF FF    
   6883 00DC77 FF FF FF FF FF FF FF FF    
   6883 00DC7F FF FF FF FF FF FF FF FF    
   6883 00DC87 FF FF FF FF FF FF FF FF    
   6883 00DC8F FF FF FF FF FF FF FF FF    
   6883 00DC97 FF FF FF FF FF FF FF FF    
   6883 00DC9F FF FF FF FF FF FF FF FF    
   6883 00DCA7 FF FF FF FF FF FF FF FF    
   6883 00DCAF FF FF FF FF FF FF FF FF    
   6883 00DCB7 FF FF FF FF FF FF FF FF    
   6883 00DCBF FF FF FF FF FF FF FF FF    
   6883 00DCC7 FF FF FF FF FF FF FF FF    
   6883 00DCCF FF FF FF FF FF FF FF FF    
   6883 00DCD7 FF FF FF FF FF FF FF FF    
   6883 00DCDF FF FF FF FF FF FF FF FF    
   6883 00DCE7 FF FF FF FF FF FF FF FF    
   6883 00DCEF FF FF FF FF FF FF FF FF    
   6883 00DCF7 FF FF FF FF FF FF FF FF    
   6883 00DCFF FF FF FF FF FF FF FF FF    
   6883 00DD07 FF FF FF FF FF FF FF FF    
   6883 00DD0F FF FF FF FF FF FF FF FF    
   6883 00DD17 FF FF FF FF FF FF FF FF    
   6883 00DD1F FF FF FF FF FF FF FF FF    
   6883 00DD27 FF FF FF FF FF FF FF FF    
   6883 00DD2F FF FF FF FF FF FF FF FF    
   6883 00DD37 FF FF FF FF FF FF FF FF    
   6883 00DD3F FF FF FF FF FF FF FF FF    
   6883 00DD47 FF FF FF FF FF FF FF FF    
   6883 00DD4F FF FF FF FF FF FF FF FF    
   6883 00DD57 FF FF FF FF FF FF FF FF    
   6883 00DD5F FF FF FF FF FF FF FF FF    
   6883 00DD67 FF FF FF FF FF FF FF FF    
   6883 00DD6F FF FF FF FF FF FF FF FF    
   6883 00DD77 FF FF FF FF FF FF FF FF    
   6883 00DD7F FF FF FF FF FF FF FF FF    
   6883 00DD87 FF FF FF FF FF FF FF FF    
   6883 00DD8F FF FF FF FF FF FF FF FF    
   6883 00DD97 FF FF FF FF FF FF FF FF    
   6883 00DD9F FF FF FF FF FF FF FF FF    
   6883 00DDA7 FF FF FF FF FF FF FF FF    
   6883 00DDAF FF FF FF FF FF FF FF FF    
   6883 00DDB7 FF FF FF FF FF FF FF FF    
   6883 00DDBF FF FF FF FF FF FF FF FF    
   6883 00DDC7 FF FF FF FF FF FF FF FF    
   6883 00DDCF FF FF FF FF FF FF FF FF    
   6883 00DDD7 FF FF FF FF FF FF FF FF    
   6883 00DDDF FF FF FF FF FF FF FF FF    
   6883 00DDE7 FF FF FF FF FF FF FF FF    
   6883 00DDEF FF FF FF FF FF FF FF FF    
   6883 00DDF7 FF FF FF FF FF FF FF FF    
   6883 00DDFF FF FF FF FF FF FF FF FF    
   6883 00DE07 FF FF FF FF FF FF FF FF    
   6883 00DE0F FF FF FF FF FF FF FF FF    
   6883 00DE17 FF FF FF FF FF FF FF FF    
   6883 00DE1F FF FF FF FF FF FF FF FF    
   6883 00DE27 FF FF FF FF FF FF FF FF    
   6883 00DE2F FF FF FF FF FF FF FF FF    
   6883 00DE37 FF FF FF FF FF FF FF FF    
   6883 00DE3F FF FF FF FF FF FF FF FF    
   6883 00DE47 FF FF FF FF FF FF FF FF    
   6883 00DE4F FF FF FF FF FF FF FF FF    
   6883 00DE57 FF FF FF FF FF FF FF FF    
   6883 00DE5F FF FF FF FF FF FF FF FF    
   6883 00DE67 FF FF FF FF FF FF FF FF    
   6883 00DE6F FF FF FF FF FF FF FF FF    
   6883 00DE77 FF FF FF FF FF FF FF FF    
   6883 00DE7F FF FF FF FF FF FF FF FF    
   6883 00DE87 FF FF FF FF FF FF FF FF    
   6883 00DE8F FF FF FF FF FF FF FF FF    
   6883 00DE97 FF FF FF FF FF FF FF FF    
   6883 00DE9F FF FF FF FF FF FF FF FF    
   6883 00DEA7 FF FF FF FF FF FF FF FF    
   6883 00DEAF FF FF FF FF FF FF FF FF    
   6883 00DEB7 FF FF FF FF FF FF FF FF    
   6883 00DEBF FF FF FF FF FF FF FF FF    
   6883 00DEC7 FF FF FF FF FF FF FF FF    
   6883 00DECF FF FF FF FF FF FF FF FF    
   6883 00DED7 FF FF FF FF FF FF FF FF    
   6883 00DEDF FF FF FF FF FF FF FF FF    
   6883 00DEE7 FF FF FF FF FF FF FF FF    
   6883 00DEEF FF FF FF FF FF FF FF FF    
   6883 00DEF7 FF FF FF FF FF FF FF FF    
   6883 00DEFF FF FF FF FF FF FF FF FF    
   6883 00DF07 FF FF FF FF FF FF FF FF    
   6883 00DF0F FF FF FF FF FF FF FF FF    
   6883 00DF17 FF FF FF FF FF FF FF FF    
   6883 00DF1F FF FF FF FF FF FF FF FF    
   6883 00DF27 FF FF FF FF FF FF FF FF    
   6883 00DF2F FF FF FF FF FF FF FF FF    
   6883 00DF37 FF FF FF FF FF FF FF FF    
   6883 00DF3F FF FF FF FF FF FF FF FF    
   6883 00DF47 FF FF FF FF FF FF FF FF    
   6883 00DF4F FF FF FF FF FF FF FF FF    
   6883 00DF57 FF FF FF FF FF FF FF FF    
   6883 00DF5F FF FF FF FF FF FF FF FF    
   6883 00DF67 FF FF FF FF FF FF FF FF    
   6883 00DF6F FF FF FF FF FF FF FF FF    
   6883 00DF77 FF FF FF FF FF FF FF FF    
   6883 00DF7F FF FF FF FF FF FF FF FF    
   6883 00DF87 FF FF FF FF FF FF FF FF    
   6883 00DF8F FF FF FF FF FF FF FF FF    
   6883 00DF97 FF FF FF FF FF FF FF FF    
   6883 00DF9F FF FF FF FF FF FF FF FF    
   6883 00DFA7 FF FF FF FF FF FF FF FF    
   6883 00DFAF FF FF FF FF FF FF FF FF    
   6883 00DFB7 FF FF FF FF FF FF FF FF    
   6883 00DFBF FF FF FF FF FF FF FF FF    
   6883 00DFC7 FF FF FF FF FF FF FF FF    
   6883 00DFCF FF FF FF FF FF FF FF FF    
   6883 00DFD7 FF FF FF FF FF FF FF FF    
   6883 00DFDF FF FF FF FF FF FF FF FF    
   6883 00DFE7 FF FF FF FF FF FF FF FF    
   6883 00DFEF FF FF FF FF FF FF FF FF    
   6883 00DFF7 FF FF FF FF FF FF FF FF    
   6883 00DFFF FF                         
                                           
   6885 00E000                             start:
   6886 00E000 78                           	SEI					; not strictly necessary after power on reset
   6887 00E001 D8                           	CLD
                                           ;	CLV					; overflow low
                                           ;	SEC					; carry high
                                           ;	XCE					; sets 32 bit mode, 32 bit registers
                                           ;	REP		#$30		; 32 bit registers
                                           ;	MEM		32
                                           ;	NDX		32
                                           ;	LDA		#$3FFF
                                           ;	TAS
                                           ;
   6897 00E002 18                           	CLC					; switch to '816 mode
   6898 00E003 2C 00 E0                     	BIT		start		; set overflow bit
   6899 00E006 FB                           	XCE
   6900 00E007 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
                                           	; Setup all the segment descriptors
                                           	; This must be done before the stack can be accessed, and
                                           	; before subroutine calls and task switching can be made.
                                           
                                           	; First setup segment #0, the segment the core starts running under.
                                           	; It's setup for flat addressing.
   6910 00E009 A9 00 00                     	LDA		#0
   6911 00E00C 42 EB                        	XBAW
   6912 00E00E A9 00 00                     	LDA		#0
   6913 00E011 A2 8D 09                     	LDX		#$98D		; present, writeable, executable, max size.
   6914 00E014 A8                           	TAY
   6915 00E015 42 BA                        	SDU
   6916 00E017 C8                           	INY
                                           
                                           	; Flag remaining segments as not present 
   6919 00E018 A2 00 00                     	LDX		#$000		; not present, non-executable, non-writeable, min size
   6920 00E01B                             .0003:
   6921 00E01B 42 BA                        	SDU					; update segment descriptor
   6922 00E01D C8                           	INY
   6923 00E01E C0 00 10                     	CPY		#4096
   6924 00E021 D0 F8                        	BNE		.0003
                                           
                                           	; setup code segment #1
   6927 00E023 A2 05 09                     	LDX		#$905		; executable, 64k
   6928 00E026 A8                           	TAY
   6929 00E027 C8                           	INY
   6930 00E028 42 BA                        	SDU
                                           	; setup data segment #2
   6932 00E02A A2 8B 08                     	LDX		#$88B		; writeable, 256M
   6933 00E02D C8                           	INY
   6934 00E02E 42 BA                        	SDU
                                           	; setup stack segment #3 (for 65c02 mode)
   6936 00E030 A2 82 08                     	LDX		#$882		; writeable, 1k (based at zero)
   6937 00E033 C8                           	INY
   6938 00E034 42 BA                        	SDU
                                           	; setup stack segment #4 (for 65c816 mode)
   6940 00E036 A2 85 08                     	LDX		#$885		; writeable, 64k (based at zero)
   6941 00E039 C8                           	INY
   6942 00E03A 42 BA                        	SDU
                                           	; seg #5 is the maxed out segment
   6944 00E03C A2 8D 09                     	LDX		#$98D		; executable, writable, max size
   6945 00E03F C8                           	INY
   6946 00E040 42 BA                        	SDU
                                           
                                           	; BASIC segment
   6949 00E042 A9 01 00                     	LDA		#$0001
   6950 00E045 42 EB                        	XBAW
   6951 00E047 A9 00 00                     	LDA		#$0000
   6952 00E04A A2 85 09                     	LDX		#$985		; executable, writeable, 64k (based at $10000)
   6953 00E04D A0 FD 0F                     	LDY		#$FFD
   6954 00E050 42 BA                        	SDU
                                           
                                           	; I/O segment
   6957 00E052 A9 F0 00                     	LDA		#$00F0
   6958 00E055 42 EB                        	XBAW
   6959 00E057 A9 00 00                     	LDA		#$0000
   6960 00E05A A2 87 08                     	LDX		#$887		; writeable, 1M (based at $F00000)
   6961 00E05D A0 FF 0F                     	LDY		#$FFF
   6962 00E060 42 BA                        	SDU
                                           
                                           	; now set the code segment (test far jump)
   6965 00E062 42 5C 69 E0 00 01 00         	JMF		1:.0004
   6966 00E069                             .0004:
                                           	; set the stack segment
                                           	; (must be before PEA/PLDS)
   6969 00E069 A9 05 00                     	LDA		#5
   6970 00E06C 42 5A                        	TASS
   6971 00E06E A9 FF 6B                     	LDA		#$6BFF		; set top of stack
   6972 00E071 1B                           	TAS
                                           
                                           	; setup the programmable address decodes
   6975 00E072 A9 70 00                     	LDA		#$0070		; program chip selects for I/O
   6976 00E075 8D 00 B0                     	STA		PCS0		; at $007000
   6977 00E078 A9 71 00                     	LDA		#$0071
   6978 00E07B 8D 02 B0                     	STA		PCS1
                                           ;	LDA		#$FEA1		; select $FEA1xx I/O
                                           ;	STA		PCS3
                                           ;	LDA		#$0000		; select zero page ram
                                           ;	STA		PCS5
                                           
                                           	; set the data segment
                                           	; this must be setup after address decoding is setup
   6986 00E07E F4 05 00                     	PEA		5
   6987 00E081 42 2B                        	PLDS
                                           
                                           	; Setup the counters
   6990 00E083 E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
                                           	; Counter #0 is setup as a free running tick count
   6994 00E085 A9 FF                        	LDA		#$FF		; set limit to $FFFFFF
   6995 00E087 8D 10 B0                     	STA		CTR0_LMT
   6996 00E08A 8D 11 B0                     	STA		CTR0_LMT+1
   6997 00E08D 8D 12 B0                     	STA		CTR0_LMT+2
   6998 00E090 A9 14                        	LDA		#$14		; count up, on mpu clock
   6999 00E092 8D 13 B0                     	STA		CTR0_CTRL
                                           	; Counter #1 is set to interrupt at a 100Hz rate
   7001 00E095 A9 94                        	LDA		#$94		; divide by 95794 (for 100Hz)
   7002 00E097 8D 14 B0                     	STA		CTR1_LMT
   7003 00E09A A9 57                        	LDA		#$57
   7004 00E09C 8D 15 B0                     	STA		CTR1_LMT+1
   7005 00E09F A9 09                        	LDA		#$09
   7006 00E0A1 8D 16 B0                     	STA		CTR1_LMT+2
   7007 00E0A4 A9 05                        	LDA		#$05		; count down, on mpu clock, irq disenabled
   7008 00E0A6 8D 17 B0                     	STA		CTR1_CTRL
                                           	; Counter #2 isn't setup
                                           
   7011 00E0A9 C2 30                        	REP		#$30		; set 16 bit regs & mem
                                           	NDX 	16
                                           	MEM		16
                                           
   7015 00E0AB 20 BC EB                     	JSR		ResetKbd
                                           
                                           ;	FORK	#8			; fork a BIOS context
                                           ;	TTA
                                           ;	CMP		#8
                                           ;	BNE		.0002
                                           ;	RTT
                                           ;.0002:
                                           	; Setup the task registers
   7024 00E0AE A0 08 00                     	LDY		#8			; # tasks to setup
   7025 00E0B1 A2 01 00                     	LDX		#1
   7026 00E0B4                             .0001:
   7027 00E0B4 42 4C D6 F2 00 00            	LDT		TaskStartTbl,X
   7028 00E0BA E8                           	INX
   7029 00E0BB 88                           	DEY
   7030 00E0BC D0 F6                        	BNE		.0001
                                           
   7032 00E0BE 64 B8                        	STZ		running_task
                                           
   7034 00E0C0 A9 6B F2                     	LDA		#BrkRout1
   7035 00E0C3 8D 02 01                     	STA		$0102
                                           
   7037 00E0C6 64 04                        	STZ		TickCount
   7038 00E0C8 64 06                        	STZ		TickCount+2
   7039 00E0CA                             Task0:
   7040 00E0CA 58                           	CLI
                                           	; Start the single stepping task.
   7042 00E0CB A9 01 00                     	LDA		#$01
   7043 00E0CE 8D 00 70                     	STA		$7000
   7044 00E0D1 42 A2 03 00                  	TSK		#3
   7045 00E0D5                             .0001:
   7046 00E0D5 A9 04 00                     	LDA		#$04
   7047 00E0D8 8D 00 70                     	STA		$7000
   7048 00E0DB A9 FF 0F                     	LDA		#$FFF
   7049 00E0DE 85 44                        	STA		Vidptr+4
   7050 00E0E0 85 4A                        	STA		Vidregs+4
   7051 00E0E2 A9 0D 00                     	LDA		#VIDBUF>>16
   7052 00E0E5 85 42                        	STA		Vidptr+2
   7053 00E0E7 64 40                        	STZ		Vidptr
   7054 00E0E9 A9 0D BF                     	LDA		#$BF0D	; 'm'
   7055 00E0EC 42 DA 42 87 40               	STA		FAR {Vidptr}
   7056 00E0F1 A9 0E 00                     	LDA		#VIDREGS >> 16
   7057 00E0F4 85 48                        	STA		Vidregs+2
   7058 00E0F6 A9 00 A0                     	LDA		#VIDREGS
   7059 00E0F9 85 46                        	STA		Vidregs
   7060 00E0FB A0 07 00                     	LDY		#7	
   7061 00E0FE A9 21 00                     	LDA		#$21		; divide by 3 vertically, 2 horizontally
   7062 00E101 20 37 EA                     	JSR		SetVideoReg	; clear POR state
   7063 00E104 A9 54 00                     	LDA		#84		; set window left position 84
   7064 00E107 A0 02 00                     	LDY		#2
   7065 00E10A 20 37 EA                     	JSR		SetVideoReg
   7066 00E10D A9 00 00                     	LDA		#0
   7067 00E110 A0 03 00                     	LDY		#3
   7068 00E113 20 37 EA                     	JSR		SetVideoReg
   7069 00E116 A9 10 00                     	LDA		#16			; set window top position
   7070 00E119 A0 04 00                     	LDY		#4
   7071 00E11C 20 37 EA                     	JSR		SetVideoReg
   7072 00E11F 20 1C EA                     	JSR		GetTextRowsCols
   7073 00E122 A9 EC E7                     	LDA		#DisplayChar
   7074 00E125 8D F0 03                     	STA		OutputVec
   7075 00E128 AD F0 03                     	LDA		OutputVec
   7076 00E12B C9 EC E7                     	CMP		#DisplayChar
   7077 00E12E D0 A5                        	BNE		.0001
   7078 00E130 A9 02 00                     	LDA		#$02
   7079 00E133 8D 00 70                     	STA		$7000
   7080 00E136 A9 00 BF                     	LDA		#$BF00
   7081 00E139 85 36                        	STA		NormAttr
   7082 00E13B 20 61 EA                     	JSR		ClearScreen
   7083 00E13E 20 B1 E9                     	JSR		HomeCursor
                                           ;	JSR		beep
   7085 00E141 A9 03 00                     	LDA		#$03
   7086 00E144 42 3B 05 00 8D 00 70         	STA		5:$7000
   7087 00E14B F4 05 00                     	PEA		5
   7088 00E14E F4 70 E6                     	PEA		msgStarting
   7089 00E151 20 ED E9                     	JSR		DisplayString
                                           ;	SEP		#$1000		; turn on single step mode
                                           ;	LDA		#0
                                           ;	STA		$FFF:FAC1
                                           ;	STA		$FFF:FAC1+2
                                           ;	STA		$FFF:FAC1+4
                                           ;	STA		$FFF:FAC1+6
                                           ;	STA		$FFF:FAC1+8
                                           ;	STA		$FFF:FAC1+10
                                           ;	LDA		#3
                                           ;	STA		$7000
                                           ;	LDA		#1234
                                           ;	STA		FAC1
                                           ;	LDA		#5			; FIX2FLT
                                           ;	JSR 	FPCommandWait
                                           ;	LDA		#4
                                           ;	STA		$7000
                                           ;	JSR		DivideByTen
                                           ;	LDA		#5
                                           ;	STA		$7000
                                           ;	JSR		FAC1ToString
                                           ;	PEA		2
                                           ;	PEA		$3A0
                                           ;	JSR		DisplayString
                                           ;	LDA		#' '
                                           ;	JSR		OutChar
                                           ;	JSR		DispFAC1
                                           
                                           ;	FORK	#11
                                           ;	TTA
                                           ;	CMP		#11
                                           ;	LBEQ	KeybdInit
                                           
                                           	; Create a workhorse BIOS context that will allow subroutine calls into
                                           	; the BIOS code from alternate contexts which may not have the same VM
                                           	; settings.
                                           	;
   7126 00E154 42 A0 FC 00                  	FORK	#$FC
   7127 00E158 42 1A                        	TTA
   7128 00E15A C9 FC 00                     	CMP		#$FC
   7129 00E15D D0 09                        	BNE		.0002
   7130 00E15F                             .0003
   7131 00E15F A2 FF 23                     	LDX		#$23FF
   7132 00E162 9A                           	TXS
   7133 00E163 58                           	CLI
   7134 00E164 42 60                        	RTT
   7135 00E166 80 F7                        	BRA		.0003
   7136 00E168                             .0002:
   7137 00E168 58                           	CLI
                                           
   7139 00E169                             Mon1:
   7140 00E169                             .mon1:
   7141 00E169 20 D5 E9                     	JSR		OutCRLF
   7142 00E16C A9 24 00                     	LDA		#'$'
   7143 00E16F                             .mon3:
   7144 00E16F 20 DE E9                     	JSR		OutChar
   7145 00E172 20 43 ED                     	JSR		KeybdGetCharWait
   7146 00E175 29 FF 00                     	AND		#$FF
                                           ;	CMP		#'.'
                                           ;	BEQ		.mon3
   7149 00E178 C9 0D 00                     	CMP		#CR
   7150 00E17B D0 F2                        	BNE		.mon3
   7151 00E17D A5 32                        	LDA		CursorY
   7152 00E17F 0A                           	ASL
   7153 00E180 AA                           	TAX
   7154 00E181 42 1B BD 98 F2               	LDA		CS:LineTbl,X
   7155 00E186 0A                           	ASL
   7156 00E187 AA                           	TAX
   7157 00E188                             .mon4:
   7158 00E188 20 08 E6                     	JSR		IgnoreBlanks
   7159 00E18B 20 F9 E1                     	JSR		MonGetch
   7160 00E18E C9 24 00                     	CMP		#'$'
   7161 00E191 F0 F5                        	BEQ		.mon4
   7162 00E193 C9 53 00                     	CMP		#'S'
   7163 00E196 D0 06                        	BNE		.mon2
   7164 00E198 42 A2 08 00                  	TSK		#8
   7165 00E19C 80 CB                        	BRA		.mon1
                                           	;JMP		$C000		; invoke Supermon816
   7167 00E19E                             .mon2:
   7168 00E19E C9 43 00                     	CMP		#'C'
   7169 00E1A1 D0 08                        	BNE		.mon5
   7170 00E1A3 20 61 EA                     	JSR		ClearScreen
   7171 00E1A6 20 B1 E9                     	JSR		HomeCursor
   7172 00E1A9 80 BE                        	BRA		.mon1
   7173 00E1AB                             .mon5:
   7174 00E1AB C9 4D 00                     	CMP		#'M'
   7175 00E1AE D0 05                        	BNE		.mon6
   7176 00E1B0 20 84 E4                     	JSR		doMemoryDump
   7177 00E1B3 80 B4                        	BRA		Mon1
   7178 00E1B5                             .mon6:
   7179 00E1B5 C9 44 00                     	CMP		#'D'
   7180 00E1B8 F0 FF CB 03                  	LBEQ	doDisassemble
   7181 00E1BC C9 3E 00                     	CMP		#'>'
   7182 00E1BF F0 FF 33 03                  	LBEQ	doMemoryEdit
   7183 00E1C3 C9 46 00                     	CMP		#'F'
   7184 00E1C6 F0 FF 67 03                  	LBEQ	doFill
   7185 00E1CA C9 4A 00                     	CMP		#'J'
   7186 00E1CD F0 FF 06 04                  	LBEQ	doJump
   7187 00E1D1 C9 54 00                     	CMP		#'T'
   7188 00E1D4 F0 FF 3E 00                  	LBEQ	doTask
   7189 00E1D8 C9 49 00                     	CMP		#'I'
   7190 00E1DB F0 FF 5C 00                  	LBEQ	doInvaders
   7191 00E1DF C9 52 00                     	CMP		#'R'
   7192 00E1E2 F0 FF 62 00                  	LBEQ	doRegs
   7193 00E1E6 C9 42 00                     	CMP		#'B'
   7194 00E1E9 F0 FF 33 00                  	LBEQ	doBasic
   7195 00E1ED 82 79 FF                     	BRL		Mon1
                                           
                                           ; Get a character from the screen, skipping over spaces and tabs
                                           ;
   7199 00E1F0                             MonGetNonSpace:
   7200 00E1F0                             .0001:
   7201 00E1F0 20 F9 E1                     	JSR		MonGetch
   7202 00E1F3 C9 20 00                     	CMP		#' '
   7203 00E1F6 F0 F8                        	BEQ		.0001
   7204 00E1F8 60                           	RTS
                                           
                                           ; Get a character from the screen.
                                           ;
   7208 00E1F9                             MonGetch:
   7209 00E1F9 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7210 00E201 E8                           	INX
   7211 00E202 E8                           	INX
   7212 00E203 29 FF 00                     	AND		#$FF
   7213 00E206 20 E0 E7                     	JSR		ScreenToAscii
   7214 00E209 60                           	RTS
                                           
   7216 00E20A                             MonErr:
   7217 00E20A F4 01 00                     	PEA		1
   7218 00E20D F4 6D F4                     	PEA		msgErr
   7219 00E210 20 ED E9                     	JSR		DisplayString
   7220 00E213 82 53 FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   7224 00E216                             doTask:
   7225 00E216 20 19 EB                     	JSR		GetHexNumber
   7226 00E219 A5 0C                        	LDA		NumWorkArea
   7227 00E21B 42 3A                        	TSK
   7228 00E21D 82 49 FF                     	BRL		Mon1
                                           
   7230 00E220                             doBasic:
   7231 00E220 42 A2 07 00                  	TSK		#7
   7232 00E224 82 42 FF                     	BRL		Mon1
   7233 00E227                             xitBasic:
   7234 00E227 C2 30                        	REP		#$30		; 16 bit regs
   7235 00E229 F4 05 00                     	PEA		$5			; switch back to BIOS data segment
   7236 00E22C 42 2B                        	PLDS
   7237 00E22E 78                           	SEI					; restore stack segment and pointer
   7238 00E22F A9 05 00                     	LDA		#5
   7239 00E232 42 5A                        	TASS
   7240 00E234 A6 9C                        	LDX		sp_save
   7241 00E236 9A                           	TXS
   7242 00E237 58                           	CLI
   7243 00E238 82 2E FF                     	BRL		Mon1
   7244 00E23B                             	
   7245 00E23B A9 FF FF                     	LDA		#$FFFF
   7246 00E23E 8D 68 78                     	STA		do_invaders
   7247 00E241 42 A2 05 00                  	TSK		#5
                                           ;	FORK	#5
                                           ;	TTA
                                           ;	CMP		#5
                                           ;	LBEQ	InvadersTask
   7252 00E245 82 21 FF                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display Registers
                                           ; R<xx>		xx = context register to display
                                           ; Update Registers
                                           ; R.<reg> <val>
                                           ;	reg = CS PB PC A X Y SP SR DS DB or DP
                                           ;------------------------------------------------------------------------------
                                           
   7262 00E248                             doRegs:
   7263 00E248 20 F9 E1                     	JSR		MonGetch
   7264 00E24B C9 2E 00                     	CMP		#'.'
   7265 00E24E D0 FF 13 01                  	LBNE	.0004
   7266 00E252 20 F9 E1                     	JSR		MonGetch
   7267 00E255 C9 43 00                     	CMP		#'C'
   7268 00E258 D0 26                        	BNE		.0005
   7269 00E25A 20 F9 E1                     	JSR		MonGetch
   7270 00E25D C9 53 00                     	CMP		#'S'
   7271 00E260 D0 FF 05 FF                  	LBNE	Mon1
   7272 00E264 20 08 E6                     	JSR		IgnoreBlanks
   7273 00E267 20 19 EB                     	JSR		GetHexNumber
   7274 00E26A A5 0C                        	LDA		NumWorkArea
   7275 00E26C 85 80                        	STA		reg_cs
   7276 00E26E A5 0E                        	LDA		NumWorkArea+2
   7277 00E270 85 82                        	STA		reg_cs+2
   7278 00E272                             .buildrec
   7279 00E272 20 1F E4                     	JSR		BuildRec
   7280 00E275 A6 BE                        	LDX		WorkTR
   7281 00E277 42 6C 00 01 00 00            	LDT		ldtrec
   7282 00E27D 82 E9 FE                     	BRL		Mon1
   7283 00E280                             .0005:
   7284 00E280 C9 50 00                     	CMP		#'P'
   7285 00E283 D0 27                        	BNE		.0006
   7286 00E285 20 F9 E1                     	JSR		MonGetch
   7287 00E288 C9 42 00                     	CMP		#'B'
   7288 00E28B D0 0C                        	BNE		.0007
   7289 00E28D 20 08 E6                     	JSR		IgnoreBlanks
   7290 00E290 20 19 EB                     	JSR		GetHexNumber
   7291 00E293 A5 0E                        	LDA		NumWorkArea+2
   7292 00E295 85 8E                        	STA		reg_pc+2
   7293 00E297 80 D9                        	BRA		.buildrec
   7294 00E299                             .0007:
   7295 00E299 C9 43 00                     	CMP		#'C'
   7296 00E29C D0 FF C9 FE                  	LBNE	Mon1
   7297 00E2A0 20 08 E6                     	JSR		IgnoreBlanks
   7298 00E2A3 20 19 EB                     	JSR		GetHexNumber
   7299 00E2A6 A5 0C                        	LDA		NumWorkArea
   7300 00E2A8 85 8C                        	STA		reg_pc
   7301 00E2AA 80 C6                        	BRA		.buildrec
   7302 00E2AC                             .0006:
   7303 00E2AC C9 41 00                     	CMP		#'A'
   7304 00E2AF D0 10                        	BNE		.0008
   7305 00E2B1 20 08 E6                     	JSR		IgnoreBlanks
   7306 00E2B4 20 19 EB                     	JSR		GetHexNumber
   7307 00E2B7 A5 0C                        	LDA		NumWorkArea
   7308 00E2B9 85 90                        	STA		reg_a
   7309 00E2BB A5 0E                        	LDA		NumWorkArea+2
   7310 00E2BD 85 92                        	STA		reg_a+2
   7311 00E2BF 80 B1                        	BRA		.buildrec
   7312 00E2C1                             .0008:
   7313 00E2C1 C9 58 00                     	CMP		#'X'
   7314 00E2C4 D0 11                        	BNE		.0009
   7315 00E2C6 20 08 E6                     	JSR		IgnoreBlanks
   7316 00E2C9 20 19 EB                     	JSR		GetHexNumber
   7317 00E2CC A5 0C                        	LDA		NumWorkArea
   7318 00E2CE 85 94                        	STA		reg_x
   7319 00E2D0 A5 0E                        	LDA		NumWorkArea+2
   7320 00E2D2 85 96                        	STA		reg_x+2
   7321 00E2D4 82 9B FF                     	BRL		.buildrec
   7322 00E2D7                             .0009:
   7323 00E2D7 C9 59 00                     	CMP		#'Y'
   7324 00E2DA D0 11                        	BNE		.0010
   7325 00E2DC 20 08 E6                     	JSR		IgnoreBlanks
   7326 00E2DF 20 19 EB                     	JSR		GetHexNumber
   7327 00E2E2 A5 0C                        	LDA		NumWorkArea
   7328 00E2E4 85 98                        	STA		reg_y
   7329 00E2E6 A5 0E                        	LDA		NumWorkArea+2
   7330 00E2E8 85 9A                        	STA		reg_y+2
   7331 00E2EA 82 85 FF                     	BRL		.buildrec
   7332 00E2ED                             .0010:
   7333 00E2ED C9 53 00                     	CMP		#'S'
   7334 00E2F0 D0 2D                        	BNE		.0011
   7335 00E2F2 20 F9 E1                     	JSR		MonGetch
   7336 00E2F5 C9 50 00                     	CMP		#'P'
   7337 00E2F8 D0 11                        	BNE		.0015
   7338 00E2FA 20 08 E6                     	JSR		IgnoreBlanks
   7339 00E2FD 20 19 EB                     	JSR		GetHexNumber
   7340 00E300 A5 0C                        	LDA		NumWorkArea
   7341 00E302 85 9C                        	STA		reg_sp
   7342 00E304 A5 0E                        	LDA		NumWorkArea+2
   7343 00E306 85 9E                        	STA		reg_sp+2
   7344 00E308 82 67 FF                     	BRL		.buildrec
   7345 00E30B                             .0015:
   7346 00E30B C9 52 00                     	CMP		#'R'
   7347 00E30E D0 FF 57 FE                  	LBNE	Mon1
   7348 00E312 20 08 E6                     	JSR		IgnoreBlanks
   7349 00E315 20 19 EB                     	JSR		GetHexNumber
   7350 00E318 A5 0C                        	LDA		NumWorkArea
   7351 00E31A 85 A0                        	STA		reg_sr
   7352 00E31C 82 53 FF                     	BRL		.buildrec
   7353 00E31F                             .0011:
   7354 00E31F C9 44 00                     	CMP		#'D'
   7355 00E322 D0 FF 43 FE                  	LBNE	Mon1
   7356 00E326 20 F9 E1                     	JSR		MonGetch
   7357 00E329 C9 53 00                     	CMP		#'S'
   7358 00E32C D0 11                        	BNE		.0012
   7359 00E32E 20 08 E6                     	JSR		IgnoreBlanks
   7360 00E331 20 19 EB                     	JSR		GetHexNumber
   7361 00E334 A5 0C                        	LDA		NumWorkArea
   7362 00E336 85 84                        	STA		reg_ds
   7363 00E338 A5 0E                        	LDA		NumWorkArea+2
   7364 00E33A 85 86                        	STA		reg_ds+2
   7365 00E33C 82 33 FF                     	BRL		.buildrec
   7366 00E33F                             .0012:
   7367 00E33F C9 42 00                     	CMP		#'B'
   7368 00E342 D0 0D                        	BNE		.0013
   7369 00E344 20 08 E6                     	JSR		IgnoreBlanks
   7370 00E347 20 19 EB                     	JSR		GetHexNumber
   7371 00E34A A5 0C                        	LDA		NumWorkArea
   7372 00E34C 85 A4                        	STA		reg_db
   7373 00E34E 82 21 FF                     	BRL		.buildrec
   7374 00E351                             .0013:
   7375 00E351 C9 50 00                     	CMP		#'P'
   7376 00E354 D0 FF 11 FE                  	LBNE	Mon1
   7377 00E358 20 08 E6                     	JSR		IgnoreBlanks
   7378 00E35B 20 19 EB                     	JSR		GetHexNumber
   7379 00E35E A5 0C                        	LDA		NumWorkArea
   7380 00E360 85 A8                        	STA		reg_dp
   7381 00E362 82 0D FF                     	BRL		.buildrec
                                           
   7383 00E365                             .0004:
   7384 00E365 CA                           	DEX
   7385 00E366 CA                           	DEX
                                           ;	JSR		IgnoreBlanks
   7387 00E367 20 19 EB                     	JSR		GetHexNumber
   7388 00E36A C0 00 00                     	CPY		#0
   7389 00E36D F0 FF F8 FD                  	LBEQ	Mon1
   7390 00E371 A5 0C                        	LDA		NumWorkArea
   7391 00E373 85 BE                        	STA		WorkTR
   7392 00E375 42 28 03 00                  	BSR		DispRegs
   7393 00E379 82 ED FD                     	BRL		Mon1
                                           
   7395 00E37C                             DispRegs:
   7396 00E37C F4 01 00                     	PEA		1
   7397 00E37F F4 F6 F3                     	PEA		msgRegs
   7398 00E382 20 ED E9                     	JSR		DisplayString
   7399 00E385 20 E5 EA                     	JSR		space
                                           
   7401 00E388 A5 BE                        	LDA		WorkTR
   7402 00E38A 0A                           	ASL
   7403 00E38B 0A                           	ASL
   7404 00E38C 0A                           	ASL
   7405 00E38D 0A                           	ASL
   7406 00E38E AA                           	TAX
                                           
   7408 00E38F A0 00 00                     	LDY		#0
   7409 00E392                             .0001:
   7410 00E392 42 4A                        	INF
   7411 00E394 E8                           	INX
   7412 00E395 99 80 00                     	STA		reg_cs,Y
   7413 00E398 42 EB                        	XBAW
   7414 00E39A 99 82 00                     	STA		reg_cs+2,Y
   7415 00E39D 42 C8                        	INY4
   7416 00E39F C0 30 00                     	CPY		#48
   7417 00E3A2 D0 EE                        	BNE		.0001
                                           
                                           	; Display CS
   7420 00E3A4 A5 80                        	LDA		reg_cs
   7421 00E3A6 20 BE EA                     	JSR		DispWord
   7422 00E3A9 A9 3A 00                     	LDA		#':'
   7423 00E3AC 20 DE E9                     	JSR		OutChar
                                           
                                           	; Display PB PC
   7426 00E3AF A5 8E                        	LDA		reg_pc+2
   7427 00E3B1 20 C3 EA                     	JSR		DispByte
   7428 00E3B4 A5 8C                        	LDA		reg_pc
   7429 00E3B6 20 BE EA                     	JSR		DispWord
   7430 00E3B9 20 E5 EA                     	JSR		space
                                           
                                           	; Display SRX,SR
   7433 00E3BC A5 A0                        	LDA		reg_cs+32
   7434 00E3BE A2 10 00                     	LDX		#16
   7435 00E3C1                             .0003:
   7436 00E3C1 0A                           	ASL
   7437 00E3C2 48                           	PHA
   7438 00E3C3 A9 30 00                     	LDA		#'0'
   7439 00E3C6 69 00 00                     	ADC		#0
   7440 00E3C9 20 CC EA                     	JSR		DispNybble
   7441 00E3CC 68                           	PLA
   7442 00E3CD CA                           	DEX
   7443 00E3CE D0 F1                        	BNE		.0003
   7444 00E3D0 20 E5 EA                     	JSR		space
                                           
   7446 00E3D3 A2 10 00                     	LDX		#16
   7447 00E3D6                             .0002
                                           	; display Acc,.X,.Y,.SP
   7449 00E3D6 B5 82                        	LDA		reg_cs+2,X
   7450 00E3D8 20 BE EA                     	JSR		DispWord
   7451 00E3DB B5 80                        	LDA		reg_cs,X
   7452 00E3DD 20 BE EA                     	JSR		DispWord
   7453 00E3E0 20 E5 EA                     	JSR		space
   7454 00E3E3 42 E8                        	INX4
   7455 00E3E5 E0 20 00                     	CPX		#32
   7456 00E3E8 D0 EC                        	BNE		.0002
                                           
   7458 00E3EA F4 01 00                     	PEA		1
   7459 00E3ED F4 52 F4                     	PEA		msgRegs2
   7460 00E3F0 20 ED E9                     	JSR		DisplayString
   7461 00E3F3 20 E5 EA                     	JSR		space
                                           
                                           	; Display SS
   7464 00E3F6 A5 88                        	LDA		reg_ss
   7465 00E3F8 20 BE EA                     	JSR		DispWord
   7466 00E3FB 20 E5 EA                     	JSR		space
                                           
                                           	; Display DS
   7469 00E3FE A5 84                        	LDA		reg_ds
   7470 00E400 20 BE EA                     	JSR		DispWord
   7471 00E403 20 E5 EA                     	JSR		space
                                           
                                           	; Display DB
   7474 00E406 A5 A4                        	LDA		reg_db
   7475 00E408 20 C3 EA                     	JSR		DispByte
   7476 00E40B 20 E5 EA                     	JSR		space
                                           
                                           	; Display DPR
   7479 00E40E A5 A8                        	LDA		reg_dp
   7480 00E410 20 BE EA                     	JSR		DispWord
   7481 00E413 20 E5 EA                     	JSR		space
                                           
                                           	; Display back link
   7484 00E416 A5 AC                        	LDA		reg_bl
   7485 00E418 20 BE EA                     	JSR		DispWord
                                           
   7487 00E41B 20 D5 E9                     	JSR		OutCRLF
   7488 00E41E 60                           	RTS
                                           
                                           ; Build a startup record from the register values so that a context reg
                                           ; may be loaded
                                           
   7493 00E41F                             BuildRec:
   7494 00E41F A5 80                        	LDA		reg_cs
   7495 00E421 8D 00 01                     	STA		ldtrec
   7496 00E424 A5 84                        	LDA		reg_ds
   7497 00E426 8D 02 01                     	STA		ldtrec+2
   7498 00E429 A5 88                        	LDA		reg_ss
   7499 00E42B 8D 04 01                     	STA		ldtrec+4
   7500 00E42E A5 8C                        	LDA		reg_pc
   7501 00E430 8D 06 01                     	STA		ldtrec+6
   7502 00E433 A5 8E                        	LDA		reg_pc+2
   7503 00E435 29 FF 00                     	AND		#$FF
   7504 00E438 E2 30                        	SEP		#$30		; 8 bit regs
                                           	MEM		8
   7506 00E43A EB                           	XBA
   7507 00E43B A5 90                        	LDA		reg_a
   7508 00E43D EB                           	XBA
   7509 00E43E C2 30                        	REP		#$30
                                           	MEM		16
   7511 00E440 8D 08 01                     	STA		ldtrec+8
   7512 00E443 A5 91                        	LDA		reg_a+1
   7513 00E445 8D 0A 01                     	STA		ldtrec+10
   7514 00E448 A5 93                        	LDA		reg_a+3
   7515 00E44A 8D 0C 01                     	STA		ldtrec+12
   7516 00E44D A5 95                        	LDA		reg_x+1
   7517 00E44F 8D 0E 01                     	STA		ldtrec+14
   7518 00E452 A5 97                        	LDA		reg_x+3
   7519 00E454 8D 10 01                     	STA		ldtrec+16
   7520 00E457 A5 99                        	LDA		reg_y+1
   7521 00E459 8D 12 01                     	STA		ldtrec+18
   7522 00E45C A5 9B                        	LDA		reg_y+3
   7523 00E45E 8D 14 01                     	STA		ldtrec+20
   7524 00E461 A5 9D                        	LDA		reg_sp+1
   7525 00E463 8D 16 01                     	STA		ldtrec+22
   7526 00E466 A5 9F                        	LDA		reg_sp+3
   7527 00E468 8D 18 01                     	STA		ldtrec+24
   7528 00E46B E2 30                        	SEP		#$30
   7529 00E46D A5 A1                        	LDA		reg_sr+1
   7530 00E46F 8D 1A 01                     	STA		ldtrec+26
   7531 00E472 A5 A4                        	LDA		reg_db
   7532 00E474 8D 1B 01                     	STA		ldtrec+27
   7533 00E477 A5 A8                        	LDA		reg_dp
   7534 00E479 8D 1C 01                     	STA		ldtrec+28
   7535 00E47C A5 A9                        	LDA		reg_dp+1
   7536 00E47E 8D 1D 01                     	STA		ldtrec+29
   7537 00E481 C2 30                        	REP		#$30
   7538 00E483 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Dump memory.
                                           ;------------------------------------------------------------------------------
                                           
   7544 00E484                             doMemoryDump:
   7545 00E484 20 08 E6                     	JSR		IgnoreBlanks
   7546 00E487 20 EE EA                     	JSR		GetRange
   7547 00E48A 20 D5 E9                     	JSR		OutCRLF
   7548 00E48D                             .0007:
   7549 00E48D A9 3E 00                     	LDA		#'>'
   7550 00E490 20 DE E9                     	JSR		OutChar
   7551 00E493 20 F8 E5                     	JSR		DispRangeStart
   7552 00E496 A0 00 00                     	LDY		#0
   7553 00E499                             .0001:
   7554 00E499 42 B7 20                     	LDA		{RangeStart},Y
   7555 00E49C 20 C3 EA                     	JSR		DispByte
   7556 00E49F A9 20 00                     	LDA		#' '
   7557 00E4A2 20 DE E9                     	JSR		OutChar
   7558 00E4A5 C8                           	INY
   7559 00E4A6 C0 08 00                     	CPY		#8
   7560 00E4A9 D0 EE                        	BNE		.0001
   7561 00E4AB A0 00 00                     	LDY 	#0
   7562 00E4AE                             .0005:
   7563 00E4AE 42 B7 20                     	LDA		{RangeStart},Y
   7564 00E4B1 29 FF 00                     	AND		#$FF
   7565 00E4B4 C9 20 00                     	CMP		#' '
   7566 00E4B7 B0 05                        	BCS		.0002
   7567 00E4B9                             .0004:
   7568 00E4B9 A9 2E 00                     	LDA		#'.'
   7569 00E4BC 80 05                        	BRA		.0003
   7570 00E4BE                             .0002:
   7571 00E4BE C9 7F 00                     	CMP		#$7f
   7572 00E4C1 B0 F6                        	BCS		.0004
   7573 00E4C3                             .0003:
   7574 00E4C3 20 DE E9                     	JSR		OutChar
   7575 00E4C6 C8                           	INY
   7576 00E4C7 C0 08 00                     	CPY		#8
   7577 00E4CA D0 E2                        	BNE		.0005
   7578 00E4CC 20 D5 E9                     	JSR		OutCRLF
   7579 00E4CF 18                           	CLC
   7580 00E4D0 A5 20                        	LDA		RangeStart
   7581 00E4D2 69 08 00                     	ADC		#8
   7582 00E4D5 85 20                        	STA		RangeStart
   7583 00E4D7 90 02                        	BCC		.0006
   7584 00E4D9 E6 22                        	INC		RangeStart+2
   7585 00E4DB                             .0006:
   7586 00E4DB 38                           	SEC
   7587 00E4DC A5 24                        	LDA		RangeEnd
   7588 00E4DE E5 20                        	SBC		RangeStart
   7589 00E4E0 A5 26                        	LDA		RangeEnd+2
   7590 00E4E2 E5 22                        	SBC		RangeStart+2
   7591 00E4E4 08                           	PHP
   7592 00E4E5 20 38 ED                     	JSR		KeybdGetCharNoWait;Ctx,7
   7593 00E4E8 29 FF 00                     	AND		#$FF
   7594 00E4EB C9 03 00                     	CMP		#CTRLC
   7595 00E4EE F0 04                        	BEQ		.0009
   7596 00E4F0 28                           	PLP
   7597 00E4F1 10 9A                        	BPL		.0007
   7598 00E4F3                             .0008:
   7599 00E4F3 60                           	RTS
   7600 00E4F4                             .0009:
   7601 00E4F4 28                           	PLP
   7602 00E4F5 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Edit memory.
                                           ; ><memory address> <val1> <val2> ... <val8>
                                           ;------------------------------------------------------------------------------
                                           
   7609 00E4F6                             doMemoryEdit:
   7610 00E4F6 20 08 E6                     	JSR		IgnoreBlanks
   7611 00E4F9 20 19 EB                     	JSR		GetHexNumber
   7612 00E4FC C0 00 00                     	CPY		#0
   7613 00E4FF F0 FF 66 FC                  	LBEQ	Mon1
   7614 00E503 A5 0C                        	LDA		NumWorkArea
   7615 00E505 85 20                        	STA		RangeStart
   7616 00E507 A5 0E                        	LDA		NumWorkArea+2
   7617 00E509 85 22                        	STA		RangeStart+2
   7618 00E50B A0 00 00                     	LDY		#0
   7619 00E50E                             .0001:
   7620 00E50E 5A                           	PHY
   7621 00E50F 20 08 E6                     	JSR		IgnoreBlanks
   7622 00E512 20 19 EB                     	JSR		GetHexNumber
   7623 00E515 C0 00 00                     	CPY		#0
   7624 00E518 F0 13                        	BEQ		.0002
   7625 00E51A 7A                           	PLY
   7626 00E51B E2 20                        	SEP		#$20
   7627 00E51D A5 0C                        	LDA		NumWorkArea
   7628 00E51F 42 97 20                     	STA		{RangeStart},Y
   7629 00E522 C2 20                        	REP		#$20
   7630 00E524 C8                           	INY
   7631 00E525 C0 08 00                     	CPY		#8
   7632 00E528 D0 E4                        	BNE		.0001
   7633 00E52A 82 3C FC                     	BRL		Mon1
   7634 00E52D                             .0002:
   7635 00E52D 7A                           	PLY
   7636 00E52E 82 38 FC                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Fill memory.
                                           ; $F <start address> <end address> <val1>
                                           ;------------------------------------------------------------------------------
                                           
   7643 00E531                             doFill:
   7644 00E531 20 08 E6                     	JSR		IgnoreBlanks
   7645 00E534 20 19 EB                     	JSR		GetHexNumber
   7646 00E537 C0 00 00                     	CPY		#0
   7647 00E53A F0 FF CC FC                  	LBEQ	MonErr
   7648 00E53E A5 0C                        	LDA		NumWorkArea
   7649 00E540 85 20                        	STA		RangeStart
   7650 00E542 A5 0E                        	LDA		NumWorkArea+2
   7651 00E544 85 22                        	STA		RangeStart+2
   7652 00E546 20 08 E6                     	JSR		IgnoreBlanks
   7653 00E549 20 19 EB                     	JSR		GetHexNumber
   7654 00E54C C0 00 00                     	CPY		#0
   7655 00E54F F0 FF B7 FC                  	LBEQ	MonErr
   7656 00E553 A5 0C                        	LDA		NumWorkArea
   7657 00E555 85 24                        	STA		RangeEnd
   7658 00E557 A5 0E                        	LDA		NumWorkArea+2
   7659 00E559 85 26                        	STA		RangeEnd+2
   7660 00E55B 20 08 E6                     	JSR		IgnoreBlanks
   7661 00E55E 20 19 EB                     	JSR		GetHexNumber
   7662 00E561 C0 00 00                     	CPY		#0
   7663 00E564 F0 FF A2 FC                  	LBEQ	MonErr
   7664 00E568 A6 0C                        	LDX		NumWorkArea
                                           	; Process in 32 bit mode
   7666 00E56A 42 E2 00 02                  	SEP		#$200
   7667 00E56E 42 C2 00 01                  	REP		#$100
   7668 00E572 A5 24                        	LDA		RangeEnd
   7669 00E574 38                           	SEC
   7670 00E575 E5 20                        	SBC		RangeStart
   7671 00E577 A4 20                        	LDY		RangeStart
   7672 00E579 42 44 00                     	FIL		$00
                                           	; Back to 16 bits mode
   7674 00E57C 42 C2 00 02                  	REP		#$200
   7675 00E580 42 E2 00 01                  	SEP		#$100
   7676 00E584 82 E2 FB                     	BRL		Mon1
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Disassemble code
                                           ;------------------------------------------------------------------------------
                                           
   7682 00E587                             doDisassemble:
   7683 00E587 20 F9 E1                     	JSR		MonGetch
   7684 00E58A C9 4D 00                     	CMP		#'M'
   7685 00E58D F0 11                        	BEQ		.0002
   7686 00E58F                             .0004:
   7687 00E58F C9 4E 00                     	CMP		#'N'
   7688 00E592 D0 1B                        	BNE		.0003
   7689 00E594 E2 20                        	SEP		#$20
                                           	MEM		8
   7691 00E596 A5 BC                        	LDA		$BC
   7692 00E598 09 40                        	ORA		#$40
   7693 00E59A 85 BC                        	STA		$BC
   7694 00E59C C2 20                        	REP		#$20
   7695 00E59E 80 11                        	BRA		.0005
   7696 00E5A0                             .0002:
   7697 00E5A0 E2 20                        	SEP		#$20
   7698 00E5A2 A5 BC                        	LDA		$BC
   7699 00E5A4 09 80                        	ORA		#$80
   7700 00E5A6 85 BC                        	STA		$BC
   7701 00E5A8 C2 20                        	REP		#$20
   7702 00E5AA 20 F9 E1                     	JSR		MonGetch
   7703 00E5AD 80 E0                        	BRA		.0004
                                           	MEM		16
   7705 00E5AF                             .0003:
   7706 00E5AF CA                           	DEX
   7707 00E5B0 CA                           	DEX
   7708 00E5B1                             .0005:
   7709 00E5B1 20 08 E6                     	JSR		IgnoreBlanks
   7710 00E5B4 20 EE EA                     	JSR		GetRange
   7711 00E5B7 A5 20                        	LDA		RangeStart
   7712 00E5B9 85 8F                        	STA		$8F				; addra
   7713 00E5BB A5 21                        	LDA		RangeStart+1
   7714 00E5BD 85 90                        	STA		$90
   7715 00E5BF 20 D5 E9                     	JSR		OutCRLF
   7716 00E5C2 A0 14 00                     	LDY		#20
   7717 00E5C5                             .0001:
   7718 00E5C5 5A                           	PHY
   7719 00E5C6 E2 30                        	SEP		#$30
   7720 00E5C8 20 77 C6                     	JSR		dpycod
   7721 00E5CB C2 30                        	REP		#$30
   7722 00E5CD 20 D5 E9                     	JSR		OutCRLF
   7723 00E5D0 7A                           	PLY
   7724 00E5D1 88                           	DEY
   7725 00E5D2 D0 F1                        	BNE		.0001
   7726 00E5D4 4C 69 E1                     	JMP		Mon1
                                           
                                           ;$BC flimflag
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Jump to subroutine
                                           ;------------------------------------------------------------------------------
                                           
   7734 00E5D7                             doJump:
   7735 00E5D7 20 08 E6                     	JSR		IgnoreBlanks
   7736 00E5DA 20 19 EB                     	JSR		GetHexNumber
   7737 00E5DD C0 00 00                     	CPY		#0
   7738 00E5E0 F0 FF 85 FB                  	LBEQ	Mon1
   7739 00E5E4 A9 5C 00                     	LDA		#$5C			; JML opcode
   7740 00E5E7 85 23                        	STA		RangeEnd-1
   7741 00E5E9 A5 0C                        	LDA		NumWorkArea
   7742 00E5EB 85 24                        	STA		RangeEnd
   7743 00E5ED A5 0D                        	LDA		NumWorkArea+1
   7744 00E5EF 85 25                        	STA		RangeEnd+1
   7745 00E5F1 22 24 00 00                  	JSL		RangeEnd
   7746 00E5F5 82 71 FB                     	BRL		Mon1
                                           
   7748 00E5F8                             DispRangeStart:
   7749 00E5F8 A5 21                        	LDA		RangeStart+1
   7750 00E5FA 20 BE EA                     	JSR		DispWord
   7751 00E5FD A5 20                        	LDA		RangeStart
   7752 00E5FF 20 C3 EA                     	JSR		DispByte
   7753 00E602 A9 20 00                     	LDA		#' '
   7754 00E605 4C DE E9                     	JMP		OutChar
                                           	
                                           ; Skip over blanks in the input
                                           ;------------------------------------------------------------------------------
                                           
   7759 00E608                             IgnoreBlanks:
   7760 00E608                             .0001:
   7761 00E608 20 F9 E1                     	JSR		MonGetch
   7762 00E60B C9 20 00                     	CMP		#' '
   7763 00E60E F0 F8                        	BEQ		.0001
   7764 00E610 CA                           	DEX
   7765 00E611 CA                           	DEX
   7766 00E612 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; BIOSInput allows full screen editing of text until a carriage return is keyed
                                           ; at which point the line the cursor is on is copied to a buffer. The buffer
                                           ; must be at least TEXTCOLS characters in size.
                                           ;------------------------------------------------------------------------------
                                           ;
   7774 00E613                             BIOSInput:
   7775 00E613                             .bin1:
   7776 00E613 20 43 ED                     	JSR		KeybdGetCharWait
   7777 00E616 29 FF 00                     	AND		#$FF
   7778 00E619 C9 0D 00                     	CMP		#CR
   7779 00E61C F0 05                        	BEQ		.bin2
   7780 00E61E 20 DE E9                     	JSR		OutChar
   7781 00E621 80 F0                        	BRA		.bin1
   7782 00E623                             .bin2:
   7783 00E623 A5 30                        	LDA		CursorX
   7784 00E625 F0 1E                        	BEQ		.bin4
   7785 00E627 A5 34                        	LDA		VideoPos	; get current video position
   7786 00E629 38                           	SEC
   7787 00E62A E5 30                        	SBC		CursorX		; go back to the start of the line
   7788 00E62C 0A                           	ASL
   7789 00E62D AA                           	TAX
   7790 00E62E                             .bin3:
   7791 00E62E 42 3B FF 0F BF 00 00 0D      	LDA		$FFF:VIDBUF,X
                                         
   7792 00E636 29 FF 00                     	AND		#$FF
   7793 00E639 93 03                        	STA		(3,s),Y
   7794 00E63B E8                           	INX
   7795 00E63C E8                           	INX
   7796 00E63D C8                           	INY
   7797 00E63E C6 30                        	DEC		CursorX
   7798 00E640 D0 EC                        	BNE		.bin3
   7799 00E642 A9 00 00                     	LDA		#0
   7800 00E645                             .bin4:
   7801 00E645 93 03                        	STA		(3,s),Y	; NULL terminate buffer
   7802 00E647 60                           	RTS
                                           
   7804 00E648                             .st0003:
   7805 00E648 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD
                                         
   7806 00E650 10 F6                        	BPL		.st0003
   7807 00E652 48                           	PHA						; save off the char (we need to trash acc)
   7808 00E653 42 3B FF 0F AF 14 A1 0E      	LDA		$FFF:KEYBD+4	; clear keyboard strobe (must be a read operation)
                                         
   7809 00E65B 68                           	PLA						; restore char
   7810 00E65C 20 EC E7                     	JSR		DisplayChar
   7811 00E65F 80 E7                        	BRA		.st0003
   7812 00E661 A0 00 00                     	ldy		#$0000
   7813 00E664                             .st0001:
   7814 00E664 A2 00 00                     	ldx		#$0000
   7815 00E667                             .st0002:
   7816 00E667 E8                           	inx
   7817 00E668 D0 FD                        	bne		.st0002
   7818 00E66A 20 8D E6                     	jsr		echo_switch
   7819 00E66D C8                           	iny
   7820 00E66E 80 F4                        	bra		.st0001
                                           
   7822 00E670                             msgStarting:
   7823 00E670 46 54 38 33 32 20 54 65      	.byte	"FT832 Test System Starting",CR,LF,0
   7823 00E678 73 74 20 53 79 73 74 65    
   7823 00E680 6D 20 53 74 61 72 74 69    
   7823 00E688 6E 67 0D 0A 00             
                                           
   7825 00E68D                             echo_switch:
   7826 00E68D AD 00 71                     	lda		$7100
   7827 00E690 8D 00 70                     	sta		$7000
   7828 00E693 60                           	rts
                                           
                                           ;------------------------------------------------------------------------------
                                           ; On entry to the SSM task the .A register will be set to the task number
                                           ; being single stepped. The .X register will contain the address of the
                                           ; next instruction to execute.
                                           ;------------------------------------------------------------------------------
                                           
   7836 00E694                             SSMInit:
                                           	; setup SSM data segment in SDT
   7838 00E694 A0 06 00                     	LDY		#6
   7839 00E697 A9 01 00                     	LDA		#1
   7840 00E69A 42 EB                        	XBAW
   7841 00E69C A9 00 00                     	LDA		#$0000
   7842 00E69F A2 82 08                     	LDX		#$882		; 1k data
   7843 00E6A2 42 BA                        	SDU
                                           	; Setup SSM stack segment in SDT
   7845 00E6A4 C8                           	INY
   7846 00E6A5 A9 00 04                     	LDA		#$0400
   7847 00E6A8 A2 82 08                     	LDX		#$882		; 1k stack
   7848 00E6AB 42 BA                        	SDU
                                           	; Setup SSM code segment in SDT
   7850 00E6AD C8                           	INY
   7851 00E6AE A9 00 00                     	LDA		#$0000
   7852 00E6B1 42 EB                        	XBAW
   7853 00E6B3 A9 00 00                     	LDA		#$0000
   7854 00E6B6 A2 05 09                     	LDX		#$905
   7855 00E6B9 42 BA                        	SDU
   7856 00E6BB 42 5C C2 E6 00 08 00         	JMF		8:.0001
   7857 00E6C2                             .0001:
                                           	; Initialize data selector and stack selector, pointer
                                           	; The stack is begin switched from the one currently defined by
                                           	; by the task table. So the return task needs to be popped off
                                           	; the current stack and placed on the new one.
   7862 00E6C2 FA                           	PLX					; get the task to return to
   7863 00E6C3 A9 07 00                     	LDA		#7
   7864 00E6C6 78                           	SEI
   7865 00E6C7 42 5A                        	TASS
   7866 00E6C9 A9 FF 03                     	LDA		#$3FF		; setup stack pointer
   7867 00E6CC 1B                           	TAS
   7868 00E6CD 58                           	CLI
   7869 00E6CE DA                           	PHX					; save return task on new stack
   7870 00E6CF F4 06 00                     	PEA		6
   7871 00E6D2 42 2B                        	PLDS
                                           
   7873 00E6D4 A9 00 61                     	LDA		#$6100
   7874 00E6D7 85 36                        	STA		NormAttr
   7875 00E6D9 A9 FF 0F                     	LDA		#4095		; set segment
   7876 00E6DC 85 44                        	STA		Vidptr+4
   7877 00E6DE 85 4A                        	STA		Vidregs+4
   7878 00E6E0 A9 0B 00                     	LDA		#$000B		; screen location is $FB0000
   7879 00E6E3 85 42                        	STA		Vidptr+2
   7880 00E6E5 64 40                        	STZ		Vidptr
   7881 00E6E7 A9 0E 00                     	LDA		#$000E		; regset is at $FEA010
   7882 00E6EA 85 48                        	STA		Vidregs+2
   7883 00E6EC A9 10 A0                     	LDA		#$A010
   7884 00E6EF 85 46                        	STA		Vidregs
   7885 00E6F1 A0 07 00                     	LDY		#7
   7886 00E6F4 A9 10 00                     	LDA		#$10		; divide by 2 vertically, 1 horizontally
   7887 00E6F7 20 37 EA                     	JSR		SetVideoReg
   7888 00E6FA A9 B4 00                     	LDA		#180		; set window left position 672
   7889 00E6FD A0 02 00                     	LDY		#2
   7890 00E700 20 37 EA                     	JSR		SetVideoReg
   7891 00E703 A9 02 00                     	LDA		#2
   7892 00E706 A0 03 00                     	LDY		#3
   7893 00E709 20 37 EA                     	JSR		SetVideoReg
   7894 00E70C A9 20 00                     	LDA		#32			; set window top position
   7895 00E70F A0 04 00                     	LDY		#4
   7896 00E712 20 37 EA                     	JSR		SetVideoReg
   7897 00E715 20 1C EA                     	JSR		GetTextRowsCols
   7898 00E718 A9 EC E7                     	LDA		#DisplayChar
   7899 00E71B 8D F0 03                     	STA		OutputVec
   7900 00E71E 20 61 EA                     	JSR		ClearScreen
   7901 00E721 20 B1 E9                     	JSR		HomeCursor
   7902 00E724 F4 08 00                     	PEA		8
   7903 00E727 F4 A2 E7                     	PEA		msgSSM
   7904 00E72A 20 ED E9                     	JSR		DisplayString
   7905 00E72D 42 60                        	RTT
   7906 00E72F                             SSMTask:
   7907 00E72F 85 BE                        	STA		WorkTR
   7908 00E731 20 7C E3                     	JSR		DispRegs
   7909 00E734                             .0004:
   7910 00E734 A9 53 00                     	LDA		#'S'
   7911 00E737 20 DE E9                     	JSR		OutChar
   7912 00E73A A9 53 00                     	LDA		#'S'
   7913 00E73D 20 DE E9                     	JSR		OutChar
   7914 00E740 A9 4D 00                     	LDA		#'M'
   7915 00E743 20 DE E9                     	JSR		OutChar
   7916 00E746 A9 3E 00                     	LDA		#'>'
   7917 00E749                             .0005:
   7918 00E749 20 DE E9                     	JSR		OutChar
   7919 00E74C                             .0008:
   7920 00E74C 20 43 ED                     	JSR		KeybdGetCharWait
   7921 00E74F B0 FB                        	BCS		.0008
   7922 00E751 29 FF 00                     	AND		#$FF
   7923 00E754 C9 53 00                     	CMP		#'S'		; step
   7924 00E757 D0 04                        	BNE		.0001
   7925 00E759                             .0002:
   7926 00E759 42 60                        	RTT
   7927 00E75B 80 D2                        	BRA		SSMTask
   7928 00E75D                             .0001:
   7929 00E75D C9 58 00                     	CMP		#'X'
   7930 00E760 D0 16                        	BNE		.0006
   7931 00E762 A5 A0                        	LDA		reg_sr
   7932 00E764 29 FF EF                     	AND		#$EFFF
   7933 00E767 85 A0                        	STA		reg_sr
   7934 00E769 20 1F E4                     	JSR		BuildRec
   7935 00E76C A6 BE                        	LDX		WorkTR
   7936 00E76E 42 6C 00 01 00 00            	LDT		ldtrec
   7937 00E774 42 60                        	RTT
   7938 00E776 80 B7                        	BRA		SSMTask
   7939 00E778                             .0006:
   7940 00E778 C9 0D 00                     	CMP		#CR
   7941 00E77B D0 CC                        	BNE		.0005
   7942 00E77D A5 32                        	LDA		CursorY
   7943 00E77F 0A                           	ASL
   7944 00E780 AA                           	TAX
   7945 00E781 42 1B BD 98 F2               	LDA		CS:LineTbl,X
   7946 00E786 18                           	CLC
   7947 00E787 69 04 00                     	ADC		#4
   7948 00E78A 0A                           	ASL
   7949 00E78B AA                           	TAX
   7950 00E78C 20 08 E6                     	JSR		IgnoreBlanks
   7951 00E78F 20 F9 E1                     	JSR		MonGetch
   7952 00E792 C9 4D 00                     	CMP		#'M'
   7953 00E795 D0 03                        	BNE		.0007
   7954 00E797 20 84 E4                     	JSR		doMemoryDump
   7955 00E79A                             .0007:
   7956 00E79A 82 AC FF                     	BRL		.0005
   7957 00E79D 42 60                        	RTT
   7958 00E79F 82 8D FF                     	BRL		SSMTask
                                           
   7960 00E7A2                             msgSSM:
   7961 00E7A2 53 69 6E 67 6C 65 20 73      	.byte	"Single step mode task starting.",CR,LF,0
   7961 00E7AA 74 65 70 20 6D 6F 64 65    
   7961 00E7B2 20 74 61 73 6B 20 73 74    
   7961 00E7BA 61 72 74 69 6E 67 2E 0D    
   7961 00E7C2 0A 00                      
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert Ascii character to screen character.
                                           ;------------------------------------------------------------------------------
                                           
   7967 00E7C4                             AsciiToScreen:
   7968 00E7C4 29 FF 00                     	AND		#$FF
   7969 00E7C7 89 20 00                     	BIT		#%00100000	; if bit 5 isn't set
   7970 00E7CA F0 08                        	BEQ		.00001
   7971 00E7CC 89 40 00                     	BIT		#%01000000	; or bit 6 isn't set
   7972 00E7CF F0 03                        	BEQ		.00001
   7973 00E7D1 29 9F 00                     	AND		#%10011111
   7974 00E7D4                             .00001:
   7975 00E7D4 60                           	rts
                                           
                                           	MEM		8
   7978 00E7D5                             AsciiToScreen8:
   7979 00E7D5 89 20                        	BIT		#%00100000	; if bit 5 isn't set
   7980 00E7D7 F0 06                        	BEQ		.00001
   7981 00E7D9 89 40                        	BIT		#%01000000	; or bit 6 isn't set
   7982 00E7DB F0 02                        	BEQ		.00001
   7983 00E7DD 29 9F                        	AND		#%10011111
   7984 00E7DF                             .00001:
   7985 00E7DF 60                           	rts
                                           
                                           	MEM		16
                                           ;------------------------------------------------------------------------------
                                           ; Convert screen character to ascii character
                                           ;------------------------------------------------------------------------------
                                           ;
   7992 00E7E0                             ScreenToAscii:
   7993 00E7E0 29 FF 00                     	AND		#$FF
   7994 00E7E3 C9 1B 00                     	CMP		#26+1
   7995 00E7E6 B0 03                        	BCS		.0001
   7996 00E7E8 69 60 00                     	ADC		#$60
   7997 00E7EB                             .0001:
   7998 00E7EB 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Display a character on the screen device
                                           ; Expects the processor to be in 16 bit mode with 16 bit acc and 16 bit indexes
                                           ;------------------------------------------------------------------------------
                                           ;
   8005 00E7EC                             DisplayChar:
   8006 00E7EC 29 FF 00                     	AND		#$0FF
   8007 00E7EF 24 3C                        	BIT		EscState		; check if processing escape sequence
   8008 00E7F1 30 FF 89 00                  	LBMI	processEsc
   8009 00E7F5 C9 08 00                     	CMP		#BS
   8010 00E7F8 F0 FF 33 01                  	LBEQ	doBackSpace
   8011 00E7FC C9 91 00                     	CMP		#$91			; cursor right
   8012 00E7FF F0 FF 89 01                  	LBEQ	doCursorRight
   8013 00E803 C9 93 00                     	CMP		#$93			; cursor left
   8014 00E806 F0 FF 8D 01                  	LBEQ	doCursorLeft
   8015 00E80A C9 90 00                     	CMP		#$90			; cursor up
   8016 00E80D F0 FF 8D 01                  	LBEQ	doCursorUp
   8017 00E811 C9 92 00                     	CMP		#$92			; cursor down
   8018 00E814 F0 FF 8D 01                  	LBEQ	doCursorDown
   8019 00E818 C9 99 00                     	CMP		#$99			; delete
   8020 00E81B F0 FF 3B 01                  	LBEQ	doDelete
   8021 00E81F C9 0D 00                     	CMP		#CR
   8022 00E822 F0 47                        	BEQ		doCR
   8023 00E824 C9 0A 00                     	CMP		#LF
   8024 00E827 F0 47                        	BEQ		doLF
   8025 00E829 C9 94 00                     	CMP		#$94
   8026 00E82C F0 FF 54 01                  	LBEQ	doCursorHome	; cursor home
   8027 00E830 C9 1B 00                     	CMP		#ESC
   8028 00E833 D0 05                        	BNE		.0003
   8029 00E835 64 3C                        	STZ		EscState		; put a -1 in the escape state
   8030 00E837 C6 3C                        	DEC		EscState
   8031 00E839 60                           	RTS
   8032 00E83A                             .0003:
   8033 00E83A 20 C4 E7                     	JSR		AsciiToScreen
   8034 00E83D 05 36                        	ORA		NormAttr
   8035 00E83F 48                           	PHA
   8036 00E840 A5 34                        	LDA		VideoPos
   8037 00E842 0A                           	ASL
   8038 00E843 A8                           	TAY
   8039 00E844 68                           	PLA
   8040 00E845 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8041 00E84A A5 30                        	LDA		CursorX
   8042 00E84C 1A                           	INA
   8043 00E84D C5 4C                        	CMP		Textcols
   8044 00E84F D0 15                        	BNE		.0001
   8045 00E851 64 30                        	STZ		CursorX
   8046 00E853 A5 32                        	LDA		CursorY
   8047 00E855 1A                           	INA
   8048 00E856 C5 4E                        	CMP		Textrows
   8049 00E858 F0 05                        	BEQ		.0002
   8050 00E85A 85 32                        	STA		CursorY
   8051 00E85C 82 59 01                     	BRL		SyncVideoPos
   8052 00E85F                             .0002:
   8053 00E85F 3A                           	DEA
   8054 00E860 20 B8 E9                     	JSR		SyncVideoPos
   8055 00E863 82 14 02                     	BRL		ScrollUp
   8056 00E866                             .0001:
   8057 00E866 85 30                        	STA		CursorX
   8058 00E868 82 4D 01                     	BRL		SyncVideoPos
   8059 00E86B                             doCR:
   8060 00E86B 64 30                        	STZ		CursorX
   8061 00E86D 82 48 01                     	BRL		SyncVideoPos
   8062 00E870                             doLF:
   8063 00E870 A5 32                        	LDA		CursorY
   8064 00E872 1A                           	INA
   8065 00E873 C5 4E                        	CMP		Textrows
   8066 00E875 10 FF 01 02                  	LBPL	ScrollUp
   8067 00E879 85 32                        	STA		CursorY
   8068 00E87B 82 3A 01                     	BRL		SyncVideoPos
                                           
                                           ; Process escape sequences for WYSE terminal emulation
                                           ; Handles:
                                           ; {esc}T		- clear to end of line
                                           ; {esc}W		- delete character
                                           ; {esc}`1		- cursor on
                                           ; {esc}`0		- cursor off
                                           ; {esc}({esc}G4	- reverse video
                                           ; {esc}({esc}G0	- normal video
                                           ;
                                           ; EscState
                                           ; -1 = first esc char
                                           ; -2 = second esc char
                                           ; ...
                                           ;
   8084 00E87E                             processEsc:
   8085 00E87E A6 3C                        	LDX		EscState
   8086 00E880 E0 FF FF                     	CPX		#-1
   8087 00E883 D0 45                        	BNE		.0006
   8088 00E885 C9 54 00                     	CMP		#'T'	; clear to EOL
   8089 00E888 D0 1D                        	BNE		.0003
   8090 00E88A A5 34                        	LDA		VideoPos
   8091 00E88C 0A                           	ASL
   8092 00E88D A8                           	TAY
   8093 00E88E A6 30                        	LDX		CursorX
   8094 00E890 E8                           	INX
   8095 00E891                             .0001:
   8096 00E891 E4 4C                        	CPX		Textcols
   8097 00E893 10 0F                        	BPL		.0002
   8098 00E895 A9 20 00                     	LDA		#' '
   8099 00E898 05 36                        	ORA		NormAttr
   8100 00E89A 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8101 00E89F E8                           	INX
   8102 00E8A0 C8                           	INY
   8103 00E8A1 C8                           	INY
   8104 00E8A2 D0 ED                        	BNE		.0001
   8105 00E8A4                             .0002:
   8106 00E8A4 64 3C                        	STZ		EscState
   8107 00E8A6 60                           	RTS
   8108 00E8A7                             .0003:
   8109 00E8A7 C9 57 00                     	CMP		#'W'
   8110 00E8AA D0 05                        	BNE		.0004
   8111 00E8AC 64 3C                        	STZ		EscState
   8112 00E8AE 82 A9 00                     	BRL		doDelete
   8113 00E8B1                             .0004:
   8114 00E8B1 C9 60 00                     	CMP		#'`'
   8115 00E8B4 D0 06                        	BNE		.0005
   8116 00E8B6 A9 FE FF                     	LDA		#-2
   8117 00E8B9 85 3C                        	STA		EscState
   8118 00E8BB 60                           	RTS
   8119 00E8BC                             .0005:
   8120 00E8BC C9 28 00                     	CMP		#'('
   8121 00E8BF D0 06                        	BNE		.0008
   8122 00E8C1 A9 FD FF                     	LDA		#-3
   8123 00E8C4 85 3C                        	STA		EscState
   8124 00E8C6 60                           	RTS
   8125 00E8C7                             .0008:
   8126 00E8C7 64 3C                        	STZ		EscState
   8127 00E8C9 60                           	RTS
   8128 00E8CA                             .0006:
   8129 00E8CA E0 FE FF                     	CPX		#-2
   8130 00E8CD D0 11                        	BNE		.0007
   8131 00E8CF 64 3C                        	STZ		EscState
   8132 00E8D1 C9 31 00                     	CMP		#'1'
   8133 00E8D4 F0 FF 69 01                  	LBEQ	CursorOn
   8134 00E8D8 C9 30 00                     	CMP		#'0'
   8135 00E8DB F0 FF 72 01                  	LBEQ	CursorOff
   8136 00E8DF 60                           	RTS
   8137 00E8E0                             .0007:
   8138 00E8E0 E0 FD FF                     	CPX		#-3
   8139 00E8E3 D0 0B                        	BNE		.0009
   8140 00E8E5 C9 1B 00                     	CMP		#ESC
   8141 00E8E8 D0 DD                        	BNE		.0008
   8142 00E8EA A9 FC FF                     	LDA		#-4
   8143 00E8ED 85 3C                        	STA		EscState
   8144 00E8EF 60                           	RTS
   8145 00E8F0                             .0009:
   8146 00E8F0 E0 FC FF                     	CPX		#-4
   8147 00E8F3 D0 0B                        	BNE		.0010
   8148 00E8F5 C9 47 00                     	CMP		#'G'
   8149 00E8F8 D0 CD                        	BNE		.0008
   8150 00E8FA A9 FB FF                     	LDA		#-5
   8151 00E8FD 85 3C                        	STA		EscState
   8152 00E8FF 60                           	RTS
   8153 00E900                             .0010:
   8154 00E900 E0 FB FF                     	CPX		#-5
   8155 00E903 D0 C2                        	BNE		.0008
   8156 00E905 64 3C                        	STZ		EscState
   8157 00E907 C9 34 00                     	CMP		#'4'
   8158 00E90A D0 12                        	BNE		.0011
   8159 00E90C A5 36                        	LDA		NormAttr
                                           	; Swap the high nybbles of the attribute
   8161 00E90E EB                           	XBA				
   8162 00E90F E2 30                        	SEP		#$30		; set 8 bit regs
                                           	NDX		8			; tell the assembler
                                           	MEM		8
   8165 00E911 2A                           	ROL
   8166 00E912 2A                           	ROL
   8167 00E913 2A                           	ROL
   8168 00E914 2A                           	ROL
   8169 00E915 C2 30                        	REP		#$30		; set 16 bit regs
                                           	NDX		16			; tell the assembler
                                           	MEM		16
   8172 00E917 EB                           	XBA
   8173 00E918 29 00 FF                     	AND		#$FF00
   8174 00E91B 85 36                        	STA		NormAttr
   8175 00E91D 60                           	RTS
   8176 00E91E                             .0011:
   8177 00E91E C9 30 00                     	CMP		#'0'
   8178 00E921 D0 06                        	BNE		.0012
   8179 00E923 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8180 00E926 85 36                        	STA		NormAttr
   8181 00E928 60                           	RTS
   8182 00E929                             .0012:
   8183 00E929 A9 00 BF                     	LDA		#$BF00		; Light Grey on Dark Grey
   8184 00E92C 85 36                        	STA		NormAttr
   8185 00E92E 60                           	RTS
                                           
   8187 00E92F                             doBackSpace:
   8188 00E92F A6 30                        	LDX		CursorX
   8189 00E931 F0 26                        	BEQ		.0001		; Can't backspace anymore
   8190 00E933 A5 34                        	LDA		VideoPos
   8191 00E935 0A                           	ASL
   8192 00E936 A8                           	TAY
   8193 00E937                             .0002:
   8194 00E937 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8195 00E93C 88                           	DEY
   8196 00E93D 88                           	DEY
   8197 00E93E 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8198 00E943 42 C8                        	INY4
   8199 00E945 E8                           	INX
   8200 00E946 E4 4C                        	CPX		Textcols
   8201 00E948 D0 ED                        	BNE		.0002
   8202 00E94A                             .0003:
   8203 00E94A A9 20 00                     	LDA		#' '
   8204 00E94D 05 36                        	ORA		NormAttr
   8205 00E94F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8206 00E954 C6 30                        	DEC		CursorX
   8207 00E956 82 5F 00                     	BRL		SyncVideoPos
   8208 00E959                             .0001:
   8209 00E959 60                           	RTS
                                           
                                           ; Deleting a character does not change the video position so there's no need
                                           ; to resynchronize it.
                                           
   8214 00E95A                             doDelete:
   8215 00E95A A6 30                        	LDX		CursorX
   8216 00E95C A5 34                        	LDA		VideoPos
   8217 00E95E 0A                           	ASL
   8218 00E95F A8                           	TAY
   8219 00E960                             .0002:
   8220 00E960 E8                           	INX
   8221 00E961 E4 4C                        	CPX		Textcols
   8222 00E963 10 14                        	BPL		.0001
   8223 00E965 CA                           	DEX
   8224 00E966 C8                           	INY
   8225 00E967 C8                           	INY
   8226 00E968 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y
   8227 00E96D 88                           	DEY
   8228 00E96E 88                           	DEY
   8229 00E96F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8230 00E974 C8                           	INY
   8231 00E975 C8                           	INY
   8232 00E976 E8                           	INX
   8233 00E977 80 E7                        	BRA		.0002
   8234 00E979                             .0001:
   8235 00E979 A9 20 00                     	LDA		#' '
   8236 00E97C 05 36                        	ORA		NormAttr
   8237 00E97E 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8238 00E983 60                           	RTS
                                           
   8240 00E984                             doCursorHome:
   8241 00E984 A5 30                        	LDA		CursorX
   8242 00E986 F0 24                        	BEQ		doCursor1
   8243 00E988 64 30                        	STZ		CursorX
   8244 00E98A 80 2C                        	BRA		SyncVideoPos
   8245 00E98C                             doCursorRight:
   8246 00E98C A5 30                        	LDA		CursorX
   8247 00E98E 1A                           	INA
   8248 00E98F C5 4C                        	CMP		Textcols
   8249 00E991 10 1D                        	BPL		doRTS
   8250 00E993                             doCursor2:
   8251 00E993 85 30                        	STA		CursorX
   8252 00E995 80 21                        	BRA		SyncVideoPos
   8253 00E997                             doCursorLeft:
   8254 00E997 A5 30                        	LDA		CursorX
   8255 00E999 F0 15                        	BEQ		doRTS
   8256 00E99B 3A                           	DEA
   8257 00E99C 80 F5                        	BRA		doCursor2
   8258 00E99E                             doCursorUp:
   8259 00E99E A5 32                        	LDA		CursorY
   8260 00E9A0 F0 0E                        	BEQ		doRTS
   8261 00E9A2 3A                           	DEA
   8262 00E9A3 80 07                        	BRA		doCursor1
   8263 00E9A5                             doCursorDown:
   8264 00E9A5 A5 32                        	LDA		CursorY
   8265 00E9A7 1A                           	INA
   8266 00E9A8 C5 4E                        	CMP		Textrows
   8267 00E9AA 10 04                        	BPL		doRTS
   8268 00E9AC                             doCursor1:
   8269 00E9AC 85 32                        	STA		CursorY
   8270 00E9AE 80 08                        	BRA		SyncVideoPos
   8271 00E9B0                             doRTS:
   8272 00E9B0 60                           	RTS
                                           
   8274 00E9B1                             HomeCursor:
   8275 00E9B1 A9 00 00                     	LDA		#0
   8276 00E9B4 64 30                        	STZ		CursorX
   8277 00E9B6 64 32                        	STZ		CursorY
                                           
                                           ; Synchronize the absolute video position with the cursor co-ordinates.
                                           ;
   8281 00E9B8                             SyncVideoPos:
   8282 00E9B8 48                           	PHA
   8283 00E9B9 5A                           	PHY
   8284 00E9BA A5 32                        	LDA		CursorY
   8285 00E9BC 0A                           	ASL
   8286 00E9BD AA                           	TAX
   8287 00E9BE 42 3B 05 00 BD 98 F2         	LDA		5:LineTbl,X
   8288 00E9C5 18                           	CLC
   8289 00E9C6 65 30                        	ADC		CursorX
   8290 00E9C8 85 34                        	STA		VideoPos
   8291 00E9CA A0 0D 00                     	LDY		#13
   8292 00E9CD 42 DA 42 97 46               	STA		FAR {Vidregs},Y		; Update the position in the text controller
   8293 00E9D2 7A                           	PLY
   8294 00E9D3 68                           	PLA
   8295 00E9D4 60                           	RTS
                                           
   8297 00E9D5                             OutCRLF:
   8298 00E9D5 A9 0D 00                     	LDA		#CR
   8299 00E9D8 20 DE E9                     	JSR		OutChar
   8300 00E9DB A9 0A 00                     	LDA		#LF
                                           
   8302 00E9DE                             OutChar:
   8303 00E9DE DA                           	PHX
   8304 00E9DF 5A                           	PHY
   8305 00E9E0 08                           	PHP
   8306 00E9E1 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8309 00E9E3 A2 00 00                     	LDX		#0
   8310 00E9E6 FC F0 03                     	JSR		(OutputVec,x)
   8311 00E9E9 28                           	PLP
   8312 00E9EA 7A                           	PLY
   8313 00E9EB FA                           	PLX
   8314 00E9EC 60                           	RTS
                                           
   8316 00E9ED                             DisplayString:
                                           ;	PLA							; pop return address
                                           ;	PLX							; get string address parameter
                                           ;	PHA							; push return address
   8320 00E9ED 08                           	PHP							; push reg settings
   8321 00E9EE E2 20                        	SEP		#$20				; ACC = 8 bit
                                           	MEM		8
                                           ;	STX		StringPos
   8324 00E9F0 A0 00 00                     	LDY		#0
   8325 00E9F3                             .0002:
   8326 00E9F3 42 DA B3 04                  	LDA		FAR (4,S),Y
   8327 00E9F7 F0 06                        	BEQ		.0001
   8328 00E9F9 20 DE E9                     	JSR		OutChar
   8329 00E9FC C8                           	INY
   8330 00E9FD 80 F4                        	BRA		.0002
   8331 00E9FF                             .0001:
   8332 00E9FF 28                           	PLP							; restore regs settings
                                           ;	REP		#$20				; ACC 16 bits
                                           	MEM		16
   8335 00EA00 42 C0 04                     	RTS		#4					; pop stack argument
                                           
   8337 00EA03                             DisplayString2:
   8338 00EA03 68                           	PLA							; pop return address
   8339 00EA04 FA                           	PLX							; get string address parameter
   8340 00EA05 48                           	PHA							; push return address
   8341 00EA06 E2 20                        	SEP		#$20				; ACC = 8 bit
   8342 00EA08 86 38                        	STX		StringPos
   8343 00EA0A A0 00 00                     	LDY		#0
   8344 00EA0D A2 32 00                     	LDX		#50
   8345 00EA10                             .0002:
   8346 00EA10 B1 38                        	LDA		(StringPos),Y
   8347 00EA12 20 DE E9                     	JSR		OutChar
   8348 00EA15 C8                           	INY
   8349 00EA16 CA                           	DEX
   8350 00EA17 D0 F7                        	BNE		.0002
   8351 00EA19                             .0001:
   8352 00EA19 C2 20                        	REP		#$20				; ACC 16 bits
   8353 00EA1B 60                           	RTS
                                           
   8355 00EA1C                             GetTextRowsCols:
   8356 00EA1C 48                           	PHA
   8357 00EA1D 5A                           	PHY
   8358 00EA1E A0 00 00                     	LDY		#0
   8359 00EA21 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8360 00EA28 85 4C                        	STA		Textcols
   8361 00EA2A C8                           	INY
   8362 00EA2B 42 DA 42 9B 42 B7 46         	LDA.UB	FAR {Vidregs},Y
   8363 00EA32 85 4E                        	STA		Textrows
   8364 00EA34 7A                           	PLY
   8365 00EA35 68                           	PLA
   8366 00EA36 60                           	RTS
                                           
                                           ; .Y = register number to set
                                           ; Acc = value
                                           ;
   8371 00EA37                             SetVideoReg:
   8372 00EA37 08                           	PHP								; save regs size settings
   8373 00EA38 E2 20                        	SEP		#$20
   8374 00EA3A 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8375 00EA3F 28                           	PLP								; restore reg size settings
   8376 00EA40 60                           	RTS
                                           
   8378 00EA41                             CursorOn:
   8379 00EA41 48                           	PHA
   8380 00EA42 5A                           	PHY
   8381 00EA43 A0 09 00                     	LDY		#9
   8382 00EA46 A9 60 1F                     	LDA		#$1F60
   8383 00EA49 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8384 00EA4E 7A                           	PLY
   8385 00EA4F 68                           	PLA
   8386 00EA50 60                           	RTS
                                           
   8388 00EA51                             CursorOff:
   8389 00EA51 48                           	PHA
   8390 00EA52 5A                           	PHY
   8391 00EA53 A0 09 00                     	LDY		#9
   8392 00EA56 A9 20 00                     	LDA		#$0020
   8393 00EA59 42 DA 42 97 46               	STA		FAR {Vidregs},Y
   8394 00EA5E 7A                           	PLY
   8395 00EA5F 68                           	PLA
   8396 00EA60 60                           	RTS
                                           
   8398 00EA61                             ClearScreen:
   8399 00EA61 A2 FF 0F                     	LDX		#4095
   8400 00EA64 A0 00 00                     	LDY		#$00
   8401 00EA67 A9 20 00                     	LDA		#' '
   8402 00EA6A 20 C4 E7                     	JSR		AsciiToScreen
   8403 00EA6D 05 36                        	ORA		NormAttr
   8404 00EA6F                             .0001:
   8405 00EA6F 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8406 00EA74 C8                           	INY
   8407 00EA75 C8                           	INY
   8408 00EA76 CA                           	DEX
   8409 00EA77 D0 F6                        	BNE		.0001
   8410 00EA79 60                           	RTS
                                           
   8412 00EA7A                             ScrollUp:
   8413 00EA7A A0 00 00                     	LDY		#0				; .Y used as index to char
   8414 00EA7D A2 2B 0A                     	LDX 	#2603			; number of chars on screen
   8415 00EA80                             .0001:
   8416 00EA80 5A                           	PHY						; save off current .Y
   8417 00EA81 98                           	TYA								
   8418 00EA82 18                           	CLC						; Add double the number of text
   8419 00EA83 65 4C                        	ADC		Textcols		; columns to .Y to find start of next
   8420 00EA85 18                           	CLC						; row 
   8421 00EA86 65 4C                        	ADC		Textcols
   8422 00EA88 A8                           	TAY						
   8423 00EA89 42 DA 42 B7 40               	LDA		FAR {Vidptr},Y	; .A = Load buffer[textcols+Y]
   8424 00EA8E 7A                           	PLY						; .Y = restore current .Y
   8425 00EA8F 42 DA 42 97 40               	STA		FAR {Vidptr},Y	; Store .A in buffer[0+Y]
   8426 00EA94 C8                           	INY						; advance to next character
   8427 00EA95 C8                           	INY						; decrement total char count
   8428 00EA96 CA                           	DEX
   8429 00EA97 D0 E7                        	BNE		.0001
   8430 00EA99 A5 4E                        	LDA		Textrows
   8431 00EA9B 3A                           	DEA
                                           
   8433 00EA9C                             BlankLine:
   8434 00EA9C 0A                           	ASL
   8435 00EA9D A8                           	TAY
   8436 00EA9E 42 1B B9 98 F2               	LDA		CS:LineTbl,Y
   8437 00EAA3 0A                           	ASL
   8438 00EAA4 A8                           	TAY
   8439 00EAA5 A6 4C                        	LDX		Textcols		; number of chars to clear
   8440 00EAA7 A5 36                        	LDA		NormAttr
   8441 00EAA9 09 20 00                     	ORA		#$20			; space
   8442 00EAAC                             .0001:
   8443 00EAAC 42 DA 42 97 40               	STA		FAR {Vidptr},Y
   8444 00EAB1 C8                           	INY						; increment to next char
   8445 00EAB2 C8                           	INY
   8446 00EAB3 CA                           	DEX						; decrement number of chars
   8447 00EAB4 D0 F6                        	BNE		.0001
   8448 00EAB6 60                           	RTS
                                           
   8450 00EAB7                             DispDWord:
   8451 00EAB7 42 EB                        	XBAW
   8452 00EAB9 20 BE EA                     	JSR		DispWord
   8453 00EABC 42 EB                        	XBAW
   8454 00EABE                             DispWord:
   8455 00EABE EB                           	XBA
   8456 00EABF 20 C3 EA                     	JSR		DispByte
   8457 00EAC2 EB                           	XBA
   8458 00EAC3                             DispByte:
   8459 00EAC3 48                           	PHA
   8460 00EAC4 4A                           	LSR
   8461 00EAC5 4A                           	LSR
   8462 00EAC6 4A                           	LSR
   8463 00EAC7 4A                           	LSR
   8464 00EAC8 20 CC EA                     	JSR		DispNybble
   8465 00EACB 68                           	PLA
   8466 00EACC                             DispNybble:
   8467 00EACC 48                           	PHA
   8468 00EACD 29 0F 00                     	AND		#$0F
   8469 00EAD0 C9 0A 00                     	CMP		#10
   8470 00EAD3 90 08                        	BCC		.0001
   8471 00EAD5 69 36 00                     	ADC		#'A'-11			; -11 cause the carry is set
   8472 00EAD8 20 DE E9                     	JSR		OutChar
   8473 00EADB 68                           	PLA
   8474 00EADC 60                           	RTS
   8475 00EADD                             .0001:
   8476 00EADD 09 30 00                     	ORA		#'0'
   8477 00EAE0 20 DE E9                     	JSR		OutChar
   8478 00EAE3 68                           	PLA
   8479 00EAE4 60                           	RTS
                                           
   8481 00EAE5                             space:
   8482 00EAE5 48                           	PHA
   8483 00EAE6 A9 20 00                     	LDA		#' '
   8484 00EAE9 20 DE E9                     	JSR		OutChar
   8485 00EAEC 68                           	PLA
   8486 00EAED 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Get a range (two hex numbers)
                                           ;------------------------------------------------------------------------------
                                           
   8492 00EAEE                             GetRange:
   8493 00EAEE 20 08 E6                     	JSR		IgnoreBlanks
   8494 00EAF1 20 19 EB                     	JSR		GetHexNumber
   8495 00EAF4 C0 00 00                     	CPY		#0
   8496 00EAF7 F0 1F                        	BEQ		.0001
   8497 00EAF9 A5 0C                        	LDA		NumWorkArea
   8498 00EAFB 85 20                        	STA		RangeStart
   8499 00EAFD 85 24                        	STA		RangeEnd
   8500 00EAFF A5 0E                        	LDA		NumWorkArea+2
   8501 00EB01 85 22                        	STA		RangeStart+2
   8502 00EB03 85 26                        	STA		RangeEnd+2
   8503 00EB05 20 08 E6                     	JSR		IgnoreBlanks
   8504 00EB08 20 19 EB                     	JSR		GetHexNumber
   8505 00EB0B C0 00 00                     	CPY		#0
   8506 00EB0E F0 08                        	BEQ		.0001
   8507 00EB10 A5 0C                        	LDA		NumWorkArea
   8508 00EB12 85 24                        	STA		RangeEnd
   8509 00EB14 A5 0E                        	LDA		NumWorkArea+2
   8510 00EB16 85 26                        	STA		RangeEnd+2
   8511 00EB18                             .0001:
   8512 00EB18 60                           	RTS
                                           	
                                           ; Get a hexidecimal number. Maximum of six digits.
                                           ; .X = text pointer (updated)
                                           ;------------------------------------------------------------------------------
                                           ;
   8518 00EB19                             GetHexNumber:
   8519 00EB19 A0 00 00                     	LDY		#0					; maximum of eight digits
   8520 00EB1C 64 0C                        	STZ		NumWorkArea
   8521 00EB1E 64 0E                        	STZ		NumWorkArea+2
   8522 00EB20                             gthxn2:
   8523 00EB20 20 F9 E1                     	JSR		MonGetch
   8524 00EB23 20 46 EB                     	JSR		AsciiToHexNybble
   8525 00EB26 30 1B                        	BMI		gthxn1
   8526 00EB28 06 0C                        	ASL		NumWorkArea
   8527 00EB2A 26 0E                        	ROL		NumWorkArea+2
   8528 00EB2C 06 0C                        	ASL		NumWorkArea
   8529 00EB2E 26 0E                        	ROL		NumWorkArea+2
   8530 00EB30 06 0C                        	ASL		NumWorkArea
   8531 00EB32 26 0E                        	ROL		NumWorkArea+2
   8532 00EB34 06 0C                        	ASL		NumWorkArea
   8533 00EB36 26 0E                        	ROL		NumWorkArea+2
   8534 00EB38 05 0C                        	ORA		NumWorkArea
   8535 00EB3A 85 0C                        	STA		NumWorkArea
   8536 00EB3C C8                           	INY
   8537 00EB3D C0 08 00                     	CPY		#8
   8538 00EB40 D0 DE                        	BNE		gthxn2
   8539 00EB42 60                           	RTS
   8540 00EB43                             gthxn1:
   8541 00EB43 CA                           	DEX
   8542 00EB44 CA                           	DEX
   8543 00EB45 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ; Convert ASCII character in the range '0' to '9', 'a' to 'f' or 'A' to 'F'
                                           ; to a hex nybble.
                                           ;------------------------------------------------------------------------------
                                           ;
   8550 00EB46                             AsciiToHexNybble:
   8551 00EB46 C9 30 00                     	CMP		#'0'
   8552 00EB49 90 30                        	BCC		gthx3
   8553 00EB4B C9 3A 00                     	CMP		#'9'+1
   8554 00EB4E B0 05                        	BCS		gthx5
   8555 00EB50 38                           	SEC
   8556 00EB51 E9 30 00                     	SBC		#'0'
   8557 00EB54 60                           	RTS
   8558 00EB55                             gthx5:
   8559 00EB55 C9 41 00                     	CMP		#'A'
   8560 00EB58 90 21                        	BCC		gthx3
   8561 00EB5A C9 47 00                     	CMP		#'F'+1
   8562 00EB5D B0 09                        	BCS		gthx6
   8563 00EB5F 38                           	SEC
   8564 00EB60 E9 41 00                     	SBC		#'A'
   8565 00EB63 18                           	CLC
   8566 00EB64 69 0A 00                     	ADC		#10
   8567 00EB67 60                           	RTS
   8568 00EB68                             gthx6:
   8569 00EB68 C9 61 00                     	CMP		#'a'
   8570 00EB6B 90 0E                        	BCC		gthx3
   8571 00EB6D C9 7B 00                     	CMP		#'z'+1
   8572 00EB70 B0 09                        	BCS		gthx3
   8573 00EB72 38                           	SEC
   8574 00EB73 E9 61 00                     	SBC		#'a'
   8575 00EB76 18                           	CLC
   8576 00EB77 69 0A 00                     	ADC		#10
   8577 00EB7A 60                           	RTS
   8578 00EB7B                             gthx3:
   8579 00EB7B A9 FF FF                     	LDA		#-1		; not a hex number
   8580 00EB7E 60                           	RTS
                                           
   8582 00EB7F                             AsciiToDecNybble:
   8583 00EB7F C9 30 00                     	CMP		#'0'
   8584 00EB82 90 0A                        	BCC		gtdc3
   8585 00EB84 C9 3A 00                     	CMP		#'9'+1
   8586 00EB87 B0 05                        	BCS		gtdc3
   8587 00EB89 38                           	SEC
   8588 00EB8A E9 30 00                     	SBC		#'0'
   8589 00EB8D 60                           	RTS
   8590 00EB8E                             gtdc3:
   8591 00EB8E A9 FF FF                     	LDA		#-1
   8592 00EB91 60                           	RTS
                                           
   8594 00EB92                             getcharNoWait:
   8595 00EB92 A9 01 00                     	LDA		#1
   8596 00EB95 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8597 00EB99 42 A2 06 00                  	TSK		#6
   8598 00EB9D 42 5B A5 BA                  	LDA		ZS:keybd_char
   8599 00EBA1 10 02                        	BPL		.0001
   8600 00EBA3 38                           	SEC
   8601 00EBA4 60                           	RTS
   8602 00EBA5                             .0001:
   8603 00EBA5 18                           	CLC
   8604 00EBA6 60                           	RTS
                                           
   8606 00EBA7                             getcharWait:
   8607 00EBA7 A9 02 00                     	LDA		#2
   8608 00EBAA 42 5B 85 BC                  	STA		ZS:keybd_cmd
   8609 00EBAE 42 A2 06 00                  	TSK		#6
   8610 00EBB2 42 5B A5 BA                  	LDA		ZS:keybd_char
   8611 00EBB6 10 02                        	BPL		.0001
   8612 00EBB8 38                           	SEC
   8613 00EBB9 60                           	RTS
   8614 00EBBA                             .0001:
   8615 00EBBA 18                           	CLC
   8616 00EBBB 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; Keyboard processing routines follow.
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   8623 00EBBC                             ResetKbd:
   8624 00EBBC E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8627 00EBBE 64 08                        	STZ		KeyState1
   8628 00EBC0 64 09                        	STZ		KeyState2
   8629 00EBC2 A9 FF                        	LDA		#$FF
   8630 00EBC4 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8631 00EBCC 20 DF EC                     	JSR		KeybdWaitTx
   8632 00EBCF C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8635 00EBD1 60                           	RTS
   8636 00EBD2                             KeybdInit:
   8637 00EBD2 A9 00 20                     	LDA		#$2000
   8638 00EBD5 1B                           	TAS
   8639 00EBD6 A9 05 00                     	LDA		#5
   8640 00EBD9 85 BC                        	STA		keybd_cmd
   8641 00EBDB E2 30                        	SEP		#$30
                                           	MEM		8
                                           	NDX		8
   8644 00EBDD 64 08                        	STZ		KeyState1
   8645 00EBDF 64 09                        	STZ		KeyState2
   8646 00EBE1 A0 0C                        	LDY		#12
   8647 00EBE3 42 60                        	RTT
   8648 00EBE5                             .resetAgain:
   8649 00EBE5 A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8650 00EBE7 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8651 00EBEF 20 DF EC                     	JSR		KeybdWaitTx
   8652 00EBF2                             .0001:
   8653 00EBF2 20 BA EC                     	JSR		KeybdRecvByte	; Look for $AA
   8654 00EBF5 90 5A                        	BCC		.tryAgain
   8655 00EBF7 C9 AA                        	CMP		#$AA			;
   8656 00EBF9 F0 37                        	BEQ		.config
   8657 00EBFB                             .0002:
                                           	; wait until keyboard not busy
   8659 00EBFB 20 FD EC                     	JSR		Wait10ms
   8660 00EBFE 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		;
                                         
   8661 00EC06 89 40                        	BIT		#$40
   8662 00EC08 D0 47                        	BNE		.tryAgain
   8663 00EC0A A9 FF                        	LDA		#$FF			; send reset code to keyboard
   8664 00EC0C 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8665 00EC14 20 FD EC                     	JSR		Wait10ms
   8666 00EC17 20 DF EC                     	JSR		KeybdWaitTx		; wait until no longer busy
   8667 00EC1A 20 BA EC                     	JSR		KeybdRecvByte	; look for an ACK ($FA)
   8668 00EC1D 90 32                        	BCC		.tryAgain
   8669 00EC1F C9 FE                        	CMP		#$FE
   8670 00EC21 F0 2E                        	BEQ		.tryAgain
   8671 00EC23 C9 FA                        	CMP		#$FA
   8672 00EC25 D0 2A                        	BNE		.tryAgain
   8673 00EC27 20 BA EC                     	JSR		KeybdRecvByte
   8674 00EC2A C9 FC                        	CMP		#$FC			; reset error ?
   8675 00EC2C F0 23                        	BEQ		.tryAgain
   8676 00EC2E C9 AA                        	CMP		#$AA			; reset complete okay ?
   8677 00EC30 D0 1F                        	BNE		.tryAgain
   8678 00EC32                             .config:
   8679 00EC32 20 DF EC                     	JSR		KeybdWaitBusy
   8680 00EC35 A9 F0                        	LDA		#$F0			; send scan code select
   8681 00EC37 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8682 00EC3F 20 DF EC                     	JSR		KeybdWaitTx
   8683 00EC42 90 0D                        	BCC		.tryAgain
   8684 00EC44 20 BA EC                     	JSR		KeybdRecvByte	; wait for response from keyboard
   8685 00EC47 90 08                        	BCC		.tryAgain
   8686 00EC49 C9 FE                        	CMP		#$FE
   8687 00EC4B F0 04                        	BEQ		.tryAgain
   8688 00EC4D C9 FA                        	CMP		#$FA
   8689 00EC4F F0 16                        	BEQ		.0004
   8690 00EC51                             .tryAgain:
   8691 00EC51 88                           	DEY
   8692 00EC52 D0 9E                        	BNE		.0001
   8693 00EC54 C6 BC                        	DEC		keybd_cmd
   8694 00EC56 D0 8D                        	BNE		.resetAgain
   8695 00EC58                             .keybdErr:
   8696 00EC58 C2 30                        	REP		#$30
   8697 00EC5A F4 01 00                     	PEA		1
   8698 00EC5D F4 15 ED                     	PEA		msgKeybdNR
   8699 00EC60 20 ED E9                     	JSR		DisplayString
   8700 00EC63 42 60                        	RTT
   8701 00EC65 80 1A                        	BRA		KeybdService
   8702 00EC67                             .0004:
   8703 00EC67 A9 02                        	LDA		#2				; select scan code set #2
   8704 00EC69 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   8705 00EC71 20 DF EC                     	JSR		KeybdWaitTx
   8706 00EC74 90 DB                        	BCC		.tryAgain
   8707 00EC76 20 BA EC                     	JSR		KeybdRecvByte
   8708 00EC79 90 D6                        	BCC		.tryAgain
   8709 00EC7B C2 30                        	REP		#$30
   8710 00EC7D 42 60                        	RTT
   8711 00EC7F 80 00                        	BRA		KeybdService
                                           
   8713 00EC81                             KeybdService:
   8714 00EC81 C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   8717 00EC83 A9 00 20                     	LDA		#$2000
   8718 00EC86 1B                           	TAS
   8719 00EC87 A5 BC                        	LDA		keybd_cmd
   8720 00EC89 C9 01 00                     	CMP		#1
   8721 00EC8C D0 18                        	BNE		.0001
   8722 00EC8E 20 38 ED                     	JSR		KeybdGetCharNoWait
   8723 00EC91 B0 08                        	BCS		.nokey
   8724 00EC93 64 BC                        	STZ		keybd_cmd
   8725 00EC95 85 BA                        	STA		keybd_char
   8726 00EC97 42 60                        	RTT
   8727 00EC99 80 E6                        	BRA		KeybdService
   8728 00EC9B                             .nokey
   8729 00EC9B A9 FF FF                     	LDA		#-1
   8730 00EC9E 64 BC                        	STZ		keybd_cmd
   8731 00ECA0 85 BA                        	STA		keybd_char
   8732 00ECA2 42 60                        	RTT
   8733 00ECA4 80 DB                        	BRA		KeybdService
   8734 00ECA6                             .0001:
   8735 00ECA6 C9 02 00                     	CMP		#2
   8736 00ECA9 D0 0B                        	BNE		.0002
   8737 00ECAB 20 43 ED                     	JSR		KeybdGetCharWait
   8738 00ECAE 64 BC                        	STZ		keybd_cmd
   8739 00ECB0 85 BA                        	STA		keybd_char
   8740 00ECB2 42 60                        	RTT
   8741 00ECB4 80 CB                        	BRA		KeybdService
   8742 00ECB6                             .0002:
   8743 00ECB6 42 60                        	RTT
   8744 00ECB8 80 C7                        	BRA		KeybdService
                                           
                                           	MEM		8
                                           	NDX		8
                                           
                                           ; Receive a byte from the keyboard, used after a command is sent to the
                                           ; keyboard in order to wait for a response.
                                           ;
   8752 00ECBA                             KeybdRecvByte:
   8753 00ECBA 5A                           	PHY
   8754 00ECBB A0 14                        	LDY		#20				; wait up to .2s
   8755 00ECBD                             .0003:
   8756 00ECBD 20 DF EC                     	JSR		KeybdWaitBusy
   8757 00ECC0 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1	; wait for response from keyboard
                                         
   8758 00ECC8 0A                           	ASL						; is input buffer full ?
   8759 00ECC9 B0 09                        	BCS		.0004			; yes, branch
   8760 00ECCB 20 FD EC                     	JSR		Wait10ms		; wait a bit
   8761 00ECCE 88                           	DEY
   8762 00ECCF D0 EC                        	BNE		.0003			; go back and try again
   8763 00ECD1 7A                           	PLY						; timeout
   8764 00ECD2 18                           	CLC						; carry clear = no code
   8765 00ECD3 60                           	RTS
   8766 00ECD4                             .0004:
   8767 00ECD4 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD		; clear recieve state
                                         
   8768 00ECDC 7A                           	PLY
   8769 00ECDD 38                           	SEC						; carry set = code available
   8770 00ECDE 60                           	RTS
                                           
                                           ; Wait until the keyboard isn't busy anymore
                                           ; Wait until the keyboard transmit is complete
                                           ; Returns .CF = 1 if successful, .CF=0 timeout
                                           ;
   8776 00ECDF                             KeybdWaitBusy:				; alias for KeybdWaitTx
   8777 00ECDF                             KeybdWaitTx:
   8778 00ECDF 48                           	PHA
   8779 00ECE0 5A                           	PHY
   8780 00ECE1 A0 0A                        	LDY		#10				; wait a max of .1s
   8781 00ECE3                             .0001:
   8782 00ECE3 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1
                                         
   8783 00ECEB 89 40                        	BIT		#$40			; check for transmit busy bit
   8784 00ECED F0 0A                        	BEQ		.0002			; branch if bit clear
   8785 00ECEF 20 FD EC                     	JSR		Wait10ms		; delay a little bit
   8786 00ECF2 88                           	DEY						; go back and try again
   8787 00ECF3 D0 EE                        	BNE		.0001
   8788 00ECF5 7A                           	PLY						; timed out
   8789 00ECF6 68                           	PLA
   8790 00ECF7 18                           	CLC						; return carry clear
   8791 00ECF8 60                           	RTS
   8792 00ECF9                             .0002:
   8793 00ECF9 7A                           	PLY						; wait complete, return 
   8794 00ECFA 68                           	PLA
   8795 00ECFB 38                           	SEC						; carry set
   8796 00ECFC 60                           	RTS
                                           
                                           ; Wait approximately 10ms. Used by keyboard routines. Makes use of the free
                                           ; running counter #0.
                                           ; .A = trashed (=-5)
                                           ;
   8802 00ECFD                             Wait10ms:
   8803 00ECFD 48                           	PHA
   8804 00ECFE DA                           	PHX				; save .X
   8805 00ECFF 42 5B A5 12                  	LDA		ZS:CNT0H	; get starting count
   8806 00ED03 AA                           	TAX				; save it off in .X
   8807 00ED04                             .0002:
   8808 00ED04 38                           	SEC				; compare to current counter value
   8809 00ED05 42 5B E5 12                  	SBC		ZS:CNT0H
   8810 00ED09 49 FF                        	EOR		#$FF	; make negative
   8811 00ED0B C9 0A                        	CMP		#10
   8812 00ED0D 10 03                        	BPL     .0001
   8813 00ED0F 8A                           	TXA				; prepare for next check, get startcount in .A
   8814 00ED10 80 F2                        	BRA		.0002	; go back if less than 5 ticks
   8815 00ED12                             .0001:
   8816 00ED12 FA                           	PLX				; restore .X
   8817 00ED13 68                           	PLA
   8818 00ED14 60                           	RTS
                                           
                                           	MEM		16
                                           	NDX		16
                                           
   8823 00ED15                             msgKeybdNR:
   8824 00ED15 0D 0A 4B 65 79 62 6F 61      	.byte	CR,LF,"Keyboard not responding.",CR,LF,0
   8824 00ED1D 72 64 20 6E 6F 74 20 72    
   8824 00ED25 65 73 70 6F 6E 64 69 6E    
   8824 00ED2D 67 2E 0D 0A 00             
                                           
                                           	cpu		FT832
                                           
   8828 00ED32                             KeybdGetCharNoWaitCtx:
   8829 00ED32 20 38 ED                     	JSR		KeybdGetCharNoWait
   8830 00ED35 42 40 00                     	RTC		#0
   8831 00ED38                             	
   8832 00ED38 08                           	PHP
   8833 00ED39 E2 20                        	SEP		#$20
   8834 00ED3B C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8837 00ED3D A9 00                        	LDA		#0
   8838 00ED3F 85 0B                        	STA		KeybdWaitFlag
   8839 00ED41 80 10                        	BRA		KeybdGetChar1
                                           
   8841 00ED43                             KeybdGetCharWait:
   8842 00ED43 08                           	PHP
   8843 00ED44 E2 20                        	SEP		#$20
   8844 00ED46 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8847 00ED48 A9 FF                        	LDA		#$FF
   8848 00ED4A 85 0B                        	STA		KeybdWaitFlag
   8849 00ED4C 80 05                        	BRA		KeybdGetChar1
                                           
                                           ; Wait for a keyboard character to be available
                                           ; Returns (CF=1) if no key available
                                           ; Return key (CF=0) if key is available
                                           ;
                                           ;
   8856 00ED4E                             KeybdGetChar:
   8857 00ED4E 08                           	PHP
   8858 00ED4F E2 20                        	SEP		#$20		; 8 bit acc
   8859 00ED51 C2 10                        	REP		#$10
                                           	MEM		8
                                           	NDX		16
   8862 00ED53                             KeybdGetChar1:
   8863 00ED53 DA                           	PHX
   8864 00ED54 EB                           	XBA					; force .B to zero for TAX
   8865 00ED55 A9 00                        	LDA		#0
   8866 00ED57 EB                           	XBA
   8867 00ED58                             .0002:
   8868 00ED58                             .0003:
   8869 00ED58 42 3B FF 0F AF 11 A1 0E      	LDA		$FFF:KEYBD+1		; check MSB of keyboard status reg.
                                         
   8870 00ED60 2A                           	ROL
   8871 00ED61 2A                           	ROL
   8872 00ED62 B0 F4                        	BCS		.0003		; check busy flag, branch if busy
   8873 00ED64 6A                           	ROR
   8874 00ED65 B0 08                        	BCS		.0006		; branch if keystroke ready
   8875 00ED67 24 0B                        	BIT		KeybdWaitFlag
   8876 00ED69 30 ED                        	BMI		.0003
   8877 00ED6B FA                           	PLX
   8878 00ED6C 28                           	PLP
   8879 00ED6D 38                           	SEC
   8880 00ED6E 60                           	RTS
   8881 00ED6F                             .0006:
   8882 00ED6F 42 3B FF 0F AF 10 A1 0E      	LDA		$FFF:KEYBD	; get scan code value
                                         
   8883 00ED77 42 3B FF 0F 42 9C 12 A1      	STZ		$FFF:KEYBD+2	; clear read flag
   8883 00ED7F 0E 00                      
   8884 00ED81 C2 20                        	REP		#$20
                                           	;JSR		DispByte
                                           	;JSR		space
   8887 00ED83 E2 20                        	SEP		#$20
   8888 00ED85                             .0001:
   8889 00ED85 C9 F0                        	CMP		#SC_KEYUP	; keyup scan code ?
   8890 00ED87 F0 FF 71 00                  	LBEQ	.doKeyup	; 
   8891 00ED8B C9 E0                        	CMP		#SC_EXTEND	; extended scan code ?
   8892 00ED8D F0 FF 72 00                  	LBEQ	.doExtend
   8893 00ED91 C9 14                        	CMP		#$14		; control ?
   8894 00ED93 F0 FF 75 00                  	LBEQ	.doCtrl
   8895 00ED97 C9 12                        	CMP		#$12		; left shift
   8896 00ED99 F0 FF 7F 00                  	LBEQ	.doShift
   8897 00ED9D C9 59                        	CMP		#$59		; right shift
   8898 00ED9F F0 FF 79 00                  	LBEQ	.doShift
   8899 00EDA3 C9 77                        	CMP		#SC_NUMLOCK
   8900 00EDA5 F0 FF 83 00                  	LBEQ	.doNumLock
   8901 00EDA9 C9 58                        	CMP		#SC_CAPSLOCK
   8902 00EDAB F0 FF 8D 00                  	LBEQ	.doCapsLock
   8903 00EDAF C9 7E                        	CMP		#SC_SCROLLLOCK
   8904 00EDB1 F0 FF 97 00                  	LBEQ	.doScrollLock
   8905 00EDB5 46 08                        	LSR		KeyState1
   8906 00EDB7 B0 9F                        	BCS		.0003
   8907 00EDB9 AA                           	TAX
   8908 00EDBA A9 80                        	LDA		#$80
   8909 00EDBC 24 09                        	BIT		KeyState2	; Is extended code ?
   8910 00EDBE F0 13                        	BEQ		.0010
   8911 00EDC0 A9 7F                        	LDA		#$7F
   8912 00EDC2 25 09                        	AND		KeyState2
   8913 00EDC4 85 09                        	STA		KeyState2
   8914 00EDC6 46 08                        	LSR		KeyState1	; clear keyup
   8915 00EDC8 8A                           	TXA
   8916 00EDC9 29 7F                        	AND		#$7F
   8917 00EDCB AA                           	TAX
   8918 00EDCC 42 1B BD 29 F1               	LDA		cs:keybdExtendedCodes,X
   8919 00EDD1 80 23                        	BRA		.0008
   8920 00EDD3                             .0010:
   8921 00EDD3 A9 04                        	LDA		#4
   8922 00EDD5 24 09                        	BIT		KeyState2	; Is Cntrl down ?
   8923 00EDD7 F0 0B                        	BEQ		.0009
   8924 00EDD9 8A                           	TXA
   8925 00EDDA 29 7F                        	AND		#$7F		; table is 128 chars
   8926 00EDDC AA                           	TAX
   8927 00EDDD 42 1B BD A9 F0               	LDA		cs:keybdControlCodes,X
   8928 00EDE2 80 12                        	BRA		.0008
   8929 00EDE4                             .0009:
   8930 00EDE4 A9 01                        	LDA		#$1			; Is shift down ?
   8931 00EDE6 24 09                        	BIT		KeyState2
   8932 00EDE8 F0 07                        	BEQ		.0007
   8933 00EDEA 42 1B BD A9 EF               	LDA		cs:shiftedScanCodes,X
   8934 00EDEF 80 05                        	BRA		.0008
   8935 00EDF1                             .0007:
   8936 00EDF1 42 1B BD A9 EE               	LDA		cs:unshiftedScanCodes,X
   8937 00EDF6                             .0008:
   8938 00EDF6 C2 20                        	REP		#$20
                                           	MEM		16
   8940 00EDF8 FA                           	PLX
   8941 00EDF9 28                           	PLP
   8942 00EDFA 18                           	CLC
   8943 00EDFB 60                           	RTS
                                           	MEM		8
   8945 00EDFC                             .doKeyup:
   8946 00EDFC A9 01                        	LDA		#1
   8947 00EDFE 04 08                        	TSB		KeyState1
   8948 00EE00 82 55 FF                     	BRL		.0003
   8949 00EE03                             .doExtend:				; set extended key flag
   8950 00EE03 A5 09                        	LDA		KeyState2
   8951 00EE05 09 80                        	ORA		#$80
   8952 00EE07 85 09                        	STA		KeyState2
   8953 00EE09 82 4C FF                     	BRL		.0003
   8954 00EE0C                             .doCtrl:
   8955 00EE0C A9 04                        	LDA		#4
   8956 00EE0E 46 08                        	LSR		KeyState1	; check key up/down	
   8957 00EE10 90 05                        	BCC		.0004		; keydown = carry clear
   8958 00EE12 14 09                        	TRB		KeyState2
   8959 00EE14 82 41 FF                     	BRL		.0003
   8960 00EE17                             .0004:
   8961 00EE17 04 09                        	TSB		KeyState2	; set control active bit
   8962 00EE19 82 3C FF                     	BRL		.0003
   8963 00EE1C                             .doShift:
   8964 00EE1C A9 01                        	LDA		#1
   8965 00EE1E 46 08                        	LSR		KeyState1	; check key up/down	
   8966 00EE20 90 05                        	BCC		.0005
   8967 00EE22 14 09                        	TRB		KeyState2
   8968 00EE24 82 31 FF                     	BRL		.0003
   8969 00EE27                             .0005:
   8970 00EE27 04 09                        	TSB		KeyState2
   8971 00EE29 82 2C FF                     	BRL		.0003
   8972 00EE2C                             .doNumLock:
   8973 00EE2C A5 09                        	LDA		KeyState2
   8974 00EE2E 49 10                        	EOR		#16
   8975 00EE30 85 09                        	STA		KeyState2
   8976 00EE32 E2 30                        	SEP		#$30
   8977 00EE34 20 5C EE                     	JSR		KeybdSetLEDStatus
   8978 00EE37 C2 10                        	REP		#$10
   8979 00EE39 82 1C FF                     	BRL		.0003
   8980 00EE3C                             .doCapsLock:
   8981 00EE3C A5 09                        	LDA		KeyState2
   8982 00EE3E 49 20                        	EOR		#32
   8983 00EE40 85 09                        	STA		KeyState2
   8984 00EE42 E2 30                        	SEP		#$30
   8985 00EE44 20 5C EE                     	JSR		KeybdSetLEDStatus
   8986 00EE47 C2 10                        	REP		#$10
   8987 00EE49 82 0C FF                     	BRL		.0003
   8988 00EE4C                             .doScrollLock:
   8989 00EE4C A5 09                        	LDA		KeyState2
   8990 00EE4E 49 40                        	EOR		#64
   8991 00EE50 85 09                        	STA		KeyState2
   8992 00EE52 E2 30                        	SEP		#$30
   8993 00EE54 20 5C EE                     	JSR		KeybdSetLEDStatus
   8994 00EE57 C2 10                        	REP		#$10
   8995 00EE59 82 FC FE                     	BRL		.0003
                                           
   8997 00EE5C                             KeybdSetLEDStatus:
                                           ;	PHDS				; save off DS
                                           ;	PEA		5			; set DS to zero
                                           ;	PLDS
   9001 00EE5C A9 00                        	LDA		#0
   9002 00EE5E 85 0A                        	STA		KeybdLEDs
   9003 00EE60 A9 10                        	LDA		#16
   9004 00EE62 24 09                        	BIT		KeyState2
   9005 00EE64 F0 06                        	BEQ		.0002
   9006 00EE66 A5 0A                        	LDA		KeybdLEDs	; set bit 1 for Num lock, 0 for scrolllock , 2 for caps lock
   9007 00EE68 09 02                        	ORA		#$2
   9008 00EE6A 85 0A                        	STA		KeybdLEDs
   9009 00EE6C                             .0002:
   9010 00EE6C A9 20                        	LDA		#32
   9011 00EE6E 24 09                        	BIT		KeyState2
   9012 00EE70 F0 06                        	BEQ		.0003
   9013 00EE72 A5 0A                        	LDA		KeybdLEDs
   9014 00EE74 09 04                        	ORA		#$4
   9015 00EE76 85 0A                        	STA		KeybdLEDs
   9016 00EE78                             .0003:
   9017 00EE78 A9 40                        	LDA		#64
   9018 00EE7A 24 09                        	BIT		KeyState2
   9019 00EE7C F0 06                        	BEQ		.0004
   9020 00EE7E A5 0A                        	LDA		KeybdLEDs
   9021 00EE80 09 01                        	ORA		#1
   9022 00EE82 85 0A                        	STA		KeybdLEDs
   9023 00EE84                             .0004:
   9024 00EE84 A9 ED                        	LDA		#$ED		; set status LEDs command
   9025 00EE86 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9026 00EE8E 20 DF EC                     	JSR		KeybdWaitTx
   9027 00EE91 20 BA EC                     	JSR		KeybdRecvByte
   9028 00EE94 90 12                        	BCC		.0001
   9029 00EE96 C9 FA                        	CMP		#$FA
   9030 00EE98 A5 0A                        	LDA		KeybdLEDs
   9031 00EE9A 42 3B FF 0F 8F 10 A1 0E      	STA		$FFF:KEYBD
                                         
   9032 00EEA2 20 DF EC                     	JSR		KeybdWaitTx
   9033 00EEA5 20 BA EC                     	JSR		KeybdRecvByte	; wait for $FA byte
   9034 00EEA8                             .0001:
                                           ;	PLDS				; recover DS
   9036 00EEA8 60                           	RTS
                                           
                                           
                                           	;--------------------------------------------------------------------------
                                           	; PS2 scan codes to ascii conversion tables.
                                           	;--------------------------------------------------------------------------
                                           	;
   9043 00EEA9                             unshiftedScanCodes:
   9044 00EEA9 2E A9 2E A5 A3 A1 A2 AC      	.byte	$2e,$a9,$2e,$a5,$a3,$a1,$a2,$ac
                                         
   9045 00EEB1 2E AA A8 A6 A4 09 60 2E      	.byte	$2e,$aa,$a8,$a6,$a4,$09,$60,$2e
                                         
   9046 00EEB9 2E 2E 2E 2E 2E 71 31 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$71,$31,$2e
                                         
   9047 00EEC1 2E 2E 7A 73 61 77 32 2E      	.byte	$2e,$2e,$7a,$73,$61,$77,$32,$2e
                                         
   9048 00EEC9 2E 63 78 64 65 34 33 2E      	.byte	$2e,$63,$78,$64,$65,$34,$33,$2e
                                         
   9049 00EED1 2E 20 76 66 74 72 35 2E      	.byte	$2e,$20,$76,$66,$74,$72,$35,$2e
                                         
   9050 00EED9 2E 6E 62 68 67 79 36 2E      	.byte	$2e,$6e,$62,$68,$67,$79,$36,$2e
                                         
   9051 00EEE1 2E 2E 6D 6A 75 37 38 2E      	.byte	$2e,$2e,$6d,$6a,$75,$37,$38,$2e
                                         
   9052 00EEE9 2E 2C 6B 69 6F 30 39 2E      	.byte	$2e,$2c,$6b,$69,$6f,$30,$39,$2e
                                         
   9053 00EEF1 2E 2E 2F 6C 3B 70 2D 2E      	.byte	$2e,$2e,$2f,$6c,$3b,$70,$2d,$2e
                                         
   9054 00EEF9 2E 2E 27 2E 5B 3D 2E 2E      	.byte	$2e,$2e,$27,$2e,$5b,$3d,$2e,$2e
                                         
   9055 00EF01 AD 2E 0D 5D 2E 5C 2E 2E      	.byte	$ad,$2e,$0d,$5d,$2e,$5c,$2e,$2e
                                         
   9056 00EF09 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9057 00EF11 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9058 00EF19 98 7F 92 2E 91 90 1B AF      	.byte	$98,$7f,$92,$2e,$91,$90,$1b,$af
                                         
   9059 00EF21 AB 2E 97 2E 2E 96 AE 2E      	.byte	$ab,$2e,$97,$2e,$2e,$96,$ae,$2e
                                         
                                           
   9061 00EF29 2E 2E 2E A7 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$a7,$2e,$2e,$2e,$2e
                                         
   9062 00EF31 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9063 00EF39 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9064 00EF41 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9065 00EF49 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9066 00EF51 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9067 00EF59 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9068 00EF61 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9069 00EF69 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9070 00EF71 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9071 00EF79 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9072 00EF81 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9073 00EF89 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9074 00EF91 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9075 00EF99 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9076 00EFA1 2E 2E FA 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$fa,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9078 00EFA9                             shiftedScanCodes:
   9079 00EFA9 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9080 00EFB1 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9081 00EFB9 2E 2E 2E 2E 2E 51 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$51,$21,$2e
                                         
   9082 00EFC1 2E 2E 5A 53 41 57 40 2E      	.byte	$2e,$2e,$5a,$53,$41,$57,$40,$2e
                                         
   9083 00EFC9 2E 43 58 44 45 24 23 2E      	.byte	$2e,$43,$58,$44,$45,$24,$23,$2e
                                         
   9084 00EFD1 2E 20 56 46 54 52 25 2E      	.byte	$2e,$20,$56,$46,$54,$52,$25,$2e
                                         
   9085 00EFD9 2E 4E 42 48 47 59 5E 2E      	.byte	$2e,$4e,$42,$48,$47,$59,$5e,$2e
                                         
   9086 00EFE1 2E 2E 4D 4A 55 26 2A 2E      	.byte	$2e,$2e,$4d,$4a,$55,$26,$2a,$2e
                                         
   9087 00EFE9 2E 3C 4B 49 4F 29 28 2E      	.byte	$2e,$3c,$4b,$49,$4f,$29,$28,$2e
                                         
   9088 00EFF1 2E 3E 3F 4C 3A 50 5F 2E      	.byte	$2e,$3e,$3f,$4c,$3a,$50,$5f,$2e
                                         
   9089 00EFF9 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9090 00F001 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9091 00F009 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9092 00F011 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9093 00F019 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9094 00F021 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9096 00F029 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9097 00F031 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9098 00F039 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9099 00F041 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9100 00F049 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9101 00F051 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9102 00F059 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9103 00F061 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9104 00F069 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9105 00F071 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9106 00F079 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9107 00F081 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9108 00F089 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9109 00F091 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9110 00F099 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9111 00F0A1 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
                                           ; control
   9114 00F0A9                             keybdControlCodes:
   9115 00F0A9 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9116 00F0B1 2E 2E 2E 2E 2E 09 7E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$09,$7e,$2e
                                         
   9117 00F0B9 2E 2E 2E 2E 2E 11 21 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$11,$21,$2e
                                         
   9118 00F0C1 2E 2E 1A 13 01 17 40 2E      	.byte	$2e,$2e,$1a,$13,$01,$17,$40,$2e
                                         
   9119 00F0C9 2E 03 18 04 05 24 23 2E      	.byte	$2e,$03,$18,$04,$05,$24,$23,$2e
                                         
   9120 00F0D1 2E 20 16 06 14 12 25 2E      	.byte	$2e,$20,$16,$06,$14,$12,$25,$2e
                                         
   9121 00F0D9 2E 0E 02 08 07 19 5E 2E      	.byte	$2e,$0e,$02,$08,$07,$19,$5e,$2e
                                         
   9122 00F0E1 2E 2E 0D 0A 15 26 2A 2E      	.byte	$2e,$2e,$0d,$0a,$15,$26,$2a,$2e
                                         
   9123 00F0E9 2E 3C 0B 09 0F 29 28 2E      	.byte	$2e,$3c,$0b,$09,$0f,$29,$28,$2e
                                         
   9124 00F0F1 2E 3E 3F 0C 3A 10 5F 2E      	.byte	$2e,$3e,$3f,$0c,$3a,$10,$5f,$2e
                                         
   9125 00F0F9 2E 2E 22 2E 7B 2B 2E 2E      	.byte	$2e,$2e,$22,$2e,$7b,$2b,$2e,$2e
                                         
   9126 00F101 2E 2E 0D 7D 2E 7C 2E 2E      	.byte	$2e,$2e,$0d,$7d,$2e,$7c,$2e,$2e
                                         
   9127 00F109 2E 2E 2E 2E 2E 2E 08 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$08,$2e
                                         
   9128 00F111 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9129 00F119 2E 7F 2E 2E 2E 2E 1B 2E      	.byte	$2e,$7f,$2e,$2e,$2e,$2e,$1b,$2e
                                         
   9130 00F121 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
                                           
   9132 00F129                             keybdExtendedCodes:
   9133 00F129 2E 2E 2E 2E A3 A1 A2 2E      	.byte	$2e,$2e,$2e,$2e,$a3,$a1,$a2,$2e
                                         
   9134 00F131 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9135 00F139 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9136 00F141 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9137 00F149 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9138 00F151 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9139 00F159 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9140 00F161 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9141 00F169 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9142 00F171 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9143 00F179 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9144 00F181 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9145 00F189 2E 2E 2E 2E 2E 2E 2E 2E      	.byte	$2e,$2e,$2e,$2e,$2e,$2e,$2e,$2e
                                         
   9146 00F191 2E 95 2E 93 94 2E 2E 2E      	.byte	$2e,$95,$2e,$93,$94,$2e,$2e,$2e
                                         
   9147 00F199 98 99 92 2E 91 90 2E 2E      	.byte	$98,$99,$92,$2e,$91,$90,$2e,$2e
                                         
   9148 00F1A1 2E 2E 97 2E 2E 96 2E 2E      	.byte	$2e,$2e,$97,$2e,$2e,$96,$2e,$2e
                                         
                                           
                                           ; Get char routine for Supermon
                                           ; This routine might be called with 8 bit regs.
                                           ;
                                           	MEM		16
                                           	NDX		16
   9155 00F1A9                             SuperGetch:
   9156 00F1A9 20 38 ED                     	JSR		KeybdGetCharNoWait
   9157 00F1AC 29 FF 00                     	AND		#$FF
   9158 00F1AF 42 40 00                     	RTC		#0
                                           
                                           ; Put char routine for Supermon
                                           ;
   9162 00F1B2                             SuperPutch:
   9163 00F1B2 20 DE E9                     	JSR		OutChar
   9164 00F1B5 42 40 00                     	RTC		#0
                                           
                                           ; Char get routine for BASIC
                                           ; Same thing as for Supermon, except carry flag needs to be inverted
                                           ; This routine should be called from a different context than the BIOS,
                                           ; otherwise the call will be ignored.
                                           ;
   9171 00F1B8                             BasicGetch:
   9172 00F1B8 20 38 ED                     	JSR		KeybdGetCharNoWait
   9173 00F1BB 29 FF 00                     	AND		#$FF
   9174 00F1BE 42 18                        	CMC
   9175 00F1C0 42 40 00                     	RTC		#0
                                           
   9177 00F1C3                             warm_start:
   9178 00F1C3 42 E2 00 01                  	SEP		#$100		; 16 bit mode
   9179 00F1C7 C2 30                        	REP		#$30		; 16 bit MEM,NDX
                                           	MEM		16
                                           	NDX		16
   9182 00F1C9 A9 FF 3F                     	LDA		#$3FFF
   9183 00F1CC 1B                           	TAS
   9184 00F1CD 20 41 EA                     	JSR		CursorOn
   9185 00F1D0 82 96 EF                     	BRL		Mon1
                                           
                                           	cpu		FT832
   9188 00F1D3                             ICacheIL832:
   9189 00F1D3 42 E0 01                     	CACHE	#1			; 1= invalidate instruction line identified by accumulator
   9190 00F1D6 60                           	RTS
                                           
   9192 00F1D7                             ByteIRQRout:
   9193 00F1D7 40                           	RTI
                                           
   9195 00F1D8                             IRQRout:
   9196 00F1D8 42 A2 01 00                  	TSK		#1			; switch to the interrupt handling task
   9197 00F1DC 40                           	RTI
                                           
   9199 00F1DD                             Task1:
   9200 00F1DD AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
   9201 00F1E0 89 02 00                     	BIT		#2
   9202 00F1E3 F0 17                        	BEQ		.0001
   9203 00F1E5 A5 04                        	LDA		TickCount		; increment the tick count
   9204 00F1E7 1A                           	INA
   9205 00F1E8 85 04                        	STA		TickCount
   9206 00F1EA 42 3B FF 0F 42 8B 8F A4      	STA.B	$FFF:$D00A4		; update on-screen IRQ live indicator
   9206 00F1F2 00 0D                      
   9207 00F1F4 A9 05 00                     	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9208 00F1F7 42 8B 8D 17 B0               	STA.B	CTR1_CTRL
                                           ;	JSR		MusicTimeoutIRQ
   9210 00F1FC                             .0001:
   9211 00F1FC 42 60                        	RTT					; go back to interrupted task
   9212 00F1FE 80 DD                        	BRA		Task1		; the next time task1 is run it will start here
                                           
                                           ; IRQ handler task - 32 bit
                                           ;
   9216 00F200                             IRQTask:
                                           	MEM		8
                                           	NDX		32
   9219 00F200                             IRQTask1:
   9220 00F200 AD 1F B0                     	LDA		MPU_IRQ_STATUS	; check if counter expired
   9221 00F203 89 02                        	BIT		#2
   9222 00F205 F0 16                        	BEQ		.0001
   9223 00F207 A6 04                        	LDX		TickCount		; increment the tick count
   9224 00F209 E8                           	INX
   9225 00F20A 86 04                        	STX		TickCount
   9226 00F20C 42 3B FF 0F 42 8B 42 8E      	STX.B	$FFF:$D00A2			; update on-screen IRQ live indicator
   9226 00F214 A2 00 0D 00                
   9227 00F218 A9 05                        	LDA		#$05			; count down, on mpu clock, irq enabled (clears irq)
   9228 00F21A 8D 17 B0                     	STA		CTR1_CTRL
   9229 00F21D                             .0001:
   9230 00F21D 42 60                        	RTT					; go back to interrupted task
   9231 00F21F 80 DF                        	BRA		IRQTask1	; the next time task is run it will start here
                                           
                                           ; This little task sample runs in native 32 bit mode and displays
                                           ; "Hello World!" on the screen.
                                           
                                           	CPU		FT832
                                           	MEM		8
                                           	NDX		32
                                           
   9240 00F221                             Task2:
   9241 00F221 A2 F8 01 00 00               	LDX		#84*2*3
   9242 00F226                             .0003:
   9243 00F226 A0 00 00 00 00               	LDY		#0
   9244 00F22B                             .0002:
   9245 00F22B 42 1B B9 46 F2               	LDA		CS:msgHelloWorld,Y
   9246 00F230 F0 10                        	BEQ		.0001
   9247 00F232 20 D5 E7                     	JSR		AsciiToScreen8
   9248 00F235 42 3B FF 0F 9F 00 00 0D      	STA		$FFF:VIDBUF,X
                                         
   9249 00F23D E8                           	INX
   9250 00F23E E8                           	INX
   9251 00F23F C8                           	INY
   9252 00F240 80 E9                        	BRA		.0002
   9253 00F242                             .0001:
   9254 00F242 42 60                        	RTT
   9255 00F244 80 E0                        	BRA		.0003
                                           
   9257 00F246                             msgHelloWorld:
   9258 00F246 0D 0A 48 65 6C 6C 6F 20      	.byte	CR,LF,"Hello World!",CR,LF,0
   9258 00F24E 57 6F 72 6C 64 21 0D 0A    
   9258 00F256 00                         
                                           
                                           	NDX		16
                                           	MEM		16
                                           
   9263 00F257                             BrkTask:
   9264 00F257 42 EE 00 00 D0 FF            	INC		$FFD00000
   9265 00F25D 42 60                        	RTT
   9266 00F25F 80 F6                        	BRA		BrkTask
                                           
                                           ; The following store sequence for the benefit of Supermon816
                                           ;
   9270 00F261                             BrkRout:
   9271 00F261 0B                           	PHD
   9272 00F262 8B                           	PHB
   9273 00F263 C2 30                        	REP		#$30
   9274 00F265 48                           	PHA
   9275 00F266 DA                           	PHX
   9276 00F267 5A                           	PHY
   9277 00F268 6C 02 01                     	JMP		($0102)		; This jump normally points to BrkRout1
   9278 00F26B                             BrkRout1:
   9279 00F26B C2 30                        	REP		#$30
   9280 00F26D 7A                           	PLY
   9281 00F26E FA                           	PLX
   9282 00F26F 68                           	PLA
   9283 00F270 AB                           	PLB
   9284 00F271 2B                           	PLD
   9285 00F272 E2 20                        	SEP		#$20
   9286 00F274 68                           	PLA
   9287 00F275 C2 30                        	REP		#$30
   9288 00F277 68                           	PLA
   9289 00F278 20 BE EA                     	JSR		DispWord
   9290 00F27B A2 00 00                     	LDX		#0
   9291 00F27E A0 40 00                     	LDY		#64
   9292 00F281                             .0001:
   9293 00F281 42 F0                        	.word	$f042		; pchist
   9294 00F283 20 BE EA                     	JSR		DispWord
   9295 00F286 A9 20 00                     	LDA		#' '
   9296 00F289 20 DE E9                     	JSR		OutChar
   9297 00F28C E8                           	INX
   9298 00F28D 88                           	DEY
   9299 00F28E D0 F1                        	BNE		.0001
   9300 00F290 A9 FF FF                     	LDA		#$FFFF
   9301 00F293 8D 00 70                     	STA		$7000
   9302 00F296                             Hung:
   9303 00F296 80 FE                        	BRA		Hung
                                           
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------
                                           	; I/O page is located at $F0xx
                                           	;--------------------------------------------------------
                                           	;--------------------------------------------------------	
                                           	;org		$F100
                                           
   9312 00F298                             LineTbl:
   9313 00F298 00 00                        	.WORD	0
   9314 00F29A 54 00                        	.WORD	TEXTCOLS
   9315 00F29C A8 00                        	.WORD	TEXTCOLS*2
   9316 00F29E FC 00                        	.WORD	TEXTCOLS*3
   9317 00F2A0 50 01                        	.WORD	TEXTCOLS*4
   9318 00F2A2 A4 01                        	.WORD	TEXTCOLS*5
   9319 00F2A4 F8 01                        	.WORD	TEXTCOLS*6
   9320 00F2A6 4C 02                        	.WORD	TEXTCOLS*7
   9321 00F2A8 A0 02                        	.WORD	TEXTCOLS*8
   9322 00F2AA F4 02                        	.WORD	TEXTCOLS*9
   9323 00F2AC 48 03                        	.WORD	TEXTCOLS*10
   9324 00F2AE 9C 03                        	.WORD	TEXTCOLS*11
   9325 00F2B0 F0 03                        	.WORD	TEXTCOLS*12
   9326 00F2B2 44 04                        	.WORD	TEXTCOLS*13
   9327 00F2B4 98 04                        	.WORD	TEXTCOLS*14
   9328 00F2B6 EC 04                        	.WORD	TEXTCOLS*15
   9329 00F2B8 40 05                        	.WORD	TEXTCOLS*16
   9330 00F2BA 94 05                        	.WORD	TEXTCOLS*17
   9331 00F2BC E8 05                        	.WORD	TEXTCOLS*18
   9332 00F2BE 3C 06                        	.WORD	TEXTCOLS*19
   9333 00F2C0 90 06                        	.WORD	TEXTCOLS*20
   9334 00F2C2 E4 06                        	.WORD	TEXTCOLS*21
   9335 00F2C4 38 07                        	.WORD	TEXTCOLS*22
   9336 00F2C6 8C 07                        	.WORD	TEXTCOLS*23
   9337 00F2C8 E0 07                        	.WORD	TEXTCOLS*24
   9338 00F2CA 34 08                        	.WORD	TEXTCOLS*25
   9339 00F2CC 88 08                        	.WORD	TEXTCOLS*26
   9340 00F2CE DC 08                        	.WORD	TEXTCOLS*27
   9341 00F2D0 30 09                        	.WORD	TEXTCOLS*28
   9342 00F2D2 84 09                        	.WORD	TEXTCOLS*29
   9343 00F2D4 D8 09                        	.WORD	TEXTCOLS*30
                                           
   9345 00F2D6                             TaskStartTbl:
   9346 00F2D6 01 00                        	.WORD	1			; CS
   9347 00F2D8 00 00                        	.WORD	0			; DS
   9348 00F2DA 00 00                        	.WORD	0			; SS
   9349 00F2DC CA E0                        	.WORD	Task0		; PC
   9350 00F2DE 00                           	.BYTE	Task0>>16	; PB
   9351 00F2DF 00 00                        	.WORD	0			; acc
   9352 00F2E1 00 00                        	.WORD	0
   9353 00F2E3 00 00                        	.WORD	0			; x
   9354 00F2E5 00 00                        	.WORD	0
   9355 00F2E7 00 00                        	.WORD	0			; y
   9356 00F2E9 00 00                        	.WORD	0
   9357 00F2EB FF 3F                        	.WORD	$3FFF		; sp
   9358 00F2ED 00 00                        	.WORD	0
   9359 00F2EF 04                           	.BYTE	4			; SR
   9360 00F2F0 01                           	.BYTE	1			; SR extension
   9361 00F2F1 00                           	.BYTE	0			; DB
   9362 00F2F2 00 00                        	.WORD	0			; DPR
   9363 00F2F4 00 00                        	.WORD	0
                                           
                                           	; TASK #1
                                           	; Interrupt handler task
   9367 00F2F6 01 00                        	.WORD	1			; CS
   9368 00F2F8 05 00                        	.WORD	5			; DS
   9369 00F2FA 05 00                        	.WORD	5			; SS
   9370 00F2FC DD F1                        	.WORD	Task1		; PC
   9371 00F2FE 00                           	.BYTE	Task1>>16
   9372 00F2FF 00 00                        	.WORD	0			; acc
   9373 00F301 00 00                        	.WORD	0
   9374 00F303 00 00                        	.WORD	0			; x
   9375 00F305 00 00                        	.WORD	0
   9376 00F307 00 00                        	.WORD	0			; y
   9377 00F309 00 00                        	.WORD	0
   9378 00F30B FF 3B                        	.WORD	$3BFF		; sp
   9379 00F30D 00 00                        	.WORD	0
   9380 00F30F 04                           	.BYTE	4			; SR
   9381 00F310 01                           	.BYTE	1			; SR extension
   9382 00F311 00                           	.BYTE	0			; DB
   9383 00F312 00 00                        	.WORD	0			; DPR
   9384 00F314 00 00                        	.WORD	0
                                           
   9386 00F316 01 00                        	.WORD	1			; CS
   9387 00F318 00 00                        	.WORD	0			; DS
   9388 00F31A 00 00                        	.WORD	0			; SS
   9389 00F31C 21 F2                        	.WORD	Task2		; PC
   9390 00F31E 00                           	.BYTE	Task2>>16
   9391 00F31F 00 00                        	.WORD	0			; acc
   9392 00F321 00 00                        	.WORD	0
   9393 00F323 00 00                        	.WORD	0			; x
   9394 00F325 00 00                        	.WORD	0
   9395 00F327 00 00                        	.WORD	0			; y
   9396 00F329 00 00                        	.WORD	0
   9397 00F32B FF 37                        	.WORD	$37FF		; sp
   9398 00F32D 00 00                        	.WORD	0
   9399 00F32F 20                           	.BYTE	$20			; SR			; eight bit mem
   9400 00F330 02                           	.BYTE	2			; SR extension
   9401 00F331 00                           	.BYTE	0			; DB
   9402 00F332 00 00                        	.WORD	0			; DPR
   9403 00F334 00 00                        	.WORD	0
                                           
   9405 00F336 01 00                        	.WORD	1			; CS
   9406 00F338 00 00                        	.WORD	0			; DS
   9407 00F33A 00 00                        	.WORD	0			; SS
   9408 00F33C 94 E6                        	.WORD	SSMInit		; PC
   9409 00F33E 00                           	.BYTE	SSMTnit>>16
   9410 00F33F 00 00                        	.WORD	0			; acc
   9411 00F341 00 00                        	.WORD	0
   9412 00F343 00 00                        	.WORD	0			; x
   9413 00F345 00 00                        	.WORD	0
   9414 00F347 00 00                        	.WORD	0			; y
   9415 00F349 00 00                        	.WORD	0
   9416 00F34B FF 33                        	.WORD	$33FF		; sp
   9417 00F34D 00 00                        	.WORD	0
   9418 00F34F 04                           	.BYTE	$4			; SR	16 bit regs, mask interrupts
   9419 00F350 01                           	.BYTE	1			; SR extension - 816 mode
   9420 00F351 00                           	.BYTE	0			; DB
   9421 00F352 00 00                        	.WORD	0			; DPR
   9422 00F354 00 00                        	.WORD	0
                                           
   9424 00F356 01 00                        	.WORD	1			; CS
   9425 00F358 00 00                        	.WORD	0			; DS
   9426 00F35A 00 00                        	.WORD	0			; SS
   9427 00F35C 57 F2                        	.WORD	BrkTask		; PC
   9428 00F35E 00                           	.BYTE	BrkTask>>16
   9429 00F35F 00 00                        	.WORD	0			; acc
   9430 00F361 00 00                        	.WORD	0
   9431 00F363 00 00                        	.WORD	0			; x
   9432 00F365 00 00                        	.WORD	0
   9433 00F367 00 00                        	.WORD	0			; y
   9434 00F369 00 00                        	.WORD	0
   9435 00F36B FF 2F                        	.WORD	$2FFF		; sp
   9436 00F36D 00 00                        	.WORD	0
   9437 00F36F 00                           	.BYTE	0			; SR
   9438 00F370 01                           	.BYTE	1			; SR extension
   9439 00F371 00                           	.BYTE	0			; DB
   9440 00F372 00 00                        	.WORD	0			; DPR
   9441 00F374 00 00                        	.WORD	0
                                           
                                           	; task #5
                                           	; DS is placed at $7800
   9445 00F376 01 00                        	.WORD	1			; CS
   9446 00F378 00 00                        	.WORD	0    		; DS
   9447 00F37A 00 00                        	.WORD	0			; SS
   9448 00F37C 07 D9                        	.WORD	InvadersTask	; PC
   9449 00F37E 00                           	.BYTE	InvadersTask>>16
   9450 00F37F 00 00                        	.WORD	0			; acc
   9451 00F381 00 00                        	.WORD	0
   9452 00F383 00 00                        	.WORD	0			; x
   9453 00F385 00 00                        	.WORD	0
   9454 00F387 00 00                        	.WORD	0			; y
   9455 00F389 00 00                        	.WORD	0
   9456 00F38B FF 2B                        	.WORD	$2BFF		; sp
   9457 00F38D 00 00                        	.WORD	0
   9458 00F38F 00                           	.BYTE	0			; SR
   9459 00F390 01                           	.BYTE	1			; SR extension
   9460 00F391 00                           	.BYTE	0			; DB
   9461 00F392 00 00                        	.WORD	0			; DPR
   9462 00F394 00 00                        	.WORD	0
                                           
   9464 00F396 01 00                        	.WORD	1			; CS
   9465 00F398 00 00                        	.WORD	0			; DS
   9466 00F39A 00 00                        	.WORD	0			; SS
   9467 00F39C 00 F2                        	.WORD	IRQTask		; PC
   9468 00F39E 00                           	.BYTE	IRQTask>>16
   9469 00F39F 00 00                        	.WORD	0			; acc
   9470 00F3A1 00 00                        	.WORD	0
   9471 00F3A3 00 00                        	.WORD	0			; x
   9472 00F3A5 00 00                        	.WORD	0
   9473 00F3A7 00 00                        	.WORD	0			; y
   9474 00F3A9 00 00                        	.WORD	0
   9475 00F3AB FF 27                        	.WORD	$27FF		; sp
   9476 00F3AD 00 00                        	.WORD	0
   9477 00F3AF 24                           	.BYTE	$24			; SR	8 bit acc, mask interrupts
   9478 00F3B0 02                           	.BYTE	2			; SR extension - 832 mode
   9479 00F3B1 00                           	.BYTE	0			; DB
   9480 00F3B2 00 00                        	.WORD	0			; DPR
   9481 00F3B4 00 00                        	.WORD	0
                                           
                                           	; task 7 (Basic)
   9484 00F3B6 FD 0F                        	.WORD	$FFD		; CS
   9485 00F3B8 FD 0F                        	.WORD	$FFD		; DS
   9486 00F3BA FD 0F                        	.WORD	$FFD		; SS
   9487 00F3BC 00 C0                        	.WORD	$C000		; PC
   9488 00F3BE 00                           	.BYTE	$00
   9489 00F3BF 00 00                        	.WORD	0			; acc
   9490 00F3C1 00 00                        	.WORD	0
   9491 00F3C3 00 00                        	.WORD	0			; x
   9492 00F3C5 00 00                        	.WORD	0
   9493 00F3C7 00 00                        	.WORD	0			; y
   9494 00F3C9 00 00                        	.WORD	0
   9495 00F3CB FF 01                        	.WORD	$01FF		; sp
   9496 00F3CD 00 00                        	.WORD	0
   9497 00F3CF 00                           	.BYTE	0			; SR
   9498 00F3D0 00                           	.BYTE	0			; SR extension - 832 mode
   9499 00F3D1 00                           	.BYTE	0			; DB
   9500 00F3D2 00 00                        	.WORD	0			; DPR
   9501 00F3D4 00 00                        	.WORD	0
                                           
                                           	; task 8 (Supermon)
   9504 00F3D6 01 00                        	.WORD	$1			; CS
   9505 00F3D8 05 00                        	.WORD	$5			; DS
   9506 00F3DA 05 00                        	.WORD	$5			; SS
   9507 00F3DC 00 C0                        	.WORD	$C000		; PC
   9508 00F3DE 00                           	.BYTE	$00
   9509 00F3DF 00 00                        	.WORD	0			; acc
   9510 00F3E1 00 00                        	.WORD	0
   9511 00F3E3 00 00                        	.WORD	0			; x
   9512 00F3E5 00 00                        	.WORD	0
   9513 00F3E7 00 00                        	.WORD	0			; y
   9514 00F3E9 00 00                        	.WORD	0
   9515 00F3EB FF 2B                        	.WORD	$2BFF		; sp
   9516 00F3ED 00 00                        	.WORD	0
   9517 00F3EF 00                           	.BYTE	0			; SR
   9518 00F3F0 01                           	.BYTE	1			; SR extension - 832 mode
   9519 00F3F1 00                           	.BYTE	0			; DB
   9520 00F3F2 00 00                        	.WORD	0			; DPR
   9521 00F3F4 00 00                        	.WORD	0
                                           
   9523 00F3F6                             msgRegs:
   9524 00F3F6 0D 0A                        	.byte	CR,LF
   9525 00F3F8 20 20 20 20 20 20 20 20          .byte   "             xxxsxi31",CR,LF
   9525 00F400 20 20 20 20 20 78 78 78    
   9525 00F408 73 78 69 33 31 0D 0A       
   9526 00F40F 20 20 43 53 20 20 50 42          .byte   "  CS  PB PC  xxxsxn26NVmxDIZC    .A       .X       .Y       SP  ",CR,LF,0
   9526 00F417 20 50 43 20 20 78 78 78    
   9526 00F41F 73 78 6E 32 36 4E 56 6D    
   9526 00F427 78 44 49 5A 43 20 20 20    
   9526 00F42F 20 2E 41 20 20 20 20 20    
   9526 00F437 20 20 2E 58 20 20 20 20    
   9526 00F43F 20 20 20 2E 59 20 20 20    
   9526 00F447 20 20 20 20 53 50 20 20    
   9526 00F44F 0D 0A 00                   
   9527 00F452                             msgRegs2:
   9528 00F452 0D 0A                        	.byte	CR,LF
   9529 00F454 20 20 53 53 20 20 20 44      	.byte	"  SS   DS  DB  DP   BL",CR,LF,0
   9529 00F45C 53 20 20 44 42 20 20 44    
   9529 00F464 50 20 20 20 42 4C 0D 0A    
   9529 00F46C 00                         
   9530 00F46D                             msgErr:
   9531 00F46D 2A 2A 2A 45 72 72 0D 0A      	.byte	"***Err",CR,LF,0
   9531 00F475 00                         
                                           
                                           	cpu		FT832
                                           	MEM		32
                                           	NDX		32
   9536 00F476 A9 78 56 34 12               	LDA		#$12345678
   9537 00F47B A2 32 54 76 98               	LDX		#$98765432
   9538 00F480 42 8B 42 97 23               	STA.B	{$23},Y
   9539 00F485 42 BB 42 BC 56 55 45 44      	LDY.UH	$44455556,X
                                         
   9540 00F48D 42 1B 42 AB 42 BD 56 55      	LDA.H	CS:$44455556,X
   9540 00F495 45 44                      
   9541 00F497 42 3B 88 88 42 9B B9 34      	LDA.UB	SEG $8888:$1234,Y
   9541 00F49F 12                         
   9542 00F4A0 42 22 00 E0 00 00 00         	JSF	    $0000:start
   9543 00F4A7 42 6B 00                     	RTF
   9544 00F4AA 42 3B 21 98 7D 00 12         	ADC     SEG $9821:$1200,X
   9545 00F4B1 42 3B 21 08 5D 00 12         	EOR     $821:$1200,X
   9546 00F4B8 42 3B 41 08 45 12            	EOR     $841:$12
   9547 00F4BE 42 DA 42 F7 24               	SBC     FAR {$24},Y
   9548 00F4C3 42 DA 32 25                  	AND     FAR($25)
   9549 00F4C7 42 DA 01 26                  	ORA     FAR ($26,x)
   9550 00F4CB 42 A2 02 00                  	TSK		#2
   9551 00F4CF 42 3A                        	TSK
   9552 00F4D1 42 4C 00 00 01 00            	LDT		$10000,X
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ; +---------------------------+
                                           ; | block status / ptr to free|
                                           ; +---------------------------+
                                           ; | pointer to previous block |
                                           ; +---------------------------+
                                           ; | pointer to next block     |
                                           ; +---------------------------+
                                           ;
                                           	MEM		32
                                           	NDX		32
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
   9571 00F4D7                             FreeSysMem:
   9572 00F4D7 38                           	SEC
   9573 00F4D8 E9 0C 00 00 00               	SBC		#12		;	backup to block header
   9574 00F4DD A8                           	TAY				;	.Y = pointer to block to free (this)
   9575 00F4DE 08                           	PHP				; save interrupt mask
   9576 00F4DF 78                           	SEI				; no interrupts
                                           	STZ		$0,Y	; set status as free
   9578 00F4E0 B6 08                        	LDX		$8,Y	;	.X = pointer to next block
   9579 00F4E2 B5 00                        	LDA		$0,X	;	.A = next->status
   9580 00F4E4 F0 39                        	BEQ		.0001	;	branch if not free
                                           	; merge block with next free block
   9582 00F4E6 B5 08                        	LDA		$8,X	;   .A = pointer to next next block
   9583 00F4E8 99 08 00                     	STA		$8,Y	;
   9584 00F4EB AA                           	TAX
   9585 00F4EC 94 04                        	STY		$4,X	;	next->next->prev = this
   9586 00F4EE                             .0001:
                                           	; merge block with a previous free block
   9588 00F4EE B6 04                        	LDX		$4,Y	;	.X = pointer to prev block
   9589 00F4F0 B5 00                        	LDA		$0,X	;	.A = prev->status
   9590 00F4F2 F0 1F                        	BEQ		.0002	;	branch if not free
   9591 00F4F4 B9 08 00                     	LDA		$8,Y	;   prev->next = this->next
   9592 00F4F7 95 08                        	STA		$8,X
   9593 00F4F9 A8                           	TAY				;	.Y = this->next
   9594 00F4FA 96 04                        	STX		$4,Y	;	this->next->prev = this->prev
   9595 00F4FC 9B                           	TXY
   9596 00F4FD                             .0002:
   9597 00F4FD AD F9 F4                     	LDA		heap_free_ptr
   9598 00F500 99 00 00                     	STA		$0,Y
   9599 00F503 8C F9 F4                     	STY		heap_free_ptr
   9600 00F506 28                           	PLP
   9601 00F507 60                           	RTS
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	; round allocation size to mmu available sizes
                                           
   9607 00F508 A2 00 00 00 00               	LDX		#0
   9608 00F50D 18                           	CLC				; add room for header
   9609 00F50E 69 0C 00 00 00               	ADC		#12
   9610 00F513                             .0002:
   9611 00F513 DD 48 F5                     	CMP		mmas,X
   9612 00F516 42 B0 D5                     	BLE		.0001
   9613 00F519 E8                           	INX
   9614 00F51A E8                           	INX
   9615 00F51B E8                           	INX
   9616 00F51C E8                           	INX
   9617 00F51D 80 F4                        	BRA		.0002
   9618 00F51F                             .0001:
   9619 00F51F BD 48 F5                     	LDA		mmas,X
   9620 00F522 AA                           	TAX
   9621 00F523 AC 1D F5                     	LDY		free_heap_ptr
                                           	; subtract .Y from .A
   9623 00F526 38                           	SEC
   9624 00F527 B9 08 00                     	LDA		$8,Y
   9625 00F52A 8C 23 F5                     	STY		tmpy
   9626 00F52D ED 23 F5                     	SBC		tmpy
   9627 00F530 DD 48 F5                     	CMP		mmas,X
   9628 00F533 30 F6                        	BLT		.0003
                                           	; here block is big enough
   9630 00F535 48                           	PHA
   9631 00F536 B9 00 00                     	LDA		$0,Y
   9632 00F539 8D 1D F5                     	STA		free_heap_ptr
                                           	STZ		$0,Y
   9634 00F53C 68                           	PLA
   9635 00F53D 38                           	SEC
   9636 00F53E FD 48 F5                     	SBC		mmas,X
   9637 00F541 C9 FF 00 00 00               	CMP		#$0FF
   9638 00F546 30 00                        	BLT		.0004
                                           
   9640 00F548                             .0004:
                                           	
                                           
                                           ; Memory management allocation sizes
                                           ;
   9645 00F548                             mmas:
   9646 00F548 00 00 00 00                  	WORD	$0000,$0000
   9647 00F54C FF 00 00 00                  	WORD	$00FF,$0000
   9648 00F550 FF 03 00 00                  	WORD	$03FF,$0000
   9649 00F554 FF 0F 00 00                  	WORD	$0FFF,$0000
   9650 00F558 FF 3F 00 00                  	WORD	$3FFF,$0000
   9651 00F55C FF FF 00 00                  	WORD	$FFFF,$0000
   9652 00F560 FF FF 03 00                  	WORD	$FFFF,$0003
   9653 00F564 FF FF 0F 00                  	WORD	$FFFF,$000F
   9654 00F568 FF FF 3F 00                  	WORD	$FFFF,$003F
   9655 00F56C FF FF FF 00                  	WORD	$FFFF,$00FF
   9656 00F570 FF FF FF 03                  	WORD	$FFFF,$03FF
   9657 00F574 FF FF FF 0F                  	WORD	$FFFF,$0FFF
   9658 00F578 FF FF FF 3F                  	WORD	$FFFF,$3FFF
   9659 00F57C FF FF FF FF                  	WORD	$FFFF,$FFFF
                                           
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           ;------------------------------------------------------------------------------
                                           	MEM		16
                                           	NDX		16
   9667 00F580 4C 48 F6                     	JMP		MusicPlay
   9668 00F583                             beep:
   9669 00F583 A9 0F 00                     	LDA		#15					; set volume to max
   9670 00F586 42 3B FF 0F 8F B0 B0 0E      	STA		$FFF:SID+SID_VOLUME		
                                         
   9671 00F58E A9 6F 0C                     	LDA		#$0C6F				; 10C6F = 800 Hz
   9672 00F591 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
   9673 00F599 A9 01 00                     	LDA		#1
   9674 00F59C 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
   9675 00F5A4 A9 C3 00                     	LDA		#195				; 2ms
   9676 00F5A7 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
   9677 00F5AF 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
   9677 00F5B7 0E 00                      
   9678 00F5B9 A9 28 09                     	LDA		#2344				; 24 ms decay
   9679 00F5BC 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
   9680 00F5C4 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
   9680 00F5CC 0E 00                      
   9681 00F5CE A9 80 00                     	LDA		#$80				; 50% sustain level
   9682 00F5D1 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
   9683 00F5D9 A9 BC BE                     	LDA		#48828				; 500 ms release
   9684 00F5DC 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
   9685 00F5E4 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
   9685 00F5EC 0E 00                      
   9686 00F5EE A9 01 00                     	LDA		#1					; reset envelope generator
   9687 00F5F1 42 3B FF 0F 8F 0A B0 0E      	STA		$FFF:SID+SID_CTRL0+2
                                         
   9688 00F5F9 EA                           	NOP
   9689 00F5FA EA                           	NOP
   9690 00F5FB 42 3B FF 0F 42 9C 0A B0      	STZ		$FFF:SID+SID_CTRL0+2
   9690 00F603 0E 00                      
   9691 00F605 A9 04 15                     	LDA		#$1504				; gate on
   9692 00F608 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
                                           	; delay for about 1s
   9694 00F610 A0 27 00                     	LDY		#39
   9695 00F613                             .0002:
   9696 00F613 A2 FF FF                     	LDX		#65535
   9697 00F616                             .0001:
   9698 00F616 CA                           	DEX
   9699 00F617 D0 FD                        	BNE		.0001
   9700 00F619 88                           	DEY
   9701 00F61A D0 F7                        	BNE		.0002
   9702 00F61C A9 04 05                     	LDA		#$0504				; gate off
   9703 00F61F 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
   9704 00F627 60                           	RTS
   9705 00F628                             	
   9706 00F628 01 00                        	dh	1
   9707 00F62A 89 83                        	dw	33673		; G4
   9708 00F62C 0C 00                        	dw	12			; 1/8 sec
   9709 00F62E 04 00                        	dw	4			; space
                                           
   9711 00F630 01 00                        	dh	1
   9712 00F632 89 83                        	dw	33673		; G4
   9713 00F634 0C 00                        	dw	12			; 1/8
   9714 00F636 04 00                        	dw	4			; space
                                           
   9716 00F638 01 00                        	dh	1
   9717 00F63A 89 83                        	dw	33673		; G4
   9718 00F63C 0C 00                        	dw	12			; 1/8
   9719 00F63E 04 00                        	dw	4			; space
                                           
   9721 00F640 00 00                        	dh	0
   9722 00F642 00 00                        	dw	0			; G4
   9723 00F644 00 00                        	dw	0			; 1/8
   9724 00F646 00 00                        	dw	0			; space
                                           
   9726 00F648                             MusicPlay:
   9727 00F648 A2 00 00                     	LDX		#0
   9728 00F64B A9 C3 00                     	LDA		#195				; 2ms
   9729 00F64E 42 3B FF 0F 8F 0C B0 0E      	STA		$FFF:SID+SID_ATTACK0
                                         
   9730 00F656 42 3B FF 0F 42 9C 0E B0      	STZ		$FFF:SID+SID_ATTACK0+2
   9730 00F65E 0E 00                      
   9731 00F660 A9 28 09                     	LDA		#2344				; 24 ms decay
   9732 00F663 42 3B FF 0F 8F 10 B0 0E      	STA		$FFF:SID+SID_DECAY0
                                         
   9733 00F66B 42 3B FF 0F 42 9C 12 B0      	STZ		$FFF:SID+SID_DECAY0+2
   9733 00F673 0E 00                      
   9734 00F675 A9 D0 00                     	LDA		#$D0				; sustain level
   9735 00F678 42 3B FF 0F 8F 14 B0 0E      	STA		$FFF:SID+SID_SUSTAIN0
                                         
   9736 00F680 A9 F8 11                     	LDA		#4600				; ??? ms release
   9737 00F683 42 3B FF 0F 8F 18 B0 0E      	STA		$FFF:SID+SID_RELEASE0
                                         
   9738 00F68B 42 3B FF 0F 42 9C 1A B0      	STZ		$FFF:SID+SID_RELEASE0+2
   9738 00F693 0E 00                      
   9739 00F695                             .0001:
   9740 00F695 BD 28 F6                     	LDA		music_tbl,x			; check for last note
   9741 00F698 F0 56                        	BEQ		.xit
   9742 00F69A BD 2A F6                     	LDA		music_tbl+2,x			; set the frequency
   9743 00F69D 42 3B FF 0F 8F 00 B0 0E      	STA		$FFF:SID+SID_FREQ0
                                         
   9744 00F6A5 BD 2C F6                     	LDA		music_tbl+4,x
   9745 00F6A8 42 3B FF 0F 8F 02 B0 0E      	STA		$FFF:SID+SID_FREQ0+2
                                         
   9746 00F6B0 A9 04 15                     	LDA		#$1504				; gate on
   9747 00F6B3 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
   9748 00F6BB 78                           	SEI
   9749 00F6BC BD 2E F6                     	LDA		music_tbl+6,x
   9750 00F6BF 8D 04 01                     	STA		timeout1
   9751 00F6C2 BD 30 F6                     	LDA		music_tbl+8,x
   9752 00F6C5 8D 06 01                     	STA		timeout1+2
   9753 00F6C8 20 F1 F6                     	JSR		MusicWaitTimeout
   9754 00F6CB A9 04 05                     	LDA		#$0504				; gate off
   9755 00F6CE 42 3B FF 0F 8F 08 B0 0E      	STA		$FFF:SID+SID_CTRL0
                                         
   9756 00F6D6 78                           	SEI
   9757 00F6D7 BD 32 F6                     	LDA		music_tbl+10,x		; note release delay
   9758 00F6DA 8D 04 01                     	STA		timeout1
   9759 00F6DD BD 34 F6                     	LDA		music_tbl+12,x
   9760 00F6E0 8D 06 01                     	STA		timeout1+2
   9761 00F6E3 20 F1 F6                     	JSR		MusicWaitTimeout
   9762 00F6E6 E8                           	INX
   9763 00F6E7 E8                           	INX
   9764 00F6E8 42 E8                        	INX4
   9765 00F6EA 42 E8                        	INX4
   9766 00F6EC 42 E8                        	INX4
   9767 00F6EE 80 A5                        	BRA		.0001
   9768 00F6F0                             .xit:
   9769 00F6F0 60                           	RTS
                                           
   9771 00F6F1                             MusicWaitTimeout:
   9772 00F6F1                             .0001:
   9773 00F6F1 58                           	CLI
   9774 00F6F2 EA                           	NOP
   9775 00F6F3 EA                           	NOP
   9776 00F6F4 78                           	SEI
   9777 00F6F5 AD 04 01                     	LDA		timeout1
   9778 00F6F8 0D 06 01                     	ORA		timeout1+2
   9779 00F6FB D0 F4                        	BNE		.0001
   9780 00F6FD 58                           	CLI
   9781 00F6FE 60                           	RTS
                                           
   9783 00F6FF                             MusicTimeoutIRQ:
   9784 00F6FF C2 30                        	REP		#$30
                                           	MEM		16
                                           	NDX		16
   9787 00F701 AD 04 01                     	LDA		timeout1
   9788 00F704 0D 06 01                     	ORA		timeout1+2
   9789 00F707 F0 13                        	BEQ		.0001
   9790 00F709 38                           	SEC
   9791 00F70A AD 04 01                     	LDA		timeout1
   9792 00F70D E9 01 00                     	SBC		#1
   9793 00F710 8D 04 01                     	STA		timeout1
   9794 00F713 AD 06 01                     	LDA		timeout1+2
   9795 00F716 E9 00 00                     	SBC		#0
   9796 00F719 8D 06 01                     	STA		timeout1+2
   9797 00F71C                             .0001:
   9798 00F71C 60                           	RTS
                                           
   9800 00F71D FF FF FF FF FF FF FF FF      	.org	$FE00
   9800 00F725 FF FF FF FF FF FF FF FF    
   9800 00F72D FF FF FF FF FF FF FF FF    
   9800 00F735 FF FF FF FF FF FF FF FF    
   9800 00F73D FF FF FF FF FF FF FF FF    
   9800 00F745 FF FF FF FF FF FF FF FF    
   9800 00F74D FF FF FF FF FF FF FF FF    
   9800 00F755 FF FF FF FF FF FF FF FF    
   9800 00F75D FF FF FF FF FF FF FF FF    
   9800 00F765 FF FF FF FF FF FF FF FF    
   9800 00F76D FF FF FF FF FF FF FF FF    
   9800 00F775 FF FF FF FF FF FF FF FF    
   9800 00F77D FF FF FF FF FF FF FF FF    
   9800 00F785 FF FF FF FF FF FF FF FF    
   9800 00F78D FF FF FF FF FF FF FF FF    
   9800 00F795 FF FF FF FF FF FF FF FF    
   9800 00F79D FF FF FF FF FF FF FF FF    
   9800 00F7A5 FF FF FF FF FF FF FF FF    
   9800 00F7AD FF FF FF FF FF FF FF FF    
   9800 00F7B5 FF FF FF FF FF FF FF FF    
   9800 00F7BD FF FF FF FF FF FF FF FF    
   9800 00F7C5 FF FF FF FF FF FF FF FF    
   9800 00F7CD FF FF FF FF FF FF FF FF    
   9800 00F7D5 FF FF FF FF FF FF FF FF    
   9800 00F7DD FF FF FF FF FF FF FF FF    
   9800 00F7E5 FF FF FF FF FF FF FF FF    
   9800 00F7ED FF FF FF FF FF FF FF FF    
   9800 00F7F5 FF FF FF FF FF FF FF FF    
   9800 00F7FD FF FF FF FF FF FF FF FF    
   9800 00F805 FF FF FF FF FF FF FF FF    
   9800 00F80D FF FF FF FF FF FF FF FF    
   9800 00F815 FF FF FF FF FF FF FF FF    
   9800 00F81D FF FF FF FF FF FF FF FF    
   9800 00F825 FF FF FF FF FF FF FF FF    
   9800 00F82D FF FF FF FF FF FF FF FF    
   9800 00F835 FF FF FF FF FF FF FF FF    
   9800 00F83D FF FF FF FF FF FF FF FF    
   9800 00F845 FF FF FF FF FF FF FF FF    
   9800 00F84D FF FF FF FF FF FF FF FF    
   9800 00F855 FF FF FF FF FF FF FF FF    
   9800 00F85D FF FF FF FF FF FF FF FF    
   9800 00F865 FF FF FF FF FF FF FF FF    
   9800 00F86D FF FF FF FF FF FF FF FF    
   9800 00F875 FF FF FF FF FF FF FF FF    
   9800 00F87D FF FF FF FF FF FF FF FF    
   9800 00F885 FF FF FF FF FF FF FF FF    
   9800 00F88D FF FF FF FF FF FF FF FF    
   9800 00F895 FF FF FF FF FF FF FF FF    
   9800 00F89D FF FF FF FF FF FF FF FF    
   9800 00F8A5 FF FF FF FF FF FF FF FF    
   9800 00F8AD FF FF FF FF FF FF FF FF    
   9800 00F8B5 FF FF FF FF FF FF FF FF    
   9800 00F8BD FF FF FF FF FF FF FF FF    
   9800 00F8C5 FF FF FF FF FF FF FF FF    
   9800 00F8CD FF FF FF FF FF FF FF FF    
   9800 00F8D5 FF FF FF FF FF FF FF FF    
   9800 00F8DD FF FF FF FF FF FF FF FF    
   9800 00F8E5 FF FF FF FF FF FF FF FF    
   9800 00F8ED FF FF FF FF FF FF FF FF    
   9800 00F8F5 FF FF FF FF FF FF FF FF    
   9800 00F8FD FF FF FF FF FF FF FF FF    
   9800 00F905 FF FF FF FF FF FF FF FF    
   9800 00F90D FF FF FF FF FF FF FF FF    
   9800 00F915 FF FF FF FF FF FF FF FF    
   9800 00F91D FF FF FF FF FF FF FF FF    
   9800 00F925 FF FF FF FF FF FF FF FF    
   9800 00F92D FF FF FF FF FF FF FF FF    
   9800 00F935 FF FF FF FF FF FF FF FF    
   9800 00F93D FF FF FF FF FF FF FF FF    
   9800 00F945 FF FF FF FF FF FF FF FF    
   9800 00F94D FF FF FF FF FF FF FF FF    
   9800 00F955 FF FF FF FF FF FF FF FF    
   9800 00F95D FF FF FF FF FF FF FF FF    
   9800 00F965 FF FF FF FF FF FF FF FF    
   9800 00F96D FF FF FF FF FF FF FF FF    
   9800 00F975 FF FF FF FF FF FF FF FF    
   9800 00F97D FF FF FF FF FF FF FF FF    
   9800 00F985 FF FF FF FF FF FF FF FF    
   9800 00F98D FF FF FF FF FF FF FF FF    
   9800 00F995 FF FF FF FF FF FF FF FF    
   9800 00F99D FF FF FF FF FF FF FF FF    
   9800 00F9A5 FF FF FF FF FF FF FF FF    
   9800 00F9AD FF FF FF FF FF FF FF FF    
   9800 00F9B5 FF FF FF FF FF FF FF FF    
   9800 00F9BD FF FF FF FF FF FF FF FF    
   9800 00F9C5 FF FF FF FF FF FF FF FF    
   9800 00F9CD FF FF FF FF FF FF FF FF    
   9800 00F9D5 FF FF FF FF FF FF FF FF    
   9800 00F9DD FF FF FF FF FF FF FF FF    
   9800 00F9E5 FF FF FF FF FF FF FF FF    
   9800 00F9ED FF FF FF FF FF FF FF FF    
   9800 00F9F5 FF FF FF FF FF FF FF FF    
   9800 00F9FD FF FF FF FF FF FF FF FF    
   9800 00FA05 FF FF FF FF FF FF FF FF    
   9800 00FA0D FF FF FF FF FF FF FF FF    
   9800 00FA15 FF FF FF FF FF FF FF FF    
   9800 00FA1D FF FF FF FF FF FF FF FF    
   9800 00FA25 FF FF FF FF FF FF FF FF    
   9800 00FA2D FF FF FF FF FF FF FF FF    
   9800 00FA35 FF FF FF FF FF FF FF FF    
   9800 00FA3D FF FF FF FF FF FF FF FF    
   9800 00FA45 FF FF FF FF FF FF FF FF    
   9800 00FA4D FF FF FF FF FF FF FF FF    
   9800 00FA55 FF FF FF FF FF FF FF FF    
   9800 00FA5D FF FF FF FF FF FF FF FF    
   9800 00FA65 FF FF FF FF FF FF FF FF    
   9800 00FA6D FF FF FF FF FF FF FF FF    
   9800 00FA75 FF FF FF FF FF FF FF FF    
   9800 00FA7D FF FF FF FF FF FF FF FF    
   9800 00FA85 FF FF FF FF FF FF FF FF    
   9800 00FA8D FF FF FF FF FF FF FF FF    
   9800 00FA95 FF FF FF FF FF FF FF FF    
   9800 00FA9D FF FF FF FF FF FF FF FF    
   9800 00FAA5 FF FF FF FF FF FF FF FF    
   9800 00FAAD FF FF FF FF FF FF FF FF    
   9800 00FAB5 FF FF FF FF FF FF FF FF    
   9800 00FABD FF FF FF FF FF FF FF FF    
   9800 00FAC5 FF FF FF FF FF FF FF FF    
   9800 00FACD FF FF FF FF FF FF FF FF    
   9800 00FAD5 FF FF FF FF FF FF FF FF    
   9800 00FADD FF FF FF FF FF FF FF FF    
   9800 00FAE5 FF FF FF FF FF FF FF FF    
   9800 00FAED FF FF FF FF FF FF FF FF    
   9800 00FAF5 FF FF FF FF FF FF FF FF    
   9800 00FAFD FF FF FF FF FF FF FF FF    
   9800 00FB05 FF FF FF FF FF FF FF FF    
   9800 00FB0D FF FF FF FF FF FF FF FF    
   9800 00FB15 FF FF FF FF FF FF FF FF    
   9800 00FB1D FF FF FF FF FF FF FF FF    
   9800 00FB25 FF FF FF FF FF FF FF FF    
   9800 00FB2D FF FF FF FF FF FF FF FF    
   9800 00FB35 FF FF FF FF FF FF FF FF    
   9800 00FB3D FF FF FF FF FF FF FF FF    
   9800 00FB45 FF FF FF FF FF FF FF FF    
   9800 00FB4D FF FF FF FF FF FF FF FF    
   9800 00FB55 FF FF FF FF FF FF FF FF    
   9800 00FB5D FF FF FF FF FF FF FF FF    
   9800 00FB65 FF FF FF FF FF FF FF FF    
   9800 00FB6D FF FF FF FF FF FF FF FF    
   9800 00FB75 FF FF FF FF FF FF FF FF    
   9800 00FB7D FF FF FF FF FF FF FF FF    
   9800 00FB85 FF FF FF FF FF FF FF FF    
   9800 00FB8D FF FF FF FF FF FF FF FF    
   9800 00FB95 FF FF FF FF FF FF FF FF    
   9800 00FB9D FF FF FF FF FF FF FF FF    
   9800 00FBA5 FF FF FF FF FF FF FF FF    
   9800 00FBAD FF FF FF FF FF FF FF FF    
   9800 00FBB5 FF FF FF FF FF FF FF FF    
   9800 00FBBD FF FF FF FF FF FF FF FF    
   9800 00FBC5 FF FF FF FF FF FF FF FF    
   9800 00FBCD FF FF FF FF FF FF FF FF    
   9800 00FBD5 FF FF FF FF FF FF FF FF    
   9800 00FBDD FF FF FF FF FF FF FF FF    
   9800 00FBE5 FF FF FF FF FF FF FF FF    
   9800 00FBED FF FF FF FF FF FF FF FF    
   9800 00FBF5 FF FF FF FF FF FF FF FF    
   9800 00FBFD FF FF FF FF FF FF FF FF    
   9800 00FC05 FF FF FF FF FF FF FF FF    
   9800 00FC0D FF FF FF FF FF FF FF FF    
   9800 00FC15 FF FF FF FF FF FF FF FF    
   9800 00FC1D FF FF FF FF FF FF FF FF    
   9800 00FC25 FF FF FF FF FF FF FF FF    
   9800 00FC2D FF FF FF FF FF FF FF FF    
   9800 00FC35 FF FF FF FF FF FF FF FF    
   9800 00FC3D FF FF FF FF FF FF FF FF    
   9800 00FC45 FF FF FF FF FF FF FF FF    
   9800 00FC4D FF FF FF FF FF FF FF FF    
   9800 00FC55 FF FF FF FF FF FF FF FF    
   9800 00FC5D FF FF FF FF FF FF FF FF    
   9800 00FC65 FF FF FF FF FF FF FF FF    
   9800 00FC6D FF FF FF FF FF FF FF FF    
   9800 00FC75 FF FF FF FF FF FF FF FF    
   9800 00FC7D FF FF FF FF FF FF FF FF    
   9800 00FC85 FF FF FF FF FF FF FF FF    
   9800 00FC8D FF FF FF FF FF FF FF FF    
   9800 00FC95 FF FF FF FF FF FF FF FF    
   9800 00FC9D FF FF FF FF FF FF FF FF    
   9800 00FCA5 FF FF FF FF FF FF FF FF    
   9800 00FCAD FF FF FF FF FF FF FF FF    
   9800 00FCB5 FF FF FF FF FF FF FF FF    
   9800 00FCBD FF FF FF FF FF FF FF FF    
   9800 00FCC5 FF FF FF FF FF FF FF FF    
   9800 00FCCD FF FF FF FF FF FF FF FF    
   9800 00FCD5 FF FF FF FF FF FF FF FF    
   9800 00FCDD FF FF FF FF FF FF FF FF    
   9800 00FCE5 FF FF FF FF FF FF FF FF    
   9800 00FCED FF FF FF FF FF FF FF FF    
   9800 00FCF5 FF FF FF FF FF FF FF FF    
   9800 00FCFD FF FF FF FF FF FF FF FF    
   9800 00FD05 FF FF FF FF FF FF FF FF    
   9800 00FD0D FF FF FF FF FF FF FF FF    
   9800 00FD15 FF FF FF FF FF FF FF FF    
   9800 00FD1D FF FF FF FF FF FF FF FF    
   9800 00FD25 FF FF FF FF FF FF FF FF    
   9800 00FD2D FF FF FF FF FF FF FF FF    
   9800 00FD35 FF FF FF FF FF FF FF FF    
   9800 00FD3D FF FF FF FF FF FF FF FF    
   9800 00FD45 FF FF FF FF FF FF FF FF    
   9800 00FD4D FF FF FF FF FF FF FF FF    
   9800 00FD55 FF FF FF FF FF FF FF FF    
   9800 00FD5D FF FF FF FF FF FF FF FF    
   9800 00FD65 FF FF FF FF FF FF FF FF    
   9800 00FD6D FF FF FF FF FF FF FF FF    
   9800 00FD75 FF FF FF FF FF FF FF FF    
   9800 00FD7D FF FF FF FF FF FF FF FF    
   9800 00FD85 FF FF FF FF FF FF FF FF    
   9800 00FD8D FF FF FF FF FF FF FF FF    
   9800 00FD95 FF FF FF FF FF FF FF FF    
   9800 00FD9D FF FF FF FF FF FF FF FF    
   9800 00FDA5 FF FF FF FF FF FF FF FF    
   9800 00FDAD FF FF FF FF FF FF FF FF    
   9800 00FDB5 FF FF FF FF FF FF FF FF    
   9800 00FDBD FF FF FF FF FF FF FF FF    
   9800 00FDC5 FF FF FF FF FF FF FF FF    
   9800 00FDCD FF FF FF FF FF FF FF FF    
   9800 00FDD5 FF FF FF FF FF FF FF FF    
   9800 00FDDD FF FF FF FF FF FF FF FF    
   9800 00FDE5 FF FF FF FF FF FF FF FF    
   9800 00FDED FF FF FF FF FF FF FF FF    
   9800 00FDF5 FF FF FF FF FF FF FF FF    
   9800 00FDFD FF FF FF                   
   9801 00FE00 4C A9 F1                     	JMP		SuperGetch
   9802 00FE03 4C C3 F1                     	JMP		warm_start
   9803 00FE06 4C B2 F1                     	JMP		SuperPutch
   9804 00FE09 4C 13 E6                     	JMP		BIOSInput
   9805 00FE0C 4C B8 F1                     	JMP		BasicGetch
   9806 00FE0F 4C 27 E2                     	JMP		xitBasic
                                           
   9808 00FE12 FF FF FF FF FF FF FF FF      	.org 	$FFD6
   9808 00FE1A FF FF FF FF FF FF FF FF    
   9808 00FE22 FF FF FF FF FF FF FF FF    
   9808 00FE2A FF FF FF FF FF FF FF FF    
   9808 00FE32 FF FF FF FF FF FF FF FF    
   9808 00FE3A FF FF FF FF FF FF FF FF    
   9808 00FE42 FF FF FF FF FF FF FF FF    
   9808 00FE4A FF FF FF FF FF FF FF FF    
   9808 00FE52 FF FF FF FF FF FF FF FF    
   9808 00FE5A FF FF FF FF FF FF FF FF    
   9808 00FE62 FF FF FF FF FF FF FF FF    
   9808 00FE6A FF FF FF FF FF FF FF FF    
   9808 00FE72 FF FF FF FF FF FF FF FF    
   9808 00FE7A FF FF FF FF FF FF FF FF    
   9808 00FE82 FF FF FF FF FF FF FF FF    
   9808 00FE8A FF FF FF FF FF FF FF FF    
   9808 00FE92 FF FF FF FF FF FF FF FF    
   9808 00FE9A FF FF FF FF FF FF FF FF    
   9808 00FEA2 FF FF FF FF FF FF FF FF    
   9808 00FEAA FF FF FF FF FF FF FF FF    
   9808 00FEB2 FF FF FF FF FF FF FF FF    
   9808 00FEBA FF FF FF FF FF FF FF FF    
   9808 00FEC2 FF FF FF FF FF FF FF FF    
   9808 00FECA FF FF FF FF FF FF FF FF    
   9808 00FED2 FF FF FF FF FF FF FF FF    
   9808 00FEDA FF FF FF FF FF FF FF FF    
   9808 00FEE2 FF FF FF FF FF FF FF FF    
   9808 00FEEA FF FF FF FF FF FF FF FF    
   9808 00FEF2 FF FF FF FF FF FF FF FF    
   9808 00FEFA FF FF FF FF FF FF FF FF    
   9808 00FF02 FF FF FF FF FF FF FF FF    
   9808 00FF0A FF FF FF FF FF FF FF FF    
   9808 00FF12 FF FF FF FF FF FF FF FF    
   9808 00FF1A FF FF FF FF FF FF FF FF    
   9808 00FF22 FF FF FF FF FF FF FF FF    
   9808 00FF2A FF FF FF FF FF FF FF FF    
   9808 00FF32 FF FF FF FF FF FF FF FF    
   9808 00FF3A FF FF FF FF FF FF FF FF    
   9808 00FF42 FF FF FF FF FF FF FF FF    
   9808 00FF4A FF FF FF FF FF FF FF FF    
   9808 00FF52 FF FF FF FF FF FF FF FF    
   9808 00FF5A FF FF FF FF FF FF FF FF    
   9808 00FF62 FF FF FF FF FF FF FF FF    
   9808 00FF6A FF FF FF FF FF FF FF FF    
   9808 00FF72 FF FF FF FF FF FF FF FF    
   9808 00FF7A FF FF FF FF FF FF FF FF    
   9808 00FF82 FF FF FF FF FF FF FF FF    
   9808 00FF8A FF FF FF FF FF FF FF FF    
   9808 00FF92 FF FF FF FF FF FF FF FF    
   9808 00FF9A FF FF FF FF FF FF FF FF    
   9808 00FFA2 FF FF FF FF FF FF FF FF    
   9808 00FFAA FF FF FF FF FF FF FF FF    
   9808 00FFB2 FF FF FF FF FF FF FF FF    
   9808 00FFBA FF FF FF FF FF FF FF FF    
   9808 00FFC2 FF FF FF FF FF FF FF FF    
   9808 00FFCA FF FF FF FF FF FF FF FF    
   9808 00FFD2 FF FF FF FF                
   9809 00FFD6 04 00                        	dw		4			; task #4
                                           
   9811 00FFD8 FF FF FF FF FF FF            	.org	$FFDE
   9812 00FFDE 06 00                        	dw		6			; task #6
                                           
   9814 00FFE0 FF FF FF FF FF FF            	.org 	$FFE6
   9815 00FFE6 61 F2                        	dw		BrkRout
                                           
   9817 00FFE8 FF FF FF FF FF FF            	.org	$FFEE		; IRQ vector
   9818 00FFEE D8 F1                        	dw		IRQRout
                                           
   9820 00FFF0 FF FF FF FF FF FF FF FF      	.org	$FFFC
   9820 00FFF8 FF FF FF FF                
   9821 00FFFC 00 E0                        	dw		$E000
                                           
                                           	.org	$FFFE
   9824 00FFFE D7 F1                        	dw		ByteIRQRout

Checksum=E8B63A57

Number of instructions processed: 4104
Number of opcode bytes: 9385
Bytes per instruction: 2.286793 (18.294347 bits)
Clock cycle count: 5453
Clocks per instruction: 1.328704

The above statistics are only estimates.

	The CPI assumes data memory access requires two clock cycles and instruction
	access is single cycle. The actual CPI may be higher if there are memory wait 
	states, or lower if data is found in the cache.
